const id = "architecture.mdx";
						const collection = "docs";
						const slug = "architecture";
						const body = "\n# Notification Architecture\n\n## System Overview\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              USER DEVICE (iOS)                              │\n├─────────────────────────────────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────────────────────────────────┐    │\n│  │                     DESPIA NATIVE WRAPPER                           │    │\n│  │  - OneSignal Native SDK                                             │    │\n│  │  - Exposes: window.onesignalplayerid                                │    │\n│  │  - Handles: Push permission, device registration                    │    │\n│  └─────────────────────────────────────────────────────────────────────┘    │\n│                              │                                              │\n│                              ▼                                              │\n│  ┌─────────────────────────────────────────────────────────────────────┐    │\n│  │   REACT WEB APP (WebView)                                           │    │\n│  │   - Registers player_id with backend                                │    │\n│  │   - Manages user preferences                                        │    │\n│  │   - Handles notification deep links                                 │    │\n│  └─────────────────────────────────────────────────────────────────────┘    │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                         NETLIFY FUNCTIONS                                   │\n│  ┌─────────────────────────────────────────────────────────────────────┐    │\n│  │                    UNIFIED DISPATCHER                                │    │\n│  │  - Receives notification intents                                     │    │\n│  │  - Enforces idempotency (notification_send_log)                     │    │\n│  │  - Enforces preferences, cooldowns, quiet hours                     │    │\n│  │  - Targets OneSignal via external_user_id                           │    │\n│  │  - Sets collapse_id, thread_id, android_group                       │    │\n│  │  - Logs all send attempts                                            │    │\n│  └─────────────────────────────────────────────────────────────────────┘    │\n│                               │                                             │\n│                               ▼                                             │\n│                    ┌─────────────────────┐                                  │\n│                    │  OneSignal REST API │                                  │\n│                    │  POST /notifications│                                  │\n│                    └─────────────────────┘                                  │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                             SUPABASE                                        │\n│  ┌─────────────────────────────────────────────────────────────────────┐    │\n│  │ notification_send_log │ push_subscriptions │ user_notification_prefs │    │\n│  │ (idempotency + audit) │ (device registry)  │ (user choices)          │    │\n│  └─────────────────────────────────────────────────────────────────────┘    │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Dispatcher Flow\n\n1. **Intent Received**: Trigger provides `notification_key`, `event_id`, `userIds[]`, and `data`\n2. **Idempotency Check**: For each user, try to INSERT into `notification_send_log` \n   - If duplicate key error → skip (already sent)\n   - If inserted → continue\n3. **Policy Enforcement**:\n   - Check user preferences in `user_notification_preferences`\n   - Check cooldown (recent sends for same `notification_key`)\n   - Check quiet hours (catalog metadata)\n   - Check league mutes (for chat notifications)\n4. **Targeting**: Resolve OneSignal targets (external_user_id or player_ids)\n5. **Payload Build**: Set collapse_id, thread_id, android_group from catalog\n6. **Send**: Call OneSignal API\n7. **Log Result**: Update `notification_send_log` with outcome\n\n## Event ID Format\n\nEach notification type has a deterministic event_id format:\n\n| Type | Format | Example |\n|------|--------|---------|\n| goal-scored | `goal:{api_match_id}:{scorer}:{minute}` | `goal:12345:Haaland:52` |\n| kickoff | `kickoff:{api_match_id}:{half}` | `kickoff:12345:1` |\n| half-time | `halftime:{api_match_id}` | `halftime:12345` |\n| final-whistle | `ft:{api_match_id}` | `ft:12345` |\n| gameweek-complete | `gw_complete:{gw}` | `gw_complete:16` |\n| chat-message | `chat:{league_id}:{message_id}` | `chat:abc123:msg456` |\n| final-submission | `final_sub:{league_id}:{gw}` | `final_sub:abc123:16` |\n| new-gameweek | `new_gw:{gw}` | `new_gw:17` |\n\n## OneSignal Grouping\n\nEvery notification includes grouping fields to prevent duplicate display:\n\n| Field | Purpose | Example |\n|-------|---------|---------|\n| `collapse_id` | Replaces existing notification with same ID | `goal:12345` |\n| `thread_id` | Groups iOS notifications by thread | `match:12345` |\n| `android_group` | Groups Android notifications | `totl_scores` |\n\n";
						const data = {title:"Architecture",description:"How the TOTL notification system works",head:[]};
						const _internal = {
							type: 'content',
							filePath: "/Users/carlstratton/Documents/totl-despia2/totl-despia/notification_catalog/site/src/content/docs/architecture.mdx",
							rawData: "\ntitle: Architecture\ndescription: How the TOTL notification system works\nhead: []",
						};

export { _internal, body, collection, data, id, slug };
