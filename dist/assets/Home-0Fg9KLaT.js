import{r as h,j as e,R as bt,L as ut,u as Nt,g as Me,a as Ye,C as Ke,s as L}from"./index-KOZHjtGm.js";import{S as pt}from"./Section-ZiTuX9-_.js";import{M as Lt}from"./MiniLeagueCard-BOWLYz6l.js";import{L as Gt}from"./leagueStart-CU9BsDlb.js";import{a as V,b as Qe}from"./teamNames-lueGeFt9.js";import{u as Mt}from"./useLiveScores-BukaJbvE.js";function Pt(){const[s,A]=h.useState(!1),r=h.useRef(null),E=h.useRef(null);h.useEffect(()=>{const X=setTimeout(()=>{A(!0)},50);return()=>clearTimeout(X)},[]),h.useEffect(()=>{let X;const ee=()=>{X=requestAnimationFrame(()=>{const k=window.scrollY;if(E.current&&r.current){const I=Math.min(1,k/300)*180,N=Math.max(0,1-k/250),B=Math.max(.4,1-k/400),te=k<400;E.current.style.height=te?"130px":"0px",k>0?(r.current.style.opacity=N.toString(),r.current.style.transform=`perspective(1000px) rotateY(${I}deg) scale(${B})`,r.current.style.transition="opacity 0.1s ease-out, transform 0.1s ease-out"):(r.current.style.opacity="1",r.current.style.transform="perspective(1000px) rotateY(0deg) scale(1)",r.current.style.transition="opacity 0.6s ease-out, transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)")}})};return window.addEventListener("scroll",ee,{passive:!0}),()=>{window.removeEventListener("scroll",ee),cancelAnimationFrame(X)}},[]);const re=s?0:-360;return e.jsx("div",{ref:E,className:"w-full flex justify-center items-start transition-all duration-200",style:{height:"130px",overflow:"hidden",paddingTop:"4px",paddingBottom:"0px",perspective:"1000px"},children:e.jsx("div",{ref:r,style:{opacity:s?1:0,transform:`perspective(1000px) rotateY(${re}deg) scale(1)`,transformStyle:"preserve-3d",transition:"opacity 0.6s ease-out, transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",willChange:"transform, opacity"},children:e.jsx("img",{src:"/assets/badges/totl-logo1.svg",alt:"TOTL",className:"h-[88px] sm:h-[110px]",style:{filter:"brightness(0)",backfaceVisibility:"hidden"}})})})}const et=bt.memo(function({title:A,badgeSrc:r,badgeAlt:E,linkTo:re,rank:X,total:ee,score:k,gw:z,totalFixtures:I,subtitle:N,variant:B="default"}){const te=X&&ee&&ee>0?`TOP ${Math.round(X/ee*100)}%`:"—";return B==="lastGw"?e.jsx(ut,{to:re,className:"flex-shrink-0 w-[148px] h-[148px] rounded-xl border bg-white shadow-sm overflow-hidden cursor-pointer block hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-3 h-full flex flex-col relative",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex items-baseline gap-[3px]",style:{marginTop:"-4px"},children:k!==void 0&&I!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-[#1C8376]",style:{fontSize:"38px",fontWeight:"normal",lineHeight:"1"},children:k}),e.jsxs("div",{className:"flex items-baseline gap-[4px]",children:[e.jsx("span",{className:"text-slate-500",style:{fontSize:"18px",fontWeight:"normal",lineHeight:"1"},children:"/"}),e.jsx("span",{className:"text-slate-500",style:{fontSize:"18px",fontWeight:"normal",lineHeight:"1"},children:I})]})]}):e.jsx("span",{className:"leading-none text-slate-900",children:"—"})}),e.jsx("svg",{className:"w-4 h-4 text-slate-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:["GAME WEEK ",z??"—"]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-xs font-semibold text-slate-900",children:te})})]})]})}):e.jsx(ut,{to:re,className:"flex-shrink-0 w-[148px] h-[148px] rounded-xl border bg-white shadow-sm overflow-hidden cursor-pointer block hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-3 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r&&e.jsx("img",{src:r,alt:E||A,className:"w-[32px] h-[32px]"}),e.jsx("svg",{className:"w-4 h-4 text-slate-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:N||A}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-xs font-semibold text-slate-900",children:te})})]})]})})}),At=bt.memo(function({streak:A,last10GwScores:r,latestGw:E}){const re=r,X=re.filter(N=>N.score!==null),ee=X.length>0?Math.max(...X.map(N=>N.score)):10,k=0,z=ee-k||1,I=60;return e.jsx("div",{className:"flex-shrink-0 w-[340px] sm:w-[400px] h-[148px] rounded-xl border bg-white shadow-sm overflow-hidden hover:shadow-md transition-shadow relative",children:e.jsxs("div",{className:"p-3 h-full flex flex-col",children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mb-2 relative",style:{height:"70px"},children:e.jsx("div",{className:"relative h-full",children:e.jsx("div",{className:"flex items-end justify-between gap-1 h-full px-1",children:re.map(N=>{const B=N.score!==null,te=N.gw===E,q=N.score??0,K=B?(q-k)/z*I:0;return e.jsxs("div",{className:"flex flex-col items-center justify-end gap-1 flex-1 relative min-w-0",children:[B&&e.jsx("div",{className:`text-xs font-bold mb-0.5 leading-none ${te?"text-[#1C8376]":"text-slate-700"}`,children:q}),e.jsx("div",{className:`w-full rounded-t transition-all ${B?te?"bg-[#1C8376]":"bg-slate-400":"bg-slate-200"}`,style:{height:`${K}px`,minHeight:B?"4px":"0"},title:B?`GW${N.gw}: ${q}`:`GW${N.gw}: Not played`}),e.jsxs("div",{className:`text-[10px] font-medium leading-tight ${B?te?"text-[#1C8376] font-bold":"text-slate-700":"text-slate-400"}`,children:["GW",N.gw]})]},N.gw)})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),e.jsx("circle",{cx:"12",cy:"12",r:"6",strokeWidth:2}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]}),e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Your Streak"," ",e.jsx("span",{className:"font-bold text-orange-500",children:A>0?`${A} ${A===1?"Week":"Weeks"}`:"Start your streak!"})]})]}),e.jsx("span",{className:"text-[10px] font-medium text-slate-400",children:"Last 10"})]})]})})});function Et(s,A,r=!1){if(s==="FINISHED")return"FT";if(s==="PAUSED")return"HT";if(s==="IN_PLAY"){if(A==null)return"LIVE";if(r)return`${A}'`;if(A>=1&&A<=45)return"First Half";if(A>45&&A<=50)return"45+";if(A>50)return"Second Half"}return"LIVE"}const Rt=({fixture:s,pick:A,liveScore:r,isTestApi:E=!1,showPickButtons:re=!0})=>{const X=s.home_team||s.home_name||s.home_code||"",ee=s.away_team||s.away_name||s.away_code||"",k=V(X),z=V(ee),I=s.kickoff_time?(()=>{const g=new Date(s.kickoff_time),j=String(g.getUTCHours()).padStart(2,"0"),O=String(g.getUTCMinutes()).padStart(2,"0");return`${j}:${O}`})():"—",N=!!r,B=N&&r.status==="IN_PLAY",te=N&&(r.status==="PAUSED"||r.status==="HALF_TIME"||r.status==="HT"),q=N&&r.status==="FINISHED",K=B||te,De=B||te,fe=N&&(K||q),tt=!fe,be=N&&(K||q)&&!!r.goals,xe=N&&(K||q)&&!!r.red_cards,st=re&&(!E||A!==void 0),Ve=N&&(K||q)&&r.homeScore>r.awayScore,at=N&&(K||q)&&r.awayScore>r.homeScore,Pe=g=>{const j=A===g;let O=!1;return r&&(g==="H"&&r.homeScore>r.awayScore||g==="A"&&r.awayScore>r.homeScore||g==="D"&&r.homeScore===r.awayScore)&&(O=!0),{isPicked:j,isCorrectResult:O,isCorrect:j&&O,isWrong:j&&(K||q)&&!O}},Fe=Pe("H"),Ae=Pe("D"),He=Pe("A"),_e=g=>{const j="h-16 rounded-xl border text-sm font-medium transition-all flex items-center justify-center select-none";return B||K?g.isCorrect?`${j} bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50`:g.isWrong?`${j} bg-[#1C8376] text-white border-[#1C8376]`:g.isPicked?`${j} bg-[#1C8376] text-white border-[#1C8376]`:g.isCorrectResult&&!g.isPicked?`${j} bg-slate-50 text-slate-600 border-2 border-slate-300 animate-pulse`:`${j} bg-slate-50 text-slate-600 border-slate-200`:q?g.isCorrect?`${j} bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-2xl shadow-yellow-400/40 transform scale-110 rotate-1 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]`:g.isWrong?`${j} bg-[#1C8376] text-white border-[#1C8376]`:g.isCorrectResult&&!g.isPicked?`${j} bg-slate-50 text-slate-600 border-4 border-emerald-600`:g.isPicked?`${j} bg-[#1C8376] text-white border-[#1C8376]`:`${j} bg-slate-50 text-slate-600 border-slate-200`:g.isPicked?`${j} bg-[#1C8376] text-white border-[#1C8376]`:`${j} bg-slate-50 text-slate-600 border-slate-200`},Oe=(g,j)=>{if(!xe)return 0;const O=r.red_cards||[];O.length>0&&console.log(`[FixtureCard] Red cards for ${g} (${j?"home":"away"}):`,{allRedCards:O,teamName:g,homeName:k,awayName:z,liveScoreHomeTeam:r.home_team,liveScoreAwayTeam:r.away_team});const U=O.filter(x=>{if(!x||!x.team)return!1;const R=x.team||"",T=V(R),J=j?r.home_team?V(r.home_team):k:r.away_team?V(r.away_team):z,Z=se(T),ye=se(J),ne=j?k:z,oe=se(ne),ie=(Se,ue)=>{const Q=Se.toLowerCase().trim(),we=ue.toLowerCase().trim();return Q===we||Q.startsWith(we+" ")};return T===J||T===g||ie(T,J)||ie(T,g)||ie(T,ne)||ie(Z,ye)||ie(Z,oe)||Z===ye||Z===oe||T===V(j?s.home_team||"":s.away_team||"")||T===V(j?s.home_name||"":s.away_name||"")||R.toLowerCase()===g.toLowerCase()||R.toLowerCase()===ne.toLowerCase()||Z&&ye&&Z.toLowerCase()===ye.toLowerCase()});return U.length>0&&console.log(`[FixtureCard] Filtered red cards for ${g}:`,U),U.length},se=g=>g.replace(/^(Ca|Se|At|Es|Gr|Sc|Cr|Fc|Ac|Ad|Ap|Av|Bo|Br|Ce|Ch|Co|Cu|De|Ec|Fe|Fi|Fl|Fo|Fr|Fu|Ga|Go|Gu|He|Ho|Hu|In|It|Ja|Je|Ju|La|Le|Li|Lo|Lu|Ma|Me|Mi|Mo|Na|Ne|Ni|No|Nu|Ol|Os|Pa|Pe|Pi|Po|Pr|Pu|Qu|Ra|Re|Ri|Ro|Ru|Sa|Si|So|Su|Ta|Te|Ti|To|Tr|Tu|Un|Ur|Va|Ve|Vi|Vo|Vu|We|Wi|Wo|Wu|Xa|Xe|Xi|Xo|Xu|Ya|Ye|Yi|Yo|Yu|Za|Ze|Zi|Zo|Zu)\s+/i,"").trim(),ze=(g,j)=>{if(!be)return null;const O=r.goals||[],U=r.homeScore||0,x=r.awayScore||0,R=[],T=[],J=[];O.forEach(p=>{if(!p||!p.team){J.push(p);return}const C=p.team||"",y=V(C),Y=C.toLowerCase().trim().replace(/[^a-z0-9]/g,""),M=r.home_team?V(r.home_team):k,P=r.away_team?V(r.away_team):z,le=M.toLowerCase().replace(/[^a-z0-9]/g,""),Ee=P.toLowerCase().replace(/[^a-z0-9]/g,""),ve=se(y),Re=se(M),Be=se(P),ke=(w,d)=>{const u=w.toLowerCase().trim(),f=d.toLowerCase().trim();return u===f||u.startsWith(f+" ")},rt=[k,M,s.home_team||"",s.home_name||"",r.home_team||""].filter(Boolean),n=Y===le||Y.includes("parissaintgermain")&&le==="psg"||le.includes("parissaintgermain")&&Y==="psg"||Y.includes("parissaintgermain")&&le.includes("parissaintgermain"),i=Y===Ee||Y.includes("parissaintgermain")&&Ee==="psg"||Ee.includes("parissaintgermain")&&Y==="psg"||Y.includes("parissaintgermain")&&Ee.includes("parissaintgermain"),t=y===M||ve===Re||ke(y,M)||ke(ve,Re)||y===V(s.home_team||"")||y===V(s.home_name||"")||C.toLowerCase()===k.toLowerCase()||n||rt.some(w=>C.toLowerCase()===w.toLowerCase()||Qe(C,w)||Qe(y,V(w))),o=[z,P,s.away_team||"",s.away_name||"",r.away_team||""].filter(Boolean),m=y===P||ve===Be||ke(y,P)||ke(ve,Be)||y===V(s.away_team||"")||y===V(s.away_name||"")||C.toLowerCase()===z.toLowerCase()||i||o.some(w=>C.toLowerCase()===w.toLowerCase()||Qe(C,w)||Qe(y,V(w)));t&&!m?R.push(p):m&&!t?T.push(p):J.push(p)});const Z=R.length,ye=T.length,ne=J.length,oe=U-Z,ie=x-ye;if(ne>0){let p=0,C=0;J.forEach(y=>{p<oe&&oe>0?(R.push(y),p++):C<ie&&ie>0&&(T.push(y),C++)})}const Se=R.length,ue=T.length,Q=O.length;if(Q!==U+x&&console.warn("[FixtureCard] Goal count mismatch:",{totalGoals:Q,homeScore:U,awayScore:x,expectedTotal:U+x}),Se!==U||ue!==x){console.log("[FixtureCard] Score-based correction needed:",{homeCount:Se,homeScore:U,awayCount:ue,awayScore:x,totalGoals:Q});const p=U-Se,C=x-ue;if(p>0&&C<0){const y=Math.min(Math.abs(C),p),Y=[...T].sort((M,P)=>(P.minute??0)-(M.minute??0));for(let M=0;M<y;M++){const P=Y[M],le=T.indexOf(P);le>-1&&(T.splice(le,1),R.push(P),console.log("[FixtureCard] Moved goal from away to home:",P.scorer,P.minute))}}else if(C>0&&p<0){const y=Math.min(Math.abs(p),C),Y=[...R].sort((M,P)=>(P.minute??0)-(M.minute??0));for(let M=0;M<y;M++){const P=Y[M],le=R.indexOf(P);le>-1&&(R.splice(le,1),T.push(P),console.log("[FixtureCard] Moved goal from home to away:",P.scorer,P.minute))}}}(g.toLowerCase().includes("psg")||g.toLowerCase().includes("paris"))&&console.log("[FixtureCard] PSG goal matching debug:",{teamName:g,isHome:j,homeScore:U,awayScore:x,homeGoalCount:R.length,awayGoalCount:T.length,unmatchedCount:ne,allGoals:O.map(p=>({team:p.team,scorer:p.scorer,minute:p.minute,teamId:p.teamId})),homeGoals:R.map(p=>({team:p.team,scorer:p.scorer,minute:p.minute})),awayGoals:T.map(p=>({team:p.team,scorer:p.scorer,minute:p.minute}))});const we=j?R:T,he=new Map;return we.forEach(p=>{const C=p.scorer||"Unknown",y=p.minute;he.has(C)||he.set(C,[]),y!=null&&he.get(C).push(y)}),g==="Grêmio"&&we.length>0&&console.log("[FixtureCard] Grêmio goals debug:",{teamGoals:we,goalsByScorer:Array.from(he.entries()),goalsByScorerSize:he.size}),he.size===0?null:e.jsx("div",{className:`mt-3 mb-2 flex flex-col ${j?"items-end":"items-start"} gap-0.5`,children:Array.from(he.entries()).map(([p,C],y)=>{const Y=C.sort((M,P)=>M-P);return e.jsxs("span",{className:"text-[11px] text-slate-600",children:[p," ",Y.map(M=>`${M}'`).join(", ")]},y)})})};return e.jsxs("div",{className:"p-4 !bg-white relative z-0",children:[De&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),e.jsx("div",{className:`flex flex-col px-2 pb-3 ${K?"pt-4":"pt-1"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-1 relative",children:[e.jsx("div",{className:`break-words ${Ve?"font-bold":"font-medium"}`,children:k}),e.jsx("div",{className:"relative flex flex-col items-center",children:e.jsx("img",{src:`/assets/badges/${(s.home_code||X).toUpperCase()}.png`,alt:k,className:"w-5 h-5",onError:g=>{g.currentTarget.style.opacity="0.35"}})})]}),be&&ze(k,!0)]}),e.jsx("div",{className:"px-4 flex flex-col items-center",children:fe?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 relative",children:[e.jsxs("div",{className:"relative flex flex-col items-center",children:[xe&&Oe(k,!0)>0&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-1.5 h-2.5 bg-red-600 rounded-sm z-10"}),e.jsx("span",{className:"font-bold text-base text-slate-900",children:r.homeScore})]}),e.jsx("span",{className:"font-bold text-base text-slate-900",children:"-"}),e.jsxs("div",{className:"relative flex flex-col items-center",children:[xe&&Oe(z,!1)>0&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-1.5 h-2.5 bg-red-600 rounded-sm z-10"}),e.jsx("span",{className:"font-bold text-base text-slate-900",children:r.awayScore})]})]}),e.jsx("span",{className:`text-[10px] font-semibold mt-0.5 ${K?"text-red-600":"text-slate-500"}`,children:Et(r.status,r.minute,E)})]}):tt&&e.jsx("span",{className:"text-slate-500 text-sm",children:I})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-1 relative",children:[e.jsx("div",{className:"relative flex flex-col items-center",children:e.jsx("img",{src:`/assets/badges/${(s.away_code||ee).toUpperCase()}.png`,alt:z,className:"w-5 h-5",onError:g=>{g.currentTarget.style.opacity="0.35"}})}),e.jsx("div",{className:`break-words ${at?"font-bold":"font-medium"}`,children:z})]}),be&&ze(z,!1)]})]})}),st&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 relative",children:[e.jsx("div",{className:`${_e(Fe)} flex items-center justify-center`,children:e.jsx("span",{className:`${Fe.isCorrect?"font-bold":""} ${Fe.isWrong&&q?"line-through decoration-2 decoration-white":""}`,children:"Home Win"})}),e.jsx("div",{className:`${_e(Ae)} flex items-center justify-center`,children:e.jsx("span",{className:`${Ae.isCorrect?"font-bold":""} ${Ae.isWrong&&q?"line-through decoration-2 decoration-white":""}`,children:"Draw"})}),e.jsx("div",{className:`${_e(He)} flex items-center justify-center`,children:e.jsx("span",{className:`${He.isCorrect?"font-bold":""} ${He.isWrong&&q?"line-through decoration-2 decoration-white":""}`,children:"Away Win"})})]})]})};function Tt({value:s,onChange:A}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-medium transition-colors ${s?"text-slate-400":"text-slate-700"}`,children:"ALL"}),e.jsx("button",{onClick:()=>A(!s),className:"relative inline-flex items-center rounded-full transition-colors focus:outline-none",style:{backgroundColor:s?"#dc2626":"#cbd5e1",width:"48px",height:"24px",border:"none"},"aria-label":s?"Show all games":"Show live games only",children:e.jsx("span",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-sm transform transition-transform duration-200 ease-in-out ${s?"translate-x-6":"translate-x-0.5"}`})}),e.jsx("span",{className:`text-[10px] font-medium transition-colors ${s?"text-slate-700":"text-slate-400"}`,children:"LIVE"})]})}function $t(s){return s.result==="H"||s.result==="D"||s.result==="A"?s.result:null}function Bt(){const{user:s}=Nt(),r=(()=>{let n=s?.id;if(!n&&typeof window<"u")try{const i=localStorage.getItem("totl:user");i&&(n=JSON.parse(i).id)}catch{}if(typeof window>"u"||!n)return{leagues:[],gw:1,latestGw:null,gwPoints:[],allGwPoints:[],overall:[],lastGwRank:null,isInApiTestLeague:!1,fixtures:[],userPicks:{},fixturesLoading:!0,loading:!0,leagueDataLoading:!0,leaderboardDataLoading:!0};try{if(!n)return{leagues:[],gw:1,latestGw:null,gwPoints:[],allGwPoints:[],overall:[],lastGwRank:null,isInApiTestLeague:!1,fixtures:[],userPicks:{},fixturesLoading:!0,loading:!0,leagueDataLoading:!0,leaderboardDataLoading:!0};const i=`home:basic:${n}`,t=Me(i);if(t&&t.leagues&&Array.isArray(t.leagues)&&t.leagues.length>0){let o=[],m={},w=!0;if(t.isInApiTestLeague&&t.testGw){const d=`home:fixtures:${n}:${t.testGw}`;try{const u=Me(d);u&&u.fixtures&&Array.isArray(u.fixtures)&&u.fixtures.length>0&&(o=u.fixtures,m=u.userPicks||{},w=!1,ue.current=!0),Q.current=!0}catch{}}return{leagues:t.leagues,gw:t.currentGw,latestGw:t.latestGw,gwPoints:(t.allGwPoints||[]).filter(d=>d.user_id===n),allGwPoints:t.allGwPoints||[],overall:t.overall||[],lastGwRank:t.lastGwRank||null,isInApiTestLeague:t.isInApiTestLeague||!1,fixtures:o,userPicks:m,fixturesLoading:w,loading:!1,leagueDataLoading:!1,leaderboardDataLoading:!1}}}catch{}return{leagues:[],gw:1,latestGw:null,gwPoints:[],allGwPoints:[],overall:[],lastGwRank:null,isInApiTestLeague:!1,fixtures:[],userPicks:{},fixturesLoading:!0,loading:!0,leagueDataLoading:!0,leaderboardDataLoading:!0}})(),[E,re]=h.useState(r.leagues),[X,ee]=h.useState({}),[k,z]=h.useState(r.gw),[I,N]=h.useState(r.latestGw),[B,te]=h.useState(r.gwPoints),[q,K]=h.useState(r.loading),[De,fe]=h.useState(r.leagueDataLoading),[tt,be]=h.useState(r.leaderboardDataLoading),[xe,st]=h.useState(r.lastGwRank),[Ve,at]=h.useState(null),[Pe,Fe]=h.useState(null),[Ae,He]=h.useState(null),[_e,Oe]=h.useState(r.allGwPoints),[se,ze]=h.useState(r.overall),[g,j]=h.useState({}),[O,U]=h.useState({}),[x,R]=h.useState(r.fixtures),[T,J]=h.useState(r.fixturesLoading),[Z,ye]=h.useState(r.isInApiTestLeague),[ne,oe]=h.useState(r.userPicks),[ie,Se]=h.useState(!1),ue=h.useRef(r.fixtures.length>0),Q=h.useRef(r.fixtures.length>0||r.isInApiTestLeague),we=h.useMemo(()=>{if(!x?.length)return[];const n=[];for(const i of x)i.api_match_id&&n.push(i.api_match_id);return n},[x]),he=h.useMemo(()=>{if(!x?.length||!s?.id)return new Map;try{const n=x[0]?.test_gw;if(!n)return new Map;const i=`home:fixtures:${s.id}:${n}`,t=Me(i);if(t?.liveScores&&Array.isArray(t.liveScores)){const o=new Map;return t.liveScores.forEach(m=>{m.api_match_id&&o.set(m.api_match_id,m)}),o}}catch{}return new Map},[x,s?.id]),{liveScores:p}=Mt(void 0,we.length>0?we:void 0),C=h.useMemo(()=>{const n=new Map(he);return p.forEach((i,t)=>{n.set(t,i)}),n},[he,p]);h.useEffect(()=>{if(!s?.id||!x.length||!C.size)return;const n=x[0]?.test_gw;if(!n)return;const i=`home:fixtures:${s.id}:${n}`;try{const t=Me(i);if(t){const o=[];C.forEach(m=>{o.push(m)}),Ye(i,{...t,liveScores:o.length>0?o:void 0},Ke.HOME)}}catch{}},[s?.id,x,C]);const y=h.useMemo(()=>{if(!x?.length||!C.size)return{};const n={};for(const i of x)if(i.api_match_id){const t=C.get(i.api_match_id);t&&(n[i.fixture_index]={homeScore:t.home_score??0,awayScore:t.away_score??0,status:t.status||"SCHEDULED",minute:t.minute??null,goals:t.goals??null,red_cards:t.red_cards??null,home_team:t.home_team??null,away_team:t.away_team??null})}return n},[C,x]);h.useEffect(()=>{if(!s?.id){K(!1),be(!1),fe(!1);return}let n=!0;const i=`home:basic:${s.id}`;return E.length>0&&!q||(K(!0),be(!0),fe(!0)),(async()=>{try{const[o,m,w,d,u,f]=await Promise.all([L.from("league_members").select("leagues(id, name, code, avatar, created_at)").eq("user_id",s.id),L.from("gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle(),L.from("meta").select("current_gw").eq("id",1).maybeSingle(),L.from("v_gw_points").select("user_id, gw, points").order("gw",{ascending:!0}),L.from("v_ocp_overall").select("user_id, name, ocp"),L.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle()]);if(!n)return;let c=[];o.error?re([]):(c=(o.data??[]).map(D=>D.leagues).filter(D=>D!==null),re(c),ye(c.some(D=>D.name==="API Test")));let b;if(!f.error&&f.data&&(b=f.data.current_test_gw??1,b&&b!==1)){const{data:D}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",b).limit(1).maybeSingle();if(!D){const{data:ae}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",1).limit(1).maybeSingle();ae&&(b=1)}}const W=m.data?.gw??w.data?.current_gw??1,S=w.data?.current_gw??1;z(S),N(S);let $=[],pe=null;if(d.error)Oe([]),te([]);else{$=d.data??[],Oe($),te($.filter(ae=>ae.user_id===s.id));const D=$.filter(ae=>ae.gw===W);if(D.length>0){const ae=[...D].sort((me,de)=>de.points-me.points);let ge=1;const qe=ae.map((me,de)=>(de>0&&ae[de-1].points!==me.points&&(ge=de+1),{...me,rank:ge})),Ne=qe.find(me=>me.user_id===s.id);if(Ne){const me=qe.filter(de=>de.rank===Ne.rank).length;pe={rank:Ne.rank,total:qe.length,score:Ne.points,gw:W,totalFixtures:10,isTied:me>1},st(pe)}}}let ce=[];u.error?ze([]):(ce=u.data??[],ze(ce));try{Ye(i,{leagues:c,currentGw:S,latestGw:S,allGwPoints:$,overall:ce,lastGwRank:pe,isInApiTestLeague:c.some(D=>D.name==="API Test"),testGw:b},Ke.HOME)}catch{}K(!1),be(!1)}catch{n&&(K(!1),be(!1))}})(),()=>{n=!1}},[s?.id]);const Y=h.useRef(""),M=h.useRef(""),P=h.useRef(null);h.useEffect(()=>{if(!s?.id||!I||!_e.length||!se.length)return;const n=JSON.stringify(_e.slice(0,10)),i=JSON.stringify(se.slice(0,10));if(Y.current===n&&M.current===i&&P.current===I)return;Y.current=n,M.current=i,P.current=I;let t=!0;return(async()=>{try{const{data:o}=await L.from("gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle(),m=o?.gw??I,w=(d,u,f)=>{if(u<d)return;const c=_e.filter(S=>S.gw>=d&&S.gw<=u),b=new Map;se.forEach(S=>{b.set(S.user_id,{user_id:S.user_id,name:S.name??"User",formPoints:0,weeksPlayed:new Set})}),c.forEach(S=>{const $=b.get(S.user_id);$&&($.formPoints+=S.points??0,$.weeksPlayed.add(S.gw))});const W=Array.from(b.values()).filter(S=>{for(let $=d;$<=u;$++)if(!S.weeksPlayed.has($))return!1;return!0}).sort((S,$)=>$.formPoints-S.formPoints||S.name.localeCompare($.name));if(W.length>0&&t){let S=1;const $=W.map((ce,D)=>(D>0&&W[D-1].formPoints!==ce.formPoints&&(S=D+1),{...ce,rank:S})),pe=$.find(ce=>ce.user_id===s.id);if(pe){const ce=$.filter(D=>D.rank===pe.rank).length;f({rank:pe.rank,total:$.length,isTied:ce>1})}}};if(m>=5&&w(m-4,m,at),m>=10&&w(m-9,m,Fe),se.length>0&&t){const d=[...se].sort((b,W)=>(W.ocp??0)-(b.ocp??0)||(b.name??"User").localeCompare(W.name??"User"));let u=1;const f=d.map((b,W)=>(W>0&&(d[W-1].ocp??0)!==(b.ocp??0)&&(u=W+1),{...b,rank:u})),c=f.find(b=>b.user_id===s.id);if(c){const b=f.filter(W=>W.rank===c.rank).length;He({rank:c.rank,total:se.length,isTied:b>1})}}}catch{}})(),()=>{t=!1}},[s?.id,I,_e,se]),h.useEffect(()=>{if(!s?.id||!E.length||!k){fe(!1);return}let n=!0;const i=`home:leagueData:${s.id}:${k}`;let t=!1;try{const o=Me(i);if(o&&o.leagueData&&Object.keys(o.leagueData).length>0){const m={};for(const[w,d]of Object.entries(o.leagueData))m[w]={...d,submittedMembers:d.submittedMembers?Array.isArray(d.submittedMembers)?new Set(d.submittedMembers):d.submittedMembers:void 0,latestGwWinners:d.latestGwWinners?Array.isArray(d.latestGwWinners)?new Set(d.latestGwWinners):d.latestGwWinners:void 0};U(m),ee(o.leagueSubmissions||{}),fe(!1),t=!0}}catch{}return(async()=>{try{if(!n)return;t||(U({}),fe(!0));const o=E.map(a=>a.id),[m,w,d,u,f]=await Promise.all([L.from("league_members").select("league_id, user_id, users!inner(id, name)").in("league_id",o),L.from("league_message_reads").select("league_id, last_read_at").eq("user_id",s.id).in("league_id",o),L.from("gw_submissions").select("user_id").eq("gw",k),L.from("gw_results").select("gw, fixture_index, result"),L.from("fixtures").select("gw, kickoff_time").in("gw",Array.from({length:Math.min(20,I||20)},(a,v)=>v+1))]);if(!n)return;const c={};(m.data??[]).forEach(a=>{c[a.league_id]||(c[a.league_id]=[]),c[a.league_id].push({id:a.users.id,name:a.users.name})});const b=new Set(Object.values(c).flat().map(a=>a.id)),W=new Set((d.data??[]).map(a=>a.user_id).filter(a=>b.has(a))),S=new Map;(w.data??[]).forEach(a=>{S.set(a.league_id,a.last_read_at)});const $=E.map(async a=>{const v=(c[a.id]??[]).map(Le=>Le.id);if(v.length===0)return{leagueId:a.id,picks:[]};const{data:G}=await L.from("picks").select("user_id, gw, fixture_index, pick").in("user_id",v);return{leagueId:a.id,picks:G??[]}}),pe=o.map(async a=>{const v=S.get(a)??"1970-01-01T00:00:00Z",{count:G}=await L.from("league_messages").select("id",{count:"exact",head:!0}).eq("league_id",a).gte("created_at",v).neq("user_id",s.id);return{leagueId:a,count:typeof G=="number"?G:0}}),[ce,D]=await Promise.all([Promise.all(pe),Promise.all($)]);if(!n)return;const ae=new Map;(u.data??[]).forEach(a=>{const v=$t(a);v&&ae.set(`${a.gw}:${a.fixture_index}`,v)});const ge=[...new Set(Array.from(ae.keys()).map(a=>parseInt(a.split(":")[0],10)))].sort((a,v)=>a-v),qe=(f.data??[]).filter(a=>ge.length>0?ge.includes(a.gw):a.gw===1),Ne={};ce.forEach(({leagueId:a,count:v})=>{Ne[a]=v}),j(Ne);const me=new Map;D.forEach(({leagueId:a,picks:v})=>{me.set(a,v)});const de=new Map;qe.forEach(a=>{if(a.kickoff_time&&a.gw){const v=new Date(a.kickoff_time),G=new Date(v.getTime()-4500*1e3);(!de.has(a.gw)||G<de.get(a.gw))&&de.set(a.gw,G)}});const Te=new Map;E.forEach(a=>{const v=a.name&&Gt[a.name];if(typeof v=="number"){Te.set(a.id,v);return}if(a.start_gw!==null&&a.start_gw!==void 0){Te.set(a.id,a.start_gw);return}if(a.created_at){const G=new Date(a.created_at);for(const Le of ge){const $e=de.get(Le);if($e&&G<=$e){Te.set(a.id,Le);return}}if(ge.length>0){Te.set(a.id,Math.max(...ge)+1);return}}Te.set(a.id,k)});const Ue={},nt={};E.forEach(a=>{const v=c[a.id]??[],G=v.map(l=>l.id),Le=G.filter(l=>W.has(l)).length,$e=G.length;if(nt[a.id]={allSubmitted:Le===$e&&$e>0,submittedCount:Le,totalCount:$e},ae.size===0){const l=v.sort((_,H)=>_.name.localeCompare(H.name));Ue[a.id]={id:a.id,members:l,userPosition:null,positionChange:null,submittedMembers:Array.from(G.filter(_=>W.has(_))),sortedMemberIds:l.map(_=>_.id),latestGwWinners:[],latestRelevantGw:null};return}const mt=Te.get(a.id)??k,je=mt===0?ge:ge.filter(l=>l>=mt);if(je.length===0){const l=v.sort((_,H)=>_.name.localeCompare(H.name));Ue[a.id]={id:a.id,members:l,userPosition:null,positionChange:null,submittedMembers:Array.from(G.filter(_=>W.has(_))),sortedMemberIds:l.map(_=>_.id),latestGwWinners:[],latestRelevantGw:null};return}const _t=me.get(a.id)??[],ft=new Set(je),yt=_t.filter(l=>ft.has(l.gw)),ot=new Map;je.forEach(l=>{ot.set(l,new Map)}),ae.forEach((l,_)=>{const[H,Ge]=_.split(":"),We=parseInt(H,10),F=parseInt(Ge,10);ft.has(We)&&ot.get(We)?.set(F,l)});const it=new Map,ht=new Map;je.forEach(l=>{const _=new Map;v.forEach(H=>_.set(H.id,{user_id:H.id,score:0,unicorns:0})),it.set(l,_)});const lt=new Map;yt.forEach(l=>{const _=`${l.gw}:${l.fixture_index}`,H=lt.get(_)??[];H.push(l),lt.set(_,H)});const vt=new Set(v.map(l=>l.id));je.forEach(l=>{const _=ot.get(l),H=it.get(l);_.forEach((Ge,We)=>{const F=`${l}:${We}`,Ze=(lt.get(F)??[]).filter(Ce=>vt.has(Ce.user_id)),dt=[];if(Ze.forEach(Ce=>{if(Ce.pick===Ge){const wt=H.get(Ce.user_id);wt&&(wt.score+=1,dt.push(Ce.user_id))}}),dt.length===1&&v.length>=3){const Ce=H.get(dt[0]);Ce&&(Ce.unicorns+=1)}})});const Ie=new Map,Xe=new Map,Je=new Map;v.forEach(l=>{Ie.set(l.id,0),Xe.set(l.id,0),Je.set(l.id,0)}),je.forEach(l=>{const _=Array.from(it.get(l).values());if(_.forEach(F=>{Xe.set(F.user_id,(Xe.get(F.user_id)??0)+F.score),Je.set(F.user_id,(Je.get(F.user_id)??0)+F.unicorns)}),_.sort((F,Ze)=>Ze.score-F.score||Ze.unicorns-F.unicorns),_.length===0)return;const H=_[0],Ge=_.filter(F=>F.score===H.score&&F.unicorns===H.unicorns),We=new Set(Ge.map(F=>F.user_id));ht.set(l,We),Ge.length===1?Ie.set(H.user_id,(Ie.get(H.user_id)??0)+3):Ge.forEach(F=>{Ie.set(F.user_id,(Ie.get(F.user_id)??0)+1)})});const gt=[...v.map(l=>({user_id:l.id,name:l.name,mltPts:Ie.get(l.id)??0,unicorns:Je.get(l.id)??0,ocp:Xe.get(l.id)??0}))].sort((l,_)=>_.mltPts-l.mltPts||_.unicorns-l.unicorns||_.ocp-l.ocp||l.name.localeCompare(_.name)),kt=gt.map(l=>l.user_id),xt=gt.findIndex(l=>l.user_id===s.id),jt=xt!==-1?xt+1:null,ct=je.length?Math.max(...je):null,Ct=ct!==null?ht.get(ct)??new Set:new Set,St=v.sort((l,_)=>l.name.localeCompare(_.name));Ue[a.id]={id:a.id,members:St,userPosition:jt,positionChange:null,submittedMembers:Array.from(G.filter(l=>W.has(l))),sortedMemberIds:kt,latestGwWinners:Array.from(Ct),latestRelevantGw:ct}}),ee(nt),U(Ue),fe(!1);try{const a={};for(const[v,G]of Object.entries(Ue))a[v]={...G,submittedMembers:G.submittedMembers?G.submittedMembers instanceof Set?Array.from(G.submittedMembers):G.submittedMembers:void 0,latestGwWinners:G.latestGwWinners?G.latestGwWinners instanceof Set?Array.from(G.latestGwWinners):G.latestGwWinners:void 0};Ye(i,{leagueData:a,leagueSubmissions:nt},Ke.HOME)}catch{}}catch{fe(!1)}})(),()=>{n=!1}},[s?.id,E,k]),h.useEffect(()=>{if(!s?.id||!Z){R([]),J(!1),oe({}),ue.current=!1;return}if(ue.current)return;if(x.length>0){(async()=>{try{const t=`home:basic:${s.id}`;let o;try{const f=Me(t);f?.testGw&&(o=f.testGw)}catch{}if(!o){const{data:f}=await L.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();o=f?.current_test_gw??1}if(o&&o!==1){const{data:f}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",o).limit(1).maybeSingle();if(!f){const{data:c}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",1).limit(1).maybeSingle();c&&(o=1)}}if(!o)return;const[m,w]=await Promise.all([L.from("test_api_fixtures").select("id, test_gw, fixture_index, api_match_id, home_code, away_code, home_team, away_team, home_name, away_name, home_crest, away_crest, kickoff_time").eq("test_gw",o).order("fixture_index",{ascending:!0}),L.from("test_api_picks").select("fixture_index, pick").eq("matchday",o).eq("user_id",s.id)]),d=m.error?[]:(m.data??[]).map(f=>({...f,gw:f.test_gw})),u={};if(w.error||(w.data??[]).forEach(f=>{u[f.fixture_index]=f.pick}),R(d),oe(u),o){const f=`home:fixtures:${s.id}:${o}`;try{const c=[];C.forEach(b=>{c.push(b)}),Ye(f,{fixtures:d,userPicks:u,liveScores:c.length>0?c:void 0},Ke.HOME)}catch{}}}catch(t){console.error("[Home] Error refreshing fixtures:",t)}})();return}let n=!0,i=!1;return(async()=>{try{const{data:t}=await L.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let o=t?.current_test_gw??1;if(o&&o!==1){const{data:c}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",o).limit(1).maybeSingle();if(!c){const{data:b}=await L.from("test_api_fixtures").select("test_gw").eq("test_gw",1).limit(1).maybeSingle();b&&(o=1)}}if(!o){R([]),J(!1),oe({}),Q.current=!0;return}const m=`home:fixtures:${s.id}:${o}`;try{const c=Me(m);c&&c.fixtures&&Array.isArray(c.fixtures)&&c.fixtures.length>0?(console.log("[Home] ✅ Loading fixtures from cache:",c.fixtures.length,"fixtures"),R(c.fixtures),oe(c.userPicks||{}),J(!1),i=!0,ue.current=!0,Q.current=!0):(console.log("[Home] ⚠️ No valid fixtures cache found, will fetch fresh data"),Q.current=!0)}catch(c){console.warn("[Home] Error loading fixtures from cache, fetching fresh data:",c)}i||J(!0);const[w,d]=await Promise.all([L.from("test_api_fixtures").select("id, test_gw, fixture_index, api_match_id, home_code, away_code, home_team, away_team, home_name, away_name, home_crest, away_crest, kickoff_time").eq("test_gw",o).order("fixture_index",{ascending:!0}),L.from("test_api_picks").select("fixture_index, pick").eq("matchday",o).eq("user_id",s.id)]);if(!n)return;const u=w.error?[]:(w.data??[]).map(c=>({...c,gw:c.test_gw})),f={};d.error||(d.data??[]).forEach(c=>{f[c.fixture_index]=c.pick}),R(u),oe(f),J(!1),ue.current=!1,Q.current=!0;try{Ye(m,{fixtures:u,userPicks:f},Ke.HOME),console.log("[Home] ✅ Cached fixtures for next time:",u.length,"fixtures")}catch(c){console.warn("[Home] Failed to cache fixtures:",c)}}catch{n&&(R([]),J(!1),oe({}),Q.current=!0)}})(),()=>{n=!1}},[s?.id,Z]);const le=h.useMemo(()=>{if(!Z||!x.length)return null;const n=Object.keys(ne).length>0;let i=0,t=0,o=0,m=!0,w=!1;for(const u of x){const f=y[u.fixture_index],c=ne[u.fixture_index],b=f?.status;b==="IN_PLAY"||b==="PAUSED"||b==="FINISHED"?(w=!0,(b==="IN_PLAY"||b==="PAUSED")&&t++,b==="FINISHED"&&o++,b!=="FINISHED"&&(m=!1),c&&f&&(c==="H"&&f.homeScore>f.awayScore||c==="A"&&f.awayScore>f.homeScore||c==="D"&&f.homeScore===f.awayScore)&&i++):m=!1}if(!w&&!n)return null;const d=({score:u,label:f,bgColor:c,icon:b})=>e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-white ${c}`,children:[b,e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:f}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-lg sm:text-xl font-extrabold",children:u}),e.jsx("span",{className:"text-sm sm:text-base font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-base sm:text-lg font-semibold opacity-80",children:x.length})]})]});return!w&&n?e.jsx(d,{score:"--",label:"Score",bgColor:"bg-amber-500 shadow-lg shadow-amber-500/30"}):t===0&&o>0&&!m?e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx(d,{score:i,label:"Score",bgColor:"bg-slate-600",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})}):e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx(d,{score:i,label:m?"Score":"Live",bgColor:m?"bg-slate-600":"bg-red-600",icon:m?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}):t>0?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}):void 0})})},[Z,x,y,ne]),Ee=h.useMemo(()=>{if(!x.length)return!1;for(const n of x){const i=y[n.fixture_index];if(i&&(i.status==="IN_PLAY"||i.status==="PAUSED"))return!0}return!1},[x,y]),ve=h.useMemo(()=>{if(!s?.id||!I)return null;const n=B.filter(d=>d.user_id===s.id).sort((d,u)=>u.gw-d.gw);if(n.length===0)return null;let i=0,t=I;const o=new Set(n.map(d=>d.gw));for(;t>=1&&o.has(t);)i++,t--;const m=[],w=Math.max(1,I-9);for(let d=I;d>=w;d--){const u=n.find(f=>f.gw===d);m.push({gw:d,score:u?u.points:null})}return{streak:i,last10GwScores:m.reverse()}},[s?.id,B,I]),Re=h.useMemo(()=>E.length?[...E].sort((n,i)=>{const t=g?.[n.id]??0,o=g?.[i.id]??0;return t>0&&o===0?-1:t===0&&o>0?1:n.name.localeCompare(i.name)}):[],[E,g]),Be=h.useMemo(()=>ie?x.filter(n=>{const i=y[n.fixture_index];return i&&(i.status==="IN_PLAY"||i.status==="PAUSED")}):x,[x,y,ie]),ke=h.useMemo(()=>Be.map(n=>{const i={id:n.id,gw:n.gw,fixture_index:n.fixture_index,home_code:n.home_code,away_code:n.away_code,home_team:n.home_team,away_team:n.away_team,home_name:n.home_name,away_name:n.away_name,kickoff_time:n.kickoff_time,api_match_id:n.api_match_id??null},t=y[n.fixture_index],o=t?{status:t.status,minute:t.minute??null,homeScore:t.homeScore,awayScore:t.awayScore,home_team:t.home_team??null,away_team:t.away_team??null,goals:t.goals??void 0,red_cards:t.red_cards??void 0}:null;return{fixture:i,liveScore:o,pick:ne[n.fixture_index]}}),[Be,y,ne]),rt=!q&&!tt&&!De;return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pt-2 pb-4 min-h-screen relative",children:[e.jsx(Pt,{}),rt?e.jsxs(e.Fragment,{children:[e.jsx(pt,{title:"LEADERBOARDS - COMPONENT HP",children:e.jsxs("div",{className:"overflow-x-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",touchAction:"pan-x pan-y pinch-zoom",marginLeft:"-1rem",marginRight:"-1rem",paddingLeft:"1rem",paddingRight:"1rem",width:"calc(100% + 3rem)"},children:[e.jsx("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),e.jsxs("div",{className:"flex gap-2",style:{width:"max-content",minWidth:"100%"},children:[e.jsx(et,{title:"Last GW",linkTo:"/global?tab=lastgw",rank:xe?.rank??null,total:xe?.total??null,score:xe?.score,gw:xe?.gw,totalFixtures:xe?.totalFixtures,variant:"lastGw"}),e.jsx(et,{title:"5-WEEK FORM",badgeSrc:"/assets/5-week-form-badge.png",badgeAlt:"5-Week Form Badge",linkTo:"/global?tab=form5",rank:Ve?.rank??null,total:Ve?.total??null}),e.jsx(et,{title:"10-WEEK FORM",badgeSrc:"/assets/10-week-form-badge.png",badgeAlt:"10-Week Form Badge",linkTo:"/global?tab=form10",rank:Pe?.rank??null,total:Pe?.total??null}),e.jsx(et,{title:"SEASON RANK",badgeSrc:"/assets/season-rank-badge.png",badgeAlt:"Season Rank Badge",linkTo:"/global?tab=overall",rank:Ae?.rank??null,total:Ae?.total??null}),ve&&e.jsx(At,{streak:ve.streak,last10GwScores:ve.last10GwScores,latestGw:I??1})]})]})}),e.jsxs("section",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 pt-5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base font-medium text-slate-500 uppercase tracking-wide",children:"Mini Leagues"}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-400 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] text-slate-500 font-bold",children:"i"})})]})}),e.jsx("div",{children:!De&&E.length===0?e.jsxs("div",{className:"p-6 bg-white rounded-lg border border-slate-200 text-center",children:[e.jsx("div",{className:"text-slate-600 mb-3",children:"You don't have any mini leagues yet."}),e.jsx(ut,{to:"/create-league",className:"inline-block px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg hover:bg-[#1C8376]/80 transition-colors no-underline",children:"Create one now!"})]}):Re.length>0?e.jsxs("div",{className:"overflow-x-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",overscrollBehaviorY:"auto",touchAction:"pan-x pan-y pinch-zoom",marginLeft:"-1rem",marginRight:"-1rem",paddingLeft:"1rem",paddingRight:"1rem",width:"calc(100% + 2rem)"},children:[e.jsx("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),e.jsx("div",{className:"flex gap-2",style:{width:"max-content",minWidth:"100%"},children:Array.from({length:Math.ceil(Re.length/3)}).map((n,i)=>{const t=i*3,o=Re.slice(t,t+3);return e.jsx("div",{className:"flex flex-col rounded-xl border bg-white overflow-hidden shadow-sm w-[320px]",children:o.map((m,w)=>{const d=g?.[m.id]??0,u=O[m.id],f=u?{id:u.id,members:u.members,userPosition:u.userPosition,positionChange:u.positionChange,submittedMembers:u.submittedMembers,sortedMemberIds:u.sortedMemberIds,latestGwWinners:u.latestGwWinners,latestRelevantGw:u.latestRelevantGw}:void 0;return e.jsxs("div",{className:w<o.length-1?"relative":"",children:[w<o.length-1&&e.jsx("div",{className:"absolute bottom-0 left-4 right-4 h-px bg-slate-200 z-30 pointer-events-none"}),e.jsx("div",{className:"[&>div]:border-0 [&>div]:shadow-none [&>div]:rounded-none [&>div]:bg-transparent relative z-20 [&>div>a]:!p-4",children:e.jsx(Lt,{row:m,data:f,unread:d,submissions:X[m.id],leagueDataLoading:De,currentGw:k,showRanking:!1})})]},m.id)})},i)})})]}):e.jsx("div",{className:"p-6 bg-white rounded-lg border border-slate-200 text-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading leagues..."})})})]}),e.jsx(pt,{title:"Games",subtitle:Z&&x.length>0?`GW T${x[0]?.test_gw??1}`:void 0,className:"mt-6",headerRight:e.jsxs("div",{className:"flex items-center gap-3",children:[Ee&&e.jsx(Tt,{value:ie,onChange:Se}),le]}),children:!Q.current||T?e.jsx("div",{className:"p-4 text-slate-500",children:"Loading fixtures..."}):x.length===0?e.jsx("div",{className:"p-4 text-slate-500",children:"No fixtures yet."}):x.length>0?e.jsx("div",{className:"flex flex-col rounded-xl border bg-white overflow-hidden shadow-sm",children:ke.map(({fixture:n,liveScore:i,pick:t},o)=>e.jsxs("div",{className:o<ke.length-1?"relative":"",children:[o<ke.length-1&&e.jsx("div",{className:"absolute bottom-0 left-4 right-4 h-px bg-slate-200 z-10"}),e.jsx(Rt,{fixture:n,pick:t,liveScore:i,isTestApi:Z,showPickButtons:!0})]},n.id))}):null}),e.jsx("div",{className:"h-20"})]}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})]})}export{Bt as default};
