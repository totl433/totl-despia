import{g as Ir,r as P,s as hn,C as mn,a as se,b as Oe,j as s,V as Ur,c as nr,u as rr,i as Fr,d as Dn,T as Pn,D as zr,e as Or,f as Wr,h as Hr,k as tn,l as $r,m as Br,n as Gr,L as In,o as St,p as nn,q as Un,I as Fn,t as zn}from"./index-BXZWcz4C.js";function qr(l,h){return h.forEach((function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if(n!=="default"&&!(n in l)){var e=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(l,n,e.get?e:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(l)}function sr(l,h){return new Promise((function(t,n){let e;return Vr(l).then((function(r){try{return e=r,t(new Blob([h.slice(0,2),e,h.slice(2)],{type:"image/jpeg"}))}catch(a){return n(a)}}),n)}))}const Vr=l=>new Promise(((h,t)=>{const n=new FileReader;n.addEventListener("load",(({target:{result:e}})=>{const r=new DataView(e);let a=0;if(r.getUint16(a)!==65496)return t("not a valid JPEG");for(a+=2;;){const d=r.getUint16(a);if(d===65498)break;const x=r.getUint16(a+2);if(d===65505&&r.getUint32(a+4)===1165519206){const v=a+10;let i;switch(r.getUint16(v)){case 18761:i=!0;break;case 19789:i=!1;break;default:return t("TIFF header contains invalid endian")}if(r.getUint16(v+2,i)!==42)return t("TIFF header contains invalid version");const o=r.getUint32(v+4,i),c=v+o+2+12*r.getUint16(v+o,i);for(let f=v+o+2;f<c;f+=12)if(r.getUint16(f,i)==274){if(r.getUint16(f+2,i)!==3)return t("Orientation data type is invalid");if(r.getUint32(f+4,i)!==1)return t("Orientation data count is invalid");r.setUint16(f+8,1,i);break}return h(e.slice(a,a+2+x))}a+=2+x}return h(new Blob)})),n.readAsArrayBuffer(l)}));var zt={},Kr={get exports(){return zt},set exports(l){zt=l}};(function(l){var h,t,n={};Kr.exports=n,n.parse=function(e,r){for(var a=n.bin.readUshort,d=n.bin.readUint,x=0,v={},i=new Uint8Array(e),o=i.length-4;d(i,o)!=101010256;)o--;x=o,x+=4;var c=a(i,x+=4);a(i,x+=2);var f=d(i,x+=2),p=d(i,x+=4);x+=4,x=p;for(var k=0;k<c;k++){d(i,x),x+=4,x+=4,x+=4,d(i,x+=4),f=d(i,x+=4);var S=d(i,x+=4),_=a(i,x+=4),I=a(i,x+2),O=a(i,x+4);x+=6;var F=d(i,x+=8);x+=4,x+=_+I+O,n._readLocal(i,F,v,f,S,r)}return v},n._readLocal=function(e,r,a,d,x,v){var i=n.bin.readUshort,o=n.bin.readUint;o(e,r),i(e,r+=4),i(e,r+=2);var c=i(e,r+=2);o(e,r+=2),o(e,r+=4),r+=4;var f=i(e,r+=8),p=i(e,r+=2);r+=2;var k=n.bin.readUTF8(e,r,f);if(r+=f,r+=p,v)a[k]={size:x,csize:d};else{var S=new Uint8Array(e.buffer,r);if(c==0)a[k]=new Uint8Array(S.buffer.slice(r,r+d));else{if(c!=8)throw"unknown compression method: "+c;var _=new Uint8Array(x);n.inflateRaw(S,_),a[k]=_}}},n.inflateRaw=function(e,r){return n.F.inflate(e,r)},n.inflate=function(e,r){return e[0],e[1],n.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),r)},n.deflate=function(e,r){r==null&&(r={level:6});var a=0,d=new Uint8Array(50+Math.floor(1.1*e.length));d[a]=120,d[a+1]=156,a+=2,a=n.F.deflateRaw(e,d,a,r.level);var x=n.adler(e,0,e.length);return d[a+0]=x>>>24&255,d[a+1]=x>>>16&255,d[a+2]=x>>>8&255,d[a+3]=x>>>0&255,new Uint8Array(d.buffer,0,a+4)},n.deflateRaw=function(e,r){r==null&&(r={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),d=n.F.deflateRaw(e,a,d,r.level);return new Uint8Array(a.buffer,0,d)},n.encode=function(e,r){r==null&&(r=!1);var a=0,d=n.bin.writeUint,x=n.bin.writeUshort,v={};for(var i in e){var o=!n._noNeed(i)&&!r,c=e[i],f=n.crc.crc(c,0,c.length);v[i]={cpr:o,usize:c.length,crc:f,file:o?n.deflateRaw(c):c}}for(var i in v)a+=v[i].file.length+30+46+2*n.bin.sizeUTF8(i);a+=22;var p=new Uint8Array(a),k=0,S=[];for(var i in v){var _=v[i];S.push(k),k=n._writeHeader(p,k,i,_,0)}var I=0,O=k;for(var i in v)_=v[i],S.push(k),k=n._writeHeader(p,k,i,_,1,S[I++]);var F=k-O;return d(p,k,101010256),k+=4,x(p,k+=4,I),x(p,k+=2,I),d(p,k+=2,F),d(p,k+=4,O),k+=4,k+=2,p.buffer},n._noNeed=function(e){var r=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(r)!=-1},n._writeHeader=function(e,r,a,d,x,v){var i=n.bin.writeUint,o=n.bin.writeUshort,c=d.file;return i(e,r,x==0?67324752:33639248),r+=4,x==1&&(r+=2),o(e,r,20),o(e,r+=2,0),o(e,r+=2,d.cpr?8:0),i(e,r+=2,0),i(e,r+=4,d.crc),i(e,r+=4,c.length),i(e,r+=4,d.usize),o(e,r+=4,n.bin.sizeUTF8(a)),o(e,r+=2,0),r+=2,x==1&&(r+=2,r+=2,i(e,r+=6,v),r+=4),r+=n.bin.writeUTF8(e,r,a),x==0&&(e.set(c,r),r+=c.length),r},n.crc={table:(function(){for(var e=new Uint32Array(256),r=0;r<256;r++){for(var a=r,d=0;d<8;d++)1&a?a=3988292384^a>>>1:a>>>=1;e[r]=a}return e})(),update:function(e,r,a,d){for(var x=0;x<d;x++)e=n.crc.table[255&(e^r[a+x])]^e>>>8;return e},crc:function(e,r,a){return 4294967295^n.crc.update(4294967295,e,r,a)}},n.adler=function(e,r,a){for(var d=1,x=0,v=r,i=r+a;v<i;){for(var o=Math.min(v+5552,i);v<o;)x+=d+=e[v++];d%=65521,x%=65521}return x<<16|d},n.bin={readUshort:function(e,r){return e[r]|e[r+1]<<8},writeUshort:function(e,r,a){e[r]=255&a,e[r+1]=a>>8&255},readUint:function(e,r){return 16777216*e[r+3]+(e[r+2]<<16|e[r+1]<<8|e[r])},writeUint:function(e,r,a){e[r]=255&a,e[r+1]=a>>8&255,e[r+2]=a>>16&255,e[r+3]=a>>24&255},readASCII:function(e,r,a){for(var d="",x=0;x<a;x++)d+=String.fromCharCode(e[r+x]);return d},writeASCII:function(e,r,a){for(var d=0;d<a.length;d++)e[r+d]=a.charCodeAt(d)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,r,a){for(var d,x="",v=0;v<a;v++)x+="%"+n.bin.pad(e[r+v].toString(16));try{d=decodeURIComponent(x)}catch{return n.bin.readASCII(e,r,a)}return d},writeUTF8:function(e,r,a){for(var d=a.length,x=0,v=0;v<d;v++){var i=a.charCodeAt(v);if((4294967168&i)==0)e[r+x]=i,x++;else if((4294965248&i)==0)e[r+x]=192|i>>6,e[r+x+1]=128|i>>0&63,x+=2;else if((4294901760&i)==0)e[r+x]=224|i>>12,e[r+x+1]=128|i>>6&63,e[r+x+2]=128|i>>0&63,x+=3;else{if((4292870144&i)!=0)throw"e";e[r+x]=240|i>>18,e[r+x+1]=128|i>>12&63,e[r+x+2]=128|i>>6&63,e[r+x+3]=128|i>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var r=e.length,a=0,d=0;d<r;d++){var x=e.charCodeAt(d);if((4294967168&x)==0)a++;else if((4294965248&x)==0)a+=2;else if((4294901760&x)==0)a+=3;else{if((4292870144&x)!=0)throw"e";a+=4}}return a}},n.F={},n.F.deflateRaw=function(e,r,a,d){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],v=n.F.U,i=n.F._goodIndex;n.F._hash;var o=n.F._putsE,c=0,f=a<<3,p=0,k=e.length;if(d==0){for(;c<k;)o(r,f,c+(M=Math.min(65535,k-c))==k?1:0),f=n.F._copyExact(e,c,M,r,f+8),c+=M;return f>>>3}var S=v.lits,_=v.strt,I=v.prev,O=0,F=0,z=0,y=0,B=0,b=0;for(k>2&&(_[b=n.F._hash(e,0)]=0),c=0;c<k;c++){if(B=b,c+1<k-2){b=n.F._hash(e,c+1);var w=c+1&32767;I[w]=_[b],_[b]=w}if(p<=c){(O>14e3||F>26697)&&k-c>100&&(p<c&&(S[O]=c-p,O+=2,p=c),f=n.F._writeBlock(c==k-1||p==k?1:0,S,O,y,e,z,c-z,r,f),O=F=y=0,z=c);var A=0;c<k-2&&(A=n.F._bestMatch(e,c,I,B,Math.min(x[2],k-c),x[3]));var M=A>>>16,L=65535&A;if(A!=0){L=65535&A;var U=i(M=A>>>16,v.of0);v.lhst[257+U]++;var R=i(L,v.df0);v.dhst[R]++,y+=v.exb[U]+v.dxb[R],S[O]=M<<23|c-p,S[O+1]=L<<16|U<<8|R,O+=2,p=c+M}else v.lhst[e[c]]++;F++}}for(z==c&&e.length!=0||(p<c&&(S[O]=c-p,O+=2,p=c),f=n.F._writeBlock(1,S,O,y,e,z,c-z,r,f),O=0,F=0,O=F=y=0,z=c);(7&f)!=0;)f++;return f>>>3},n.F._bestMatch=function(e,r,a,d,x,v){var i=32767&r,o=a[i],c=i-o+32768&32767;if(o==i||d!=n.F._hash(e,r-c))return 0;for(var f=0,p=0,k=Math.min(32767,r);c<=k&&--v!=0&&o!=i;){if(f==0||e[r+f]==e[r+f-c]){var S=n.F._howLong(e,r,c);if(S>f){if(p=c,(f=S)>=x)break;c+2<S&&(S=c+2);for(var _=0,I=0;I<S-2;I++){var O=r-c+I+32768&32767,F=O-a[O]+32768&32767;F>_&&(_=F,o=O)}}}c+=(i=o)-(o=a[i])+32768&32767}return f<<16|p},n.F._howLong=function(e,r,a){if(e[r]!=e[r-a]||e[r+1]!=e[r+1-a]||e[r+2]!=e[r+2-a])return 0;var d=r,x=Math.min(e.length,r+258);for(r+=3;r<x&&e[r]==e[r-a];)r++;return r-d},n.F._hash=function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(e,r,a,d,x,v,i,o,c){var f,p,k,S,_,I,O,F,z,y=n.F.U,B=n.F._putsF,b=n.F._putsE;y.lhst[256]++,p=(f=n.F.getTrees())[0],k=f[1],S=f[2],_=f[3],I=f[4],O=f[5],F=f[6],z=f[7];var w=32+((c+3&7)==0?0:8-(c+3&7))+(i<<3),A=d+n.F.contSize(y.fltree,y.lhst)+n.F.contSize(y.fdtree,y.dhst),M=d+n.F.contSize(y.ltree,y.lhst)+n.F.contSize(y.dtree,y.dhst);M+=14+3*O+n.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var L=0;L<286;L++)y.lhst[L]=0;for(L=0;L<30;L++)y.dhst[L]=0;for(L=0;L<19;L++)y.ihst[L]=0;var U=w<A&&w<M?0:A<M?1:2;if(B(o,c,e),B(o,c+1,U),c+=3,U==0){for(;(7&c)!=0;)c++;c=n.F._copyExact(x,v,i,o,c)}else{var R,C;if(U==1&&(R=y.fltree,C=y.fdtree),U==2){n.F.makeCodes(y.ltree,p),n.F.revCodes(y.ltree,p),n.F.makeCodes(y.dtree,k),n.F.revCodes(y.dtree,k),n.F.makeCodes(y.itree,S),n.F.revCodes(y.itree,S),R=y.ltree,C=y.dtree,b(o,c,_-257),b(o,c+=5,I-1),b(o,c+=5,O-4),c+=4;for(var g=0;g<O;g++)b(o,c+3*g,y.itree[1+(y.ordr[g]<<1)]);c+=3*O,c=n.F._codeTiny(F,y.itree,o,c),c=n.F._codeTiny(z,y.itree,o,c)}for(var u=v,W=0;W<a;W+=2){for(var m=r[W],E=m>>>23,G=u+(8388607&m);u<G;)c=n.F._writeLit(x[u++],R,o,c);if(E!=0){var H=r[W+1],D=H>>16,T=H>>8&255,j=255&H;b(o,c=n.F._writeLit(257+T,R,o,c),E-y.of0[T]),c+=y.exb[T],B(o,c=n.F._writeLit(j,C,o,c),D-y.df0[j]),c+=y.dxb[j],u+=E}}c=n.F._writeLit(256,R,o,c)}return c},n.F._copyExact=function(e,r,a,d,x){var v=x>>>3;return d[v]=a,d[v+1]=a>>>8,d[v+2]=255-d[v],d[v+3]=255-d[v+1],v+=4,d.set(new Uint8Array(e.buffer,r,a),v),x+(a+4<<3)},n.F.getTrees=function(){for(var e=n.F.U,r=n.F._hufTree(e.lhst,e.ltree,15),a=n.F._hufTree(e.dhst,e.dtree,15),d=[],x=n.F._lenCodes(e.ltree,d),v=[],i=n.F._lenCodes(e.dtree,v),o=0;o<d.length;o+=2)e.ihst[d[o]]++;for(o=0;o<v.length;o+=2)e.ihst[v[o]]++;for(var c=n.F._hufTree(e.ihst,e.itree,7),f=19;f>4&&e.itree[1+(e.ordr[f-1]<<1)]==0;)f--;return[r,a,c,x,i,f,d,v]},n.F.getSecond=function(e){for(var r=[],a=0;a<e.length;a+=2)r.push(e[a+1]);return r},n.F.nonZero=function(e){for(var r="",a=0;a<e.length;a+=2)e[a+1]!=0&&(r+=(a>>1)+",");return r},n.F.contSize=function(e,r){for(var a=0,d=0;d<r.length;d++)a+=r[d]*e[1+(d<<1)];return a},n.F._codeTiny=function(e,r,a,d){for(var x=0;x<e.length;x+=2){var v=e[x],i=e[x+1];d=n.F._writeLit(v,r,a,d);var o=v==16?2:v==17?3:7;v>15&&(n.F._putsE(a,d,i,o),d+=o)}return d},n.F._lenCodes=function(e,r){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var d=0;d<a;d+=2){var x=e[d+1],v=d+3<a?e[d+3]:-1,i=d+5<a?e[d+5]:-1,o=d==0?-1:e[d-1];if(x==0&&v==x&&i==x){for(var c=d+5;c+2<a&&e[c+2]==x;)c+=2;(f=Math.min(c+1-d>>>1,138))<11?r.push(17,f-3):r.push(18,f-11),d+=2*f-2}else if(x==o&&v==x&&i==x){for(c=d+5;c+2<a&&e[c+2]==x;)c+=2;var f=Math.min(c+1-d>>>1,6);r.push(16,f-3),d+=2*f-2}else r.push(x,0)}return a>>>1},n.F._hufTree=function(e,r,a){var d=[],x=e.length,v=r.length,i=0;for(i=0;i<v;i+=2)r[i]=0,r[i+1]=0;for(i=0;i<x;i++)e[i]!=0&&d.push({lit:i,f:e[i]});var o=d.length,c=d.slice(0);if(o==0)return 0;if(o==1){var f=d[0].lit;return c=f==0?1:0,r[1+(f<<1)]=1,r[1+(c<<1)]=1,1}d.sort((function(F,z){return F.f-z.f}));var p=d[0],k=d[1],S=0,_=1,I=2;for(d[0]={lit:-1,f:p.f+k.f,l:p,r:k,d:0};_!=o-1;)p=S!=_&&(I==o||d[S].f<d[I].f)?d[S++]:d[I++],k=S!=_&&(I==o||d[S].f<d[I].f)?d[S++]:d[I++],d[_++]={lit:-1,f:p.f+k.f,l:p,r:k};var O=n.F.setDepth(d[_-1],0);for(O>a&&(n.F.restrictDepth(c,a,O),O=a),i=0;i<o;i++)r[1+(c[i].lit<<1)]=c[i].d;return O},n.F.setDepth=function(e,r){return e.lit!=-1?(e.d=r,r):Math.max(n.F.setDepth(e.l,r+1),n.F.setDepth(e.r,r+1))},n.F.restrictDepth=function(e,r,a){var d=0,x=1<<a-r,v=0;for(e.sort((function(o,c){return c.d==o.d?o.f-c.f:c.d-o.d})),d=0;d<e.length&&e[d].d>r;d++){var i=e[d].d;e[d].d=r,v+=x-(1<<a-i)}for(v>>>=a-r;v>0;)(i=e[d].d)<r?(e[d].d++,v-=1<<r-i-1):d++;for(;d>=0;d--)e[d].d==r&&v<0&&(e[d].d--,v++);v!=0&&console.log("debt left")},n.F._goodIndex=function(e,r){var a=0;return r[16|a]<=e&&(a|=16),r[8|a]<=e&&(a|=8),r[4|a]<=e&&(a|=4),r[2|a]<=e&&(a|=2),r[1|a]<=e&&(a|=1),a},n.F._writeLit=function(e,r,a,d){return n.F._putsF(a,d,r[e<<1]),d+r[1+(e<<1)]},n.F.inflate=function(e,r){var a=Uint8Array;if(e[0]==3&&e[1]==0)return r||new a(0);var d=n.F,x=d._bitsF,v=d._bitsE,i=d._decodeTiny,o=d.makeCodes,c=d.codes2map,f=d._get17,p=d.U,k=r==null;k&&(r=new a(e.length>>>2<<3));for(var S,_,I=0,O=0,F=0,z=0,y=0,B=0,b=0,w=0,A=0;I==0;)if(I=x(e,A,1),O=x(e,A+1,2),A+=3,O!=0){if(k&&(r=n.F._check(r,w+(1<<17))),O==1&&(S=p.flmap,_=p.fdmap,B=511,b=31),O==2){F=v(e,A,5)+257,z=v(e,A+5,5)+1,y=v(e,A+10,4)+4,A+=14;for(var M=0;M<38;M+=2)p.itree[M]=0,p.itree[M+1]=0;var L=1;for(M=0;M<y;M++){var U=v(e,A+3*M,3);p.itree[1+(p.ordr[M]<<1)]=U,U>L&&(L=U)}A+=3*y,o(p.itree,L),c(p.itree,L,p.imap),S=p.lmap,_=p.dmap,A=i(p.imap,(1<<L)-1,F+z,e,A,p.ttree);var R=d._copyOut(p.ttree,0,F,p.ltree);B=(1<<R)-1;var C=d._copyOut(p.ttree,F,z,p.dtree);b=(1<<C)-1,o(p.ltree,R),c(p.ltree,R,S),o(p.dtree,C),c(p.dtree,C,_)}for(;;){var g=S[f(e,A)&B];A+=15&g;var u=g>>>4;if(!(u>>>8))r[w++]=u;else{if(u==256)break;var W=w+u-254;if(u>264){var m=p.ldef[u-257];W=w+(m>>>3)+v(e,A,7&m),A+=7&m}var E=_[f(e,A)&b];A+=15&E;var G=E>>>4,H=p.ddef[G],D=(H>>>4)+x(e,A,15&H);for(A+=15&H,k&&(r=n.F._check(r,w+(1<<17)));w<W;)r[w]=r[w++-D],r[w]=r[w++-D],r[w]=r[w++-D],r[w]=r[w++-D];w=W}}}else{(7&A)!=0&&(A+=8-(7&A));var T=4+(A>>>3),j=e[T-4]|e[T-3]<<8;k&&(r=n.F._check(r,w+j)),r.set(new a(e.buffer,e.byteOffset+T,j),w),A=T+j<<3,w+=j}return r.length==w?r:r.slice(0,w)},n.F._check=function(e,r){var a=e.length;if(r<=a)return e;var d=new Uint8Array(Math.max(a<<1,r));return d.set(e,0),d},n.F._decodeTiny=function(e,r,a,d,x,v){for(var i=n.F._bitsE,o=n.F._get17,c=0;c<a;){var f=e[o(d,x)&r];x+=15&f;var p=f>>>4;if(p<=15)v[c]=p,c++;else{var k=0,S=0;p==16?(S=3+i(d,x,2),x+=2,k=v[c-1]):p==17?(S=3+i(d,x,3),x+=3):p==18&&(S=11+i(d,x,7),x+=7);for(var _=c+S;c<_;)v[c]=k,c++}}return x},n.F._copyOut=function(e,r,a,d){for(var x=0,v=0,i=d.length>>>1;v<a;){var o=e[v+r];d[v<<1]=0,d[1+(v<<1)]=o,o>x&&(x=o),v++}for(;v<i;)d[v<<1]=0,d[1+(v<<1)]=0,v++;return x},n.F.makeCodes=function(e,r){for(var a,d,x,v,i=n.F.U,o=e.length,c=i.bl_count,f=0;f<=r;f++)c[f]=0;for(f=1;f<o;f+=2)c[e[f]]++;var p=i.next_code;for(a=0,c[0]=0,d=1;d<=r;d++)a=a+c[d-1]<<1,p[d]=a;for(x=0;x<o;x+=2)(v=e[x+1])!=0&&(e[x]=p[v],p[v]++)},n.F.codes2map=function(e,r,a){for(var d=e.length,x=n.F.U.rev15,v=0;v<d;v+=2)if(e[v+1]!=0)for(var i=v>>1,o=e[v+1],c=i<<4|o,f=r-o,p=e[v]<<f,k=p+(1<<f);p!=k;)a[x[p]>>>15-r]=c,p++},n.F.revCodes=function(e,r){for(var a=n.F.U.rev15,d=15-r,x=0;x<e.length;x+=2){var v=e[x]<<r-e[x+1];e[x]=a[v]>>>d}},n.F._putsE=function(e,r,a){a<<=7&r;var d=r>>>3;e[d]|=a,e[d+1]|=a>>>8},n.F._putsF=function(e,r,a){a<<=7&r;var d=r>>>3;e[d]|=a,e[d+1]|=a>>>8,e[d+2]|=a>>>16},n.F._bitsE=function(e,r,a){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<a)-1},n.F._bitsF=function(e,r,a){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<a)-1},n.F._get17=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},n.F._get25=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},n.F.U=(h=Uint16Array,t=Uint32Array,{next_code:new h(16),bl_count:new h(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new h(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new h(512),fltree:[],fdmap:new h(32),fdtree:[],lmap:new h(32768),ltree:[],ttree:[],dmap:new h(32768),dtree:[],imap:new h(512),itree:[],rev15:new h(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new h(65536),prev:new h(32768)}),(function(){for(var e=n.F.U,r=0;r<32768;r++){var a=r;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[r]=(a>>>16|a<<16)>>>17}function d(x,v,i){for(;v--!=0;)x.push(0,i)}for(r=0;r<32;r++)e.ldef[r]=e.of0[r]<<3|e.exb[r],e.ddef[r]=e.df0[r]<<4|e.dxb[r];d(e.fltree,144,8),d(e.fltree,112,9),d(e.fltree,24,7),d(e.fltree,8,8),n.F.makeCodes(e.fltree,9),n.F.codes2map(e.fltree,9,e.flmap),n.F.revCodes(e.fltree,9),d(e.fdtree,32,5),n.F.makeCodes(e.fdtree,5),n.F.codes2map(e.fdtree,5,e.fdmap),n.F.revCodes(e.fdtree,5),d(e.itree,19,0),d(e.ltree,286,0),d(e.dtree,30,0),d(e.ttree,320,0)})()})();var Yr=qr({__proto__:null,default:zt},[zt]);const dt=(function(){var l={nextZero(i,o){for(;i[o]!=0;)o++;return o},readUshort:(i,o)=>i[o]<<8|i[o+1],writeUshort(i,o,c){i[o]=c>>8&255,i[o+1]=255&c},readUint:(i,o)=>16777216*i[o]+(i[o+1]<<16|i[o+2]<<8|i[o+3]),writeUint(i,o,c){i[o]=c>>24&255,i[o+1]=c>>16&255,i[o+2]=c>>8&255,i[o+3]=255&c},readASCII(i,o,c){let f="";for(let p=0;p<c;p++)f+=String.fromCharCode(i[o+p]);return f},writeASCII(i,o,c){for(let f=0;f<c.length;f++)i[o+f]=c.charCodeAt(f)},readBytes(i,o,c){const f=[];for(let p=0;p<c;p++)f.push(i[o+p]);return f},pad:i=>i.length<2?`0${i}`:i,readUTF8(i,o,c){let f,p="";for(let k=0;k<c;k++)p+=`%${l.pad(i[o+k].toString(16))}`;try{f=decodeURIComponent(p)}catch{return l.readASCII(i,o,c)}return f}};function h(i,o,c,f){const p=o*c,k=r(f),S=Math.ceil(o*k/8),_=new Uint8Array(4*p),I=new Uint32Array(_.buffer),{ctype:O}=f,{depth:F}=f,z=l.readUshort;if(O==6){const m=p<<2;if(F==8)for(var y=0;y<m;y+=4)_[y]=i[y],_[y+1]=i[y+1],_[y+2]=i[y+2],_[y+3]=i[y+3];if(F==16)for(y=0;y<m;y++)_[y]=i[y<<1]}else if(O==2){const m=f.tabs.tRNS;if(m==null){if(F==8)for(y=0;y<p;y++){var B=3*y;I[y]=255<<24|i[B+2]<<16|i[B+1]<<8|i[B]}if(F==16)for(y=0;y<p;y++)B=6*y,I[y]=255<<24|i[B+4]<<16|i[B+2]<<8|i[B]}else{var b=m[0];const E=m[1],G=m[2];if(F==8)for(y=0;y<p;y++){var w=y<<2;B=3*y,I[y]=255<<24|i[B+2]<<16|i[B+1]<<8|i[B],i[B]==b&&i[B+1]==E&&i[B+2]==G&&(_[w+3]=0)}if(F==16)for(y=0;y<p;y++)w=y<<2,B=6*y,I[y]=255<<24|i[B+4]<<16|i[B+2]<<8|i[B],z(i,B)==b&&z(i,B+2)==E&&z(i,B+4)==G&&(_[w+3]=0)}}else if(O==3){const m=f.tabs.PLTE,E=f.tabs.tRNS,G=E?E.length:0;if(F==1)for(var A=0;A<c;A++){var M=A*S,L=A*o;for(y=0;y<o;y++){w=L+y<<2;var U=3*(R=i[M+(y>>3)]>>7-((7&y)<<0)&1);_[w]=m[U],_[w+1]=m[U+1],_[w+2]=m[U+2],_[w+3]=R<G?E[R]:255}}if(F==2)for(A=0;A<c;A++)for(M=A*S,L=A*o,y=0;y<o;y++)w=L+y<<2,U=3*(R=i[M+(y>>2)]>>6-((3&y)<<1)&3),_[w]=m[U],_[w+1]=m[U+1],_[w+2]=m[U+2],_[w+3]=R<G?E[R]:255;if(F==4)for(A=0;A<c;A++)for(M=A*S,L=A*o,y=0;y<o;y++)w=L+y<<2,U=3*(R=i[M+(y>>1)]>>4-((1&y)<<2)&15),_[w]=m[U],_[w+1]=m[U+1],_[w+2]=m[U+2],_[w+3]=R<G?E[R]:255;if(F==8)for(y=0;y<p;y++){var R;w=y<<2,U=3*(R=i[y]),_[w]=m[U],_[w+1]=m[U+1],_[w+2]=m[U+2],_[w+3]=R<G?E[R]:255}}else if(O==4){if(F==8)for(y=0;y<p;y++){w=y<<2;var C=i[g=y<<1];_[w]=C,_[w+1]=C,_[w+2]=C,_[w+3]=i[g+1]}if(F==16)for(y=0;y<p;y++){var g;w=y<<2,C=i[g=y<<2],_[w]=C,_[w+1]=C,_[w+2]=C,_[w+3]=i[g+2]}}else if(O==0)for(b=f.tabs.tRNS?f.tabs.tRNS:-1,A=0;A<c;A++){const m=A*S,E=A*o;if(F==1)for(var u=0;u<o;u++){var W=(C=255*(i[m+(u>>>3)]>>>7-(7&u)&1))==255*b?0:255;I[E+u]=W<<24|C<<16|C<<8|C}else if(F==2)for(u=0;u<o;u++)W=(C=85*(i[m+(u>>>2)]>>>6-((3&u)<<1)&3))==85*b?0:255,I[E+u]=W<<24|C<<16|C<<8|C;else if(F==4)for(u=0;u<o;u++)W=(C=17*(i[m+(u>>>1)]>>>4-((1&u)<<2)&15))==17*b?0:255,I[E+u]=W<<24|C<<16|C<<8|C;else if(F==8)for(u=0;u<o;u++)W=(C=i[m+u])==b?0:255,I[E+u]=W<<24|C<<16|C<<8|C;else if(F==16)for(u=0;u<o;u++)C=i[m+(u<<1)],W=z(i,m+(u<<1))==b?0:255,I[E+u]=W<<24|C<<16|C<<8|C}return _}function t(i,o,c,f){const p=r(i),k=Math.ceil(c*p/8),S=new Uint8Array((k+1+i.interlace)*f);return o=i.tabs.CgBI?e(o,S):n(o,S),i.interlace==0?o=a(o,i,0,c,f):i.interlace==1&&(o=(function(I,O){const F=O.width,z=O.height,y=r(O),B=y>>3,b=Math.ceil(F*y/8),w=new Uint8Array(z*b);let A=0;const M=[0,0,4,0,2,0,1],L=[0,4,0,2,0,1,0],U=[8,8,8,4,4,2,2],R=[8,8,4,4,2,2,1];let C=0;for(;C<7;){const u=U[C],W=R[C];let m=0,E=0,G=M[C];for(;G<z;)G+=u,E++;let H=L[C];for(;H<F;)H+=W,m++;const D=Math.ceil(m*y/8);a(I,O,A,m,E);let T=0,j=M[C];for(;j<z;){let J=L[C],Z=A+T*D<<3;for(;J<F;){var g;if(y==1&&(g=(g=I[Z>>3])>>7-(7&Z)&1,w[j*b+(J>>3)]|=g<<7-((7&J)<<0)),y==2&&(g=(g=I[Z>>3])>>6-(7&Z)&3,w[j*b+(J>>2)]|=g<<6-((3&J)<<1)),y==4&&(g=(g=I[Z>>3])>>4-(7&Z)&15,w[j*b+(J>>1)]|=g<<4-((1&J)<<2)),y>=8){const X=j*b+J*B;for(let ae=0;ae<B;ae++)w[X+ae]=I[(Z>>3)+ae]}Z+=y,J+=W}T++,j+=u}m*E!=0&&(A+=E*(1+D)),C+=1}return w})(o,i)),o}function n(i,o){return e(new Uint8Array(i.buffer,2,i.length-6),o)}var e=(function(){const i={H:{}};return i.H.N=function(o,c){const f=Uint8Array;let p,k,S=0,_=0,I=0,O=0,F=0,z=0,y=0,B=0,b=0;if(o[0]==3&&o[1]==0)return c||new f(0);const w=i.H,A=w.b,M=w.e,L=w.R,U=w.n,R=w.A,C=w.Z,g=w.m,u=c==null;for(u&&(c=new f(o.length>>>2<<5));S==0;)if(S=A(o,b,1),_=A(o,b+1,2),b+=3,_!=0){if(u&&(c=i.H.W(c,B+(1<<17))),_==1&&(p=g.J,k=g.h,z=511,y=31),_==2){I=M(o,b,5)+257,O=M(o,b+5,5)+1,F=M(o,b+10,4)+4,b+=14;let m=1;for(var W=0;W<38;W+=2)g.Q[W]=0,g.Q[W+1]=0;for(W=0;W<F;W++){const H=M(o,b+3*W,3);g.Q[1+(g.X[W]<<1)]=H,H>m&&(m=H)}b+=3*F,U(g.Q,m),R(g.Q,m,g.u),p=g.w,k=g.d,b=L(g.u,(1<<m)-1,I+O,o,b,g.v);const E=w.V(g.v,0,I,g.C);z=(1<<E)-1;const G=w.V(g.v,I,O,g.D);y=(1<<G)-1,U(g.C,E),R(g.C,E,p),U(g.D,G),R(g.D,G,k)}for(;;){const m=p[C(o,b)&z];b+=15&m;const E=m>>>4;if(!(E>>>8))c[B++]=E;else{if(E==256)break;{let G=B+E-254;if(E>264){const J=g.q[E-257];G=B+(J>>>3)+M(o,b,7&J),b+=7&J}const H=k[C(o,b)&y];b+=15&H;const D=H>>>4,T=g.c[D],j=(T>>>4)+A(o,b,15&T);for(b+=15&T;B<G;)c[B]=c[B++-j],c[B]=c[B++-j],c[B]=c[B++-j],c[B]=c[B++-j];B=G}}}}else{(7&b)!=0&&(b+=8-(7&b));const m=4+(b>>>3),E=o[m-4]|o[m-3]<<8;u&&(c=i.H.W(c,B+E)),c.set(new f(o.buffer,o.byteOffset+m,E),B),b=m+E<<3,B+=E}return c.length==B?c:c.slice(0,B)},i.H.W=function(o,c){const f=o.length;if(c<=f)return o;const p=new Uint8Array(f<<1);return p.set(o,0),p},i.H.R=function(o,c,f,p,k,S){const _=i.H.e,I=i.H.Z;let O=0;for(;O<f;){const F=o[I(p,k)&c];k+=15&F;const z=F>>>4;if(z<=15)S[O]=z,O++;else{let y=0,B=0;z==16?(B=3+_(p,k,2),k+=2,y=S[O-1]):z==17?(B=3+_(p,k,3),k+=3):z==18&&(B=11+_(p,k,7),k+=7);const b=O+B;for(;O<b;)S[O]=y,O++}}return k},i.H.V=function(o,c,f,p){let k=0,S=0;const _=p.length>>>1;for(;S<f;){const I=o[S+c];p[S<<1]=0,p[1+(S<<1)]=I,I>k&&(k=I),S++}for(;S<_;)p[S<<1]=0,p[1+(S<<1)]=0,S++;return k},i.H.n=function(o,c){const f=i.H.m,p=o.length;let k,S,_,I;const O=f.j;for(var F=0;F<=c;F++)O[F]=0;for(F=1;F<p;F+=2)O[o[F]]++;const z=f.K;for(k=0,O[0]=0,S=1;S<=c;S++)k=k+O[S-1]<<1,z[S]=k;for(_=0;_<p;_+=2)I=o[_+1],I!=0&&(o[_]=z[I],z[I]++)},i.H.A=function(o,c,f){const p=o.length,k=i.H.m.r;for(let S=0;S<p;S+=2)if(o[S+1]!=0){const _=S>>1,I=o[S+1],O=_<<4|I,F=c-I;let z=o[S]<<F;const y=z+(1<<F);for(;z!=y;)f[k[z]>>>15-c]=O,z++}},i.H.l=function(o,c){const f=i.H.m.r,p=15-c;for(let k=0;k<o.length;k+=2){const S=o[k]<<c-o[k+1];o[k]=f[S]>>>p}},i.H.M=function(o,c,f){f<<=7&c;const p=c>>>3;o[p]|=f,o[p+1]|=f>>>8},i.H.I=function(o,c,f){f<<=7&c;const p=c>>>3;o[p]|=f,o[p+1]|=f>>>8,o[p+2]|=f>>>16},i.H.e=function(o,c,f){return(o[c>>>3]|o[1+(c>>>3)]<<8)>>>(7&c)&(1<<f)-1},i.H.b=function(o,c,f){return(o[c>>>3]|o[1+(c>>>3)]<<8|o[2+(c>>>3)]<<16)>>>(7&c)&(1<<f)-1},i.H.Z=function(o,c){return(o[c>>>3]|o[1+(c>>>3)]<<8|o[2+(c>>>3)]<<16)>>>(7&c)},i.H.i=function(o,c){return(o[c>>>3]|o[1+(c>>>3)]<<8|o[2+(c>>>3)]<<16|o[3+(c>>>3)]<<24)>>>(7&c)},i.H.m=(function(){const o=Uint16Array,c=Uint32Array;return{K:new o(16),j:new o(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new o(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new c(32),J:new o(512),_:[],h:new o(32),$:[],w:new o(32768),C:[],v:[],d:new o(32768),D:[],u:new o(512),Q:[],r:new o(32768),s:new c(286),Y:new c(30),a:new c(19),t:new c(15e3),k:new o(65536),g:new o(32768)}})(),(function(){const o=i.H.m;for(var c=0;c<32768;c++){let p=c;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,o.r[c]=(p>>>16|p<<16)>>>17}function f(p,k,S){for(;k--!=0;)p.push(0,S)}for(c=0;c<32;c++)o.q[c]=o.S[c]<<3|o.T[c],o.c[c]=o.p[c]<<4|o.z[c];f(o._,144,8),f(o._,112,9),f(o._,24,7),f(o._,8,8),i.H.n(o._,9),i.H.A(o._,9,o.J),i.H.l(o._,9),f(o.$,32,5),i.H.n(o.$,5),i.H.A(o.$,5,o.h),i.H.l(o.$,5),f(o.Q,19,0),f(o.C,286,0),f(o.D,30,0),f(o.v,320,0)})(),i.H.N})();function r(i){return[1,null,3,1,2,null,4][i.ctype]*i.depth}function a(i,o,c,f,p){let k=r(o);const S=Math.ceil(f*k/8);let _,I;k=Math.ceil(k/8);let O=i[c],F=0;if(O>1&&(i[c]=[0,0,1][O-2]),O==3)for(F=k;F<S;F++)i[F+1]=i[F+1]+(i[F+1-k]>>>1)&255;for(let z=0;z<p;z++)if(_=c+z*S,I=_+z+1,O=i[I-1],F=0,O==0)for(;F<S;F++)i[_+F]=i[I+F];else if(O==1){for(;F<k;F++)i[_+F]=i[I+F];for(;F<S;F++)i[_+F]=i[I+F]+i[_+F-k]}else if(O==2)for(;F<S;F++)i[_+F]=i[I+F]+i[_+F-S];else if(O==3){for(;F<k;F++)i[_+F]=i[I+F]+(i[_+F-S]>>>1);for(;F<S;F++)i[_+F]=i[I+F]+(i[_+F-S]+i[_+F-k]>>>1)}else{for(;F<k;F++)i[_+F]=i[I+F]+d(0,i[_+F-S],0);for(;F<S;F++)i[_+F]=i[I+F]+d(i[_+F-k],i[_+F-S],i[_+F-k-S])}return i}function d(i,o,c){const f=i+o-c,p=f-i,k=f-o,S=f-c;return p*p<=k*k&&p*p<=S*S?i:k*k<=S*S?o:c}function x(i,o,c){c.width=l.readUint(i,o),o+=4,c.height=l.readUint(i,o),o+=4,c.depth=i[o],o++,c.ctype=i[o],o++,c.compress=i[o],o++,c.filter=i[o],o++,c.interlace=i[o],o++}function v(i,o,c,f,p,k,S,_,I){const O=Math.min(o,p),F=Math.min(c,k);let z=0,y=0;for(let C=0;C<F;C++)for(let g=0;g<O;g++)if(S>=0&&_>=0?(z=C*o+g<<2,y=(_+C)*p+S+g<<2):(z=(-_+C)*o-S+g<<2,y=C*p+g<<2),I==0)f[y]=i[z],f[y+1]=i[z+1],f[y+2]=i[z+2],f[y+3]=i[z+3];else if(I==1){var B=i[z+3]*.00392156862745098,b=i[z]*B,w=i[z+1]*B,A=i[z+2]*B,M=f[y+3]*(1/255),L=f[y]*M,U=f[y+1]*M,R=f[y+2]*M;const u=1-B,W=B+M*u,m=W==0?0:1/W;f[y+3]=255*W,f[y+0]=(b+L*u)*m,f[y+1]=(w+U*u)*m,f[y+2]=(A+R*u)*m}else if(I==2)B=i[z+3],b=i[z],w=i[z+1],A=i[z+2],M=f[y+3],L=f[y],U=f[y+1],R=f[y+2],B==M&&b==L&&w==U&&A==R?(f[y]=0,f[y+1]=0,f[y+2]=0,f[y+3]=0):(f[y]=b,f[y+1]=w,f[y+2]=A,f[y+3]=B);else if(I==3){if(B=i[z+3],b=i[z],w=i[z+1],A=i[z+2],M=f[y+3],L=f[y],U=f[y+1],R=f[y+2],B==M&&b==L&&w==U&&A==R)continue;if(B<220&&M>20)return!1}return!0}return{decode:function(o){const c=new Uint8Array(o);let f=8;const p=l,k=p.readUshort,S=p.readUint,_={tabs:{},frames:[]},I=new Uint8Array(c.length);let O,F=0,z=0;const y=[137,80,78,71,13,10,26,10];for(var B=0;B<8;B++)if(c[B]!=y[B])throw"The input is not a PNG file!";for(;f<c.length;){const C=p.readUint(c,f);f+=4;const g=p.readASCII(c,f,4);if(f+=4,g=="IHDR")x(c,f,_);else if(g=="iCCP"){for(var b=f;c[b]!=0;)b++;p.readASCII(c,f,b-f),c[b+1];const u=c.slice(b+2,f+C);let W=null;try{W=n(u)}catch{W=e(u)}_.tabs[g]=W}else if(g=="CgBI")_.tabs[g]=c.slice(f,f+4);else if(g=="IDAT"){for(B=0;B<C;B++)I[F+B]=c[f+B];F+=C}else if(g=="acTL")_.tabs[g]={num_frames:S(c,f),num_plays:S(c,f+4)},O=new Uint8Array(c.length);else if(g=="fcTL"){z!=0&&((R=_.frames[_.frames.length-1]).data=t(_,O.slice(0,z),R.rect.width,R.rect.height),z=0);const u={x:S(c,f+12),y:S(c,f+16),width:S(c,f+4),height:S(c,f+8)};let W=k(c,f+22);W=k(c,f+20)/(W==0?100:W);const m={rect:u,delay:Math.round(1e3*W),dispose:c[f+24],blend:c[f+25]};_.frames.push(m)}else if(g=="fdAT"){for(B=0;B<C-4;B++)O[z+B]=c[f+B+4];z+=C-4}else if(g=="pHYs")_.tabs[g]=[p.readUint(c,f),p.readUint(c,f+4),c[f+8]];else if(g=="cHRM")for(_.tabs[g]=[],B=0;B<8;B++)_.tabs[g].push(p.readUint(c,f+4*B));else if(g=="tEXt"||g=="zTXt"){_.tabs[g]==null&&(_.tabs[g]={});var w=p.nextZero(c,f),A=p.readASCII(c,f,w-f),M=f+C-w-1;if(g=="tEXt")U=p.readASCII(c,w+1,M);else{var L=n(c.slice(w+2,w+2+M));U=p.readUTF8(L,0,L.length)}_.tabs[g][A]=U}else if(g=="iTXt"){_.tabs[g]==null&&(_.tabs[g]={}),w=0,b=f,w=p.nextZero(c,b),A=p.readASCII(c,b,w-b);const u=c[b=w+1];var U;c[b+1],b+=2,w=p.nextZero(c,b),p.readASCII(c,b,w-b),b=w+1,w=p.nextZero(c,b),p.readUTF8(c,b,w-b),M=C-((b=w+1)-f),u==0?U=p.readUTF8(c,b,M):(L=n(c.slice(b,b+M)),U=p.readUTF8(L,0,L.length)),_.tabs[g][A]=U}else if(g=="PLTE")_.tabs[g]=p.readBytes(c,f,C);else if(g=="hIST"){const u=_.tabs.PLTE.length/3;for(_.tabs[g]=[],B=0;B<u;B++)_.tabs[g].push(k(c,f+2*B))}else if(g=="tRNS")_.ctype==3?_.tabs[g]=p.readBytes(c,f,C):_.ctype==0?_.tabs[g]=k(c,f):_.ctype==2&&(_.tabs[g]=[k(c,f),k(c,f+2),k(c,f+4)]);else if(g=="gAMA")_.tabs[g]=p.readUint(c,f)/1e5;else if(g=="sRGB")_.tabs[g]=c[f];else if(g=="bKGD")_.ctype==0||_.ctype==4?_.tabs[g]=[k(c,f)]:_.ctype==2||_.ctype==6?_.tabs[g]=[k(c,f),k(c,f+2),k(c,f+4)]:_.ctype==3&&(_.tabs[g]=c[f]);else if(g=="IEND")break;f+=C,p.readUint(c,f),f+=4}var R;return z!=0&&((R=_.frames[_.frames.length-1]).data=t(_,O.slice(0,z),R.rect.width,R.rect.height)),_.data=t(_,I,_.width,_.height),delete _.compress,delete _.interlace,delete _.filter,_},toRGBA8:function(o){const c=o.width,f=o.height;if(o.tabs.acTL==null)return[h(o.data,c,f,o).buffer];const p=[];o.frames[0].data==null&&(o.frames[0].data=o.data);const k=c*f*4,S=new Uint8Array(k),_=new Uint8Array(k),I=new Uint8Array(k);for(let F=0;F<o.frames.length;F++){const z=o.frames[F],y=z.rect.x,B=z.rect.y,b=z.rect.width,w=z.rect.height,A=h(z.data,b,w,o);if(F!=0)for(var O=0;O<k;O++)I[O]=S[O];if(z.blend==0?v(A,b,w,S,c,f,y,B,0):z.blend==1&&v(A,b,w,S,c,f,y,B,1),p.push(S.buffer.slice(0)),z.dispose!=0){if(z.dispose==1)v(_,b,w,S,c,f,y,B,0);else if(z.dispose==2)for(O=0;O<k;O++)S[O]=I[O]}}return p},_paeth:d,_copyTile:v,_bin:l}})();(function(){const{_copyTile:l}=dt,{_bin:h}=dt,t=dt._paeth;var n={table:(function(){const b=new Uint32Array(256);for(let w=0;w<256;w++){let A=w;for(let M=0;M<8;M++)1&A?A=3988292384^A>>>1:A>>>=1;b[w]=A}return b})(),update(b,w,A,M){for(let L=0;L<M;L++)b=n.table[255&(b^w[A+L])]^b>>>8;return b},crc:(b,w,A)=>4294967295^n.update(4294967295,b,w,A)};function e(b,w,A,M){w[A]+=b[0]*M>>4,w[A+1]+=b[1]*M>>4,w[A+2]+=b[2]*M>>4,w[A+3]+=b[3]*M>>4}function r(b){return Math.max(0,Math.min(255,b))}function a(b,w){const A=b[0]-w[0],M=b[1]-w[1],L=b[2]-w[2],U=b[3]-w[3];return A*A+M*M+L*L+U*U}function d(b,w,A,M,L,U,R){R==null&&(R=1);const C=M.length,g=[];for(var u=0;u<C;u++){const j=M[u];g.push([j>>>0&255,j>>>8&255,j>>>16&255,j>>>24&255])}for(u=0;u<C;u++){let j=4294967295;for(var W=0,m=0;m<C;m++){var E=a(g[u],g[m]);m!=u&&E<j&&(j=E,W=m)}}const G=new Uint32Array(L.buffer),H=new Int16Array(w*A*4),D=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(u=0;u<D.length;u++)D[u]=255*((D[u]+.5)/16-.5);for(let j=0;j<A;j++)for(let J=0;J<w;J++){var T;u=4*(j*w+J),R!=2?T=[r(b[u]+H[u]),r(b[u+1]+H[u+1]),r(b[u+2]+H[u+2]),r(b[u+3]+H[u+3])]:(E=D[4*(3&j)+(3&J)],T=[r(b[u]+E),r(b[u+1]+E),r(b[u+2]+E),r(b[u+3]+E)]),W=0;let Z=16777215;for(m=0;m<C;m++){const ie=a(T,g[m]);ie<Z&&(Z=ie,W=m)}const X=g[W],ae=[T[0]-X[0],T[1]-X[1],T[2]-X[2],T[3]-X[3]];R==1&&(J!=w-1&&e(ae,H,u+4,7),j!=A-1&&(J!=0&&e(ae,H,u+4*w-4,3),e(ae,H,u+4*w,5),J!=w-1&&e(ae,H,u+4*w+4,1))),U[u>>2]=W,G[u>>2]=M[W]}}function x(b,w,A,M,L){L==null&&(L={});const{crc:U}=n,R=h.writeUint,C=h.writeUshort,g=h.writeASCII;let u=8;const W=b.frames.length>1;let m,E=!1,G=33+(W?20:0);if(L.sRGB!=null&&(G+=13),L.pHYs!=null&&(G+=21),L.iCCP!=null&&(m=pako.deflate(L.iCCP),G+=21+m.length+4),b.ctype==3){for(var H=b.plte.length,D=0;D<H;D++)b.plte[D]>>>24!=255&&(E=!0);G+=8+3*H+4+(E?8+1*H+4:0)}for(var T=0;T<b.frames.length;T++)W&&(G+=38),G+=(X=b.frames[T]).cimg.length+12,T!=0&&(G+=4);G+=12;const j=new Uint8Array(G),J=[137,80,78,71,13,10,26,10];for(D=0;D<8;D++)j[D]=J[D];if(R(j,u,13),u+=4,g(j,u,"IHDR"),u+=4,R(j,u,w),u+=4,R(j,u,A),u+=4,j[u]=b.depth,u++,j[u]=b.ctype,u++,j[u]=0,u++,j[u]=0,u++,j[u]=0,u++,R(j,u,U(j,u-17,17)),u+=4,L.sRGB!=null&&(R(j,u,1),u+=4,g(j,u,"sRGB"),u+=4,j[u]=L.sRGB,u++,R(j,u,U(j,u-5,5)),u+=4),L.iCCP!=null){const ae=13+m.length;R(j,u,ae),u+=4,g(j,u,"iCCP"),u+=4,g(j,u,"ICC profile"),u+=11,u+=2,j.set(m,u),u+=m.length,R(j,u,U(j,u-(ae+4),ae+4)),u+=4}if(L.pHYs!=null&&(R(j,u,9),u+=4,g(j,u,"pHYs"),u+=4,R(j,u,L.pHYs[0]),u+=4,R(j,u,L.pHYs[1]),u+=4,j[u]=L.pHYs[2],u++,R(j,u,U(j,u-13,13)),u+=4),W&&(R(j,u,8),u+=4,g(j,u,"acTL"),u+=4,R(j,u,b.frames.length),u+=4,R(j,u,L.loop!=null?L.loop:0),u+=4,R(j,u,U(j,u-12,12)),u+=4),b.ctype==3){for(R(j,u,3*(H=b.plte.length)),u+=4,g(j,u,"PLTE"),u+=4,D=0;D<H;D++){const ae=3*D,ie=b.plte[D],ue=255&ie,ge=ie>>>8&255,xe=ie>>>16&255;j[u+ae+0]=ue,j[u+ae+1]=ge,j[u+ae+2]=xe}if(u+=3*H,R(j,u,U(j,u-3*H-4,3*H+4)),u+=4,E){for(R(j,u,H),u+=4,g(j,u,"tRNS"),u+=4,D=0;D<H;D++)j[u+D]=b.plte[D]>>>24&255;u+=H,R(j,u,U(j,u-H-4,H+4)),u+=4}}let Z=0;for(T=0;T<b.frames.length;T++){var X=b.frames[T];W&&(R(j,u,26),u+=4,g(j,u,"fcTL"),u+=4,R(j,u,Z++),u+=4,R(j,u,X.rect.width),u+=4,R(j,u,X.rect.height),u+=4,R(j,u,X.rect.x),u+=4,R(j,u,X.rect.y),u+=4,C(j,u,M[T]),u+=2,C(j,u,1e3),u+=2,j[u]=X.dispose,u++,j[u]=X.blend,u++,R(j,u,U(j,u-30,30)),u+=4);const ae=X.cimg;R(j,u,(H=ae.length)+(T==0?0:4)),u+=4;const ie=u;g(j,u,T==0?"IDAT":"fdAT"),u+=4,T!=0&&(R(j,u,Z++),u+=4),j.set(ae,u),u+=H,R(j,u,U(j,ie,u-ie)),u+=4}return R(j,u,0),u+=4,g(j,u,"IEND"),u+=4,R(j,u,U(j,u-4,4)),u+=4,j.buffer}function v(b,w,A){for(let M=0;M<b.frames.length;M++){const L=b.frames[M];L.rect.width;const U=L.rect.height,R=new Uint8Array(U*L.bpl+U);L.cimg=f(L.img,U,L.bpp,L.bpl,R,w,A)}}function i(b,w,A,M,L){const U=L[0],R=L[1],C=L[2],g=L[3],u=L[4],W=L[5];let m=6,E=8,G=255;for(var H=0;H<b.length;H++){const be=new Uint8Array(b[H]);for(var D=be.length,T=0;T<D;T+=4)G&=be[T+3]}const j=G!=255,J=(function(ve,ye,De,Se,_e,Me){const Ae=[];for(var pe=0;pe<ve.length;pe++){const Fe=new Uint8Array(ve[pe]),Ve=new Uint32Array(Fe.buffer);var qe;let Ge=0,Ye=0,et=ye,ze=De,ht=Se?1:0;if(pe!=0){const Gt=Me||Se||pe==1||Ae[pe-2].dispose!=0?1:2;let vt=0,Tt=1e9;for(let mt=0;mt<Gt;mt++){var Be=new Uint8Array(ve[pe-1-mt]);const Et=new Uint32Array(ve[pe-1-mt]);let ot=ye,tt=De,nt=-1,yt=-1;for(let pt=0;pt<De;pt++)for(let lt=0;lt<ye;lt++)Ve[Re=pt*ye+lt]!=Et[Re]&&(lt<ot&&(ot=lt),lt>nt&&(nt=lt),pt<tt&&(tt=pt),pt>yt&&(yt=pt));nt==-1&&(ot=tt=nt=yt=0),_e&&((1&ot)==1&&ot--,(1&tt)==1&&tt--);const Ct=(nt-ot+1)*(yt-tt+1);Ct<Tt&&(Tt=Ct,vt=mt,Ge=ot,Ye=tt,et=nt-ot+1,ze=yt-tt+1)}Be=new Uint8Array(ve[pe-1-vt]),vt==1&&(Ae[pe-1].dispose=2),qe=new Uint8Array(et*ze*4),l(Be,ye,De,qe,et,ze,-Ge,-Ye,0),ht=l(Fe,ye,De,qe,et,ze,-Ge,-Ye,3)?1:0,ht==1?c(Fe,ye,De,qe,{x:Ge,y:Ye,width:et,height:ze}):l(Fe,ye,De,qe,et,ze,-Ge,-Ye,0)}else qe=Fe.slice(0);Ae.push({rect:{x:Ge,y:Ye,width:et,height:ze},img:qe,blend:ht,dispose:0})}if(Se)for(pe=0;pe<Ae.length;pe++){if((ft=Ae[pe]).blend==1)continue;const Fe=ft.rect,Ve=Ae[pe-1].rect,Ge=Math.min(Fe.x,Ve.x),Ye=Math.min(Fe.y,Ve.y),et={x:Ge,y:Ye,width:Math.max(Fe.x+Fe.width,Ve.x+Ve.width)-Ge,height:Math.max(Fe.y+Fe.height,Ve.y+Ve.height)-Ye};Ae[pe-1].dispose=1,pe-1!=0&&o(ve,ye,De,Ae,pe-1,et,_e),o(ve,ye,De,Ae,pe,et,_e)}let Xe=0;if(ve.length!=1)for(var Re=0;Re<Ae.length;Re++){var ft;Xe+=(ft=Ae[Re]).rect.width*ft.rect.height}return Ae})(b,w,A,U,R,C),Z={},X=[],ae=[];if(M!=0){const be=[];for(T=0;T<J.length;T++)be.push(J[T].img.buffer);const ve=(function(_e){let Me=0;for(var Ae=0;Ae<_e.length;Ae++)Me+=_e[Ae].byteLength;const pe=new Uint8Array(Me);let qe=0;for(Ae=0;Ae<_e.length;Ae++){const Be=new Uint8Array(_e[Ae]),Xe=Be.length;for(let Re=0;Re<Xe;Re+=4){let ft=Be[Re],Fe=Be[Re+1],Ve=Be[Re+2];const Ge=Be[Re+3];Ge==0&&(ft=Fe=Ve=0),pe[qe+Re]=ft,pe[qe+Re+1]=Fe,pe[qe+Re+2]=Ve,pe[qe+Re+3]=Ge}qe+=Xe}return pe.buffer})(be),ye=k(ve,M);for(T=0;T<ye.plte.length;T++)X.push(ye.plte[T].est.rgba);let De=0;for(T=0;T<J.length;T++){const Se=(ue=J[T]).img.length;var ie=new Uint8Array(ye.inds.buffer,De>>2,Se>>2);ae.push(ie);const _e=new Uint8Array(ye.abuf,De,Se);W&&d(ue.img,ue.rect.width,ue.rect.height,X,_e,ie),ue.img.set(_e),De+=Se}}else for(H=0;H<J.length;H++){var ue=J[H];const be=new Uint32Array(ue.img.buffer);var ge=ue.rect.width;for(D=be.length,ie=new Uint8Array(D),ae.push(ie),T=0;T<D;T++){const ve=be[T];if(T!=0&&ve==be[T-1])ie[T]=ie[T-1];else if(T>ge&&ve==be[T-ge])ie[T]=ie[T-ge];else{let ye=Z[ve];if(ye==null&&(Z[ve]=ye=X.length,X.push(ve),X.length>=300))break;ie[T]=ye}}}const xe=X.length;for(xe<=256&&u==0&&(E=xe<=2?1:xe<=4?2:xe<=16?4:8,E=Math.max(E,g)),H=0;H<J.length;H++){(ue=J[H]).rect.x,ue.rect.y,ge=ue.rect.width;const be=ue.rect.height;let ve=ue.img;new Uint32Array(ve.buffer);let ye=4*ge,De=4;if(xe<=256&&u==0){ye=Math.ceil(E*ge/8);var he=new Uint8Array(ye*be);const Se=ae[H];for(let _e=0;_e<be;_e++){T=_e*ye;const Me=_e*ge;if(E==8)for(var Ce=0;Ce<ge;Ce++)he[T+Ce]=Se[Me+Ce];else if(E==4)for(Ce=0;Ce<ge;Ce++)he[T+(Ce>>1)]|=Se[Me+Ce]<<4-4*(1&Ce);else if(E==2)for(Ce=0;Ce<ge;Ce++)he[T+(Ce>>2)]|=Se[Me+Ce]<<6-2*(3&Ce);else if(E==1)for(Ce=0;Ce<ge;Ce++)he[T+(Ce>>3)]|=Se[Me+Ce]<<7-1*(7&Ce)}ve=he,m=3,De=1}else if(j==0&&J.length==1){he=new Uint8Array(ge*be*3);const Se=ge*be;for(T=0;T<Se;T++){const _e=3*T,Me=4*T;he[_e]=ve[Me],he[_e+1]=ve[Me+1],he[_e+2]=ve[Me+2]}ve=he,m=2,De=3,ye=3*ge}ue.img=ve,ue.bpl=ye,ue.bpp=De}return{ctype:m,depth:E,plte:X,frames:J}}function o(b,w,A,M,L,U,R){const C=Uint8Array,g=Uint32Array,u=new C(b[L-1]),W=new g(b[L-1]),m=L+1<b.length?new C(b[L+1]):null,E=new C(b[L]),G=new g(E.buffer);let H=w,D=A,T=-1,j=-1;for(let Z=0;Z<U.height;Z++)for(let X=0;X<U.width;X++){const ae=U.x+X,ie=U.y+Z,ue=ie*w+ae,ge=G[ue];ge==0||M[L-1].dispose==0&&W[ue]==ge&&(m==null||m[4*ue+3]!=0)||(ae<H&&(H=ae),ae>T&&(T=ae),ie<D&&(D=ie),ie>j&&(j=ie))}T==-1&&(H=D=T=j=0),R&&((1&H)==1&&H--,(1&D)==1&&D--),U={x:H,y:D,width:T-H+1,height:j-D+1};const J=M[L];J.rect=U,J.blend=1,J.img=new Uint8Array(U.width*U.height*4),M[L-1].dispose==0?(l(u,w,A,J.img,U.width,U.height,-U.x,-U.y,0),c(E,w,A,J.img,U)):l(E,w,A,J.img,U.width,U.height,-U.x,-U.y,0)}function c(b,w,A,M,L){l(b,w,A,M,L.width,L.height,-L.x,-L.y,2)}function f(b,w,A,M,L,U,R){const C=[];let g,u=[0,1,2,3,4];U!=-1?u=[U]:(w*M>5e5||A==1)&&(u=[0]),R&&(g={level:0});const W=Yr;for(var m=0;m<u.length;m++){for(let H=0;H<w;H++)p(L,b,H,M,A,u[m]);C.push(W.deflate(L,g))}let E,G=1e9;for(m=0;m<C.length;m++)C[m].length<G&&(E=m,G=C[m].length);return C[E]}function p(b,w,A,M,L,U){const R=A*M;let C=R+A;if(b[C]=U,C++,U==0)if(M<500)for(var g=0;g<M;g++)b[C+g]=w[R+g];else b.set(new Uint8Array(w.buffer,R,M),C);else if(U==1){for(g=0;g<L;g++)b[C+g]=w[R+g];for(g=L;g<M;g++)b[C+g]=w[R+g]-w[R+g-L]+256&255}else if(A==0){for(g=0;g<L;g++)b[C+g]=w[R+g];if(U==2)for(g=L;g<M;g++)b[C+g]=w[R+g];if(U==3)for(g=L;g<M;g++)b[C+g]=w[R+g]-(w[R+g-L]>>1)+256&255;if(U==4)for(g=L;g<M;g++)b[C+g]=w[R+g]-t(w[R+g-L],0,0)+256&255}else{if(U==2)for(g=0;g<M;g++)b[C+g]=w[R+g]+256-w[R+g-M]&255;if(U==3){for(g=0;g<L;g++)b[C+g]=w[R+g]+256-(w[R+g-M]>>1)&255;for(g=L;g<M;g++)b[C+g]=w[R+g]+256-(w[R+g-M]+w[R+g-L]>>1)&255}if(U==4){for(g=0;g<L;g++)b[C+g]=w[R+g]+256-t(0,w[R+g-M],0)&255;for(g=L;g<M;g++)b[C+g]=w[R+g]+256-t(w[R+g-L],w[R+g-M],w[R+g-L-M])&255}}}function k(b,w){const A=new Uint8Array(b),M=A.slice(0),L=new Uint32Array(M.buffer),U=S(M,w),R=U[0],C=U[1],g=A.length,u=new Uint8Array(g>>2);let W;if(A.length<2e7)for(var m=0;m<g;m+=4)W=_(R,E=A[m]*(1/255),G=A[m+1]*(1/255),H=A[m+2]*(1/255),D=A[m+3]*(1/255)),u[m>>2]=W.ind,L[m>>2]=W.est.rgba;else for(m=0;m<g;m+=4){var E=A[m]*.00392156862745098,G=A[m+1]*(1/255),H=A[m+2]*(1/255),D=A[m+3]*(1/255);for(W=R;W.left;)W=I(W.est,E,G,H,D)<=0?W.left:W.right;u[m>>2]=W.ind,L[m>>2]=W.est.rgba}return{abuf:M.buffer,inds:u,plte:C}}function S(b,w,A){A==null&&(A=1e-4);const M=new Uint32Array(b.buffer),L={i0:0,i1:b.length,bst:null,est:null,tdst:0,left:null,right:null};L.bst=z(b,L.i0,L.i1),L.est=y(L.bst);const U=[L];for(;U.length<w;){let C=0,g=0;for(var R=0;R<U.length;R++)U[R].est.L>C&&(C=U[R].est.L,g=R);if(C<A)break;const u=U[g],W=O(b,M,u.i0,u.i1,u.est.e,u.est.eMq255);if(u.i0>=W||u.i1<=W){u.est.L=0;continue}const m={i0:u.i0,i1:W,bst:null,est:null,tdst:0,left:null,right:null};m.bst=z(b,m.i0,m.i1),m.est=y(m.bst);const E={i0:W,i1:u.i1,bst:null,est:null,tdst:0,left:null,right:null};for(E.bst={R:[],m:[],N:u.bst.N-m.bst.N},R=0;R<16;R++)E.bst.R[R]=u.bst.R[R]-m.bst.R[R];for(R=0;R<4;R++)E.bst.m[R]=u.bst.m[R]-m.bst.m[R];E.est=y(E.bst),u.left=m,u.right=E,U[g]=m,U.push(E)}for(U.sort(((C,g)=>g.bst.N-C.bst.N)),R=0;R<U.length;R++)U[R].ind=R;return[L,U]}function _(b,w,A,M,L){if(b.left==null)return b.tdst=(function(m,E,G,H,D){const T=E-m[0],j=G-m[1],J=H-m[2],Z=D-m[3];return T*T+j*j+J*J+Z*Z})(b.est.q,w,A,M,L),b;const U=I(b.est,w,A,M,L);let R=b.left,C=b.right;U>0&&(R=b.right,C=b.left);const g=_(R,w,A,M,L);if(g.tdst<=U*U)return g;const u=_(C,w,A,M,L);return u.tdst<g.tdst?u:g}function I(b,w,A,M,L){const{e:U}=b;return U[0]*w+U[1]*A+U[2]*M+U[3]*L-b.eMq}function O(b,w,A,M,L,U){for(M-=4;A<M;){for(;F(b,A,L)<=U;)A+=4;for(;F(b,M,L)>U;)M-=4;if(A>=M)break;const R=w[A>>2];w[A>>2]=w[M>>2],w[M>>2]=R,A+=4,M-=4}for(;F(b,A,L)>U;)A-=4;return A+4}function F(b,w,A){return b[w]*A[0]+b[w+1]*A[1]+b[w+2]*A[2]+b[w+3]*A[3]}function z(b,w,A){const M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L=[0,0,0,0],U=A-w>>2;for(let R=w;R<A;R+=4){const C=b[R]*.00392156862745098,g=b[R+1]*(1/255),u=b[R+2]*(1/255),W=b[R+3]*(1/255);L[0]+=C,L[1]+=g,L[2]+=u,L[3]+=W,M[0]+=C*C,M[1]+=C*g,M[2]+=C*u,M[3]+=C*W,M[5]+=g*g,M[6]+=g*u,M[7]+=g*W,M[10]+=u*u,M[11]+=u*W,M[15]+=W*W}return M[4]=M[1],M[8]=M[2],M[9]=M[6],M[12]=M[3],M[13]=M[7],M[14]=M[11],{R:M,m:L,N:U}}function y(b){const{R:w}=b,{m:A}=b,{N:M}=b,L=A[0],U=A[1],R=A[2],C=A[3],g=M==0?0:1/M,u=[w[0]-L*L*g,w[1]-L*U*g,w[2]-L*R*g,w[3]-L*C*g,w[4]-U*L*g,w[5]-U*U*g,w[6]-U*R*g,w[7]-U*C*g,w[8]-R*L*g,w[9]-R*U*g,w[10]-R*R*g,w[11]-R*C*g,w[12]-C*L*g,w[13]-C*U*g,w[14]-C*R*g,w[15]-C*C*g],W=u,m=B;let E=[Math.random(),Math.random(),Math.random(),Math.random()],G=0,H=0;if(M!=0)for(let T=0;T<16&&(E=m.multVec(W,E),H=Math.sqrt(m.dot(E,E)),E=m.sml(1/H,E),!(T!=0&&Math.abs(H-G)<1e-9));T++)G=H;const D=[L*g,U*g,R*g,C*g];return{Cov:u,q:D,e:E,L:G,eMq255:m.dot(m.sml(255,D),E),eMq:m.dot(E,D),rgba:(Math.round(255*D[3])<<24|Math.round(255*D[2])<<16|Math.round(255*D[1])<<8|Math.round(255*D[0])<<0)>>>0}}var B={multVec:(b,w)=>[b[0]*w[0]+b[1]*w[1]+b[2]*w[2]+b[3]*w[3],b[4]*w[0]+b[5]*w[1]+b[6]*w[2]+b[7]*w[3],b[8]*w[0]+b[9]*w[1]+b[10]*w[2]+b[11]*w[3],b[12]*w[0]+b[13]*w[1]+b[14]*w[2]+b[15]*w[3]],dot:(b,w)=>b[0]*w[0]+b[1]*w[1]+b[2]*w[2]+b[3]*w[3],sml:(b,w)=>[b*w[0],b*w[1],b*w[2],b*w[3]]};dt.encode=function(w,A,M,L,U,R,C){L==null&&(L=0),C==null&&(C=!1);const g=i(w,A,M,L,[!1,!1,!1,0,C,!1]);return v(g,-1),x(g,A,M,U,R)},dt.encodeLL=function(w,A,M,L,U,R,C,g){const u={ctype:0+(L==1?0:2)+(U==0?0:4),depth:R,frames:[]},W=(L+U)*R,m=W*A;for(let E=0;E<w.length;E++)u.frames.push({rect:{x:0,y:0,width:A,height:M},img:new Uint8Array(w[E]),blend:0,dispose:1,bpp:Math.ceil(W/8),bpl:Math.ceil(m/8)});return v(u,0,!0),x(u,A,M,C,g)},dt.encode.compress=i,dt.encode.dither=d,dt.quantize=k,dt.quantize.getKDtree=S,dt.quantize.getNearest=_})();const ar={toArrayBuffer(l,h){const t=l.width,n=l.height,e=t<<2,r=l.getContext("2d").getImageData(0,0,t,n),a=new Uint32Array(r.data.buffer),d=(32*t+31)/32<<2,x=d*n,v=122+x,i=new ArrayBuffer(v),o=new DataView(i),c=1<<20;let f,p,k,S,_=c,I=0,O=0,F=0;function z(b){o.setUint16(O,b,!0),O+=2}function y(b){o.setUint32(O,b,!0),O+=4}function B(b){O+=b}z(19778),y(v),B(4),y(122),y(108),y(t),y(-n>>>0),z(1),z(32),y(3),y(x),y(2835),y(2835),B(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),(function b(){for(;I<n&&_>0;){for(S=122+I*d,f=0;f<e;)_--,p=a[F++],k=p>>>24,o.setUint32(S+f,p<<8|k),f+=4;I++}F<a.length?(_=c,setTimeout(b,ar._dly)):h(i)})()},toBlob(l,h){this.toArrayBuffer(l,(t=>{h(new Blob([t],{type:"image/bmp"}))}))},_dly:9};var Qe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Zr={[Qe.CHROME]:16384,[Qe.FIREFOX]:11180,[Qe.DESKTOP_SAFARI]:16384,[Qe.IE]:8192,[Qe.IOS]:4096,[Qe.ETC]:8192};const gn=typeof window<"u",ir=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ot=gn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Jr=(gn||ir)&&(Ot&&Ot.getOriginalSymbol(window,"File")||typeof File<"u"&&File),or=(gn||ir)&&(Ot&&Ot.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function xn(l,h,t=Date.now()){return new Promise((n=>{const e=l.split(","),r=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let d=a.length;const x=new Uint8Array(d);for(;d--;)x[d]=a.charCodeAt(d);const v=new Blob([x],{type:r});v.name=h,v.lastModified=t,n(v)}))}function lr(l){return new Promise(((h,t)=>{const n=new or;n.onload=()=>h(n.result),n.onerror=e=>t(e),n.readAsDataURL(l)}))}function cr(l){return new Promise(((h,t)=>{const n=new Image;n.onload=()=>h(n),n.onerror=e=>t(e),n.src=l}))}function jt(){if(jt.cachedResult!==void 0)return jt.cachedResult;let l=Qe.ETC;const{userAgent:h}=navigator;return/Chrom(e|ium)/i.test(h)?l=Qe.CHROME:/iP(ad|od|hone)/i.test(h)&&/WebKit/i.test(h)?l=Qe.IOS:/Safari/i.test(h)?l=Qe.DESKTOP_SAFARI:/Firefox/i.test(h)?l=Qe.FIREFOX:(/MSIE/i.test(h)||document.documentMode)&&(l=Qe.IE),jt.cachedResult=l,jt.cachedResult}function dr(l,h){const t=jt(),n=Zr[t];let e=l,r=h,a=e*r;const d=e>r?r/e:e/r;for(;a>n*n;){const x=(n+e)/2,v=(n+r)/2;x<v?(r=v,e=v*d):(r=x*d,e=x),a=e*r}return{width:e,height:r}}function $t(l,h){let t,n;try{if(t=new OffscreenCanvas(l,h),n=t.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{t=document.createElement("canvas"),n=t.getContext("2d")}return t.width=l,t.height=h,[t,n]}function ur(l,h){const{width:t,height:n}=dr(l.width,l.height),[e,r]=$t(t,n);return h&&/jpe?g/.test(h)&&(r.fillStyle="white",r.fillRect(0,0,e.width,e.height)),r.drawImage(l,0,0,e.width,e.height),e}function Ft(){return Ft.cachedResult!==void 0||(Ft.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ft.cachedResult}function Wt(l,h={}){return new Promise((function(t,n){let e,r;var a=function(){try{return r=ur(e,h.fileType||l.type),t([e,r])}catch(x){return n(x)}},d=function(x){try{var v=function(i){try{throw i}catch(o){return n(o)}};try{let i;return lr(l).then((function(o){try{return i=o,cr(i).then((function(c){try{return e=c,(function(){try{return a()}catch(f){return n(f)}})()}catch(f){return v(f)}}),v)}catch(c){return v(c)}}),v)}catch(i){v(i)}}catch(i){return n(i)}};try{if(Ft()||[Qe.DESKTOP_SAFARI,Qe.MOBILE_SAFARI].includes(jt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(l).then((function(x){try{return e=x,a()}catch{return d()}}),d)}catch{d()}}))}function Ht(l,h,t,n,e=1){return new Promise((function(r,a){let d;if(h==="image/png"){let v,i,o;return v=l.getContext("2d"),{data:i}=v.getImageData(0,0,l.width,l.height),o=dt.encode([i.buffer],l.width,l.height,4096*e),d=new Blob([o],{type:h}),d.name=t,d.lastModified=n,x.call(this)}{let v=function(){return x.call(this)};if(h==="image/bmp")return new Promise((i=>ar.toBlob(l,i))).then((function(i){try{return d=i,d.name=t,d.lastModified=n,v.call(this)}catch(o){return a(o)}}).bind(this),a);{let i=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&l instanceof OffscreenCanvas)return l.convertToBlob({type:h,quality:e}).then((function(o){try{return d=o,d.name=t,d.lastModified=n,i.call(this)}catch(c){return a(c)}}).bind(this),a);{let o;return o=l.toDataURL(h,e),xn(o,t,n).then((function(c){try{return d=c,i.call(this)}catch(f){return a(f)}}).bind(this),a)}}}function x(){return r(d)}}))}function ut(l){l.width=0,l.height=0}function Nt(){return new Promise((function(l,h){let t,n,e,r;return Nt.cachedResult!==void 0?l(Nt.cachedResult):xn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(a){try{return t=a,Wt(t).then((function(d){try{return n=d[1],Ht(n,t.type,t.name,t.lastModified).then((function(x){try{return e=x,ut(n),Wt(e).then((function(v){try{return r=v[0],Nt.cachedResult=r.width===1&&r.height===2,l(Nt.cachedResult)}catch(i){return h(i)}}),h)}catch(v){return h(v)}}),h)}catch(x){return h(x)}}),h)}catch(d){return h(d)}}),h)}))}function fr(l){return new Promise(((h,t)=>{const n=new or;n.onload=e=>{const r=new DataView(e.target.result);if(r.getUint16(0,!1)!=65496)return h(-2);const a=r.byteLength;let d=2;for(;d<a;){if(r.getUint16(d+2,!1)<=8)return h(-1);const x=r.getUint16(d,!1);if(d+=2,x==65505){if(r.getUint32(d+=2,!1)!=1165519206)return h(-1);const v=r.getUint16(d+=6,!1)==18761;d+=r.getUint32(d+4,v);const i=r.getUint16(d,v);d+=2;for(let o=0;o<i;o++)if(r.getUint16(d+12*o,v)==274)return h(r.getUint16(d+12*o+8,v))}else{if((65280&x)!=65280)break;d+=r.getUint16(d,!1)}}return h(-1)},n.onerror=e=>t(e),n.readAsArrayBuffer(l)}))}function hr(l,h){const{width:t}=l,{height:n}=l,{maxWidthOrHeight:e}=h;let r,a=l;return isFinite(e)&&(t>e||n>e)&&([a,r]=$t(t,n),t>n?(a.width=e,a.height=n/t*e):(a.width=t/n*e,a.height=e),r.drawImage(l,0,0,a.width,a.height),ut(l)),a}function mr(l,h){const{width:t}=l,{height:n}=l,[e,r]=$t(t,n);switch(h>4&&h<9?(e.width=n,e.height=t):(e.width=t,e.height=n),h){case 2:r.transform(-1,0,0,1,t,0);break;case 3:r.transform(-1,0,0,-1,t,n);break;case 4:r.transform(1,0,0,-1,0,n);break;case 5:r.transform(0,1,1,0,0,0);break;case 6:r.transform(0,1,-1,0,n,0);break;case 7:r.transform(0,-1,-1,0,n,t);break;case 8:r.transform(0,-1,1,0,0,t)}return r.drawImage(l,0,0,t,n),ut(l),e}function On(l,h,t=0){return new Promise((function(n,e){let r,a,d,x,v,i,o,c,f,p,k,S,_,I,O,F,z,y,B,b;function w(M=5){if(h.signal&&h.signal.aborted)throw h.signal.reason;r+=M,h.onProgress(Math.min(r,100))}function A(M){if(h.signal&&h.signal.aborted)throw h.signal.reason;r=Math.min(Math.max(M,r),100),h.onProgress(r)}return r=t,a=h.maxIteration||10,d=1024*h.maxSizeMB*1024,w(),Wt(l,h).then((function(M){try{return[,x]=M,w(),v=hr(x,h),w(),new Promise((function(L,U){var R;if(!(R=h.exifOrientation))return fr(l).then((function(g){try{return R=g,C.call(this)}catch(u){return U(u)}}).bind(this),U);function C(){return L(R)}return C.call(this)})).then((function(L){try{return i=L,w(),Nt().then((function(U){try{return o=U?v:mr(v,i),w(),c=h.initialQuality||1,f=h.fileType||l.type,Ht(o,f,l.name,l.lastModified,c).then((function(R){try{{let g=function(){if(a--&&(O>d||O>_)){let W,m;return W=b?.95*B.width:B.width,m=b?.95*B.height:B.height,[z,y]=$t(W,m),y.drawImage(B,0,0,W,m),c*=f==="image/png"?.85:.95,Ht(z,f,l.name,l.lastModified,c).then((function(E){try{return F=E,ut(B),B=z,O=F.size,A(Math.min(99,Math.floor((I-O)/(I-d)*100))),g}catch(G){return e(G)}}),e)}return[1]},u=function(){return ut(B),ut(z),ut(v),ut(o),ut(x),A(100),n(F)};if(p=R,w(),k=p.size>d,S=p.size>l.size,!k&&!S)return A(100),n(p);var C;return _=l.size,I=p.size,O=I,B=o,b=!h.alwaysKeepResolution&&k,(C=(function(W){for(;W;){if(W.then)return void W.then(C,e);try{if(W.pop){if(W.length)return W.pop()?u.call(this):W;W=g}else W=W.call(this)}catch(m){return e(m)}}}).bind(this))(g)}}catch(g){return e(g)}}).bind(this),e)}catch(R){return e(R)}}).bind(this),e)}catch(U){return e(U)}}).bind(this),e)}catch(L){return e(L)}}).bind(this),e)}))}const Qr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let rn;function Xr(l,h){return new Promise(((t,n)=>{rn||(rn=(function(a){const d=[];return d.push(a),URL.createObjectURL(new Blob(d))})(Qr));const e=new Worker(rn);e.addEventListener("message",(function(a){if(h.signal&&h.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return n(new Error(a.data.error)),void e.terminate();t(a.data.file),e.terminate()}else h.onProgress(a.data.progress)})),e.addEventListener("error",n),h.signal&&h.signal.addEventListener("abort",(()=>{n(h.signal.reason),e.terminate()})),e.postMessage({file:l,imageCompressionLibUrl:h.libURL,options:{...h,onProgress:void 0,signal:void 0}})}))}function $e(l,h){return new Promise((function(t,n){let e,r,a,d,x,v;if(e={...h},a=0,{onProgress:d}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=f=>{a=f,typeof d=="function"&&d(a)},!(l instanceof Blob||l instanceof Jr))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(l.type))return n(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||v)return On(l,e).then((function(f){try{return r=f,c.call(this)}catch(p){return n(p)}}).bind(this),n);var i=(function(){try{return c.call(this)}catch(f){return n(f)}}).bind(this),o=function(f){try{return On(l,e).then((function(p){try{return r=p,i()}catch(k){return n(k)}}),n)}catch(p){return n(p)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Xr(l,e).then((function(f){try{return r=f,i()}catch{return o()}}),o)}catch{o()}function c(){try{r.name=l.name,r.lastModified=l.lastModified}catch{}try{e.preserveExif&&l.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===l.type)&&(r=sr(l,r))}catch{}return t(r)}}))}$e.getDataUrlFromFile=lr,$e.getFilefromDataUrl=xn,$e.loadImage=cr,$e.drawImageInCanvas=ur,$e.drawFileInCanvas=Wt,$e.canvasToFile=Ht,$e.getExifOrientation=fr,$e.handleMaxWidthOrHeight=hr,$e.followExifOrientation=mr,$e.cleanupCanvasMemory=ut,$e.isAutoOrientationInBrowser=Nt,$e.approximateBelowMaximumCanvasSizeOfBrowser=dr,$e.copyExifWithoutOrientation=sr,$e.getBrowserName=jt,$e.version="2.0.2";var pn=function(l,h){return pn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},pn(l,h)};function es(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");pn(l,h);function t(){this.constructor=l}l.prototype=h===null?Object.create(h):(t.prototype=h.prototype,new t)}var We=function(){return We=Object.assign||function(h){for(var t,n=1,e=arguments.length;n<e;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(h[r]=t[r])}return h},We.apply(this,arguments)};var sn,Wn;function ts(){if(Wn)return sn;Wn=1;var l=!1,h,t,n,e,r,a,d,x,v,i,o,c,f,p,k;function S(){if(!l){l=!0;var I=navigator.userAgent,O=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(I),F=/(Mac OS X)|(Windows)|(Linux)/.exec(I);if(c=/\b(iPhone|iP[ao]d)/.exec(I),f=/\b(iP[ao]d)/.exec(I),i=/Android/i.exec(I),p=/FBAN\/\w+;/i.exec(I),k=/Mobile/i.exec(I),o=!!/Win64/.exec(I),O){h=O[1]?parseFloat(O[1]):O[5]?parseFloat(O[5]):NaN,h&&document&&document.documentMode&&(h=document.documentMode);var z=/(?:Trident\/(\d+.\d+))/.exec(I);a=z?parseFloat(z[1])+4:h,t=O[2]?parseFloat(O[2]):NaN,n=O[3]?parseFloat(O[3]):NaN,e=O[4]?parseFloat(O[4]):NaN,e?(O=/(?:Chrome\/(\d+\.\d+))/.exec(I),r=O&&O[1]?parseFloat(O[1]):NaN):r=NaN}else h=t=n=r=e=NaN;if(F){if(F[1]){var y=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(I);d=y?parseFloat(y[1].replace("_",".")):!0}else d=!1;x=!!F[2],v=!!F[3]}else d=x=v=!1}}var _={ie:function(){return S()||h},ieCompatibilityMode:function(){return S()||a>h},ie64:function(){return _.ie()&&o},firefox:function(){return S()||t},opera:function(){return S()||n},webkit:function(){return S()||e},safari:function(){return _.webkit()},chrome:function(){return S()||r},windows:function(){return S()||x},osx:function(){return S()||d},linux:function(){return S()||v},iphone:function(){return S()||c},mobile:function(){return S()||c||f||i||k},nativeApp:function(){return S()||p},android:function(){return S()||i},ipad:function(){return S()||f}};return sn=_,sn}var an,Hn;function ns(){if(Hn)return an;Hn=1;var l=!!(typeof window<"u"&&window.document&&window.document.createElement),h={canUseDOM:l,canUseWorkers:typeof Worker<"u",canUseEventListeners:l&&!!(window.addEventListener||window.attachEvent),canUseViewport:l&&!!window.screen,isInWorker:!l};return an=h,an}var on,$n;function rs(){if($n)return on;$n=1;var l=ns(),h;l.canUseDOM&&(h=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function t(n,e){if(!l.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+n,a=r in document;if(!a){var d=document.createElement("div");d.setAttribute(r,"return;"),a=typeof d[r]=="function"}return!a&&h&&n==="wheel"&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}return on=t,on}var ln,Bn;function ss(){if(Bn)return ln;Bn=1;var l=ts(),h=rs(),t=10,n=40,e=800;function r(a){var d=0,x=0,v=0,i=0;return"detail"in a&&(x=a.detail),"wheelDelta"in a&&(x=-a.wheelDelta/120),"wheelDeltaY"in a&&(x=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(d=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(d=x,x=0),v=d*t,i=x*t,"deltaY"in a&&(i=a.deltaY),"deltaX"in a&&(v=a.deltaX),(v||i)&&a.deltaMode&&(a.deltaMode==1?(v*=n,i*=n):(v*=e,i*=e)),v&&!d&&(d=v<1?-1:1),i&&!x&&(x=i<1?-1:1),{spinX:d,spinY:x,pixelX:v,pixelY:i}}return r.getEventType=function(){return l.firefox()?"DOMMouseScroll":h("wheel")?"wheel":"mousewheel"},ln=r,ln}var cn,Gn;function as(){return Gn||(Gn=1,cn=ss()),cn}var is=as();const os=Ir(is);function ls(l,h,t,n,e,r){r===void 0&&(r=0);var a=kt(l,h,r),d=a.width,x=a.height,v=Math.min(d,t),i=Math.min(x,n);return v>i*e?{width:i*e,height:i}:{width:v,height:v/e}}function cs(l){return l.width>l.height?l.width/l.naturalWidth:l.height/l.naturalHeight}function Mt(l,h,t,n,e){e===void 0&&(e=0);var r=kt(h.width,h.height,e),a=r.width,d=r.height;return{x:qn(l.x,a,t.width,n),y:qn(l.y,d,t.height,n)}}function qn(l,h,t,n){var e=h*n/2-t/2;return Bt(l,-e,e)}function Vn(l,h){return Math.sqrt(Math.pow(l.y-h.y,2)+Math.pow(l.x-h.x,2))}function Kn(l,h){return Math.atan2(h.y-l.y,h.x-l.x)*180/Math.PI}function ds(l,h,t,n,e,r,a){r===void 0&&(r=0),a===void 0&&(a=!0);var d=a?us:fs,x=kt(h.width,h.height,r),v=kt(h.naturalWidth,h.naturalHeight,r),i={x:d(100,((x.width-t.width/e)/2-l.x/e)/x.width*100),y:d(100,((x.height-t.height/e)/2-l.y/e)/x.height*100),width:d(100,t.width/x.width*100/e),height:d(100,t.height/x.height*100/e)},o=Math.round(d(v.width,i.width*v.width/100)),c=Math.round(d(v.height,i.height*v.height/100)),f=v.width>=v.height*n,p=f?{width:Math.round(c*n),height:c}:{width:o,height:Math.round(o/n)},k=We(We({},p),{x:Math.round(d(v.width-p.width,i.x*v.width/100)),y:Math.round(d(v.height-p.height,i.y*v.height/100))});return{croppedAreaPercentages:i,croppedAreaPixels:k}}function us(l,h){return Math.min(l,Math.max(0,h))}function fs(l,h){return h}function hs(l,h,t,n,e,r){var a=kt(h.width,h.height,t),d=Bt(n.width/a.width*(100/l.width),e,r),x={x:d*a.width/2-n.width/2-a.width*d*(l.x/100),y:d*a.height/2-n.height/2-a.height*d*(l.y/100)};return{crop:x,zoom:d}}function ms(l,h,t){var n=cs(h);return t.height>t.width?t.height/(l.height*n):t.width/(l.width*n)}function ps(l,h,t,n,e,r){t===void 0&&(t=0);var a=kt(h.naturalWidth,h.naturalHeight,t),d=Bt(ms(l,h,n),e,r),x=n.height>n.width?n.height/l.height:n.width/l.width,v={x:((a.width-l.width)/2-l.x)*x,y:((a.height-l.height)/2-l.y)*x};return{crop:v,zoom:d}}function Yn(l,h){return{x:(h.x+l.x)/2,y:(h.y+l.y)/2}}function gs(l){return l*Math.PI/180}function kt(l,h,t){var n=gs(t);return{width:Math.abs(Math.cos(n)*l)+Math.abs(Math.sin(n)*h),height:Math.abs(Math.sin(n)*l)+Math.abs(Math.cos(n)*h)}}function Bt(l,h,t){return Math.min(Math.max(l,h),t)}function Ut(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return l.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var xs=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,ws=1,bs=3,vs=1,ys=(function(l){es(h,l);function h(){var t=l!==null&&l.apply(this,arguments)||this;return t.cropperRef=P.createRef(),t.imageRef=P.createRef(),t.videoRef=P.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.previousCropSize=null,t.isInitialized=!1,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var n=!0;t.resizeObserver=new window.ResizeObserver(function(e){if(n){n=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(n){return n.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var n=t.computeSizes();n&&(t.previousCropSize=n,t.emitCropData(),t.setInitialCrop(n),t.isInitialized=!0),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(n){if(t.props.initialCroppedAreaPercentages){var e=hs(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,n,t.props.minZoom,t.props.maxZoom),r=e.crop,a=e.zoom;t.props.onCropChange(r),t.props.onZoomChange&&t.props.onZoomChange(a)}else if(t.props.initialCroppedAreaPixels){var d=ps(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,n,t.props.minZoom,t.props.maxZoom),r=d.crop,a=d.zoom;t.props.onCropChange(r),t.props.onZoomChange&&t.props.onZoomChange(a)}},t.computeSizes=function(){var n,e,r,a,d,x,v=t.imageRef.current||t.videoRef.current;if(v&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var i=t.containerRect.width/t.containerRect.height,o=((n=t.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((e=t.videoRef.current)===null||e===void 0?void 0:e.videoWidth)||0,c=((r=t.imageRef.current)===null||r===void 0?void 0:r.naturalHeight)||((a=t.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,f=v.offsetWidth<o||v.offsetHeight<c,p=o/c,k=void 0;if(f)switch(t.state.mediaObjectFit){default:case"contain":k=i>p?{width:t.containerRect.height*p,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/p};break;case"horizontal-cover":k={width:t.containerRect.width,height:t.containerRect.width/p};break;case"vertical-cover":k={width:t.containerRect.height*p,height:t.containerRect.height};break}else k={width:v.offsetWidth,height:v.offsetHeight};t.mediaSize=We(We({},k),{naturalWidth:o,naturalHeight:c}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var S=t.props.cropSize?t.props.cropSize:ls(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((d=t.state.cropSize)===null||d===void 0?void 0:d.height)!==S.height||((x=t.state.cropSize)===null||x===void 0?void 0:x.width)!==S.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(S),t.setState({cropSize:S},t.recomputeCropPosition),t.props.setCropSize&&t.props.setCropSize(S),S}},t.saveContainerPosition=function(){if(t.containerRef){var n=t.containerRef.getBoundingClientRect();t.containerPosition={x:n.left,y:n.top}}},t.onMouseDown=function(n){t.currentDoc&&(n.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(h.getMousePoint(n)))},t.onMouseMove=function(n){return t.onDrag(h.getMousePoint(n))},t.onScroll=function(n){t.currentDoc&&(n.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(n){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(n))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),n.touches.length===2?t.onPinchStart(n):n.touches.length===1&&t.onDragStart(h.getTouchPoint(n.touches[0]))))},t.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?t.onPinchMove(n):n.touches.length===1&&t.onDrag(h.getTouchPoint(n.touches[0]))},t.onGestureStart=function(n){t.currentDoc&&(n.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(n){if(n.preventDefault(),!t.isTouching){var e=h.getMousePoint(n),r=t.gestureZoomStart-1+n.scale;if(t.setNewZoom(r,e,{shouldUpdatePosition:!0}),t.props.onRotationChange){var a=t.gestureRotationStart+n.rotation;t.props.onRotationChange(a)}}},t.onGestureEnd=function(n){t.cleanEvents()},t.onDragStart=function(n){var e,r,a=n.x,d=n.y;t.dragStartPosition={x:a,y:d},t.dragStartCrop=We({},t.props.crop),(r=(e=t.props).onInteractionStart)===null||r===void 0||r.call(e)},t.onDrag=function(n){var e=n.x,r=n.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(e===void 0||r===void 0)){var a=e-t.dragStartPosition.x,d=r-t.dragStartPosition.y,x={x:t.dragStartCrop.x+a,y:t.dragStartCrop.y+d},v=t.props.restrictPosition?Mt(x,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):x;t.props.onCropChange(v)}}))},t.onDragStopped=function(){var n,e;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(e=(n=t.props).onInteractionEnd)===null||e===void 0||e.call(n)},t.onWheel=function(n){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(n))){n.preventDefault();var e=h.getMousePoint(n),r=os(n).pixelY,a=t.props.zoom-r*t.props.zoomSpeed/200;t.setNewZoom(a,e,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var d,x;return(x=(d=t.props).onInteractionStart)===null||x===void 0?void 0:x.call(d)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var d,x;return(x=(d=t.props).onInteractionEnd)===null||x===void 0?void 0:x.call(d)})},250)}},t.getPointOnContainer=function(n,e){var r=n.x,a=n.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(r-e.x),y:t.containerRect.height/2-(a-e.y)}},t.getPointOnMedia=function(n){var e=n.x,r=n.y,a=t.props,d=a.crop,x=a.zoom;return{x:(e+d.x)/x,y:(r+d.y)/x}},t.setNewZoom=function(n,e,r){var a=r===void 0?{}:r,d=a.shouldUpdatePosition,x=d===void 0?!0:d;if(!(!t.state.cropSize||!t.props.onZoomChange)){var v=Bt(n,t.props.minZoom,t.props.maxZoom);if(x){var i=t.getPointOnContainer(e,t.containerPosition),o=t.getPointOnMedia(i),c={x:o.x*v-i.x,y:o.y*v-i.y},f=t.props.restrictPosition?Mt(c,t.mediaSize,t.state.cropSize,v,t.props.rotation):c;t.props.onCropChange(f)}t.props.onZoomChange(v)}},t.getCropData=function(){if(!t.state.cropSize)return null;var n=t.props.restrictPosition?Mt(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return ds(n,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var n=t.getCropData();if(n){var e=n.croppedAreaPercentages,r=n.croppedAreaPixels;t.props.onCropComplete&&t.props.onCropComplete(e,r),t.props.onCropAreaChange&&t.props.onCropAreaChange(e,r)}},t.emitCropAreaChange=function(){var n=t.getCropData();if(n){var e=n.croppedAreaPercentages,r=n.croppedAreaPixels;t.props.onCropAreaChange&&t.props.onCropAreaChange(e,r)}},t.recomputeCropPosition=function(){var n,e;if(t.state.cropSize){var r=t.props.crop;if(t.isInitialized&&(!((n=t.previousCropSize)===null||n===void 0)&&n.width)&&(!((e=t.previousCropSize)===null||e===void 0)&&e.height)){var a=Math.abs(t.previousCropSize.width-t.state.cropSize.width)>1e-6||Math.abs(t.previousCropSize.height-t.state.cropSize.height)>1e-6;if(a){var d=t.state.cropSize.width/t.previousCropSize.width,x=t.state.cropSize.height/t.previousCropSize.height;r={x:t.props.crop.x*d,y:t.props.crop.y*x}}}var v=t.props.restrictPosition?Mt(r,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):r;t.previousCropSize=t.state.cropSize,t.props.onCropChange(v),t.emitCropData()}},t.onKeyDown=function(n){var e,r,a=t.props,d=a.crop,x=a.onCropChange,v=a.keyboardStep,i=a.zoom,o=a.rotation,c=v;if(t.state.cropSize){n.shiftKey&&(c*=.2);var f=We({},d);switch(n.key){case"ArrowUp":f.y-=c,n.preventDefault();break;case"ArrowDown":f.y+=c,n.preventDefault();break;case"ArrowLeft":f.x-=c,n.preventDefault();break;case"ArrowRight":f.x+=c,n.preventDefault();break;default:return}t.props.restrictPosition&&(f=Mt(f,t.mediaSize,t.state.cropSize,i,o)),n.repeat||(r=(e=t.props).onInteractionStart)===null||r===void 0||r.call(e),x(f)}},t.onKeyUp=function(n){var e,r;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}t.emitCropData(),(r=(e=t.props).onInteractionEnd)===null||r===void 0||r.call(e)},t}return h.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=xs,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},h.prototype.componentWillUnmount=function(){var t,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},h.prototype.componentDidUpdate=function(t){var n,e,r,a,d,x,v,i,o;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((n=t.cropSize)===null||n===void 0?void 0:n.height)!==((e=this.props.cropSize)===null||e===void 0?void 0:e.height)||((r=t.cropSize)===null||r===void 0?void 0:r.width)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.width)?this.computeSizes():(((d=t.crop)===null||d===void 0?void 0:d.x)!==((x=this.props.crop)===null||x===void 0?void 0:x.x)||((v=t.crop)===null||v===void 0?void 0:v.y)!==((i=this.props.crop)===null||i===void 0?void 0:i.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((o=this.videoRef.current)===null||o===void 0||o.load());var c=this.getObjectFit();c!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:c},this.computeSizes)},h.prototype.getAspect=function(){var t=this.props,n=t.cropSize,e=t.aspect;return n?n.width/n.height:e},h.prototype.getObjectFit=function(){var t,n,e,r;if(this.props.objectFit==="cover"){var a=this.imageRef.current||this.videoRef.current;if(a&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var d=this.containerRect.width/this.containerRect.height,x=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,v=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((r=this.videoRef.current)===null||r===void 0?void 0:r.videoHeight)||0,i=x/v;return i<d?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},h.prototype.onPinchStart=function(t){var n=h.getTouchPoint(t.touches[0]),e=h.getTouchPoint(t.touches[1]);this.lastPinchDistance=Vn(n,e),this.lastPinchRotation=Kn(n,e),this.onDragStart(Yn(n,e))},h.prototype.onPinchMove=function(t){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var e=h.getTouchPoint(t.touches[0]),r=h.getTouchPoint(t.touches[1]),a=Yn(e,r);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var d=Vn(e,r),x=n.props.zoom*(d/n.lastPinchDistance);n.setNewZoom(x,a,{shouldUpdatePosition:!1}),n.lastPinchDistance=d;var v=Kn(e,r),i=n.props.rotation+(v-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(i),n.lastPinchRotation=v})}},h.prototype.render=function(){var t=this,n,e=this.props,r=e.image,a=e.video,d=e.mediaProps,x=e.cropperProps,v=e.transform,i=e.crop,o=i.x,c=i.y,f=e.rotation,p=e.zoom,k=e.cropShape,S=e.showGrid,_=e.roundCropAreaPixels,I=e.style,O=I.containerStyle,F=I.cropAreaStyle,z=I.mediaStyle,y=e.classes,B=y.containerClassName,b=y.cropAreaClassName,w=y.mediaClassName,A=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return P.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(L){return t.containerRef=L},"data-testid":"container",style:O,className:Ut("reactEasyCrop_Container",B)},r?P.createElement("img",We({alt:"",className:Ut("reactEasyCrop_Image",A==="contain"&&"reactEasyCrop_Contain",A==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",A==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",w)},d,{src:r,ref:this.imageRef,style:We(We({},z),{transform:v||"translate(".concat(o,"px, ").concat(c,"px) rotate(").concat(f,"deg) scale(").concat(p,")")}),onLoad:this.onMediaLoad})):a&&P.createElement("video",We({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Ut("reactEasyCrop_Video",A==="contain"&&"reactEasyCrop_Contain",A==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",A==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",w)},d,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:We(We({},z),{transform:v||"translate(".concat(o,"px, ").concat(c,"px) rotate(").concat(f,"deg) scale(").concat(p,")")}),controls:!1}),(Array.isArray(a)?a:[{src:a}]).map(function(M){return P.createElement("source",We({key:M.src},M))})),this.state.cropSize&&P.createElement("div",We({ref:this.cropperRef,style:We(We({},F),{width:_?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:_?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Ut("reactEasyCrop_CropArea",k==="round"&&"reactEasyCrop_CropAreaRound",S&&"reactEasyCrop_CropAreaGrid",b)},x)))},h.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:bs,minZoom:ws,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:vs},h.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},h.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},h})(P.Component);const He=[];for(let l=0;l<256;++l)He.push((l+256).toString(16).slice(1));function _s(l,h=0){return(He[l[h+0]]+He[l[h+1]]+He[l[h+2]]+He[l[h+3]]+"-"+He[l[h+4]]+He[l[h+5]]+"-"+He[l[h+6]]+He[l[h+7]]+"-"+He[l[h+8]]+He[l[h+9]]+"-"+He[l[h+10]]+He[l[h+11]]+He[l[h+12]]+He[l[h+13]]+He[l[h+14]]+He[l[h+15]]).toLowerCase()}let dn;const js=new Uint8Array(16);function Cs(){if(!dn){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");dn=crypto.getRandomValues.bind(crypto)}return dn(js)}const Ss=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zn={randomUUID:Ss};function Ns(l,h,t){l=l||{};const n=l.random??l.rng?.()??Cs();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,_s(n)}function ks(l,h,t){return Zn.randomUUID&&!l?Zn.randomUUID():Ns(l)}const rt=(l,h,t,n)=>{fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:l,message:h,data:t,timestamp:Date.now(),sessionId:"debug-session",hypothesisId:n||"ALL"})}).catch(()=>{})},Jn=50,_t=l=>{let h=null;if(l.reply_to){const t=Array.isArray(l.reply_to)?l.reply_to[0]:l.reply_to;l.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",l.reply_to_message_id,"reply_to:",l.reply_to,"replyToData:",t),t&&console.log("[normalizeMessage] replyToData.id:",t.id,"replyToData.user_id:",t.user_id,"replyToData.content:",t.content)),t&&t.id&&t.user_id?h={id:t.id,content:t.content||"",user_id:t.user_id,author_name:t.author_name}:l.reply_to_message_id&&t&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",t,"has id:",!!t?.id,"has user_id:",!!t?.user_id)}return{id:l.id,league_id:l.league_id,user_id:l.user_id,content:l.content,created_at:l.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:l.reply_to_message_id??null,reply_to:h}},st=l=>{const h=new Map;for(const t of l)if(t.id.startsWith("optimistic-")&&t.client_msg_id)l.some(e=>!e.id.startsWith("optimistic-")&&e.client_msg_id===t.client_msg_id)||h.set(t.id,t);else{if(t.client_msg_id){const n=Array.from(h.keys()).find(e=>{const r=h.get(e);return r?.id.startsWith("optimistic-")&&r.client_msg_id===t.client_msg_id});n&&h.delete(n)}h.set(t.id,t)}return Array.from(h.values()).sort((t,n)=>new Date(t.created_at).getTime()-new Date(n.created_at).getTime())};function Es(l,h={}){const{userId:t,enabled:n=!0,autoSubscribe:e=!0}=h,r=()=>!l||!n?[]:Oe(`chat:messages:${l}`)||[],[a,d]=P.useState(r),[x,v]=P.useState(!1),[i,o]=P.useState(!1),[c,f]=P.useState(!0),[p,k]=P.useState(null),S=P.useRef(null),_=P.useRef(null),I=P.useRef(!1),O=P.useRef(null),F=P.useRef(0),z=P.useRef(a),y=P.useCallback(C=>{d(g=>{const u=C(g);if(z.current=u,S.current=u.length?u[0].created_at:null,O.current=u.length?u[u.length-1].created_at:null,l&&u.length>0){const W=u.filter(m=>!m.id.startsWith("optimistic-"));if(W.length>0){const m=Date.now();if(m-F.current>2e3){F.current=m;const E=`chat:messages:${l}`;hn(E,W,mn.HOME)}}}return u})},[l]),B=P.useRef(null),b=P.useRef(null);P.useEffect(()=>{z.current=a},[a]);const w=P.useCallback(async({before:C,append:g})=>{if(!l||!n)return;console.log("[fetchPage] Starting fetch for league:",l,"append:",g,"before:",C);const u=se.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",l).order("created_at",{ascending:!1}).limit(Jn);C&&u.lt("created_at",C);const{data:W,error:m}=await u;if(m)throw console.error("[useMiniLeagueChat] Error fetching messages:",m),m;console.log("[fetchPage] Fetched",W?.length||0,"messages from database"),rt("useMiniLeagueChat.ts:fetchPage:fetched","Fetched messages from database",{messageCount:W?.length||0,before:C,append:g,latestMessageId:W?.[0]?.id,latestMessageContent:W?.[0]?.content?.slice(0,50),latestMessageCreatedAt:W?.[0]?.created_at},"H7");const E=(W??[]).filter(T=>T.reply_to_message_id),G=[...new Set(E.map(T=>T.reply_to_message_id))];console.log("[fetchPage] Found",E.length,"messages with reply_to_message_id, unique reply IDs:",G.length);let H=new Map;if(G.length>0){const{data:T,error:j}=await se.from("league_messages").select("id, content, user_id").in("id",G);j&&console.error("[useMiniLeagueChat] Error fetching reply messages:",j),!j&&T&&T.forEach(J=>{H.set(J.id,J)})}if(W&&W.length>0){const T=W.filter(j=>j.reply_to_message_id);T.length>0&&(console.log("[fetchPage] Found",T.length,"messages with reply_to_message_id"),T.slice(0,3).forEach(j=>{const J=H.get(j.reply_to_message_id);console.log("[fetchPage] Message",j.id,"reply_to_message_id:",j.reply_to_message_id,"replyData:",J)}))}const D=(W??[]).map(T=>{if(T.reply_to_message_id){const j=H.get(T.reply_to_message_id);j?T.reply_to=j:T.reply_to=null}else T.reply_to=null;return _t(T)}).reverse();y(T=>{rt("useMiniLeagueChat.ts:fetchPage:before-merge","Before merging fetched messages",{prevCount:T.length,normalizedCount:D.length,append:g,prevLatestId:T[T.length-1]?.id,prevLatestCreatedAt:T[T.length-1]?.created_at,normalizedLatestId:D[D.length-1]?.id,normalizedLatestCreatedAt:D[D.length-1]?.created_at,normalizedFirstId:D[0]?.id,normalizedFirstCreatedAt:D[0]?.created_at},"H7");let j;return g?j=st([...D,...T]):j=st([...T,...D]),rt("useMiniLeagueChat.ts:fetchPage:after-merge","After merging fetched messages",{resultCount:j.length,resultLatestId:j[j.length-1]?.id,resultLatestCreatedAt:j[j.length-1]?.created_at,addedCount:j.length-T.length,removedCount:T.length+D.length-j.length},"H7"),j}),(W??[]).length<Jn?f(!1):g||f(!0)},[l,n,y]),A=P.useCallback(async()=>{if(!l||!n){d([]),f(!0);return}if(I.current){console.log("[useMiniLeagueChat] Refresh already in progress, skipping");return}I.current=!0;const C=z.current,g=C.length>0;g||v(!0),k(null);try{const u=C.filter(m=>m.id.startsWith("optimistic-")&&m.status==="sending"),W=Oe(`chat:messages:${l}`);if(W&&W.length>0&&!g){const m=[...W,...u];y(()=>st(m)),W.length>0&&(S.current=W[0].created_at,O.current=W[W.length-1].created_at),f(W.length>=50),v(!1)}console.log("[useMiniLeagueChat] Refreshing messages from database"),await w({append:!1}),u.length>0&&y(m=>{const E=new Set(m.filter(H=>H.id.startsWith("optimistic-")).map(H=>H.id)),G=u.filter(H=>!E.has(H.id));return G.length>0?st([...m,...G]):m}),!g&&W&&W.length>0}catch(u){console.error("[useMiniLeagueChat] Error in refresh:",u),k(u?.message??"Failed to load chat")}finally{I.current=!1,g||v(!1)}},[l,n,w,y]);P.useEffect(()=>{B.current=A,b.current=y},[A,y]);const M=P.useRef({});P.useEffect(()=>{const C={miniLeagueId:l,enabled:n,autoSubscribe:e},g=M.current,u=Object.keys(C).filter(Z=>C[Z]!==g[Z]);if(u.length>0&&rt("useMiniLeagueChat.ts:useEffect:deps-changed","Subscription effect dependencies changed",{changed:u,prevMiniLeagueId:g.miniLeagueId,currentMiniLeagueId:C.miniLeagueId,prevEnabled:g.enabled,currentEnabled:C.enabled,prevAutoSubscribe:g.autoSubscribe,currentAutoSubscribe:C.autoSubscribe,stackTrace:new Error().stack?.split(`
`).slice(0,8).join("|")},"DEPS"),M.current=C,rt("useMiniLeagueChat.ts:useEffect:entry","Subscription effect running",{miniLeagueId:l,enabled:n,autoSubscribe:e,hasMiniLeagueId:!!l,stackTrace:new Error().stack?.split(`
`).slice(0,5).join("|")},"EFFECT"),!l||!n){d([]),f(!0),_.current=null;return}if(_.current===l)return;_.current=l;const W=a.length>0,m=Oe(`chat:messages:${l}`);if(rt("useMiniLeagueChat.ts:useEffect:cache-check","Checking cache on mount",{hasInitialMessages:W,initialMessageCount:a.length,cachedMessageCount:m?.length||0,cachedLatestMessageId:m?.[m.length-1]?.id,cachedLatestMessageContent:m?.[m.length-1]?.content?.slice(0,50),cachedLatestMessageCreatedAt:m?.[m.length-1]?.created_at,cacheKey:`chat:messages:${l}`},"H7"),W||m&&m.length>0?(!W&&m?(y(()=>m),m.length>0&&(S.current=m[0].created_at,O.current=m[m.length-1].created_at),f(m.length>=50)):W&&a.length>0&&(S.current=a[0].created_at,O.current=a[a.length-1].created_at,f(a.length>=50)),_.current=null,typeof window<"u"&&new URLSearchParams(window.location.search).get("tab")==="chat"&&setTimeout(()=>{l===_.current&&B.current?.().catch(()=>{})},200)):B.current?.().finally(()=>{_.current===l&&(_.current=null)}),!e)return()=>{};let E=!0;B.current=A,b.current=y;let G=null,H=Date.now();const D=3e4,T=()=>{G||(G=setInterval(()=>{if(!E)return;const Z=Date.now();if(Z-H>=D&&!I.current){H=Z;const X=O.current;X?(async()=>{try{const{data:ae,error:ie}=await se.from("league_messages").select("id, league_id, user_id, content, created_at, reply_to_message_id").eq("league_id",l).gt("created_at",X).order("created_at",{ascending:!0});if(!E||ie||!ae||ae.length===0)return;const ue=ae.filter(xe=>xe.reply_to_message_id),ge=[...new Set(ue.map(xe=>xe.reply_to_message_id))];if(ge.length>0){const{data:xe}=await se.from("league_messages").select("id, content, user_id").in("id",ge);if(!E||!xe)return;const he=new Map;xe.forEach(be=>{he.set(be.id,be)});const Ce=ae.map(be=>(be.reply_to_message_id&&he.has(be.reply_to_message_id)&&(be.reply_to=he.get(be.reply_to_message_id)),_t(be)));b.current?.(be=>st([...be,...Ce]))}else{const xe=ae.map(he=>_t(he));b.current?.(he=>st([...he,...xe]))}}catch(ae){console.warn("[useMiniLeagueChat] Periodic refresh failed:",ae)}})():B.current?.().catch(ae=>{console.warn("[useMiniLeagueChat] Periodic refresh failed:",ae)})}},D))},j=se.channel(`league-messages:${l}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${l}`},async Z=>{if(E){console.log("[useMiniLeagueChat] Received real-time message:",Z.new.id),rt("useMiniLeagueChat.ts:realtime:received","Real-time message received",{messageId:Z.new.id,content:Z.new.content?.slice(0,50),createdAt:Z.new.created_at,refreshInProgress:I.current,currentMessageCount:a.length},"H8"),I.current&&console.log("[useMiniLeagueChat] Refresh in progress, will add message after refresh completes");try{const{data:X,error:ae}=await se.from("league_messages").select(`
                id, 
                league_id, 
                user_id, 
                content, 
                created_at,
                reply_to_message_id
              `).eq("id",Z.new.id).single();if(ae&&console.error("[useMiniLeagueChat] Error fetching full message:",ae),X){if(X.reply_to_message_id){const{data:ue}=await se.from("league_messages").select("id, content, user_id").eq("id",X.reply_to_message_id).single();ue&&(X.reply_to=ue)}const ie=_t(X);rt("useMiniLeagueChat.ts:realtime:adding","Adding real-time message",{messageId:ie.id,content:ie.content?.slice(0,50),createdAt:ie.created_at,currentMessageCount:a.length},"H8"),b.current?.(ue=>{if(ue.some(xe=>xe.id===ie.id||xe.client_msg_id&&xe.client_msg_id===ie.client_msg_id)){console.log("[useMiniLeagueChat] Message already exists, skipping:",ie.id);const xe=ue.findIndex(he=>he.client_msg_id&&he.client_msg_id===ie.client_msg_id&&he.id.startsWith("optimistic-"));if(xe>=0){const he=[...ue];return he[xe]=ie,st(he)}return ue}return console.log("[useMiniLeagueChat] Adding new message:",ie.id),st([...ue,ie])})}else{console.warn("[useMiniLeagueChat] Failed to fetch full message, using payload data:",Z.new.id);const ie=_t(Z.new);b.current?.(ue=>ue.some(xe=>xe.id===ie.id)?ue:st([...ue,ie]))}}catch(X){console.error("[useMiniLeagueChat] Error processing real-time message:",X);try{const ae=_t(Z.new);b.current?.(ie=>ie.some(ge=>ge.id===ae.id)?ie:st([...ie,ae]))}catch(ae){console.error("[useMiniLeagueChat] Fallback also failed:",ae)}}}}).subscribe(Z=>{console.log("[useMiniLeagueChat] Subscription status:",Z),rt("useMiniLeagueChat.ts:subscription:status","Subscription status changed",{status:Z,miniLeagueId:l,currentMessageCount:a.length},"H8"),Z==="SUBSCRIBED"?(console.log("[useMiniLeagueChat] Successfully subscribed to real-time updates"),T()):Z==="CHANNEL_ERROR"?(console.error("[useMiniLeagueChat] Channel subscription error - will rely on periodic refresh"),T(),setTimeout(()=>{E&&l&&(console.log("[useMiniLeagueChat] Attempting to resubscribe after error"),j.unsubscribe(),j.subscribe())},5e3)):Z==="TIMED_OUT"?(console.warn("[useMiniLeagueChat] Subscription timed out - will rely on periodic refresh"),T(),setTimeout(()=>{E&&l&&(console.log("[useMiniLeagueChat] Attempting to resubscribe after timeout"),j.unsubscribe(),j.subscribe())},5e3)):Z==="CLOSED"&&(rt("useMiniLeagueChat.ts:subscription:CLOSED","Subscription closed",{miniLeagueId:l,active:E,isInitializing:_.current,channelName:`league-messages:${l}`,stackTrace:new Error().stack?.split(`
`).slice(0,8).join("|")},"SUBSCRIPTION"),E?(console.warn("[useMiniLeagueChat] Subscription closed unexpectedly - will rely on periodic refresh"),T()):console.log("[useMiniLeagueChat] Subscription closed during cleanup (expected)"))}),J=()=>{E&&document.visibilityState==="visible"&&!I.current&&(H=Date.now(),B.current?.())};return document.addEventListener("visibilitychange",J),T(),()=>{rt("useMiniLeagueChat.ts:cleanup","Cleanup function called",{miniLeagueId:l,enabled:n,active:E,hasChannel:!!j,stackTrace:new Error().stack?.split(`
`).slice(0,8).join("|")},"CLEANUP"),E=!1,document.removeEventListener("visibilitychange",J),G&&(clearInterval(G),G=null),j&&(rt("useMiniLeagueChat.ts:cleanup:removeChannel","Removing channel",{miniLeagueId:l,channelName:`league-messages:${l}`,stackTrace:new Error().stack?.split(`
`).slice(0,8).join("|")},"CLEANUP"),se.removeChannel(j))}},[l,n,e]);const L=P.useCallback(async()=>{if(!l||!n||!c||i)return;const C=S.current??a[0]?.created_at;if(C){o(!0);try{await w({before:C,append:!0})}catch(g){console.error("[useMiniLeagueChat] Error loading more messages:",g),k(g?.message??"Failed to load more messages")}finally{o(!1)}}},[l,n,c,i,w,a]),U=P.useCallback(async(C,g)=>{if(!l||!t)throw new Error("Missing league or user");const u=C.trim();if(!u)return;const W=ks(),m=`optimistic-${W}`,E={id:m,client_msg_id:W,league_id:l,user_id:t,content:u,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:g??null};y(D=>st([...D,E]));const{data:G,error:H}=await se.from("league_messages").insert({league_id:l,user_id:t,content:u,reply_to_message_id:g??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(G&&G.reply_to_message_id){const{data:D}=await se.from("league_messages").select("id, content, user_id").eq("id",G.reply_to_message_id).single();D&&(G.reply_to=D)}if(H)throw console.error("[useMiniLeagueChat] Error sending message:",H),y(D=>D.map(T=>T.id===m?{...T,status:"error"}:T)),H;if(G){if(G.reply_to_message_id){const{data:T}=await se.from("league_messages").select("id, content, user_id").eq("id",G.reply_to_message_id).single();T&&(G.reply_to=T)}const D=_t(G);D.client_msg_id=W,D.status="sent",rt("useMiniLeagueChat.ts:sendMessage:success","Message sent successfully",{messageId:D.id,clientMsgId:W,contentLength:D.content.length,contentPreview:D.content.slice(0,50),createdAt:D.created_at,hasReply:!!D.reply_to_message_id},"H11"),y(T=>{const j=T.findIndex(Z=>Z.id===m||Z.client_msg_id===W&&Z.id.startsWith("optimistic-"));let J;if(j>=0){const Z=[...T];Z[j]=D,J=st(Z)}else T.some(X=>X.id===D.id||X.client_msg_id===W&&!X.id.startsWith("optimistic-"))?J=T:J=st([...T,D]);if(l&&J.length>0){const Z=J.filter(X=>!X.id.startsWith("optimistic-"));if(Z.length>0){const X=`chat:messages:${l}`;F.current=Date.now(),hn(X,Z,mn.HOME)}}return J})}},[l,t,y]),R=P.useMemo(()=>a.slice(-5),[a]);return{messages:a,previewMessages:R,loading:x,loadingMore:i,hasMore:c,error:p,refresh:A,loadMore:L,sendMessage:U}}const As={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},Rs={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},Ms=["","",""],Ls=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function Ts({author:l,text:h,time:t,isOwnMessage:n,shape:e="single",messageId:r,reactions:a=[],onReactionClick:d,replyTo:x,onMessageClick:v}){const i="text-left",o=n?"bg-[#1C8376] text-white":"bg-white text-slate-900",c=n?Rs:As,f="max-w-[85%]",[p,k]=P.useState(!1),[S,_]=P.useState(!1),I=P.useRef(null);P.useEffect(()=>{if(!p)return;const z=B=>{I.current&&!I.current.contains(B.target)&&k(!1)},y=setTimeout(()=>{document.addEventListener("mousedown",z)},100);return()=>{clearTimeout(y),document.removeEventListener("mousedown",z)}},[p]);const O=z=>{r&&d&&d(r,z),k(!1),_(!1)},F=z=>{const y=z.target;y.closest("button")||y.closest("[data-reaction]")||v&&v()};return s.jsxs("div",{className:`inline-block ${f} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},children:[s.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${i} ${o} ${c[e]} ${v?"cursor-pointer":""}`,onClick:F,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[l&&!n&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:l}),x&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${n?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-xs`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[s.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:x.authorName||"Unknown"}),s.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:x.content})]}),s.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[s.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:h}),s.jsx("span",{className:`text-[11px] relative top-1 ${n?"text-[#DCDCDD]":"text-slate-400"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:t})]})]}),r&&!n&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[p&&s.jsxs("div",{ref:I,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[Ms.map(z=>s.jsx("button",{onClick:()=>O(z),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${z}`,children:z},z)),v&&s.jsx("button",{onClick:()=>{k(!1),v()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{k(!1),_(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>k(!p),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),S&&r&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>_(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>_(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 rounded-lg",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:Ls.map(z=>s.jsx("button",{onClick:()=>{r&&d&&d(r,z),_(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 flex items-center justify-center text-2xl",title:z,children:z},z))})]})})]}),a.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${n?"justify-end":"justify-start"}`,children:a.map(z=>s.jsxs("button",{onClick:()=>O(z.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${z.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700"}`,children:[s.jsx("span",{className:"text-base",children:z.emoji}),s.jsx("span",{children:z.count})]},z.emoji))})]})}function Ds({author:l,messages:h,isOwnMessage:t,avatarInitials:n,userId:e,reactions:r,onReactionClick:a,onMessageClick:d}){l==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",t,"messages:",h.length);const x=t?"justify-end":"justify-start",v=e===nr;return s.jsxs("div",{className:`flex items-end gap-2 w-full ${x}`,children:[t?s.jsx("div",{className:"w-8 flex-shrink-0"}):v?s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:Ur,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs font-semibold text-slate-500 flex-shrink-0",children:(n||l.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:h.map((i,o)=>{const c=h.length===1?"single":o===0?"top":o===h.length-1?"bottom":"middle",f=i.messageId||i.id;let p="";if(typeof i.text=="string")p=i.text;else if(typeof i.text=="object"&&i.text!==null){const k=i.text?.props?.children||String(i.text);p=typeof k=="string"?k:String(k)}else p=String(i.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${t?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${t?"justify-end":"justify-start"}`,children:[s.jsx(Ts,{author:!t&&o===0?l:void 0,text:i.text,time:i.time,isOwnMessage:t,shape:c,messageId:f,reactions:r?.[f]||[],onReactionClick:a,replyTo:i.replyTo,onMessageClick:d?()=>d(f,p,!t&&o===0?l:void 0):void 0}),i.status&&s.jsx("div",{className:`text-[11px] ml-2 ${i.status==="error"?"text-red-500":"text-slate-400"}`,children:i.status==="error"?"Failed":"Sending"})]})},i.id)})})]})}function Ps({groups:l,reactions:h,onReactionClick:t,onMessageClick:n}){const e=l.filter(r=>r.author==="Unknown");return e.length>0&&(console.error("[ChatThread] RENDERING with",e.length,'groups with "Unknown" author!'),e.forEach((r,a)=>{console.error(`[ChatThread] Group ${a}: id="${r.id}", author="${r.author}", messages=${r.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:l.map((r,a)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[r.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:r.dayLabel}),s.jsx(Ds,{author:r.author,avatarInitials:r.avatarInitials,isOwnMessage:r.isOwnMessage,userId:r.userId,messages:r.messages,reactions:h,onReactionClick:t,onMessageClick:n},`${r.id}-${r.author}-${a}`)]},`${r.id}-${r.author}-${a}`))})}const Is=l=>new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Us=l=>new Date(l).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Qn=l=>{if(!l)return"?";const h=l.trim().split(/\s+/);return h.length===1?h[0][0]?.toUpperCase()??"?":`${h[0][0]?.toUpperCase()??""}${h[h.length-1][0]?.toUpperCase()??""}`},Lt=(l,h)=>h?h instanceof Map?h.get(l)??"":h[l]??"":"";function Fs({miniLeagueId:l,memberNames:h,deepLinkError:t}){const{user:n}=rr(),{messages:e,error:r,sendMessage:a}=Es(l,{userId:n?.id,enabled:!!l}),[d,x]=P.useState(""),[v,i]=P.useState(!1),[o,c]=P.useState({}),[f,p]=P.useState(null),[k,S]=P.useState([]),_=P.useRef(null),I=P.useRef(null),O=P.useRef(null),F=P.useRef(!1),[z,y]=P.useState(0);P.useEffect(()=>{if(!l||!n?.id)return;let m=!0;const E=async()=>{if(m)try{const{error:H}=await se.from("chat_presence").upsert({league_id:l,user_id:n.id,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});H&&console.warn("[MiniLeagueChatBeta] Failed to update presence:",H)}catch(H){console.warn("[MiniLeagueChatBeta] Error updating presence:",H)}};E();const G=setInterval(()=>{m&&E()},1e4);return()=>{m=!1,clearInterval(G),l&&n?.id&&(async()=>{try{await se.from("chat_presence").delete().eq("league_id",l).eq("user_id",n.id)}catch{}})()}},[l,n?.id]),P.useEffect(()=>{F.current=!1},[l]);const B=P.useCallback(()=>{if(_.current){const m=_.current.scrollHeight-_.current.clientHeight;_.current.scrollTop=m}},[]);P.useEffect(()=>{if(e.length===0||!n?.id)return;const m=e.map(G=>G.id).filter(G=>!G.startsWith("optimistic-"));if(m.length===0)return;(async()=>{try{const{data:G,error:H}=await se.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",m);if(H){S(j=>[...j,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${H.message}`,timestamp:Date.now()}]);return}const D={};(G||[]).forEach(j=>{D[j.message_id]||(D[j.message_id]={}),D[j.message_id][j.emoji]||(D[j.message_id][j.emoji]={count:0,hasUserReacted:!1}),D[j.message_id][j.emoji].count++,j.user_id===n.id&&(D[j.message_id][j.emoji].hasUserReacted=!0)});const T={};Object.keys(D).forEach(j=>{T[j]=Object.entries(D[j]).map(([J,Z])=>({emoji:J,count:Z.count,hasUserReacted:Z.hasUserReacted}))}),c(T)}catch(G){S(H=>[...H,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${G?.message||String(G)}`,timestamp:Date.now()}])}})()},[e,n?.id]),P.useEffect(()=>{if(e.length===0||!n?.id)return;const m=e.map(G=>G.id).filter(G=>!G.startsWith("optimistic-"));if(m.length===0)return;const E=se.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},async()=>{try{const{data:G,error:H}=await se.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",m);if(H)return;const D={};(G||[]).forEach(j=>{D[j.message_id]||(D[j.message_id]={}),D[j.message_id][j.emoji]||(D[j.message_id][j.emoji]={count:0,hasUserReacted:!1}),D[j.message_id][j.emoji].count++,j.user_id===n.id&&(D[j.message_id][j.emoji].hasUserReacted=!0)});const T={};Object.keys(D).forEach(j=>{T[j]=Object.entries(D[j]).map(([J,Z])=>({emoji:J,count:Z.count,hasUserReacted:Z.hasUserReacted}))}),c(T)}catch{}}).subscribe();return()=>{se.removeChannel(E)}},[e,n?.id]);const b=P.useCallback(async(m,E)=>{if(!n?.id)return;const H=(o[m]||[]).find(D=>D.emoji===E&&D.hasUserReacted);if(c(D=>{const T={...D},j=T[m]||[];if(H){const J=j.map(Z=>Z.emoji===E?{...Z,count:Math.max(0,Z.count-1),hasUserReacted:!1}:Z).filter(Z=>Z.count>0||Z.emoji!==E);J.length===0?delete T[m]:T[m]=J}else j.find(Z=>Z.emoji===E)?T[m]=j.map(Z=>Z.emoji===E?{...Z,count:Z.count+1,hasUserReacted:!0}:Z):T[m]=[...j,{emoji:E,count:1,hasUserReacted:!0}];return T}),H){const{error:D}=await se.from("league_message_reactions").delete().eq("message_id",m).eq("user_id",n.id).eq("emoji",E);D&&c(T=>{const j={...T},J=j[m]||[];return J.find(X=>X.emoji===E)?j[m]=J.map(X=>X.emoji===E?{...X,count:X.count+1,hasUserReacted:!0}:X):j[m]=[...J,{emoji:E,count:1,hasUserReacted:!0}],j})}else{const{error:D}=await se.from("league_message_reactions").upsert({message_id:m,user_id:n.id,emoji:E});D&&c(T=>{const j={...T},Z=(j[m]||[]).map(X=>X.emoji===E?{...X,count:Math.max(0,X.count-1),hasUserReacted:!1}:X).filter(X=>X.count>0||X.emoji!==E);return Z.length===0?delete j[m]:j[m]=Z,j})}},[n?.id,o]);P.useEffect(()=>{!d&&I.current&&(I.current.style.height="auto",I.current.style.height="42px")},[d]);const w=P.useCallback(m=>{const E=O.current?.offsetHeight||72;if(m>0){const G=m+E;if(y(m),_.current){const H=`${G+8}px`;_.current.style.paddingBottom=H}}else if(y(0),_.current){const G=`${E+8}px`;_.current.style.paddingBottom=G}requestAnimationFrame(()=>{B()})},[B]);P.useEffect(()=>{const m=window.visualViewport;if(!m)return;let E=null,G=0,H=!1;setTimeout(()=>{H=!0},500);const D=()=>{const X=window.innerHeight,ae=m.height,ie=m.offsetTop+ae;return Math.max(0,X-ie)},T=()=>{E&&clearTimeout(E),E=setTimeout(()=>{const X=D();H&&Math.abs(X-G)>10&&(G=X,w(X))},50)};m.addEventListener("resize",T),m.addEventListener("scroll",T),window.addEventListener("resize",T);const j=()=>{setTimeout(T,50)},J=()=>{setTimeout(T,100)},Z=setTimeout(()=>{I.current&&(I.current.addEventListener("focus",j),I.current.addEventListener("blur",J))},100);return T(),()=>{E&&clearTimeout(E),clearTimeout(Z),m.removeEventListener("resize",T),m.removeEventListener("scroll",T),window.removeEventListener("resize",T),I.current&&(I.current.removeEventListener("focus",j),I.current.removeEventListener("blur",J))}},[w]),P.useEffect(()=>{if(_.current&&O.current){const E=`${(O.current.offsetHeight||72)+8}px`;_.current.style.paddingBottom=E}},[]);const A=()=>{I.current&&I.current.removeAttribute("readonly");const m=()=>{const E=window.visualViewport;if(E){const G=window.innerHeight,H=E.height,D=E.offsetTop+H,T=Math.max(0,G-D);w(T)}};setTimeout(m,50),setTimeout(m,150),B()},M=m=>{const E=m.target;!(E.tagName==="A"||E.tagName==="BUTTON"||E.closest("a, button"))&&I.current&&document.activeElement===I.current&&I.current.blur()},L=P.useMemo(()=>{if(!n)return"";const m=n.user_metadata??{};return m.display_name||m.full_name||n.email||""},[n]),U=P.useMemo(()=>{if(!e.length)return[];if(!(h instanceof Map?h.size>0:h?Object.keys(h).length>0:!1))return[];let E=null;return e.reduce((H,D)=>{const T=D.user_id===n?.id,Z=Lt(D.user_id,h)||(T?L:"")||(T?"You":"Unknown"),X=T?void 0:Qn(Z),ie=new Date(D.created_at).toDateString(),ue=ie!==E;ue&&(E=ie);const ge=D.reply_to?Lt(D.reply_to.user_id,h)||"Unknown":null,xe={id:D.id,text:D.content,time:Is(D.created_at),status:D.status&&D.status!=="sent"?D.status:void 0,messageId:D.id,replyTo:D.reply_to?{id:D.reply_to.id,content:D.reply_to.content,authorName:ge||void 0}:null},he=H[H.length-1],Ce=he?.messages.length>0&&he.messages[0].messageId?e.find(ve=>ve.id===he.messages[0].messageId)?.user_id:null;if(he&&!ue&&he.isOwnMessage===T&&Ce===D.user_id){const ve=he.id.includes("-")?he.id.split("-")[0]:he.id,ye=he.messages.map(Se=>{const _e=Se.messageId?e.find(Me=>Me.id===Se.messageId):null;if(_e?.reply_to){const Me=Lt(_e.reply_to.user_id,h)||"Unknown";return{...Se,replyTo:Se.replyTo?{...Se.replyTo,authorName:Me}:null}}return Se}),De={...he,id:`${ve}-${Z}`,author:Z,avatarInitials:X,userId:D.user_id,messages:[...ye,xe]};return[...H.slice(0,-1),De]}else return[...H,{id:`${D.id}-${Z}`,author:Z,avatarInitials:X,isOwnMessage:T,userId:D.user_id,dayLabel:ue?Us(D.created_at):void 0,messages:[xe]}]},[]).map(H=>{const D={...H},T=D.messages.map(j=>{const J=j.messageId?e.find(Z=>Z.id===j.messageId):null;if(J?.reply_to&&j.replyTo){const Z=Lt(J.reply_to.user_id,h)||"Unknown";if(Z!==j.replyTo.authorName)return{...j,replyTo:{...j.replyTo,authorName:Z}}}return j});if(D.author==="Unknown"&&D.messages.length>0&&D.messages[0].messageId){const j=e.find(J=>J.id===D.messages[0].messageId);if(j){const J=Lt(j.user_id,h);if(J&&J!=="Unknown"){const Z=D.id.includes("-")?D.id.split("-")[0]:D.id;return{...D,id:`${Z}-${J}`,author:J,avatarInitials:Qn(J),userId:j.user_id,messages:T}}}}return{...D,messages:T}})},[L,h,e,n?.id]),R=P.useMemo(()=>{const m=U.map(G=>G.author).join(","),E=U.some(G=>G.author==="Unknown");return`chat-${U.length}-${E?"unknown":"resolved"}-${m.slice(0,50)}`},[U]),C=P.useCallback(m=>{if(_.current=m,m){if(O.current){const G=`${(O.current.offsetHeight||72)+8}px`;m.style.paddingBottom=G}else m.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{m&&e.length>0&&U.length>0})})}},[e.length,U.length]);P.useEffect(()=>{F.current=!1},[l]),P.useEffect(()=>{e.length>0&&_.current&&(F.current||(F.current=!0),requestAnimationFrame(()=>{if(_.current){const m=_.current.scrollHeight,E=_.current.clientHeight,G=m-E;m>E&&(_.current.scrollTop=G)}}))},[e.length,e]);const g=P.useCallback(async m=>{if(!l||!n?.id){fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:notifyRecipients:early-return",message:"notifyRecipients skipped - missing miniLeagueId or userId",data:{hasMiniLeagueId:!!l,hasUserId:!!n?.id},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{});return}const E=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");if(fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:notifyRecipients:localhost-check",message:"Checking if running locally",data:{isLocal:E,hostname:typeof window<"u"?window.location.hostname:"unknown",willSkip:E},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{}),E){console.log("[Chat] Notifications skipped: running on localhost. Notifications only work on staging/production.");return}const G=n.user_metadata?.display_name||n.user_metadata?.full_name||n.email||"User";fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:notifyRecipients:before-fetch",message:"Calling notifyLeagueMessage function",data:{leagueId:l,senderId:n.id,senderName:G,contentLength:m.length,contentPreview:m.slice(0,50)},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{});try{const H=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:l,senderId:n.id,senderName:G,content:m,activeUserIds:[n.id]})}),D=await H.json().catch(()=>({}));fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:notifyRecipients:after-fetch",message:"notifyLeagueMessage function response",data:{status:H.status,ok:H.ok,result:D,hasError:!!D.error,recipients:D.recipients,sent:D.sent},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{})}catch(H){fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:notifyRecipients:error",message:"Error calling notifyLeagueMessage",data:{error:H?.message||String(H),errorType:H?.constructor?.name},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{})}},[l,n?.id]),u=P.useCallback(async()=>{const m=d.trim();if(!(!l||!m||v))try{i(!0),x(""),I.current&&(I.current.style.height="auto",I.current.style.height="42px"),fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:handleSend:before-send",message:"About to send message",data:{textLength:m.length,textPreview:m.slice(0,50),hasReply:!!f,miniLeagueId:l},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{}),await a(m,f?.id||null),fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"MiniLeagueChatBeta.tsx:handleSend:after-send",message:"Message sent, about to notify recipients",data:{textLength:m.length,miniLeagueId:l},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H11"})}).catch(()=>{}),await g(m),p(null),B()}catch(E){S(G=>[...G,{id:`send-${Date.now()}`,message:`Failed to send message: ${E?.message||String(E)}`,timestamp:Date.now()}]),x(m)}finally{i(!1)}},[d,l,g,B,a,v,f]);P.useEffect(()=>{t&&S(m=>m.some(E=>E.message.includes("Deep Link"))?m:[...m,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${t}`,timestamp:Date.now()}])},[t]),P.useEffect(()=>{if(k.length===0)return;const m=setTimeout(()=>{S(E=>E.filter(G=>Date.now()-G.timestamp<5e3))},5e3);return()=>clearTimeout(m)},[k]);const W=e.length>0&&U.length>0;return s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[k.length>0&&s.jsx("div",{className:"px-4 pt-2 space-y-2",children:k.map(m=>s.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[s.jsx("span",{className:"flex-1",children:m.message}),s.jsx("button",{onClick:()=>S(E=>E.filter(G=>G.id!==m.id)),className:"text-red-600 flex-shrink-0",children:""})]},m.id))}),s.jsx("div",{ref:C,className:"flex-1 overflow-y-auto px-4 py-5",onClick:M,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingBottom:"91px"},children:W?s.jsx(s.Fragment,{children:s.jsx(Ps,{groups:U,reactions:o,onReactionClick:b,onMessageClick:(m,E,G)=>{const H=e.find(D=>D.id===m);if(H){let D="";if(typeof E=="string")D=E;else if(typeof E=="object"&&E!==null){const T=E?.props?.children||String(E);D=typeof T=="string"?T:String(T)}else D=String(E);p({id:m,content:D||H.content,authorName:G}),setTimeout(()=>{I.current?.focus()},100)}}},R)}):null}),s.jsxs("div",{ref:O,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:z>0?"fixed":"relative",bottom:z>0?`${z}px`:"0",left:z>0?0:"auto",right:z>0?0:"auto",width:"100%",maxWidth:z>0?"440px":"100%",marginLeft:z>0?"auto":void 0,marginRight:z>0?"auto":void 0,zIndex:z>0?100:"auto",boxShadow:z>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[f&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",f.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:f.content})]}),s.jsx("button",{onClick:()=>p(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:I,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:d,disabled:!l||v,placeholder:l?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:m=>{if(m.key==="Escape"&&f){p(null),m.preventDefault();return}m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),u())},onChange:m=>{x(m.target.value),I.current&&(I.current.style.height="auto",I.current.style.height=`${Math.min(I.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const E=window.visualViewport;if(E){const G=window.innerHeight,H=E.height,D=E.offsetTop+H,T=G-D;w(T)}})},onFocus:A,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:u,disabled:!l||v||!d.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),r&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[r,"  try again or switch to the classic chat tab."]})]})]})}function zs({winnerName:l,isDraw:h}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:h?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[l," Wins!"]})})})}function Os({availableGws:l,selectedGw:h,onChange:t,className:n=""}){return l.length<=1?null:s.jsx("div",{className:`flex-1 ${n}`,children:s.jsx("select",{value:h||void 0,onChange:e=>{const r=parseInt(e.target.value,10);t(r)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:l.map(e=>s.jsxs("option",{value:e,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",e]},e))})})}function Ws({showForm:l,onToggle:h}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>h(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${l?"text-slate-600":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>h(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${l?"bg-[#1C8376] text-white shadow-sm":"text-slate-600"}`,children:"Form"})]})}function Hs({form:l}){const h=l.slice(-5),t=5-h.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:t}).map((n,e)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${e}`)),h.map((n,e)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${n==="W"?"bg-green-100 text-green-700":n==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n},e))]})}function $s({rows:l,members:h,showForm:t,currentUserId:n,loading:e,isLateStartingLeague:r}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),t?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:r?"CP":"OCP"}),h.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[l.map((a,d)=>{const x=a.user_id===n,v=d===l.length-1;return s.jsxs("tr",{className:x?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...v?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:d+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap bg-slate-50 pl-2 pr-4 overflow-hidden text-ellipsis",children:a.name}),t?s.jsx("td",{className:"px-4 py-4 bg-slate-50",children:s.jsx(Hs,{form:a.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-10 pl-1 pr-1",children:a.ocp}),h.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-10 pl-1 pr-1",children:a.mltPts})]})]},a.user_id)}),e&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:h.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!e&&!l.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:h.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function Bs({rows:l,members:h,currentUserId:t,positionChangeKeys:n,isApiTestLeague:e,hasLiveFixtures:r,hasStartingSoonFixtures:a,hasStartedFixtures:d,allFixturesFinished:x,resGw:v}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",e&&r&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),e&&!x&&a&&!r&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:d?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),h.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[l.map((i,o)=>{const c=i.user_id===t,f=o===l.length-1,p=n.has(i.user_id);return s.jsxs("tr",{className:`${c?"flash-user-row":""} ${p?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...f?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:o+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[e&&r&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),e&&!r&&a&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:i.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-[50px] pl-1 pr-1 ${e&&r?"pulse-live-score":""}`,children:i.score}),h.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1 ${e&&r?"pulse-live-score":""}`,children:i.unicorns})]},i.user_id)}),!l.length&&s.jsx("tr",{className:"bg-slate-50",children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center bg-slate-50",colSpan:h.length>=3?4:3,children:["No results recorded for GW ",v," yet."]})})]})]})})]})}function Gs(l){const h=Fr(),t=encodeURIComponent(l);if(h){const n=`whatsapp://send?text=${t}`;let e=!1,r=!1;try{const a=document.createElement("a");a.href=n,a.style.display="none",document.body.appendChild(a),a.click(),e=!0,setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},100)}catch{}if(!e)try{window.open(n),r=!0}catch{}if(!e&&!r)try{window.location.href=n}catch{window.open(`https://wa.me/?text=${t}`,"_blank")}}else{const n=`https://wa.me/?text=${t}`;try{window.open(n,"_blank")}catch{navigator.clipboard.writeText(l).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+l)})}}}function qs(l,h){const t=new Date(h.find(o=>o.gw===l)?.kickoff_time||""),n=new Date(t.getTime()-4500*1e3),e=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],r=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],a=e[n.getUTCDay()],d=n.getUTCDate(),x=r[n.getUTCMonth()],v=n.getUTCHours().toString().padStart(2,"0"),i=n.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${l} Predictions Reminder!

DEADLINE: THIS ${a} ${d} ${x}, ${v}:${i} BST

Don't forget!
playtotl.com`}function Vs(l,h){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",l);try{const t=qs(l,h);console.log("[SubmissionStatusTable] Generated message:",t),Gs(t)}catch(t){console.error("[SubmissionStatusTable] Error in handleShareReminder:",t),alert("Error sharing reminder. Please try again.")}}function Xn({members:l,submittedMap:h,picksGw:t,allSubmitted:n,remaining:e,fixtures:r,onShareReminder:a,variant:d="full"}){const x=a||(()=>Vs(t,r)),v=r.map(p=>p.kickoff_time).filter(p=>!!p).map(p=>new Date(p)).filter(p=>!isNaN(p.getTime())),i=v.length>0?new Date(Math.min(...v.map(p=>p.getTime()))):null,o=i?new Date(i.getTime()-4500*1e3):null,c=o?new Date>=o:!1;let f="";if(o){const p=d==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],S=p[o.getUTCDay()],_=o.getUTCDate(),I=k[o.getUTCMonth()],O=o.getUTCHours().toString().padStart(2,"0"),F=o.getUTCMinutes().toString().padStart(2,"0");f=`${S} ${_} ${I}, ${O}:${F} BST`}return d==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",l.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),x()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${c?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),c?"Deadline Passed:":"Deadline:",f]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:l.slice().sort((p,k)=>p.name.localeCompare(k.name)).map(p=>{const k=`${p.id}:${t}`,S=!!h.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:p.name}),s.jsx("td",{className:"px-4 py-3",children:S?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},p.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:n?s.jsxs(s.Fragment,{children:["All ",l.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",l.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),x()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&s.jsxs("div",{className:`mb-3 text-sm ${c?"text-orange-600 font-semibold":"text-slate-600"}`,children:[c?" Deadline Passed:":" Deadline:",f]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:l.slice().sort((p,k)=>p.name.localeCompare(k.name)).map(p=>{const k=`${p.id}:${t}`,S=!!h.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:p.name}),s.jsx("td",{className:"px-4 py-3",children:S?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},p.id)})})]})})]})}function er({letter:l,correct:h,unicorn:t,hasSubmitted:n,isLive:e,isOngoing:r,isFinished:a}){let d;return h===!0?e||r?d="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":a?d="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":d="bg-emerald-600 text-white border-emerald-600":n?d="bg-emerald-600 text-white border-emerald-600":d="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",d].join(" "),title:t?"Correct!":void 0,children:l})}function Ks(l,h){return l==="FINISHED"?"FT":l==="PAUSED"?"HT":l==="IN_PLAY"?h==null?"LIVE":`${h}'`:"LIVE"}function Ys(l){const h=(l||"?").trim().split(/\s+/);return h.length?h.length===1?h[0].slice(0,1).toUpperCase():(h[0][0]+h[h.length-1][0]).toUpperCase():"?"}function Zs({fixture:l,picks:h,members:t,outcome:n,liveScore:e,submittedMap:r,picksGw:a,isApiTestLeague:d=!1}){const x=l.home_code||l.home_team||l.home_name||"",v=l.away_code||l.away_team||l.away_name||"",i=Dn(x)||l.home_name||l.home_team||"Home",o=Dn(v)||l.away_name||l.away_team||"Away",f=(F=>{if(!F)return"";const z=new Date(F);if(isNaN(z.getTime()))return"";const y=String(z.getUTCHours()).padStart(2,"0"),B=String(z.getUTCMinutes()).padStart(2,"0");return`${y}:${B}`})(l.kickoff_time),p=!!(e&&e.status==="IN_PLAY"),k=!!(e&&(e.status==="PAUSED"||e.status==="HALF_TIME"||e.status==="HT")),S=!!(e&&e.status==="FINISHED"),_=p||k;let I=null;d&&e?e.homeScore>e.awayScore?I="H":e.awayScore>e.homeScore?I="A":e.homeScore===e.awayScore&&(I="D"):I=n;const O=F=>{const z=h.filter(w=>w.pick===F),y=h.length===t.length&&z.length===t.length,B=4,b=[];for(let w=0;w<z.length;w+=B){const A=z.slice(w,w+B);b.push(A)}return s.jsx("div",{className:"flex flex-col gap-1",children:b.map((w,A)=>s.jsx("div",{className:"flex items-center justify-center",children:w.map((M,L)=>{const U=t.find(u=>u.id===M.user_id),R=Ys(U?.name??"?"),C=r.has(`${M.user_id}:${a}`),g=I&&I===F?!0:null;return y?s.jsx("span",{className:"inline-block",style:{marginLeft:L>0?"-8px":"0",position:"relative",zIndex:L},children:s.jsx(er,{letter:R,correct:g,unicorn:g===!0,hasSubmitted:C,isLive:p,isOngoing:_,isFinished:S})},M.user_id):s.jsx(er,{letter:R,correct:g,unicorn:g===!0,hasSubmitted:C,isLive:p,isOngoing:_,isFinished:S},M.user_id)})},A))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(p||k)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),S&&!p&&!k&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${_?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:i})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(Pn,{code:l.home_code||void 0,crest:l.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:e&&(p||k||S)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[e.homeScore," - ",e.awayScore]}):s.jsx("span",{children:f})}),s.jsx(Pn,{code:l.away_code||void 0,crest:l.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})})]}),e&&(_||S)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${_?"text-red-600":"text-slate-500"}`,children:Ks(e.status,e.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:O("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:O("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:O("A")})})]})]})})}function tr({label:l,fixtures:h,picksByFixture:t,members:n,outcomes:e,liveScores:r,submittedMap:a,picksGw:d,isApiTestLeague:x=!1,isFirstSection:v=!1,hasLiveGames:i=!1,allGamesFinished:o=!1,allSubmitted:c=!1,resultsPublished:f=!1,deadlinePassed:p=!1,whoDidntSubmit:k=[],liveFixturesCount:S,hasStarted:_=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(zr,{date:l,className:"text-lg font-normal"}),v&&s.jsxs(s.Fragment,{children:[x&&i&&S!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:S}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:h.length})]})]}),x&&o&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),x&&!_&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!x&&c&&f&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!x&&c&&!f&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!x&&p&&!c&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",k.length>0&&`(${k.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[h.map(I=>{try{const O=t.get(I.fixture_index)??[],F=e.get(I.fixture_index)||null,z=r[I.fixture_index]||null;return s.jsx(Zs,{fixture:I,picks:O,members:n,outcome:F,liveScore:z,submittedMap:a,picksGw:d,isApiTestLeague:x},`${I.gw}-${I.fixture_index}`)}catch(O){return console.error("Error rendering fixture:",O,I),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",I.fixture_index]},`${I.gw}-${I.fixture_index}`)}}),!h.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const un=8;function fn(l){return l.result==="H"||l.result==="D"||l.result==="A"?l.result:typeof l.home_goals=="number"&&typeof l.away_goals=="number"?l.home_goals>l.away_goals?"H":l.home_goals<l.away_goals?"A":"D":null}function Qs(){const{code:l=""}=Or(),[h,t]=Wr(),{user:n}=rr(),[e]=P.useState(()=>{const N=localStorage.getItem("oldSchoolMode");return N?JSON.parse(N):!1});P.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(e))},[e]),P.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const N=()=>{const K=document.querySelector(".league-header-fixed");if(K){const oe=K.style.top||window.getComputedStyle(K).top;oe!=="0px"&&oe!=="0"&&(K.style.top="0",K.style.transform="translate3d(0, 0, 0)")}},$=()=>{N(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},q=K=>{const oe=K.target;oe.closest(".league-content-wrapper")||oe.closest(".league-header-fixed")||oe.closest(".chat-tab-wrapper")||K.preventDefault()};window.addEventListener("scroll",$,{passive:!0}),document.addEventListener("touchmove",q,{passive:!1});const V=setInterval(N,100);return N(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",$),document.removeEventListener("touchmove",q),clearInterval(V)}},[]),P.useEffect(()=>{const N=q=>{const V=q.target;(V.tagName==="INPUT"||V.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const K=document.querySelector(".league-header-fixed");K&&(K.style.top="0")},100)},$=()=>{const q=document.querySelector(".league-header-fixed");q&&(q.style.top="0")};return document.addEventListener("focusin",N),window.addEventListener("resize",$),window.addEventListener("orientationchange",$),()=>{document.removeEventListener("focusin",N),window.removeEventListener("resize",$),window.removeEventListener("orientationchange",$)}},[]),P.useEffect(()=>{if(typeof window>"u")return;const N=window.visualViewport;if(!N)return;let $=null;const q=()=>{const K=B.current;if(!K)return;const oe=N.offsetTop??0;K.style.setProperty("transform",`translate3d(0, ${oe}px, 0)`,"important")},V=()=>{$&&cancelAnimationFrame($),$=window.requestAnimationFrame(q)};return V(),N.addEventListener("resize",V),N.addEventListener("scroll",V),()=>{$&&cancelAnimationFrame($),N.removeEventListener("resize",V),N.removeEventListener("scroll",V),B.current&&B.current.style.removeProperty("transform")}},[]);const r=()=>{if(!l)return null;try{const N=Oe(`leagues:${n?.id||""}`);if(N){const $=N.find(q=>q.code.toUpperCase()===l.toUpperCase());if($)return $}}catch{}return null},[a,d]=P.useState(()=>r()),[x,v]=P.useState(!1),i=()=>{const N=r();if(!N?.id)return[];try{const $=Oe(`league:members:${N.id}`);if($&&$.length>0)return $.map(([q,V])=>({id:q,name:V||"(no name)"}))}catch{}return[]},[o,c]=P.useState(i),[f,p]=P.useState(()=>!r()),k="chat",[S,_]=P.useState(k),[I,O]=P.useState(null),F=P.useRef(S);P.useEffect(()=>{F.current=S},[S]);const z=P.useRef(!1),y=P.useRef(!1);P.useEffect(()=>{const N=h.get("tab"),$=h.get("leagueCode");if(O(null),N==="chat"||$){if($&&l!==$){O(`Deep link mismatch: URL has leagueCode=${$} but we're on league ${l}. Current URL: ${window.location.href}`);return}if(N==="chat"){S!=="chat"&&(_("chat"),setTimeout(()=>{F.current!=="chat"&&O(`Failed to open chat tab. Current tab: ${F.current}, Expected: chat. URL: ${window.location.href}`)},300));const q=setTimeout(()=>{t({},{replace:!0})},200);return()=>clearTimeout(q)}}},[h,t,S,l]);const B=P.useRef(null),[b,w]=P.useState(!1),[A,M]=P.useState(!1),[L,U]=P.useState(!1),R=()=>{try{return Oe("app_meta:current_gw")?.current_gw??null}catch{return null}},[C,g]=P.useState(R),[u,W]=P.useState(null),[m,E]=P.useState(R),G=()=>{try{return Oe("app:available_gws")??[]}catch{return[]}},[H,D]=P.useState(()=>G()),T=P.useRef({}),j=P.useRef({}),J=P.useRef(new Map),[Z,X]=P.useState(new Set),[ae,ie]=P.useState(!1),[ue,ge]=P.useState(!1),[xe,he]=P.useState(0),[Ce,be]=P.useState(!1),[ve,ye]=P.useState(!1),[De,Se]=P.useState(!1),[_e,Me]=P.useState(!1),[Ae,pe]=P.useState(null),[qe,Be]=P.useState(!1),[Xe,Re]=P.useState(null),[ft,Fe]=P.useState({x:0,y:0}),[Ve,Ge]=P.useState(1),[Ye,et]=P.useState(null),[ze,ht]=P.useState(null),[Gt,vt]=P.useState(!1),[Tt,mt]=P.useState(!1),[Et,ot]=P.useState(!1),[tt,nt]=P.useState(!1),[yt,Ct]=P.useState(!1),[pt,lt]=P.useState(!1),[Dt,wn]=P.useState(null),[qt,bn]=P.useState(!1),[Vt,vn]=P.useState(!1),[At,pr]=P.useState(null),gt=P.useMemo(()=>!!n?.id&&o.some(N=>N.id===n.id),[n?.id,o]),yn=P.useMemo(()=>!!n?.id&&!!At&&At.id===n.id,[n?.id,At]),gr=P.useMemo(()=>At?.name??"League admin",[At]),xr=P.useMemo(()=>{const N=new Map;return o.forEach($=>N.set($.id,$.name)),N.set(nr,Hr),N},[o]),_n=P.useCallback(()=>{if(!a?.code||typeof window>"u"||typeof navigator>"u")return;const N=`Join my mini league "${a.name}" on TotL!`,$=`${window.location.origin}/league/${a.code}`,q=navigator;if(typeof q.share=="function"){q.share({title:`Join ${a.name}`,text:N,url:$}).catch(()=>{});return}const V=`${N}
${$}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(V).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",a.code)}):window.prompt?.("Share this league code:",a.code)},[a]),wr=P.useCallback(async()=>{if(!(!a?.id||!n?.id)){U(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",a.id).eq("user_id",n.id);if(N)throw N;typeof window<"u"&&(window.location.href="/leagues")}catch(N){typeof window<"u"&&window.alert?.(N?.message??"Failed to leave league. Please try again.")}finally{U(!1),M(!1)}}},[a?.id,n?.id]),br=P.useCallback(async()=>{if(!(!a?.id||!n?.id)){ot(!0);try{if(o.length>=un){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),mt(!1);return}const{error:N}=await se.from("league_members").insert({league_id:a.id,user_id:n.id});if(N)throw N;const $=n.user_metadata?.display_name||n.email||"Someone";try{const q=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:a.id,userId:n.id,userName:$})}),V=await q.text();try{V&&JSON.parse(V)}catch{}q.ok}catch{}typeof window<"u"&&window.location.reload()}catch(N){typeof window<"u"&&window.alert?.(N?.message??"Failed to join league.")}finally{ot(!1)}}},[a?.id,n?.id,o.length]),vr=P.useCallback(async()=>{if(!(!Dt||!a?.id||!n?.id)){bn(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",a.id).eq("user_id",Dt.id);if(N)throw N;typeof window<"u"&&window.location.reload()}catch(N){typeof window<"u"&&window.alert?.(N?.message??"Failed to remove member.")}finally{bn(!1),Ct(!1),wn(null)}}},[a?.id,Dt,n?.id]),yr=P.useCallback(async()=>{if(!(!a?.id||!n?.id)){vn(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",a.id);if(N)throw N;const{error:$}=await se.from("leagues").delete().eq("id",a.id);if($)throw $;typeof window<"u"&&(window.location.href="/leagues")}catch(N){typeof window<"u"&&window.alert?.(N?.message??"Failed to end league.")}finally{vn(!1),lt(!1)}}},[a?.id,n?.id]),_r=N=>new Promise(($,q)=>{const V=new Image;V.addEventListener("load",()=>$(V)),V.addEventListener("error",K=>q(K)),V.src=N}),jn=async(N,$)=>{const q=await _r(N),V=document.createElement("canvas"),K=V.getContext("2d");if(!K)throw new Error("No 2d context");return V.width=$.width,V.height=$.height,K.drawImage(q,$.x,$.y,$.width,$.height,0,0,$.width,$.height),new Promise((oe,le)=>{V.toBlob(te=>{if(!te){le(new Error("Canvas is empty"));return}oe(te)},"image/jpeg",.9)})},jr=P.useCallback(N=>{if(!a?.id||!gt){pe("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(N.type)){pe("Please upload a PNG, JPG, or WebP image.");return}const q=20*1024*1024;if(N.size>q){pe("Please choose an image smaller than 20MB.");return}if(pe(null),Be(!1),N.size>5*1024*1024)$e(N,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(V=>{const K=new FileReader;K.onload=()=>{Re(K.result)},K.readAsDataURL(V)}).catch(()=>{pe("Failed to process image. Please try a smaller file.")});else{const V=new FileReader;V.onload=()=>{Re(V.result)},V.readAsDataURL(N)}},[gt,a?.id]),Cr=P.useCallback(async(N,$)=>{if(et($),Xe)try{const q=await jn(Xe,$),V=URL.createObjectURL(q);ht(V)}catch{}},[Xe]),Sr=P.useCallback(async()=>{if(!(!Xe||!Ye||!a?.id||!gt)){pe(null),Be(!1),Me(!0);try{const N=await jn(Xe,Ye),$=new File([N],"badge.jpg",{type:"image/jpeg"}),q=await $e($,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(q.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const V=`${a.id}-${Date.now()}.jpg`,{error:K}=await se.storage.from("league-avatars").upload(V,q,{cacheControl:"3600",upsert:!0,contentType:q.type});if(K)throw K;const{data:oe}=se.storage.from("league-avatars").getPublicUrl(V),le=oe?.publicUrl;if(!le)throw new Error("Unable to get public URL for badge.");const{error:te}=await se.from("leagues").update({avatar:le}).eq("id",a.id);if(te)throw te;d(ke=>ke&&{...ke,avatar:le}),Be(!0),ze&&URL.revokeObjectURL(ze),Re(null),ht(null),Se(!1),n?.id&&(tn(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:le}})))}catch(N){pe(N?.message??"Failed to upload badge. Please try again.")}finally{Me(!1)}}},[Xe,Ye,gt,a?.id,n?.id]),Nr=P.useCallback(async()=>{if(!(!a?.id||!gt)){pe(null),Be(!1),Me(!0);try{const{error:N}=await se.from("leagues").update({avatar:null}).eq("id",a.id);if(N)throw N;d($=>$&&{...$,avatar:null}),Be(!0),n?.id&&(tn(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:null}})))}catch(N){pe(N?.message??"Failed to remove badge. Please try again.")}finally{Me(!1)}}},[gt,a?.id]),[Cn,kr]=P.useState(new Map);P.useEffect(()=>{(async()=>{const N=new Map,{data:$}=await se.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:q}=await se.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),V=new Map;if($&&$.forEach(K=>{(!V.has(K.gw)||K.kickoff_time&&new Date(K.kickoff_time)<new Date(V.get(K.gw)))&&K.kickoff_time&&V.set(K.gw,K.kickoff_time)}),q&&q.length>0){const K=q.find(oe=>oe.kickoff_time)?.kickoff_time;if(K){const oe=V.get(1);(!oe||new Date(K)<new Date(oe))&&V.set(1,K)}}V.forEach((K,oe)=>{const le=new Date(K),te=new Date(le.getTime()-4500*1e3);N.set(oe,te)}),kr(N)})()},[]),P.useEffect(()=>{const N=$=>{const q=$.target;ae&&!q.closest(".gw-dropdown-container")&&ie(!1)};return ae&&document.addEventListener("click",N),()=>document.removeEventListener("click",N)},[ae]),P.useEffect(()=>{let N=!0;return(async()=>{const{data:$}=await se.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!N)return;g($?.current_gw??null);const{data:q}=await se.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!N)return;W(q&&q.length?q[0].gw:null);const{data:V}=await se.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!N)return;const K=V?[...new Set(V.map(le=>le.gw))].sort((le,te)=>te-le):[],oe=$?.current_gw;oe&&!K.includes(oe)&&K.unshift(oe),D(K),(K.length>0&&!m||K.length>0&&m&&!K.includes(m))&&E(K[0])})(),()=>{N=!1}},[xe]);const Er=P.useMemo(()=>o.map(N=>N.id).sort().join(","),[o]),wt=P.useMemo(()=>o.map(N=>N.id),[Er]),[Ue,Sn]=P.useState([]),[Nn,Kt]=P.useState([]),[kn,Yt]=P.useState([]),[En,Zt]=P.useState([]),Rt=P.useRef(""),An=P.useRef(0),Rn=P.useMemo(()=>{const N=Ue?.length||0;if(N===An.current&&Rt.current&&(Ue?.map(V=>V.api_match_id).filter(V=>V!=null).sort().join(",")||"")===Rt.current)return Rt.current;if(An.current=N,!Ue||Ue.length===0)return Rt.current="","";const $=Ue.map(q=>q.api_match_id).filter(q=>q!=null).sort().join(",");return Rt.current=$,$},[Ue]),Pt=P.useMemo(()=>a?.name==="API Test",[a?.name]),[at,Mn]=P.useState(null);P.useEffect(()=>{if(!Pt){Mn(null);return}let N=!0;return(async()=>{const{data:$}=await se.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let q=$?.current_test_gw??1;if(q&&q!==1){const{data:V}=await se.from("app_fixtures").select("gw").eq("gw",q).limit(1).maybeSingle();if(!V){const{data:K}=await se.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();K&&(q=1)}}N&&Mn(q)})(),()=>{N=!1}},[Pt]);const Ar=P.useMemo(()=>Pt&&at!==null?at:C||m||void 0,[Pt,at,C,m]),Jt=P.useRef({key:"",array:void 0}),Rr=P.useMemo(()=>{const N=Rn||"";if(Jt.current.key===N)return Jt.current.array;const $=N?N.split(",").map(q=>parseInt(q,10)).filter(q=>!isNaN(q)):void 0;return Jt.current={key:N,array:$},$},[Rn]),{liveScores:Ln}=$r(Ar,Rr),Ze=P.useMemo(()=>{const N={};if(!Ue||Ue.length===0)return Object.keys(j.current).length===0?j.current:(j.current=N,N);Ue.forEach(oe=>{const le=oe.api_match_id;if(le){const te=Ln.get(le);te&&(N[oe.fixture_index]={homeScore:te.home_score??0,awayScore:te.away_score??0,status:te.status||"SCHEDULED",minute:te.minute??null})}});const $=j.current,q=Object.keys(N).map(Number),V=Object.keys($).map(Number);if(q.length!==V.length)return j.current=N,N;let K=!1;for(const oe of q){const le=N[oe],te=$[oe];if(!te||le.homeScore!==te.homeScore||le.awayScore!==te.awayScore||le.status!==te.status||le.minute!==te.minute){K=!0;break}}return K?(j.current=N,N):$},[Ln,Ue]),Mr=()=>{try{if(console.log("[League] getInitialMltRows called",{code:l,userId:n?.id}),l&&n?.id){const $=Oe(`leagues:${n.id}`);if(console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!$,length:$?.length}),$&&Array.isArray($)){const q=$.find(V=>V.code.toUpperCase()===l.toUpperCase());if(console.log("[League] getInitialMltRows - found league",{found:!!q,leagueId:q?.id}),q?.id){const V=`league:mltRows:${q.id}`,K=Oe(V);if(console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!K,length:K?.length,cacheKey:V,cachedType:typeof K,isArray:Array.isArray(K),rawCache:K}),K&&Array.isArray(K)&&K.length>0)return console.log("[League]  getInitialMltRows returning cached rows",K.length),K;console.log("[League]  Cache check failed",{cached:!!K,isArray:Array.isArray(K),length:K?.length,cacheKey:V})}}}const N=r();if(console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!N,leagueId:N?.id}),N?.id){const $=Oe(`league:mltRows:${N.id}`);if(console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!$,length:$?.length}),$&&Array.isArray($)&&$.length>0)return console.log("[League]  getInitialMltRows returning cached rows from initialLeague",$.length),$}if(l&&n?.id){const $=Oe(`leagues:${n.id}`);if($&&Array.isArray($)){for(const q of $)if(q.code?.toUpperCase()===l.toUpperCase()&&q.id){const V=Oe(`league:mltRows:${q.id}`);if(V&&Array.isArray(V)&&V.length>0)return console.log("[League]  getInitialMltRows returning cached rows from strategy 3",V.length),V}}}console.log("[League]  getInitialMltRows returning empty array - cache miss")}catch(N){console.error("[League]  getInitialMltRows error",N)}return[]},[Ke,xt]=P.useState(Mr);P.useEffect(()=>{console.log("[League] Tab changed to:",S,"mltRows.length:",Ke.length)},[S,Ke.length]),P.useEffect(()=>{if(a?.id){const N=`league:mltRows:${a.id}`,$=Oe(N);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:a.id,cacheKey:N,hasCached:!!$,cachedLength:$?.length,currentMltRowsLength:Ke.length}),$&&$.length>0)Ke.length===0?(console.log("[League]  Setting mltRows from cache",$.length),xt($)):console.log("[League] mltRows already populated, skipping");else{console.log("[League]  No cached mltRows found - will retry multiple times");let q=0;const V=10,K=[50,100,150,200,250,300,400,500,600,800],oe=()=>{if(q>=V){console.log("[League]  Max retries reached, giving up on cache");return}const te=setTimeout(()=>{q++;const ke=Oe(N);ke&&ke.length>0&&Ke.length===0?(console.log(`[League]  Retry ${q} successful - Setting mltRows from cache`,ke.length),xt(ke)):q<V&&oe()},K[q]||800);return()=>clearTimeout(te)};return oe()}}else console.log("[League]  No league.id available yet")},[a?.id,Ke.length]),P.useEffect(()=>{let N=!0;return(async()=>{let q=a;if(!q){const{data:te}=await se.from("leagues").select("id,name,code,created_at,avatar").eq("code",l).maybeSingle();if(!N)return;if(!te){d(null),c([]),p(!1);return}q=te,d(q)}const V=Oe(`league:members:${q.id}`);let K=[];if(V&&V.length>0)K=V.map(([te,ke])=>({id:te,name:ke||"(no name)"})),p(!1);else{const{data:te}=await se.from("league_members").select("users(id,name),created_at").eq("league_id",q.id).order("created_at",{ascending:!0});K=te?.map(ke=>({id:ke.users.id,name:ke.users.name??"(no name)"}))??[],p(!1)}const oe=[...K].sort((te,ke)=>te.name.localeCompare(ke.name));c(oe);const le=K[0];pr(le),n?.id&&!K.some(te=>te.id===n.id)&&mt(!0),p(!1)})(),()=>{N=!1}},[l]),P.useEffect(()=>{},[a,S]),P.useEffect(()=>{if(S!=="chat"||!a?.id||!n?.id)return;(async()=>{await se.from("league_message_reads").upsert({league_id:a.id,user_id:n.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),tn(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:a.id,userId:n.id}}))})()},[S,a?.id,n?.id]),P.useEffect(()=>{let N=!0;return(async()=>{const $=a?.name==="API Test";let q=at??1;if($){const{data:ne}=await se.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(q=ne?.current_test_gw??1,q&&q!==1){const{data:de}=await se.from("app_fixtures").select("gw").eq("gw",q).limit(1).maybeSingle();if(!de){const{data:me}=await se.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();me&&(q=1)}}}const V=$&&(S==="gw"||S==="gwr");let K=null;if(S==="gwr")if(y.current&&m)K=m;else if(C)try{const ne=await Br(C);ne==="LIVE"||ne==="RESULTS_PRE_GW"?K=C:u&&u<C?K=u:K=C>1?C-1:C}catch(ne){console.error("[League] Error checking game state for fixtures loading:",ne),u&&u<C?K=u:K=C>1?C-1:C}else K=m;else K=C;if($&&(S==="gw"||S==="gwr")&&(K=q),S==="gw"&&!$&&wt.length>0){const{data:ne}=await se.from("app_gw_submissions").select("gw").in("user_id",wt).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(ne&&ne.length>0){const de=[...new Set(ne.map(me=>me.gw))].sort((me,Ne)=>(Ne||0)-(me||0));for(const me of de)if(me){const{data:Ne}=await se.from("app_fixtures").select("gw").eq("gw",me).limit(1);if(Ne&&Ne.length>0){K=me;break}}}!K&&C&&(K=C)}if(!K&&!V){Sn([]),Kt([]),Yt([]),Zt([]);return}let oe;if(V){const{data:ne}=await se.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",q).order("fixture_index",{ascending:!0});oe=ne?.map(de=>({...de,gw:de.test_gw}))||null}else{const{data:ne}=await se.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",K).order("fixture_index",{ascending:!0});oe=ne||null}if(!N)return;if(Sn(ne=>{const de=oe??[];return ne.length!==de.length?de:ne.length===0&&de.length===0?ne:ne.some((Ne,ee)=>!de[ee]||Ne.id!==de[ee].id||Ne.fixture_index!==de[ee].fixture_index)||de.some((Ne,ee)=>!ne[ee]||Ne.id!==ne[ee].id||Ne.fixture_index!==ne[ee].fixture_index)?de:ne}),!wt.length){Kt([]),Yt([]),Zt([]);return}let le=null,te;if(V){const{data:ne}=await se.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",q).in("user_id",wt);le=ne?.map(re=>({...re,gw:re.matchday}))||null;const{data:de,error:me}=await se.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",q).not("submitted_at","is",null).in("user_id",wt),{data:Ne}=await se.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",q).order("fixture_index",{ascending:!0}),ee=new Set((Ne||[]).map(re=>re.fixture_index)),Y=[];if(de&&le&&Ne){const re=ee.size,ce=new Date("2025-11-18T00:00:00Z");de.forEach(fe=>{const Pe=(le||[]).filter(Ie=>Ie.user_id===fe.user_id&&Ie.matchday===q).filter(Ie=>ee.has(Ie.fixture_index)),it=Pe.length===re&&re>0,Q=new Set(Pe.map(Ie=>Ie.fixture_index)).size===re,je=fe.submitted_at?new Date(fe.submitted_at):null,Te=je&&je>=ce;it&&Q&&Te&&Y.push(fe)})}te=Y.map(re=>({...re,gw:re.matchday}))||null}else{const{data:ne}=await se.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",K).in("user_id",wt);le=ne;const{data:de}=await se.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",K).in("user_id",wt);te=de}if(!N)return;Kt(ne=>{const de=le??[];if(ne.length!==de.length)return de;if(ne.length===0&&de.length===0)return ne;const me=JSON.stringify(ne.sort((ee,Y)=>ee.fixture_index-Y.fixture_index)),Ne=JSON.stringify(de.sort((ee,Y)=>ee.fixture_index-Y.fixture_index));return me===Ne?ne:de}),Yt(ne=>{const de=te??[];if(ne.length!==de.length)return de;if(ne.length===0&&de.length===0)return ne;const me=JSON.stringify(ne),Ne=JSON.stringify(de);return me===Ne?ne:de});const{data:ke}=await se.from("app_gw_results").select("gw,fixture_index,result").eq("gw",V?1:K||0);N&&Zt(ne=>{const de=ke??[];if(ne.length!==de.length)return de;if(ne.length===0&&de.length===0)return ne;const me=JSON.stringify(ne.sort((ee,Y)=>ee.fixture_index-Y.fixture_index)),Ne=JSON.stringify(de.sort((ee,Y)=>ee.fixture_index-Y.fixture_index));return me===Ne?ne:de})})(),()=>{N=!1}},[S,C,u,m,wt]),P.useEffect(()=>{T.current=Ze},[Ze]);const bt=P.useMemo(()=>{const N=new Map;return kn.forEach($=>{if($.submitted_at){const q=`${$.user_id}:${$.gw}`;N.set(q,!0)}}),N},[kn]),It=P.useCallback(N=>N.map($=>({user_id:$.id,name:$.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);P.useEffect(()=>{const N=se.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{he($=>$+1)}).subscribe();return()=>{se.removeChannel(N)}},[]),P.useEffect(()=>{let N=!0;return(async()=>{const $=xe>0,q=Ke.length>0&&Ke.every(Q=>Q.wins===0&&Q.draws===0),V=$||q;if(!V&&Ke.length>0)return;if(!V&&a?.id){const Q=Oe(`league:mltRows:${a.id}`);if(Q&&Q.length>0){xt(Q);return}}if(!o.length){Oe(`league:mltRows:${a?.id||""}`)||xt([]);return}if(a?.name==="API Test"){xt(It(o));return}if(!V){const Q=a?.id&&Oe(`league:mltRows:${a.id}`);if(Q&&Q.length>0){xt(Q);return}}if(C===null)return;const{data:K}=await se.from("app_gw_results").select("gw,fixture_index,result"),oe=K??[],le=new Map;if(oe.forEach(Q=>{const je=fn(Q);je&&le.set(`${Q.gw}:${Q.fixture_index}`,je)}),le.size===0){xt(It(o));return}const te=[...new Set(Array.from(le.keys()).map(Q=>parseInt(Q.split(":")[0],10)))].sort((Q,je)=>Q-je),ke=["Prem Predictions","FC Football","Easy League"],ne=["The Bird league"],de=await Gr(a,C);let me=te.filter(Q=>Q>=de);if(C!==null&&me.includes(C)){const{data:Q}=await se.from("app_fixtures").select("fixture_index").eq("gw",C),je=Q?.length??0,Te=Array.from(le.keys()).filter(Ie=>parseInt(Ie.split(":")[0],10)===C).length;je>0&&Te<je&&(me=me.filter(Ie=>Ie<C))}else C!==null&&(me=me.filter(Q=>Q<C));if(!ke.includes(a?.name||"")&&!ne.includes(a?.name||"")&&me.length===0){xt(It(o));return}const{data:Ne}=await se.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",o.map(Q=>Q.id)).in("gw",me),ee=Ne??[],Y=new Map;me.forEach(Q=>{const je=new Map;o.forEach(Te=>je.set(Te.id,{user_id:Te.id,score:0,unicorns:0})),Y.set(Q,je)}),me.forEach(Q=>{Array.from(le.entries()).filter(([Te])=>parseInt(Te.split(":")[0],10)===Q).map(([Te,Ie])=>({idx:parseInt(Te.split(":")[1],10),out:Ie})).forEach(({idx:Te,out:Ie})=>{const we=ee.filter(ct=>ct.gw===Q&&ct.fixture_index===Te),Je=we.filter(ct=>ct.pick===Ie).map(ct=>ct.user_id),Tn=Y.get(Q);if(we.forEach(ct=>{if(ct.pick===Ie){const en=Tn.get(ct.user_id);en.score+=1}}),Je.length===1&&o.length>=3){const ct=Je[0],en=Tn.get(ct);en.unicorns+=1}})});const re=new Map,ce=new Map,fe=new Map,Ee=new Map,Pe=new Map,it=new Map;o.forEach(Q=>{re.set(Q.id,0),ce.set(Q.id,0),fe.set(Q.id,0),Ee.set(Q.id,0),Pe.set(Q.id,0),it.set(Q.id,[])}),me.forEach(Q=>{const je=Array.from(Y.get(Q).values());if(je.forEach(we=>{ce.set(we.user_id,(ce.get(we.user_id)??0)+we.score),fe.set(we.user_id,(fe.get(we.user_id)??0)+we.unicorns)}),je.sort((we,Je)=>Je.score-we.score||Je.unicorns-we.unicorns),!je.length)return;const Te=je[0],Ie=je.filter(we=>we.score===Te.score&&we.unicorns===Te.unicorns);Ie.length===1?(re.set(Te.user_id,(re.get(Te.user_id)??0)+3),Ee.set(Te.user_id,(Ee.get(Te.user_id)??0)+1),it.get(Te.user_id).push("W"),je.slice(1).forEach(we=>it.get(we.user_id).push("L"))):(Ie.forEach(we=>{re.set(we.user_id,(re.get(we.user_id)??0)+1),Pe.set(we.user_id,(Pe.get(we.user_id)??0)+1),it.get(we.user_id).push("D")}),je.filter(we=>!Ie.find(Je=>Je.user_id===we.user_id)).forEach(we=>it.get(we.user_id).push("L")))});const Le=o.map(Q=>({user_id:Q.id,name:Q.name,mltPts:re.get(Q.id)??0,ocp:ce.get(Q.id)??0,unicorns:fe.get(Q.id)??0,wins:Ee.get(Q.id)??0,draws:Pe.get(Q.id)??0,form:it.get(Q.id)??[]}));Le.sort((Q,je)=>je.mltPts-Q.mltPts||je.unicorns-Q.unicorns||je.ocp-Q.ocp||Q.name.localeCompare(je.name)),N&&(xt(Le),a?.id&&hn(`league:mltRows:${a.id}`,Le,mn.LEAGUES))})(),()=>{N=!1}},[o,a,C,It,xe]);function Lr(){const N=performance.now();console.log("[MltTab]  RENDERING START",{mltRowsLength:Ke.length,membersLength:o.length,leagueId:a?.id,timestamp:N});const $=performance.now(),q=P.useMemo(()=>C??null,[C]);St(q);const V=performance.now();console.log("[MltTab]  Hooks complete",{duration:V-$});const K=performance.now(),oe=Ke.length>0?Ke:o.length>0?o.map(me=>({user_id:me.id,name:me.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],le=performance.now();console.log("[MltTab]  Rows calculated",{rowsLength:oe.length,mltRowsLength:Ke.length,duration:le-K});const te=["Prem Predictions","FC Football","Easy League"],ke=["The Bird league"],ne=["gregVjofVcarl","Let Down"],de=!!(a&&!te.includes(a.name)&&!ke.includes(a.name)&&!ne.includes(a.name));return o.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>vt(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx($s,{rows:oe,members:o,showForm:b,currentUserId:n?.id,loading:!1,isLateStartingLeague:de}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(Ws,{showForm:b,onToggle:w}),s.jsxs("button",{onClick:()=>be(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function Tr(){const N=P.useMemo(()=>a?.name==="API Test"?at??1:C??null,[a?.name,at,C]),{state:$}=St(N);if(!N)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!zn(a,N,Cn))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",N," predictions are not included in this league."]})]})});const q=new Map;En.forEach(Y=>{if(Y.gw!==N)return;const re=fn(Y);re&&q.set(Y.fixture_index,re)}),Ue.forEach(Y=>{if(Y.gw!==N)return;const re=Ze[Y.fixture_index];re&&(re.status==="IN_PLAY"||re.status==="PAUSED"||re.status==="FINISHED")&&(re.homeScore>re.awayScore?q.set(Y.fixture_index,"H"):re.awayScore>re.homeScore?q.set(Y.fixture_index,"A"):q.set(Y.fixture_index,"D"))});const V=P.useMemo(()=>{const Y=fe=>{if(!fe)return"Fixtures";const Ee=new Date(fe);return isNaN(Ee.getTime())?"Fixtures":Ee.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},re=new Map;Ue.filter(fe=>fe.gw===N).forEach(fe=>{const Ee=Y(fe.kickoff_time),Pe=fe.kickoff_time?new Date(fe.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;re.has(Ee)||re.set(Ee,{label:Ee,key:Pe,items:[]}),re.get(Ee).items.push(fe)});const ce=Array.from(re.values());return ce.forEach(fe=>fe.items.sort((Ee,Pe)=>Ee.fixture_index-Pe.fixture_index)),ce.sort((fe,Ee)=>fe.key-Ee.key),ce},[Ue,N]),K=new Set(Ue.filter(Y=>Y.gw===N).map(Y=>Y.fixture_index)),oe=a?.name==="API Test",le=o.length>0&&o.every(Y=>bt.get(`${Y.id}:${N}`)),te=new Map;(!oe||le)&&Nn.forEach(Y=>{if(Y.gw!==N||!bt.get(`${Y.user_id}:${N}`)||!K.has(Y.fixture_index))return;const ce=te.get(Y.fixture_index)??[];ce.push(Y),te.set(Y.fixture_index,ce)});const ke=u!==null&&u>=N,ne=o.filter(Y=>!bt.get(`${Y.id}:${N}`)).length,de=o.filter(Y=>!bt.get(`${Y.id}:${N}`)).map(Y=>Y.name),me=$!==null&&($==="DEADLINE_PASSED"||$==="LIVE"||$==="RESULTS_PRE_GW"),Ne=oe?!le:!le&&!me;return(oe?!le:!le&&!me)?s.jsx(Xn,{members:o,submittedMap:bt,picksGw:N,allSubmitted:le,remaining:ne,fixtures:Ue.filter(Y=>Y.gw===N),variant:"compact"}):s.jsxs("div",{className:"mt-2 pt-2",children:[Ne?s.jsx(Xn,{members:o,submittedMap:bt,picksGw:N,allSubmitted:le,remaining:ne,fixtures:Ue.filter(Y=>Y.gw===N),variant:"full"}):null,a?.name==="API Test"&&le&&V.length>0&&!Ne&&(()=>{const Y=V.flatMap(Le=>Le.items),re=new Set(Y.map(Le=>Le.fixture_index)),ce={};Object.keys(Ze).forEach(Le=>{const Q=parseInt(Le,10);re.has(Q)&&(ce[Q]=Ze[Q])});const fe=Y.some(Le=>{const Q=ce[Le.fixture_index];return Q&&(Q.status==="IN_PLAY"||Q.status==="PAUSED")}),Ee=Y.length>0&&Y.every(Le=>{const Q=ce[Le.fixture_index];return Q&&Q.status==="FINISHED"}),Pe=fe||Ee||Y.some(Le=>ce[Le.fixture_index]);let it=0;return n?.id&&Y.forEach(Le=>{const Q=ce[Le.fixture_index],je=Q&&(Q.status==="IN_PLAY"||Q.status==="PAUSED"),Te=Q&&Q.status==="FINISHED";if(Q&&(je||Te)){const we=(te.get(Le.fixture_index)??[]).find(Je=>Je.user_id===n.id);if(we){let Je=!1;(we.pick==="H"&&Q.homeScore>Q.awayScore||we.pick==="A"&&Q.awayScore>Q.homeScore||we.pick==="D"&&Q.homeScore===Q.awayScore)&&(Je=!0),Je&&it++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:V.map((Le,Q)=>s.jsx(tr,{label:Le.label,fixtures:Le.items,picksByFixture:te,members:o,outcomes:q,liveScores:ce,submittedMap:bt,picksGw:N,isApiTestLeague:!0,isFirstSection:Q===0,hasLiveGames:fe,allGamesFinished:Ee,hasStarted:Pe,liveFixturesCount:it},Q))})})(),V.length>0&&a?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:V.map((Y,re)=>s.jsx(tr,{label:Y.label,fixtures:Y.items,picksByFixture:te,members:o,outcomes:q,liveScores:Ze,submittedMap:bt,picksGw:N,isApiTestLeague:!1,isFirstSection:re===0,allSubmitted:le,resultsPublished:ke,deadlinePassed:me,whoDidntSubmit:de},re))}),!V.length&&!Ne&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",N,"."]})]})}function Dr(){const{state:N}=St(C),$=P.useMemo(()=>a?.name==="API Test"?at??1:S==="gwr"?y.current&&m||!C?m:N==="LIVE"||N==="RESULTS_PRE_GW"?C:u&&u<C?u:C>1?C-1:C:m,[a?.name,at,S,m,C,N,u]);St($);const q=$;if(!q||H.length===0&&a?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!zn(a,q,Cn))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",q," results are not included in this league."]})]})});const V=new Map,K=a?.name==="API Test",oe=Ue.filter(ee=>ee.gw===q),le=oe.some(ee=>{const Y=Ze[ee.fixture_index];return Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")});K&&q===(at??1)?oe.forEach(ee=>{const Y=Ze[ee.fixture_index];Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")&&(Y.homeScore>Y.awayScore?V.set(ee.fixture_index,"H"):Y.awayScore>Y.homeScore?V.set(ee.fixture_index,"A"):V.set(ee.fixture_index,"D"))}):le&&q===C?oe.forEach(ee=>{const Y=Ze[ee.fixture_index];Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")&&(Y.homeScore>Y.awayScore?V.set(ee.fixture_index,"H"):Y.awayScore>Y.homeScore?V.set(ee.fixture_index,"A"):V.set(ee.fixture_index,"D"))}):En.forEach(ee=>{if(ee.gw!==q)return;const Y=fn(ee);Y&&V.set(ee.fixture_index,Y)});const te=o.map(ee=>({user_id:ee.id,name:ee.name,score:0,unicorns:0})),ke=new Map;Nn.forEach(ee=>{if(ee.gw!==q)return;const Y=ke.get(ee.fixture_index)??[];Y.push(ee),ke.set(ee.fixture_index,Y)}),Array.from(V.entries()).forEach(([ee,Y])=>{const ce=(ke.get(ee)??[]).filter(fe=>fe.pick===Y).map(fe=>fe.user_id);if(ce.forEach(fe=>{const Ee=te.find(Pe=>Pe.user_id===fe);Ee.score+=1}),ce.length===1&&o.length>=3){const fe=te.find(Ee=>Ee.user_id===ce[0]);fe.unicorns+=1}}),te.sort((ee,Y)=>Y.score-ee.score||Y.unicorns-ee.unicorns||ee.name.localeCompare(Y.name)),P.useEffect(()=>{if(te.length===0)return;const ee=new Map;te.forEach((re,ce)=>{ee.set(re.user_id,ce)});const Y=new Set;if(ee.forEach((re,ce)=>{const fe=J.current.get(ce);fe!==void 0&&fe!==re&&Y.add(ce)}),J.current=ee,Y.size>0){X(Y);const re=setTimeout(()=>{X(new Set)},2e3);return()=>clearTimeout(re)}},[te.map(ee=>`${ee.user_id}-${ee.score}-${ee.unicorns}`).join(",")]);let ne=!1,de=!1,me=!1,Ne=!1;if(K&&q===(at??1)){const ee=Ue;if(ee.length>0&&(ne=ee.every(re=>{const ce=Ze[re.fixture_index];return ce&&ce.status==="FINISHED"}),de=!!ee.find(re=>{const ce=Ze[re.fixture_index];return ce&&(ce.status==="IN_PLAY"||ce.status==="PAUSED")}),Ne=ee.some(re=>{const ce=Ze[re.fixture_index];return ce&&(ce.status==="IN_PLAY"||ce.status==="PAUSED"||ce.status==="FINISHED")}),!ne)){const re=new Date;me=ee.some(ce=>{if(!ce.kickoff_time)return!1;const Ee=new Date(ce.kickoff_time).getTime()-re.getTime(),Pe=Ze[ce.fixture_index];return(!Pe||Pe.status!=="IN_PLAY"&&Pe.status!=="PAUSED"&&Pe.status!=="FINISHED")&&Ee>0&&Ee<=1440*60*1e3})}}else{const ee=Ue.filter(Y=>Y.gw===q);if(ee.length>0){const Y=ee.every(ce=>V.has(ce.fixture_index)),re=ee.some(ce=>{const fe=Ze[ce.fixture_index];return fe&&(fe.status==="IN_PLAY"||fe.status==="PAUSED")});ne=Y&&!re}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),te.length>0&&ne&&s.jsx(zs,{winnerName:te[0].name,isDraw:te[0].score===te[1]?.score&&te[0].unicorns===te[1]?.unicorns}),s.jsx(Bs,{rows:te,members:o,currentUserId:n?.id,positionChangeKeys:Z,isApiTestLeague:K,hasLiveFixtures:de,hasStartingSoonFixtures:me,hasStartedFixtures:Ne,allFixturesFinished:ne,resGw:q}),H.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(Os,{availableGws:H,selectedGw:q,onChange:ee=>{y.current=!0,E(ee)}}),s.jsxs("button",{onClick:()=>ye(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(Fn,{isOpen:ve,onClose:()=>ye(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}if(P.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[S]),f)return s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})});if(!a&&!f)return s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(In,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})});if(!a)return null;const{state:Qt}=St(C),Xt=P.useMemo(()=>a?.name==="API Test"?at??1:y.current&&m||!C?m:Qt==="LIVE"||Qt==="RESULTS_PRE_GW"?C:u&&u<C?u:C>1?C-1:C,[a?.name,at,m,C,Qt,u]),{state:Pr}=St(Xt);return s.jsxs("div",{className:`${e?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:B,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(In,{to:"/leagues",className:"flex items-center text-slate-600 -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{v(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative cursor-pointer",children:a?s.jsx("img",{src:nn(a),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:N=>{const $=N.target,V=`/assets/league-avatars/${Un(a.id)}`;$.src!==V&&($.src=V)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:a.name}),m&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",m]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>nt(!tt),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${tt?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[yn&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:gr})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{ge(!0),nt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[gt&&s.jsxs("button",{onClick:()=>{Se(!0),nt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{vt(!0),nt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{_n(),nt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{M(!0),nt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 active:bg-red-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${tt?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{z.current=!0,_("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(S==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),S==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(H.length>0||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{z.current=!0,_("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(S==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const N=Xt!=null&&Pr==="LIVE";return s.jsxs(s.Fragment,{children:[N&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),S==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(C||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{z.current=!0,_("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(S==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),S==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{console.log("[League] GW Table tab clicked, setting tab to mlt"),z.current=!0,_("mlt"),console.log("[League] Tab set to mlt, mltRows.length:",Ke.length)},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(S==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",S==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),S==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(Fs,{miniLeagueId:a?.id??null,memberNames:xr,deepLinkError:I})}):s.jsx("div",{className:`league-content-wrapper ${tt?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[S==="mlt"&&(()=>{const N=performance.now();console.log("[League] Rendering MltTab, tab is mlt",{tab:S,mltRowsLength:Ke.length,leagueId:a?.id,timestamp:N});const $=s.jsx(Lr,{}),q=performance.now();return console.log("[League] MltTab JSX created",{duration:q-N}),$})(),S==="gw"&&s.jsx(Tr,{}),S==="gwr"&&s.jsx(Dr,{})]})}),yn&&ue&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>ge(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:N=>N.stopPropagation(),children:[s.jsx("button",{onClick:()=>ge(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[o.filter(N=>N.id!==n?.id).map(N=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:N.name}),s.jsx("button",{onClick:()=>{wn(N),Ct(!0),ge(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-medium",children:"Remove"})]},N.id)),o.filter(N=>N.id!==n?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{lt(!0),ge(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),gt&&De&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Se(!1),ze&&URL.revokeObjectURL(ze),Re(null),pe(null),Be(!1),ht(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:N=>N.stopPropagation(),children:[s.jsx("button",{onClick:()=>{Se(!1),ze&&URL.revokeObjectURL(ze),Re(null),pe(null),Be(!1),ht(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Xe?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(ys,{image:Xe,crop:ft,zoom:Ve,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Fe,onZoomChange:Ge,onCropComplete:Cr,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(Ve*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:Ve,onChange:N=>Ge(Number(N.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:ze?s.jsx("img",{src:ze,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),Ae&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Ae}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{ze&&URL.revokeObjectURL(ze),Re(null),Fe({x:0,y:0}),Ge(1),et(null),ht(null)},disabled:_e,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:Sr,disabled:_e||!Ye,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:_e?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:a?nn(a):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:N=>{const $=N.target;$.src="/assets/league-avatars/ML-avatar-1.png"}})}),a?.avatar&&s.jsx("button",{onClick:Nr,disabled:_e,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:N=>{const $=N.target.files?.[0];$&&jr($)},disabled:_e,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),_e&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),qe&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),Ae&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Ae})]})]})]})]})}),s.jsx(Fn,{isOpen:Ce,onClose:()=>be(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${a&&(["The Bird league"].includes(a.name)||["gregVjofVcarl","Let Down"].includes(a.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),Gt&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",un," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:a.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a.code)},className:"px-3 py-1.5 border rounded-md text-sm",children:"Copy"}),s.jsx("button",{onClick:_n,className:"px-3 py-1.5 border rounded-md text-sm",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[o.length,"/",un," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>vt(!1),className:"px-4 py-2 border border-slate-300 rounded-md",children:"Close"})})]})}),A&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',a?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:L,children:"Cancel"}),s.jsx("button",{onClick:wr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:L,children:L?"Leaving...":"Leave League"})]})]})}),Tt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',a?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>mt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Et,children:"Cancel"}),s.jsx("button",{onClick:br,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:Et,children:Et?"Joining...":"Join League"})]})]})}),yt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',Dt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>Ct(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:qt,children:"Cancel"}),s.jsx("button",{onClick:vr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:qt,children:qt?"Removing...":"Remove Member"})]})]})}),pt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',a?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>lt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Vt,children:"Cancel"}),s.jsx("button",{onClick:yr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Vt,children:Vt?"Ending...":"Yes, End League"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),x&&a&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>v(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:N=>N.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:nn(a),alt:"League badge",className:"w-full h-full object-cover",onError:N=>{const $=N.target,V=`/assets/league-avatars/${Un(a.id)}`;$.src!==V&&($.src=V)}})}),gt&&s.jsx("button",{type:"button",onClick:N=>{N.stopPropagation(),v(!1),Se(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:a.name})]})})]})}export{Qs as default};
