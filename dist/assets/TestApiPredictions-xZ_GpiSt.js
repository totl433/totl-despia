import{j as e,u as pt,h as gt,r as u,b as yt,s as b,k as Ee,l as bt,C as wt,R as Pe,D as vt,F as jt,m as _t,n as kt}from"./index-Cop16kzC.js";import{T as xe}from"./TeamBadge-DgFcCB14.js";function qe({fixture:n,homeColor:x="#EF0107",awayColor:d="#034694",showSwipeHint:G=!0,homeForm:w=null,awayForm:v=null}){const ne=n.kickoff_time?new Date(n.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):null,C=n.kickoff_time?new Date(n.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):null,c=H=>!H||H.length===0?Array.from({length:5},(E,P)=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300",style:{pointerEvents:"none"}},P)):H.slice(-5).padStart(5,"?").split("").map((E,P)=>{let U="bg-gray-400";const N=E.toUpperCase();return N==="W"?U="bg-green-500":N==="L"?U="bg-red-500":N==="D"&&(U="bg-gray-400"),e.jsx("div",{className:`w-2 h-2 rounded-full ${U}`,style:{pointerEvents:"none"}},P)});return e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none flex flex-col",style:{pointerEvents:"none",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",width:"100%",height:"100%",position:"relative"},children:[e.jsxs("div",{className:"pt-2 px-8 pb-8 relative flex-shrink-0 pointer-events-none",style:{pointerEvents:"none"},children:[G&&e.jsx("div",{className:"absolute top-2 right-4 flex items-center gap-2 text-slate-400 text-xs font-semibold pointer-events-none",style:{pointerEvents:"none"},children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/4603/4603384.png",alt:"Swipe gesture icon",className:"w-6 h-6 opacity-80 pointer-events-none",style:{pointerEvents:"none"}})}),(ne||C)&&e.jsx("div",{className:"text-center mb-6 pointer-events-none",style:{pointerEvents:"none"},children:e.jsxs("div",{className:"text-sm text-slate-500 font-medium pointer-events-none",style:{pointerEvents:"none"},children:[ne,ne&&C&&e.jsx("span",{className:"mx-2 pointer-events-none",style:{pointerEvents:"none"},children:"•"}),C&&e.jsx("span",{className:"text-slate-700 pointer-events-none",style:{pointerEvents:"none"},children:C})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-10 mb-4 relative pointer-events-none mt-6",style:{pointerEvents:"none"},children:[e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"pointer-events-none",style:{pointerEvents:"none"},children:e.jsx(xe,{code:n.home_code,crest:n.home_crest,size:120})}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-2 text-center max-w-[120px] pointer-events-none",style:{pointerEvents:"none"},children:n.home_team||n.home_name}),e.jsx("div",{className:"flex items-center gap-1.5 mt-2 pointer-events-none",style:{pointerEvents:"none"},children:c(w)})]}),e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"pointer-events-none",style:{pointerEvents:"none"},children:e.jsx(xe,{code:n.away_code,crest:n.away_crest,size:120})}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-2 text-center max-w-[120px] pointer-events-none",style:{pointerEvents:"none"},children:n.away_team||n.away_name}),e.jsx("div",{className:"flex items-center gap-1.5 mt-2 pointer-events-none",style:{pointerEvents:"none"},children:c(v)})]})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden pointer-events-none min-h-[192px]",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:x,clipPath:"polygon(0 0, 0 100%, 100% 100%)",pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:d,clipPath:"polygon(0 0, 100% 0, 100% 100%)",pointerEvents:"none"}})]})]})}function Nt({score:n,total:x,topPercent:d}){const G=x>0?n/x*100:0;return e.jsx("div",{className:"mb-4 rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-[#1C8376]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[n,"/",x]}),d!=null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",d,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${G}%`}})})]})})}function St({success:n,message:x,onClose:d}){return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[n?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${n?"text-emerald-700":"text-amber-600"}`,children:n?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:x}),d&&e.jsx("button",{onClick:d,className:"mt-4 px-6 py-2 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#1C8376]/90 transition-colors",children:"Close"})]})]})})}function Ct(n){let x=0;for(let v=0;v<n.length;v++)x=n.charCodeAt(v)+((x<<5)-x);const d=Math.abs(x%360),G=60+Math.abs(x)%20,w=45+Math.abs(x)%15;return`hsl(${d}, ${G}%, ${w}%)`}function fe(n,x){return n&&Oe[n]?Oe[n].primary:Ct(n||x||"default")}const Oe={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function It(){const{user:n}=pt(),x=gt(),[d,G]=u.useState(null),[w,v]=u.useState(0),C=(()=>{if(typeof window>"u"||!n?.id)return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1};try{const s=Ee("app_meta")?.current_gw||14,i=`predictions:${n.id}:${s}`,r=Ee(i);if(r&&r.fixtures&&Array.isArray(r.fixtures)&&r.fixtures.length>0){const m=new Map;r.picks&&Array.isArray(r.picks)&&r.picks.forEach(p=>{m.set(p.fixture_index,p)});const a=new Map;return r.results&&Array.isArray(r.results)&&r.results.forEach(p=>{a.set(p.fixture_index,p.result)}),{fixtures:r.fixtures,picks:m,submitted:r.submitted||!1,results:a,loading:!1,picksChecked:!0,submissionChecked:!0}}}catch{}return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1}})(),[c,H]=u.useState(C.fixtures),[y,E]=u.useState(C.picks),[P,U]=u.useState(C.results),[N,oe]=u.useState(new Map),Ge=async t=>{try{console.log(`[TestApiPredictions] Fetching team forms from database for GW ${t}...`);const{data:s,error:i}=await b.from("app_team_forms").select("team_code, form").eq("gw",t);if(i){console.warn("[TestApiPredictions] Error fetching team forms from database:",i);return}if(s&&s.length>0){const r=new Map;s.forEach(m=>{const a=m.team_code.toUpperCase().trim(),p=m.form.trim().toUpperCase();a&&p&&r.set(a,p)}),console.log(`[TestApiPredictions] ✓ Loaded ${r.size} team forms from database for GW ${t}`),console.log("[TestApiPredictions] Forms map entries:",Array.from(r.entries())),oe(r)}else console.warn(`[TestApiPredictions] ⚠ No team forms found in database for GW ${t}`),oe(new Map)}catch(s){console.warn("[TestApiPredictions] Error fetching team forms:",s),oe(new Map)}};u.useEffect(()=>{d?Ge(d):oe(new Map)},[d]),u.useEffect(()=>{if(N.size>0&&(console.log("[TestApiPredictions] teamForms state updated:",{size:N.size,entries:Array.from(N.entries()),fixtureCodes:c.length>0?Array.from(new Set([...c.map(t=>t.home_code?.toUpperCase().trim()).filter(Boolean),...c.map(t=>t.away_code?.toUpperCase().trim()).filter(Boolean)])):[]}),c.length>0)){const t=[];c.forEach(s=>{const i=s.home_code?.toUpperCase().trim(),r=s.away_code?.toUpperCase().trim();i&&!N.has(i)&&t.push(`Home: ${i}`),r&&!N.has(r)&&t.push(`Away: ${r}`)}),t.length>0?console.warn("[TestApiPredictions] Missing forms for some teams:",t):console.log("[TestApiPredictions] ✓ All fixture teams have form data")}},[N,c]);const Ye=()=>{if(typeof window>"u")return"cards";try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true"&&(n?.id&&s.endsWith(`_${n.id}`)||!n?.id))return"list"}}catch{}return"cards"},[z,$]=u.useState(()=>{const t=Ye();return C.submitted?"list":t}),[k,ae]=u.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[ee,Ae]=u.useState(!1),[q,Me]=u.useState(!1),[pe,K]=u.useState(null),[Ve,Xe]=u.useState(!1),[ge,te]=u.useState(null),[ye,Te]=u.useState(!1),[M,Ke]=u.useState({width:0,height:0}),[le,Y]=u.useState(C.loading),[Fe,ce]=u.useState(C.picksChecked),[se,J]=u.useState(C.submissionChecked),Q=()=>{if(typeof window>"u"||!d||!n?.id)return!1;const t=`test_api_submitted_${d}_${n.id}`;return sessionStorage.getItem(t)==="true"},V=t=>{if(typeof window>"u"||!d||!n?.id)return;const s=`test_api_submitted_${d}_${n?.id}`;t?sessionStorage.setItem(s,"true"):sessionStorage.removeItem(s)},S=u.useRef(Q()),[h,F]=u.useState(()=>{if(C.submitted)return S.current=!0,!0;if(typeof window>"u"||!n?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${n.id}`)&&sessionStorage.getItem(s)==="true")return S.current=!0,!0}}catch{}return!1});u.useEffect(()=>{if(d&&n?.id&&typeof window<"u")try{const t=`test_api_submitted_${d}_${n.id}`;sessionStorage.getItem(t)==="true"&&($("list"),F(!0),S.current=!0)}catch{}},[d,n?.id]),u.useEffect(()=>{h&&z==="cards"&&$("list")},[h,z]),u.useEffect(()=>{!le&&!h&&c.length>0&&w===0&&$("cards")},[le,h,c.length,w]);const[Je,de]=u.useState(null),[Qe,Ze]=u.useState(!1),[me,et]=u.useState([]),[De,tt]=u.useState(new Set),[Ie,st]=u.useState(null),[Le,rt]=u.useState([]),{liveScores:be}=yt(d||void 0,Le.length>0?Le:void 0),Z=u.useMemo(()=>{const t={};return c.forEach(s=>{if(s.api_match_id&&be.has(s.api_match_id)){const i=be.get(s.api_match_id);t[s.fixture_index]={homeScore:i.home_score??0,awayScore:i.away_score??0,status:i.status||"SCHEDULED",minute:i.minute,goals:i.goals||null,red_cards:i.red_cards||null,home_team:i.home_team||null,away_team:i.away_team||null}}}),t},[be,c]),it=()=>{if(typeof window>"u")return!0;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true")return!1}}catch{}return!0},we=u.useRef(it());u.useEffect(()=>{const t=Q();(h||t&&S.current)&&(we.current=!1)},[h]),u.useEffect(()=>{const t=document.documentElement,s=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const r=setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(r),t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),u.useEffect(()=>{const t=()=>{Ke({width:window.innerWidth,height:window.innerHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),u.useEffect(()=>{const t=w>=c.length,s=z==="cards"&&!t&&c.length>0&&!h,i=document.documentElement,r=document.body,m=document.getElementById("root"),a=()=>{i.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),m&&m.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),m&&m.style.removeProperty("overflow")};if(!s){a();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),r.style.setProperty("overflow","hidden","important"),r.style.setProperty("position","fixed","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("height","100%","important"),r.style.setProperty("top","0","important"),m&&m.style.setProperty("overflow","hidden","important");const p=f=>{f.preventDefault()},l=f=>{f.target.closest('[style*="aspectRatio"]')||f.preventDefault()};return window.addEventListener("wheel",p,{passive:!1}),document.addEventListener("touchmove",l,{passive:!1}),()=>{a(),window.removeEventListener("wheel",p),document.removeEventListener("touchmove",l)}},[z,w,c.length,h]);const X=u.useMemo(()=>c.length===0?!1:c.every(t=>y.has(t.fixture_index)),[c,y]),nt=u.useRef(null),ve=u.useRef({x:0,y:0}),je=u.useRef(!1);u.useEffect(()=>{let t=!0;return(async()=>{try{let s=null;const{data:i}=await b.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(s=i?.current_gw??14,!s){t&&(H([]),Y(!1));return}G(s);const r=`predictions:${n?.id}:${s}`;let m=!1;try{const o=Ee(r);if(o&&o.fixtures&&Array.isArray(o.fixtures)&&o.fixtures.length>0){if(H(o.fixtures),Y(!1),o.picks&&Array.isArray(o.picks)){const g=new Map;o.picks.forEach(j=>{g.set(j.fixture_index,j)}),E(g)}if(o.submitted!==void 0&&(F(o.submitted),S.current=o.submitted,V(o.submitted),J(!0)),o.results&&Array.isArray(o.results)){const g=new Map;o.results.forEach(j=>{g.set(j.fixture_index,j.result)}),U(g)}ce(!0),m=!0}}catch{}m||(c.length===0&&Y(!0),ce(!1),J(!1));const{data:a,error:p}=await b.from("app_fixtures").select("*").eq("gw",s).order("fixture_index",{ascending:!0});if(p)throw new Error(`Failed to load test fixtures: ${p.message}`);if(!a||a.length===0){t&&(H([]),Y(!1));return}const l=a.map(o=>({id:o.id||String(o.api_match_id||o.fixture_index),gw:s,fixture_index:o.fixture_index,home_team:o.home_team,away_team:o.away_team,home_code:o.home_code,away_code:o.away_code,home_name:o.home_name,away_name:o.away_name,home_crest:null,away_crest:null,kickoff_time:o.kickoff_time,api_match_id:o.api_match_id||null}));if(t&&(H(l),Y(!1),U(new Map)),l.length>0){const o=new Set;l.forEach(g=>{g.home_code&&o.add(g.home_code.toUpperCase().trim()),g.away_code&&o.add(g.away_code.toUpperCase().trim())}),console.log("[TestApiPredictions] Team codes in fixtures:",Array.from(o))}const f=l.map(o=>o.api_match_id).filter(o=>o!=null);t&&f.length>0&&rt(f);let A=!1;if(n?.id&&l.length>0){const{data:o}=await b.from("app_gw_submissions").select("submitted_at").eq("gw",s).eq("user_id",n.id).maybeSingle();if(t&&o?.submitted_at)A=!0,F(!0),$("list"),S.current=!0,V(!0),J(!0);else{F(!1);const g=Q();g&&o?.submitted_at?(F(!0),$("list"),A=!0,S.current=!0):(g&&!o?.submitted_at&&V(!1),S.current=!1),J(!0)}}else t&&(F(!1),J(!0));let W=!1;if(n?.id&&l.length>0&&!A){const{data:o,error:g}=await b.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",n.id);if(!g&&o&&o.length>0){const j=new Set(l.map(T=>T.fixture_index)),_=o.filter(T=>j.has(T.fixture_index)),L=l.every(T=>_.some(O=>O.fixture_index===T.fixture_index)),R=_.length===l.length;if(L&&R&&_.length>0){const T=new Map;_.forEach(O=>{T.set(O.fixture_index,{fixture_index:O.fixture_index,pick:O.pick,matchday:O.gw||s})}),t&&(E(T),W=!0)}else t&&o.length>0&&(await b.from("app_picks").delete().eq("gw",s).eq("user_id",n.id),E(new Map),W=!1)}}else if(A&&n?.id&&l.length>0){const{data:o,error:g}=await b.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",n.id);if(!g&&o&&o.length>0){const j=new Set(l.map(L=>L.fixture_index)),_=o.filter(L=>j.has(L.fixture_index));if(_.length===l.length){const L=new Map;_.forEach(R=>{L.set(R.fixture_index,{fixture_index:R.fixture_index,pick:R.pick,matchday:R.gw||s})}),t&&(E(L),W=!0)}}t&&!W&&(F(!1),await b.from("app_gw_submissions").delete().eq("gw",s).eq("user_id",n.id))}if(t&&l.length>0&&n?.id){const{data:o}=await b.from("leagues").select("id").eq("name","API Test").maybeSingle();if(o){t&&st(o.id);const{data:g}=await b.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",o.id);if(g){const j=g.map(B=>({id:B.user_id,name:B.profiles?.name||"Unknown"}));t&&et(j);const _=j.map(B=>B.id),{data:L}=await b.from("app_gw_submissions").select("user_id, submitted_at").eq("gw",s).in("user_id",_).not("submitted_at","is",null),{data:R}=await b.from("app_picks").select("user_id, fixture_index").eq("gw",s).in("user_id",_),Se=new Set(l.map(B=>B.fixture_index)),T=Se.size,O=new Date("2025-11-18T00:00:00Z"),Ce=new Set;L&&R&&T>0&&L.forEach(B=>{const Ue=(R??[]).filter(ie=>ie.user_id===B.user_id).filter(ie=>Se.has(ie.fixture_index)),ht=Ue.length===T,ft=new Set(Ue.map(ie=>ie.fixture_index)).size===T,ze=B.submitted_at?new Date(B.submitted_at):null,xt=ze&&ze>=O;ht&&ft&&xt&&Ce.add(B.user_id)});const ut=_.length>0&&Ce.size===_.length;t&&(Ze(ut),tt(Ce))}}}if(t&&(ce(!0),se||J(!0)),t&&l.length>0&&(W&&!A?v(l.length):A&&W||(v(0),$("cards"))),t&&l.length>0&&n?.id&&s)try{const o=[];y.forEach((j,_)=>{o.push({fixture_index:_,pick:j.pick,matchday:j.matchday})});const g=[];P.forEach((j,_)=>{g.push({fixture_index:_,result:j})}),bt(r,{fixtures:l,picks:o,submitted:A,results:g},wt.PREDICTIONS)}catch(o){console.warn("[TestApiPredictions] Failed to cache data:",o)}}catch(s){console.error("Error loading test API data:",s),t&&ce(!0)}finally{t&&Y(!1)}})(),()=>{t=!1}},[n?.id]),u.useEffect(()=>{const t=new Map;c.forEach(i=>{const r=Z[i.fixture_index];r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")&&(r.homeScore>r.awayScore?t.set(i.fixture_index,"H"):r.awayScore>r.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),U(t)},[Z,c]),u.useEffect(()=>{if(!d||!n?.id||P.size===0||c.length===0){de(null);return}let t=0;if(c.forEach(s=>{const i=P.get(s.fixture_index),r=y.get(s.fixture_index);i&&r&&i===r.pick&&t++}),t===0){de(null);return}(async()=>{try{const{data:s}=await b.from("app_picks").select("user_id, fixture_index, pick").eq("gw",d);if(s){const i=new Map;s.forEach(l=>{const f=P.get(l.fixture_index),A=i.get(l.user_id)||0;f&&f===l.pick?i.set(l.user_id,A+1):i.set(l.user_id,A)});const r=Array.from(i.values()).sort((l,f)=>f-l),m=r.filter(l=>l>=t).length,a=r.length,p=a>0?Math.round(m/a*100):null;de(p)}}catch(s){console.error("[TestApiPredictions] Error calculating top percent:",s),de(null)}})()},[P,y,c,d,n?.id]);const D=c[w],ue=u.useMemo(()=>{let t=0;return c.forEach(s=>{const i=P.get(s.fixture_index),r=y.get(s.fixture_index);i&&r&&r.pick===i&&(t+=1)}),t},[c,P,y]),Be=(t,s)=>{q||h||(Ae(!0),ve.current={x:t,y:s},K(null))},$e=(t,s)=>{if(!ee||q||h)return;const i=t-ve.current.x,r=s-ve.current.y,m=i*.1;ae({x:i,y:r,rotation:m,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(r)?K(i>0?"away":"home"):r>50&&r>Math.abs(i)?K("draw"):K(null)},_e=()=>{if(!ee||q||h)return;Ae(!1);const{x:t,y:s}=k,i=100;let r=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(s)?r=t>0?"A":"H":s>i&&s>Math.abs(t)&&(r="D"),r?Re(r):(ae({x:0,y:0,rotation:0,opacity:1,scale:1}),K(null))},ot=t=>{t.touches.length===1&&Be(t.touches[0].clientX,t.touches[0].clientY)},at=t=>{t.touches.length===1&&ee&&(t.preventDefault(),$e(t.touches[0].clientX,t.touches[0].clientY))},We=t=>{t.touches.length>0||(t.preventDefault(),_e())},Re=async t=>{Me(!0),K(null);const s=t==="H"?-1:t==="A"?1:0,i=s*window.innerWidth,r=t==="D"?window.innerHeight:0;ae({x:i,y:r,rotation:s*30,opacity:0,scale:.8}),await he(t),setTimeout(()=>{je.current=!0,Ve?(v(c.length),Xe(!1)):v(w+1),ae({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{je.current=!1,Me(!1)})},300)},ke=t=>{!q&&!h&&Re(t)},he=t=>{if(!D||!d)return;const s=new Map(y);s.set(D.fixture_index,{fixture_index:D.fixture_index,pick:t,matchday:d}),E(s)},lt=async()=>{if(!(!n?.id||!d))try{const{error:t}=await b.from("app_gw_submissions").delete().eq("user_id",n.id).eq("gw",d);t&&console.error("[TestApiPredictions] Error deleting test_api_submission:",t);const{error:s}=await b.from("app_picks").delete().eq("user_id",n.id).eq("gw",d);s&&console.error("[TestApiPredictions] ❌ Error deleting test_api_picks:",s),E(new Map),v(0),F(!1),$("cards"),S.current=!1,V(!1),Y(!1),n?.id&&d&&_t(`predictions:${n.id}:${d}`)}catch(t){console.error("[TestApiPredictions] ❌ Error resetting picks:",t),E(new Map),v(0),F(!1),$("cards"),S.current=!1,V(!1)}},Ne=async()=>{if(!X){te({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>te(null),2200);return}if(!(!n?.id||!d))try{const{data:t}=await b.from("app_gw_submissions").select("submitted_at").eq("user_id",n.id).eq("gw",d).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen if Start Over worked"),F(!0);return}const s=Array.from(y.values()).filter(m=>m.matchday===d).map(m=>({user_id:n.id,gw:d,fixture_index:m.fixture_index,pick:m.pick}));if(s.length!==c.length)throw new Error(`Expected ${c.length} picks but got ${s.length}`);const{error:i}=await b.from("app_picks").upsert(s,{onConflict:"user_id,gw,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:r}=await b.from("app_gw_submissions").upsert({user_id:n.id,gw:d,submitted_at:new Date().toISOString()},{onConflict:"user_id,gw"});if(r)throw console.error("[TestApiPredictions] Error saving submission:",r),r;F(!0),S.current=!0,V(!0),n?.id&&kt(n.id),Te(!0),window.dispatchEvent(new Event("predictionsSubmitted")),setTimeout(()=>{Te(!1),x("/")},3e3),Ie&&d&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:Ie,matchday:d,isTestApi:!0})}).catch(m=>{console.error("[TestApiPredictions] Failed to check final submission:",m)})}catch(t){console.error("Error confirming test picks:",t),te({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>te(null),2200)}};if(le||c.length===0||!se||!Fe)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(le&&c.length===0)return e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>x("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"✕"}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:d?`Gameweek ${d}`:"Loading..."})]})})}),e.jsx("div",{className:"flex items-center justify-center flex-1",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1C8376]"})})]});if((!Fe||!se)&&c.length>0)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(c.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>x("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const ct=Q();if(h||!se&&ct){if(!Qe&&me.length>0){const t=me.filter(s=>!De.has(s.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ye&&M.width>0&&M.height>0&&e.jsx(Pe,{width:M.width,height:M.height,recycle:!1,numberOfPieces:500,gravity:.3}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",d]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:t})," of ",me.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:me.slice().sort((s,i)=>s.name.localeCompare(i.name)).map(s=>{const i=De.has(s.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx("td",{className:"px-4 py-3",children:i?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},s.id)})})]})})]})})})]})}return c.forEach(t=>{const s=Z[t.fixture_index],i=s&&(s.status==="IN_PLAY"||s.status==="PAUSED"),r=s&&s.status==="FINISHED";if(s&&(i||r)){const m=y.get(t.fixture_index);m&&(m.pick==="H"&&s.homeScore>s.awayScore||m.pick==="A"&&s.awayScore>s.homeScore||m.pick==="D"&&(s.homeScore,s.awayScore))}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ye&&M.width>0&&M.height>0&&e.jsx(Pe,{width:M.width,height:M.height,recycle:!1,numberOfPieces:500,gravity:.3}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",d]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:[e.jsxs("div",{className:"max-w-2xl mx-auto",children:[(()=>{const t=c.length>0&&c.some(i=>{const r=Z[i.fixture_index];return r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")});let s=0;if(t?c.forEach(i=>{const r=Z[i.fixture_index],m=y.get(i.fixture_index);if(r&&m){let a=!1;(m.pick==="H"&&r.homeScore>r.awayScore||m.pick==="A"&&r.awayScore>r.homeScore||m.pick==="D"&&r.homeScore===r.awayScore)&&(a=!0),a&&s++}}):h&&c.forEach(i=>{const r=P.get(i.fixture_index),m=y.get(i.fixture_index);r&&m&&r===m.pick&&s++}),t||h&&c.length>0){const i=t?s:h?ue:0;return e.jsx(Nt,{score:i,total:c.length,topPercent:Je})}return null})(),e.jsx("div",{className:"space-y-6 [&>div:first-child]:mt-0",children:(()=>{const t=[];let s="",i=[];return c.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{className:m>0?"mt-6":"",children:[e.jsx(vt,{date:r.label}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:r.items.map((a,p)=>{const l=y.get(a.fixture_index),f=Z[a.fixture_index],A={id:a.id,gw:a.gw,fixture_index:a.fixture_index,home_code:a.home_code,away_code:a.away_code,home_team:a.home_team,away_team:a.away_team,home_name:a.home_name,away_name:a.away_name,kickoff_time:a.kickoff_time,api_match_id:a.api_match_id},W=f?{status:f.status,minute:f.minute??null,homeScore:f.homeScore,awayScore:f.awayScore,home_team:f.home_team,away_team:f.away_team,goals:f.goals??void 0,red_cards:f.red_cards??void 0}:null;return e.jsx("li",{className:p>0?"border-t":"",children:e.jsx(jt,{fixture:A,pick:l?.pick,liveScore:W,isTestApi:!0,showPickButtons:!0})},a.id)})})})]},m))})()})]}),e.jsx("div",{className:"p-6 pb-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("button",{onClick:()=>{sessionStorage.setItem("showConfettiOnHome","true"),x("/"),window.scrollTo({top:0,behavior:"instant"})},className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors",children:"SUBMIT YOUR PREDICTIONS"})})})]})]})}const He=Q();if(!h&&He&&se&&(V(!1),S.current=!1),console.log("[TestApiPredictions] Review mode check - submitted:",h,"ref:",S.current,"sessionStorage:",He),console.log("[TestApiPredictions] Review mode check - currentIndex:",w,"fixtures.length:",c.length,"submitted:",h),w>=c.length)return console.log("[TestApiPredictions] ✅ Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ye&&M.width>0&&M.height>0&&e.jsx(Pe,{width:M.width,height:M.height,recycle:!1,numberOfPieces:500,gravity:.3}),ge&&e.jsx(St,{success:ge.success,message:ge.message,onClose:()=>te(null)}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),X&&!h?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):h?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"✓ Submitted"}):y.size>0?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>v(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:h?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let s="",i=[];return c.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:r.label}),e.jsx("div",{className:"space-y-4",children:r.items.map(a=>{const p=y.get(a.fixture_index),l=P.get(a.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:a.home_team||a.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(xe,{code:a.home_code,crest:a.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:a.kickoff_time?new Date(a.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(xe,{code:a.away_code,crest:a.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:a.away_team||a.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(h)return;const f=new Map(y);f.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"H",matchday:d}),E(f),he("H")},disabled:h,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${p?.pick==="H"?l&&l==="H"&&p.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="D"||l==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="H"?"bg-gray-300 text-slate-700 border-gray-400":h?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(h)return;const f=new Map(y);f.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"D",matchday:d}),E(f),he("D")},disabled:h,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${p?.pick==="D"?l&&l==="D"&&p.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="H"||l==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="D"?"bg-gray-300 text-slate-700 border-gray-400":h?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(h)return;const f=new Map(y);f.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"A",matchday:d}),E(f),he("A")},disabled:h,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${p?.pick==="A"?l&&l==="A"&&p.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="H"||l==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="A"?"bg-gray-300 text-slate-700 border-gray-400":h?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},a.id)})})]},m))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:h?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",d," have been confirmed."]}),ue>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[ue,"/",c.length]}),e.jsx("button",{onClick:()=>{sessionStorage.setItem("showConfettiOnHome","true"),x("/"),window.scrollTo({top:0,behavior:"instant"})},className:"w-full mt-4 py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors",children:"SUBMIT YOUR PREDICTIONS"})]}):e.jsxs(e.Fragment,{children:[!X&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[!X&&e.jsx("button",{onClick:lt,disabled:h,className:"w-full py-3 bg-slate-200 text-slate-700 rounded-2xl font-semibold hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Over"}),e.jsx("button",{onClick:Ne,disabled:!X,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:X?"SUBMIT YOUR PREDICTIONS":"Complete All Predictions First"}),!X&&e.jsx("button",{onClick:()=>x("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})})})]});const dt=Q(),mt=(()=>{if(typeof window>"u"||!n?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${n.id}`)&&sessionStorage.getItem(s)==="true")return!0}}catch{}return!1})(),I=h||dt&&S.current||mt,re=I?"list":z;return I&&z==="cards"?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})}):!D&&c.length>0?(v(0),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):c.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"No fixtures available"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Check back later for Test GW ",d," fixtures."]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media (max-height: 700px) {
          .swipe-cards-container {
            padding-top: 0 !important;
          }
        }
        @media (min-height: 701px) {
          .swipe-cards-container {
            padding-top: 1.5rem;
          }
        }
      `}),e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[we.current&&!I&&!h&&re==="cards"&&z==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",style:{display:I?"none":"block"},children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>x("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"✕"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",d]}),!I&&re==="cards"&&e.jsxs("button",{onClick:()=>v(c.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),!I&&re==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-0",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:c.map((t,s)=>{const i=s<w,r=s===w;return e.jsx("div",{className:`flex items-center justify-center transition-all ${r?"h-2 w-6 rounded-full bg-[#178f72]":"h-3 w-3 rounded-full"} ${i&&!r?"bg-[#116f59]":r?"":"bg-white"}`},s)})})})]})}),(I||re==="list")&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>x("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",d," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:ue})]})})}),!I&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{$("cards"),v(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}),we.current&&!I&&!h&&re==="cards"&&z==="cards"&&e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1",style:{height:"100%",paddingBottom:"0"},children:[e.jsxs("div",{className:"swipe-cards-container flex items-start justify-center px-4 relative overflow-hidden flex-1",style:{minHeight:0,width:"100%"},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${pe==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"←"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${pe==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"→"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${pe==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"↓"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75",display:I?"none":"block"},children:[w<c.length-1&&(()=>{const t=c[w+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:ee||q?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsx(qe,{fixture:t,homeColor:fe(t.home_code,t.home_name),awayColor:fe(t.away_code,t.away_name),showSwipeHint:!1,homeForm:N.get((t.home_code||"").toUpperCase().trim())||null,awayForm:N.get((t.away_code||"").toUpperCase().trim())||null})},w+1)})(),e.jsx("div",{className:"absolute inset-0 z-10",style:{transform:`translate(${k.x}px, ${k.y}px) rotate(${k.rotation}deg) scale(${k.scale})`,opacity:k.opacity,transition:ee||je.current?"none":"all 0.3s ease-out",pointerEvents:"none",display:I?"none":"block"},children:e.jsx(qe,{fixture:D,homeColor:fe(D.home_code,D.home_name),awayColor:fe(D.away_code,D.away_name),showSwipeHint:!0,homeForm:N.get((D.home_code||"").toUpperCase().trim())||null,awayForm:N.get((D.away_code||"").toUpperCase().trim())||null})}),e.jsx("div",{ref:nt,className:"absolute inset-0 z-50 cursor-grab active:cursor-grabbing",style:{touchAction:"none",WebkitTouchCallout:"none",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"auto",backgroundColor:"transparent",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",margin:0,padding:0},onMouseDown:t=>{t.preventDefault(),!h&&Be(t.clientX,t.clientY)},onMouseMove:t=>{t.preventDefault(),!h&&$e(t.clientX,t.clientY)},onMouseUp:t=>{t.preventDefault(),_e()},onMouseLeave:t=>{t.preventDefault(),_e()},onTouchStart:ot,onTouchMove:at,onTouchEnd:We,onTouchCancel:We})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-4 bg-[#eef4f3] z-[10000] safe-area-inset-bottom",style:{paddingBottom:"calc(2rem + env(safe-area-inset-bottom, 0px))",paddingTop:"1.5rem"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>ke("H"),disabled:q||h,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:k.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(k.x)/150)})`:void 0,color:k.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>ke("D"),disabled:q||h,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:k.y>30?`rgba(59, 130, 246, ${Math.min(.8,k.y/150)})`:void 0,color:k.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>ke("A"),disabled:q||h,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:k.x>30?`rgba(34, 197, 94, ${Math.min(.8,k.x/150)})`:void 0,color:k.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]})]})}export{It as default};
