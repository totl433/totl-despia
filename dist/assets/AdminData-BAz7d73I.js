import{u as q,y as K,r as o,j as s,L as b,z as W,A as V,a as g}from"./index-jw27CSin.js";function z(){const{user:x}=q(),w=K(),y=x?.id==="4542c037-5b38-40d0-b189-847b8f17c222"||x?.id==="36f31625-6d6c-4aa4-815a-1493a812841b",[U,C]=o.useState(null),[f,M]=o.useState(null),[j,J]=o.useState(""),[v,$]=o.useState(""),[L,k]=o.useState(!1),[S,m]=o.useState(null),[N,E]=o.useState([]),[c,D]=o.useState(null),[O,I]=o.useState(!1),[h,T]=o.useState([]),[A,F]=o.useState(!1),[d,_]=o.useState([]),[P,R]=o.useState(!1);o.useEffect(()=>{x&&!y&&w("/profile")},[x,y,w]),o.useEffect(()=>{let e=0;const a=40,t=()=>{const r=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null);return r?(C(!0),M(String(r)),!0):(e++,e<a?setTimeout(t,500):C(!1),!1)};t()},[]),o.useEffect(()=>{const e=()=>{try{const t=localStorage.getItem("app_crashes");t&&E(JSON.parse(t))}catch(t){console.error("[AdminData] Failed to load crashes:",t)}try{const t=V();T(t)}catch(t){console.error("[AdminData] Failed to load fetch logs:",t)}try{const t=localStorage.getItem("message_subscription_logs");t&&_(JSON.parse(t))}catch(t){console.error("[AdminData] Failed to load subscription logs:",t)}};e();const a=setInterval(e,2e3);return()=>clearInterval(a)},[]);const H=async()=>{I(!0);try{const e={timestamp:Date.now(),checks:{},issues:[]},{data:a,error:t}=await g.from("meta").select("*").limit(1);e.checks.meta={exists:!t&&a&&a.length>0,error:t?.message},(t||!a||a.length===0)&&e.issues.push("meta table missing or empty");const{data:r,error:n}=await g.from("fixtures").select("id").limit(1);e.checks.fixtures={exists:!n&&r&&r.length>0,error:n?.message},(n||!r||r.length===0)&&e.issues.push("fixtures table missing or empty");const{error:i}=await g.from("live_scores").select("id").limit(1);e.checks.live_scores={exists:!i,error:i?.message};const{error:l}=await g.from("app_gw_results").select("*").limit(1);e.checks.app_gw_results={exists:!l,error:l?.message};const{error:u}=await g.from("push_subscriptions").select("id").limit(1);e.checks.push_subscriptions={exists:!u,error:u?.message};const{error:p}=await g.from("league_members").select("id").limit(1);e.checks.league_members={exists:!p,error:p?.message},D(e)}catch(e){console.error("[AdminData] Error checking data health:",e),D({timestamp:Date.now(),error:e.message,checks:{},issues:["Failed to check data health"]})}finally{I(!1)}},G=async()=>{try{if(d.length===0){alert("No subscription logs to copy");return}const e=`=== SUBSCRIPTION STATUS LOGS ===
Date: ${new Date().toISOString()}
Total Logs: ${d.length}

${d.slice().reverse().map((a,t)=>{const r=new Date(a.timestamp).toISOString();return`[${t+1}] ${r}
  Status: ${a.status}
  League ID: ${a.leagueId||"N/A"}
  Channel: ${a.channel||"N/A"}
`}).join(`
`)}`;await navigator.clipboard.writeText(e),R(!0),setTimeout(()=>R(!1),3e3)}catch(e){console.error("[AdminData] Failed to copy subscription logs:",e),alert("Failed to copy subscription logs: "+e.message)}},B=async()=>{try{const e={timestamp:new Date().toISOString(),user:x?.id||"unknown",despiaDetected:U,playerId:f?f.slice(0,8)+"...":null,crashes:N.length>0?N.slice(-10).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),errorMessage:t.errorMessage,url:t.url})):[],dataHealth:c?{timestamp:new Date(c.timestamp).toISOString(),issues:c.issues||[],checks:c.checks||{}}:null,dataFetches:h.slice(-20).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),location:t.location,query:t.query,table:t.table,result:t.result,rowCount:t.rowCount,error:t.error})),messageSubscriptions:d.slice(-20).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),leagueId:t.leagueId,status:t.status,channel:t.channel})),deepLink:(()=>{try{const t=localStorage.getItem("deepLink_debug"),r=localStorage.getItem("deepLink_result"),n=localStorage.getItem("deepLink_history"),i=n?JSON.parse(n):[];return{debug:t?JSON.parse(t):null,result:r?JSON.parse(r):null,history:i.length>0?i:null,summary:i.length>0?{total:i.length,successful:i.filter(l=>l.success).length,failed:i.filter(l=>!l.success).length}:null}}catch{return null}})(),notifications:(()=>{try{const t=localStorage.getItem("notification_logs");return t?JSON.parse(t).slice(-10).reverse():[]}catch{return[]}})()},a=`=== TOTL DEBUG REPORT ===
Date: ${e.timestamp}
User: ${e.user}
Despia: ${e.despiaDetected?"Yes":"No"}
Player ID: ${e.playerId||"Not available"}

=== CRASHES ===
${e.crashes.length>0?e.crashes.map(t=>`[${t.timestamp}] ${t.errorMessage}
  URL: ${t.url}`).join(`

`):"No crashes recorded"}

=== DATA HEALTH ===
${e.dataHealth?`Checked: ${e.dataHealth.timestamp}
Issues: ${e.dataHealth.issues.length>0?e.dataHealth.issues.join(", "):"None"}

Checks:
${Object.entries(e.dataHealth.checks).map(([t,r])=>`  ${t}: ${r.exists?"âœ…":"âŒ"} ${r.error||""}`).join(`
`)}`:"Not checked yet"}

=== DATA FETCHES (Last 20) ===
${e.dataFetches.map(t=>`[${t.timestamp}] ${t.location} - ${t.query}
  Table: ${t.table}
  Result: ${t.result} ${t.rowCount!==void 0?`(${t.rowCount} rows)`:""}${t.error?`
  Error: ${t.error}`:""}`).join(`

`)}

=== DEEP LINK DEBUG ===
${e.deepLink?(()=>{const t=e.deepLink;let r="";return t.summary&&(r+=`Summary: ${t.summary.total} attempts (${t.summary.successful} successful, ${t.summary.failed} failed)

`),t.debug&&(r+=`Last Check:
${JSON.stringify(t.debug,null,2)}

`),t.result&&(r+=`Last Result:
${JSON.stringify(t.result,null,2)}

`),t.history&&t.history.length>0&&(r+=`History (last ${Math.min(t.history.length,20)}):
`,t.history.slice(-20).reverse().forEach((n,i)=>{r+=`[${i+1}] ${n.success?"âœ…":"âŒ"} ${new Date(n.timestamp).toISOString()}
`,r+=`${JSON.stringify(n,null,2)}

`})),r.trim()})():"No deep link attempts"}

=== NOTIFICATION LOGS ===
${e.notifications.length>0?e.notifications.map(t=>`[${new Date(t.timestamp).toISOString()}] ${t.ok?"OK":"Failed"} - Sent: ${t.sent||0}`).join(`
`):"No notification attempts"}

=== MESSAGE SUBSCRIPTION LOGS ===
${e.messageSubscriptions&&e.messageSubscriptions.length>0?e.messageSubscriptions.map(t=>`[${t.timestamp}] League ${t.leagueId?.slice(0,8)}... - Status: ${t.status} - Channel: ${t.channel}`).join(`
`):"No subscription logs"}

=== MESSAGE FETCHES (from Data Fetch Logs) ===
${e.dataFetches.filter(t=>t.table==="league_messages"||t.query?.toLowerCase().includes("message")).map(t=>`[${t.timestamp}] ${t.location} - ${t.query}
  Table: ${t.table}
  Result: ${t.result} ${t.rowCount!==void 0?`(${t.rowCount} rows)`:""}${t.error?`
  Error: ${t.error}`:""}`).join(`

`)||"No message-related fetches yet"}`;await navigator.clipboard.writeText(a),F(!0),setTimeout(()=>F(!1),3e3)}catch(e){console.error("[AdminData] Failed to copy logs:",e),alert("Failed to copy logs: "+e.message)}};return x?y?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:s.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-slate-800",children:"Admin Data"}),s.jsx(b,{to:"/profile",className:"text-slate-600",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})]}),s.jsx("p",{className:"text-slate-600 text-sm mb-4",children:"Admin tools for debugging and managing data."}),s.jsx("button",{onClick:B,className:`w-full py-3 font-semibold rounded-xl text-center transition-colors ${A?"bg-emerald-600 text-white":"bg-[#1C8376] text-white hover:bg-[#156d62]"}`,children:A?"âœ… Logs Copied! Paste to share":"ðŸ“‹ Copy All Logs"}),s.jsx("p",{className:"text-xs text-slate-500 mt-2 text-center",children:"Copies all diagnostic logs in an easy-to-share format"})]}),f&&s.jsx("div",{className:"mb-6 bg-white rounded-xl shadow-md p-4",children:s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Player ID: "}),s.jsxs("span",{className:"font-mono text-xs text-slate-700",children:[f.slice(0,8),"â€¦",f.slice(-4)]})]})}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ’¥ Crash Logs"}),s.jsx("div",{className:"space-y-3",children:N.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"text-sm text-slate-600 mb-2",children:["Total crashes: ",N.length," (showing last 10)"]}),N.slice(-10).reverse().map((e,a)=>s.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs",children:[s.jsx("div",{className:"font-semibold text-red-800 mb-1",children:new Date(e.timestamp).toLocaleString()}),s.jsx("div",{className:"text-red-700 mb-2",children:e.errorMessage}),s.jsxs("details",{className:"text-red-600",children:[s.jsx("summary",{className:"cursor-pointer",children:"Stack trace"}),s.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-red-100 p-2 rounded",children:e.errorStack})]}),e.componentStack&&s.jsxs("details",{className:"text-red-600 mt-2",children:[s.jsx("summary",{className:"cursor-pointer",children:"Component stack"}),s.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-red-100 p-2 rounded",children:e.componentStack})]}),s.jsxs("div",{className:"text-red-600 mt-2 text-xs",children:["URL: ",e.url]})]},a)),s.jsx("button",{onClick:()=>{localStorage.removeItem("app_crashes"),E([])},className:"w-full py-2 bg-red-600 text-white font-medium rounded-lg text-sm",children:"Clear All Crashes"})]}):s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No crashes recorded. The app is running smoothly! ðŸŽ‰"})})]}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ“Š Data Fetch Logs"}),s.jsx("div",{className:"space-y-3",children:h.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"text-sm text-slate-600 mb-2",children:["Total fetches: ",h.length," (showing last 15)"]}),h.slice(-15).reverse().map((e,a)=>s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${e.result==="error"?"bg-red-50 border-red-200":e.result==="empty"?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"}`,children:[s.jsxs("div",{className:"font-semibold mb-1",children:[new Date(e.timestamp).toLocaleString()," - ",e.location]}),s.jsxs("div",{className:"text-slate-700 mb-1",children:[s.jsx("strong",{children:"Query:"})," ",e.query]}),s.jsxs("div",{className:"text-slate-600 mb-1",children:[s.jsx("strong",{children:"Table:"})," ",e.table,e.filters&&Object.keys(e.filters).length>0&&s.jsxs("span",{className:"ml-2",children:["(",JSON.stringify(e.filters),")"]})]}),s.jsxs("div",{className:`font-medium ${e.result==="error"?"text-red-600":e.result==="empty"?"text-amber-600":"text-emerald-600"}`,children:["Result: ",e.result==="error"?"âŒ Error":e.result==="empty"?"âš ï¸ Empty":"âœ… Success",e.rowCount!==void 0&&` (${e.rowCount} rows)`,e.error&&` - ${e.error}`]}),e.dataPreview&&e.result==="success"&&s.jsxs("details",{className:"mt-2",children:[s.jsx("summary",{className:"cursor-pointer text-slate-500",children:"Data preview"}),s.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-white p-2 rounded border",children:JSON.stringify(e.dataPreview,null,2)})]})]},a)),s.jsx("button",{onClick:()=>{W(),T([])},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Fetch Logs"})]}):s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No data fetch logs yet. Data fetches will appear here as you use the app."})})]}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ’¬ Message Debug"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"text-sm text-slate-600 mb-2",children:"Message fetch logs from Data Fetch Logs (filtered for messages):"}),h.filter(e=>e.table==="league_messages"||e.query?.toLowerCase().includes("message")).length>0?s.jsx("div",{className:"space-y-2",children:h.filter(e=>e.table==="league_messages"||e.query?.toLowerCase().includes("message")).slice(-10).reverse().map((e,a)=>s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${e.result==="error"?"bg-red-50 border-red-200":e.result==="empty"?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"}`,children:[s.jsxs("div",{className:"font-semibold mb-1",children:[new Date(e.timestamp).toLocaleString()," - ",e.query]}),s.jsxs("div",{className:"text-slate-600 mb-1",children:["League: ",e.filters?.leagueId||"N/A"," | Result: ",e.result==="error"?"âŒ Error":e.result==="empty"?"âš ï¸ Empty":"âœ… Success"," (",e.rowCount||0," rows)"]}),e.error&&s.jsxs("div",{className:"text-red-600 text-xs",children:["Error: ",e.error]})]},a))}):s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No message fetch logs yet. Open a league chat to see message queries."}),s.jsx("div",{className:"text-sm text-slate-600 mb-2 mt-4",children:"Real-time subscription status (last 20):"}),d.length>0?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 text-xs",children:[s.jsx("div",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“Š Subscription Stats:"}),s.jsxs("div",{className:"space-y-1 text-blue-700",children:[s.jsxs("div",{children:["Total events: ",d.length]}),s.jsxs("div",{children:["SUBSCRIBED: ",d.filter(e=>e.status==="SUBSCRIBED").length," | CLOSED: ",d.filter(e=>e.status==="CLOSED").length," | Errors: ",d.filter(e=>e.status==="CHANNEL_ERROR"||e.status==="TIMED_OUT").length]}),d.length>=2&&(()=>{const e=d.slice(-10).reverse(),a=[];for(let t=0;t<e.length-1;t++)if(e[t].status==="CLOSED"&&e[t+1]?.status==="SUBSCRIBED"){const r=e[t].timestamp-e[t+1].timestamp;a.push(r)}if(a.length>0){const t=Math.round(a.reduce((i,l)=>i+l,0)/a.length/1e3),r=Math.round(Math.min(...a)/1e3),n=Math.round(Math.max(...a)/1e3);return s.jsx("div",{className:"mt-1",children:a.length>1?s.jsxs(s.Fragment,{children:["Avg cycle time: ~",t,"s (min: ",r,"s, max: ",n,"s)"]}):s.jsxs(s.Fragment,{children:["Last cycle: ~",t,"s"]})})}return null})()]})]}),d.slice(-20).reverse().map((e,a)=>{let t="bg-slate-50",r="border-slate-200";return e.status==="SUBSCRIBED"||e.status==="COMPONENT_MOUNT"||e.status==="EFFECT_MOUNT"||e.status==="LEAGUE_PAGE_MOUNT"?(t="bg-emerald-50",r="border-emerald-200"):e.status==="CHANNEL_ERROR"||e.status==="TIMED_OUT"?(t="bg-red-50",r="border-red-200"):e.status==="CLOSED"||e.status==="COMPONENT_UNMOUNT"||e.status==="EFFECT_UNMOUNT"||e.status==="LEAGUE_PAGE_UNMOUNT"?(t="bg-amber-50",r="border-amber-200"):e.status==="DEEP_LINK_EFFECT_RUN"||e.status==="DEEP_LINK_EARLY_RETURN"?(t="bg-blue-50",r="border-blue-200"):e.status==="NAVIGATE_CALLED"&&(t="bg-purple-50",r="border-purple-200"),s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${t} ${r}`,children:[s.jsxs("div",{className:"font-semibold mb-1",children:[new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})," - ",e.status]}),e.leagueId&&s.jsxs("div",{className:"text-slate-600 text-xs mb-1",children:["League: ",e.leagueId?.slice(0,8),"... | Channel: ",e.channel]}),e.changedFields&&e.changedFields.length>0&&s.jsxs("div",{className:"text-blue-700 text-xs mt-1 font-semibold",children:["Changed: ",Array.isArray(e.changedFields)?e.changedFields.join(", "):e.changedFields]}),e.location&&s.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["Path: ",e.location.pathname," | Search: ",e.location.search||"(empty)"]}),e.from&&e.to&&s.jsxs("div",{className:"text-purple-700 text-xs mt-1",children:["Navigate: ",e.from," â†’ ",e.to]}),e.dependencies&&s.jsxs("details",{className:"mt-1",children:[s.jsx("summary",{className:"cursor-pointer text-slate-500 text-xs",children:"Dependencies"}),s.jsx("pre",{className:"mt-1 whitespace-pre-wrap break-all text-xs bg-white p-2 rounded border",children:JSON.stringify(e.dependencies,null,2)})]}),e.trigger&&s.jsxs("div",{className:"text-purple-700 text-xs mt-1 font-semibold",children:["Trigger: navigateChanged=",String(e.trigger.navigateChanged),", pathnameChanged=",String(e.trigger.pathnameChanged),e.trigger.prevPathname&&e.trigger.currentPathname&&s.jsxs("div",{className:"text-purple-600 text-xs mt-0.5",children:['Pathname: "',e.trigger.prevPathname,'" â†’ "',e.trigger.currentPathname,'"']})]}),e.reason&&s.jsxs("div",{className:"text-orange-600 text-xs mt-1",children:["Reason: ",e.reason]}),a<d.slice(-20).length-1&&(()=>{const n=d.slice(-20).reverse()[a+1],i=Math.round((e.timestamp-n.timestamp)/1e3);return s.jsxs("div",{className:"text-slate-400 text-xs mt-1",children:["â±ï¸ ",i,"s after previous event"]})})()]},a)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:G,className:`flex-1 py-2 font-medium rounded-lg text-sm ${P?"bg-emerald-600 text-white":"bg-[#1C8376] text-white hover:bg-[#156d62]"}`,children:P?"âœ… Copied!":"ðŸ“‹ Copy All Subscription Logs"}),s.jsx("button",{onClick:()=>{localStorage.removeItem("message_subscription_logs"),_([]),window.location.reload()},className:"flex-1 py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Subscription Logs"})]})]}):s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No subscription logs yet. Open a league chat to see subscription status."})]})]}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ¥ Data Health"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:H,disabled:O,className:"w-full py-2 bg-blue-600 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:O?"Checking...":"Check Data Health"}),c&&s.jsxs("div",{className:`p-4 rounded-lg border ${c.issues&&c.issues.length>0?"bg-red-50 border-red-200":"bg-emerald-50 border-emerald-200"}`,children:[s.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Last checked: ",new Date(c.timestamp).toLocaleString()]}),c.error?s.jsxs("div",{className:"text-red-700 text-sm",children:["Error: ",c.error]}):s.jsxs(s.Fragment,{children:[c.issues&&c.issues.length>0?s.jsxs("div",{className:"text-red-700 text-sm mb-2",children:["âš ï¸ Issues found: ",c.issues.join(", ")]}):s.jsx("div",{className:"text-emerald-700 text-sm mb-2",children:"âœ… All checks passed"}),s.jsx("div",{className:"space-y-1 text-xs",children:Object.entries(c.checks||{}).map(([e,a])=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"font-mono",children:[e,":"]}),s.jsxs("span",{className:a.exists?"text-emerald-600":"text-red-600",children:[a.exists?"âœ…":"âŒ"," ",a.error||""]})]},e))})]})]})]})]}),s.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[s.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Send Notification to All Users"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Title"}),s.jsx("input",{type:"text",value:j,onChange:e=>J(e.target.value),placeholder:"Notification title",className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Message"}),s.jsx("textarea",{value:v,onChange:e=>$(e.target.value),placeholder:"Notification message",rows:3,className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),S&&s.jsx("div",{className:`rounded border px-3 py-2 text-sm whitespace-pre-wrap break-words max-h-60 overflow-y-auto ${S.startsWith("âœ…")?"border-emerald-200 bg-emerald-50 text-emerald-800":S.startsWith("âš ï¸")?"border-amber-200 bg-amber-50 text-amber-800":"border-red-200 bg-red-50 text-red-700"}`,children:S}),s.jsx("button",{onClick:async()=>{if(!j.trim()||!v.trim()){m("âŒ Please enter both title and message");return}k(!0),m(null);try{const t=`${window.location.hostname==="localhost"?"https://totl-staging.netlify.app":""}/.netlify/functions/sendPushAllV2`,r=await fetch(t,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j.trim(),message:v.trim()})}).catch(l=>{throw new Error(`Network error: ${l.message||"Failed to connect to server."}`)});if(!r.ok){const l=await r.text().catch(()=>"Unknown error");m(`âŒ Server error (${r.status}): ${l||"Failed to send notification"}`);return}const n=await r.text();if(!n||n.trim()===""){m("âŒ Empty response from server");return}let i;try{i=JSON.parse(n)}catch(l){m(`âŒ Invalid response from server: ${l.message||"Failed to parse response"}`);return}if(i.ok){if(i.warning)m(`âš ï¸ ${i.warning} (checked ${i.checked||0} device(s))`);else{const l=i.sentTo||0,u=i.expected||l,p=i.userCount||0;i.hasNotificationId&&!i.oneSignalErrors?m(`âœ… Notification sent to ${u} device(s) (${p} users)`):i.oneSignalErrors&&i.oneSignalErrors.length>0?m(`âš ï¸ Sent to ${l} device(s) (${p} users, expected ${u}). OneSignal errors: ${i.oneSignalErrors.join(", ")}`):m(`âœ… Notification sent to ${l} device(s) (${p} users)`)}$("")}else m(`âŒ Failed to send: ${i.error||"Unknown error"}`)}catch(e){console.error("[AdminData] Error sending notification:",e),m(`âŒ Error: ${e.message||"Failed to send notification"}`)}finally{k(!1)}},disabled:L||!j.trim()||!v.trim(),className:"w-full py-2 bg-[#1C8376] text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:L?"Sending...":"Send to All Users"}),s.jsx("div",{className:"text-xs text-slate-500",children:"Sends a push notification to all users with active, subscribed devices."})]})]}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ”— Deep Link Debug"}),s.jsx("div",{className:"space-y-3",children:(()=>{try{const e=localStorage.getItem("deepLink_debug"),a=localStorage.getItem("deepLink_result"),t=localStorage.getItem("deepLink_history"),r=t?JSON.parse(t):[],n=r.filter(l=>!l.success).length,i=r.filter(l=>l.success).length;return s.jsxs(s.Fragment,{children:[r.length>0&&s.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 text-xs",children:[s.jsx("div",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“Š Summary:"}),s.jsxs("div",{className:"text-blue-700 space-y-1",children:[s.jsxs("div",{children:["Total attempts: ",r.length]}),s.jsxs("div",{children:["âœ… Successful: ",i," | âŒ Failed: ",n]})]})]}),e&&s.jsxs("div",{className:"p-3 bg-blue-600/10 rounded-lg border border-blue-600/20 text-xs",children:[s.jsx("div",{className:"font-semibold text-blue-600 mb-2",children:"Last Check:"}),s.jsx("pre",{className:"text-blue-600 whitespace-pre-wrap break-all",children:JSON.stringify(JSON.parse(e),null,2)})]}),a&&s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${JSON.parse(a).success?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[s.jsxs("div",{className:`font-semibold mb-2 ${JSON.parse(a).success?"text-emerald-800":"text-red-800"}`,children:[JSON.parse(a).success?"âœ… Success":"âŒ Failed",":"]}),s.jsx("pre",{className:`whitespace-pre-wrap break-all ${JSON.parse(a).success?"text-emerald-700":"text-red-700"}`,children:JSON.stringify(JSON.parse(a),null,2)})]}),r.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-sm text-slate-600 mb-2 font-semibold",children:["History (last ",Math.min(r.length,20)," attempts):"]}),r.slice(-20).reverse().map((l,u)=>s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${l.success?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[s.jsxs("div",{className:`font-semibold mb-1 ${l.success?"text-emerald-800":"text-red-800"}`,children:[l.success?"âœ…":"âŒ Failed",": ",new Date(l.timestamp).toLocaleString()]}),s.jsx("pre",{className:`whitespace-pre-wrap break-all text-xs ${l.success?"text-emerald-700":"text-red-700"}`,children:JSON.stringify(l,null,2)})]},u))]}),!e&&!a&&r.length===0&&s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No deep link attempts recorded yet. Tap a chat notification to see debug info."}),s.jsx("button",{onClick:()=>{localStorage.removeItem("deepLink_debug"),localStorage.removeItem("deepLink_result"),localStorage.removeItem("deepLink_history"),window.location.reload()},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Debug Info"})]})}catch(e){return s.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs text-red-700",children:["Error reading debug info: ",String(e)]})}})()})]}),s.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ”” Notification Diagnostic"}),s.jsx("div",{className:"space-y-3",children:(()=>{try{const e=localStorage.getItem("notification_logs"),a=e?JSON.parse(e):[];return s.jsxs(s.Fragment,{children:[a.length>0?s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2",children:"Recent notification attempts (last 10):"}),a.slice(-10).reverse().map((t,r)=>s.jsxs("div",{className:`p-3 rounded-lg border text-xs ${t.ok?t.sent>0?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:[s.jsxs("div",{className:"font-semibold mb-1",children:[new Date(t.timestamp).toLocaleTimeString()," - ",t.ok?t.sent>0?"âœ… Sent":"âš ï¸ No delivery":"âŒ Failed"]}),s.jsx("pre",{className:"whitespace-pre-wrap break-all text-xs",children:JSON.stringify(t,null,2)})]},r))]}):s.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No notification attempts logged yet. Send a chat message to see diagnostic info."}),s.jsx("button",{onClick:()=>{localStorage.removeItem("notification_logs"),window.location.reload()},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Notification Logs"})]})}catch(e){return s.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs text-red-700",children:["Error reading notification logs: ",String(e)]})}})()})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Admin Pages"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(b,{to:"/api-admin",className:"block w-full py-3 bg-[#1C8376] text-white font-semibold rounded-xl text-center",children:"API Admin - Premier League"}),s.jsx(b,{to:"/test-fixtures",className:"block w-full py-3 bg-purple-600 text-white font-semibold rounded-xl text-center",children:"Test Fixtures (Non-PL)"}),s.jsx(b,{to:"/admin",className:"block w-full py-3 bg-slate-600 text-white font-semibold rounded-xl text-center",children:"Admin Panel (Web)"})]})]})]})}):s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-slate-600 mb-4",children:"Access denied. Admin only."}),s.jsx(b,{to:"/profile",className:"text-[#1C8376]",children:"Go to Profile"})]})}):s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-slate-600 mb-4",children:"Please sign in to view admin data."}),s.jsx(b,{to:"/profile",className:"text-[#1C8376]",children:"Go to Profile"})]})})}export{z as default};
