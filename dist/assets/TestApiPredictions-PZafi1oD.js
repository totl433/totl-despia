import{j as e,u as at,d as nt,r as b,s as A}from"./index-CM5W4S7F.js";import{g as R}from"./teamNames-Cx8q5lWp.js";function ot({code:x,size:N=22,className:h="",rounded:W=!1}){const d=`/assets/badges/${x}.png`,B=`${x} badge`;return e.jsx("img",{src:d,alt:B,width:N,height:N,className:`${W?"rounded-full":"rounded"} object-contain inline-block align-middle select-none ${h}`,loading:"lazy",onError:E=>{E.currentTarget.style.opacity="0.35"}})}function lt(x){let N=0;for(let B=0;B<x.length;B++)N=x.charCodeAt(B)+((N<<5)-N);const h=Math.abs(N%360),W=60+Math.abs(N)%20,d=45+Math.abs(N)%15;return`hsl(${h}, ${W}%, ${d}%)`}function he(x,N){return x&&qe[x]?qe[x].primary:lt(x||N||"default")}function ct(x,N){return x==="FINISHED"?"FT":x==="PAUSED"?"HT":x==="IN_PLAY"?N==null?"LIVE":`${N}'`:"LIVE"}function re({code:x,crest:N,size:h=22,className:W=""}){const[d,B]=b.useState(!1);return N&&!d?e.jsx("img",{src:N,alt:`${x||"Team"} badge`,width:h,height:h,className:`rounded object-contain inline-block align-middle select-none ${W}`,loading:"lazy",onError:()=>{B(!0)}}):x?e.jsx(ot,{code:x,size:h,className:W}):e.jsx("div",{className:`rounded bg-slate-200 ${W}`,style:{width:h,height:h}})}const qe={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function ut(){const{user:x}=at(),N=nt(),[h,W]=b.useState(null),[d,B]=b.useState([]),[E,O]=b.useState(new Map),[G,Se]=b.useState(new Map),[$,q]=b.useState(0),[te,Ue]=b.useState("cards"),[I,ce]=b.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[ae,Pe]=b.useState(!1),[Y,Te]=b.useState(!1),[fe,se]=b.useState(null),[Oe,Ye]=b.useState(!1),[ne,ie]=b.useState(null),[Ee,pe]=b.useState(!0),[Ce,ge]=b.useState(!1),[be,oe]=b.useState(!1),[p,z]=b.useState(!1),[Ae,de]=b.useState(null),[C,De]=b.useState(!1),[ze,Ve]=b.useState(!1),[me,Ke]=b.useState([]),[Ie,Xe]=b.useState(new Set),[Me,Je]=b.useState(null),[V,Fe]=b.useState({}),Le=b.useRef({}),K=()=>{if(typeof window>"u")return!1;const t=`test_api_submitted_${h}_${x?.id}`;return sessionStorage.getItem(t)==="true"},ye=t=>{if(typeof window>"u"||!h||!x?.id)return;const s=`test_api_submitted_${h}_${x?.id}`;t?sessionStorage.setItem(s,"true"):sessionStorage.removeItem(s)},X=b.useRef(K());b.useEffect(()=>{const t=document.documentElement,s=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const r=setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(r),t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),b.useEffect(()=>{const t=$>=d.length,s=te==="cards"&&!t&&d.length>0&&!p,i=document.documentElement,r=document.body,m=document.getElementById("root"),n=()=>{i.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),m&&m.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),m&&m.style.removeProperty("overflow")};if(!s){n();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),r.style.setProperty("overflow","hidden","important"),r.style.setProperty("position","fixed","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("height","100%","important"),r.style.setProperty("top","0","important"),m&&m.style.setProperty("overflow","hidden","important");const o=a=>{a.preventDefault()},l=a=>{a.target.closest('[style*="aspectRatio"]')||a.preventDefault()};return window.addEventListener("wheel",o,{passive:!1}),document.addEventListener("touchmove",l,{passive:!1}),()=>{n(),window.removeEventListener("wheel",o),document.removeEventListener("touchmove",l)}},[te,$,d.length,p]);const le=b.useMemo(()=>d.length===0?!1:d.every(t=>E.has(t.fixture_index)),[d,E]),Qe=b.useRef(null),we=b.useRef({x:0,y:0}),ve=b.useRef(!1);b.useEffect(()=>{let t=!0;return(async()=>{try{pe(!0),ge(!1),oe(!1);const{data:s}=await A.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle(),i=s?.current_test_gw??1;W(i);const{data:r,error:m}=await A.from("test_api_fixtures").select("*").eq("test_gw",i).order("fixture_index",{ascending:!0});if(m)throw new Error(`Failed to load test fixtures: ${m.message}`);if(!r||r.length===0){t&&(B([]),pe(!1));return}const n=r.map(a=>({id:String(a.api_match_id),gw:i,fixture_index:a.fixture_index,home_team:a.home_team,away_team:a.away_team,home_code:a.home_code,away_code:a.away_code,home_name:a.home_name,away_name:a.away_name,home_crest:a.home_crest||null,away_crest:a.away_crest||null,kickoff_time:a.kickoff_time,api_match_id:a.api_match_id||null}));if(t){if(B(n),n.length>0&&n[0].kickoff_time){const a=n.reduce((y,P)=>{if(!P.kickoff_time)return y;const g=new Date(P.kickoff_time);return!y||g<y?g:y},null);if(a){const y=new Date(a.getTime()-3e5),P=new Date,g=P.getTime()>y.getTime();console.log("[TestApiPredictions] Deadline check:",{earliestKickoff:a.toISOString(),deadlineTime:y.toISOString(),now:P.toISOString(),isPastDeadline:g,minutesUntilDeadline:Math.round((y.getTime()-P.getTime())/(60*1e3))}),De(g)}else De(!1)}Se(new Map)}let o=!1;if(x?.id&&n.length>0){const{data:a}=await A.from("test_api_submissions").select("submitted_at").eq("matchday",i).eq("user_id",x.id).maybeSingle();t&&a?.submitted_at?(o=!0,z(!0),X.current=!0,ye(!0),oe(!0)):(z(!1),X.current&&(z(!0),o=!0),oe(!0))}else t&&(z(!1),oe(!0));let l=!1;if(x?.id&&n.length>0&&!o){const{data:a,error:y}=await A.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",i).eq("user_id",x.id);if(!y&&a&&a.length>0){const P=new Set(n.map(T=>T.fixture_index)),g=a.filter(T=>P.has(T.fixture_index)),u=n.every(T=>g.some(M=>M.fixture_index===T.fixture_index)),D=g.length===n.length;if(u&&D&&g.length>0){const T=new Map;g.forEach(M=>{T.set(M.fixture_index,{fixture_index:M.fixture_index,pick:M.pick,matchday:M.matchday})}),t&&(O(T),l=!0)}else t&&a.length>0&&(console.log("[TestApiPredictions] Picks found but don't match current fixtures - clearing old picks"),await A.from("test_api_picks").delete().eq("matchday",i).eq("user_id",x.id),O(new Map),l=!1)}}else if(o&&x?.id&&n.length>0){const{data:a,error:y}=await A.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",i).eq("user_id",x.id);if(!y&&a&&a.length>0){const P=new Set(n.map(u=>u.fixture_index)),g=a.filter(u=>P.has(u.fixture_index));if(g.length===n.length){const u=new Map;g.forEach(D=>{u.set(D.fixture_index,{fixture_index:D.fixture_index,pick:D.pick,matchday:D.matchday})}),t&&(O(u),l=!0)}}t&&!l&&(z(!1),await A.from("test_api_submissions").delete().eq("matchday",i).eq("user_id",x.id))}if(t&&n.length>0&&x?.id){const{data:a}=await A.from("leagues").select("id").eq("name","API Test").maybeSingle();if(a){t&&Je(a.id);const{data:y}=await A.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",a.id);if(y){const P=y.map(k=>({id:k.user_id,name:k.profiles?.name||"Unknown"}));t&&Ke(P);const g=P.map(k=>k.id),{data:u}=await A.from("test_api_submissions").select("user_id, submitted_at").eq("matchday",i).in("user_id",g).not("submitted_at","is",null),{data:D}=await A.from("test_api_picks").select("user_id, fixture_index").eq("matchday",i).in("user_id",g),H=new Set(n.map(k=>k.fixture_index)),T=H.size,M=new Date("2025-11-18T00:00:00Z"),U=new Set;u&&D&&T>0&&u.forEach(k=>{const Q=(D??[]).filter(c=>c.user_id===k.user_id).filter(c=>H.has(c.fixture_index)),Z=Q.length===T,_=new Set(Q.map(c=>c.fixture_index)).size===T,f=k.submitted_at?new Date(k.submitted_at):null,F=f&&f>=M;Z&&_&&F&&U.add(k.user_id)});const J=g.length>0&&U.size===g.length;t&&(Ve(J),Xe(U))}}}t&&(ge(!0),be||oe(!0)),t&&n.length>0&&(l&&!o?q(n.length):o&&l||q(0))}catch(s){console.error("Error loading test API data:",s),t&&ge(!0)}finally{t&&pe(!1)}})(),()=>{t=!1}},[x?.id]);const $e=async(t,s)=>{try{console.log("[TestApiPredictions] fetchLiveScore called for matchId:",t,"kickoffTime:",s);const{data:i,error:r}=await A.from("live_scores").select("*").eq("api_match_id",t).single();if(r)return r.code==="PGRST116"?(console.log("[TestApiPredictions] No live score found in Supabase for match",t,"- scheduled function may not have run yet"),null):(console.error("[TestApiPredictions] Error fetching live score from Supabase:",r),null);if(!i)return console.warn("[TestApiPredictions] No live score data in Supabase"),null;console.log("[TestApiPredictions] Live score from Supabase:",i);const m=i.home_score??0,n=i.away_score??0,o=i.status||"SCHEDULED";let l=i.minute;if(l==null&&(o==="IN_PLAY"||o==="PAUSED")&&s)try{const y=new Date(s),g=Math.floor((new Date().getTime()-y.getTime())/(1e3*60));g>0&&g<120&&(o==="PAUSED"?l=null:o==="IN_PLAY"&&(g<=50?l=g:l=46+Math.max(0,g-50)))}catch(y){console.warn("[TestApiPredictions] Error calculating minute from kickoff time:",y)}const a={homeScore:m,awayScore:n,status:o,minute:l,retryAfter:null,goals:i.goals||null,red_cards:i.red_cards||null};return console.log("[TestApiPredictions] Returning score data from Supabase:",a),a}catch(i){return console.error("[TestApiPredictions] Error fetching live score from Supabase:",i?.message||i,i?.stack),null}};b.useEffect(()=>{if(!d.length)return;const t=d.filter(r=>r.api_match_id&&r.kickoff_time);if(t.length===0)return;const s=new Map,i=[];return t.forEach(r=>{if(!r.api_match_id||!r.kickoff_time)return;const m=new Date(r.kickoff_time),n=new Date,o=r.fixture_index,l=()=>{const a=V[o];if(a&&a.status==="FINISHED")return;const y=new Map,P=async()=>{const u=await $e(r.api_match_id,r.kickoff_time);if(u){const D=u.status==="IN_PLAY"||u.status==="PAUSED",H=u.status==="HALF_TIME"||u.status==="HT",T=u.status==="FINISHED";console.log("[TestApiPredictions] Poll result for fixture",o,":",{status:u.status,isLive:D,isHalfTime:H,isFinished:T,homeScore:u.homeScore,awayScore:u.awayScore,minute:u.minute,apiMatchId:r.api_match_id}),!D&&!T&&!H&&console.warn("[TestApiPredictions] Game",o,"has status",u.status,"but is not detected as live"),V[o]?.status==="PAUSED"&&u.status==="IN_PLAY"&&(Le.current[r.api_match_id]=new Date,console.log("[TestApiPredictions] Halftime ended for fixture",o,"match",r.api_match_id));let U=u.minute;const J=Le.current[r.api_match_id];if(u.status==="IN_PLAY"&&J){const L=Math.floor((new Date().getTime()-J.getTime())/(1e3*60));U=46+L,console.log("[TestApiPredictions] Recalculated minute from halftime end:",{fixtureIndex:o,apiMatchId:r.api_match_id,originalMinute:u.minute,finalMinute:U,minutesSinceHalftimeEnd:L})}if(Fe(k=>({...k,[o]:{homeScore:u.homeScore,awayScore:u.awayScore,status:u.status,minute:U??null,goals:u.goals||null,red_cards:u.red_cards||null}})),T){console.log("[TestApiPredictions] Game",o,"finished, stopping polling");const k=s.get(o);k&&(clearInterval(k),s.delete(o));const L=y.get(o);L&&(clearTimeout(L),y.delete(o))}else if(H){console.log("[TestApiPredictions] Game",o,"at half-time, stopping polling, will resume in 15 minutes");const k=s.get(o);k&&(clearInterval(k),s.delete(o));const L=y.get(o);L&&clearTimeout(L);const Q=setTimeout(()=>{console.log("[TestApiPredictions] Resuming polling for fixture",o,"after half-time");const Z=async()=>{const _=await $e(r.api_match_id);if(_){const f=_.status==="FINISHED",F=_.status==="IN_PLAY"||_.status==="PAUSED",c=_.status==="HALF_TIME"||_.status==="HT";if(Fe(w=>({...w,[o]:{homeScore:_.homeScore,awayScore:_.awayScore,status:_.status,minute:_.minute??null,goals:_.goals||null,red_cards:_.red_cards||null}})),f){console.log("[TestApiPredictions] Game",o,"finished, stopping polling");const w=s.get(o);w&&(clearInterval(w),s.delete(o)),y.delete(o)}else F?console.log("[TestApiPredictions] Game",o,"second half started - status:",_.status,"minute:",_.minute):c&&console.log("[TestApiPredictions] Game",o,"still at half-time, continuing to poll...")}};Z();const j=setInterval(Z,60*1e3);s.set(o,j),y.delete(o)},900*1e3);y.set(o,Q)}else D&&console.log("[TestApiPredictions] Game",o,"is LIVE - status:",u.status,"minute:",u.minute)}};P();const g=setInterval(P,60*1e3);s.set(o,g)};if(m>n){const a=m.getTime()-n.getTime(),y=setTimeout(l,a);i.push(y)}else l()}),()=>{console.log("[TestApiPredictions] Cleaning up polling intervals and timeouts"),s.forEach(clearInterval),i.forEach(clearTimeout)}},[d.map(t=>t.api_match_id).join(",")]),b.useEffect(()=>{const t=new Map;d.forEach(i=>{const r=V[i.fixture_index];r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")&&(r.homeScore>r.awayScore?t.set(i.fixture_index,"H"):r.awayScore>r.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),Se(t)},[V,d]),b.useEffect(()=>{if(!h||!x?.id||G.size===0||d.length===0){de(null);return}let t=0;if(d.forEach(s=>{const i=G.get(s.fixture_index),r=E.get(s.fixture_index);i&&r&&i===r.pick&&t++}),t===0){de(null);return}(async()=>{try{const{data:s}=await A.from("test_api_picks").select("user_id, fixture_index, pick").eq("matchday",h);if(s){const i=new Map;s.forEach(l=>{const a=G.get(l.fixture_index),y=i.get(l.user_id)||0;a&&a===l.pick?i.set(l.user_id,y+1):i.set(l.user_id,y)});const r=Array.from(i.values()).sort((l,a)=>a-l),m=r.filter(l=>l>=t).length,n=r.length,o=n>0?Math.round(m/n*100):null;de(o)}}catch(s){console.error("[TestApiPredictions] Error calculating top percent:",s),de(null)}})()},[G,E,d,h,x?.id]);const S=d[$],ue=b.useMemo(()=>{let t=0;return d.forEach(s=>{const i=G.get(s.fixture_index),r=E.get(s.fixture_index);i&&r&&r.pick===i&&(t+=1)}),t},[d,G,E]),Be=(t,s)=>{Y||C||p||(Pe(!0),we.current={x:t,y:s},se(null))},He=(t,s)=>{if(!ae||Y||C||p)return;const i=t-we.current.x,r=s-we.current.y,m=i*.1;ce({x:i,y:r,rotation:m,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(r)?se(i>0?"away":"home"):r>50&&r>Math.abs(i)?se("draw"):se(null)},je=()=>{if(!ae||Y||C||p)return;Pe(!1);const{x:t,y:s}=I,i=100;let r=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(s)?r=t>0?"A":"H":s>i&&s>Math.abs(t)&&(r="D"),r?Re(r):(ce({x:0,y:0,rotation:0,opacity:1,scale:1}),se(null))},Ze=t=>{t.touches.length===1&&Be(t.touches[0].clientX,t.touches[0].clientY)},et=t=>{t.touches.length===1&&ae&&(t.preventDefault(),He(t.touches[0].clientX,t.touches[0].clientY))},tt=t=>{t.touches.length>0||(t.preventDefault(),je())},Re=async t=>{Te(!0),se(null);const s=t==="H"?-1:t==="A"?1:0,i=s*window.innerWidth,r=t==="D"?window.innerHeight:0;ce({x:i,y:r,rotation:s*30,opacity:0,scale:.8}),await xe(t),setTimeout(()=>{ve.current=!0,Oe?(q(d.length),Ye(!1)):q($+1),ce({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{ve.current=!1,Te(!1)})},300)},_e=t=>{!Y&&!C&&!p&&Re(t)},xe=async t=>{if(!S||!x?.id||!h)return;const s=new Map(E);s.set(S.fixture_index,{fixture_index:S.fixture_index,pick:t,matchday:h}),O(s);try{const{error:i}=await A.from("test_api_picks").upsert({user_id:x.id,matchday:h,fixture_index:S.fixture_index,pick:t},{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});i&&console.error("Error saving test pick:",i)}catch(i){console.error("Error saving test pick:",i)}},st=async()=>{if(!(!x?.id||!h)){O(new Map),q(0),z(!1),X.current=!1,ye(!1);try{const{error:t}=await A.from("test_api_submissions").delete().eq("user_id",x.id).eq("matchday",h);t?console.error("Error deleting test_api_submission:",t):console.log("[TestApiPredictions] Successfully deleted submission on Start Over");const{error:s}=await A.from("test_api_picks").delete().eq("user_id",x.id).eq("matchday",h);s?console.error("Error deleting test_api_picks:",s):console.log("[TestApiPredictions] Successfully deleted picks on Start Over")}catch(t){console.error("Error resetting picks:",t)}}},Ne=async()=>{if(!le){ie({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>ie(null),2200);return}if(!(!x?.id||!h))try{const{data:t}=await A.from("test_api_submissions").select("submitted_at").eq("user_id",x.id).eq("matchday",h).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen if Start Over worked"),z(!0);return}const s=Array.from(E.values()).filter(m=>m.matchday===h).map(m=>({user_id:x.id,matchday:m.matchday,fixture_index:m.fixture_index,pick:m.pick}));if(s.length!==d.length)throw new Error(`Expected ${d.length} picks but got ${s.length}`);const{error:i}=await A.from("test_api_picks").upsert(s,{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:r}=await A.from("test_api_submissions").upsert({user_id:x.id,matchday:h,submitted_at:new Date().toISOString()},{onConflict:"user_id,matchday"});if(r)throw console.error("[TestApiPredictions] Error saving submission:",r),r;console.log("[TestApiPredictions] Successfully confirmed test picks and submission"),z(!0),X.current=!0,ye(!0),ie({success:!0,message:"Your test predictions are locked in. Good luck!"}),setTimeout(()=>{ie(null)},2500),Me&&h&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:Me,matchday:h,isTestApi:!0})}).catch(m=>{console.error("[TestApiPredictions] Failed to check final submission:",m)})}catch(t){console.error("Error confirming test picks:",t),ie({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>ie(null),2200)}},it={loading:Ee,currentTestGw:!!h,picksChecked:Ce,submissionChecked:be,submitted:p,sessionStorageSubmitted:K()};if(console.log("[TestApiPredictions] Render check - loading state:",it),Ee||!h||!Ce||!be)return console.log("[TestApiPredictions] Showing skeleton loader"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>N("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Test API Predictions"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"h-4 bg-slate-200 rounded w-24"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 bg-slate-200 rounded-full"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-16"}),e.jsx("div",{className:"h-6 w-6 bg-slate-200 rounded-full"})]}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-24"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"}),e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"}),e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"})]})]},t))})})})]});if(d.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>N("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const We=p||K();if(console.log("[TestApiPredictions] Checking if submitted - state:",p,"sessionStorage:",K(),"isUserSubmitted:",We),We){if(console.log("[TestApiPredictions] ‚úÖ Showing submitted view"),!ze&&me.length>0){const t=me.filter(s=>!Ie.has(s.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>N("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:t})," of ",me.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:me.slice().sort((s,i)=>s.name.localeCompare(i.name)).map(s=>{const i=Ie.has(s.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx("td",{className:"px-4 py-3",children:i?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},s.id)})})]})})]})})})]})}return d.forEach(t=>{const s=V[t.fixture_index],i=s&&(s.status==="IN_PLAY"||s.status==="PAUSED"),r=s&&s.status==="FINISHED";if(s&&(i||r)){const m=E.get(t.fixture_index);m&&(m.pick==="H"&&s.homeScore>s.awayScore||m.pick==="A"&&s.awayScore>s.homeScore||m.pick==="D"&&(s.homeScore,s.awayScore))}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>N("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[(()=>{const t=d.length>0&&d.some(i=>{const r=V[i.fixture_index];return r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")});let s=0;if(t?d.forEach(i=>{const r=V[i.fixture_index];if(r&&r.status==="FINISHED"){const n=E.get(i.fixture_index);if(n){let o=!1;(n.pick==="H"&&r.homeScore>r.awayScore||n.pick==="A"&&r.awayScore>r.homeScore||n.pick==="D"&&r.homeScore===r.awayScore)&&(o=!0),o&&s++}}}):p&&d.forEach(i=>{const r=G.get(i.fixture_index),m=E.get(i.fixture_index);r&&m&&r===m.pick&&s++}),t||p&&d.length>0){const i=t?s:p?ue:0,r=d.length>0?i/d.length*100:0;return e.jsx("div",{className:"mb-4 rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[i,"/",d.length]}),Ae!==null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",Ae,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${r}%`}})})]})})}return null})(),e.jsx("div",{className:"space-y-6 [&>div:first-child]:mt-0",children:(()=>{const t=[];let s="",i=[];return d.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{className:m>0?"mt-6":"",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700 mb-3 px-1",children:e.jsx("span",{children:r.label})}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:r.items.map((n,o)=>{const l=E.get(n.fixture_index),a=V[n.fixture_index],y=a&&a.status==="IN_PLAY",P=a&&(a.status==="PAUSED"||a.status==="HALF_TIME"||a.status==="HT"),g=a&&a.status==="FINISHED",u=y||P,D=n.home_team||n.home_name||n.home_code||"",H=n.away_team||n.away_name||n.away_code||"",T=R(D),M=R(H),U=n.kickoff_time?(()=>{const j=new Date(n.kickoff_time),_=String(j.getUTCHours()).padStart(2,"0"),f=String(j.getUTCMinutes()).padStart(2,"0");return`${_}:${f}`})():"‚Äî",J=j=>{const _=l?.pick===j;let f=!1;return a&&(j==="H"&&a.homeScore>a.awayScore||j==="A"&&a.awayScore>a.homeScore||j==="D"&&a.homeScore===a.awayScore)&&(f=!0),{isPicked:_,isCorrectResult:f,isCorrect:_&&f,isWrong:_&&(u||g)&&!f}},k=J("H"),L=J("D"),Q=J("A"),Z=(j,_)=>{const f="h-16 rounded-xl border text-sm font-medium transition-all flex items-center justify-center select-none";return y||u?j.isCorrect?`${f} bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50`:j.isWrong?`${f} bg-[#1C8376] text-white border-[#1C8376]`:j.isPicked?`${f} bg-[#1C8376] text-white border-[#1C8376]`:j.isCorrectResult&&!j.isPicked?`${f} bg-slate-50 text-slate-600 border-2 border-slate-300 animate-pulse`:`${f} bg-slate-50 text-slate-600 border-slate-200`:g?j.isCorrect?`${f} bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-2xl shadow-yellow-400/40 transform scale-110 rotate-1 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]`:j.isWrong?`${f} bg-[#1C8376] text-white border-[#1C8376]`:j.isCorrectResult&&!j.isPicked?`${f} bg-slate-50 text-slate-600 border-4 border-emerald-600`:j.isPicked?`${f} bg-[#1C8376] text-white border-[#1C8376]`:`${f} bg-slate-50 text-slate-600 border-slate-200`:j.isPicked?`${f} bg-[#1C8376] text-white border-[#1C8376]`:`${f} bg-slate-50 text-slate-600 border-slate-200`};return e.jsx("li",{className:o>0?"border-t":"",children:e.jsxs("div",{className:"p-4 bg-white relative",children:[(y||P)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),e.jsx("div",{className:`flex flex-col px-2 pb-3 ${u?"pt-4":"pt-1"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`break-words ${a&&(u||g)&&a.homeScore>a.awayScore?"font-bold":"font-medium"}`,children:T}),e.jsx("img",{src:`/assets/badges/${(n.home_code||D).toUpperCase()}.png`,alt:T,className:"w-5 h-5",onError:j=>{j.currentTarget.style.opacity="0.35"}})]}),a&&(u||g)&&(()=>{const j=(a.goals||[]).filter(c=>{const w=c.team||"",v=R(w);return v===T||v===R(n.home_team||"")}),_=(a.red_cards||[]).filter(c=>{const w=c.team||"",v=R(w);return v===T||v===R(n.home_team||"")}),f=[],F=new Map;return j.forEach(c=>{const w=c.scorer||"Unknown",v=c.minute;F.has(w)||F.set(w,[]),v!=null&&F.get(w).push(v)}),F.forEach((c,w)=>{const v=c.sort((ee,ke)=>ee-ke);f.push({type:"goal",minute:v[0],scorer:w,minutes:v})}),_.forEach(c=>{f.push({type:"red_card",minute:c.minute,player:c.player||"Unknown"})}),f.sort((c,w)=>c.minute===null?1:w.minute===null?-1:c.minute-w.minute),f.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-end gap-0.5",children:f.map((c,w)=>c.type==="goal"?e.jsxs("span",{className:"text-[10px] text-slate-600",children:[c.scorer," ",c.minutes.sort((v,ee)=>v-ee).map(v=>`${v}'`).join(", ")]},w):e.jsxs("span",{className:"text-[10px] text-slate-600",children:["üü• ",c.player," ",c.minute,"'"]},w))})})()]}),e.jsx("div",{className:"px-4 flex flex-col items-center",children:a&&(u||g)?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-base text-slate-900",children:[a.homeScore," - ",a.awayScore]}),e.jsx("span",{className:`text-[10px] font-semibold mt-0.5 ${u?"text-red-600":"text-slate-500"}`,children:ct(a.status,a.minute)})]}):e.jsx("span",{className:"text-slate-500 text-sm",children:U})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/assets/badges/${(n.away_code||H).toUpperCase()}.png`,alt:M,className:"w-5 h-5",onError:j=>{j.currentTarget.style.opacity="0.35"}}),e.jsx("div",{className:`break-words ${a&&(u||g)&&a.awayScore>a.homeScore?"font-bold":"font-medium"}`,children:M})]}),a&&(u||g)&&(()=>{const j=(a.goals||[]).filter(c=>{const w=c.team||"",v=R(w);return v===M||v===R(n.away_team||"")}),_=(a.red_cards||[]).filter(c=>{const w=c.team||"",v=R(w);return v===M||v===R(n.away_team||"")}),f=[],F=new Map;return j.forEach(c=>{const w=c.scorer||"Unknown",v=c.minute;F.has(w)||F.set(w,[]),v!=null&&F.get(w).push(v)}),F.forEach((c,w)=>{const v=c.sort((ee,ke)=>ee-ke);f.push({type:"goal",minute:v[0],scorer:w,minutes:v})}),_.forEach(c=>{f.push({type:"red_card",minute:c.minute,player:c.player||"Unknown"})}),f.sort((c,w)=>c.minute===null?1:w.minute===null?-1:c.minute-w.minute),f.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-start gap-0.5",children:f.map((c,w)=>c.type==="goal"?e.jsxs("span",{className:"text-[10px] text-slate-600",children:[c.scorer," ",c.minutes.sort((v,ee)=>v-ee).map(v=>`${v}'`).join(", ")]},w):e.jsxs("span",{className:"text-[10px] text-slate-600",children:["üü• ",c.player," ",c.minute,"'"]},w))})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 relative mt-4",children:[e.jsx("div",{className:`${Z(k)} flex items-center justify-center`,children:e.jsx("span",{className:`${k.isCorrect?"font-bold":""} ${k.isWrong&&g?"line-through decoration-2 decoration-white":""}`,children:"Home Win"})}),e.jsx("div",{className:`${Z(L)} flex items-center justify-center`,children:e.jsx("span",{className:`${L.isCorrect?"font-bold":""} ${L.isWrong&&g?"line-through decoration-2 decoration-white":""}`,children:"Draw"})}),e.jsx("div",{className:`${Z(Q)} flex items-center justify-center`,children:e.jsx("span",{className:`${Q.isCorrect?"font-bold":""} ${Q.isWrong&&g?"line-through decoration-2 decoration-white":""}`,children:"Away Win"})})]})]})},n.id)})})})]},m))})()})]})})]})}const rt=p||X.current||K();if(console.log("[TestApiPredictions] Review mode check - submitted:",p,"ref:",X.current,"sessionStorage:",K()),rt&&!p)return console.log("[TestApiPredictions] WARNING: sessionStorage/ref says submitted but state says no - showing loading"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading..."})});if(console.log("[TestApiPredictions] Review mode check - currentIndex:",$,"fixtures.length:",d.length,"submitted:",p),$>=d.length)return console.log("[TestApiPredictions] ‚úÖ Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ne&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[ne.success?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${ne.success?"text-emerald-700":"text-amber-600"}`,children:ne.success?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:ne.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>q(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),le&&!p?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):p?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"‚úì Submitted"}):E.size>0?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>q(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:p?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let s="",i=[];return d.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:r.label}),e.jsx("div",{className:"space-y-4",children:r.items.map(n=>{const o=E.get(n.fixture_index),l=G.get(n.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:n.home_team||n.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(re,{code:n.home_code,crest:n.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:n.kickoff_time?new Date(n.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(re,{code:n.away_code,crest:n.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:n.away_team||n.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(C||p)return;const a=new Map(E);a.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"H",matchday:h}),O(a),xe("H")},disabled:C||p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${o?.pick==="H"?l&&l==="H"&&o.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="D"||l==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="H"?"bg-gray-300 text-slate-700 border-gray-400":C||p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(C||p)return;const a=new Map(E);a.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"D",matchday:h}),O(a),xe("D")},disabled:C||p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${o?.pick==="D"?l&&l==="D"&&o.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="H"||l==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="D"?"bg-gray-300 text-slate-700 border-gray-400":C||p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(C||p)return;const a=new Map(E);a.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"A",matchday:h}),O(a),xe("A")},disabled:C||p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${o?.pick==="A"?l&&l==="A"&&o.pick===l?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":l&&(l==="H"||l==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":l==="A"?"bg-gray-300 text-slate-700 border-gray-400":C||p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},n.id)})})]},m))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[d.length>0&&d[0].kickoff_time&&e.jsxs("div",{className:"rounded-2xl border border-emerald-200 bg-white px-4 py-3 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx("span",{className:"text-lg",children:"‚è±Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold",children:"Deadline"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-base font-bold text-emerald-900",children:new Date(new Date(d[0].kickoff_time).getTime()-4500*1e3).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-[11px] font-medium text-emerald-600",children:"75 mins before first kickoff"})]})]}),p?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",h," have been confirmed."]}),ue>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[ue,"/",d.length]})]}):C?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-red-600 mb-2",children:"Deadline Passed"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Predictions are now closed."})]}):e.jsxs(e.Fragment,{children:[!le&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{onClick:st,disabled:p||C,className:"w-full py-3 bg-slate-200 text-slate-700 rounded-2xl font-semibold hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Over"}),e.jsx("button",{onClick:Ne,disabled:!le,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:le?"Confirm Predictions (TEST)":"Complete All Predictions First"}),e.jsx("button",{onClick:()=>N("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})]})})]});const Ge=p||X.current||K();return console.log("[TestApiPredictions] üî¥ SWIPE VIEW CHECK - submitted:",p,"ref:",X.current,"sessionStorage:",K(),"checkSubmittedBeforeSwipe:",Ge),Ge?(console.log("[TestApiPredictions] üö´ BLOCKING swipe view - user has submitted"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading..."})})):(console.log("[TestApiPredictions] ‚úÖ Showing swipe view - user has NOT submitted"),e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[te==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>N("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"‚úï"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Test GW ",h]}),te==="cards"&&e.jsxs("button",{onClick:()=>q(d.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),te==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-2",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:d.map((t,s)=>{const i=s<$,r=s===$;return e.jsx("div",{className:`flex items-center justify-center transition-all ${r?"h-2 w-6 rounded-full bg-[#178f72]":"h-3 w-3 rounded-full"} ${i&&!r?"bg-[#116f59]":r?"":"bg-white"}`},s)})})})]})}),te==="list"?e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>N("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",h," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:ue})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{Ue("cards"),q(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}):e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1 pb-[90px]",style:{height:"100%"},children:[e.jsxs("div",{className:"flex items-center justify-center px-4 relative overflow-hidden pt-2",style:{minHeight:0},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üê"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üí"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üì"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75"},children:[$<d.length-1&&(()=>{const t=d[$+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:ae||Y?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8",children:[t.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(t.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(re,{code:t.home_code,crest:t.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.home_team||t.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:t.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(t.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(re,{code:t.away_code,crest:t.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.away_team||t.away_name})]})]})]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{style:{position:"absolute",inset:0,background:he(t.home_code,t.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:he(t.away_code,t.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})},$+1)})(),e.jsx("div",{ref:Qe,className:"absolute inset-0 z-10 cursor-grab active:cursor-grabbing",style:{transform:`translate(${I.x}px, ${I.y}px) rotate(${I.rotation}deg) scale(${I.scale})`,opacity:I.opacity,transition:ae||ve.current?"none":"all 0.3s ease-out",touchAction:"none"},onMouseDown:t=>!C&&!p&&Be(t.clientX,t.clientY),onMouseMove:t=>!C&&!p&&He(t.clientX,t.clientY),onMouseUp:je,onMouseLeave:je,onTouchStart:Ze,onTouchMove:et,onTouchEnd:tt,children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8 relative pointer-events-none",children:[e.jsx("div",{className:"absolute top-2 right-4 flex items-center gap-2 text-slate-400 text-xs font-semibold",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/4603/4603384.png",alt:"Swipe gesture icon",className:"w-6 h-6 opacity-80"})}),S.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(S.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(re,{code:S.home_code,crest:S.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:S.home_team||S.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:S.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(S.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(re,{code:S.away_code,crest:S.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:S.away_team||S.away_name})]})]}),(()=>{const t=G.get(S.fixture_index),s=E.get(S.fixture_index);if(t&&s){const i=s.pick===t;return e.jsxs("div",{className:"text-center mb-4 space-y-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-semibold",children:[e.jsx("span",{children:"üéØ"}),e.jsxs("span",{children:["Result: ",t==="H"?"Home Win":t==="A"?"Away Win":"Draw"]})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold ${i?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx("span",{children:i?"‚úì":"‚úó"}),e.jsx("span",{children:i?"Correct!":"Incorrect"})]})]})}return null})()]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",style:{background:he(S.home_code,S.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{className:"absolute inset-0",style:{background:he(S.away_code,S.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 pt-2 px-4 bg-[#eef4f3] z-[10000]",style:{paddingBottom:"calc(5rem + env(safe-area-inset-bottom, 0px))"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>_e("H"),disabled:Y||C||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:I.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(I.x)/150)})`:void 0,color:I.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>_e("D"),disabled:Y||C||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:I.y>30?`rgba(59, 130, 246, ${Math.min(.8,I.y/150)})`:void 0,color:I.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>_e("A"),disabled:Y||C||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:I.x>30?`rgba(34, 197, 94, ${Math.min(.8,I.x/150)})`:void 0,color:I.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]}))}export{ut as default};
