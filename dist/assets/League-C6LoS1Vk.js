import{r,s as js,C as _s,a as U,l as Ut,g as be,_ as zt,i as qt,j as e,V as sa,U as Ze,b as Ns,u as Ss,c as aa,d as us,T as ms,D as ra,e as na,f as oa,h as la,k as ia,m as ca,n as Ft,o as fs,p as Xe,q as da,t as ua,L as hs,v as Bt,w as gs,I as xs,x as ps,y as bs}from"./index-ic2x2StX.js";import{C as ma}from"./index.module-RRNM5H1P.js";const we=[];for(let t=0;t<256;++t)we.push((t+256).toString(16).slice(1));function fa(t,i=0){return(we[t[i+0]]+we[t[i+1]]+we[t[i+2]]+we[t[i+3]]+"-"+we[t[i+4]]+we[t[i+5]]+"-"+we[t[i+6]]+we[t[i+7]]+"-"+we[t[i+8]]+we[t[i+9]]+"-"+we[t[i+10]]+we[t[i+11]]+we[t[i+12]]+we[t[i+13]]+we[t[i+14]]+we[t[i+15]]).toLowerCase()}let Gt;const ha=new Uint8Array(16);function ga(){if(!Gt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Gt=crypto.getRandomValues.bind(crypto)}return Gt(ha)}const xa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ws={randomUUID:xa};function pa(t,i,y){t=t||{};const f=t.random??t.rng?.()??ga();if(f.length<16)throw new Error("Random bytes length must be >= 16");return f[6]=f[6]&15|64,f[8]=f[8]&63|128,fa(f)}function ba(t,i,y){return ws.randomUUID&&!t?ws.randomUUID():pa(t)}const Ot=50,bt=t=>{let i=null;if(t.reply_to){const y=Array.isArray(t.reply_to)?t.reply_to[0]:t.reply_to;y&&y.id&&y.user_id&&(i={id:y.id,content:y.content||"",user_id:y.user_id,author_name:y.author_name})}return{id:t.id,league_id:t.league_id,user_id:t.user_id,content:t.content,created_at:t.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:t.reply_to_message_id??null,reply_to:i}},We=t=>{const i=new Set,y=[];for(const f of t)i.has(f.id)||(i.add(f.id),y.push(f));return y.sort((f,c)=>new Date(f.created_at).getTime()-new Date(c.created_at).getTime())};function wa(t,i={}){const{userId:y,enabled:f=!0,autoSubscribe:c=!0}=i,p=()=>!t||!f?[]:be(`chat:messages:${t}`)||[],[L,z]=r.useState(p),[a,G]=r.useState(!1),[M,W]=r.useState(!1),[te,j]=r.useState(!0),[R,J]=r.useState(null),Y=r.useRef(null),oe=r.useRef(null),v=r.useRef(L),Z=r.useRef("idle"),B=r.useRef(y);r.useEffect(()=>{B.current=y},[y]);const I=r.useCallback(ie=>{z(V=>{const D=ie(V);if(v.current=D,Y.current=D.length?D[0].created_at:null,oe.current=D.length?D[D.length-1].created_at:null,t&&D.length>0){const se=D.filter(de=>!de.id.startsWith("optimistic-"));if(se.length>0){const de=`chat:messages:${t}`;js(de,se,_s.HOME)}}return D})},[t]),ue=r.useRef(null),le=r.useRef(null);r.useEffect(()=>{v.current=L},[L]);const ke=r.useCallback(async({before:ie,append:V})=>{if(!t||!f)return;const D=U.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).eq("league_id",t).order("created_at",{ascending:!1}).limit(Ot);ie&&D.lt("created_at",ie);const{data:se,error:de}=await D;if(Ut("useMiniLeagueChat","Fetch messages page","league_messages",{data:se,error:de},{leagueId:t,before:ie,pageSize:Ot}),de)throw console.error("[useMiniLeagueChat] Error fetching messages:",de),de;const N=(se??[]).filter(b=>b.reply_to_message_id),ge=[...new Set(N.map(b=>b.reply_to_message_id))];let l=new Map;if(!N.some(b=>b.reply_to&&!Array.isArray(b.reply_to))&&ge.length>0){const{data:b,error:x}=await U.from("league_messages").select("id, content, user_id").in("id",ge);Ut("useMiniLeagueChat","Fetch reply messages","league_messages",{data:b,error:x},{leagueId:t,replyMessageIds:ge.length}),x?console.error("[useMiniLeagueChat] Error fetching reply messages:",x):b&&b.forEach(F=>{l.set(F.id,F)})}const h=(se??[]).map(b=>{if(b.reply_to_message_id)if(b.reply_to&&!Array.isArray(b.reply_to))b.reply_to=b.reply_to;else{const x=l.get(b.reply_to_message_id);b.reply_to=x||null}else b.reply_to=null;return bt(b)}).reverse();I(b=>We(V?[...h,...b]:[...b,...h])),(se??[]).length<Ot?j(!1):V||j(!0)},[t,f,I]),me=r.useCallback(async(ie=!1)=>{if(!t||!f){z([]),j(!0);return}const V=v.current.length>0;V||G(!0),J(null);try{if(!V&&!ie){const D=be(`chat:messages:${t}`);D&&D.length>0&&(I(()=>D),D.length>0&&(Y.current=D[0].created_at,oe.current=D[D.length-1].created_at),j(D.length>=50),G(!1))}await ke({append:!1})}catch(D){const{getUserFriendlyMessage:se}=await zt(async()=>{const{getUserFriendlyMessage:de}=await import("./chatErrors-CWrmdYXz.js");return{getUserFriendlyMessage:de}},[]);console.error("[useMiniLeagueChat] Error in refresh:",D),J(se(D,"refresh"))}finally{V||G(!1)}},[t,f,ke,I]);r.useEffect(()=>{ue.current=me,le.current=I},[me,I]);const Se=r.useRef(null);r.useEffect(()=>{const ie=Date.now(),V={miniLeagueId:t,enabled:f,autoSubscribe:c,userId:B.current},D=Se.current;let se=[];D?(D.miniLeagueId!==t&&se.push(`miniLeagueId: "${D.miniLeagueId}" â†’ "${t}"`),D.enabled!==f&&se.push(`enabled: ${D.enabled} â†’ ${f}`),D.autoSubscribe!==c&&se.push(`autoSubscribe: ${D.autoSubscribe} â†’ ${c}`)):se.push("initial mount"),Se.current={miniLeagueId:t,enabled:f,autoSubscribe:c};try{const l=localStorage.getItem("message_subscription_logs"),u=l?JSON.parse(l):[];u.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_MOUNT",channel:`league-messages:${t}`,dependencies:V,effectId:ie,changedFields:se,reason:se.length>0?`Subscription effect mounted - changed: ${se.join(", ")}`:"Subscription effect mounted"});const h=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(h))}catch(l){console.error("[useMiniLeagueChat] Failed to log effect mount:",l)}if(!t||!f||!c){try{const l=localStorage.getItem("message_subscription_logs"),u=l?JSON.parse(l):[];u.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_SKIP",channel:`league-messages:${t}`,dependencies:V,effectId:ie,reason:`Skipped: miniLeagueId=${!!t}, enabled=${f}, autoSubscribe=${c}`});const h=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(h))}catch{}return}let de=!0,N=null,ge=null;return Z.current="subscribing",ge=U.channel(`league-messages:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${t}`},async l=>{if(de&&l.new.user_id!==B.current)try{const u=l.new;if(u.reply_to_message_id){const{data:b}=await U.from("league_messages").select("id, content, user_id").eq("id",u.reply_to_message_id).single();b?u.reply_to=b:u.reply_to=null}else u.reply_to=null;const h=bt(u);le.current?.(b=>b.some(x=>x.id===h.id)?b:We([...b,h]))}catch(u){console.error("[useMiniLeagueChat] Error processing real-time message:",u);try{const h=bt(l.new);le.current?.(b=>b.some(x=>x.id===h.id)?b:We([...b,h]))}catch(h){console.error("[useMiniLeagueChat] Fallback also failed:",h)}}}).subscribe(l=>{Z.current=l==="SUBSCRIBED"?"subscribed":l==="CHANNEL_ERROR"||l==="TIMED_OUT"?"failed":"idle";try{const u=localStorage.getItem("message_subscription_logs"),h=u?JSON.parse(u):[];h.push({timestamp:Date.now(),leagueId:t,status:l,channel:`league-messages:${t}`});const b=h.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(b))}catch(u){console.error("[useMiniLeagueChat] Failed to log subscription status:",u)}l==="SUBSCRIBED"?N&&(clearTimeout(N),N=null):(l==="CHANNEL_ERROR"||l==="TIMED_OUT")&&(N&&clearTimeout(N),N=setTimeout(()=>{de&&Z.current!=="subscribed"&&(console.warn("[useMiniLeagueChat] Subscription failed, triggering safety refresh"),ue.current?.(!1).catch(()=>{}))},2e3))}),()=>{try{const l=localStorage.getItem("message_subscription_logs"),u=l?JSON.parse(l):[];u.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_UNMOUNT",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:f,autoSubscribe:c,userId:B.current},effectId:ie,reason:"Subscription effect unmounting (cleanup)"});const h=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(h))}catch(l){console.error("[useMiniLeagueChat] Failed to log effect unmount:",l)}if(de=!1,N&&clearTimeout(N),ge){U.removeChannel(ge);try{const l=localStorage.getItem("message_subscription_logs"),u=l?JSON.parse(l):[];u.push({timestamp:Date.now(),leagueId:t,status:"CLOSED",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:f,autoSubscribe:c,userId:B.current},effectId:ie,reason:"Channel removed in cleanup"});const h=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(h))}catch{}}}},[t,f,c]),r.useEffect(()=>{if(!t||!f){z([]),j(!0);return}if(typeof window<"u"&&new URLSearchParams(window.location.search).get("tab")==="chat"){ue.current?.(!0).catch(()=>{});return}const V=v.current,D=be(`chat:messages:${t}`);V.length>0?(V.length>0&&(Y.current=V[0].created_at,oe.current=V[V.length-1].created_at,j(V.length>=50)),ue.current?.(!1).catch(()=>{})):D&&D.length>0?(I(()=>D),D.length>0&&(Y.current=D[0].created_at,oe.current=D[D.length-1].created_at),j(D.length>=50),ue.current?.(!1).catch(()=>{})):ue.current?.(!1).catch(()=>{})},[t,f]);const ye=r.useCallback(async()=>{if(!t||!f||!te||M)return;const ie=Y.current??L[0]?.created_at;if(ie){W(!0);try{await ke({before:ie,append:!0})}catch(V){console.error("[useMiniLeagueChat] Error loading more messages:",V),J(V?.message??"Failed to load more messages")}finally{W(!1)}}},[t,f,te,M,ke,L]),Ae=r.useCallback(async(ie,V)=>{if(!t||!y)throw new Error("Missing league or user");const D=ie.trim();if(!D)return;const se=ba(),de=`optimistic-${se}`,N={id:de,client_msg_id:se,league_id:t,user_id:y,content:D,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:V??null};I(u=>We([...u,N]));const{data:ge,error:l}=await U.from("league_messages").insert({league_id:t,user_id:y,content:D,reply_to_message_id:V??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).single();if(Ut("useMiniLeagueChat","Insert message","league_messages",{data:ge,error:l},{leagueId:t,userId:y,hasReplyTo:!!V}),l){const{handleChatError:u}=await zt(async()=>{const{handleChatError:b}=await import("./chatErrors-CWrmdYXz.js");return{handleChatError:b}},[]),h=u(l,"sendMessage");throw console.error("[useMiniLeagueChat] Error sending message:",l),I(b=>b.map(x=>x.id===de?{...x,status:"error"}:x)),new Error(h.message)}if(ge){if(ge.reply_to_message_id&&(!ge.reply_to||Array.isArray(ge.reply_to))){const{data:h}=await U.from("league_messages").select("id, content, user_id").eq("id",ge.reply_to_message_id).single();h?ge.reply_to=h:ge.reply_to=null}const u=bt(ge);u.client_msg_id=se,u.status="sent",I(h=>{const b=h.findIndex(x=>x.id===de||x.client_msg_id===se&&x.id.startsWith("optimistic-"));if(b>=0){const x=[...h];return x[b]=u,We(x)}else return h.some(x=>x.id===u.id)?h:We([...h,u])})}},[t,y,I]),$e=r.useMemo(()=>L.slice(-5),[L]);return{messages:L,previewMessages:$e,loading:a,loadingMore:M,hasMore:te,error:R,refresh:me,loadMore:ye,sendMessage:Ae}}function ya({leagueId:t,userId:i,enabled:y=!0,containerRef:f}){const c=r.useRef(0),p=r.useRef(null),L=2e3,z=r.useCallback(async()=>{if(!t||!i||!y)return;const a=Date.now();if(a-c.current<L){p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{z()},L-(a-c.current));return}c.current=a;try{await U.from("league_message_reads").upsert({league_id:t,user_id:i,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),qt(i),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:t,userId:i}}))}catch(G){console.error("[useMarkMessagesRead] Error marking messages as read:",G)}},[t,i,y]);return r.useEffect(()=>{if(!y||!t||!i||!f.current)return;const a=f.current,G=new IntersectionObserver(W=>{W[0]?.isIntersecting&&a.querySelectorAll("[data-message-id]").length>0&&z()},{root:null,rootMargin:"0px",threshold:.1});G.observe(a);const M=()=>{a.scrollTop>0&&z()};return a.addEventListener("scroll",M,{passive:!0}),()=>{G.disconnect(),a.removeEventListener("scroll",M),p.current&&clearTimeout(p.current)}},[y,t,i,f,z]),{markAsRead:z}}const ka={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},va={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},ja=["ðŸ‘","â¤ï¸","ðŸ˜‚"],_a=["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ¤¡","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸŽƒ","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾"];function Na({author:t,text:i,time:y,isOwnMessage:f,shape:c="single",messageId:p,reactions:L=[],onReactionClick:z,replyTo:a,onMessageClick:G}){const M="text-left",W=f?"bg-[#1C8376] text-white":"bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",te=f?va:ka,j="max-w-[85%]",[R,J]=r.useState(!1),[Y,oe]=r.useState(!1),v=r.useRef(null);r.useEffect(()=>{if(!R)return;const I=le=>{v.current&&!v.current.contains(le.target)&&J(!1)},ue=setTimeout(()=>{document.addEventListener("mousedown",I)},100);return()=>{clearTimeout(ue),document.removeEventListener("mousedown",I)}},[R]);const Z=I=>{p&&z&&z(p,I),J(!1),oe(!1)},B=I=>{const ue=I.target;ue.closest("button")||ue.closest("[data-reaction]")||G&&G()};return e.jsxs("div",{className:`inline-block ${j} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},"data-message-id":p,children:[e.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${M} ${W} ${te[c]} ${G?"cursor-pointer":""}`,onClick:B,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[t&&!f&&e.jsx("div",{className:"text-xs font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:t}),a&&e.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${f?"border-white/30 text-white/90":"border-[#1C8376] dark:border-emerald-400 text-slate-600 dark:text-slate-300"} pl-2 text-xs dark:text-slate-300`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[e.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.authorName||"Unknown"}),e.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:a.content})]}),e.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[e.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:i}),e.jsx("span",{className:`text-xs relative top-1 ${f?"text-[#DCDCDD]":"text-slate-400 dark:text-slate-500"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:y})]})]}),p&&!f&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[R&&e.jsxs("div",{ref:v,className:"flex items-center gap-1 bg-white dark:bg-slate-800 rounded-full px-1 py-1 shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[ja.map(I=>e.jsx("button",{onClick:()=>Z(I),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${I}`,children:I},I)),G&&e.jsx("button",{onClick:()=>{J(!1),G()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:()=>{J(!1),oe(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:e.jsx("span",{className:"text-sm",children:"+"})})]}),e.jsx("button",{onClick:()=>J(!R),className:"w-7 h-7 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 flex items-center justify-center shadow-sm",title:"Add reaction",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),Y&&p&&!f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>oe(!1)}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-800 rounded-t-2xl shadow-2xl border-t border-slate-200 dark:border-slate-700 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:e.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"}),e.jsx("button",{onClick:()=>oe(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 rounded-lg",children:"Close"}),e.jsx("div",{className:"w-12"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:_a.map(I=>e.jsx("button",{onClick:()=>{p&&z&&z(p,I),oe(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 dark:active:bg-slate-700 flex items-center justify-center text-2xl",title:I,children:I},I))})]})})]}),L.length>0&&e.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${f?"justify-end":"justify-start"}`,children:L.map(I=>e.jsxs("button",{onClick:()=>Z(I.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${I.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200"}`,children:[e.jsx("span",{className:"text-base",children:I.emoji}),e.jsx("span",{children:I.count})]},I.emoji))})]})}function Sa({author:t,messages:i,isOwnMessage:y,avatarInitials:f,userId:c,reactions:p,onReactionClick:L,onMessageClick:z}){const a=y?"justify-end":"justify-start",G=c===Ns;return e.jsxs("div",{className:`flex items-end gap-2 w-full ${a}`,children:[y?e.jsx("div",{className:"w-8 flex-shrink-0"}):G?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 dark:border-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:sa,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):c?e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ze,{userId:c,name:t,size:32,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-xs font-semibold text-slate-500 dark:text-slate-400 flex-shrink-0",children:(f||t.charAt(0)).toUpperCase()}),e.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:i.map((M,W)=>{const te=i.length===1?"single":W===0?"top":W===i.length-1?"bottom":"middle",j=M.messageId||M.id;let R="";if(typeof M.text=="string")R=M.text;else if(typeof M.text=="object"&&M.text!==null){const J=M.text?.props?.children||String(M.text);R=typeof J=="string"?J:String(J)}else R=String(M.text);return e.jsx("div",{className:`flex flex-col w-full min-w-0 ${y?"items-end":"items-start"}`,children:e.jsxs("div",{className:`flex w-full min-w-0 ${y?"justify-end":"justify-start"}`,children:[e.jsx(Na,{author:!y&&W===0?t:void 0,text:M.text,time:M.time,isOwnMessage:y,shape:te,messageId:j,reactions:p?.[j]||[],onReactionClick:L,replyTo:M.replyTo,onMessageClick:z?()=>z(j,R,!y&&W===0?t:void 0):void 0}),M.status&&e.jsx("div",{className:`text-xs ml-2 ${M.status==="error"?"text-red-500":"text-slate-400 dark:text-slate-500"}`,children:M.status==="error"?"Failed":"Sendingâ€¦"})]})},M.id)})})]})}function Ca({groups:t,reactions:i,onReactionClick:y,onMessageClick:f}){const c=t.filter(p=>p.author==="Unknown");return c.length>0&&(console.error("[ChatThread] RENDERING with",c.length,'groups with "Unknown" author!'),c.forEach((p,L)=>{console.error(`[ChatThread] Group ${L}: id="${p.id}", author="${p.author}", messages=${p.messages.length}`)})),e.jsx("div",{className:"flex flex-col gap-5",children:t.map((p,L)=>e.jsxs("div",{className:"flex flex-col gap-3",children:[p.dayLabel&&e.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:p.dayLabel}),e.jsx(Sa,{author:p.author,avatarInitials:p.avatarInitials,isOwnMessage:p.isOwnMessage,userId:p.userId,messages:p.messages,reactions:i,onReactionClick:y,onMessageClick:f},`${p.id}-${p.author}-${L}`)]},`${p.id}-${p.author}-${L}`))})}const La=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ea=t=>new Date(t).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),ys=t=>{if(!t)return"?";const i=t.trim().split(/\s+/);return i.length===1?i[0][0]?.toUpperCase()??"?":`${i[0][0]?.toUpperCase()??""}${i[i.length-1][0]?.toUpperCase()??""}`},lt=(t,i)=>i?i instanceof Map?i.get(t)??"":i[t]??"":"";function Ra({miniLeagueId:t,memberNames:i,deepLinkError:y}){const{user:f}=Ss(),c=r.useMemo(()=>!!t,[t]);r.useEffect(()=>{const l=Date.now();try{const u=localStorage.getItem("message_subscription_logs"),h=u?JSON.parse(u):[];h.push({timestamp:Date.now(),leagueId:t,status:"COMPONENT_MOUNT",channel:`league-messages:${t}`,componentId:l,props:{miniLeagueId:t,enabled:c},reason:"MiniLeagueChatBeta component mounted"});const b=h.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(b))}catch(u){console.error("[MiniLeagueChatBeta] Failed to log mount:",u)}return()=>{try{const u=localStorage.getItem("message_subscription_logs"),h=u?JSON.parse(u):[];h.push({timestamp:Date.now(),leagueId:t,status:"COMPONENT_UNMOUNT",channel:`league-messages:${t}`,componentId:l,reason:"MiniLeagueChatBeta component unmounting"});const b=h.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(b))}catch(u){console.error("[MiniLeagueChatBeta] Failed to log unmount:",u)}}},[t,c]);const{messages:p,error:L,sendMessage:z}=wa(t,{userId:f?.id,enabled:c}),a=r.useRef(null),{markAsRead:G}=ya({leagueId:t,userId:f?.id,enabled:!!t&&p.length>0,containerRef:a}),[M,W]=r.useState(""),[te,j]=r.useState(!1),[R,J]=r.useState({}),[Y,oe]=r.useState(null),[v,Z]=r.useState([]),B=r.useRef(null),I=r.useRef(null),ue=r.useRef(!1),[le,ke]=r.useState(0);r.useEffect(()=>{ue.current=!1},[t]);const me=r.useCallback(()=>{a.current&&requestAnimationFrame(()=>{if(!a.current)return;const l=a.current.scrollHeight-a.current.clientHeight;a.current.scrollTop=l+100})},[]);r.useEffect(()=>{if(p.length===0||!f?.id)return;const l=p.map(h=>h.id).filter(h=>!h.startsWith("optimistic-"));if(l.length===0)return;(async()=>{try{const{data:h,error:b}=await U.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",l);if(b){Z(S=>[...S,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${b.message}`,timestamp:Date.now()}]);return}const x={};(h||[]).forEach(S=>{x[S.message_id]||(x[S.message_id]={}),x[S.message_id][S.emoji]||(x[S.message_id][S.emoji]={count:0,hasUserReacted:!1}),x[S.message_id][S.emoji].count++,S.user_id===f.id&&(x[S.message_id][S.emoji].hasUserReacted=!0)});const F={};Object.keys(x).forEach(S=>{F[S]=Object.entries(x[S]).map(([ae,H])=>({emoji:ae,count:H.count,hasUserReacted:H.hasUserReacted}))}),J(F)}catch(h){Z(b=>[...b,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${h?.message||String(h)}`,timestamp:Date.now()}])}})()},[p,f?.id]),r.useEffect(()=>{if(p.length===0||!f?.id)return;const l=p.map(h=>h.id).filter(h=>!h.startsWith("optimistic-"));if(l.length===0)return;const u=U.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},async()=>{try{const{data:h,error:b}=await U.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",l);if(b)return;const x={};(h||[]).forEach(S=>{x[S.message_id]||(x[S.message_id]={}),x[S.message_id][S.emoji]||(x[S.message_id][S.emoji]={count:0,hasUserReacted:!1}),x[S.message_id][S.emoji].count++,S.user_id===f.id&&(x[S.message_id][S.emoji].hasUserReacted=!0)});const F={};Object.keys(x).forEach(S=>{F[S]=Object.entries(x[S]).map(([ae,H])=>({emoji:ae,count:H.count,hasUserReacted:H.hasUserReacted}))}),J(F)}catch{}}).subscribe();return()=>{U.removeChannel(u)}},[p,f?.id]);const Se=r.useCallback(async(l,u)=>{if(!f?.id)return;const b=(R[l]||[]).find(x=>x.emoji===u&&x.hasUserReacted);if(J(x=>{const F={...x},S=F[l]||[];if(b){const ae=S.map(H=>H.emoji===u?{...H,count:Math.max(0,H.count-1),hasUserReacted:!1}:H).filter(H=>H.count>0||H.emoji!==u);ae.length===0?delete F[l]:F[l]=ae}else S.find(H=>H.emoji===u)?F[l]=S.map(H=>H.emoji===u?{...H,count:H.count+1,hasUserReacted:!0}:H):F[l]=[...S,{emoji:u,count:1,hasUserReacted:!0}];return F}),b){const{error:x}=await U.from("league_message_reactions").delete().eq("message_id",l).eq("user_id",f.id).eq("emoji",u);x&&J(F=>{const S={...F},ae=S[l]||[];return ae.find(re=>re.emoji===u)?S[l]=ae.map(re=>re.emoji===u?{...re,count:re.count+1,hasUserReacted:!0}:re):S[l]=[...ae,{emoji:u,count:1,hasUserReacted:!0}],S})}else{const{error:x}=await U.from("league_message_reactions").upsert({message_id:l,user_id:f.id,emoji:u});x&&J(F=>{const S={...F},H=(S[l]||[]).map(re=>re.emoji===u?{...re,count:Math.max(0,re.count-1),hasUserReacted:!1}:re).filter(re=>re.count>0||re.emoji!==u);return H.length===0?delete S[l]:S[l]=H,S})}},[f?.id,R]);r.useEffect(()=>{!M&&B.current&&(B.current.style.height="auto",B.current.style.height="42px")},[M]);const ye=r.useCallback(l=>{const u=I.current?.offsetHeight||72;if(l>0){const h=l+u;if(ke(l),a.current){const b=`${h+8}px`;a.current.style.paddingBottom=b,requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(a.current){const x=a.current.scrollHeight-a.current.clientHeight;a.current.scrollTop=x+100}})})})}}else if(ke(0),a.current){const h=`${u+8}px`;a.current.style.paddingBottom=h}},[]);r.useEffect(()=>{const l=window.visualViewport;if(!l)return;let u=null,h=0,b=!1;setTimeout(()=>{b=!0},200);const x=()=>{const re=window.innerHeight,ze=l.height,Qe=l.offsetTop+ze;return Math.max(0,re-Qe)},F=()=>{u&&clearTimeout(u),u=setTimeout(()=>{const re=x();b&&Math.abs(re-h)>10&&(h=re,ye(re))},50)};l.addEventListener("resize",F),l.addEventListener("scroll",F),window.addEventListener("resize",F);const S=()=>{setTimeout(F,50)},ae=()=>{setTimeout(F,100)},H=setTimeout(()=>{B.current&&(B.current.addEventListener("focus",S),B.current.addEventListener("blur",ae))},100);return F(),()=>{u&&clearTimeout(u),clearTimeout(H),l.removeEventListener("resize",F),l.removeEventListener("scroll",F),window.removeEventListener("resize",F),B.current&&(B.current.removeEventListener("focus",S),B.current.removeEventListener("blur",ae))}},[ye]),r.useEffect(()=>{if(a.current&&I.current){const u=`${(I.current.offsetHeight||72)+8}px`;a.current.style.paddingBottom=u}},[]);const Ae=()=>{B.current&&B.current.removeAttribute("readonly");const l=window.visualViewport;if(l){const u=window.innerHeight,h=l.height,b=l.offsetTop+h,x=Math.max(0,u-b);x>0&&(ye(x),setTimeout(()=>me(),100))}me()},$e=l=>{const u=l.target;!(u.tagName==="A"||u.tagName==="BUTTON"||u.closest("a, button"))&&B.current&&document.activeElement===B.current&&B.current.blur()},ie=r.useMemo(()=>{if(!f)return"";const l=f.user_metadata??{},u=l.first_name||"",h=l.last_name||"";return[u,h].filter(Boolean).join(" ").trim()||l.display_name||f.email||""},[f]),V=r.useMemo(()=>{if(!p.length)return[];if(!(i instanceof Map?i.size>0:i?Object.keys(i).length>0:!1))return[];let u=null;return p.reduce((b,x)=>{const F=x.user_id===f?.id,H=lt(x.user_id,i)||(F?ie:null)||(F?"You":null);if(!H&&!F)return b;const re=H||"Unknown",ze=F?void 0:ys(re),qe=new Date(x.created_at).toDateString(),et=qe!==u;et&&(u=qe);const wt=x.reply_to?lt(x.reply_to.user_id,i)||"Unknown":null,Pe={id:x.id,text:x.content,time:La(x.created_at),status:x.status&&x.status!=="sent"?x.status:void 0,messageId:x.id,replyTo:x.reply_to?{id:x.reply_to.id,content:x.reply_to.content,authorName:wt||void 0}:null},je=b[b.length-1],yt=je?.messages.length>0&&je.messages[0].messageId?p.find(Je=>Je.id===je.messages[0].messageId)?.user_id:null;if(je&&!et&&je.isOwnMessage===F&&yt===x.user_id){const Je=je.id.includes("-")?je.id.split("-")[0]:je.id,kt=je.messages.map(Ue=>{const Fe=Ue.messageId?p.find(Te=>Te.id===Ue.messageId):null;if(Fe?.reply_to){const Te=lt(Fe.reply_to.user_id,i)||"Unknown";return{...Ue,replyTo:Ue.replyTo?{...Ue.replyTo,authorName:Te}:null}}return Ue}),it={...je,id:`${Je}-${re}`,author:re,avatarInitials:ze,userId:x.user_id,messages:[...kt,Pe]};return[...b.slice(0,-1),it]}else return[...b,{id:`${x.id}-${re}`,author:re,avatarInitials:ze,isOwnMessage:F,userId:x.user_id,dayLabel:et?Ea(x.created_at):void 0,messages:[Pe]}]},[]).map(b=>{const x={...b},F=x.messages.map(S=>{const ae=S.messageId?p.find(H=>H.id===S.messageId):null;if(ae?.reply_to&&S.replyTo){const H=lt(ae.reply_to.user_id,i)||"Unknown";if(H!==S.replyTo.authorName)return{...S,replyTo:{...S.replyTo,authorName:H}}}return S});if(x.author==="Unknown"&&x.messages.length>0&&x.messages[0].messageId){const S=p.find(ae=>ae.id===x.messages[0].messageId);if(S){const ae=lt(S.user_id,i);if(ae&&ae!=="Unknown"){const H=x.id.includes("-")?x.id.split("-")[0]:x.id;return{...x,id:`${H}-${ae}`,author:ae,avatarInitials:ys(ae),userId:S.user_id,messages:F}}}}return{...x,messages:F}})},[ie,i,p,f?.id]),D=r.useMemo(()=>{const l=V.map(h=>h.author).join(","),u=V.some(h=>h.author==="Unknown");return`chat-${V.length}-${u?"unknown":"resolved"}-${l.slice(0,50)}`},[V]),se=r.useCallback(l=>{if(a.current=l,l){if(I.current){const h=`${(I.current.offsetHeight||72)+8}px`;l.style.paddingBottom=h}else l.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{l&&p.length>0&&V.length>0})})}},[p.length,V.length]);r.useEffect(()=>{ue.current=!1},[t]),r.useEffect(()=>{p.length!==0&&(ue.current||(ue.current=!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(a.current){const l=a.current.scrollHeight,u=a.current.clientHeight;l>u&&(a.current.scrollTop=l+200)}})}))},[p.length,p]);const de=r.useCallback(async l=>{if(!t||!f?.id)return;if(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")){console.log("[Chat] Notifications skipped: running on localhost. Notifications only work on staging/production.");return}const h=f.user_metadata?.display_name||f.user_metadata?.full_name||f.email||"User";try{await(await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:t,senderId:f.id,senderName:h,content:l,activeUserIds:[f.id]})})).json().catch(()=>({}))}catch(b){console.error("[Chat] Failed to send notification:",b)}},[t,f?.id]),N=r.useCallback(async()=>{const l=M.trim();if(!(!t||!l||te))try{j(!0),W(""),B.current&&(B.current.style.height="auto",B.current.style.height="42px"),await z(l,Y?.id||null),G(),await de(l),oe(null),me()}catch(u){const{getUserFriendlyMessage:h}=await zt(async()=>{const{getUserFriendlyMessage:b}=await import("./chatErrors-CWrmdYXz.js");return{getUserFriendlyMessage:b}},[]);Z(b=>[...b,{id:`send-${Date.now()}`,message:h(u,"sendMessage"),timestamp:Date.now()}]),W(l)}finally{j(!1)}},[M,t,de,me,z,te,Y]);r.useEffect(()=>{y&&Z(l=>l.some(u=>u.message.includes("Deep Link"))?l:[...l,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${y}`,timestamp:Date.now()}])},[y]),r.useEffect(()=>{if(v.length===0)return;const l=setTimeout(()=>{Z(u=>u.filter(h=>Date.now()-h.timestamp<5e3))},5e3);return()=>clearTimeout(l)},[v]);const ge=p.length>0&&V.length>0;return e.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[v.length>0&&e.jsx("div",{className:"px-4 pt-2 space-y-2",children:v.map(l=>e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[e.jsx("span",{className:"flex-1",children:l.message}),e.jsx("button",{onClick:()=>Z(u=>u.filter(h=>h.id!==l.id)),className:"text-red-600 flex-shrink-0",children:"Ã—"})]},l.id))}),e.jsx("div",{ref:se,className:"flex-1 overflow-y-auto px-4 py-5",onClick:$e,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingBottom:"91px"},children:ge?e.jsx(e.Fragment,{children:e.jsx(Ca,{groups:V,reactions:R,onReactionClick:Se,onMessageClick:(l,u,h)=>{const b=p.find(x=>x.id===l);if(b){let x="";if(typeof u=="string")x=u;else if(typeof u=="object"&&u!==null){const F=u?.props?.children||String(u);x=typeof F=="string"?F:String(F)}else x=String(u);oe({id:l,content:x||b.content,authorName:h}),setTimeout(()=>{B.current?.focus()},100)}}},D)}):null}),e.jsxs("div",{ref:I,className:"flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:le>0?"fixed":"relative",bottom:le>0?`${le}px`:"0",left:le>0?0:"auto",right:le>0?0:"auto",width:"100%",maxWidth:le>0?"440px":"100%",marginLeft:le>0?"auto":void 0,marginRight:le>0?"auto":void 0,zIndex:le>0?100:"auto",boxShadow:le>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[Y&&e.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 dark:bg-slate-700 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-[#1C8376] dark:text-emerald-400 mb-0.5",children:["Replying to ",Y.authorName||"Unknown"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-300 line-clamp-2 truncate",children:Y.content})]}),e.jsx("button",{onClick:()=>oe(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500 dark:text-slate-400",title:"Cancel reply",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 dark:bg-slate-700 rounded-2xl px-3 py-2 relative",children:[e.jsx("textarea",{ref:B,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500",rows:1,value:M,disabled:!t||te,placeholder:t?"Start typing a messageâ€¦":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:l=>{if(l.key==="Escape"&&Y){oe(null),l.preventDefault();return}l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),N())},onChange:l=>{W(l.target.value),B.current&&(B.current.style.height="auto",B.current.style.height=`${Math.min(B.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const u=window.visualViewport;if(u){const h=window.innerHeight,b=u.height,x=u.offsetTop+b,F=h-x;ye(F)}})},onFocus:Ae,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),e.jsx("button",{type:"button",onClick:N,disabled:!t||te||!M.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),L&&e.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[L," â€” try again or switch to the classic chat tab."]})]})]})}function Ta({winnerName:t,isDraw:i}){return e.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:e.jsx("div",{className:"text-center relative z-10",children:i?e.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):e.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[t," Wins!"]})})})}function Ma({availableGws:t,selectedGw:i,onChange:y,className:f=""}){return t.length<=1?null:e.jsxs("div",{className:`flex-1 ${f}`,children:[e.jsx("style",{children:`
        .gw-selector option {
          background-color: white;
          color: #64748b;
        }
        .dark .gw-selector option {
          background-color: #1e293b;
          color: #ffffff;
        }
        .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
        .dark .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
      `}),e.jsx("select",{value:i||void 0,onChange:c=>{const p=parseInt(c.target.value,10);y(p)},className:"gw-selector w-full bg-white dark:bg-slate-800 rounded-full border-2 border-slate-300 dark:border-slate-600 px-3 py-2 text-xs font-normal text-slate-600 dark:text-white text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 dark:active:bg-slate-700 transition-colors",style:{minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:t.map(c=>e.jsxs("option",{value:c,className:"text-xs",children:["Gameweek ",c]},c))})]})}function Aa({showForm:t,onToggle:i}){return e.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 dark:bg-slate-800 p-0.5 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>i(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"text-slate-600 dark:text-slate-400":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),e.jsx("button",{onClick:()=>i(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 dark:text-slate-400"}`,children:"Form"})]})}function Ia({form:t}){const i=t.slice(-5),y=5-i.length;return e.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:y}).map((f,c)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${c}`)),i.map((f,c)=>e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${f==="W"?"bg-emerald-100 text-emerald-700":f==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:f},c))]})}function Da({rows:t,members:i,showForm:y,currentUserId:f,loading:c,isLateStartingLeague:p}){return e.jsxs("div",{className:"pt-4",children:[e.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),e.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",borderBottom:"none",boxShadow:"none"},children:e.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",border:"none",borderBottom:"none"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:"Player"}),y?e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Form"}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"W"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"D"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:p?"CP":"OCP"}),i.length>=3&&e.jsx("th",{className:"py-3 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"PTS"})]})]})}),e.jsxs("tbody",{children:[t.map((L,z)=>{const a=L.user_id===f,G=z===t.length-1;return e.jsxs("tr",{className:a?"flash-user-row":"",style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...G?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:z+1}),e.jsx("td",{className:"py-4 bg-slate-50 dark:bg-slate-900 pl-0 pr-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ze,{userId:L.user_id,name:L.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:L.name})]})}),y?e.jsx("td",{className:"px-4 py-4 bg-slate-50 dark:bg-slate-900",children:e.jsx(Ia,{form:L.form})}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.wins}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.draws}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-10 pl-1 pr-1",children:L.ocp}),i.length>=3&&e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.unicorns}),e.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-10 pl-1 pr-1",children:L.mltPts})]})]},L.user_id)}),c&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:y?3:i.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"Calculatingâ€¦"})}),!c&&!t.length&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:y?3:i.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"No gameweeks completed yet â€” this will populate after the first results are saved."})})]})]})})]})}function $a({rows:t,members:i,currentUserId:y,positionChangeKeys:f,isApiTestLeague:c,hasLiveFixtures:p,hasStartingSoonFixtures:L,hasStartedFixtures:z,allFixturesFinished:a,resGw:G}){return e.jsxs("div",{children:[e.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
        .dark .full-width-header-border::after {
          background-color: #475569;
        }
      `}),e.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 shadow-sm",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:e.jsxs("div",{className:"flex items-center gap-2",children:["Player",c&&p&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),c&&!a&&L&&!p&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-[10px] font-medium",children:z?"Next Game Starting Soon":"Starting soon"})]})]})}),e.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Score"}),i.length>=3&&e.jsx("th",{className:"py-4 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"})]})}),e.jsxs("tbody",{children:[t.map((M,W)=>{const te=M.user_id===y,j=W===t.length-1,R=f.has(M.user_id);return e.jsxs("tr",{className:`${te?"flash-user-row":""} ${R?"position-changed":""}`,style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...j?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:W+1}),e.jsx("td",{className:"py-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&p&&e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),c&&!p&&L&&e.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ze,{userId:M.user_id,name:M.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:M.name})]})}),e.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-[50px] pl-1 pr-1 ${c&&p?"pulse-live-score":""}`,children:M.score}),i.length>=3&&e.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1 ${c&&p?"pulse-live-score":""}`,children:M.unicorns})]},M.user_id)}),!t.length&&e.jsx("tr",{className:"bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},colSpan:i.length>=3?4:3,children:["No results recorded for GW ",G," yet."]})})]})]})})]})}function Pa(t){const i=aa(),y=encodeURIComponent(t);if(i){const f=`whatsapp://send?text=${y}`;let c=!1,p=!1;try{const L=document.createElement("a");L.href=f,L.style.display="none",document.body.appendChild(L),L.click(),c=!0,setTimeout(()=>{document.body.contains(L)&&document.body.removeChild(L)},100)}catch{}if(!c)try{window.open(f),p=!0}catch{}if(!c&&!p)try{window.location.href=f}catch{window.open(`https://wa.me/?text=${y}`,"_blank")}}else{const f=`https://wa.me/?text=${y}`;try{window.open(f,"_blank")}catch{navigator.clipboard.writeText(t).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+t)})}}}function Ua(t,i){const y=new Date(i.find(W=>W.gw===t)?.kickoff_time||""),f=new Date(y.getTime()-4500*1e3),c=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],p=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],L=c[f.getUTCDay()],z=f.getUTCDate(),a=p[f.getUTCMonth()],G=f.getUTCHours().toString().padStart(2,"0"),M=f.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${t} Predictions Reminder!

DEADLINE: THIS ${L} ${z} ${a}, ${G}:${M} BST

Don't forget!
playtotl.com`}function Fa(t,i){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",t);try{const y=Ua(t,i);console.log("[SubmissionStatusTable] Generated message:",y),Pa(y)}catch(y){console.error("[SubmissionStatusTable] Error in handleShareReminder:",y),alert("Error sharing reminder. Please try again.")}}function ks({members:t,submittedMap:i,picksGw:y,allSubmitted:f,remaining:c,fixtures:p,onShareReminder:L,variant:z="full"}){const a=L||(()=>Fa(y,p)),G=p.map(R=>R.kickoff_time).filter(R=>!!R).map(R=>new Date(R)).filter(R=>!isNaN(R.getTime())),M=G.length>0?new Date(Math.min(...G.map(R=>R.getTime()))):null,W=M?new Date(M.getTime()-4500*1e3):null,te=W?new Date>=W:!1;let j="";if(W){const R=z==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Y=R[W.getUTCDay()],oe=W.getUTCDate(),v=J[W.getUTCMonth()],Z=W.getUTCHours().toString().padStart(2,"0"),B=W.getUTCMinutes().toString().padStart(2,"0");j=`${Y} ${oe} ${v}, ${Z}:${B} BST`}return z==="compact"?e.jsxs("div",{className:"mt-2 pt-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:c})," of ",t.length," to submit."]})}),!f&&e.jsxs("button",{type:"button",onClick:R=>{R.preventDefault(),R.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),a()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),j&&e.jsxs("div",{className:`mb-3 text-xs font-medium ${te?"text-orange-600 dark:text-orange-400":"text-slate-600 dark:text-slate-400"} flex items-center gap-1.5`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),te?"Deadline Passed:":"Deadline:",j]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((R,J)=>R.name.localeCompare(J.name)).map(R=>{const J=`${R.id}:${y}`,Y=!!i.get(J);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{userId:R.id,name:R.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:R.name})]})}),e.jsx("td",{className:"px-4 py-3",children:Y?e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},R.id)})})]})})]}):e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-700 dark:text-slate-300",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{children:f?e.jsxs(e.Fragment,{children:["All ",t.length," members have submitted."]}):e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:c})," of ",t.length," to submit."]})}),!f&&e.jsxs("button",{type:"button",onClick:R=>{R.preventDefault(),R.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),a()},className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),j&&e.jsxs("div",{className:`mb-3 text-sm ${te?"text-orange-600 dark:text-orange-400 font-semibold":"text-slate-600 dark:text-slate-400"}`,children:[te?"â° Deadline Passed:":"â° Deadline:",j]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((R,J)=>R.name.localeCompare(J.name)).map(R=>{const J=`${R.id}:${y}`,Y=!!i.get(J);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{userId:R.id,name:R.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:R.name})]})}),e.jsx("td",{className:"px-4 py-3",children:Y?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"âœ… Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"â³ Not yet"})})]},R.id)})})]})})]})}function Ba({letter:t,userId:i,userName:y,correct:f,unicorn:c,hasSubmitted:p,isLive:L,isOngoing:z,isFinished:a}){let G;f===!0?L||z?G="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":a?G="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white relative overflow-hidden before:absolute before:inset-0 before:z-10 before:pointer-events-none before:w-[200%] before:bg-gradient-to-r before:from-transparent before:via-white/40 before:via-white/50 before:via-white/40 before:to-transparent before:animate-[shimmer_2.5s_ease-in-out_infinite] after:absolute after:inset-0 after:z-10 after:pointer-events-none after:w-[200%] after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:via-yellow-200/40 after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_3s_ease-in-out_infinite_0.5s]":G="bg-emerald-600 text-white border-emerald-600":p?G="bg-emerald-600 text-white border-emerald-600":G="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600";const M=!!i,W=M?G.replace(/\bborder-\S+/g,"").trim():G;return e.jsx("span",{className:["inline-flex items-center justify-center",M?"h-9 w-9 min-w-[36px]":"h-5 min-w-[18px]",M?"rounded-full mb-0.5":"rounded-full border mb-0.5","align-middle overflow-hidden",M?"p-0":"px-1.5 text-xs font-semibold",W].join(" "),title:c?"Correct!":y||void 0,children:M?e.jsx(Ze,{userId:i,name:y,size:36,className:"border-0 relative z-0",fallbackToInitials:!0}):t})}function Ga(t,i){return t==="FINISHED"?"FT":t==="PAUSED"?"HT":t==="IN_PLAY"?i==null?"LIVE":`${i}'`:"LIVE"}function Oa(t){const i=(t||"?").trim().split(/\s+/);return i.length?i.length===1?i[0].slice(0,1).toUpperCase():(i[0][0]+i[i.length-1][0]).toUpperCase():"?"}function Ha({fixture:t,picks:i,members:y,outcome:f,liveScore:c,submittedMap:p,picksGw:L,isApiTestLeague:z=!1}){const a=t.home_code||t.home_team||t.home_name||"",G=t.away_code||t.away_team||t.away_name||"",M=us(a)||t.home_name||t.home_team||"Home",W=us(G)||t.away_name||t.away_team||"Away",j=(B=>{if(!B)return"";const I=new Date(B);if(isNaN(I.getTime()))return"";const ue=String(I.getUTCHours()).padStart(2,"0"),le=String(I.getUTCMinutes()).padStart(2,"0");return`${ue}:${le}`})(t.kickoff_time),R=!!(c&&c.status==="IN_PLAY"),J=!!(c&&(c.status==="PAUSED"||c.status==="HALF_TIME"||c.status==="HT")),Y=!!(c&&c.status==="FINISHED"),oe=R||J;let v=null;z&&c?c.homeScore>c.awayScore?v="H":c.awayScore>c.homeScore?v="A":c.homeScore===c.awayScore&&(v="D"):v=f;const Z=B=>{const I=i.filter(me=>me.pick===B),ue=4,le=[];for(let me=0;me<I.length;me+=ue){const Se=I.slice(me,me+ue);le.push(Se)}const ke=12;return e.jsx("div",{className:"flex flex-col gap-1",children:le.map((me,Se)=>e.jsx("div",{className:"flex items-center justify-center",children:me.map((ye,Ae)=>{const $e=y.find(se=>se.id===ye.user_id),ie=Oa($e?.name??"?"),V=p.has(`${ye.user_id}:${L}`),D=v&&v===B?!0:null;return e.jsx("span",{className:"inline-block",style:{marginLeft:Ae>0?`-${ke}px`:"0",position:"relative",zIndex:Ae},children:e.jsx(Ba,{letter:ie,userId:ye.user_id,userName:$e?.name,correct:D,unicorn:D===!0,hasSubmitted:V,isLive:R,isOngoing:oe,isFinished:Y})},ye.user_id)})},Se))})};return e.jsx("li",{className:"border-t first:border-t-0",children:e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800 relative",children:[(R||J)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),Y&&!R&&!J&&e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"FT"})}),e.jsxs("div",{className:`grid grid-cols-3 items-center ${oe?"pt-4":""}`,children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:M})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ms,{code:t.home_code||void 0,crest:t.home_crest||void 0,size:24,className:"h-6 w-6"}),e.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600 dark:text-slate-300",children:c&&(R||J||Y)?e.jsxs("span",{className:"font-bold text-base text-slate-900 dark:text-slate-100",children:[c.homeScore," - ",c.awayScore]}):e.jsx("span",{children:j})}),e.jsx(ms,{code:t.away_code||void 0,crest:t.away_crest||void 0,size:24,className:"h-6 w-6"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:W})})]}),c&&(oe||Y)&&e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx("span",{className:`text-[10px] font-semibold ${oe?"text-red-600":"text-slate-500 dark:text-slate-400"}`,children:Ga(c.status,c.minute)})}),e.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:Z("H")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:Z("D")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:Z("A")})})]})]})})}function vs({label:t,fixtures:i,picksByFixture:y,members:f,outcomes:c,liveScores:p,submittedMap:L,picksGw:z,isApiTestLeague:a=!1,isFirstSection:G=!1,hasLiveGames:M=!1,allGamesFinished:W=!1,allSubmitted:te=!1,resultsPublished:j=!1,deadlinePassed:R=!1,whoDidntSubmit:J=[],liveFixturesCount:Y,hasStarted:oe=!1}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(ra,{date:t,className:"text-lg font-normal"}),G&&e.jsxs(e.Fragment,{children:[a&&M&&Y!==void 0&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:Y}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:i.length})]})]}),a&&W&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),a&&!oe&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!a&&(fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"LeagueFixtureSection.tsx:79",message:"Checking Round Complete conditions",data:{isApiTestLeague:a,allSubmitted:te,resultsPublished:j,allGamesFinished:W,shouldShow:te&&j&&W},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H3"})}).catch(()=>{}),te&&j&&W)&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!a&&te&&!j&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!a&&R&&!te&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",J.length>0&&`(${J.join(", ")} didn't submit)`]})]})]}),e.jsx("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 overflow-hidden",children:e.jsxs("ul",{children:[i.map(v=>{try{const Z=y.get(v.fixture_index)??[],B=c.get(v.fixture_index)||null,I=p[v.fixture_index]||null;return e.jsx(Ha,{fixture:v,picks:Z,members:f,outcome:B,liveScore:I,submittedMap:L,picksGw:z,isApiTestLeague:a},`${v.gw}-${v.fixture_index}`)}catch(Z){return console.error("Error rendering fixture:",Z,v),e.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",v.fixture_index]},`${v.gw}-${v.fixture_index}`)}}),!i.length&&e.jsx("li",{className:"p-4 text-slate-500 dark:text-slate-400",children:"No fixtures."})]})})]})}const Ht=8;function Wt(t){return t.result==="H"||t.result==="D"||t.result==="A"?t.result:typeof t.home_goals=="number"&&typeof t.away_goals=="number"?t.home_goals>t.away_goals?"H":t.home_goals<t.away_goals?"A":"D":null}function qa(){const t=r.useRef(0);t.current=0;const{code:i=""}=na();t.current++;const[y,f]=oa();t.current++;const{user:c}=Ss();t.current++;const{currentGw:p}=la();t.current++;const[L]=r.useState(()=>{const s=localStorage.getItem("oldSchoolMode");return s?JSON.parse(s):!1});t.current++,r.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(L))},[L]),t.current++,r.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const s=()=>{const m=document.querySelector(".league-header-fixed");if(m){const E=m.style.top||window.getComputedStyle(m).top;E!=="0px"&&E!=="0"&&(m.style.top="0",m.style.transform="translate3d(0, 0, 0)")}},n=()=>{s(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},o=m=>{const E=m.target;E.closest(".league-content-wrapper")||E.closest(".league-header-fixed")||E.closest(".chat-tab-wrapper")||m.preventDefault()};window.addEventListener("scroll",n,{passive:!0}),document.addEventListener("touchmove",o,{passive:!1});const d=setInterval(s,100);return s(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",n),document.removeEventListener("touchmove",o),clearInterval(d)}},[]),r.useEffect(()=>{const s=o=>{const d=o.target;(d.tagName==="INPUT"||d.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const m=document.querySelector(".league-header-fixed");m&&(m.style.top="0")},100)},n=()=>{const o=document.querySelector(".league-header-fixed");o&&(o.style.top="0")};return document.addEventListener("focusin",s),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{document.removeEventListener("focusin",s),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),r.useEffect(()=>{if(typeof window>"u")return;const s=window.visualViewport;if(!s)return;let n=null;const o=()=>{const m=ye.current;if(!m)return;const E=s.offsetTop??0;m.style.setProperty("transform",`translate3d(0, ${E}px, 0)`,"important")},d=()=>{n&&cancelAnimationFrame(n),n=window.requestAnimationFrame(o)};return d(),s.addEventListener("resize",d),s.addEventListener("scroll",d),()=>{n&&cancelAnimationFrame(n),s.removeEventListener("resize",d),s.removeEventListener("scroll",d),ye.current&&ye.current.style.removeProperty("transform")}},[]);const z=()=>{if(!i)return null;try{const s=be(`leagues:${c?.id||""}`);if(s){const n=s.find(o=>o.code.toUpperCase()===i.toUpperCase());if(n)return n}}catch{}return null},[a,G]=r.useState(()=>z());t.current++;const[M,W]=r.useState(!1);t.current++;const te=()=>{const s=z();if(!s?.id)return[];try{const n=be(`league:members:${s.id}`);if(n&&n.length>0)return n.map(([o,d])=>({id:o,name:d||"(no name)"}))}catch{}return[]},[j,R]=r.useState(te);t.current++;const[J,Y]=r.useState(()=>!z());t.current++;const oe="chat",[v,Z]=r.useState(oe),B=r.useRef(null);r.useEffect(()=>{if(B.current!==null&&B.current!==v)try{const s=localStorage.getItem("message_subscription_logs"),n=s?JSON.parse(s):[];n.push({timestamp:Date.now(),leagueId:a?.id,status:"TAB_CHANGED",channel:`league-messages:${a?.id}`,from:B.current,to:v,reason:`Tab changed from "${B.current}" to "${v}"`});const o=n.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(s){console.error("[LeaguePage] Failed to log tab change:",s)}B.current=v},[v,a?.id]);const I=r.useRef(null);r.useEffect(()=>{if(I.current!==null&&I.current!==a?.id)try{const s=localStorage.getItem("message_subscription_logs"),n=s?JSON.parse(s):[];n.push({timestamp:Date.now(),leagueId:a?.id,status:"LEAGUE_ID_CHANGED",channel:`league-messages:${a?.id}`,from:I.current,to:a?.id,reason:`League ID changed from "${I.current}" to "${a?.id}"`});const o=n.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(s){console.error("[LeaguePage] Failed to log league ID change:",s)}I.current=a?.id??null},[a?.id]),r.useEffect(()=>{const s=Date.now();try{const n=localStorage.getItem("message_subscription_logs"),o=n?JSON.parse(n):[];o.push({timestamp:Date.now(),leagueId:a?.id,status:"LEAGUE_PAGE_MOUNT",channel:`league-messages:${a?.id}`,pageId:s,tab:v,reason:"LeaguePage component mounted"});const d=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(d))}catch(n){console.error("[LeaguePage] Failed to log mount:",n)}return()=>{try{const n=localStorage.getItem("message_subscription_logs"),o=n?JSON.parse(n):[];o.push({timestamp:Date.now(),leagueId:a?.id,status:"LEAGUE_PAGE_UNMOUNT",channel:`league-messages:${a?.id}`,pageId:s,tab:v,reason:"LeaguePage component unmounting"});const d=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(d))}catch(n){console.error("[LeaguePage] Failed to log unmount:",n)}}},[]),t.current++;const[ue,le]=r.useState(null);t.current++;const ke=r.useRef(v);t.current++,r.useEffect(()=>{ke.current=v},[v]),t.current++;const me=r.useRef(!1);t.current++;const Se=r.useRef(!1);t.current++,r.useEffect(()=>{const s=y.get("tab"),n=y.get("leagueCode");if(le(null),s==="chat"||s==="gw"||n){if(n&&i!==n){le(`Deep link mismatch: URL has leagueCode=${n} but we're on league ${i}. Current URL: ${window.location.href}`);return}if(s==="chat"){v!=="chat"&&(Z(d=>d!=="chat"?"chat":d),setTimeout(()=>{ke.current!=="chat"&&le(`Failed to open chat tab. Current tab: ${ke.current}, Expected: chat. URL: ${window.location.href}`)},300));const o=setTimeout(()=>{f({},{replace:!0})},200);return()=>clearTimeout(o)}if(s==="gw"){v!=="gw"&&(Z(d=>d!=="gw"?"gw":d),setTimeout(()=>{ke.current!=="gw"&&le(`Failed to open predictions tab. Current tab: ${ke.current}, Expected: gw. URL: ${window.location.href}`)},300));const o=setTimeout(()=>{f({},{replace:!0})},200);return()=>clearTimeout(o)}}},[y,f,v,i]);const ye=r.useRef(null),[Ae,$e]=r.useState(!1),[ie,V]=r.useState(!1),[D,se]=r.useState(!1),de=()=>{try{return be("app_meta:current_gw")?.current_gw??null}catch{return null}},[N,ge]=r.useState(de),[l,u]=r.useState(null),[h,b]=r.useState(de),x=()=>{try{return be("app:available_gws")??[]}catch{return[]}},[F,S]=r.useState(()=>x()),ae=r.useRef({}),H=r.useRef({}),re=r.useRef(new Map),[ze,Qe]=r.useState(new Set),[qe,et]=r.useState(!1),[wt,Pe]=r.useState(!1),[je,yt]=r.useState(0),[Jt,Je]=r.useState(!1),[kt,it]=r.useState(!1),[Ue,Fe]=r.useState(!1),[Te,ct]=r.useState(!1),[dt,Ee]=r.useState(null),[Cs,He]=r.useState(!1),[Be,Ve]=r.useState(null),[Ls,Vt]=r.useState({x:0,y:0}),[vt,jt]=r.useState(1),[ut,Kt]=r.useState(null),[Me,tt]=r.useState(null),[st,Ke]=r.useState(!1);t.current++;const[at,mt]=r.useState(!1);t.current++;const[Es,rt]=r.useState(!1);t.current++;const[_t,ft]=r.useState(!1);t.current++;const[ht,Ye]=r.useState(!1),[Rs,Nt]=r.useState(!1),[Ts,St]=r.useState(!1),[gt,Yt]=r.useState(null),[Ct,Xt]=r.useState(!1),[Lt,Zt]=r.useState(!1),[nt,Ms]=r.useState(null),Ie=r.useMemo(()=>!!c?.id&&j.some(s=>s.id===c.id),[c?.id,j]),Qt=r.useMemo(()=>!!c?.id&&!!nt&&nt.id===c.id,[c?.id,nt]),As=r.useMemo(()=>nt?.name??"League admin",[nt]),Is=r.useMemo(()=>{const s=new Map;return j.forEach(n=>s.set(n.id,n.name)),s.set(Ns,ia),s},[j]),Ds=r.useCallback(()=>{if(!a?.code||typeof window>"u"||typeof navigator>"u")return;const s=`Join my mini league "${a.name}" on TotL!`,n=`${window.location.origin}/league/${a.code}`,o=navigator;if(typeof o.share=="function"){o.share({title:`Join ${a.name}`,text:s,url:n}).catch(()=>{});return}const d=`${s}
${n}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(d).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",a.code)}):window.prompt?.("Share this league code:",a.code)},[a]),$s=r.useCallback(async()=>{if(!(!a?.id||!c?.id)){se(!0);try{const{error:s}=await U.from("league_members").delete().eq("league_id",a.id).eq("user_id",c.id);if(s)throw s;typeof window<"u"&&(window.location.href="/leagues")}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to leave league. Please try again.")}finally{se(!1),V(!1)}}},[a?.id,c?.id]),Ps=r.useCallback(async()=>{if(!(!a?.id||!c?.id)){ft(!0);try{if((await ca(c.id)).length>=20){typeof window<"u"&&window.alert?.("You're already in 20 mini-leagues, which is the maximum. Leave a league before joining another."),rt(!1),ft(!1);return}const n=p;if(n!==null){const m=await Ft({id:a.id,name:a.name,created_at:a.created_at},n);if(n-m>=4){typeof window<"u"&&window.alert?.("This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."),rt(!1),ft(!1);return}}if(j.length>=Ht){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),rt(!1);return}const{error:o}=await U.from("league_members").insert({league_id:a.id,user_id:c.id});if(o)throw o;const d=c.user_metadata?.display_name||c.email||"Someone";try{const m=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:a.id,userId:c.id,userName:d})}),E=await m.text();try{E&&JSON.parse(E)}catch{}m.ok}catch{}typeof window<"u"&&window.location.reload()}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to join league.")}finally{ft(!1)}}},[a?.id,a?.name,a?.created_at,c?.id,j.length,p]),Us=r.useCallback(async()=>{if(!(!gt||!a?.id||!c?.id)){Xt(!0);try{const{error:s}=await U.from("league_members").delete().eq("league_id",a.id).eq("user_id",gt.id);if(s)throw s;typeof window<"u"&&window.location.reload()}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to remove member.")}finally{Xt(!1),Nt(!1),Yt(null)}}},[a?.id,gt,c?.id]),Fs=r.useCallback(async()=>{if(!(!a?.id||!c?.id)){Zt(!0);try{const{error:s}=await U.from("league_members").delete().eq("league_id",a.id);if(s)throw s;const{error:n}=await U.from("leagues").delete().eq("id",a.id);if(n)throw n;typeof window<"u"&&(window.location.href="/leagues")}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to end league.")}finally{Zt(!1),St(!1)}}},[a?.id,c?.id]),Bs=s=>new Promise((n,o)=>{const d=new Image;d.addEventListener("load",()=>n(d)),d.addEventListener("error",m=>o(m)),d.src=s}),es=async(s,n)=>{const o=await Bs(s),d=document.createElement("canvas"),m=d.getContext("2d");if(!m)throw new Error("No 2d context");return d.width=n.width,d.height=n.height,m.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),new Promise((E,$)=>{d.toBlob(C=>{if(!C){$(new Error("Canvas is empty"));return}E(C)},"image/jpeg",.9)})},Gs=r.useCallback(s=>{if(!a?.id||!Ie){Ee("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(s.type)){Ee("Please upload a PNG, JPG, or WebP image.");return}const o=20*1024*1024;if(s.size>o){Ee("Please choose an image smaller than 20MB.");return}if(Ee(null),He(!1),s.size>5*1024*1024)fs(s,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(d=>{const m=new FileReader;m.onload=()=>{Ve(m.result)},m.readAsDataURL(d)}).catch(()=>{Ee("Failed to process image. Please try a smaller file.")});else{const d=new FileReader;d.onload=()=>{Ve(d.result)},d.readAsDataURL(s)}},[Ie,a?.id]),Os=r.useCallback(async(s,n)=>{if(Kt(n),Be)try{const o=await es(Be,n),d=URL.createObjectURL(o);tt(d)}catch{}},[Be]),Hs=r.useCallback(async()=>{if(!(!Be||!ut||!a?.id||!Ie)){Ee(null),He(!1),ct(!0);try{const s=await es(Be,ut),n=new File([s],"badge.jpg",{type:"image/jpeg"}),o=await fs(n,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(o.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const d=`${a.id}-${Date.now()}.jpg`,{error:m}=await U.storage.from("league-avatars").upload(d,o,{cacheControl:"3600",upsert:!0,contentType:o.type});if(m)throw m;const{data:E}=U.storage.from("league-avatars").getPublicUrl(d),$=E?.publicUrl;if(!$)throw new Error("Unable to get public URL for badge.");const{error:C}=await U.from("leagues").update({avatar:$}).eq("id",a.id);if(C)throw C;G(Q=>Q&&{...Q,avatar:$}),He(!0),Me&&URL.revokeObjectURL(Me),Ve(null),tt(null),Fe(!1),c?.id&&(qt(c.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:$}})))}catch(s){Ee(s?.message??"Failed to upload badge. Please try again.")}finally{ct(!1)}}},[Be,ut,Ie,a?.id,c?.id]),Ws=r.useCallback(async()=>{if(!(!a?.id||!Ie)){Ee(null),He(!1),ct(!0);try{const{error:s}=await U.from("leagues").update({avatar:null}).eq("id",a.id);if(s)throw s;G(n=>n&&{...n,avatar:null}),He(!0),c?.id&&(qt(c.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:null}})))}catch(s){Ee(s?.message??"Failed to remove badge. Please try again.")}finally{ct(!1)}}},[Ie,a?.id]),[ts,zs]=r.useState(new Map);r.useEffect(()=>{(async()=>{const s=new Map,{data:n}=await U.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:o}=await U.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),d=new Map;if(n&&n.forEach(m=>{(!d.has(m.gw)||m.kickoff_time&&new Date(m.kickoff_time)<new Date(d.get(m.gw)))&&m.kickoff_time&&d.set(m.gw,m.kickoff_time)}),o&&o.length>0){const m=o.find(E=>E.kickoff_time)?.kickoff_time;if(m){const E=d.get(1);(!E||new Date(m)<new Date(E))&&d.set(1,m)}}d.forEach((m,E)=>{const $=new Date(m),C=new Date($.getTime()-4500*1e3);s.set(E,C)}),zs(s)})()},[]),r.useEffect(()=>{const s=n=>{const o=n.target;qe&&!o.closest(".gw-dropdown-container")&&et(!1)};return qe&&document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[qe]),r.useEffect(()=>{let s=!0;return(async()=>{const{data:n}=await U.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!s)return;ge(n?.current_gw??null);const{data:o}=await U.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!s)return;u(o&&o.length?o[0].gw:null);const{data:d}=await U.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!s)return;const m=d?[...new Set(d.map($=>$.gw))].sort(($,C)=>C-$):[],E=n?.current_gw;E&&!m.includes(E)&&m.unshift(E),S(m),(m.length>0&&!h||m.length>0&&h&&!m.includes(h))&&b(m[0])})(),()=>{s=!1}},[je]);const qs=r.useMemo(()=>j.map(s=>s.id).sort().join(","),[j]),Ge=r.useMemo(()=>j.map(s=>s.id),[qs]),[pe,ss]=r.useState([]);t.current++;const[as,Et]=r.useState([]);t.current++;const[rs,Rt]=r.useState([]);t.current++;const[Tt,Mt]=r.useState([]);t.current++,r.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[v]),t.current++;const{state:At}=Xe(N);t.current++;const xt=r.useMemo(()=>a?.name==="API Test",[a?.name]),[Ce,ns]=r.useState(null);t.current++;const It=r.useMemo(()=>a?a.name==="API Test"?Ce??1:Se.current&&h||!N?h:At==="LIVE"||At==="RESULTS_PRE_GW"?N:l&&l<N?l:N>1?N-1:N:N||h||null,[a?.name,Ce,h,N,At,l]);t.current++;const{state:Js}=Xe(It??null);t.current++;const ot=r.useRef(""),os=r.useRef(0),ls=r.useMemo(()=>{const s=pe?.length||0;if(s===os.current&&ot.current&&(pe?.map(d=>d.api_match_id).filter(d=>d!=null).sort().join(",")||"")===ot.current)return ot.current;if(os.current=s,!pe||pe.length===0)return ot.current="","";const n=pe.map(o=>o.api_match_id).filter(o=>o!=null).sort().join(",");return ot.current=n,n},[pe]);r.useEffect(()=>{if(!xt){ns(null);return}let s=!0;return(async()=>{const{data:n}=await U.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let o=n?.current_test_gw??1;if(o&&o!==1){const{data:d}=await U.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!d){const{data:m}=await U.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();m&&(o=1)}}s&&ns(o)})(),()=>{s=!1}},[xt]);const Vs=r.useMemo(()=>xt&&Ce!==null?Ce:N||h||void 0,[xt,Ce,N,h]),Dt=r.useRef({key:"",array:void 0}),Ks=r.useMemo(()=>{const s=ls||"";if(Dt.current.key===s)return Dt.current.array;const n=s?s.split(",").map(o=>parseInt(o,10)).filter(o=>!isNaN(o)):void 0;return Dt.current={key:s,array:n},n},[ls]),{liveScores:is}=da(Vs,Ks),ve=r.useMemo(()=>{const s={};if(!pe||pe.length===0)return Object.keys(H.current).length===0?H.current:(H.current=s,s);pe.forEach(E=>{const $=E.api_match_id;if($){const C=is.get($);C&&(s[E.fixture_index]={homeScore:C.home_score??0,awayScore:C.away_score??0,status:C.status||"SCHEDULED",minute:C.minute??null})}});const n=H.current,o=Object.keys(s).map(Number),d=Object.keys(n).map(Number);if(o.length!==d.length)return H.current=s,s;let m=!1;for(const E of o){const $=s[E],C=n[E];if(!C||$.homeScore!==C.homeScore||$.awayScore!==C.awayScore||$.status!==C.status||$.minute!==C.minute){m=!0;break}}return m?(H.current=s,s):n},[is,pe]),Ys=()=>{try{if(console.log("[League] getInitialMltRows called",{code:i,userId:c?.id}),i&&c?.id){const n=be(`leagues:${c.id}`);if(console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!n,length:n?.length}),n&&Array.isArray(n)){const o=n.find(d=>d.code.toUpperCase()===i.toUpperCase());if(console.log("[League] getInitialMltRows - found league",{found:!!o,leagueId:o?.id}),o?.id){const d=`league:mltRows:${o.id}`,m=be(d);if(console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!m,length:m?.length,cacheKey:d,cachedType:typeof m,isArray:Array.isArray(m),rawCache:m}),m&&Array.isArray(m)&&m.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows",m.length),m;console.log("[League] âŒ Cache check failed",{cached:!!m,isArray:Array.isArray(m),length:m?.length,cacheKey:d})}}}const s=z();if(console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!s,leagueId:s?.id}),s?.id){const n=be(`league:mltRows:${s.id}`);if(console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!n,length:n?.length}),n&&Array.isArray(n)&&n.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows from initialLeague",n.length),n}if(i&&c?.id){const n=be(`leagues:${c.id}`);if(n&&Array.isArray(n)){for(const o of n)if(o.code?.toUpperCase()===i.toUpperCase()&&o.id){const d=be(`league:mltRows:${o.id}`);if(d&&Array.isArray(d)&&d.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows from strategy 3",d.length),d}}}console.log("[League] âš ï¸ getInitialMltRows returning empty array - cache miss")}catch(s){console.error("[League] âŒ getInitialMltRows error",s)}return[]},[_e,De]=r.useState(Ys);r.useEffect(()=>{console.log("[League] Tab changed to:",v,"mltRows.length:",_e.length)},[v,_e.length]),r.useEffect(()=>{if(a?.id){const s=`league:mltRows:${a.id}`,n=be(s);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:a.id,cacheKey:s,hasCached:!!n,cachedLength:n?.length,currentMltRowsLength:_e.length}),n&&n.length>0)_e.length===0?(console.log("[League] âœ… Setting mltRows from cache",n.length),De(n)):console.log("[League] mltRows already populated, skipping");else{console.log("[League] âš ï¸ No cached mltRows found - will retry multiple times");let o=0;const d=10,m=[50,100,150,200,250,300,400,500,600,800],E=()=>{if(o>=d){console.log("[League] âŒ Max retries reached, giving up on cache");return}const C=setTimeout(()=>{o++;const Q=be(s);Q&&Q.length>0&&_e.length===0?(console.log(`[League] âœ… Retry ${o} successful - Setting mltRows from cache`,Q.length),De(Q)):o<d&&E()},m[o]||800);return()=>clearTimeout(C)};return E()}}else console.log("[League] âš ï¸ No league.id available yet")},[a?.id,_e.length]),r.useEffect(()=>{let s=!0;return(async()=>{let o=a;if(!o){const{data:C}=await U.from("leagues").select("id,name,code,created_at,avatar").eq("code",i).maybeSingle();if(!s)return;if(!C){G(null),R([]),Y(!1);return}o=C,G(o)}const d=be(`league:members:${o.id}`);let m=[];if(d&&d.length>0)m=d.map(([C,Q])=>({id:C,name:Q||"(no name)"})),Y(!1);else{const{data:C}=await U.from("league_members").select("users(id,name),created_at").eq("league_id",o.id).order("created_at",{ascending:!0});m=C?.map(Q=>({id:Q.users.id,name:Q.users.name??"(no name)"}))??[],Y(!1)}const E=[...m].sort((C,Q)=>C.name.localeCompare(Q.name));R(E);const $=m[0];Ms($),c?.id&&!m.some(C=>C.id===c.id)&&rt(!0),Y(!1)})(),()=>{s=!1}},[i]),r.useEffect(()=>{},[a,v]),r.useEffect(()=>{let s=!0;return(async()=>{const n=a?.name==="API Test";let o=Ce??1;if(n){const{data:_}=await U.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(o=_?.current_test_gw??1,o&&o!==1){const{data:T}=await U.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!T){const{data:q}=await U.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();q&&(o=1)}}}const d=n&&(v==="gw"||v==="gwr");let m=null;if(v==="gwr")if(Se.current&&h)m=h;else if(N)try{const _=await ua(N);_==="LIVE"||_==="RESULTS_PRE_GW"?m=N:l&&l<N?m=l:m=N>1?N-1:N}catch(_){console.error("[League] Error checking game state for fixtures loading:",_),l&&l<N?m=l:m=N>1?N-1:N}else m=h;else m=N;if(n&&(v==="gw"||v==="gwr")&&(m=o),v==="gw"&&!n&&Ge.length>0){const{data:_}=await U.from("app_gw_submissions").select("gw").in("user_id",Ge).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(_&&_.length>0){const T=[...new Set(_.map(q=>q.gw))].sort((q,ee)=>(ee||0)-(q||0));for(const q of T)if(q){const{data:ee}=await U.from("app_fixtures").select("gw").eq("gw",q).limit(1);if(ee&&ee.length>0){m=q;break}}}!m&&N&&(m=N)}if(!m&&!d){ss([]),Et([]),Rt([]),Mt([]);return}let E;if(d){const{data:_}=await U.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",o).order("fixture_index",{ascending:!0});E=_?.map(T=>({...T,gw:T.test_gw}))||null}else{const{data:_}=await U.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",m).order("fixture_index",{ascending:!0});E=_||null}if(!s)return;if(ss(_=>{const T=E??[];return _.length!==T.length?T:_.length===0&&T.length===0?_:_.some((ee,k)=>!T[k]||ee.id!==T[k].id||ee.fixture_index!==T[k].fixture_index)||T.some((ee,k)=>!_[k]||ee.id!==_[k].id||ee.fixture_index!==_[k].fixture_index)?T:_}),!Ge.length){Et([]),Rt([]),Mt([]);return}let $=null,C;if(d){const{data:_}=await U.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",o).in("user_id",Ge);$=_?.map(A=>({...A,gw:A.matchday}))||null;const{data:T,error:q}=await U.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",o).not("submitted_at","is",null).in("user_id",Ge),{data:ee}=await U.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",o).order("fixture_index",{ascending:!0}),k=new Set((ee||[]).map(A=>A.fixture_index)),g=[];if(T&&$&&ee){const A=k.size,P=new Date("2025-11-18T00:00:00Z");T.forEach(O=>{const ce=($||[]).filter(xe=>xe.user_id===O.user_id&&xe.matchday===o).filter(xe=>k.has(xe.fixture_index)),Le=ce.length===A&&A>0,w=new Set(ce.map(xe=>xe.fixture_index)).size===A,ne=O.submitted_at?new Date(O.submitted_at):null,he=ne&&ne>=P;Le&&w&&he&&g.push(O)})}C=g.map(A=>({...A,gw:A.matchday}))||null}else{const{data:_}=await U.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",m).in("user_id",Ge);$=_;const{data:T}=await U.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",m).in("user_id",Ge);C=T}if(!s)return;Et(_=>{const T=$??[];if(_.length!==T.length)return T;if(_.length===0&&T.length===0)return _;const q=JSON.stringify(_.sort((k,g)=>k.fixture_index-g.fixture_index)),ee=JSON.stringify(T.sort((k,g)=>k.fixture_index-g.fixture_index));return q===ee?_:T}),Rt(_=>{const T=C??[];if(_.length!==T.length)return T;if(_.length===0&&T.length===0)return _;const q=JSON.stringify(_),ee=JSON.stringify(T);return q===ee?_:T});const{data:Q}=await U.from("app_gw_results").select("gw,fixture_index,result").eq("gw",d?1:m||0);s&&Mt(_=>{const T=Q??[];if(_.length!==T.length)return T;if(_.length===0&&T.length===0)return _;const q=JSON.stringify(_.sort((k,g)=>k.fixture_index-g.fixture_index)),ee=JSON.stringify(T.sort((k,g)=>k.fixture_index-g.fixture_index));return q===ee?_:T})})(),()=>{s=!1}},[v,N,l,h,Ge]),r.useEffect(()=>{ae.current=ve},[ve]);const Oe=r.useMemo(()=>{const s=new Map;return rs.forEach(n=>{if(n.submitted_at){const o=`${n.user_id}:${n.gw}`;s.set(o,!0)}}),s},[rs]),pt=r.useCallback(s=>s.map(n=>({user_id:n.id,name:n.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);r.useEffect(()=>{const s=U.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{yt(n=>n+1)}).subscribe();return()=>{U.removeChannel(s)}},[]),r.useEffect(()=>{let s=!0;return(async()=>{const n=je>0,o=_e.length>0&&_e.every(w=>w.wins===0&&w.draws===0),d=n||o;if(!d&&_e.length>0)return;if(!d&&a?.id){const w=be(`league:mltRows:${a.id}`);if(w&&w.length>0){De(w);return}}if(!j.length){be(`league:mltRows:${a?.id||""}`)||De([]);return}if(a?.name==="API Test"){De(pt(j));return}if(!d){const w=a?.id&&be(`league:mltRows:${a.id}`);if(w&&w.length>0){De(w);return}}if(N===null)return;const{data:m}=await U.from("app_gw_results").select("gw,fixture_index,result"),E=m??[],$=new Map;if(E.forEach(w=>{const ne=Wt(w);ne&&$.set(`${w.gw}:${w.fixture_index}`,ne)}),$.size===0){De(pt(j));return}const C=[...new Set(Array.from($.keys()).map(w=>parseInt(w.split(":")[0],10)))].sort((w,ne)=>w-ne),Q=["Prem Predictions","FC Football","Easy League"],_=["The Bird league"],T=await Ft(a,N);let q=C.filter(w=>w>=T);if(N!==null&&q.includes(N)){const{data:w}=await U.from("app_fixtures").select("fixture_index").eq("gw",N),ne=w?.length??0,he=Array.from($.keys()).filter(xe=>parseInt(xe.split(":")[0],10)===N).length;ne>0&&he<ne&&(q=q.filter(xe=>xe<N))}else N!==null&&(q=q.filter(w=>w<N));if(!Q.includes(a?.name||"")&&!_.includes(a?.name||"")&&q.length===0){De(pt(j));return}const{data:ee}=await U.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",j.map(w=>w.id)).in("gw",q),k=ee??[],g=new Map;q.forEach(w=>{const ne=new Map;j.forEach(he=>ne.set(he.id,{user_id:he.id,score:0,unicorns:0})),g.set(w,ne)}),q.forEach(w=>{Array.from($.entries()).filter(([he])=>parseInt(he.split(":")[0],10)===w).map(([he,xe])=>({idx:parseInt(he.split(":")[1],10),out:xe})).forEach(({idx:he,out:xe})=>{const X=k.filter(Re=>Re.gw===w&&Re.fixture_index===he),Ne=X.filter(Re=>Re.pick===xe).map(Re=>Re.user_id),ds=g.get(w);if(X.forEach(Re=>{if(Re.pick===xe){const Pt=ds.get(Re.user_id);Pt.score+=1}}),Ne.length===1&&j.length>=3){const Re=Ne[0],Pt=ds.get(Re);Pt.unicorns+=1}})});const A=new Map,P=new Map,O=new Map,K=new Map,ce=new Map,Le=new Map;j.forEach(w=>{A.set(w.id,0),P.set(w.id,0),O.set(w.id,0),K.set(w.id,0),ce.set(w.id,0),Le.set(w.id,[])}),q.forEach(w=>{const ne=Array.from(g.get(w).values());if(ne.forEach(X=>{P.set(X.user_id,(P.get(X.user_id)??0)+X.score),O.set(X.user_id,(O.get(X.user_id)??0)+X.unicorns)}),ne.sort((X,Ne)=>Ne.score-X.score||Ne.unicorns-X.unicorns),!ne.length)return;const he=ne[0],xe=ne.filter(X=>X.score===he.score&&X.unicorns===he.unicorns);xe.length===1?(A.set(he.user_id,(A.get(he.user_id)??0)+3),K.set(he.user_id,(K.get(he.user_id)??0)+1),Le.get(he.user_id).push("W"),ne.slice(1).forEach(X=>Le.get(X.user_id).push("L"))):(xe.forEach(X=>{A.set(X.user_id,(A.get(X.user_id)??0)+1),ce.set(X.user_id,(ce.get(X.user_id)??0)+1),Le.get(X.user_id).push("D")}),ne.filter(X=>!xe.find(Ne=>Ne.user_id===X.user_id)).forEach(X=>Le.get(X.user_id).push("L")))});const fe=j.map(w=>({user_id:w.id,name:w.name,mltPts:A.get(w.id)??0,ocp:P.get(w.id)??0,unicorns:O.get(w.id)??0,wins:K.get(w.id)??0,draws:ce.get(w.id)??0,form:Le.get(w.id)??[]}));fe.sort((w,ne)=>ne.mltPts-w.mltPts||ne.unicorns-w.unicorns||ne.ocp-w.ocp||w.name.localeCompare(ne.name)),s&&(De(fe),a?.id&&js(`league:mltRows:${a.id}`,fe,_s.LEAGUES))})(),()=>{s=!1}},[j,a,N,pt,je]);const cs=r.useCallback(async()=>{if(!a||!p){Ke(!0);return}try{const s=await Ft({id:a.id,name:a.name,created_at:a.created_at},p);if(p-s>=4){mt(!0);return}Ke(!0)}catch(s){console.error("[League] Error checking league lock status:",s),Ke(!0)}},[a,p]);function $t(){return e.jsxs("div",{className:"text-center p-8 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("img",{src:"/assets/Volley/volley-with-ball.png",alt:"Volley",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 font-bold",children:"Share your league code with friends to kick things off."}),e.jsx("button",{onClick:cs,className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]})}function Xs(){const s=r.useRef(null);if(r.useEffect(()=>{if(!at)return;const o=d=>{d.key==="Escape"&&mt(!1)};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[at]),r.useEffect(()=>(at?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[at]),!at)return null;const n=o=>{o.target===o.currentTarget&&mt(!1)};return ps.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:s,className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:n,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"league-locked-error-title",onClick:n,style:{zIndex:1e6},children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-800 px-8 py-8 text-center shadow-2xl max-w-sm w-full",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-red-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-amber-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{id:"league-locked-error-title",className:"text-2xl font-extrabold text-amber-600",children:"League Locked"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."}),e.jsx("button",{onClick:()=>mt(!1),className:"mt-4 px-6 py-2.5 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#156d63] transition-colors",children:"OK"})]})]})})]}),document.body)}function Zs(){const[s,n]=r.useState(""),o=r.useRef(null),d=r.useRef(null);r.useEffect(()=>{if(!st)return;const _=T=>{T.key==="Escape"&&Ke(!1)};return document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)},[st]);const m=_=>{_.target===_.currentTarget&&Ke(!1)};if(r.useEffect(()=>(st?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[st]),!st||!a)return null;const E=_=>{n(_),window.clearTimeout(E._t),E._t=window.setTimeout(()=>n(""),1600)},$=async()=>{try{await navigator.clipboard.writeText(a.code),E("Code copied")}catch{try{const T=document.createElement("textarea");T.value=a.code,document.body.appendChild(T),T.select(),document.execCommand("copy"),document.body.removeChild(T),E("Code copied")}catch{E("Couldn't copy")}}},C=async()=>{if(!a?.code||typeof window>"u"||typeof navigator>"u")return;const _=`Join my mini league "${a.name}" on TotL!`,T=`${window.location.origin}/league/${a.code}`,q=navigator;if(typeof q.share=="function")try{await q.share({title:`Join ${a.name}`,text:_,url:T});return}catch{return}const ee=`${_}
${T}`;try{await navigator.clipboard.writeText(ee),E("Share text copied")}catch{E("Couldn't share")}},Q=e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:o,className:"fixed inset-0 bg-black/50",onClick:m,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999,touchAction:"manipulation"}}),e.jsxs("div",{ref:d,className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 rounded-t-3xl shadow-2xl",role:"dialog","aria-modal":"true","aria-labelledby":"share-league-code-tray-title",onClick:_=>_.stopPropagation(),style:{animation:"slideUp 300ms ease-out",zIndex:1e6,touchAction:"manipulation"},children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[e.jsx("h2",{id:"share-league-code-tray-title",className:"text-lg font-medium text-slate-900 dark:text-slate-100 uppercase tracking-wide",style:{fontFamily:'"Gramatika", sans-serif',fontWeight:700},children:"Share League Code"}),e.jsx("button",{onClick:()=>Ke(!1),className:"w-8 h-8 flex items-center justify-center rounded-full","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 pb-8 max-h-[70vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-3",children:["Share this code (up to ",Ht," members):"]}),e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("code",{className:"flex-1 font-mono text-2xl font-bold text-center py-3 px-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-100",children:a.code})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:$,className:"flex-1 px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-semibold hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors",children:"Copy"}),e.jsx("button",{onClick:C,className:"flex-1 px-4 py-3 rounded-lg bg-[#1C8376] text-white font-semibold hover:bg-[#156b60] transition-colors",children:"Share"})]}),e.jsx("div",{className:`mt-3 text-xs rounded bg-slate-900 text-white px-3 py-2 text-center transition-opacity ${s?"opacity-100":"opacity-0 pointer-events-none"}`,children:s||"â€¦"}),e.jsxs("div",{className:"mt-4 text-xs text-slate-500 dark:text-slate-400 text-center",children:[j.length,"/",Ht," members"]})]})})}),e.jsx("div",{className:"flex justify-center pb-3",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})})]})]});return typeof document<"u"&&document.body?ps.createPortal(Q,document.body):Q}function Qs(){const s=performance.now();console.log("[MltTab] âš¡ RENDERING START",{mltRowsLength:_e.length,membersLength:j.length,leagueId:a?.id,timestamp:s});const n=performance.now(),o=r.useMemo(()=>N??null,[N]);Xe(o);const d=performance.now();console.log("[MltTab] âš¡ Hooks complete",{duration:d-n});const m=performance.now(),E=_e.length>0?_e:j.length>0?j.map(q=>({user_id:q.id,name:q.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],$=performance.now();console.log("[MltTab] âš¡ Rows calculated",{rowsLength:E.length,mltRowsLength:_e.length,duration:$-m});const C=["Prem Predictions","FC Football","Easy League"],Q=["The Bird league"],_=["gregVjofVcarl","Let Down"],T=!!(a&&!C.includes(a.name)&&!Q.includes(a.name)&&!_.includes(a.name));return j.length===1?e.jsx($t,{}):e.jsxs("div",{className:"pt-4",children:[e.jsx(Da,{rows:E,members:j,showForm:Ae,currentUserId:c?.id,loading:!1,isLateStartingLeague:T}),e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(Aa,{showForm:Ae,onToggle:$e}),e.jsxs("button",{onClick:()=>Je(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),a?.name==="API Test"&&e.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:e.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function ea(){const s=r.useMemo(()=>a?.name==="API Test"?Ce??1:N??null,[a?.name,Ce,N]),{state:n}=Xe(s);if(j.length===1)return e.jsx($t,{});if(!s)return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No current gameweek available."});if(!bs(a,s,ts))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Predictions Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",s," predictions are not included in this league."]})]})});const o=new Map;Tt.forEach(g=>{if(g.gw!==s)return;const A=Wt(g);A&&o.set(g.fixture_index,A)}),pe.forEach(g=>{if(g.gw!==s)return;const A=ve[g.fixture_index];A&&(A.status==="IN_PLAY"||A.status==="PAUSED"||A.status==="FINISHED")&&(A.homeScore>A.awayScore?o.set(g.fixture_index,"H"):A.awayScore>A.homeScore?o.set(g.fixture_index,"A"):o.set(g.fixture_index,"D"))});const d=r.useMemo(()=>{const g=O=>{if(!O)return"Fixtures";const K=new Date(O);return isNaN(K.getTime())?"Fixtures":K.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},A=new Map;pe.filter(O=>O.gw===s).forEach(O=>{const K=g(O.kickoff_time),ce=O.kickoff_time?new Date(O.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;A.has(K)||A.set(K,{label:K,key:ce,items:[]}),A.get(K).items.push(O)});const P=Array.from(A.values());return P.forEach(O=>O.items.sort((K,ce)=>K.fixture_index-ce.fixture_index)),P.sort((O,K)=>O.key-K.key),P},[pe,s]),m=new Set(pe.filter(g=>g.gw===s).map(g=>g.fixture_index)),E=a?.name==="API Test",$=j.length>0&&j.every(g=>Oe.get(`${g.id}:${s}`)),C=new Map;(!E||$)&&as.forEach(g=>{if(g.gw!==s||!Oe.get(`${g.user_id}:${s}`)||!m.has(g.fixture_index))return;const P=C.get(g.fixture_index)??[];P.push(g),C.set(g.fixture_index,P)});const Q=l!==null&&l>=s,_=j.filter(g=>!Oe.get(`${g.id}:${s}`)).length,T=j.filter(g=>!Oe.get(`${g.id}:${s}`)).map(g=>g.name),q=n!==null&&(n==="DEADLINE_PASSED"||n==="LIVE"||n==="RESULTS_PRE_GW"),ee=E?!$:!$&&!q;return(E?!$:!$&&!q)?e.jsx(ks,{members:j,submittedMap:Oe,picksGw:s,allSubmitted:$,remaining:_,fixtures:pe.filter(g=>g.gw===s),variant:"compact"}):e.jsxs("div",{className:"mt-2 pt-2",children:[ee?e.jsx(ks,{members:j,submittedMap:Oe,picksGw:s,allSubmitted:$,remaining:_,fixtures:pe.filter(g=>g.gw===s),variant:"full"}):null,a?.name==="API Test"&&$&&d.length>0&&!ee&&(()=>{const g=d.flatMap(fe=>fe.items),A=new Set(g.map(fe=>fe.fixture_index)),P={};Object.keys(ve).forEach(fe=>{const w=parseInt(fe,10);A.has(w)&&(P[w]=ve[w])});const O=g.some(fe=>{const w=P[fe.fixture_index];return w&&(w.status==="IN_PLAY"||w.status==="PAUSED")}),K=g.length>0&&g.every(fe=>{const w=P[fe.fixture_index];return w&&w.status==="FINISHED"}),ce=O||K||g.some(fe=>P[fe.fixture_index]);let Le=0;return c?.id&&g.forEach(fe=>{const w=P[fe.fixture_index],ne=w&&(w.status==="IN_PLAY"||w.status==="PAUSED"),he=w&&w.status==="FINISHED";if(w&&(ne||he)){const X=(C.get(fe.fixture_index)??[]).find(Ne=>Ne.user_id===c.id);if(X){let Ne=!1;(X.pick==="H"&&w.homeScore>w.awayScore||X.pick==="A"&&w.awayScore>w.homeScore||X.pick==="D"&&w.homeScore===w.awayScore)&&(Ne=!0),Ne&&Le++}}}),e.jsx("div",{className:"mt-3 space-y-6",children:d.map((fe,w)=>e.jsx(vs,{label:fe.label,fixtures:fe.items,picksByFixture:C,members:j,outcomes:o,liveScores:P,submittedMap:Oe,picksGw:s,isApiTestLeague:!0,isFirstSection:w===0,hasLiveGames:O,allGamesFinished:K,hasStarted:ce,liveFixturesCount:Le},w))})})(),d.length>0&&a?.name!=="API Test"&&(()=>{const g=Tt.filter(K=>K.gw===s),A=new Set(g.map(K=>K.fixture_index)),P=d.flatMap(K=>K.items),O=P.length>0&&P.every(K=>{if(A.has(K.fixture_index))return!0;const ce=ve[K.fixture_index];return ce&&ce.status==="FINISHED"});return e.jsx("div",{className:"mt-3 space-y-6",children:d.map((K,ce)=>e.jsx(vs,{label:K.label,fixtures:K.items,picksByFixture:C,members:j,outcomes:o,liveScores:ve,submittedMap:Oe,picksGw:s,isApiTestLeague:!1,isFirstSection:ce===0,allSubmitted:$,resultsPublished:Q,allGamesFinished:O,deadlinePassed:q,whoDidntSubmit:T},ce))})})(),!d.length&&!ee&&e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-500 dark:text-slate-400",children:["No fixtures for GW ",s,"."]})]})}function ta(){const{state:s}=Xe(N),n=r.useMemo(()=>a?.name==="API Test"?Ce??1:v==="gwr"?Se.current&&h||!N?h:s==="LIVE"||s==="RESULTS_PRE_GW"?N:l&&l<N?l:N>1?N-1:N:h,[a?.name,Ce,v,h,N,s,l]);Xe(n);const o=n;if(j.length===1)return e.jsx($t,{});if(!o||F.length===0&&a?.name!=="API Test")return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No gameweek selected."});if(!bs(a,o,ts))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Results Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",o," results are not included in this league."]})]})});const d=new Map,m=a?.name==="API Test",E=pe.filter(k=>k.gw===o),$=E.some(k=>{const g=ve[k.fixture_index];return g&&(g.status==="IN_PLAY"||g.status==="PAUSED"||g.status==="FINISHED")});m&&o===(Ce??1)?E.forEach(k=>{const g=ve[k.fixture_index];g&&(g.status==="IN_PLAY"||g.status==="PAUSED"||g.status==="FINISHED")&&(g.homeScore>g.awayScore?d.set(k.fixture_index,"H"):g.awayScore>g.homeScore?d.set(k.fixture_index,"A"):d.set(k.fixture_index,"D"))}):$&&o===N?E.forEach(k=>{const g=ve[k.fixture_index];g&&(g.status==="IN_PLAY"||g.status==="PAUSED"||g.status==="FINISHED")&&(g.homeScore>g.awayScore?d.set(k.fixture_index,"H"):g.awayScore>g.homeScore?d.set(k.fixture_index,"A"):d.set(k.fixture_index,"D"))}):Tt.forEach(k=>{if(k.gw!==o)return;const g=Wt(k);g&&d.set(k.fixture_index,g)});const C=j.map(k=>({user_id:k.id,name:k.name,score:0,unicorns:0})),Q=new Map;as.forEach(k=>{if(k.gw!==o)return;const g=Q.get(k.fixture_index)??[];g.push(k),Q.set(k.fixture_index,g)}),Array.from(d.entries()).forEach(([k,g])=>{const P=(Q.get(k)??[]).filter(O=>O.pick===g).map(O=>O.user_id);if(P.forEach(O=>{const K=C.find(ce=>ce.user_id===O);K.score+=1}),P.length===1&&j.length>=3){const O=C.find(K=>K.user_id===P[0]);O.unicorns+=1}}),C.sort((k,g)=>g.score-k.score||g.unicorns-k.unicorns||k.name.localeCompare(g.name)),r.useEffect(()=>{if(C.length===0)return;const k=new Map;C.forEach((A,P)=>{k.set(A.user_id,P)});const g=new Set;if(k.forEach((A,P)=>{const O=re.current.get(P);O!==void 0&&O!==A&&g.add(P)}),re.current=k,g.size>0){Qe(g);const A=setTimeout(()=>{Qe(new Set)},2e3);return()=>clearTimeout(A)}},[C.map(k=>`${k.user_id}-${k.score}-${k.unicorns}`).join(",")]);let _=!1,T=!1,q=!1,ee=!1;if(m&&o===(Ce??1)){const k=pe;if(k.length>0&&(_=k.every(A=>{const P=ve[A.fixture_index];return P&&P.status==="FINISHED"}),T=!!k.find(A=>{const P=ve[A.fixture_index];return P&&(P.status==="IN_PLAY"||P.status==="PAUSED")}),ee=k.some(A=>{const P=ve[A.fixture_index];return P&&(P.status==="IN_PLAY"||P.status==="PAUSED"||P.status==="FINISHED")}),!_)){const A=new Date;q=k.some(P=>{if(!P.kickoff_time)return!1;const K=new Date(P.kickoff_time).getTime()-A.getTime(),ce=ve[P.fixture_index];return(!ce||ce.status!=="IN_PLAY"&&ce.status!=="PAUSED"&&ce.status!=="FINISHED")&&K>0&&K<=1440*60*1e3})}}else{const k=pe.filter(g=>g.gw===o);if(k.length>0){const g=k.every(P=>d.has(P.fixture_index)),A=k.some(P=>{const O=ve[P.fixture_index];return O&&(O.status==="IN_PLAY"||O.status==="PAUSED")});_=g&&!A}}return e.jsxs("div",{children:[e.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),C.length>0&&_&&e.jsx(Ta,{winnerName:C[0].name,isDraw:C[0].score===C[1]?.score&&C[0].unicorns===C[1]?.unicorns}),e.jsx($a,{rows:C,members:j,currentUserId:c?.id,positionChangeKeys:ze,isApiTestLeague:m,hasLiveFixtures:T,hasStartingSoonFixtures:q,hasStartedFixtures:ee,allFixturesFinished:_,resGw:o}),F.length>1&&e.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[e.jsx(Ma,{availableGws:F,selectedGw:o,onChange:k=>{Se.current=!0,b(k)}}),e.jsxs("button",{onClick:()=>it(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e.jsx(xs,{isOpen:kt,onClose:()=>it(!1),title:"Weekly Winner",description:`ðŸ† How to Win the Week

The player with the most correct predictions wins.

ðŸ¦„ Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return J?e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:e.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Loadingâ€¦"})}):!a&&!J?e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:e.jsxs("div",{className:"rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-6",children:[e.jsx("div",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"League not found"}),e.jsx(hs,{to:"/leagues",className:"text-slate-600 dark:text-slate-400 underline",children:"Back to Mini Leagues"})]})}):a?e.jsxs("div",{className:`${L?"oldschool-theme":"bg-slate-50 dark:bg-slate-900"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[e.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),e.jsx("div",{ref:ye,className:"league-header-fixed bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx(hs,{to:"/leagues",className:"flex items-center text-slate-600 dark:text-slate-400 -ml-2 px-2 py-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[e.jsx("button",{type:"button",onClick:()=>{W(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 flex-shrink-0 relative cursor-pointer",children:a?e.jsx("img",{src:Bt(a),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:s=>{const n=s.target,d=`/assets/league-avatars/${gs(a.id)}`;n.src!==d&&(n.src=d)}}):e.jsx("div",{className:"w-full h-full bg-slate-200"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 truncate",children:a.name}),h&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Gameweek ",h]})]})]}),e.jsx("div",{className:"relative",style:{zIndex:100},children:e.jsx("button",{onClick:()=>Ye(!ht),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),e.jsx("div",{className:`bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out overflow-hidden ${ht?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-4 py-3",children:[Qt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 dark:border-slate-700 px-0",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Admin"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800 dark:text-white",children:As})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("button",{onClick:()=>{Pe(!0),Ye(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsxs("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Manage"})]})}),e.jsx("div",{className:"my-3 border-b border-slate-200 dark:border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[Ie&&e.jsxs("button",{onClick:()=>{Fe(!0),Ye(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Edit League Badge"})]}),e.jsxs("button",{onClick:async()=>{Ye(!1),await cs()},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Invite players"})]}),e.jsxs("button",{onClick:()=>{Ds(),Ye(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{children:"Share league code"})]}),e.jsxs("button",{onClick:()=>{V(!0),Ye(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-red-600 dark:text-red-400 active:bg-red-100 dark:active:bg-red-900/30 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Leave"})]})]})]})}),e.jsxs("div",{className:`flex border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 gap-2 transition-all duration-300 ease-in-out ${ht?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[e.jsxs("button",{onClick:()=>{me.current=!0,Z("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="chat"?"text-[#1C8376]":"text-slate-400 dark:text-slate-500"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Chat"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),v==="chat"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(F.length>0||a?.name==="API Test")&&e.jsxs("button",{onClick:()=>{me.current=!0,Z("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(v==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const s=It!=null&&Js==="LIVE";return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),v==="gwr"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(N||a?.name==="API Test")&&e.jsxs("button",{onClick:()=>{me.current=!0,Z("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="gw"?"text-[#1C8376]":"text-slate-400"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),v==="gw"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),e.jsxs("button",{onClick:()=>{me.current=!0,Z("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",v==="mlt"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),v==="chat"?e.jsx("div",{className:"chat-tab-wrapper",children:e.jsx(Ra,{miniLeagueId:a?.id??null,memberNames:Is,deepLinkError:ue})}):e.jsx("div",{className:`league-content-wrapper ${ht?"menu-open":""}`,children:e.jsxs("div",{className:"px-1 sm:px-2",children:[v==="mlt"&&(()=>{const s=performance.now();console.log("[League] Rendering MltTab, tab is mlt",{tab:v,mltRowsLength:_e.length,leagueId:a?.id,timestamp:s});const n=e.jsx(Qs,{}),o=performance.now();return console.log("[League] MltTab JSX created",{duration:o-s}),n})(),v==="gw"&&e.jsx(ea,{}),v==="gwr"&&e.jsx(ta,{})]})}),Qt&&wt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>Pe(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>Pe(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-6 pt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900 mb-6",children:"League Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),e.jsxs("div",{className:"space-y-2",children:[j.filter(s=>s.id!==c?.id).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-800",children:s.name}),e.jsx("button",{onClick:()=>{Yt(s),Nt(!0),Pe(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-semibold",children:"Remove"})]},s.id)),j.filter(s=>s.id!==c?.id).length===0&&e.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:()=>{St(!0),Pe(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2",children:"ðŸ—‘ï¸ End League"})})]})]})]})}),Ie&&Ue&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Fe(!1),Me&&URL.revokeObjectURL(Me),Ve(null),Ee(null),He(!1),tt(null)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>{Fe(!1),Me&&URL.revokeObjectURL(Me),Ve(null),Ee(null),He(!1),tt(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-4 pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-1",children:"League Badge"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Upload and customize your mini-league badge"}),Be?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsx("p",{className:"font-medium",children:"Position your image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),e.jsx("div",{className:"relative w-full",style:{height:"280px"},children:e.jsx(ma,{image:Be,crop:Ls,zoom:vt,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Vt,onZoomChange:jt,onCropComplete:Os,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(vt*100),"%"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:vt,onChange:s=>jt(Number(s.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Me?e.jsx("img",{src:Me,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),dt&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:dt}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{Me&&URL.revokeObjectURL(Me),Ve(null),Vt({x:0,y:0}),jt(1),Kt(null),tt(null)},disabled:Te,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),e.jsx("button",{onClick:Hs,disabled:Te||!ut,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:Te?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:e.jsx("img",{src:a?Bt(a):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:s=>{const n=s.target;n.src="/assets/league-avatars/ML-avatar-1.png"}})}),a?.avatar&&e.jsx("button",{onClick:Ws,disabled:Te,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:s=>{const n=s.target.files?.[0];n&&Gs(n)},disabled:Te,className:"hidden",id:"badge-upload-input"}),e.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),Te&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),e.jsx("span",{children:"Processing and uploading..."})]}),Cs&&e.jsx("div",{className:"p-2 bg-emerald-50 border border-emerald-200 rounded-lg text-xs text-emerald-800",children:"âœ“ Badge uploaded successfully!"}),dt&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:dt})]})]})]})]})}),e.jsx(xs,{isOpen:Jt,onClose:()=>Je(!1),title:"League Points",description:`Win the week â€“ 3 points
Draw â€“ 1 point
Lose â€“ 0 points

ðŸ¤ Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${a&&(["The Bird league"].includes(a.name)||["gregVjofVcarl","Let Down"].includes(a.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),e.jsx(Zs,{}),e.jsx(Xs,{}),ie&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',a?.name,`"? You'll need the league code to rejoin later.`]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>V(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:D,children:"Cancel"}),e.jsx("button",{onClick:$s,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:D,children:D?"Leaving...":"Leave League"})]})]})}),Es&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",e.jsxs("strong",{children:['"',a?.name,'"']}),". Are you sure?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>rt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:_t,children:"Cancel"}),e.jsx("button",{onClick:Ps,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:_t,children:_t?"Joining...":"Join League"})]})]})}),Rs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",e.jsxs("strong",{children:['"',gt?.name,'"']})," from the league? They will need the league code to rejoin."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Nt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Ct,children:"Cancel"}),e.jsx("button",{onClick:Us,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Ct,children:Ct?"Removing...":"Remove Member"})]})]})}),Ts&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"âš ï¸ End League"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",e.jsx("strong",{children:"permanently end"})," the league ",e.jsxs("strong",{children:['"',a?.name,'"']}),"?"]}),e.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>St(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Lt,children:"Cancel"}),e.jsx("button",{onClick:Fs,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Lt,children:Lt?"Ending...":"Yes, End League"})]})]})}),a?.name==="API Test"&&e.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),M&&a&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>W(!1),children:e.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:e.jsx("img",{src:Bt(a),alt:"League badge",className:"w-full h-full object-cover",onError:s=>{const n=s.target,d=`/assets/league-avatars/${gs(a.id)}`;n.src!==d&&(n.src=d)}})}),Ie&&e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),W(!1),Fe(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:e.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("div",{className:"text-white text-xl font-medium",children:a.name})]})})]}):null}export{qa as default};
