import{r as a,s as _s,C as Ns,a as $,l as Ft,g as ye,_ as us,i as qt,j as e,V as aa,U as tt,b as ct,u as Ss,c as Cs,d as ra,e as ms,T as fs,D as na,f as oa,h as ia,k as la,m as ca,n as Bt,o as hs,p as et,q as da,t as ua,L as gs,v as Gt,w as xs,I as ps,x as bs,y as ws}from"./index-BqmmRUt7.js";import{C as ma}from"./index.module-BFczj-HA.js";const je=[];for(let t=0;t<256;++t)je.push((t+256).toString(16).slice(1));function fa(t,c=0){return(je[t[c+0]]+je[t[c+1]]+je[t[c+2]]+je[t[c+3]]+"-"+je[t[c+4]]+je[t[c+5]]+"-"+je[t[c+6]]+je[t[c+7]]+"-"+je[t[c+8]]+je[t[c+9]]+"-"+je[t[c+10]]+je[t[c+11]]+je[t[c+12]]+je[t[c+13]]+je[t[c+14]]+je[t[c+15]]).toLowerCase()}let Ht;const ha=new Uint8Array(16);function ga(){if(!Ht){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ht=crypto.getRandomValues.bind(crypto)}return Ht(ha)}const xa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ys={randomUUID:xa};function pa(t,c,p){t=t||{};const u=t.random??t.rng?.()??ga();if(u.length<16)throw new Error("Random bytes length must be >= 16");return u[6]=u[6]&15|64,u[8]=u[8]&63|128,fa(u)}function ba(t,c,p){return ys.randomUUID&&!t?ys.randomUUID():pa(t)}const Wt=50,vt=t=>{let c=null;if(t.reply_to){const p=Array.isArray(t.reply_to)?t.reply_to[0]:t.reply_to;p&&p.id&&p.user_id&&(c={id:p.id,content:p.content||"",user_id:p.user_id,author_name:p.author_name})}return{id:t.id,league_id:t.league_id,user_id:t.user_id,content:t.content,created_at:t.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:t.reply_to_message_id??null,reply_to:c}},Ve=t=>{const c=new Set,p=[];for(const u of t)c.has(u.id)||(c.add(u.id),p.push(u));return p.sort((u,n)=>new Date(u.created_at).getTime()-new Date(n.created_at).getTime())};function wa(t,c={}){const{userId:p,enabled:u=!0,autoSubscribe:n=!0}=c,A=()=>!t||!u?[]:ye(`chat:messages:${t}`)||[],[L,G]=a.useState(A),[r,B]=a.useState(!1),[R,H]=a.useState(!1),[re,b]=a.useState(!0),[S,V]=a.useState(null),te=a.useRef(null),oe=a.useRef(null),k=a.useRef(L),de=a.useRef("idle"),O=a.useRef(p);a.useEffect(()=>{O.current=p},[p]);const U=a.useCallback(me=>{G(se=>{const I=me(se);if(k.current=I,te.current=I.length?I[0].created_at:null,oe.current=I.length?I[I.length-1].created_at:null,t&&I.length>0){const Q=I.filter(fe=>!fe.id.startsWith("optimistic-"));if(Q.length>0){const fe=`chat:messages:${t}`;_s(fe,Q,Ns.HOME)}}return I})},[t]),z=a.useRef(null),he=a.useRef(null);a.useEffect(()=>{k.current=L},[L]);const ve=a.useCallback(async({before:me,append:se})=>{if(!t||!u)return;const I=$.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).eq("league_id",t).order("created_at",{ascending:!1}).limit(Wt);me&&I.lt("created_at",me);const{data:Q,error:fe}=await I;if(Ft("useMiniLeagueChat","Fetch messages page","league_messages",{data:Q,error:fe},{leagueId:t,before:me,pageSize:Wt}),fe)throw console.error("[useMiniLeagueChat] Error fetching messages:",fe),fe;const N=(Q??[]).filter(d=>d.reply_to_message_id),ge=[...new Set(N.map(d=>d.reply_to_message_id))];let E=new Map;if(!N.some(d=>d.reply_to&&!Array.isArray(d.reply_to))&&ge.length>0){const{data:d,error:g}=await $.from("league_messages").select("id, content, user_id").in("id",ge);Ft("useMiniLeagueChat","Fetch reply messages","league_messages",{data:d,error:g},{leagueId:t,replyMessageIds:ge.length}),g?console.error("[useMiniLeagueChat] Error fetching reply messages:",g):d&&d.forEach(Y=>{E.set(Y.id,Y)})}const i=(Q??[]).map(d=>{if(d.reply_to_message_id)if(d.reply_to&&!Array.isArray(d.reply_to))d.reply_to=d.reply_to;else{const g=E.get(d.reply_to_message_id);d.reply_to=g||null}else d.reply_to=null;return vt(d)}).reverse();U(d=>Ve(se?[...i,...d]:[...d,...i])),(Q??[]).length<Wt?b(!1):se||b(!0)},[t,u,U]),le=a.useCallback(async(me=!1)=>{if(!t||!u){G([]),b(!0);return}const se=k.current.length>0;se||B(!0),V(null);try{if(!se&&!me){const I=ye(`chat:messages:${t}`);I&&I.length>0&&(U(()=>I),I.length>0&&(te.current=I[0].created_at,oe.current=I[I.length-1].created_at),b(I.length>=50),B(!1))}await ve({append:!1})}catch(I){const{getUserFriendlyMessage:Q}=await us(async()=>{const{getUserFriendlyMessage:fe}=await import("./chatErrors-CWrmdYXz.js");return{getUserFriendlyMessage:fe}},[]);console.error("[useMiniLeagueChat] Error in refresh:",I),V(Q(I,"refresh"))}finally{se||B(!1)}},[t,u,ve,U]);a.useEffect(()=>{z.current=le,he.current=U},[le,U]);const Ne=a.useRef(null);a.useEffect(()=>{const me=Date.now(),se={miniLeagueId:t,enabled:u,autoSubscribe:n,userId:O.current},I=Ne.current;let Q=[];I?(I.miniLeagueId!==t&&Q.push(`miniLeagueId: "${I.miniLeagueId}" â†’ "${t}"`),I.enabled!==u&&Q.push(`enabled: ${I.enabled} â†’ ${u}`),I.autoSubscribe!==n&&Q.push(`autoSubscribe: ${I.autoSubscribe} â†’ ${n}`)):Q.push("initial mount"),Ne.current={miniLeagueId:t,enabled:u,autoSubscribe:n};try{const E=localStorage.getItem("message_subscription_logs"),q=E?JSON.parse(E):[];q.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_MOUNT",channel:`league-messages:${t}`,dependencies:se,effectId:me,changedFields:Q,reason:Q.length>0?`Subscription effect mounted - changed: ${Q.join(", ")}`:"Subscription effect mounted"});const i=q.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(i))}catch(E){console.error("[useMiniLeagueChat] Failed to log effect mount:",E)}if(!t||!u||!n){try{const E=localStorage.getItem("message_subscription_logs"),q=E?JSON.parse(E):[];q.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_SKIP",channel:`league-messages:${t}`,dependencies:se,effectId:me,reason:`Skipped: miniLeagueId=${!!t}, enabled=${u}, autoSubscribe=${n}`});const i=q.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(i))}catch{}return}let fe=!0,N=null,ge=null;return de.current="subscribing",ge=$.channel(`league-messages:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${t}`},async E=>{if(fe&&E.new.user_id!==O.current)try{const q=E.new;if(q.reply_to_message_id){const{data:d}=await $.from("league_messages").select("id, content, user_id").eq("id",q.reply_to_message_id).single();d?q.reply_to=d:q.reply_to=null}else q.reply_to=null;const i=vt(q);he.current?.(d=>d.some(g=>g.id===i.id)?d:Ve([...d,i]))}catch(q){console.error("[useMiniLeagueChat] Error processing real-time message:",q);try{const i=vt(E.new);he.current?.(d=>d.some(g=>g.id===i.id)?d:Ve([...d,i]))}catch(i){console.error("[useMiniLeagueChat] Fallback also failed:",i)}}}).subscribe(E=>{de.current=E==="SUBSCRIBED"?"subscribed":E==="CHANNEL_ERROR"||E==="TIMED_OUT"?"failed":"idle";try{const q=localStorage.getItem("message_subscription_logs"),i=q?JSON.parse(q):[];i.push({timestamp:Date.now(),leagueId:t,status:E,channel:`league-messages:${t}`});const d=i.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(d))}catch(q){console.error("[useMiniLeagueChat] Failed to log subscription status:",q)}E==="SUBSCRIBED"?N&&(clearTimeout(N),N=null):(E==="CHANNEL_ERROR"||E==="TIMED_OUT")&&(N&&clearTimeout(N),N=setTimeout(()=>{fe&&de.current!=="subscribed"&&(console.warn("[useMiniLeagueChat] Subscription failed, triggering safety refresh"),z.current?.(!1).catch(()=>{}))},2e3))}),()=>{try{const E=localStorage.getItem("message_subscription_logs"),q=E?JSON.parse(E):[];q.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_UNMOUNT",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:u,autoSubscribe:n,userId:O.current},effectId:me,reason:"Subscription effect unmounting (cleanup)"});const i=q.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(i))}catch(E){console.error("[useMiniLeagueChat] Failed to log effect unmount:",E)}if(fe=!1,N&&clearTimeout(N),ge){$.removeChannel(ge);try{const E=localStorage.getItem("message_subscription_logs"),q=E?JSON.parse(E):[];q.push({timestamp:Date.now(),leagueId:t,status:"CLOSED",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:u,autoSubscribe:n,userId:O.current},effectId:me,reason:"Channel removed in cleanup"});const i=q.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(i))}catch{}}}},[t,u,n]),a.useEffect(()=>{if(!t||!u){G([]),b(!0);return}if(typeof window<"u"&&new URLSearchParams(window.location.search).get("tab")==="chat"){z.current?.(!0).catch(()=>{});return}const se=k.current,I=ye(`chat:messages:${t}`);se.length>0?(se.length>0&&(te.current=se[0].created_at,oe.current=se[se.length-1].created_at,b(se.length>=50)),z.current?.(!1).catch(()=>{})):I&&I.length>0?(U(()=>I),I.length>0&&(te.current=I[0].created_at,oe.current=I[I.length-1].created_at),b(I.length>=50),z.current?.(!1).catch(()=>{})):z.current?.(!1).catch(()=>{})},[t,u]);const ke=a.useCallback(async()=>{if(!t||!u||!re||R)return;const me=te.current??L[0]?.created_at;if(me){H(!0);try{await ve({before:me,append:!0})}catch(se){console.error("[useMiniLeagueChat] Error loading more messages:",se),V(se?.message??"Failed to load more messages")}finally{H(!1)}}},[t,u,re,R,ve,L]),Pe=a.useCallback(async(me,se)=>{if(!t||!p)throw new Error("Missing league or user");const I=me.trim();if(!I)return;const Q=ba(),fe=`optimistic-${Q}`,N={id:fe,client_msg_id:Q,league_id:t,user_id:p,content:I,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:se??null};U(q=>Ve([...q,N]));const{data:ge,error:E}=await $.from("league_messages").insert({league_id:t,user_id:p,content:I,reply_to_message_id:se??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).single();if(Ft("useMiniLeagueChat","Insert message","league_messages",{data:ge,error:E},{leagueId:t,userId:p,hasReplyTo:!!se}),E){const{handleChatError:q}=await us(async()=>{const{handleChatError:d}=await import("./chatErrors-CWrmdYXz.js");return{handleChatError:d}},[]),i=q(E,"sendMessage");throw console.error("[useMiniLeagueChat] Error sending message:",E),U(d=>d.map(g=>g.id===fe?{...g,status:"error"}:g)),new Error(i.message)}if(ge){if(ge.reply_to_message_id&&(!ge.reply_to||Array.isArray(ge.reply_to))){const{data:i}=await $.from("league_messages").select("id, content, user_id").eq("id",ge.reply_to_message_id).single();i?ge.reply_to=i:ge.reply_to=null}const q=vt(ge);q.client_msg_id=Q,q.status="sent",U(i=>{const d=i.findIndex(g=>g.id===fe||g.client_msg_id===Q&&g.id.startsWith("optimistic-"));if(d>=0){const g=[...i];return g[d]=q,Ve(g)}else return i.some(g=>g.id===q.id)?i:Ve([...i,q])})}},[t,p,U]),Me=a.useMemo(()=>L.slice(-5),[L]);return{messages:L,previewMessages:Me,loading:r,loadingMore:R,hasMore:re,error:S,refresh:le,loadMore:ke,sendMessage:Pe}}function ya({leagueId:t,userId:c,enabled:p=!0,containerRef:u}){const n=a.useRef(0),A=a.useRef(null),L=2e3,G=a.useCallback(async()=>{if(!t||!c||!p)return;const r=Date.now();if(r-n.current<L){A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{G()},L-(r-n.current));return}n.current=r;try{const B=new Date().toISOString(),{error:R}=await $.from("league_message_reads").upsert({league_id:t,user_id:c,last_read_at:B},{onConflict:"league_id,user_id"});if(R){console.error("[useMarkMessagesRead] Error upserting last_read_at:",R);return}console.debug("[useMarkMessagesRead] Invalidating cache before marking as read",{leagueId:t,userId:c.slice(0,8),lastReadAt:B});let H=null;try{H=ye(`leagues:unread:${c}`)}catch{}qt(c),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:t,userId:c}})),console.debug("[useMarkMessagesRead] Marked messages as read and invalidated cache",{leagueId:t,userId:c.slice(0,8),lastReadAt:B,cachedUnreadBefore:H,eventDispatched:!0})}catch(B){console.error("[useMarkMessagesRead] Error marking messages as read:",B)}},[t,c,p]);return a.useEffect(()=>{if(!p||!t||!c||!u.current)return;const r=u.current,B=new IntersectionObserver(H=>{H[0]?.isIntersecting&&r.querySelectorAll("[data-message-id]").length>0&&G()},{root:null,rootMargin:"0px",threshold:.1});B.observe(r);const R=()=>{r.scrollTop>0&&G()};return r.addEventListener("scroll",R,{passive:!0}),()=>{B.disconnect(),r.removeEventListener("scroll",R),A.current&&clearTimeout(A.current)}},[p,t,c,u,G]),{markAsRead:G}}const va={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},ka={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},ja=["ðŸ‘","â¤ï¸","ðŸ˜‚"],_a=["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ¤¡","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸŽƒ","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾"];function Na({author:t,text:c,time:p,isOwnMessage:u,shape:n="single",messageId:A,reactions:L=[],onReactionClick:G,replyTo:r,onMessageClick:B}){const R="text-left",H=u?"bg-[#1C8376] text-white":"bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",re=u?ka:va,b="max-w-[85%]",[S,V]=a.useState(!1),[te,oe]=a.useState(!1),k=a.useRef(null);a.useEffect(()=>{if(!S)return;const U=he=>{k.current&&!k.current.contains(he.target)&&V(!1)},z=setTimeout(()=>{document.addEventListener("mousedown",U)},100);return()=>{clearTimeout(z),document.removeEventListener("mousedown",U)}},[S]);const de=U=>{A&&G&&G(A,U),V(!1),oe(!1)},O=U=>{const z=U.target;z.closest("button")||z.closest("[data-reaction]")||B&&B()};return e.jsxs("div",{className:`inline-block ${b} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},"data-message-id":A,children:[e.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${R} ${H} ${re[n]} ${B?"cursor-pointer":""}`,onClick:O,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[t&&!u&&e.jsx("div",{className:"text-xs font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:t}),r&&e.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${u?"border-white/30 text-white/90":"border-[#1C8376] dark:border-emerald-400 text-slate-600 dark:text-slate-300"} pl-2 text-xs dark:text-slate-300`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[e.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.authorName||"Unknown"}),e.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:r.content})]}),e.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[e.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:c}),e.jsx("span",{className:`text-xs relative top-1 ${u?"text-[#DCDCDD]":"text-slate-400 dark:text-slate-500"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:p})]})]}),A&&!u&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[S&&e.jsxs("div",{ref:k,className:"flex items-center gap-1 bg-white dark:bg-slate-800 rounded-full px-1 py-1 shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[ja.map(U=>e.jsx("button",{onClick:()=>de(U),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${U}`,children:U},U)),B&&e.jsx("button",{onClick:()=>{V(!1),B()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:()=>{V(!1),oe(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:e.jsx("span",{className:"text-sm",children:"+"})})]}),e.jsx("button",{onClick:()=>V(!S),className:"w-7 h-7 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 flex items-center justify-center shadow-sm",title:"Add reaction",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),te&&A&&!u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>oe(!1)}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-800 rounded-t-2xl shadow-2xl border-t border-slate-200 dark:border-slate-700 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:e.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"}),e.jsx("button",{onClick:()=>oe(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 rounded-lg",children:"Close"}),e.jsx("div",{className:"w-12"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:_a.map(U=>e.jsx("button",{onClick:()=>{A&&G&&G(A,U),oe(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 dark:active:bg-slate-700 flex items-center justify-center text-2xl",title:U,children:U},U))})]})})]}),L.length>0&&e.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${u?"justify-end":"justify-start"}`,children:L.map(U=>e.jsxs("button",{onClick:()=>de(U.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${U.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200"}`,children:[e.jsx("span",{className:"text-base",children:U.emoji}),e.jsx("span",{children:U.count})]},U.emoji))})]})}function Sa({author:t,messages:c,isOwnMessage:p,avatarInitials:u,userId:n,reactions:A,onReactionClick:L,onMessageClick:G}){const r=p?"justify-end":"justify-start",B=n===ct;return e.jsxs("div",{className:`flex items-end gap-2 w-full ${r}`,children:[p?e.jsx("div",{className:"w-8 flex-shrink-0"}):B?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 dark:border-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:aa,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):n?e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:n,name:t,size:32,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-xs font-semibold text-slate-500 dark:text-slate-400 flex-shrink-0",children:(u||t.charAt(0)).toUpperCase()}),e.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:c.map((R,H)=>{const re=c.length===1?"single":H===0?"top":H===c.length-1?"bottom":"middle",b=R.messageId||R.id;let S="";if(typeof R.text=="string")S=R.text;else if(typeof R.text=="object"&&R.text!==null){const V=R.text?.props?.children||String(R.text);S=typeof V=="string"?V:String(V)}else S=String(R.text);return e.jsx("div",{className:`flex flex-col w-full min-w-0 ${p?"items-end":"items-start"}`,children:e.jsxs("div",{className:`flex w-full min-w-0 ${p?"justify-end":"justify-start"}`,children:[e.jsx(Na,{author:!p&&H===0?t:void 0,text:R.text,time:R.time,isOwnMessage:p,shape:re,messageId:b,reactions:A?.[b]||[],onReactionClick:L,replyTo:R.replyTo,onMessageClick:G?()=>G(b,S,!p&&H===0?t:void 0):void 0}),R.status&&e.jsx("div",{className:`text-xs ml-2 ${R.status==="error"?"text-red-500":"text-slate-400 dark:text-slate-500"}`,children:R.status==="error"?"Failed":"Sendingâ€¦"})]})},R.id)})})]})}function Ca({groups:t,reactions:c,onReactionClick:p,onMessageClick:u}){return e.jsx("div",{className:"flex flex-col gap-5",children:t.map((n,A)=>e.jsxs("div",{className:"flex flex-col gap-3",children:[n.dayLabel&&e.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:n.dayLabel}),e.jsx(Sa,{author:n.author,avatarInitials:n.avatarInitials,isOwnMessage:n.isOwnMessage,userId:n.userId,messages:n.messages,reactions:c,onReactionClick:p,onMessageClick:u},`${n.id}-${n.author}-${A}`)]},`${n.id}-${n.author}-${A}`))})}const La=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ea=t=>new Date(t).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),vs=t=>{if(!t)return"?";const c=t.trim().split(/\s+/);return c.length===1?c[0][0]?.toUpperCase()??"?":`${c[0][0]?.toUpperCase()??""}${c[c.length-1][0]?.toUpperCase()??""}`},Ke=(t,c,p)=>{if(t===ct)return Cs;if(c)if(c instanceof Map){const u=c.get(t);if(u)return u}else{const u=c[t];if(u)return u}if(p){const u=p.get(t);if(u)return u}return""};function Ra({miniLeagueId:t,memberNames:c,deepLinkError:p}){const{user:u}=Ss(),{messages:n,error:A,sendMessage:L}=wa(t,{userId:u?.id,enabled:!!t}),[G,r]=a.useState(""),[B,R]=a.useState(!1),[H,re]=a.useState({}),[b,S]=a.useState(null),[V,te]=a.useState([]),[oe,k]=a.useState(new Map),de=a.useRef(new Set),O=a.useRef(null),{markAsRead:U}=ya({leagueId:t??null,userId:u?.id??null,enabled:!!(t&&u?.id),containerRef:O});a.useEffect(()=>{t&&u?.id&&n.length>0&&U()},[t,u?.id,n.length,U]);const z=a.useRef(null),he=a.useRef(null),ve=a.useRef(!1),[le,Ne]=a.useState(0);a.useEffect(()=>{if(n.length===0)return;const i=[];for(const d of n){const g=d.user_id;de.current.has(g)||g===ct||Ke(g,c)||g!==u?.id&&i.push(g)}for(const d of n)if(d.reply_to?.user_id){const g=d.reply_to.user_id;if(de.current.has(g)||g===ct||Ke(g,c)||g===u?.id)continue;i.includes(g)||i.push(g)}i.length!==0&&(i.forEach(d=>de.current.add(d)),console.log("[MiniLeagueChatBeta] Fetching names for",i.length,"missing user IDs"),(async()=>{try{const{data:d,error:g}=await $.from("users").select("id, name").in("id",i);if(g){console.error("[MiniLeagueChatBeta] Error fetching user names:",g);return}d&&d.length>0&&(k(Y=>{const D=new Map(Y);for(const v of d)v.id&&v.name&&D.set(v.id,v.name);return D}),console.log("[MiniLeagueChatBeta] Fetched",d.length,"additional user names"))}catch(d){console.error("[MiniLeagueChatBeta] Error fetching user names:",d)}})())},[n,c,u?.id]),a.useEffect(()=>{if(!t||!u?.id)return;let i=!0;const d=t,g=u.id,Y=async()=>{if(i)try{const{error:X}=await $.from("chat_presence").upsert({league_id:d,user_id:g,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});X&&console.warn("[MiniLeagueChatBeta] Failed to update presence:",X)}catch(X){console.warn("[MiniLeagueChatBeta] Error updating presence:",X)}},D=async()=>{try{await $.from("chat_presence").delete().eq("league_id",d).eq("user_id",g)}catch(X){console.warn("[MiniLeagueChatBeta] Error clearing presence:",X)}};Y();const v=setInterval(()=>{i&&Y()},1e4),_=()=>{document.visibilityState==="hidden"?D():document.visibilityState==="visible"&&i&&Y()};return document.addEventListener("visibilitychange",_),()=>{i=!1,clearInterval(v),document.removeEventListener("visibilitychange",_),D()}},[t,u?.id]),a.useEffect(()=>{ve.current=!1},[t]);const ke=a.useCallback(()=>{if(O.current){const i=O.current.scrollHeight-O.current.clientHeight;O.current.scrollTop=i}},[]);a.useEffect(()=>{if(n.length===0||!u?.id)return;const i=n.map(g=>g.id).filter(g=>!g.startsWith("optimistic-"));if(i.length===0)return;(async()=>{try{const{data:g,error:Y}=await $.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",i);if(Y){te(_=>[..._,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${Y.message}`,timestamp:Date.now()}]);return}const D={};(g||[]).forEach(_=>{D[_.message_id]||(D[_.message_id]={}),D[_.message_id][_.emoji]||(D[_.message_id][_.emoji]={count:0,hasUserReacted:!1}),D[_.message_id][_.emoji].count++,_.user_id===u.id&&(D[_.message_id][_.emoji].hasUserReacted=!0)});const v={};Object.keys(D).forEach(_=>{v[_]=Object.entries(D[_]).map(([X,J])=>({emoji:X,count:J.count,hasUserReacted:J.hasUserReacted}))}),re(v)}catch(g){te(Y=>[...Y,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${g?.message||String(g)}`,timestamp:Date.now()}])}})()},[n,u?.id]),a.useEffect(()=>{if(n.length===0||!u?.id)return;const i=n.map(g=>g.id).filter(g=>!g.startsWith("optimistic-"));if(i.length===0)return;const d=$.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},async()=>{try{const{data:g,error:Y}=await $.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",i);if(Y)return;const D={};(g||[]).forEach(_=>{D[_.message_id]||(D[_.message_id]={}),D[_.message_id][_.emoji]||(D[_.message_id][_.emoji]={count:0,hasUserReacted:!1}),D[_.message_id][_.emoji].count++,_.user_id===u.id&&(D[_.message_id][_.emoji].hasUserReacted=!0)});const v={};Object.keys(D).forEach(_=>{v[_]=Object.entries(D[_]).map(([X,J])=>({emoji:X,count:J.count,hasUserReacted:J.hasUserReacted}))}),re(v)}catch{}}).subscribe();return()=>{$.removeChannel(d)}},[n,u?.id]);const Pe=a.useCallback(async(i,d)=>{if(!u?.id)return;const Y=(H[i]||[]).find(D=>D.emoji===d&&D.hasUserReacted);if(re(D=>{const v={...D},_=v[i]||[];if(Y){const X=_.map(J=>J.emoji===d?{...J,count:Math.max(0,J.count-1),hasUserReacted:!1}:J).filter(J=>J.count>0||J.emoji!==d);X.length===0?delete v[i]:v[i]=X}else _.find(J=>J.emoji===d)?v[i]=_.map(J=>J.emoji===d?{...J,count:J.count+1,hasUserReacted:!0}:J):v[i]=[..._,{emoji:d,count:1,hasUserReacted:!0}];return v}),Y){const{error:D}=await $.from("league_message_reactions").delete().eq("message_id",i).eq("user_id",u.id).eq("emoji",d);D&&re(v=>{const _={...v},X=_[i]||[];return X.find(ee=>ee.emoji===d)?_[i]=X.map(ee=>ee.emoji===d?{...ee,count:ee.count+1,hasUserReacted:!0}:ee):_[i]=[...X,{emoji:d,count:1,hasUserReacted:!0}],_})}else{const{error:D}=await $.from("league_message_reactions").upsert({message_id:i,user_id:u.id,emoji:d});D&&re(v=>{const _={...v},J=(_[i]||[]).map(ee=>ee.emoji===d?{...ee,count:Math.max(0,ee.count-1),hasUserReacted:!1}:ee).filter(ee=>ee.count>0||ee.emoji!==d);return J.length===0?delete _[i]:_[i]=J,_})}},[u?.id,H]);a.useEffect(()=>{!G&&z.current&&(z.current.style.height="auto",z.current.style.height="42px")},[G]);const Me=a.useCallback(i=>{const d=he.current?.offsetHeight||72;if(i>0){const g=i+d;if(Ne(i),O.current){const Y=`${g+8}px`;O.current.style.paddingBottom=Y}}else if(Ne(0),O.current){const g=`${d+8}px`;O.current.style.paddingBottom=g}requestAnimationFrame(()=>{ke()})},[ke]);a.useEffect(()=>{const i=window.visualViewport;if(!i)return;let d=null,g=0,Y=!1;setTimeout(()=>{Y=!0},500);const D=()=>{const ee=window.innerHeight,Be=i.height,dt=i.offsetTop+Be;return Math.max(0,ee-dt)},v=()=>{d&&clearTimeout(d),d=setTimeout(()=>{const ee=D();Y&&Math.abs(ee-g)>10&&(g=ee,Me(ee))},50)};i.addEventListener("resize",v),i.addEventListener("scroll",v),window.addEventListener("resize",v);const _=()=>{setTimeout(v,50)},X=()=>{setTimeout(v,100)},J=setTimeout(()=>{z.current&&(z.current.addEventListener("focus",_),z.current.addEventListener("blur",X))},100);return v(),()=>{d&&clearTimeout(d),clearTimeout(J),i.removeEventListener("resize",v),i.removeEventListener("scroll",v),window.removeEventListener("resize",v),z.current&&(z.current.removeEventListener("focus",_),z.current.removeEventListener("blur",X))}},[Me]),a.useEffect(()=>{if(O.current&&he.current){const d=`${(he.current.offsetHeight||72)+8}px`;O.current.style.paddingBottom=d}},[]);const me=()=>{z.current&&z.current.removeAttribute("readonly");const i=()=>{const d=window.visualViewport;if(d){const g=window.innerHeight,Y=d.height,D=d.offsetTop+Y,v=Math.max(0,g-D);Me(v)}};setTimeout(i,50),setTimeout(i,150),ke()},se=i=>{const d=i.target;!(d.tagName==="A"||d.tagName==="BUTTON"||d.closest("a, button"))&&z.current&&document.activeElement===z.current&&z.current.blur()},I=a.useMemo(()=>{if(!u)return"";const i=u.user_metadata??{};return i.display_name||i.full_name||u.email||""},[u]),Q=a.useMemo(()=>{if(!n.length)return[];const i=c instanceof Map?c.size>0:c?Object.keys(c).length>0:!1,d=oe.size>0;if(!i&&!d)return console.log("[MiniLeagueChatBeta] No names available yet, returning empty groups"),[];let g=null;return n.reduce((D,v)=>{const _=v.user_id===u?.id,ee=Ke(v.user_id,c,oe)||(_?I:"")||(_?"You":"Unknown"),Be=_?void 0:vs(ee),ut=new Date(v.created_at).toDateString(),$e=ut!==g;$e&&(g=ut);const st=v.reply_to?Ke(v.reply_to.user_id,c,oe)||"Unknown":null,mt={id:v.id,text:v.content,time:La(v.created_at),status:v.status&&v.status!=="sent"?v.status:void 0,messageId:v.id,replyTo:v.reply_to?{id:v.reply_to.id,content:v.reply_to.content,authorName:st||void 0}:null},Le=D[D.length-1],ft=Le?.messages.length>0&&Le.messages[0].messageId?n.find(Ye=>Ye.id===Le.messages[0].messageId)?.user_id:null;if(Le&&!$e&&Le.isOwnMessage===_&&ft===v.user_id){const Ye=Le.id.includes("-")?Le.id.split("-")[0]:Le.id,kt=Le.messages.map(Ce=>{const qe=Ce.messageId?n.find(Ge=>Ge.id===Ce.messageId):null;if(qe?.reply_to){const Ge=Ke(qe.reply_to.user_id,c,oe)||"Unknown";return{...Ce,replyTo:Ce.replyTo?{...Ce.replyTo,authorName:Ge}:null}}return Ce}),Oe={...Le,id:`${Ye}-${ee}`,author:ee,avatarInitials:Be,userId:v.user_id,messages:[...kt,mt]};return[...D.slice(0,-1),Oe]}else return[...D,{id:`${v.id}-${ee}`,author:ee,avatarInitials:Be,isOwnMessage:_,userId:v.user_id,dayLabel:$e?Ea(v.created_at):void 0,messages:[mt]}]},[]).map(D=>{const v={...D},_=v.messages.map(X=>{const J=X.messageId?n.find(ee=>ee.id===X.messageId):null;if(J?.reply_to&&X.replyTo){const ee=Ke(J.reply_to.user_id,c,oe)||"Unknown";if(ee!==X.replyTo.authorName)return{...X,replyTo:{...X.replyTo,authorName:ee}}}return X});if(v.author==="Unknown"&&v.messages.length>0&&v.messages[0].messageId){const X=n.find(J=>J.id===v.messages[0].messageId);if(X){const J=Ke(X.user_id,c,oe);if(J&&J!=="Unknown"){const ee=v.id.includes("-")?v.id.split("-")[0]:v.id;return{...v,id:`${ee}-${J}`,author:J,avatarInitials:vs(J),userId:X.user_id,messages:_}}}}return{...v,messages:_}})},[I,c,oe,n,u?.id]),fe=a.useMemo(()=>{const i=Q.map(g=>g.author).join(","),d=Q.some(g=>g.author==="Unknown");return`chat-${Q.length}-${d?"unknown":"resolved"}-${i.slice(0,50)}`},[Q]),N=a.useCallback(i=>{if(O.current=i,i){if(he.current){const g=`${(he.current.offsetHeight||72)+8}px`;i.style.paddingBottom=g}else i.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{i&&n.length>0&&Q.length>0})})}},[n.length,Q.length]);a.useEffect(()=>{ve.current=!1},[t]),a.useEffect(()=>{n.length>0&&O.current&&(ve.current||(ve.current=!0),requestAnimationFrame(()=>{if(O.current){const i=O.current.scrollHeight,d=O.current.clientHeight,g=i-d;i>d&&(O.current.scrollTop=g)}}))},[n.length,n]);const ge=a.useCallback(async i=>{if(!t||!u?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const g=u.user_metadata?.display_name||u.user_metadata?.full_name||u.email||"User";try{await fetch("/.netlify/functions/notifyLeagueMessageV2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:t,senderId:u.id,senderName:g,content:i,activeUserIds:[u.id]})})}catch{}},[t,u?.id]),E=a.useCallback(async()=>{const i=G.trim();if(!(!t||!i||B))try{R(!0),r(""),z.current&&(z.current.style.height="auto",z.current.style.height="42px"),await L(i,b?.id||null),await ge(i),S(null),ke()}catch(d){te(g=>[...g,{id:`send-${Date.now()}`,message:`Failed to send message: ${d?.message||String(d)}`,timestamp:Date.now()}]),r(i)}finally{R(!1)}},[G,t,ge,ke,L,B,b]);a.useEffect(()=>{p&&te(i=>i.some(d=>d.message.includes("Deep Link"))?i:[...i,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${p}`,timestamp:Date.now()}])},[p]),a.useEffect(()=>{if(V.length===0)return;const i=setTimeout(()=>{te(d=>d.filter(g=>Date.now()-g.timestamp<5e3))},5e3);return()=>clearTimeout(i)},[V]);const q=n.length>0&&Q.length>0;return e.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[V.length>0&&e.jsx("div",{className:"px-4 pt-2 space-y-2",children:V.map(i=>e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[e.jsx("span",{className:"flex-1",children:i.message}),e.jsx("button",{onClick:()=>te(d=>d.filter(g=>g.id!==i.id)),className:"text-red-600 flex-shrink-0",children:"Ã—"})]},i.id))}),e.jsx("div",{ref:N,className:"flex-1 overflow-y-auto px-4 py-5",onClick:se,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingBottom:"91px"},children:q?e.jsx(e.Fragment,{children:e.jsx(Ca,{groups:Q,reactions:H,onReactionClick:Pe,onMessageClick:(i,d,g)=>{const Y=n.find(D=>D.id===i);if(Y){let D="";if(typeof d=="string")D=d;else if(typeof d=="object"&&d!==null){const v=d?.props?.children||String(d);D=typeof v=="string"?v:String(v)}else D=String(d);S({id:i,content:D||Y.content,authorName:g}),setTimeout(()=>{z.current?.focus()},100)}}},fe)}):null}),e.jsxs("div",{ref:he,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:le>0?"fixed":"relative",bottom:le>0?`${le}px`:"0",left:le>0?0:"auto",right:le>0?0:"auto",width:"100%",maxWidth:le>0?"440px":"100%",marginLeft:le>0?"auto":void 0,marginRight:le>0?"auto":void 0,zIndex:le>0?100:"auto",boxShadow:le>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[b&&e.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",b.authorName||"Unknown"]}),e.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:b.content})]}),e.jsx("button",{onClick:()=>S(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[e.jsx("textarea",{ref:z,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:G,disabled:!t||B,placeholder:t?"Start typing a messageâ€¦":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:i=>{if(i.key==="Escape"&&b){S(null),i.preventDefault();return}i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),E())},onChange:i=>{r(i.target.value),z.current&&(z.current.style.height="auto",z.current.style.height=`${Math.min(z.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const d=window.visualViewport;if(d){const g=window.innerHeight,Y=d.height,D=d.offsetTop+Y,v=g-D;Me(v)}})},onFocus:me,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),e.jsx("button",{type:"button",onClick:E,disabled:!t||B||!G.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),A&&e.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[A," â€” try again or switch to the classic chat tab."]})]})]})}function Ma({winnerName:t,isDraw:c}){return e.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:e.jsx("div",{className:"text-center relative z-10",children:c?e.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):e.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[t," Wins!"]})})})}function Ta({availableGws:t,selectedGw:c,onChange:p,className:u=""}){return t.length<=1?null:e.jsxs("div",{className:`flex-1 ${u}`,children:[e.jsx("style",{children:`
        .gw-selector option {
          background-color: white;
          color: #64748b;
        }
        .dark .gw-selector option {
          background-color: #1e293b;
          color: #ffffff;
        }
        .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
        .dark .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
      `}),e.jsx("select",{value:c||void 0,onChange:n=>{const A=parseInt(n.target.value,10);p(A)},className:"gw-selector w-full bg-white dark:bg-slate-800 rounded-full border-2 border-slate-300 dark:border-slate-600 px-3 py-2 text-xs font-normal text-slate-600 dark:text-white text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 dark:active:bg-slate-700 transition-colors",style:{minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:t.map(n=>e.jsxs("option",{value:n,className:"text-xs",children:["Gameweek ",n]},n))})]})}function Aa({showForm:t,onToggle:c}){return e.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 dark:bg-slate-800 p-0.5 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>c(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"text-slate-600 dark:text-slate-400":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),e.jsx("button",{onClick:()=>c(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 dark:text-slate-400"}`,children:"Form"})]})}function Ia({form:t}){const c=t.slice(-5),p=5-c.length;return e.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:p}).map((u,n)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${n}`)),c.map((u,n)=>e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${u==="W"?"bg-emerald-100 text-emerald-700":u==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:u},n))]})}function Da({rows:t,members:c,showForm:p,currentUserId:u,loading:n,isLateStartingLeague:A}){return e.jsxs("div",{className:"pt-4",children:[e.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),e.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",borderBottom:"none",boxShadow:"none"},children:e.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",border:"none",borderBottom:"none"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:"Player"}),p?e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Form"}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"W"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"D"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:A?"CP":"OCP"}),c.length>=3&&e.jsx("th",{className:"py-3 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"PTS"})]})]})}),e.jsxs("tbody",{children:[t.map((L,G)=>{const r=L.user_id===u,B=G===t.length-1;return e.jsxs("tr",{className:r?"flash-user-row":"",style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...B?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:G+1}),e.jsx("td",{className:"py-4 bg-slate-50 dark:bg-slate-900 pl-0 pr-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:L.user_id,name:L.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:L.name})]})}),p?e.jsx("td",{className:"px-4 py-4 bg-slate-50 dark:bg-slate-900",children:e.jsx(Ia,{form:L.form})}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.wins}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.draws}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-10 pl-1 pr-1",children:L.ocp}),c.length>=3&&e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:L.unicorns}),e.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-10 pl-1 pr-1",children:L.mltPts})]})]},L.user_id)}),n&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:p?3:c.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"Calculatingâ€¦"})}),!n&&!t.length&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:p?3:c.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"No gameweeks completed yet â€” this will populate after the first results are saved."})})]})]})})]})}function Pa({rows:t,members:c,currentUserId:p,positionChangeKeys:u,isApiTestLeague:n,hasLiveFixtures:A,hasStartingSoonFixtures:L,hasStartedFixtures:G,allFixturesFinished:r,resGw:B}){return e.jsxs("div",{children:[e.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
        .dark .full-width-header-border::after {
          background-color: #475569;
        }
      `}),e.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 shadow-sm",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:e.jsxs("div",{className:"flex items-center gap-2",children:["Player",n&&A&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),n&&!r&&L&&!A&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-[10px] font-medium",children:G?"Next Game Starting Soon":"Starting soon"})]})]})}),e.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Score"}),c.length>=3&&e.jsx("th",{className:"py-4 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"})]})}),e.jsxs("tbody",{children:[t.map((R,H)=>{const re=R.user_id===p,b=H===t.length-1,S=u.has(R.user_id);return e.jsxs("tr",{className:`${re?"flash-user-row":""} ${S?"position-changed":""}`,style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...b?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:H+1}),e.jsx("td",{className:"py-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[n&&A&&e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),n&&!A&&L&&e.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:R.user_id,name:R.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:R.name})]})}),e.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-[50px] pl-1 pr-1 ${n&&A?"pulse-live-score":""}`,children:R.score}),c.length>=3&&e.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1 ${n&&A?"pulse-live-score":""}`,children:R.unicorns})]},R.user_id)}),!t.length&&e.jsx("tr",{className:"bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},colSpan:c.length>=3?4:3,children:["No results recorded for GW ",B," yet."]})})]})]})})]})}function $a(t){const c=ra(),p=encodeURIComponent(t);if(c){const u=`whatsapp://send?text=${p}`;let n=!1,A=!1;try{const L=document.createElement("a");L.href=u,L.style.display="none",document.body.appendChild(L),L.click(),n=!0,setTimeout(()=>{document.body.contains(L)&&document.body.removeChild(L)},100)}catch{}if(!n)try{window.open(u),A=!0}catch{}if(!n&&!A)try{window.location.href=u}catch{window.open(`https://wa.me/?text=${p}`,"_blank")}}else{const u=`https://wa.me/?text=${p}`;try{window.open(u,"_blank")}catch{navigator.clipboard.writeText(t).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+t)})}}}function Ua(t,c){const p=new Date(c.find(H=>H.gw===t)?.kickoff_time||""),u=new Date(p.getTime()-4500*1e3),n=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],A=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],L=n[u.getUTCDay()],G=u.getUTCDate(),r=A[u.getUTCMonth()],B=u.getUTCHours().toString().padStart(2,"0"),R=u.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${t} Predictions Reminder!

DEADLINE: THIS ${L} ${G} ${r}, ${B}:${R} BST

Don't forget!
playtotl.com`}function Fa(t,c){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",t);try{const p=Ua(t,c);console.log("[SubmissionStatusTable] Generated message:",p),$a(p)}catch(p){console.error("[SubmissionStatusTable] Error in handleShareReminder:",p),alert("Error sharing reminder. Please try again.")}}function ks({members:t,submittedMap:c,picksGw:p,allSubmitted:u,remaining:n,fixtures:A,onShareReminder:L,variant:G="full"}){const r=L||(()=>Fa(p,A)),B=A.map(S=>S.kickoff_time).filter(S=>!!S).map(S=>new Date(S)).filter(S=>!isNaN(S.getTime())),R=B.length>0?new Date(Math.min(...B.map(S=>S.getTime()))):null,H=R?new Date(R.getTime()-4500*1e3):null,re=H?new Date>=H:!1;let b="";if(H){const S=G==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],te=S[H.getUTCDay()],oe=H.getUTCDate(),k=V[H.getUTCMonth()],de=H.getUTCHours().toString().padStart(2,"0"),O=H.getUTCMinutes().toString().padStart(2,"0");b=`${te} ${oe} ${k}, ${de}:${O} BST`}return G==="compact"?e.jsxs("div",{className:"mt-2 pt-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:n})," of ",t.length," to submit."]})}),!u&&e.jsxs("button",{type:"button",onClick:S=>{S.preventDefault(),S.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),r()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),b&&e.jsxs("div",{className:`mb-3 text-xs font-medium ${re?"text-orange-600 dark:text-orange-400":"text-slate-600 dark:text-slate-400"} flex items-center gap-1.5`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),re?"Deadline Passed:":"Deadline:",b]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((S,V)=>S.name.localeCompare(V.name)).map(S=>{const V=`${S.id}:${p}`,te=!!c.get(V);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{userId:S.id,name:S.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:S.name})]})}),e.jsx("td",{className:"px-4 py-3",children:te?e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},S.id)})})]})})]}):e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-700 dark:text-slate-300",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{children:u?e.jsxs(e.Fragment,{children:["All ",t.length," members have submitted."]}):e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:n})," of ",t.length," to submit."]})}),!u&&e.jsxs("button",{type:"button",onClick:S=>{S.preventDefault(),S.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),r()},className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),b&&e.jsxs("div",{className:`mb-3 text-sm ${re?"text-orange-600 dark:text-orange-400 font-semibold":"text-slate-600 dark:text-slate-400"}`,children:[re?"â° Deadline Passed:":"â° Deadline:",b]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((S,V)=>S.name.localeCompare(V.name)).map(S=>{const V=`${S.id}:${p}`,te=!!c.get(V);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{userId:S.id,name:S.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:S.name})]})}),e.jsx("td",{className:"px-4 py-3",children:te?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"âœ… Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"â³ Not yet"})})]},S.id)})})]})})]})}function Ba({letter:t,userId:c,userName:p,correct:u,unicorn:n,hasSubmitted:A,isLive:L,isOngoing:G,isFinished:r}){let B;u===!0?L||G?B="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":r?B="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white relative overflow-hidden before:absolute before:inset-0 before:z-10 before:pointer-events-none before:w-[200%] before:bg-gradient-to-r before:from-transparent before:via-white/40 before:via-white/50 before:via-white/40 before:to-transparent before:animate-[shimmer_2.5s_ease-in-out_infinite] after:absolute after:inset-0 after:z-10 after:pointer-events-none after:w-[200%] after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:via-yellow-200/40 after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_3s_ease-in-out_infinite_0.5s]":B="bg-emerald-600 text-white border-emerald-600":A?B="bg-emerald-600 text-white border-emerald-600":B="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600";const R=!!c,H=R?B.replace(/\bborder-\S+/g,"").trim():B;return e.jsx("span",{className:["inline-flex items-center justify-center",R?"h-9 w-9 min-w-[36px]":"h-5 min-w-[18px]",R?"rounded-full mb-0.5":"rounded-full border mb-0.5","align-middle overflow-hidden",R?"p-0":"px-1.5 text-xs font-semibold",H].join(" "),title:n?"Correct!":p||void 0,children:R?e.jsx(tt,{userId:c,name:p,size:36,className:"border-0 relative z-0",fallbackToInitials:!0}):t})}function Ga(t,c){return t==="FINISHED"?"FT":t==="PAUSED"?"HT":t==="IN_PLAY"?c==null?"LIVE":`${c}'`:"LIVE"}function Ha(t){const c=(t||"?").trim().split(/\s+/);return c.length?c.length===1?c[0].slice(0,1).toUpperCase():(c[0][0]+c[c.length-1][0]).toUpperCase():"?"}function Wa({fixture:t,picks:c,members:p,outcome:u,liveScore:n,submittedMap:A,picksGw:L,isApiTestLeague:G=!1}){const r=t.home_code||t.home_team||t.home_name||"",B=t.away_code||t.away_team||t.away_name||"",R=ms(r)||t.home_name||t.home_team||"Home",H=ms(B)||t.away_name||t.away_team||"Away",b=(O=>{if(!O)return"";const U=new Date(O);if(isNaN(U.getTime()))return"";const z=String(U.getUTCHours()).padStart(2,"0"),he=String(U.getUTCMinutes()).padStart(2,"0");return`${z}:${he}`})(t.kickoff_time),S=!!(n&&n.status==="IN_PLAY"),V=!!(n&&(n.status==="PAUSED"||n.status==="HALF_TIME"||n.status==="HT")),te=!!(n&&n.status==="FINISHED"),oe=S||V;let k=null;G&&n?n.homeScore>n.awayScore?k="H":n.awayScore>n.homeScore?k="A":n.homeScore===n.awayScore&&(k="D"):k=u;const de=O=>{const U=c.filter(le=>le.pick===O),z=4,he=[];for(let le=0;le<U.length;le+=z){const Ne=U.slice(le,le+z);he.push(Ne)}const ve=12;return e.jsx("div",{className:"flex flex-col gap-1",children:he.map((le,Ne)=>e.jsx("div",{className:"flex items-center justify-center",children:le.map((ke,Pe)=>{const Me=p.find(Q=>Q.id===ke.user_id),me=Ha(Me?.name??"?"),se=A.has(`${ke.user_id}:${L}`),I=k&&k===O?!0:null;return e.jsx("span",{className:"inline-block",style:{marginLeft:Pe>0?`-${ve}px`:"0",position:"relative",zIndex:Pe},children:e.jsx(Ba,{letter:me,userId:ke.user_id,userName:Me?.name,correct:I,unicorn:I===!0,hasSubmitted:se,isLive:S,isOngoing:oe,isFinished:te})},ke.user_id)})},Ne))})};return e.jsx("li",{className:"border-t first:border-t-0",children:e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800 relative",children:[(S||V)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),te&&!S&&!V&&e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"FT"})}),e.jsxs("div",{className:`grid grid-cols-3 items-center ${oe?"pt-4":""}`,children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:R})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(fs,{code:t.home_code||void 0,crest:t.home_crest||void 0,size:24,className:"h-6 w-6"}),e.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600 dark:text-slate-300",children:n&&(S||V||te)?e.jsxs("span",{className:"font-bold text-base text-slate-900 dark:text-slate-100",children:[n.homeScore," - ",n.awayScore]}):e.jsx("span",{children:b})}),e.jsx(fs,{code:t.away_code||void 0,crest:t.away_crest||void 0,size:24,className:"h-6 w-6"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:H})})]}),n&&(oe||te)&&e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx("span",{className:`text-[10px] font-semibold ${oe?"text-red-600":"text-slate-500 dark:text-slate-400"}`,children:Ga(n.status,n.minute)})}),e.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:de("H")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:de("D")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:de("A")})})]})]})})}function js({label:t,fixtures:c,picksByFixture:p,members:u,outcomes:n,liveScores:A,submittedMap:L,picksGw:G,isApiTestLeague:r=!1,isFirstSection:B=!1,hasLiveGames:R=!1,allGamesFinished:H=!1,allSubmitted:re=!1,resultsPublished:b=!1,deadlinePassed:S=!1,whoDidntSubmit:V=[],liveFixturesCount:te,hasStarted:oe=!1}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(na,{date:t,className:"text-lg font-normal"}),B&&e.jsxs(e.Fragment,{children:[r&&R&&te!==void 0&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:te}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:c.length})]})]}),r&&H&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),r&&!oe&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!r&&(fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"LeagueFixtureSection.tsx:79",message:"Checking Round Complete conditions",data:{isApiTestLeague:r,allSubmitted:re,resultsPublished:b,allGamesFinished:H,shouldShow:re&&b&&H},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H3"})}).catch(()=>{}),re&&b&&H)&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!r&&re&&!b&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!r&&S&&!re&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",V.length>0&&`(${V.join(", ")} didn't submit)`]})]})]}),e.jsx("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 overflow-hidden",children:e.jsxs("ul",{children:[c.map(k=>{try{const de=p.get(k.fixture_index)??[],O=n.get(k.fixture_index)||null,U=A[k.fixture_index]||null;return e.jsx(Wa,{fixture:k,picks:de,members:u,outcome:O,liveScore:U,submittedMap:L,picksGw:G,isApiTestLeague:r},`${k.gw}-${k.fixture_index}`)}catch(de){return console.error("Error rendering fixture:",de,k),e.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",k.fixture_index]},`${k.gw}-${k.fixture_index}`)}}),!c.length&&e.jsx("li",{className:"p-4 text-slate-500 dark:text-slate-400",children:"No fixtures."})]})})]})}const zt=8;function Ot(t){return t.result==="H"||t.result==="D"||t.result==="A"?t.result:typeof t.home_goals=="number"&&typeof t.away_goals=="number"?t.home_goals>t.away_goals?"H":t.home_goals<t.away_goals?"A":"D":null}function qa(){const t=a.useRef(0);t.current=0;const{code:c=""}=oa();t.current++;const[p,u]=ia();t.current++;const{user:n}=Ss();t.current++;const{currentGw:A}=la();t.current++;const[L]=a.useState(()=>{const s=localStorage.getItem("oldSchoolMode");return s?JSON.parse(s):!1});t.current++,a.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(L))},[L]),t.current++,a.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const s=()=>{const f=document.querySelector(".league-header-fixed");if(f){const w=f.style.top||window.getComputedStyle(f).top;w!=="0px"&&w!=="0"&&(f.style.top="0",f.style.transform="translate3d(0, 0, 0)")}},l=()=>{s(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},o=f=>{const w=f.target;w.closest(".league-content-wrapper")||w.closest(".league-header-fixed")||w.closest(".chat-tab-wrapper")||f.preventDefault()};window.addEventListener("scroll",l,{passive:!0}),document.addEventListener("touchmove",o,{passive:!1});const m=setInterval(s,100);return s(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",l),document.removeEventListener("touchmove",o),clearInterval(m)}},[]),a.useEffect(()=>{const s=o=>{const m=o.target;(m.tagName==="INPUT"||m.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const f=document.querySelector(".league-header-fixed");f&&(f.style.top="0")},100)},l=()=>{const o=document.querySelector(".league-header-fixed");o&&(o.style.top="0")};return document.addEventListener("focusin",s),window.addEventListener("resize",l),window.addEventListener("orientationchange",l),()=>{document.removeEventListener("focusin",s),window.removeEventListener("resize",l),window.removeEventListener("orientationchange",l)}},[]),a.useEffect(()=>{if(typeof window>"u")return;const s=window.visualViewport;if(!s)return;let l=null;const o=()=>{const f=ke.current;if(!f)return;const w=s.offsetTop??0;f.style.setProperty("transform",`translate3d(0, ${w}px, 0)`,"important")},m=()=>{l&&cancelAnimationFrame(l),l=window.requestAnimationFrame(o)};return m(),s.addEventListener("resize",m),s.addEventListener("scroll",m),()=>{l&&cancelAnimationFrame(l),s.removeEventListener("resize",m),s.removeEventListener("scroll",m),ke.current&&ke.current.style.removeProperty("transform")}},[]);const G=()=>{if(!c)return null;try{const s=ye(`leagues:${n?.id||""}`);if(s){const l=s.find(o=>o.code.toUpperCase()===c.toUpperCase());if(l)return l}}catch{}return null},[r,B]=a.useState(()=>G());t.current++;const[R,H]=a.useState(!1);t.current++;const re=()=>{const s=G();if(!s?.id)return[];try{const l=ye(`league:members:${s.id}`);if(l&&l.length>0)return l.map(([o,m])=>({id:o,name:m||"(no name)"}))}catch{}return[]},[b,S]=a.useState(re);t.current++;const[V,te]=a.useState(()=>!G());t.current++;const oe="chat",[k,de]=a.useState(oe),O=a.useRef(null);a.useEffect(()=>{if(O.current!==null&&O.current!==k)try{const s=localStorage.getItem("message_subscription_logs"),l=s?JSON.parse(s):[];l.push({timestamp:Date.now(),leagueId:r?.id,status:"TAB_CHANGED",channel:`league-messages:${r?.id}`,from:O.current,to:k,reason:`Tab changed from "${O.current}" to "${k}"`});const o=l.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(s){console.error("[LeaguePage] Failed to log tab change:",s)}O.current=k},[k,r?.id]);const U=a.useRef(null);a.useEffect(()=>{if(U.current!==null&&U.current!==r?.id)try{const s=localStorage.getItem("message_subscription_logs"),l=s?JSON.parse(s):[];l.push({timestamp:Date.now(),leagueId:r?.id,status:"LEAGUE_ID_CHANGED",channel:`league-messages:${r?.id}`,from:U.current,to:r?.id,reason:`League ID changed from "${U.current}" to "${r?.id}"`});const o=l.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(s){console.error("[LeaguePage] Failed to log league ID change:",s)}U.current=r?.id??null},[r?.id]),a.useEffect(()=>{const s=Date.now();try{const l=localStorage.getItem("message_subscription_logs"),o=l?JSON.parse(l):[],m={timestamp:Date.now(),leagueId:r?.id,status:"LEAGUE_PAGE_MOUNT",channel:`league-messages:${r?.id}`,pageId:s,tab:k,reason:"LeaguePage component mounted"};o.push(m);const f=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(f))}catch(l){console.error("[LeaguePage] Failed to log mount:",l)}return()=>{try{const l=localStorage.getItem("message_subscription_logs"),o=l?JSON.parse(l):[],m={timestamp:Date.now(),leagueId:r?.id,status:"LEAGUE_PAGE_UNMOUNT",channel:`league-messages:${r?.id}`,pageId:s,tab:k,reason:"LeaguePage component unmounting"};o.push(m);const f=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(f))}catch(l){console.error("[LeaguePage] Failed to log unmount:",l)}}},[]),t.current++;const[z,he]=a.useState(null);t.current++;const ve=a.useRef(k);t.current++,a.useEffect(()=>{ve.current=k},[k]),t.current++;const le=a.useRef(!1);t.current++;const Ne=a.useRef(!1);t.current++,a.useEffect(()=>{const s=p.get("tab"),l=p.get("leagueCode");if(he(null),s==="chat"||s==="gw"||l){if(l&&c!==l){he(`Deep link mismatch: URL has leagueCode=${l} but we're on league ${c}. Current URL: ${window.location.href}`);return}s==="chat"&&k!=="chat"&&(de(o=>o!=="chat"?"chat":o),setTimeout(()=>{ve.current!=="chat"&&he(`Failed to open chat tab. Current tab: ${ve.current}, Expected: chat. URL: ${window.location.href}`)},300)),s==="gw"&&k!=="gw"&&(de(o=>o!=="gw"?"gw":o),setTimeout(()=>{ve.current!=="gw"&&he(`Failed to open predictions tab. Current tab: ${ve.current}, Expected: gw. URL: ${window.location.href}`)},300))}},[p,u,k,c]);const ke=a.useRef(null),[Pe,Me]=a.useState(!1),[me,se]=a.useState(!1),[I,Q]=a.useState(!1),fe=()=>{try{return ye("app_meta:current_gw")?.current_gw??null}catch{return null}},[N,ge]=a.useState(fe),[E,q]=a.useState(null),[i,d]=a.useState(fe),g=()=>{try{return ye("app:available_gws")??[]}catch{return[]}},[Y,D]=a.useState(()=>g()),v=a.useRef({}),_=a.useRef({}),X=a.useRef(new Map),[J,ee]=a.useState(new Set),[Be,dt]=a.useState(!1),[ut,$e]=a.useState(!1),[st,mt]=a.useState(0),[Le,ft]=a.useState(!1),[Jt,Ye]=a.useState(!1),[kt,Oe]=a.useState(!1),[Ce,qe]=a.useState(!1),[Ge,Te]=a.useState(null),[Ls,Je]=a.useState(!1),[He,Xe]=a.useState(null),[Es,Vt]=a.useState({x:0,y:0}),[jt,_t]=a.useState(1),[ht,Kt]=a.useState(null),[De,at]=a.useState(null),[rt,Ze]=a.useState(!1);t.current++;const[nt,gt]=a.useState(!1);t.current++;const[Rs,ot]=a.useState(!1);t.current++;const[Nt,xt]=a.useState(!1);t.current++;const[pt,Qe]=a.useState(!1),[Ms,St]=a.useState(!1),[Ts,Ct]=a.useState(!1),[bt,Yt]=a.useState(null),[Lt,Xt]=a.useState(!1),[Et,Zt]=a.useState(!1),[it,As]=a.useState(null),Ue=a.useMemo(()=>!!n?.id&&b.some(s=>s.id===n.id),[n?.id,b]),Qt=a.useMemo(()=>!!n?.id&&!!it&&it.id===n.id,[n?.id,it]),Is=a.useMemo(()=>it?.name??"League admin",[it]),Ds=a.useMemo(()=>{const s=new Map;return b.forEach(l=>s.set(l.id,l.name)),s.set(ct,Cs),s},[b]),Ps=a.useCallback(()=>{if(!r?.code||typeof window>"u"||typeof navigator>"u")return;const s=`Join my mini league "${r.name}" on TotL!`,l=`${window.location.origin}/league/${r.code}`,o=navigator;if(typeof o.share=="function"){o.share({title:`Join ${r.name}`,text:s,url:l}).catch(()=>{});return}const m=`${s}
${l}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(m).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",r.code)}):window.prompt?.("Share this league code:",r.code)},[r]),$s=a.useCallback(async()=>{if(!(!r?.id||!n?.id)){Q(!0);try{const{error:s}=await $.from("league_members").delete().eq("league_id",r.id).eq("user_id",n.id);if(s)throw s;typeof window<"u"&&(window.location.href="/leagues")}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to leave league. Please try again.")}finally{Q(!1),se(!1)}}},[r?.id,n?.id]),Us=a.useCallback(async()=>{if(!(!r?.id||!n?.id)){xt(!0);try{if((await ca(n.id)).length>=20){typeof window<"u"&&window.alert?.("You're already in 20 mini-leagues, which is the maximum. Leave a league before joining another."),ot(!1),xt(!1);return}const l=A;if(l!==null){const f=await Bt({id:r.id,name:r.name,created_at:r.created_at},l);if(l-f>=4){typeof window<"u"&&window.alert?.("This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."),ot(!1),xt(!1);return}}if(b.length>=zt){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),ot(!1);return}const{error:o}=await $.from("league_members").insert({league_id:r.id,user_id:n.id});if(o)throw o;const m=n.user_metadata?.display_name||n.email||"Someone";try{const f=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:r.id,userId:n.id,userName:m})}),w=await f.text();try{w&&JSON.parse(w)}catch{}f.ok}catch{}typeof window<"u"&&window.location.reload()}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to join league.")}finally{xt(!1)}}},[r?.id,r?.name,r?.created_at,n?.id,b.length,A]),Fs=a.useCallback(async()=>{if(!(!bt||!r?.id||!n?.id)){Xt(!0);try{const{error:s}=await $.from("league_members").delete().eq("league_id",r.id).eq("user_id",bt.id);if(s)throw s;typeof window<"u"&&window.location.reload()}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to remove member.")}finally{Xt(!1),St(!1),Yt(null)}}},[r?.id,bt,n?.id]),Bs=a.useCallback(async()=>{if(!(!r?.id||!n?.id)){Zt(!0);try{const{error:s}=await $.from("league_members").delete().eq("league_id",r.id);if(s)throw s;const{error:l}=await $.from("leagues").delete().eq("id",r.id);if(l)throw l;typeof window<"u"&&(window.location.href="/leagues")}catch(s){typeof window<"u"&&window.alert?.(s?.message??"Failed to end league.")}finally{Zt(!1),Ct(!1)}}},[r?.id,n?.id]),Gs=s=>new Promise((l,o)=>{const m=new Image;m.addEventListener("load",()=>l(m)),m.addEventListener("error",f=>o(f)),m.src=s}),es=async(s,l)=>{const o=await Gs(s),m=document.createElement("canvas"),f=m.getContext("2d");if(!f)throw new Error("No 2d context");return m.width=l.width,m.height=l.height,f.drawImage(o,l.x,l.y,l.width,l.height,0,0,l.width,l.height),new Promise((w,P)=>{m.toBlob(C=>{if(!C){P(new Error("Canvas is empty"));return}w(C)},"image/jpeg",.9)})},Hs=a.useCallback(s=>{if(!r?.id||!Ue){Te("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(s.type)){Te("Please upload a PNG, JPG, or WebP image.");return}const o=20*1024*1024;if(s.size>o){Te("Please choose an image smaller than 20MB.");return}if(Te(null),Je(!1),s.size>5*1024*1024)hs(s,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(m=>{const f=new FileReader;f.onload=()=>{Xe(f.result)},f.readAsDataURL(m)}).catch(()=>{Te("Failed to process image. Please try a smaller file.")});else{const m=new FileReader;m.onload=()=>{Xe(m.result)},m.readAsDataURL(s)}},[Ue,r?.id]),Ws=a.useCallback(async(s,l)=>{if(Kt(l),He)try{const o=await es(He,l),m=URL.createObjectURL(o);at(m)}catch{}},[He]),zs=a.useCallback(async()=>{if(!(!He||!ht||!r?.id||!Ue)){Te(null),Je(!1),qe(!0);try{const s=await es(He,ht),l=new File([s],"badge.jpg",{type:"image/jpeg"}),o=await hs(l,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(o.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const m=`${r.id}-${Date.now()}.jpg`,{error:f}=await $.storage.from("league-avatars").upload(m,o,{cacheControl:"3600",upsert:!0,contentType:o.type});if(f)throw f;const{data:w}=$.storage.from("league-avatars").getPublicUrl(m),P=w?.publicUrl;if(!P)throw new Error("Unable to get public URL for badge.");const{error:C}=await $.from("leagues").update({avatar:P}).eq("id",r.id);if(C)throw C;B(ce=>ce&&{...ce,avatar:P}),Je(!0),De&&URL.revokeObjectURL(De),Xe(null),at(null),Oe(!1),n?.id&&(qt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:r.id,avatar:P}})))}catch(s){Te(s?.message??"Failed to upload badge. Please try again.")}finally{qe(!1)}}},[He,ht,Ue,r?.id,n?.id]),Os=a.useCallback(async()=>{if(!(!r?.id||!Ue)){Te(null),Je(!1),qe(!0);try{const{error:s}=await $.from("leagues").update({avatar:null}).eq("id",r.id);if(s)throw s;B(l=>l&&{...l,avatar:null}),Je(!0),n?.id&&(qt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:r.id,avatar:null}})))}catch(s){Te(s?.message??"Failed to remove badge. Please try again.")}finally{qe(!1)}}},[Ue,r?.id]),[ts,qs]=a.useState(new Map);a.useEffect(()=>{(async()=>{const s=new Map,{data:l}=await $.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:o}=await $.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),m=new Map;if(l&&l.forEach(f=>{(!m.has(f.gw)||f.kickoff_time&&new Date(f.kickoff_time)<new Date(m.get(f.gw)))&&f.kickoff_time&&m.set(f.gw,f.kickoff_time)}),o&&o.length>0){const f=o.find(w=>w.kickoff_time)?.kickoff_time;if(f){const w=m.get(1);(!w||new Date(f)<new Date(w))&&m.set(1,f)}}m.forEach((f,w)=>{const P=new Date(f),C=new Date(P.getTime()-4500*1e3);s.set(w,C)}),qs(s)})()},[]),a.useEffect(()=>{const s=l=>{const o=l.target;Be&&!o.closest(".gw-dropdown-container")&&dt(!1)};return Be&&document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[Be]),a.useEffect(()=>{let s=!0;return(async()=>{const{data:l}=await $.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!s)return;ge(l?.current_gw??null);const{data:o}=await $.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!s)return;q(o&&o.length?o[0].gw:null);const{data:m}=await $.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!s)return;const f=m?[...new Set(m.map(P=>P.gw))].sort((P,C)=>C-P):[],w=l?.current_gw;w&&!f.includes(w)&&f.unshift(w),D(f),(f.length>0&&!i||f.length>0&&i&&!f.includes(i))&&d(f[0])})(),()=>{s=!1}},[st]);const Js=a.useMemo(()=>b.map(s=>s.id).sort().join(","),[b]),We=a.useMemo(()=>b.map(s=>s.id),[Js]),[we,ss]=a.useState([]);t.current++;const[as,Rt]=a.useState([]);t.current++;const[rs,Mt]=a.useState([]);t.current++;const[Tt,At]=a.useState([]);t.current++,a.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[k]),t.current++;const{state:It}=et(N);t.current++;const wt=a.useMemo(()=>r?.name==="API Test",[r?.name]),[Ee,ns]=a.useState(null);t.current++;const Dt=a.useMemo(()=>r?r.name==="API Test"?Ee??1:Ne.current&&i||!N?i:It==="LIVE"||It==="RESULTS_PRE_GW"?N:E&&E<N?E:N>1?N-1:N:N||i||null,[r?.name,Ee,i,N,It,E]);t.current++;const{state:Vs}=et(Dt??null);t.current++;const lt=a.useRef(""),os=a.useRef(0),is=a.useMemo(()=>{const s=we?.length||0;if(s===os.current&&lt.current&&(we?.map(m=>m.api_match_id).filter(m=>m!=null).sort().join(",")||"")===lt.current)return lt.current;if(os.current=s,!we||we.length===0)return lt.current="","";const l=we.map(o=>o.api_match_id).filter(o=>o!=null).sort().join(",");return lt.current=l,l},[we]);a.useEffect(()=>{if(!wt){ns(null);return}let s=!0;return(async()=>{const{data:l}=await $.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let o=l?.current_test_gw??1;if(o&&o!==1){const{data:m}=await $.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!m){const{data:f}=await $.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();f&&(o=1)}}s&&ns(o)})(),()=>{s=!1}},[wt]);const Ks=a.useMemo(()=>wt&&Ee!==null?Ee:N||i||void 0,[wt,Ee,N,i]),Pt=a.useRef({key:"",array:void 0}),Ys=a.useMemo(()=>{const s=is||"";if(Pt.current.key===s)return Pt.current.array;const l=s?s.split(",").map(o=>parseInt(o,10)).filter(o=>!isNaN(o)):void 0;return Pt.current={key:s,array:l},l},[is]),{liveScores:ls}=da(Ks,Ys),_e=a.useMemo(()=>{const s={};if(!we||we.length===0)return Object.keys(_.current).length===0?_.current:(_.current=s,s);we.forEach(w=>{const P=w.api_match_id;if(P){const C=ls.get(P);C&&(s[w.fixture_index]={homeScore:C.home_score??0,awayScore:C.away_score??0,status:C.status||"SCHEDULED",minute:C.minute??null})}});const l=_.current,o=Object.keys(s).map(Number),m=Object.keys(l).map(Number);if(o.length!==m.length)return _.current=s,s;let f=!1;for(const w of o){const P=s[w],C=l[w];if(!C||P.homeScore!==C.homeScore||P.awayScore!==C.awayScore||P.status!==C.status||P.minute!==C.minute){f=!0;break}}return f?(_.current=s,s):l},[ls,we]),Xs=()=>{try{const s=typeof window<"u"&&localStorage.getItem("debug:verbose")==="true";if(s&&console.log("[League] getInitialMltRows called",{code:c,userId:n?.id}),c&&n?.id){const o=ye(`leagues:${n.id}`);if(s&&console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!o,length:o?.length}),o&&Array.isArray(o)){const m=o.find(f=>f.code.toUpperCase()===c.toUpperCase());if(s&&console.log("[League] getInitialMltRows - found league",{found:!!m,leagueId:m?.id}),m?.id){const f=`league:mltRows:${m.id}`,w=ye(f);if(s&&console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!w,length:w?.length,cacheKey:f,cachedType:typeof w,isArray:Array.isArray(w),rawCache:w}),w&&Array.isArray(w)&&w.length>0)return s&&console.log("[League] âœ… getInitialMltRows returning cached rows",w.length),w;s&&console.log("[League] âŒ Cache check failed",{cached:!!w,isArray:Array.isArray(w),length:w?.length,cacheKey:f})}}}const l=G();if(s&&console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!l,leagueId:l?.id}),l?.id){const o=ye(`league:mltRows:${l.id}`);if(s&&console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!o,length:o?.length}),o&&Array.isArray(o)&&o.length>0)return s&&console.log("[League] âœ… getInitialMltRows returning cached rows from initialLeague",o.length),o}if(c&&n?.id){const o=ye(`leagues:${n.id}`);if(o&&Array.isArray(o)){for(const m of o)if(m.code?.toUpperCase()===c.toUpperCase()&&m.id){const f=ye(`league:mltRows:${m.id}`);if(f&&Array.isArray(f)&&f.length>0)return s&&console.log("[League] âœ… getInitialMltRows returning cached rows from strategy 3",f.length),f}}}s&&console.log("[League] âš ï¸ getInitialMltRows returning empty array - cache miss")}catch(s){console.error("[League] âŒ getInitialMltRows error",s)}return[]},[Ae,Fe]=a.useState(Xs);a.useEffect(()=>{console.log("[League] Tab changed to:",k,"mltRows.length:",Ae.length)},[k,Ae.length]),a.useEffect(()=>{if(r?.id){const s=`league:mltRows:${r.id}`,l=ye(s);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:r.id,cacheKey:s,hasCached:!!l,cachedLength:l?.length,currentMltRowsLength:Ae.length}),l&&l.length>0)Ae.length===0?(console.log("[League] âœ… Setting mltRows from cache",l.length),Fe(l)):console.log("[League] mltRows already populated, skipping");else{console.log("[League] âš ï¸ No cached mltRows found - will retry multiple times");let o=0;const m=10,f=[50,100,150,200,250,300,400,500,600,800],w=()=>{if(o>=m){console.log("[League] âŒ Max retries reached, giving up on cache");return}const C=setTimeout(()=>{o++;const ce=ye(s);ce&&ce.length>0&&Ae.length===0?(console.log(`[League] âœ… Retry ${o} successful - Setting mltRows from cache`,ce.length),Fe(ce)):o<m&&w()},f[o]||800);return()=>clearTimeout(C)};return w()}}else console.log("[League] âš ï¸ No league.id available yet")},[r?.id,Ae.length]),a.useEffect(()=>{let s=!0;return(async()=>{let o=r;if(!o){const{data:C}=await $.from("leagues").select("id,name,code,created_at,avatar").eq("code",c).maybeSingle();if(!s)return;if(!C){B(null),S([]),te(!1);return}o=C,B(o)}const m=ye(`league:members:${o.id}`);let f=[];if(m&&m.length>0)f=m.map(([C,ce])=>({id:C,name:ce||"(no name)"})),te(!1);else{const{data:C}=await $.from("league_members").select("users(id,name),created_at").eq("league_id",o.id).order("created_at",{ascending:!0});f=C?.map(ce=>({id:ce.users.id,name:ce.users.name??"(no name)"}))??[],te(!1)}const w=[...f].sort((C,ce)=>C.name.localeCompare(ce.name));S(w);const P=f[0];As(P),n?.id&&!f.some(C=>C.id===n.id)&&ot(!0),te(!1)})(),()=>{s=!1}},[c]),a.useEffect(()=>{},[r,k]),a.useEffect(()=>{let s=!0;return(async()=>{const l=r?.name==="API Test";let o=Ee??1;if(l){const{data:j}=await $.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(o=j?.current_test_gw??1,o&&o!==1){const{data:M}=await $.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!M){const{data:Z}=await $.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Z&&(o=1)}}}const m=l&&(k==="gw"||k==="gwr");let f=null;if(k==="gwr")if(Ne.current&&i)f=i;else if(N)try{const j=await ua(N);j==="LIVE"||j==="RESULTS_PRE_GW"?f=N:E&&E<N?f=E:f=N>1?N-1:N}catch(j){console.error("[League] Error checking game state for fixtures loading:",j),E&&E<N?f=E:f=N>1?N-1:N}else f=i;else f=N;if(l&&(k==="gw"||k==="gwr")&&(f=o),k==="gw"&&!l&&We.length>0){const{data:j}=await $.from("app_gw_submissions").select("gw").in("user_id",We).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(j&&j.length>0){const M=[...new Set(j.map(Z=>Z.gw))].sort((Z,ne)=>(ne||0)-(Z||0));for(const Z of M)if(Z){const{data:ne}=await $.from("app_fixtures").select("gw").eq("gw",Z).limit(1);if(ne&&ne.length>0){f=Z;break}}}!f&&N&&(f=N)}if(!f&&!m){ss([]),Rt([]),Mt([]),At([]);return}let w;if(m){const{data:j}=await $.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",o).order("fixture_index",{ascending:!0});w=j?.map(M=>({...M,gw:M.test_gw}))||null}else{const{data:j}=await $.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",f).order("fixture_index",{ascending:!0});w=j||null}if(!s)return;if(ss(j=>{const M=w??[];return j.length!==M.length?M:j.length===0&&M.length===0?j:j.some((ne,y)=>!M[y]||ne.id!==M[y].id||ne.fixture_index!==M[y].fixture_index)||M.some((ne,y)=>!j[y]||ne.id!==j[y].id||ne.fixture_index!==j[y].fixture_index)?M:j}),!We.length){Rt([]),Mt([]),At([]);return}let P=null,C;if(m){const{data:j}=await $.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",o).in("user_id",We);P=j?.map(T=>({...T,gw:T.matchday}))||null;const{data:M,error:Z}=await $.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",o).not("submitted_at","is",null).in("user_id",We),{data:ne}=await $.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",o).order("fixture_index",{ascending:!0}),y=new Set((ne||[]).map(T=>T.fixture_index)),h=[];if(M&&P&&ne){const T=y.size,F=new Date("2025-11-18T00:00:00Z");M.forEach(W=>{const ue=(P||[]).filter(be=>be.user_id===W.user_id&&be.matchday===o).filter(be=>y.has(be.fixture_index)),Re=ue.length===T&&T>0,x=new Set(ue.map(be=>be.fixture_index)).size===T,ie=W.submitted_at?new Date(W.submitted_at):null,pe=ie&&ie>=F;Re&&x&&pe&&h.push(W)})}C=h.map(T=>({...T,gw:T.matchday}))||null}else{const{data:j}=await $.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",f).in("user_id",We);P=j;const{data:M}=await $.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",f).in("user_id",We);C=M}if(!s)return;Rt(j=>{const M=P??[];if(j.length!==M.length)return M;if(j.length===0&&M.length===0)return j;const Z=JSON.stringify(j.sort((y,h)=>y.fixture_index-h.fixture_index)),ne=JSON.stringify(M.sort((y,h)=>y.fixture_index-h.fixture_index));return Z===ne?j:M}),Mt(j=>{const M=C??[];if(j.length!==M.length)return M;if(j.length===0&&M.length===0)return j;const Z=JSON.stringify(j),ne=JSON.stringify(M);return Z===ne?j:M});const{data:ce}=await $.from("app_gw_results").select("gw,fixture_index,result").eq("gw",m?1:f||0);s&&At(j=>{const M=ce??[];if(j.length!==M.length)return M;if(j.length===0&&M.length===0)return j;const Z=JSON.stringify(j.sort((y,h)=>y.fixture_index-h.fixture_index)),ne=JSON.stringify(M.sort((y,h)=>y.fixture_index-h.fixture_index));return Z===ne?j:M})})(),()=>{s=!1}},[k,N,E,i,We]),a.useEffect(()=>{v.current=_e},[_e]);const ze=a.useMemo(()=>{const s=new Map;return rs.forEach(l=>{if(l.submitted_at){const o=`${l.user_id}:${l.gw}`;s.set(o,!0)}}),s},[rs]),yt=a.useCallback(s=>s.map(l=>({user_id:l.id,name:l.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);a.useEffect(()=>{const s=$.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{mt(l=>l+1)}).subscribe();return()=>{$.removeChannel(s)}},[]),a.useEffect(()=>{let s=!0;return(async()=>{const l=st>0,o=Ae.length>0&&Ae.every(x=>x.wins===0&&x.draws===0),m=l||o;if(!m&&Ae.length>0)return;if(!m&&r?.id){const x=ye(`league:mltRows:${r.id}`);if(x&&x.length>0){Fe(x);return}}if(!b.length){ye(`league:mltRows:${r?.id||""}`)||Fe([]);return}if(r?.name==="API Test"){Fe(yt(b));return}if(!m){const x=r?.id&&ye(`league:mltRows:${r.id}`);if(x&&x.length>0){Fe(x);return}}if(N===null)return;const{data:f}=await $.from("app_gw_results").select("gw,fixture_index,result"),w=f??[],P=new Map;if(w.forEach(x=>{const ie=Ot(x);ie&&P.set(`${x.gw}:${x.fixture_index}`,ie)}),P.size===0){Fe(yt(b));return}const C=[...new Set(Array.from(P.keys()).map(x=>parseInt(x.split(":")[0],10)))].sort((x,ie)=>x-ie),ce=["Prem Predictions","FC Football","Easy League"],j=["The Bird league"],M=await Bt(r,N);let Z=C.filter(x=>x>=M);if(N!==null&&Z.includes(N)){const{data:x}=await $.from("app_fixtures").select("fixture_index").eq("gw",N),ie=x?.length??0,pe=Array.from(P.keys()).filter(be=>parseInt(be.split(":")[0],10)===N).length;ie>0&&pe<ie&&(Z=Z.filter(be=>be<N))}else N!==null&&(Z=Z.filter(x=>x<N));if(!ce.includes(r?.name||"")&&!j.includes(r?.name||"")&&Z.length===0){Fe(yt(b));return}const{data:ne}=await $.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",b.map(x=>x.id)).in("gw",Z),y=ne??[],h=new Map;Z.forEach(x=>{const ie=new Map;b.forEach(pe=>ie.set(pe.id,{user_id:pe.id,score:0,unicorns:0})),h.set(x,ie)}),Z.forEach(x=>{Array.from(P.entries()).filter(([pe])=>parseInt(pe.split(":")[0],10)===x).map(([pe,be])=>({idx:parseInt(pe.split(":")[1],10),out:be})).forEach(({idx:pe,out:be})=>{const ae=y.filter(Ie=>Ie.gw===x&&Ie.fixture_index===pe),Se=ae.filter(Ie=>Ie.pick===be).map(Ie=>Ie.user_id),ds=h.get(x);if(ae.forEach(Ie=>{if(Ie.pick===be){const Ut=ds.get(Ie.user_id);Ut.score+=1}}),Se.length===1&&b.length>=3){const Ie=Se[0],Ut=ds.get(Ie);Ut.unicorns+=1}})});const T=new Map,F=new Map,W=new Map,K=new Map,ue=new Map,Re=new Map;b.forEach(x=>{T.set(x.id,0),F.set(x.id,0),W.set(x.id,0),K.set(x.id,0),ue.set(x.id,0),Re.set(x.id,[])}),Z.forEach(x=>{const ie=Array.from(h.get(x).values());if(ie.forEach(ae=>{F.set(ae.user_id,(F.get(ae.user_id)??0)+ae.score),W.set(ae.user_id,(W.get(ae.user_id)??0)+ae.unicorns)}),ie.sort((ae,Se)=>Se.score-ae.score||Se.unicorns-ae.unicorns),!ie.length)return;const pe=ie[0],be=ie.filter(ae=>ae.score===pe.score&&ae.unicorns===pe.unicorns);be.length===1?(T.set(pe.user_id,(T.get(pe.user_id)??0)+3),K.set(pe.user_id,(K.get(pe.user_id)??0)+1),Re.get(pe.user_id).push("W"),ie.slice(1).forEach(ae=>Re.get(ae.user_id).push("L"))):(be.forEach(ae=>{T.set(ae.user_id,(T.get(ae.user_id)??0)+1),ue.set(ae.user_id,(ue.get(ae.user_id)??0)+1),Re.get(ae.user_id).push("D")}),ie.filter(ae=>!be.find(Se=>Se.user_id===ae.user_id)).forEach(ae=>Re.get(ae.user_id).push("L")))});const xe=b.map(x=>({user_id:x.id,name:x.name,mltPts:T.get(x.id)??0,ocp:F.get(x.id)??0,unicorns:W.get(x.id)??0,wins:K.get(x.id)??0,draws:ue.get(x.id)??0,form:Re.get(x.id)??[]}));xe.sort((x,ie)=>ie.mltPts-x.mltPts||ie.unicorns-x.unicorns||ie.ocp-x.ocp||x.name.localeCompare(ie.name)),s&&(Fe(xe),r?.id&&_s(`league:mltRows:${r.id}`,xe,Ns.LEAGUES))})(),()=>{s=!1}},[b,r,N,yt,st]);const cs=a.useCallback(async()=>{if(!r||!A){Ze(!0);return}try{const s=await Bt({id:r.id,name:r.name,created_at:r.created_at},A);if(A-s>=4){gt(!0);return}Ze(!0)}catch(s){console.error("[League] Error checking league lock status:",s),Ze(!0)}},[r,A]);function $t(){return e.jsxs("div",{className:"text-center p-8 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("img",{src:"/assets/Volley/volley-with-ball.png",alt:"Volley",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 font-bold",children:"Share your league code with friends to kick things off."}),e.jsx("button",{onClick:cs,className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]})}function Zs(){const s=a.useRef(null);if(a.useEffect(()=>{if(!nt)return;const o=m=>{m.key==="Escape"&&gt(!1)};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[nt]),a.useEffect(()=>(nt?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[nt]),!nt)return null;const l=o=>{o.target===o.currentTarget&&gt(!1)};return bs.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:s,className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"league-locked-error-title",onClick:l,style:{zIndex:1e6},children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-800 px-8 py-8 text-center shadow-2xl max-w-sm w-full",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-red-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-amber-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{id:"league-locked-error-title",className:"text-2xl font-extrabold text-amber-600",children:"League Locked"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."}),e.jsx("button",{onClick:()=>gt(!1),className:"mt-4 px-6 py-2.5 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#156d63] transition-colors",children:"OK"})]})]})})]}),document.body)}function Qs(){const[s,l]=a.useState(""),o=a.useRef(null),m=a.useRef(null);a.useEffect(()=>{if(!rt)return;const j=M=>{M.key==="Escape"&&Ze(!1)};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[rt]);const f=j=>{j.target===j.currentTarget&&Ze(!1)};if(a.useEffect(()=>(rt?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[rt]),!rt||!r)return null;const w=j=>{l(j),window.clearTimeout(w._t),w._t=window.setTimeout(()=>l(""),1600)},P=async()=>{try{await navigator.clipboard.writeText(r.code),w("Code copied")}catch{try{const M=document.createElement("textarea");M.value=r.code,document.body.appendChild(M),M.select(),document.execCommand("copy"),document.body.removeChild(M),w("Code copied")}catch{w("Couldn't copy")}}},C=async()=>{if(!r?.code||typeof window>"u"||typeof navigator>"u")return;const j=`Join my mini league "${r.name}" on TotL!`,M=`${window.location.origin}/league/${r.code}`,Z=navigator;if(typeof Z.share=="function")try{await Z.share({title:`Join ${r.name}`,text:j,url:M});return}catch{return}const ne=`${j}
${M}`;try{await navigator.clipboard.writeText(ne),w("Share text copied")}catch{w("Couldn't share")}},ce=e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:o,className:"fixed inset-0 bg-black/50",onClick:f,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999,touchAction:"manipulation"}}),e.jsxs("div",{ref:m,className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 rounded-t-3xl shadow-2xl",role:"dialog","aria-modal":"true","aria-labelledby":"share-league-code-tray-title",onClick:j=>j.stopPropagation(),style:{animation:"slideUp 300ms ease-out",zIndex:1e6,touchAction:"manipulation"},children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[e.jsx("h2",{id:"share-league-code-tray-title",className:"text-lg font-medium text-slate-900 dark:text-slate-100 uppercase tracking-wide",style:{fontFamily:'"Gramatika", sans-serif',fontWeight:700},children:"Share League Code"}),e.jsx("button",{onClick:()=>Ze(!1),className:"w-8 h-8 flex items-center justify-center rounded-full","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 pb-8 max-h-[70vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-3",children:["Share this code (up to ",zt," members):"]}),e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("code",{className:"flex-1 font-mono text-2xl font-bold text-center py-3 px-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-100",children:r.code})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:P,className:"flex-1 px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-semibold hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors",children:"Copy"}),e.jsx("button",{onClick:C,className:"flex-1 px-4 py-3 rounded-lg bg-[#1C8376] text-white font-semibold hover:bg-[#156b60] transition-colors",children:"Share"})]}),e.jsx("div",{className:`mt-3 text-xs rounded bg-slate-900 text-white px-3 py-2 text-center transition-opacity ${s?"opacity-100":"opacity-0 pointer-events-none"}`,children:s||"â€¦"}),e.jsxs("div",{className:"mt-4 text-xs text-slate-500 dark:text-slate-400 text-center",children:[b.length,"/",zt," members"]})]})})}),e.jsx("div",{className:"flex justify-center pb-3",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})})]})]});return typeof document<"u"&&document.body?bs.createPortal(ce,document.body):ce}function ea(){const s=a.useMemo(()=>N??null,[N]);et(s);const l=Ae.length>0?Ae:b.length>0?b.map(P=>({user_id:P.id,name:P.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],o=["Prem Predictions","FC Football","Easy League"],m=["The Bird league"],f=["gregVjofVcarl","Let Down"],w=!!(r&&!o.includes(r.name)&&!m.includes(r.name)&&!f.includes(r.name));return b.length===1?e.jsx($t,{}):e.jsxs("div",{className:"pt-4",children:[e.jsx(Da,{rows:l,members:b,showForm:Pe,currentUserId:n?.id,loading:!1,isLateStartingLeague:w}),e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(Aa,{showForm:Pe,onToggle:Me}),e.jsxs("button",{onClick:()=>ft(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),r?.name==="API Test"&&e.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:e.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function ta(){const s=a.useMemo(()=>r?.name==="API Test"?Ee??1:N??null,[r?.name,Ee,N]),{state:l}=et(s);if(b.length===1)return e.jsx($t,{});if(!s)return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No current gameweek available."});if(!ws(r,s,ts))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Predictions Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",s," predictions are not included in this league."]})]})});const o=new Map;Tt.forEach(h=>{if(h.gw!==s)return;const T=Ot(h);T&&o.set(h.fixture_index,T)}),we.forEach(h=>{if(h.gw!==s)return;const T=_e[h.fixture_index];T&&(T.status==="IN_PLAY"||T.status==="PAUSED"||T.status==="FINISHED")&&(T.homeScore>T.awayScore?o.set(h.fixture_index,"H"):T.awayScore>T.homeScore?o.set(h.fixture_index,"A"):o.set(h.fixture_index,"D"))});const m=a.useMemo(()=>{const h=W=>{if(!W)return"Fixtures";const K=new Date(W);return isNaN(K.getTime())?"Fixtures":K.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},T=new Map;we.filter(W=>W.gw===s).forEach(W=>{const K=h(W.kickoff_time),ue=W.kickoff_time?new Date(W.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;T.has(K)||T.set(K,{label:K,key:ue,items:[]}),T.get(K).items.push(W)});const F=Array.from(T.values());return F.forEach(W=>W.items.sort((K,ue)=>K.fixture_index-ue.fixture_index)),F.sort((W,K)=>W.key-K.key),F},[we,s]),f=new Set(we.filter(h=>h.gw===s).map(h=>h.fixture_index)),w=r?.name==="API Test",P=b.length>0&&b.every(h=>ze.get(`${h.id}:${s}`)),C=new Map;(!w||P)&&as.forEach(h=>{if(h.gw!==s||!ze.get(`${h.user_id}:${s}`)||!f.has(h.fixture_index))return;const F=C.get(h.fixture_index)??[];F.push(h),C.set(h.fixture_index,F)});const ce=E!==null&&E>=s,j=b.filter(h=>!ze.get(`${h.id}:${s}`)).length,M=b.filter(h=>!ze.get(`${h.id}:${s}`)).map(h=>h.name),Z=l!==null&&(l==="DEADLINE_PASSED"||l==="LIVE"||l==="RESULTS_PRE_GW"),ne=w?!P:!P&&!Z;return(w?!P:!P&&!Z)?e.jsx(ks,{members:b,submittedMap:ze,picksGw:s,allSubmitted:P,remaining:j,fixtures:we.filter(h=>h.gw===s),variant:"compact"}):e.jsxs("div",{className:"mt-2 pt-2",children:[ne?e.jsx(ks,{members:b,submittedMap:ze,picksGw:s,allSubmitted:P,remaining:j,fixtures:we.filter(h=>h.gw===s),variant:"full"}):null,r?.name==="API Test"&&P&&m.length>0&&!ne&&(()=>{const h=m.flatMap(xe=>xe.items),T=new Set(h.map(xe=>xe.fixture_index)),F={};Object.keys(_e).forEach(xe=>{const x=parseInt(xe,10);T.has(x)&&(F[x]=_e[x])});const W=h.some(xe=>{const x=F[xe.fixture_index];return x&&(x.status==="IN_PLAY"||x.status==="PAUSED")}),K=h.length>0&&h.every(xe=>{const x=F[xe.fixture_index];return x&&x.status==="FINISHED"}),ue=W||K||h.some(xe=>F[xe.fixture_index]);let Re=0;return n?.id&&h.forEach(xe=>{const x=F[xe.fixture_index],ie=x&&(x.status==="IN_PLAY"||x.status==="PAUSED"),pe=x&&x.status==="FINISHED";if(x&&(ie||pe)){const ae=(C.get(xe.fixture_index)??[]).find(Se=>Se.user_id===n.id);if(ae){let Se=!1;(ae.pick==="H"&&x.homeScore>x.awayScore||ae.pick==="A"&&x.awayScore>x.homeScore||ae.pick==="D"&&x.homeScore===x.awayScore)&&(Se=!0),Se&&Re++}}}),e.jsx("div",{className:"mt-3 space-y-6",children:m.map((xe,x)=>e.jsx(js,{label:xe.label,fixtures:xe.items,picksByFixture:C,members:b,outcomes:o,liveScores:F,submittedMap:ze,picksGw:s,isApiTestLeague:!0,isFirstSection:x===0,hasLiveGames:W,allGamesFinished:K,hasStarted:ue,liveFixturesCount:Re},x))})})(),m.length>0&&r?.name!=="API Test"&&(()=>{const h=Tt.filter(K=>K.gw===s),T=new Set(h.map(K=>K.fixture_index)),F=m.flatMap(K=>K.items),W=F.length>0&&F.every(K=>{if(T.has(K.fixture_index))return!0;const ue=_e[K.fixture_index];return ue&&ue.status==="FINISHED"});return e.jsx("div",{className:"mt-3 space-y-6",children:m.map((K,ue)=>e.jsx(js,{label:K.label,fixtures:K.items,picksByFixture:C,members:b,outcomes:o,liveScores:_e,submittedMap:ze,picksGw:s,isApiTestLeague:!1,isFirstSection:ue===0,allSubmitted:P,resultsPublished:ce,allGamesFinished:W,deadlinePassed:Z,whoDidntSubmit:M},ue))})})(),!m.length&&!ne&&e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-500 dark:text-slate-400",children:["No fixtures for GW ",s,"."]})]})}function sa(){const{state:s}=et(N),l=a.useMemo(()=>r?.name==="API Test"?Ee??1:k==="gwr"?Ne.current&&i||!N?i:s==="LIVE"||s==="RESULTS_PRE_GW"?N:E&&E<N?E:N>1?N-1:N:i,[r?.name,Ee,k,i,N,s,E]);et(l);const o=l;if(b.length===1)return e.jsx($t,{});if(!o||Y.length===0&&r?.name!=="API Test")return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No gameweek selected."});if(!ws(r,o,ts))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Results Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",o," results are not included in this league."]})]})});const m=new Map,f=r?.name==="API Test",w=we.filter(y=>y.gw===o),P=w.some(y=>{const h=_e[y.fixture_index];return h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")});f&&o===(Ee??1)?w.forEach(y=>{const h=_e[y.fixture_index];h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")&&(h.homeScore>h.awayScore?m.set(y.fixture_index,"H"):h.awayScore>h.homeScore?m.set(y.fixture_index,"A"):m.set(y.fixture_index,"D"))}):P&&o===N?w.forEach(y=>{const h=_e[y.fixture_index];h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")&&(h.homeScore>h.awayScore?m.set(y.fixture_index,"H"):h.awayScore>h.homeScore?m.set(y.fixture_index,"A"):m.set(y.fixture_index,"D"))}):Tt.forEach(y=>{if(y.gw!==o)return;const h=Ot(y);h&&m.set(y.fixture_index,h)});const C=b.map(y=>({user_id:y.id,name:y.name,score:0,unicorns:0})),ce=new Map;as.forEach(y=>{if(y.gw!==o)return;const h=ce.get(y.fixture_index)??[];h.push(y),ce.set(y.fixture_index,h)}),Array.from(m.entries()).forEach(([y,h])=>{const F=(ce.get(y)??[]).filter(W=>W.pick===h).map(W=>W.user_id);if(F.forEach(W=>{const K=C.find(ue=>ue.user_id===W);K.score+=1}),F.length===1&&b.length>=3){const W=C.find(K=>K.user_id===F[0]);W.unicorns+=1}}),C.sort((y,h)=>h.score-y.score||h.unicorns-y.unicorns||y.name.localeCompare(h.name)),a.useEffect(()=>{if(C.length===0)return;const y=new Map;C.forEach((T,F)=>{y.set(T.user_id,F)});const h=new Set;if(y.forEach((T,F)=>{const W=X.current.get(F);W!==void 0&&W!==T&&h.add(F)}),X.current=y,h.size>0){ee(h);const T=setTimeout(()=>{ee(new Set)},2e3);return()=>clearTimeout(T)}},[C.map(y=>`${y.user_id}-${y.score}-${y.unicorns}`).join(",")]);let j=!1,M=!1,Z=!1,ne=!1;if(f&&o===(Ee??1)){const y=we;if(y.length>0&&(j=y.every(T=>{const F=_e[T.fixture_index];return F&&F.status==="FINISHED"}),M=!!y.find(T=>{const F=_e[T.fixture_index];return F&&(F.status==="IN_PLAY"||F.status==="PAUSED")}),ne=y.some(T=>{const F=_e[T.fixture_index];return F&&(F.status==="IN_PLAY"||F.status==="PAUSED"||F.status==="FINISHED")}),!j)){const T=new Date;Z=y.some(F=>{if(!F.kickoff_time)return!1;const K=new Date(F.kickoff_time).getTime()-T.getTime(),ue=_e[F.fixture_index];return(!ue||ue.status!=="IN_PLAY"&&ue.status!=="PAUSED"&&ue.status!=="FINISHED")&&K>0&&K<=1440*60*1e3})}}else{const y=we.filter(h=>h.gw===o);if(y.length>0){const h=y.every(F=>m.has(F.fixture_index)),T=y.some(F=>{const W=_e[F.fixture_index];return W&&(W.status==="IN_PLAY"||W.status==="PAUSED")});j=h&&!T}}return e.jsxs("div",{children:[e.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),C.length>0&&j&&e.jsx(Ma,{winnerName:C[0].name,isDraw:C[0].score===C[1]?.score&&C[0].unicorns===C[1]?.unicorns}),e.jsx(Pa,{rows:C,members:b,currentUserId:n?.id,positionChangeKeys:J,isApiTestLeague:f,hasLiveFixtures:M,hasStartingSoonFixtures:Z,hasStartedFixtures:ne,allFixturesFinished:j,resGw:o}),Y.length>1&&e.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[e.jsx(Ta,{availableGws:Y,selectedGw:o,onChange:y=>{Ne.current=!0,d(y)}}),e.jsxs("button",{onClick:()=>Ye(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e.jsx(ps,{isOpen:Jt,onClose:()=>Ye(!1),title:"Weekly Winner",description:`ðŸ† How to Win the Week

The player with the most correct predictions wins.

ðŸ¦„ Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return V?e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:e.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Loadingâ€¦"})}):!r&&!V?e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:e.jsxs("div",{className:"rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-6",children:[e.jsx("div",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"League not found"}),e.jsx(gs,{to:"/leagues",className:"text-slate-600 dark:text-slate-400 underline",children:"Back to Mini Leagues"})]})}):r?e.jsxs("div",{className:`${L?"oldschool-theme":"bg-slate-50 dark:bg-slate-900"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[e.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),e.jsx("div",{ref:ke,className:"league-header-fixed bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx(gs,{to:"/leagues",className:"flex items-center text-slate-600 dark:text-slate-400 -ml-2 px-2 py-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[e.jsx("button",{type:"button",onClick:()=>{H(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 flex-shrink-0 relative cursor-pointer",children:r?e.jsx("img",{src:Gt(r),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:s=>{const l=s.target,m=`/assets/league-avatars/${xs(r.id)}`;l.src!==m&&(l.src=m)}}):e.jsx("div",{className:"w-full h-full bg-slate-200"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 truncate",children:r.name}),i&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Gameweek ",i]})]})]}),e.jsx("div",{className:"relative",style:{zIndex:100},children:e.jsx("button",{onClick:()=>Qe(!pt),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),e.jsx("div",{className:`bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out overflow-hidden ${pt?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-4 py-3",children:[Qt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 dark:border-slate-700 px-0",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Admin"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800 dark:text-white",children:Is})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("button",{onClick:()=>{$e(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsxs("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Manage"})]})}),e.jsx("div",{className:"my-3 border-b border-slate-200 dark:border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[Ue&&e.jsxs("button",{onClick:()=>{Oe(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Edit League Badge"})]}),e.jsxs("button",{onClick:async()=>{Qe(!1),await cs()},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Invite players"})]}),e.jsxs("button",{onClick:()=>{Ps(),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{children:"Share league code"})]}),e.jsxs("button",{onClick:()=>{se(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-red-600 dark:text-red-400 active:bg-red-100 dark:active:bg-red-900/30 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Leave"})]})]})]})}),e.jsxs("div",{className:`flex border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 gap-2 transition-all duration-300 ease-in-out ${pt?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[e.jsxs("button",{onClick:()=>{le.current=!0,de("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(k==="chat"?"text-[#1C8376]":"text-slate-400 dark:text-slate-500"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Chat"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),k==="chat"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(Y.length>0||r?.name==="API Test")&&e.jsxs("button",{onClick:()=>{le.current=!0,de("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(k==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const s=Dt!=null&&Vs==="LIVE";return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),k==="gwr"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(N||r?.name==="API Test")&&e.jsxs("button",{onClick:()=>{le.current=!0,de("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(k==="gw"?"text-[#1C8376]":"text-slate-400"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),k==="gw"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),e.jsxs("button",{onClick:()=>{le.current=!0,de("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(k==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",k==="mlt"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),k==="chat"?e.jsx("div",{className:"chat-tab-wrapper",children:e.jsx(Ra,{miniLeagueId:r?.id??null,memberNames:Ds,deepLinkError:z})}):e.jsx("div",{className:`league-content-wrapper ${pt?"menu-open":""}`,children:e.jsxs("div",{className:"px-1 sm:px-2",children:[k==="mlt"&&e.jsx(ea,{}),k==="gw"&&e.jsx(ta,{}),k==="gwr"&&e.jsx(sa,{})]})}),Qt&&ut&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>$e(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>$e(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-6 pt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900 mb-6",children:"League Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),e.jsxs("div",{className:"space-y-2",children:[b.filter(s=>s.id!==n?.id).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-800",children:s.name}),e.jsx("button",{onClick:()=>{Yt(s),St(!0),$e(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-semibold",children:"Remove"})]},s.id)),b.filter(s=>s.id!==n?.id).length===0&&e.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:()=>{Ct(!0),$e(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2",children:"ðŸ—‘ï¸ End League"})})]})]})]})}),Ue&&kt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Oe(!1),De&&URL.revokeObjectURL(De),Xe(null),Te(null),Je(!1),at(null)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>{Oe(!1),De&&URL.revokeObjectURL(De),Xe(null),Te(null),Je(!1),at(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-4 pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-1",children:"League Badge"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Upload and customize your mini-league badge"}),He?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsx("p",{className:"font-medium",children:"Position your image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),e.jsx("div",{className:"relative w-full",style:{height:"280px"},children:e.jsx(ma,{image:He,crop:Es,zoom:jt,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Vt,onZoomChange:_t,onCropComplete:Ws,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(jt*100),"%"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:jt,onChange:s=>_t(Number(s.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:De?e.jsx("img",{src:De,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),Ge&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Ge}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{De&&URL.revokeObjectURL(De),Xe(null),Vt({x:0,y:0}),_t(1),Kt(null),at(null)},disabled:Ce,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),e.jsx("button",{onClick:zs,disabled:Ce||!ht,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:Ce?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:e.jsx("img",{src:r?Gt(r):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:s=>{const l=s.target;l.src="/assets/league-avatars/ML-avatar-1.png"}})}),r?.avatar&&e.jsx("button",{onClick:Os,disabled:Ce,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:s=>{const l=s.target.files?.[0];l&&Hs(l)},disabled:Ce,className:"hidden",id:"badge-upload-input"}),e.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),Ce&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),e.jsx("span",{children:"Processing and uploading..."})]}),Ls&&e.jsx("div",{className:"p-2 bg-emerald-50 border border-emerald-200 rounded-lg text-xs text-emerald-800",children:"âœ“ Badge uploaded successfully!"}),Ge&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Ge})]})]})]})]})}),e.jsx(ps,{isOpen:Le,onClose:()=>ft(!1),title:"League Points",description:`Win the week â€“ 3 points
Draw â€“ 1 point
Lose â€“ 0 points

ðŸ¤ Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${r&&(["The Bird league"].includes(r.name)||["gregVjofVcarl","Let Down"].includes(r.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),e.jsx(Qs,{}),e.jsx(Zs,{}),me&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',r?.name,`"? You'll need the league code to rejoin later.`]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>se(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:I,children:"Cancel"}),e.jsx("button",{onClick:$s,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:I,children:I?"Leaving...":"Leave League"})]})]})}),Rs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",e.jsxs("strong",{children:['"',r?.name,'"']}),". Are you sure?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ot(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Nt,children:"Cancel"}),e.jsx("button",{onClick:Us,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:Nt,children:Nt?"Joining...":"Join League"})]})]})}),Ms&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",e.jsxs("strong",{children:['"',bt?.name,'"']})," from the league? They will need the league code to rejoin."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>St(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Lt,children:"Cancel"}),e.jsx("button",{onClick:Fs,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Lt,children:Lt?"Removing...":"Remove Member"})]})]})}),Ts&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"âš ï¸ End League"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",e.jsx("strong",{children:"permanently end"})," the league ",e.jsxs("strong",{children:['"',r?.name,'"']}),"?"]}),e.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ct(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Et,children:"Cancel"}),e.jsx("button",{onClick:Bs,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Et,children:Et?"Ending...":"Yes, End League"})]})]})}),r?.name==="API Test"&&e.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),R&&r&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>H(!1),children:e.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:e.jsx("img",{src:Gt(r),alt:"League badge",className:"w-full h-full object-cover",onError:s=>{const l=s.target,m=`/assets/league-avatars/${xs(r.id)}`;l.src!==m&&(l.src=m)}})}),Ue&&e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),H(!1),Oe(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:e.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("div",{className:"text-white text-xl font-medium",children:r.name})]})})]}):null}export{qa as default};
