import{r as a,s as Ot,C as qt,a as I,g as ve,j as e,V as ta,U as tt,b as dt,u as _s,c as Ns,i as sa,d as ds,T as us,D as aa,e as ra,f as na,h as oa,k as ia,l as Bt,m as ms,n as fs,o as et,p as la,q as ca,L as hs,t as Wt,v as gs,I as xs,w as ps,x as bs}from"./index-jw27CSin.js";import{C as da}from"./index.module-v3HciTjm.js";const ke=[];for(let s=0;s<256;++s)ke.push((s+256).toString(16).slice(1));function ua(s,c=0){return(ke[s[c+0]]+ke[s[c+1]]+ke[s[c+2]]+ke[s[c+3]]+"-"+ke[s[c+4]]+ke[s[c+5]]+"-"+ke[s[c+6]]+ke[s[c+7]]+"-"+ke[s[c+8]]+ke[s[c+9]]+"-"+ke[s[c+10]]+ke[s[c+11]]+ke[s[c+12]]+ke[s[c+13]]+ke[s[c+14]]+ke[s[c+15]]).toLowerCase()}let Gt;const ma=new Uint8Array(16);function fa(){if(!Gt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Gt=crypto.getRandomValues.bind(crypto)}return Gt(ma)}const ha=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ws={randomUUID:ha};function ga(s,c,p){s=s||{};const f=s.random??s.rng?.()??fa();if(f.length<16)throw new Error("Random bytes length must be >= 16");return f[6]=f[6]&15|64,f[8]=f[8]&63|128,ua(f)}function xa(s,c,p){return ws.randomUUID&&!s?ws.randomUUID():ga(s)}const ys=50,Ve=s=>{let c=null;if(s.reply_to){const p=Array.isArray(s.reply_to)?s.reply_to[0]:s.reply_to;p&&p.id&&p.user_id&&(c={id:p.id,content:p.content||"",user_id:p.user_id,author_name:p.author_name})}return{id:s.id,league_id:s.league_id,user_id:s.user_id,content:s.content,created_at:s.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:s.reply_to_message_id??null,reply_to:c}},Ie=s=>{const c=new Map;for(const p of s)if(p.id.startsWith("optimistic-")&&p.client_msg_id)s.some(i=>!i.id.startsWith("optimistic-")&&i.client_msg_id===p.client_msg_id)||c.set(p.id,p);else{if(p.client_msg_id){const f=Array.from(c.keys()).find(i=>{const U=c.get(i);return U?.id.startsWith("optimistic-")&&U.client_msg_id===p.client_msg_id});f&&c.delete(f)}c.set(p.id,p)}return Array.from(c.values()).sort((p,f)=>new Date(p.created_at).getTime()-new Date(f.created_at).getTime())};function pa(s,c={}){const{userId:p,enabled:f=!0,autoSubscribe:i=!0}=c,U=()=>!s||!f?[]:ve(`chat:messages:${s}`)||[],[D,V]=a.useState(U),[n,z]=a.useState(!1),[B,q]=a.useState(!1),[oe,v]=a.useState(!0),[L,J]=a.useState(null),Z=a.useRef(null),te=a.useRef(null),_=a.useRef(!1),ie=a.useRef(null),Y=a.useRef(0),y=a.useCallback(se=>{V(Q=>{const ae=se(Q);if(Z.current=ae.length?ae[0].created_at:null,ie.current=ae.length?ae[ae.length-1].created_at:null,s&&ae.length>0){const le=ae.filter(X=>!X.id.startsWith("optimistic-"));if(le.length>0){const X=Date.now();if(X-Y.current>2e3){Y.current=X;const _e=`chat:messages:${s}`;Ot(_e,le,qt.HOME)}}}return ae})},[s]),fe=a.useCallback(async({before:se,append:Q})=>{if(!s||!f)return;const ae=I.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",s).order("created_at",{ascending:!1}).limit(ys);se&&ae.lt("created_at",se);const{data:le,error:X}=await ae;if(X)throw console.error("[useMiniLeagueChat] Error fetching messages:",X),X;const _e=(le??[]).filter($=>$.reply_to_message_id),pe=[...new Set(_e.map($=>$.reply_to_message_id))];let S=new Map;if(pe.length>0){const{data:$,error:d}=await I.from("league_messages").select("id, content, user_id").in("id",pe);d&&console.error("[useMiniLeagueChat] Error fetching reply messages:",d),!d&&$&&$.forEach(l=>{S.set(l.id,l)})}const me=(le??[]).map($=>{if($.reply_to_message_id){const d=S.get($.reply_to_message_id);d?$.reply_to=d:$.reply_to=null}else $.reply_to=null;return Ve($)}).reverse();y($=>Ie(Q?[...me,...$]:[...$,...me])),(le??[]).length<ys?v(!1):Q||v(!0)},[s,f,y]),xe=a.useRef(D);xe.current=D;const ue=a.useCallback(async()=>{if(!s||!f){V([]),v(!0);return}if(_.current)return;_.current=!0;const se=xe.current.length>0;se||z(!0),J(null);try{const Q=ve(`chat:messages:${s}`);Q&&Q.length>0&&!se&&(y(()=>Ie(Q)),Q.length>0&&(Z.current=Q[0].created_at,ie.current=Q[Q.length-1].created_at),v(Q.length>=50),z(!1)),await fe({append:!1})}catch(Q){console.error("[useMiniLeagueChat] Error in refresh:",Q),J(Q?.message??"Failed to load chat")}finally{_.current=!1,z(!1)}},[s,f,fe,y]);a.useEffect(()=>{if(!s||!f){V([]),v(!0),te.current=null;return}if(te.current===s)return;te.current=s;const se=xe.current,Q=se.length>0,ae=ve(`chat:messages:${s}`);if(Q||ae&&ae.length>0?(!Q&&ae?(y(()=>ae),ae.length>0&&(Z.current=ae[0].created_at,ie.current=ae[ae.length-1].created_at),v(ae.length>=50)):Q&&se.length>0&&(Z.current=se[0].created_at,ie.current=se[se.length-1].created_at,v(se.length>=50)),te.current=null):ue().finally(()=>{te.current===s&&(te.current=null)}),!i)return()=>{};let le=!0,X=null,_e=Date.now();const pe=3e4,S=()=>{X||(X=setInterval(()=>{if(!le)return;const d=Date.now();if(d-_e>=pe&&!_.current){_e=d;const l=ie.current;l?(async()=>{try{const{data:g,error:A}=await I.from("league_messages").select("id, league_id, user_id, content, created_at, reply_to_message_id").eq("league_id",s).gt("created_at",l).order("created_at",{ascending:!0});if(!le||A||!g||g.length===0)return;const j=g.filter(w=>w.reply_to_message_id),b=[...new Set(j.map(w=>w.reply_to_message_id))];if(b.length>0){const{data:w}=await I.from("league_messages").select("id, content, user_id").in("id",b);if(!le||!w)return;const M=new Map;w.forEach(W=>{M.set(W.id,W)});const H=g.map(W=>(W.reply_to_message_id&&M.has(W.reply_to_message_id)&&(W.reply_to=M.get(W.reply_to_message_id)),Ve(W)));y(W=>Ie([...W,...H]))}else{const w=g.map(M=>Ve(M));y(M=>Ie([...M,...w]))}}catch(g){console.warn("[useMiniLeagueChat] Periodic refresh failed:",g)}})():ue().catch(g=>{console.warn("[useMiniLeagueChat] Periodic refresh failed:",g)})}},pe))},me=I.channel(`league-messages:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${s}`},async d=>{if(le)try{const{data:l,error:g}=await I.from("league_messages").select(`
                id, 
                league_id, 
                user_id, 
                content, 
                created_at,
                reply_to_message_id
              `).eq("id",d.new.id).single();if(g&&console.error("[useMiniLeagueChat] Error fetching full message:",g),l){if(l.reply_to_message_id){const{data:j}=await I.from("league_messages").select("id, content, user_id").eq("id",l.reply_to_message_id).single();j&&(l.reply_to=j)}const A=Ve(l);y(j=>{if(j.some(w=>w.id===A.id||w.client_msg_id&&w.client_msg_id===A.client_msg_id)){const w=j.findIndex(M=>M.client_msg_id&&M.client_msg_id===A.client_msg_id&&M.id.startsWith("optimistic-"));if(w>=0){const M=[...j];return M[w]=A,Ie(M)}return j}return Ie([...j,A])})}else{const A=Ve(d.new);y(j=>j.some(w=>w.id===A.id)?j:Ie([...j,A]))}}catch(l){console.error("[useMiniLeagueChat] Error processing real-time message:",l);try{const g=Ve(d.new);y(A=>A.some(b=>b.id===g.id)?A:Ie([...A,g]))}catch(g){console.error("[useMiniLeagueChat] Fallback also failed:",g)}}}).subscribe(d=>{d==="SUBSCRIBED"?S():(d==="CHANNEL_ERROR"||d==="TIMED_OUT"||d==="CLOSED")&&(S(),setTimeout(()=>{le&&s&&(me.unsubscribe(),me.subscribe())},5e3))}),$=()=>{le&&document.visibilityState==="visible"&&!_.current&&(_e=Date.now(),ue())};return document.addEventListener("visibilitychange",$),S(),()=>{le=!1,document.removeEventListener("visibilitychange",$),X&&(clearInterval(X),X=null),I.removeChannel(me)}},[s,f,i,ue,y]);const ye=a.useCallback(async()=>{if(!s||!f||!oe||B)return;const se=Z.current??D[0]?.created_at;if(se){q(!0);try{await fe({before:se,append:!0})}catch(Q){console.error("[useMiniLeagueChat] Error loading more messages:",Q),J(Q?.message??"Failed to load more messages")}finally{q(!1)}}},[s,f,oe,B,fe,D]),je=a.useCallback(async(se,Q)=>{if(!s||!p)throw new Error("Missing league or user");const ae=se.trim();if(!ae)return;const le=xa(),X=`optimistic-${le}`,_e={id:X,client_msg_id:le,league_id:s,user_id:p,content:ae,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:Q??null};y(me=>Ie([...me,_e]));const{data:pe,error:S}=await I.from("league_messages").insert({league_id:s,user_id:p,content:ae,reply_to_message_id:Q??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(pe&&pe.reply_to_message_id){const{data:me}=await I.from("league_messages").select("id, content, user_id").eq("id",pe.reply_to_message_id).single();me&&(pe.reply_to=me)}if(S)throw console.error("[useMiniLeagueChat] Error sending message:",S),y(me=>me.map($=>$.id===X?{...$,status:"error"}:$)),S;if(pe){if(pe.reply_to_message_id){const{data:$}=await I.from("league_messages").select("id, content, user_id").eq("id",pe.reply_to_message_id).single();$&&(pe.reply_to=$)}const me=Ve(pe);me.client_msg_id=le,me.status="sent",y($=>{const d=$.findIndex(g=>g.id===X||g.client_msg_id===le&&g.id.startsWith("optimistic-"));let l;if(d>=0){const g=[...$];g[d]=me,l=Ie(g)}else $.some(A=>A.id===me.id||A.client_msg_id===le&&!A.id.startsWith("optimistic-"))?l=$:l=Ie([...$,me]);if(s&&l.length>0){const g=l.filter(A=>!A.id.startsWith("optimistic-"));if(g.length>0){const A=`chat:messages:${s}`;Y.current=Date.now(),Ot(A,g,qt.HOME)}}return l})}},[s,p,y]),Le=a.useMemo(()=>D.slice(-5),[D]);return{messages:D,previewMessages:Le,loading:n,loadingMore:B,hasMore:oe,error:L,refresh:ue,loadMore:ye,sendMessage:je}}const ba={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},wa={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},ya=["ðŸ‘","â¤ï¸","ðŸ˜‚"],va=["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ¤¡","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸŽƒ","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾"];function ka({author:s,text:c,time:p,isOwnMessage:f,shape:i="single",messageId:U,reactions:D=[],onReactionClick:V,replyTo:n,onMessageClick:z}){const B="text-left",q=f?"bg-[#1C8376] text-white":"bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",oe=f?wa:ba,v="max-w-[85%]",[L,J]=a.useState(!1),[Z,te]=a.useState(!1),_=a.useRef(null);a.useEffect(()=>{if(!L)return;const y=xe=>{_.current&&!_.current.contains(xe.target)&&J(!1)},fe=setTimeout(()=>{document.addEventListener("mousedown",y)},100);return()=>{clearTimeout(fe),document.removeEventListener("mousedown",y)}},[L]);const ie=y=>{U&&V&&V(U,y),J(!1),te(!1)},Y=y=>{const fe=y.target;fe.closest("button")||fe.closest("[data-reaction]")||z&&z()};return e.jsxs("div",{className:`inline-block ${v} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},"data-message-id":U,children:[e.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${B} ${q} ${oe[i]} ${z?"cursor-pointer":""}`,onClick:Y,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[s&&!f&&e.jsx("div",{className:"text-xs font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:s}),n&&e.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${f?"border-white/30 text-white/90":"border-[#1C8376] dark:border-emerald-400 text-slate-600 dark:text-slate-300"} pl-2 text-xs dark:text-slate-300`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[e.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.authorName||"Unknown"}),e.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:n.content})]}),e.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[e.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:c}),e.jsx("span",{className:`text-xs relative top-1 ${f?"text-[#DCDCDD]":"text-slate-400 dark:text-slate-500"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:p})]})]}),U&&!f&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[L&&e.jsxs("div",{ref:_,className:"flex items-center gap-1 bg-white dark:bg-slate-800 rounded-full px-1 py-1 shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[ya.map(y=>e.jsx("button",{onClick:()=>ie(y),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${y}`,children:y},y)),z&&e.jsx("button",{onClick:()=>{J(!1),z()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:()=>{J(!1),te(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:e.jsx("span",{className:"text-sm",children:"+"})})]}),e.jsx("button",{onClick:()=>J(!L),className:"w-7 h-7 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 flex items-center justify-center shadow-sm",title:"Add reaction",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),Z&&U&&!f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>te(!1)}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-800 rounded-t-2xl shadow-2xl border-t border-slate-200 dark:border-slate-700 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:e.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"}),e.jsx("button",{onClick:()=>te(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 rounded-lg",children:"Close"}),e.jsx("div",{className:"w-12"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:va.map(y=>e.jsx("button",{onClick:()=>{U&&V&&V(U,y),te(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 dark:active:bg-slate-700 flex items-center justify-center text-2xl",title:y,children:y},y))})]})})]}),D.length>0&&e.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${f?"justify-end":"justify-start"}`,children:D.map(y=>e.jsxs("button",{onClick:()=>ie(y.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${y.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200"}`,children:[e.jsx("span",{className:"text-base",children:y.emoji}),e.jsx("span",{children:y.count})]},y.emoji))})]})}function ja({author:s,messages:c,isOwnMessage:p,avatarInitials:f,userId:i,reactions:U,onReactionClick:D,onMessageClick:V}){const n=p?"justify-end":"justify-start",z=i===dt;return e.jsxs("div",{className:`flex items-end gap-2 w-full ${n}`,children:[p?e.jsx("div",{className:"w-8 flex-shrink-0"}):z?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 dark:border-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:ta,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):i?e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:i,name:s,size:32,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-xs font-semibold text-slate-500 dark:text-slate-400 flex-shrink-0",children:(f||s.charAt(0)).toUpperCase()}),e.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:c.map((B,q)=>{const oe=c.length===1?"single":q===0?"top":q===c.length-1?"bottom":"middle",v=B.messageId||B.id;let L="";if(typeof B.text=="string")L=B.text;else if(typeof B.text=="object"&&B.text!==null){const J=B.text?.props?.children||String(B.text);L=typeof J=="string"?J:String(J)}else L=String(B.text);return e.jsx("div",{className:`flex flex-col w-full min-w-0 ${p?"items-end":"items-start"}`,children:e.jsxs("div",{className:`flex w-full min-w-0 ${p?"justify-end":"justify-start"}`,children:[e.jsx(ka,{author:!p&&q===0?s:void 0,text:B.text,time:B.time,isOwnMessage:p,shape:oe,messageId:v,reactions:U?.[v]||[],onReactionClick:D,replyTo:B.replyTo,onMessageClick:V?()=>V(v,L,!p&&q===0?s:void 0):void 0}),B.status&&e.jsx("div",{className:`text-xs ml-2 ${B.status==="error"?"text-red-500":"text-slate-400 dark:text-slate-500"}`,children:B.status==="error"?"Failed":"Sendingâ€¦"})]})},B.id)})})]})}function _a({groups:s,reactions:c,onReactionClick:p,onMessageClick:f}){return e.jsx("div",{className:"flex flex-col gap-5",children:s.map((i,U)=>e.jsxs("div",{className:"flex flex-col gap-3",children:[i.dayLabel&&e.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:i.dayLabel}),e.jsx(ja,{author:i.author,avatarInitials:i.avatarInitials,isOwnMessage:i.isOwnMessage,userId:i.userId,messages:i.messages,reactions:c,onReactionClick:p,onMessageClick:f},`${i.id}-${i.author}-${U}`)]},`${i.id}-${i.author}-${U}`))})}const Na=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Sa=s=>new Date(s).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),vs=s=>{if(!s)return"?";const c=s.trim().split(/\s+/);return c.length===1?c[0][0]?.toUpperCase()??"?":`${c[0][0]?.toUpperCase()??""}${c[c.length-1][0]?.toUpperCase()??""}`},Je=(s,c,p)=>{if(s===dt)return Ns;if(c)if(c instanceof Map){const f=c.get(s);if(f)return f}else{const f=c[s];if(f)return f}if(p){const f=p.get(s);if(f)return f}return""};function Ca({miniLeagueId:s,memberNames:c,deepLinkError:p}){const{user:f}=_s(),{messages:i,error:U,sendMessage:D}=pa(s,{userId:f?.id,enabled:!!s}),[V,n]=a.useState(""),[z,B]=a.useState(!1),[q,oe]=a.useState({}),[v,L]=a.useState(null),[J,Z]=a.useState([]),[te,_]=a.useState(new Map),ie=a.useRef(new Set),Y=a.useRef(null),y=a.useRef(null),fe=a.useRef(null),xe=a.useRef(!1),[ue,ye]=a.useState(0);a.useEffect(()=>{if(i.length===0)return;const d=[];for(const l of i){const g=l.user_id;ie.current.has(g)||g===dt||Je(g,c)||g!==f?.id&&d.push(g)}for(const l of i)if(l.reply_to?.user_id){const g=l.reply_to.user_id;if(ie.current.has(g)||g===dt||Je(g,c)||g===f?.id)continue;d.includes(g)||d.push(g)}d.length!==0&&(d.forEach(l=>ie.current.add(l)),console.log("[MiniLeagueChatBeta] Fetching names for",d.length,"missing user IDs"),(async()=>{try{const{data:l,error:g}=await I.from("users").select("id, name").in("id",d);if(g){console.error("[MiniLeagueChatBeta] Error fetching user names:",g);return}l&&l.length>0&&(_(A=>{const j=new Map(A);for(const b of l)b.id&&b.name&&j.set(b.id,b.name);return j}),console.log("[MiniLeagueChatBeta] Fetched",l.length,"additional user names"))}catch(l){console.error("[MiniLeagueChatBeta] Error fetching user names:",l)}})())},[i,c,f?.id]),a.useEffect(()=>{if(!s||!f?.id)return;let d=!0;const l=s,g=f.id,A=async()=>{if(d)try{const{error:M}=await I.from("chat_presence").upsert({league_id:l,user_id:g,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});M&&console.warn("[MiniLeagueChatBeta] Failed to update presence:",M)}catch(M){console.warn("[MiniLeagueChatBeta] Error updating presence:",M)}},j=async()=>{try{await I.from("chat_presence").delete().eq("league_id",l).eq("user_id",g)}catch(M){console.warn("[MiniLeagueChatBeta] Error clearing presence:",M)}};A();const b=setInterval(()=>{d&&A()},1e4),w=()=>{document.visibilityState==="hidden"?j():document.visibilityState==="visible"&&d&&A()};return document.addEventListener("visibilitychange",w),()=>{d=!1,clearInterval(b),document.removeEventListener("visibilitychange",w),j()}},[s,f?.id]),a.useEffect(()=>{xe.current=!1},[s]);const je=a.useCallback(()=>{if(Y.current){const d=Y.current.scrollHeight-Y.current.clientHeight;Y.current.scrollTop=d}},[]);a.useEffect(()=>{if(i.length===0||!f?.id)return;const d=i.map(g=>g.id).filter(g=>!g.startsWith("optimistic-"));if(d.length===0)return;(async()=>{try{const{data:g,error:A}=await I.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",d);if(A){Z(w=>[...w,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${A.message}`,timestamp:Date.now()}]);return}const j={};(g||[]).forEach(w=>{j[w.message_id]||(j[w.message_id]={}),j[w.message_id][w.emoji]||(j[w.message_id][w.emoji]={count:0,hasUserReacted:!1}),j[w.message_id][w.emoji].count++,w.user_id===f.id&&(j[w.message_id][w.emoji].hasUserReacted=!0)});const b={};Object.keys(j).forEach(w=>{b[w]=Object.entries(j[w]).map(([M,H])=>({emoji:M,count:H.count,hasUserReacted:H.hasUserReacted}))}),oe(b)}catch(g){Z(A=>[...A,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${g?.message||String(g)}`,timestamp:Date.now()}])}})()},[i,f?.id]),a.useEffect(()=>{if(i.length===0||!f?.id)return;const d=i.map(g=>g.id).filter(g=>!g.startsWith("optimistic-"));if(d.length===0)return;const l=I.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},async()=>{try{const{data:g,error:A}=await I.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",d);if(A)return;const j={};(g||[]).forEach(w=>{j[w.message_id]||(j[w.message_id]={}),j[w.message_id][w.emoji]||(j[w.message_id][w.emoji]={count:0,hasUserReacted:!1}),j[w.message_id][w.emoji].count++,w.user_id===f.id&&(j[w.message_id][w.emoji].hasUserReacted=!0)});const b={};Object.keys(j).forEach(w=>{b[w]=Object.entries(j[w]).map(([M,H])=>({emoji:M,count:H.count,hasUserReacted:H.hasUserReacted}))}),oe(b)}catch{}}).subscribe();return()=>{I.removeChannel(l)}},[i,f?.id]);const Le=a.useCallback(async(d,l)=>{if(!f?.id)return;const A=(q[d]||[]).find(j=>j.emoji===l&&j.hasUserReacted);if(oe(j=>{const b={...j},w=b[d]||[];if(A){const M=w.map(H=>H.emoji===l?{...H,count:Math.max(0,H.count-1),hasUserReacted:!1}:H).filter(H=>H.count>0||H.emoji!==l);M.length===0?delete b[d]:b[d]=M}else w.find(H=>H.emoji===l)?b[d]=w.map(H=>H.emoji===l?{...H,count:H.count+1,hasUserReacted:!0}:H):b[d]=[...w,{emoji:l,count:1,hasUserReacted:!0}];return b}),A){const{error:j}=await I.from("league_message_reactions").delete().eq("message_id",d).eq("user_id",f.id).eq("emoji",l);j&&oe(b=>{const w={...b},M=w[d]||[];return M.find(W=>W.emoji===l)?w[d]=M.map(W=>W.emoji===l?{...W,count:W.count+1,hasUserReacted:!0}:W):w[d]=[...M,{emoji:l,count:1,hasUserReacted:!0}],w})}else{const{error:j}=await I.from("league_message_reactions").upsert({message_id:d,user_id:f.id,emoji:l});j&&oe(b=>{const w={...b},H=(w[d]||[]).map(W=>W.emoji===l?{...W,count:Math.max(0,W.count-1),hasUserReacted:!1}:W).filter(W=>W.count>0||W.emoji!==l);return H.length===0?delete w[d]:w[d]=H,w})}},[f?.id,q]);a.useEffect(()=>{!V&&y.current&&(y.current.style.height="auto",y.current.style.height="42px")},[V]);const se=a.useCallback(d=>{const l=fe.current?.offsetHeight||72;if(d>0){const g=d+l;if(ye(d),Y.current){const A=`${g+8}px`;Y.current.style.paddingBottom=A}}else if(ye(0),Y.current){const g=`${l+8}px`;Y.current.style.paddingBottom=g}requestAnimationFrame(()=>{je()})},[je]);a.useEffect(()=>{const d=window.visualViewport;if(!d)return;let l=null,g=0,A=!1;setTimeout(()=>{A=!0},500);const j=()=>{const W=window.innerHeight,ze=d.height,Ke=d.offsetTop+ze;return Math.max(0,W-Ke)},b=()=>{l&&clearTimeout(l),l=setTimeout(()=>{const W=j();A&&Math.abs(W-g)>10&&(g=W,se(W))},50)};d.addEventListener("resize",b),d.addEventListener("scroll",b),window.addEventListener("resize",b);const w=()=>{setTimeout(b,50)},M=()=>{setTimeout(b,100)},H=setTimeout(()=>{y.current&&(y.current.addEventListener("focus",w),y.current.addEventListener("blur",M))},100);return b(),()=>{l&&clearTimeout(l),clearTimeout(H),d.removeEventListener("resize",b),d.removeEventListener("scroll",b),window.removeEventListener("resize",b),y.current&&(y.current.removeEventListener("focus",w),y.current.removeEventListener("blur",M))}},[se]),a.useEffect(()=>{if(Y.current&&fe.current){const l=`${(fe.current.offsetHeight||72)+8}px`;Y.current.style.paddingBottom=l}},[]);const Q=()=>{y.current&&y.current.removeAttribute("readonly");const d=()=>{const l=window.visualViewport;if(l){const g=window.innerHeight,A=l.height,j=l.offsetTop+A,b=Math.max(0,g-j);se(b)}};setTimeout(d,50),setTimeout(d,150),je()},ae=d=>{const l=d.target;!(l.tagName==="A"||l.tagName==="BUTTON"||l.closest("a, button"))&&y.current&&document.activeElement===y.current&&y.current.blur()},le=a.useMemo(()=>{if(!f)return"";const d=f.user_metadata??{};return d.display_name||d.full_name||f.email||""},[f]),X=a.useMemo(()=>{if(!i.length)return[];const d=c instanceof Map?c.size>0:c?Object.keys(c).length>0:!1,l=te.size>0;if(!d&&!l)return console.log("[MiniLeagueChatBeta] No names available yet, returning empty groups"),[];let g=null;return i.reduce((j,b)=>{const w=b.user_id===f?.id,W=Je(b.user_id,c,te)||(w?le:"")||(w?"You":"Unknown"),ze=w?void 0:vs(W),ut=new Date(b.created_at).toDateString(),st=ut!==g;st&&(g=ut);const Oe=b.reply_to?Je(b.reply_to.user_id,c,te)||"Unknown":null,Ye={id:b.id,text:b.content,time:Na(b.created_at),status:b.status&&b.status!=="sent"?b.status:void 0,messageId:b.id,replyTo:b.reply_to?{id:b.reply_to.id,content:b.reply_to.content,authorName:Oe||void 0}:null},Ee=j[j.length-1],vt=Ee?.messages.length>0&&Ee.messages[0].messageId?i.find(at=>at.id===Ee.messages[0].messageId)?.user_id:null;if(Ee&&!st&&Ee.isOwnMessage===w&&vt===b.user_id){const at=Ee.id.includes("-")?Ee.id.split("-")[0]:Ee.id,mt=Ee.messages.map(Re=>{const Ue=Re.messageId?i.find(Be=>Be.id===Re.messageId):null;if(Ue?.reply_to){const Be=Je(Ue.reply_to.user_id,c,te)||"Unknown";return{...Re,replyTo:Re.replyTo?{...Re.replyTo,authorName:Be}:null}}return Re}),jt={...Ee,id:`${at}-${W}`,author:W,avatarInitials:ze,userId:b.user_id,messages:[...mt,Ye]};return[...j.slice(0,-1),jt]}else return[...j,{id:`${b.id}-${W}`,author:W,avatarInitials:ze,isOwnMessage:w,userId:b.user_id,dayLabel:st?Sa(b.created_at):void 0,messages:[Ye]}]},[]).map(j=>{const b={...j},w=b.messages.map(M=>{const H=M.messageId?i.find(W=>W.id===M.messageId):null;if(H?.reply_to&&M.replyTo){const W=Je(H.reply_to.user_id,c,te)||"Unknown";if(W!==M.replyTo.authorName)return{...M,replyTo:{...M.replyTo,authorName:W}}}return M});if(b.author==="Unknown"&&b.messages.length>0&&b.messages[0].messageId){const M=i.find(H=>H.id===b.messages[0].messageId);if(M){const H=Je(M.user_id,c,te);if(H&&H!=="Unknown"){const W=b.id.includes("-")?b.id.split("-")[0]:b.id;return{...b,id:`${W}-${H}`,author:H,avatarInitials:vs(H),userId:M.user_id,messages:w}}}}return{...b,messages:w}})},[le,c,te,i,f?.id]),_e=a.useMemo(()=>{const d=X.map(g=>g.author).join(","),l=X.some(g=>g.author==="Unknown");return`chat-${X.length}-${l?"unknown":"resolved"}-${d.slice(0,50)}`},[X]),pe=a.useCallback(d=>{if(Y.current=d,d){if(fe.current){const g=`${(fe.current.offsetHeight||72)+8}px`;d.style.paddingBottom=g}else d.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{d&&i.length>0&&X.length>0})})}},[i.length,X.length]);a.useEffect(()=>{xe.current=!1},[s]),a.useEffect(()=>{i.length>0&&Y.current&&(xe.current||(xe.current=!0),requestAnimationFrame(()=>{if(Y.current){const d=Y.current.scrollHeight,l=Y.current.clientHeight,g=d-l;d>l&&(Y.current.scrollTop=g)}}))},[i.length,i]);const S=a.useCallback(async d=>{if(!s||!f?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const g=f.user_metadata?.display_name||f.user_metadata?.full_name||f.email||"User";try{await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:s,senderId:f.id,senderName:g,content:d,activeUserIds:[f.id]})})}catch{}},[s,f?.id]),me=a.useCallback(async()=>{const d=V.trim();if(!(!s||!d||z))try{B(!0),n(""),y.current&&(y.current.style.height="auto",y.current.style.height="42px"),await D(d,v?.id||null),await S(d),L(null),je()}catch(l){Z(g=>[...g,{id:`send-${Date.now()}`,message:`Failed to send message: ${l?.message||String(l)}`,timestamp:Date.now()}]),n(d)}finally{B(!1)}},[V,s,S,je,D,z,v]);a.useEffect(()=>{p&&Z(d=>d.some(l=>l.message.includes("Deep Link"))?d:[...d,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${p}`,timestamp:Date.now()}])},[p]),a.useEffect(()=>{if(J.length===0)return;const d=setTimeout(()=>{Z(l=>l.filter(g=>Date.now()-g.timestamp<5e3))},5e3);return()=>clearTimeout(d)},[J]);const $=i.length>0&&X.length>0;return e.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[J.length>0&&e.jsx("div",{className:"px-4 pt-2 space-y-2",children:J.map(d=>e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[e.jsx("span",{className:"flex-1",children:d.message}),e.jsx("button",{onClick:()=>Z(l=>l.filter(g=>g.id!==d.id)),className:"text-red-600 flex-shrink-0",children:"Ã—"})]},d.id))}),e.jsx("div",{ref:pe,className:"flex-1 overflow-y-auto px-4 py-5",onClick:ae,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingBottom:"91px"},children:$?e.jsx(e.Fragment,{children:e.jsx(_a,{groups:X,reactions:q,onReactionClick:Le,onMessageClick:(d,l,g)=>{const A=i.find(j=>j.id===d);if(A){let j="";if(typeof l=="string")j=l;else if(typeof l=="object"&&l!==null){const b=l?.props?.children||String(l);j=typeof b=="string"?b:String(b)}else j=String(l);L({id:d,content:j||A.content,authorName:g}),setTimeout(()=>{y.current?.focus()},100)}}},_e)}):null}),e.jsxs("div",{ref:fe,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:ue>0?"fixed":"relative",bottom:ue>0?`${ue}px`:"0",left:ue>0?0:"auto",right:ue>0?0:"auto",width:"100%",maxWidth:ue>0?"440px":"100%",marginLeft:ue>0?"auto":void 0,marginRight:ue>0?"auto":void 0,zIndex:ue>0?100:"auto",boxShadow:ue>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[v&&e.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",v.authorName||"Unknown"]}),e.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:v.content})]}),e.jsx("button",{onClick:()=>L(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[e.jsx("textarea",{ref:y,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:V,disabled:!s||z,placeholder:s?"Start typing a messageâ€¦":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:d=>{if(d.key==="Escape"&&v){L(null),d.preventDefault();return}d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),me())},onChange:d=>{n(d.target.value),y.current&&(y.current.style.height="auto",y.current.style.height=`${Math.min(y.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const l=window.visualViewport;if(l){const g=window.innerHeight,A=l.height,j=l.offsetTop+A,b=g-j;se(b)}})},onFocus:Q,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),e.jsx("button",{type:"button",onClick:me,disabled:!s||z||!V.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),U&&e.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[U," â€” try again or switch to the classic chat tab."]})]})]})}function La({winnerName:s,isDraw:c}){return e.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:e.jsx("div",{className:"text-center relative z-10",children:c?e.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):e.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[s," Wins!"]})})})}function Ea({availableGws:s,selectedGw:c,onChange:p,className:f=""}){return s.length<=1?null:e.jsxs("div",{className:`flex-1 ${f}`,children:[e.jsx("style",{children:`
        .gw-selector option {
          background-color: white;
          color: #64748b;
        }
        .dark .gw-selector option {
          background-color: #1e293b;
          color: #ffffff;
        }
        .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
        .dark .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
      `}),e.jsx("select",{value:c||void 0,onChange:i=>{const U=parseInt(i.target.value,10);p(U)},className:"gw-selector w-full bg-white dark:bg-slate-800 rounded-full border-2 border-slate-300 dark:border-slate-600 px-3 py-2 text-xs font-normal text-slate-600 dark:text-white text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 dark:active:bg-slate-700 transition-colors",style:{minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:s.map(i=>e.jsxs("option",{value:i,className:"text-xs",children:["Gameweek ",i]},i))})]})}function Ra({showForm:s,onToggle:c}){return e.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 dark:bg-slate-800 p-0.5 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>c(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${s?"text-slate-600 dark:text-slate-400":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),e.jsx("button",{onClick:()=>c(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${s?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 dark:text-slate-400"}`,children:"Form"})]})}function Ma({form:s}){const c=s.slice(-5),p=5-c.length;return e.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:p}).map((f,i)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${i}`)),c.map((f,i)=>e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${f==="W"?"bg-emerald-100 text-emerald-700":f==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:f},i))]})}function Ta({rows:s,members:c,showForm:p,currentUserId:f,loading:i,isLateStartingLeague:U}){return e.jsxs("div",{className:"pt-4",children:[e.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),e.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",borderBottom:"none",boxShadow:"none"},children:e.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",border:"none",borderBottom:"none"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:"Player"}),p?e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Form"}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"W"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"D"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:U?"CP":"OCP"}),c.length>=3&&e.jsx("th",{className:"py-3 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"PTS"})]})]})}),e.jsxs("tbody",{children:[s.map((D,V)=>{const n=D.user_id===f,z=V===s.length-1;return e.jsxs("tr",{className:n?"flash-user-row":"",style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...z?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:V+1}),e.jsx("td",{className:"py-4 bg-slate-50 dark:bg-slate-900 pl-0 pr-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:D.user_id,name:D.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:D.name})]})}),p?e.jsx("td",{className:"px-4 py-4 bg-slate-50 dark:bg-slate-900",children:e.jsx(Ma,{form:D.form})}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:D.wins}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:D.draws}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-10 pl-1 pr-1",children:D.ocp}),c.length>=3&&e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:D.unicorns}),e.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-10 pl-1 pr-1",children:D.mltPts})]})]},D.user_id)}),i&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:p?3:c.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"Calculatingâ€¦"})}),!i&&!s.length&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:p?3:c.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"No gameweeks completed yet â€” this will populate after the first results are saved."})})]})]})})]})}function Ia({rows:s,members:c,currentUserId:p,positionChangeKeys:f,isApiTestLeague:i,hasLiveFixtures:U,hasStartingSoonFixtures:D,hasStartedFixtures:V,allFixturesFinished:n,resGw:z}){return e.jsxs("div",{children:[e.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
        .dark .full-width-header-border::after {
          background-color: #475569;
        }
      `}),e.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 shadow-sm",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:e.jsxs("div",{className:"flex items-center gap-2",children:["Player",i&&U&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),i&&!n&&D&&!U&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-[10px] font-medium",children:V?"Next Game Starting Soon":"Starting soon"})]})]})}),e.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Score"}),c.length>=3&&e.jsx("th",{className:"py-4 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"})]})}),e.jsxs("tbody",{children:[s.map((B,q)=>{const oe=B.user_id===p,v=q===s.length-1,L=f.has(B.user_id);return e.jsxs("tr",{className:`${oe?"flash-user-row":""} ${L?"position-changed":""}`,style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...v?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:q+1}),e.jsx("td",{className:"py-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[i&&U&&e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),i&&!U&&D&&e.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tt,{userId:B.user_id,name:B.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:B.name})]})}),e.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-[50px] pl-1 pr-1 ${i&&U?"pulse-live-score":""}`,children:B.score}),c.length>=3&&e.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1 ${i&&U?"pulse-live-score":""}`,children:B.unicorns})]},B.user_id)}),!s.length&&e.jsx("tr",{className:"bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},colSpan:c.length>=3?4:3,children:["No results recorded for GW ",z," yet."]})})]})]})})]})}function Aa(s){const c=sa(),p=encodeURIComponent(s);if(c){const f=`whatsapp://send?text=${p}`;let i=!1,U=!1;try{const D=document.createElement("a");D.href=f,D.style.display="none",document.body.appendChild(D),D.click(),i=!0,setTimeout(()=>{document.body.contains(D)&&document.body.removeChild(D)},100)}catch{}if(!i)try{window.open(f),U=!0}catch{}if(!i&&!U)try{window.location.href=f}catch{window.open(`https://wa.me/?text=${p}`,"_blank")}}else{const f=`https://wa.me/?text=${p}`;try{window.open(f,"_blank")}catch{navigator.clipboard.writeText(s).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+s)})}}}function Da(s,c){const p=new Date(c.find(q=>q.gw===s)?.kickoff_time||""),f=new Date(p.getTime()-4500*1e3),i=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],U=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],D=i[f.getUTCDay()],V=f.getUTCDate(),n=U[f.getUTCMonth()],z=f.getUTCHours().toString().padStart(2,"0"),B=f.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${s} Predictions Reminder!

DEADLINE: THIS ${D} ${V} ${n}, ${z}:${B} BST

Don't forget!
playtotl.com`}function Pa(s,c){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",s);try{const p=Da(s,c);console.log("[SubmissionStatusTable] Generated message:",p),Aa(p)}catch(p){console.error("[SubmissionStatusTable] Error in handleShareReminder:",p),alert("Error sharing reminder. Please try again.")}}function ks({members:s,submittedMap:c,picksGw:p,allSubmitted:f,remaining:i,fixtures:U,onShareReminder:D,variant:V="full"}){const n=D||(()=>Pa(p,U)),z=U.map(L=>L.kickoff_time).filter(L=>!!L).map(L=>new Date(L)).filter(L=>!isNaN(L.getTime())),B=z.length>0?new Date(Math.min(...z.map(L=>L.getTime()))):null,q=B?new Date(B.getTime()-4500*1e3):null,oe=q?new Date>=q:!1;let v="";if(q){const L=V==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Z=L[q.getUTCDay()],te=q.getUTCDate(),_=J[q.getUTCMonth()],ie=q.getUTCHours().toString().padStart(2,"0"),Y=q.getUTCMinutes().toString().padStart(2,"0");v=`${Z} ${te} ${_}, ${ie}:${Y} BST`}return V==="compact"?e.jsxs("div",{className:"mt-2 pt-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:i})," of ",s.length," to submit."]})}),!f&&e.jsxs("button",{type:"button",onClick:L=>{L.preventDefault(),L.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),n()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),v&&e.jsxs("div",{className:`mb-3 text-xs font-medium ${oe?"text-orange-600 dark:text-orange-400":"text-slate-600 dark:text-slate-400"} flex items-center gap-1.5`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),oe?"Deadline Passed:":"Deadline:",v]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:s.slice().sort((L,J)=>L.name.localeCompare(J.name)).map(L=>{const J=`${L.id}:${p}`,Z=!!c.get(J);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{userId:L.id,name:L.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:L.name})]})}),e.jsx("td",{className:"px-4 py-3",children:Z?e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},L.id)})})]})})]}):e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-700 dark:text-slate-300",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{children:f?e.jsxs(e.Fragment,{children:["All ",s.length," members have submitted."]}):e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:i})," of ",s.length," to submit."]})}),!f&&e.jsxs("button",{type:"button",onClick:L=>{L.preventDefault(),L.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),n()},className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),v&&e.jsxs("div",{className:`mb-3 text-sm ${oe?"text-orange-600 dark:text-orange-400 font-semibold":"text-slate-600 dark:text-slate-400"}`,children:[oe?"â° Deadline Passed:":"â° Deadline:",v]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:s.slice().sort((L,J)=>L.name.localeCompare(J.name)).map(L=>{const J=`${L.id}:${p}`,Z=!!c.get(J);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{userId:L.id,name:L.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:L.name})]})}),e.jsx("td",{className:"px-4 py-3",children:Z?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"âœ… Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"â³ Not yet"})})]},L.id)})})]})})]})}function Ua({letter:s,userId:c,userName:p,correct:f,unicorn:i,hasSubmitted:U,isLive:D,isOngoing:V,isFinished:n}){let z;f===!0?D||V?z="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":n?z="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white relative overflow-hidden before:absolute before:inset-0 before:z-10 before:pointer-events-none before:w-[200%] before:bg-gradient-to-r before:from-transparent before:via-white/40 before:via-white/50 before:via-white/40 before:to-transparent before:animate-[shimmer_2.5s_ease-in-out_infinite] after:absolute after:inset-0 after:z-10 after:pointer-events-none after:w-[200%] after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:via-yellow-200/40 after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_3s_ease-in-out_infinite_0.5s]":z="bg-emerald-600 text-white border-emerald-600":U?z="bg-emerald-600 text-white border-emerald-600":z="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600";const B=!!c,q=B?z.replace(/\bborder-\S+/g,"").trim():z;return e.jsx("span",{className:["inline-flex items-center justify-center",B?"h-9 w-9 min-w-[36px]":"h-5 min-w-[18px]",B?"rounded-full mb-0.5":"rounded-full border mb-0.5","align-middle overflow-hidden",B?"p-0":"px-1.5 text-xs font-semibold",q].join(" "),title:i?"Correct!":p||void 0,children:B?e.jsx(tt,{userId:c,name:p,size:36,className:"border-0 relative z-0",fallbackToInitials:!0}):s})}function $a(s,c){return s==="FINISHED"?"FT":s==="PAUSED"?"HT":s==="IN_PLAY"?c==null?"LIVE":`${c}'`:"LIVE"}function Fa(s){const c=(s||"?").trim().split(/\s+/);return c.length?c.length===1?c[0].slice(0,1).toUpperCase():(c[0][0]+c[c.length-1][0]).toUpperCase():"?"}function Ba({fixture:s,picks:c,members:p,outcome:f,liveScore:i,submittedMap:U,picksGw:D,isApiTestLeague:V=!1}){const n=s.home_code||s.home_team||s.home_name||"",z=s.away_code||s.away_team||s.away_name||"",B=ds(n)||s.home_name||s.home_team||"Home",q=ds(z)||s.away_name||s.away_team||"Away",v=(Y=>{if(!Y)return"";const y=new Date(Y);if(isNaN(y.getTime()))return"";const fe=String(y.getUTCHours()).padStart(2,"0"),xe=String(y.getUTCMinutes()).padStart(2,"0");return`${fe}:${xe}`})(s.kickoff_time),L=!!(i&&i.status==="IN_PLAY"),J=!!(i&&(i.status==="PAUSED"||i.status==="HALF_TIME"||i.status==="HT")),Z=!!(i&&i.status==="FINISHED"),te=L||J;let _=null;V&&i?i.homeScore>i.awayScore?_="H":i.awayScore>i.homeScore?_="A":i.homeScore===i.awayScore&&(_="D"):_=f;const ie=Y=>{const y=c.filter(ye=>ye.pick===Y),fe=4,xe=[];for(let ye=0;ye<y.length;ye+=fe){const je=y.slice(ye,ye+fe);xe.push(je)}const ue=12;return e.jsx("div",{className:"flex flex-col gap-1",children:xe.map((ye,je)=>e.jsx("div",{className:"flex items-center justify-center",children:ye.map((Le,se)=>{const Q=p.find(_e=>_e.id===Le.user_id),ae=Fa(Q?.name??"?"),le=U.has(`${Le.user_id}:${D}`),X=_&&_===Y?!0:null;return e.jsx("span",{className:"inline-block",style:{marginLeft:se>0?`-${ue}px`:"0",position:"relative",zIndex:se},children:e.jsx(Ua,{letter:ae,userId:Le.user_id,userName:Q?.name,correct:X,unicorn:X===!0,hasSubmitted:le,isLive:L,isOngoing:te,isFinished:Z})},Le.user_id)})},je))})};return e.jsx("li",{className:"border-t first:border-t-0",children:e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800 relative",children:[(L||J)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),Z&&!L&&!J&&e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"FT"})}),e.jsxs("div",{className:`grid grid-cols-3 items-center ${te?"pt-4":""}`,children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:B})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(us,{code:s.home_code||void 0,crest:s.home_crest||void 0,size:24,className:"h-6 w-6"}),e.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600 dark:text-slate-300",children:i&&(L||J||Z)?e.jsxs("span",{className:"font-bold text-base text-slate-900 dark:text-slate-100",children:[i.homeScore," - ",i.awayScore]}):e.jsx("span",{children:v})}),e.jsx(us,{code:s.away_code||void 0,crest:s.away_crest||void 0,size:24,className:"h-6 w-6"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:q})})]}),i&&(te||Z)&&e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx("span",{className:`text-[10px] font-semibold ${te?"text-red-600":"text-slate-500 dark:text-slate-400"}`,children:$a(i.status,i.minute)})}),e.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:ie("H")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:ie("D")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:ie("A")})})]})]})})}function js({label:s,fixtures:c,picksByFixture:p,members:f,outcomes:i,liveScores:U,submittedMap:D,picksGw:V,isApiTestLeague:n=!1,isFirstSection:z=!1,hasLiveGames:B=!1,allGamesFinished:q=!1,allSubmitted:oe=!1,resultsPublished:v=!1,deadlinePassed:L=!1,whoDidntSubmit:J=[],liveFixturesCount:Z,hasStarted:te=!1}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(aa,{date:s,className:"text-lg font-normal"}),z&&e.jsxs(e.Fragment,{children:[n&&B&&Z!==void 0&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:Z}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:c.length})]})]}),n&&q&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),n&&!te&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!n&&(fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"LeagueFixtureSection.tsx:79",message:"Checking Round Complete conditions",data:{isApiTestLeague:n,allSubmitted:oe,resultsPublished:v,allGamesFinished:q,shouldShow:oe&&v&&q},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H3"})}).catch(()=>{}),oe&&v&&q)&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!n&&oe&&!v&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!n&&L&&!oe&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",J.length>0&&`(${J.join(", ")} didn't submit)`]})]})]}),e.jsx("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 overflow-hidden",children:e.jsxs("ul",{children:[c.map(_=>{try{const ie=p.get(_.fixture_index)??[],Y=i.get(_.fixture_index)||null,y=U[_.fixture_index]||null;return e.jsx(Ba,{fixture:_,picks:ie,members:f,outcome:Y,liveScore:y,submittedMap:D,picksGw:V,isApiTestLeague:n},`${_.gw}-${_.fixture_index}`)}catch(ie){return console.error("Error rendering fixture:",ie,_),e.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",_.fixture_index]},`${_.gw}-${_.fixture_index}`)}}),!c.length&&e.jsx("li",{className:"p-4 text-slate-500 dark:text-slate-400",children:"No fixtures."})]})})]})}const Ht=8;function zt(s){return s.result==="H"||s.result==="D"||s.result==="A"?s.result:typeof s.home_goals=="number"&&typeof s.away_goals=="number"?s.home_goals>s.away_goals?"H":s.home_goals<s.away_goals?"A":"D":null}function Ha(){const s=a.useRef(0);s.current=0;const{code:c=""}=ra();s.current++;const[p,f]=na();s.current++;const{user:i}=_s();s.current++;const{currentGw:U}=oa();s.current++;const[D]=a.useState(()=>{const t=localStorage.getItem("oldSchoolMode");return t?JSON.parse(t):!1});s.current++,a.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(D))},[D]),s.current++,a.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const t=()=>{const m=document.querySelector(".league-header-fixed");if(m){const E=m.style.top||window.getComputedStyle(m).top;E!=="0px"&&E!=="0"&&(m.style.top="0",m.style.transform="translate3d(0, 0, 0)")}},r=()=>{t(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},o=m=>{const E=m.target;E.closest(".league-content-wrapper")||E.closest(".league-header-fixed")||E.closest(".chat-tab-wrapper")||m.preventDefault()};window.addEventListener("scroll",r,{passive:!0}),document.addEventListener("touchmove",o,{passive:!1});const u=setInterval(t,100);return t(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",r),document.removeEventListener("touchmove",o),clearInterval(u)}},[]),a.useEffect(()=>{const t=o=>{const u=o.target;(u.tagName==="INPUT"||u.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const m=document.querySelector(".league-header-fixed");m&&(m.style.top="0")},100)},r=()=>{const o=document.querySelector(".league-header-fixed");o&&(o.style.top="0")};return document.addEventListener("focusin",t),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),()=>{document.removeEventListener("focusin",t),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]),a.useEffect(()=>{if(typeof window>"u")return;const t=window.visualViewport;if(!t)return;let r=null;const o=()=>{const m=Le.current;if(!m)return;const E=t.offsetTop??0;m.style.setProperty("transform",`translate3d(0, ${E}px, 0)`,"important")},u=()=>{r&&cancelAnimationFrame(r),r=window.requestAnimationFrame(o)};return u(),t.addEventListener("resize",u),t.addEventListener("scroll",u),()=>{r&&cancelAnimationFrame(r),t.removeEventListener("resize",u),t.removeEventListener("scroll",u),Le.current&&Le.current.style.removeProperty("transform")}},[]);const V=()=>{if(!c)return null;try{const t=ve(`leagues:${i?.id||""}`);if(t){const r=t.find(o=>o.code.toUpperCase()===c.toUpperCase());if(r)return r}}catch{}return null},[n,z]=a.useState(()=>V());s.current++;const[B,q]=a.useState(!1);s.current++;const oe=()=>{const t=V();if(!t?.id)return[];try{const r=ve(`league:members:${t.id}`);if(r&&r.length>0)return r.map(([o,u])=>({id:o,name:u||"(no name)"}))}catch{}return[]},[v,L]=a.useState(oe);s.current++;const[J,Z]=a.useState(()=>!V());s.current++;const te="chat",[_,ie]=a.useState(te),Y=a.useRef(null);a.useEffect(()=>{if(Y.current!==null&&Y.current!==_)try{const t=localStorage.getItem("message_subscription_logs"),r=t?JSON.parse(t):[];r.push({timestamp:Date.now(),leagueId:n?.id,status:"TAB_CHANGED",channel:`league-messages:${n?.id}`,from:Y.current,to:_,reason:`Tab changed from "${Y.current}" to "${_}"`});const o=r.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(t){console.error("[LeaguePage] Failed to log tab change:",t)}Y.current=_},[_,n?.id]);const y=a.useRef(null);a.useEffect(()=>{if(y.current!==null&&y.current!==n?.id)try{const t=localStorage.getItem("message_subscription_logs"),r=t?JSON.parse(t):[];r.push({timestamp:Date.now(),leagueId:n?.id,status:"LEAGUE_ID_CHANGED",channel:`league-messages:${n?.id}`,from:y.current,to:n?.id,reason:`League ID changed from "${y.current}" to "${n?.id}"`});const o=r.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(o))}catch(t){console.error("[LeaguePage] Failed to log league ID change:",t)}y.current=n?.id??null},[n?.id]),a.useEffect(()=>{const t=Date.now();try{const r=localStorage.getItem("message_subscription_logs"),o=r?JSON.parse(r):[],u={timestamp:Date.now(),leagueId:n?.id,status:"LEAGUE_PAGE_MOUNT",channel:`league-messages:${n?.id}`,pageId:t,tab:_,reason:"LeaguePage component mounted"};o.push(u);const m=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(m))}catch(r){console.error("[LeaguePage] Failed to log mount:",r)}return()=>{try{const r=localStorage.getItem("message_subscription_logs"),o=r?JSON.parse(r):[],u={timestamp:Date.now(),leagueId:n?.id,status:"LEAGUE_PAGE_UNMOUNT",channel:`league-messages:${n?.id}`,pageId:t,tab:_,reason:"LeaguePage component unmounting"};o.push(u);const m=o.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(m))}catch(r){console.error("[LeaguePage] Failed to log unmount:",r)}}},[]),s.current++;const[fe,xe]=a.useState(null);s.current++;const ue=a.useRef(_);s.current++,a.useEffect(()=>{ue.current=_},[_]),s.current++;const ye=a.useRef(!1);s.current++;const je=a.useRef(!1);s.current++,a.useEffect(()=>{const t=p.get("tab"),r=p.get("leagueCode");if(xe(null),t==="chat"||t==="gw"||r){if(r&&c!==r){xe(`Deep link mismatch: URL has leagueCode=${r} but we're on league ${c}. Current URL: ${window.location.href}`);return}t==="chat"&&_!=="chat"&&(ie(o=>o!=="chat"?"chat":o),setTimeout(()=>{ue.current!=="chat"&&xe(`Failed to open chat tab. Current tab: ${ue.current}, Expected: chat. URL: ${window.location.href}`)},300)),t==="gw"&&_!=="gw"&&(ie(o=>o!=="gw"?"gw":o),setTimeout(()=>{ue.current!=="gw"&&xe(`Failed to open predictions tab. Current tab: ${ue.current}, Expected: gw. URL: ${window.location.href}`)},300))}},[p,f,_,c]);const Le=a.useRef(null),[se,Q]=a.useState(!1),[ae,le]=a.useState(!1),[X,_e]=a.useState(!1),pe=()=>{try{return ve("app_meta:current_gw")?.current_gw??null}catch{return null}},[S,me]=a.useState(pe),[$,d]=a.useState(null),[l,g]=a.useState(pe),A=()=>{try{return ve("app:available_gws")??[]}catch{return[]}},[j,b]=a.useState(()=>A()),w=a.useRef({}),M=a.useRef({}),H=a.useRef(new Map),[W,ze]=a.useState(new Set),[Ke,ut]=a.useState(!1),[st,Oe]=a.useState(!1),[Ye,Ee]=a.useState(0),[vt,kt]=a.useState(!1),[at,mt]=a.useState(!1),[jt,Re]=a.useState(!1),[Ue,Be]=a.useState(!1),[ft,Ae]=a.useState(null),[Ss,qe]=a.useState(!1),[We,Xe]=a.useState(null),[Cs,Vt]=a.useState({x:0,y:0}),[_t,Nt]=a.useState(1),[ht,Jt]=a.useState(null),[Pe,rt]=a.useState(null),[nt,Ze]=a.useState(!1);s.current++;const[ot,gt]=a.useState(!1);s.current++;const[Ls,it]=a.useState(!1);s.current++;const[St,xt]=a.useState(!1);s.current++;const[pt,Qe]=a.useState(!1),[Es,Ct]=a.useState(!1),[Rs,Lt]=a.useState(!1),[bt,Kt]=a.useState(null),[Et,Yt]=a.useState(!1),[Rt,Xt]=a.useState(!1),[lt,Ms]=a.useState(null),$e=a.useMemo(()=>!!i?.id&&v.some(t=>t.id===i.id),[i?.id,v]),Zt=a.useMemo(()=>!!i?.id&&!!lt&&lt.id===i.id,[i?.id,lt]),Ts=a.useMemo(()=>lt?.name??"League admin",[lt]),Is=a.useMemo(()=>{const t=new Map;return v.forEach(r=>t.set(r.id,r.name)),t.set(dt,Ns),t},[v]),As=a.useCallback(()=>{if(!n?.code||typeof window>"u"||typeof navigator>"u")return;const t=`Join my mini league "${n.name}" on TotL!`,r=`${window.location.origin}/league/${n.code}`,o=navigator;if(typeof o.share=="function"){o.share({title:`Join ${n.name}`,text:t,url:r}).catch(()=>{});return}const u=`${t}
${r}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(u).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",n.code)}):window.prompt?.("Share this league code:",n.code)},[n]),Ds=a.useCallback(async()=>{if(!(!n?.id||!i?.id)){_e(!0);try{const{error:t}=await I.from("league_members").delete().eq("league_id",n.id).eq("user_id",i.id);if(t)throw t;typeof window<"u"&&(window.location.href="/leagues")}catch(t){typeof window<"u"&&window.alert?.(t?.message??"Failed to leave league. Please try again.")}finally{_e(!1),le(!1)}}},[n?.id,i?.id]),Ps=a.useCallback(async()=>{if(!(!n?.id||!i?.id)){xt(!0);try{if((await ia(i.id)).length>=20){typeof window<"u"&&window.alert?.("You're already in 20 mini-leagues, which is the maximum. Leave a league before joining another."),it(!1),xt(!1);return}const r=U;if(r!==null){const m=await Bt({id:n.id,name:n.name,created_at:n.created_at},r);if(r-m>=4){typeof window<"u"&&window.alert?.("This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."),it(!1),xt(!1);return}}if(v.length>=Ht){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),it(!1);return}const{error:o}=await I.from("league_members").insert({league_id:n.id,user_id:i.id});if(o)throw o;const u=i.user_metadata?.display_name||i.email||"Someone";try{const m=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:n.id,userId:i.id,userName:u})}),E=await m.text();try{E&&JSON.parse(E)}catch{}m.ok}catch{}typeof window<"u"&&window.location.reload()}catch(t){typeof window<"u"&&window.alert?.(t?.message??"Failed to join league.")}finally{xt(!1)}}},[n?.id,n?.name,n?.created_at,i?.id,v.length,U]),Us=a.useCallback(async()=>{if(!(!bt||!n?.id||!i?.id)){Yt(!0);try{const{error:t}=await I.from("league_members").delete().eq("league_id",n.id).eq("user_id",bt.id);if(t)throw t;typeof window<"u"&&window.location.reload()}catch(t){typeof window<"u"&&window.alert?.(t?.message??"Failed to remove member.")}finally{Yt(!1),Ct(!1),Kt(null)}}},[n?.id,bt,i?.id]),$s=a.useCallback(async()=>{if(!(!n?.id||!i?.id)){Xt(!0);try{const{error:t}=await I.from("league_members").delete().eq("league_id",n.id);if(t)throw t;const{error:r}=await I.from("leagues").delete().eq("id",n.id);if(r)throw r;typeof window<"u"&&(window.location.href="/leagues")}catch(t){typeof window<"u"&&window.alert?.(t?.message??"Failed to end league.")}finally{Xt(!1),Lt(!1)}}},[n?.id,i?.id]),Fs=t=>new Promise((r,o)=>{const u=new Image;u.addEventListener("load",()=>r(u)),u.addEventListener("error",m=>o(m)),u.src=t}),Qt=async(t,r)=>{const o=await Fs(t),u=document.createElement("canvas"),m=u.getContext("2d");if(!m)throw new Error("No 2d context");return u.width=r.width,u.height=r.height,m.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height),new Promise((E,P)=>{u.toBlob(C=>{if(!C){P(new Error("Canvas is empty"));return}E(C)},"image/jpeg",.9)})},Bs=a.useCallback(t=>{if(!n?.id||!$e){Ae("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(t.type)){Ae("Please upload a PNG, JPG, or WebP image.");return}const o=20*1024*1024;if(t.size>o){Ae("Please choose an image smaller than 20MB.");return}if(Ae(null),qe(!1),t.size>5*1024*1024)ms(t,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(u=>{const m=new FileReader;m.onload=()=>{Xe(m.result)},m.readAsDataURL(u)}).catch(()=>{Ae("Failed to process image. Please try a smaller file.")});else{const u=new FileReader;u.onload=()=>{Xe(u.result)},u.readAsDataURL(t)}},[$e,n?.id]),Ws=a.useCallback(async(t,r)=>{if(Jt(r),We)try{const o=await Qt(We,r),u=URL.createObjectURL(o);rt(u)}catch{}},[We]),Gs=a.useCallback(async()=>{if(!(!We||!ht||!n?.id||!$e)){Ae(null),qe(!1),Be(!0);try{const t=await Qt(We,ht),r=new File([t],"badge.jpg",{type:"image/jpeg"}),o=await ms(r,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(o.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const u=`${n.id}-${Date.now()}.jpg`,{error:m}=await I.storage.from("league-avatars").upload(u,o,{cacheControl:"3600",upsert:!0,contentType:o.type});if(m)throw m;const{data:E}=I.storage.from("league-avatars").getPublicUrl(u),P=E?.publicUrl;if(!P)throw new Error("Unable to get public URL for badge.");const{error:C}=await I.from("leagues").update({avatar:P}).eq("id",n.id);if(C)throw C;z(re=>re&&{...re,avatar:P}),qe(!0),Pe&&URL.revokeObjectURL(Pe),Xe(null),rt(null),Re(!1),i?.id&&(fs(i.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:n.id,avatar:P}})))}catch(t){Ae(t?.message??"Failed to upload badge. Please try again.")}finally{Be(!1)}}},[We,ht,$e,n?.id,i?.id]),Hs=a.useCallback(async()=>{if(!(!n?.id||!$e)){Ae(null),qe(!1),Be(!0);try{const{error:t}=await I.from("leagues").update({avatar:null}).eq("id",n.id);if(t)throw t;z(r=>r&&{...r,avatar:null}),qe(!0),i?.id&&(fs(i.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:n.id,avatar:null}})))}catch(t){Ae(t?.message??"Failed to remove badge. Please try again.")}finally{Be(!1)}}},[$e,n?.id]),[es,zs]=a.useState(new Map);a.useEffect(()=>{(async()=>{const t=new Map,{data:r}=await I.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:o}=await I.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),u=new Map;if(r&&r.forEach(m=>{(!u.has(m.gw)||m.kickoff_time&&new Date(m.kickoff_time)<new Date(u.get(m.gw)))&&m.kickoff_time&&u.set(m.gw,m.kickoff_time)}),o&&o.length>0){const m=o.find(E=>E.kickoff_time)?.kickoff_time;if(m){const E=u.get(1);(!E||new Date(m)<new Date(E))&&u.set(1,m)}}u.forEach((m,E)=>{const P=new Date(m),C=new Date(P.getTime()-4500*1e3);t.set(E,C)}),zs(t)})()},[]),a.useEffect(()=>{const t=r=>{const o=r.target;Ke&&!o.closest(".gw-dropdown-container")&&ut(!1)};return Ke&&document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[Ke]),a.useEffect(()=>{let t=!0;return(async()=>{const{data:r}=await I.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!t)return;me(r?.current_gw??null);const{data:o}=await I.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!t)return;d(o&&o.length?o[0].gw:null);const{data:u}=await I.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!t)return;const m=u?[...new Set(u.map(P=>P.gw))].sort((P,C)=>C-P):[],E=r?.current_gw;E&&!m.includes(E)&&m.unshift(E),b(m),(m.length>0&&!l||m.length>0&&l&&!m.includes(l))&&g(m[0])})(),()=>{t=!1}},[Ye]);const Os=a.useMemo(()=>v.map(t=>t.id).sort().join(","),[v]),Ge=a.useMemo(()=>v.map(t=>t.id),[Os]),[we,ts]=a.useState([]);s.current++;const[ss,Mt]=a.useState([]);s.current++;const[as,Tt]=a.useState([]);s.current++;const[It,At]=a.useState([]);s.current++,a.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[_]),s.current++;const{state:Dt}=et(S);s.current++;const wt=a.useMemo(()=>n?.name==="API Test",[n?.name]),[Me,rs]=a.useState(null);s.current++;const Pt=a.useMemo(()=>n?n.name==="API Test"?Me??1:je.current&&l||!S?l:Dt==="LIVE"||Dt==="RESULTS_PRE_GW"?S:$&&$<S?$:S>1?S-1:S:S||l||null,[n?.name,Me,l,S,Dt,$]);s.current++;const{state:qs}=et(Pt??null);s.current++;const ct=a.useRef(""),ns=a.useRef(0),os=a.useMemo(()=>{const t=we?.length||0;if(t===ns.current&&ct.current&&(we?.map(u=>u.api_match_id).filter(u=>u!=null).sort().join(",")||"")===ct.current)return ct.current;if(ns.current=t,!we||we.length===0)return ct.current="","";const r=we.map(o=>o.api_match_id).filter(o=>o!=null).sort().join(",");return ct.current=r,r},[we]);a.useEffect(()=>{if(!wt){rs(null);return}let t=!0;return(async()=>{const{data:r}=await I.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let o=r?.current_test_gw??1;if(o&&o!==1){const{data:u}=await I.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!u){const{data:m}=await I.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();m&&(o=1)}}t&&rs(o)})(),()=>{t=!1}},[wt]);const Vs=a.useMemo(()=>wt&&Me!==null?Me:S||l||void 0,[wt,Me,S,l]),Ut=a.useRef({key:"",array:void 0}),Js=a.useMemo(()=>{const t=os||"";if(Ut.current.key===t)return Ut.current.array;const r=t?t.split(",").map(o=>parseInt(o,10)).filter(o=>!isNaN(o)):void 0;return Ut.current={key:t,array:r},r},[os]),{liveScores:is}=la(Vs,Js),Ne=a.useMemo(()=>{const t={};if(!we||we.length===0)return Object.keys(M.current).length===0?M.current:(M.current=t,t);we.forEach(E=>{const P=E.api_match_id;if(P){const C=is.get(P);C&&(t[E.fixture_index]={homeScore:C.home_score??0,awayScore:C.away_score??0,status:C.status||"SCHEDULED",minute:C.minute??null})}});const r=M.current,o=Object.keys(t).map(Number),u=Object.keys(r).map(Number);if(o.length!==u.length)return M.current=t,t;let m=!1;for(const E of o){const P=t[E],C=r[E];if(!C||P.homeScore!==C.homeScore||P.awayScore!==C.awayScore||P.status!==C.status||P.minute!==C.minute){m=!0;break}}return m?(M.current=t,t):r},[is,we]),Ks=()=>{try{if(console.log("[League] getInitialMltRows called",{code:c,userId:i?.id}),c&&i?.id){const r=ve(`leagues:${i.id}`);if(console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!r,length:r?.length}),r&&Array.isArray(r)){const o=r.find(u=>u.code.toUpperCase()===c.toUpperCase());if(console.log("[League] getInitialMltRows - found league",{found:!!o,leagueId:o?.id}),o?.id){const u=`league:mltRows:${o.id}`,m=ve(u);if(console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!m,length:m?.length,cacheKey:u,cachedType:typeof m,isArray:Array.isArray(m),rawCache:m}),m&&Array.isArray(m)&&m.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows",m.length),m;console.log("[League] âŒ Cache check failed",{cached:!!m,isArray:Array.isArray(m),length:m?.length,cacheKey:u})}}}const t=V();if(console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!t,leagueId:t?.id}),t?.id){const r=ve(`league:mltRows:${t.id}`);if(console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!r,length:r?.length}),r&&Array.isArray(r)&&r.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows from initialLeague",r.length),r}if(c&&i?.id){const r=ve(`leagues:${i.id}`);if(r&&Array.isArray(r)){for(const o of r)if(o.code?.toUpperCase()===c.toUpperCase()&&o.id){const u=ve(`league:mltRows:${o.id}`);if(u&&Array.isArray(u)&&u.length>0)return console.log("[League] âœ… getInitialMltRows returning cached rows from strategy 3",u.length),u}}}console.log("[League] âš ï¸ getInitialMltRows returning empty array - cache miss")}catch(t){console.error("[League] âŒ getInitialMltRows error",t)}return[]},[Se,Fe]=a.useState(Ks);a.useEffect(()=>{console.log("[League] Tab changed to:",_,"mltRows.length:",Se.length)},[_,Se.length]),a.useEffect(()=>{if(n?.id){const t=`league:mltRows:${n.id}`,r=ve(t);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:n.id,cacheKey:t,hasCached:!!r,cachedLength:r?.length,currentMltRowsLength:Se.length}),r&&r.length>0)Se.length===0?(console.log("[League] âœ… Setting mltRows from cache",r.length),Fe(r)):console.log("[League] mltRows already populated, skipping");else{console.log("[League] âš ï¸ No cached mltRows found - will retry multiple times");let o=0;const u=10,m=[50,100,150,200,250,300,400,500,600,800],E=()=>{if(o>=u){console.log("[League] âŒ Max retries reached, giving up on cache");return}const C=setTimeout(()=>{o++;const re=ve(t);re&&re.length>0&&Se.length===0?(console.log(`[League] âœ… Retry ${o} successful - Setting mltRows from cache`,re.length),Fe(re)):o<u&&E()},m[o]||800);return()=>clearTimeout(C)};return E()}}else console.log("[League] âš ï¸ No league.id available yet")},[n?.id,Se.length]),a.useEffect(()=>{let t=!0;return(async()=>{let o=n;if(!o){const{data:C}=await I.from("leagues").select("id,name,code,created_at,avatar").eq("code",c).maybeSingle();if(!t)return;if(!C){z(null),L([]),Z(!1);return}o=C,z(o)}const u=ve(`league:members:${o.id}`);let m=[];if(u&&u.length>0)m=u.map(([C,re])=>({id:C,name:re||"(no name)"})),Z(!1);else{const{data:C}=await I.from("league_members").select("users(id,name),created_at").eq("league_id",o.id).order("created_at",{ascending:!0});m=C?.map(re=>({id:re.users.id,name:re.users.name??"(no name)"}))??[],Z(!1)}const E=[...m].sort((C,re)=>C.name.localeCompare(re.name));L(E);const P=m[0];Ms(P),i?.id&&!m.some(C=>C.id===i.id)&&it(!0),Z(!1)})(),()=>{t=!1}},[c]),a.useEffect(()=>{},[n,_]),a.useEffect(()=>{let t=!0;return(async()=>{const r=n?.name==="API Test";let o=Me??1;if(r){const{data:N}=await I.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(o=N?.current_test_gw??1,o&&o!==1){const{data:R}=await I.from("app_fixtures").select("gw").eq("gw",o).limit(1).maybeSingle();if(!R){const{data:O}=await I.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();O&&(o=1)}}}const u=r&&(_==="gw"||_==="gwr");let m=null;if(_==="gwr")if(je.current&&l)m=l;else if(S)try{const N=await ca(S);N==="LIVE"||N==="RESULTS_PRE_GW"?m=S:$&&$<S?m=$:m=S>1?S-1:S}catch(N){console.error("[League] Error checking game state for fixtures loading:",N),$&&$<S?m=$:m=S>1?S-1:S}else m=l;else m=S;if(r&&(_==="gw"||_==="gwr")&&(m=o),_==="gw"&&!r&&Ge.length>0){const{data:N}=await I.from("app_gw_submissions").select("gw").in("user_id",Ge).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(N&&N.length>0){const R=[...new Set(N.map(O=>O.gw))].sort((O,ne)=>(ne||0)-(O||0));for(const O of R)if(O){const{data:ne}=await I.from("app_fixtures").select("gw").eq("gw",O).limit(1);if(ne&&ne.length>0){m=O;break}}}!m&&S&&(m=S)}if(!m&&!u){ts([]),Mt([]),Tt([]),At([]);return}let E;if(u){const{data:N}=await I.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",o).order("fixture_index",{ascending:!0});E=N?.map(R=>({...R,gw:R.test_gw}))||null}else{const{data:N}=await I.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",m).order("fixture_index",{ascending:!0});E=N||null}if(!t)return;if(ts(N=>{const R=E??[];return N.length!==R.length?R:N.length===0&&R.length===0?N:N.some((ne,k)=>!R[k]||ne.id!==R[k].id||ne.fixture_index!==R[k].fixture_index)||R.some((ne,k)=>!N[k]||ne.id!==N[k].id||ne.fixture_index!==N[k].fixture_index)?R:N}),!Ge.length){Mt([]),Tt([]),At([]);return}let P=null,C;if(u){const{data:N}=await I.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",o).in("user_id",Ge);P=N?.map(T=>({...T,gw:T.matchday}))||null;const{data:R,error:O}=await I.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",o).not("submitted_at","is",null).in("user_id",Ge),{data:ne}=await I.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",o).order("fixture_index",{ascending:!0}),k=new Set((ne||[]).map(T=>T.fixture_index)),h=[];if(R&&P&&ne){const T=k.size,F=new Date("2025-11-18T00:00:00Z");R.forEach(G=>{const de=(P||[]).filter(be=>be.user_id===G.user_id&&be.matchday===o).filter(be=>k.has(be.fixture_index)),Te=de.length===T&&T>0,x=new Set(de.map(be=>be.fixture_index)).size===T,ce=G.submitted_at?new Date(G.submitted_at):null,ge=ce&&ce>=F;Te&&x&&ge&&h.push(G)})}C=h.map(T=>({...T,gw:T.matchday}))||null}else{const{data:N}=await I.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",m).in("user_id",Ge);P=N;const{data:R}=await I.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",m).in("user_id",Ge);C=R}if(!t)return;Mt(N=>{const R=P??[];if(N.length!==R.length)return R;if(N.length===0&&R.length===0)return N;const O=JSON.stringify(N.sort((k,h)=>k.fixture_index-h.fixture_index)),ne=JSON.stringify(R.sort((k,h)=>k.fixture_index-h.fixture_index));return O===ne?N:R}),Tt(N=>{const R=C??[];if(N.length!==R.length)return R;if(N.length===0&&R.length===0)return N;const O=JSON.stringify(N),ne=JSON.stringify(R);return O===ne?N:R});const{data:re}=await I.from("app_gw_results").select("gw,fixture_index,result").eq("gw",u?1:m||0);t&&At(N=>{const R=re??[];if(N.length!==R.length)return R;if(N.length===0&&R.length===0)return N;const O=JSON.stringify(N.sort((k,h)=>k.fixture_index-h.fixture_index)),ne=JSON.stringify(R.sort((k,h)=>k.fixture_index-h.fixture_index));return O===ne?N:R})})(),()=>{t=!1}},[_,S,$,l,Ge]),a.useEffect(()=>{w.current=Ne},[Ne]);const He=a.useMemo(()=>{const t=new Map;return as.forEach(r=>{if(r.submitted_at){const o=`${r.user_id}:${r.gw}`;t.set(o,!0)}}),t},[as]),yt=a.useCallback(t=>t.map(r=>({user_id:r.id,name:r.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);a.useEffect(()=>{const t=I.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{Ee(r=>r+1)}).subscribe();return()=>{I.removeChannel(t)}},[]),a.useEffect(()=>{let t=!0;return(async()=>{const r=Ye>0,o=Se.length>0&&Se.every(x=>x.wins===0&&x.draws===0),u=r||o;if(!u&&Se.length>0)return;if(!u&&n?.id){const x=ve(`league:mltRows:${n.id}`);if(x&&x.length>0){Fe(x);return}}if(!v.length){ve(`league:mltRows:${n?.id||""}`)||Fe([]);return}if(n?.name==="API Test"){Fe(yt(v));return}if(!u){const x=n?.id&&ve(`league:mltRows:${n.id}`);if(x&&x.length>0){Fe(x);return}}if(S===null)return;const{data:m}=await I.from("app_gw_results").select("gw,fixture_index,result"),E=m??[],P=new Map;if(E.forEach(x=>{const ce=zt(x);ce&&P.set(`${x.gw}:${x.fixture_index}`,ce)}),P.size===0){Fe(yt(v));return}const C=[...new Set(Array.from(P.keys()).map(x=>parseInt(x.split(":")[0],10)))].sort((x,ce)=>x-ce),re=["Prem Predictions","FC Football","Easy League"],N=["The Bird league"],R=await Bt(n,S);let O=C.filter(x=>x>=R);if(S!==null&&O.includes(S)){const{data:x}=await I.from("app_fixtures").select("fixture_index").eq("gw",S),ce=x?.length??0,ge=Array.from(P.keys()).filter(be=>parseInt(be.split(":")[0],10)===S).length;ce>0&&ge<ce&&(O=O.filter(be=>be<S))}else S!==null&&(O=O.filter(x=>x<S));if(!re.includes(n?.name||"")&&!N.includes(n?.name||"")&&O.length===0){Fe(yt(v));return}const{data:ne}=await I.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",v.map(x=>x.id)).in("gw",O),k=ne??[],h=new Map;O.forEach(x=>{const ce=new Map;v.forEach(ge=>ce.set(ge.id,{user_id:ge.id,score:0,unicorns:0})),h.set(x,ce)}),O.forEach(x=>{Array.from(P.entries()).filter(([ge])=>parseInt(ge.split(":")[0],10)===x).map(([ge,be])=>({idx:parseInt(ge.split(":")[1],10),out:be})).forEach(({idx:ge,out:be})=>{const ee=k.filter(De=>De.gw===x&&De.fixture_index===ge),Ce=ee.filter(De=>De.pick===be).map(De=>De.user_id),cs=h.get(x);if(ee.forEach(De=>{if(De.pick===be){const Ft=cs.get(De.user_id);Ft.score+=1}}),Ce.length===1&&v.length>=3){const De=Ce[0],Ft=cs.get(De);Ft.unicorns+=1}})});const T=new Map,F=new Map,G=new Map,K=new Map,de=new Map,Te=new Map;v.forEach(x=>{T.set(x.id,0),F.set(x.id,0),G.set(x.id,0),K.set(x.id,0),de.set(x.id,0),Te.set(x.id,[])}),O.forEach(x=>{const ce=Array.from(h.get(x).values());if(ce.forEach(ee=>{F.set(ee.user_id,(F.get(ee.user_id)??0)+ee.score),G.set(ee.user_id,(G.get(ee.user_id)??0)+ee.unicorns)}),ce.sort((ee,Ce)=>Ce.score-ee.score||Ce.unicorns-ee.unicorns),!ce.length)return;const ge=ce[0],be=ce.filter(ee=>ee.score===ge.score&&ee.unicorns===ge.unicorns);be.length===1?(T.set(ge.user_id,(T.get(ge.user_id)??0)+3),K.set(ge.user_id,(K.get(ge.user_id)??0)+1),Te.get(ge.user_id).push("W"),ce.slice(1).forEach(ee=>Te.get(ee.user_id).push("L"))):(be.forEach(ee=>{T.set(ee.user_id,(T.get(ee.user_id)??0)+1),de.set(ee.user_id,(de.get(ee.user_id)??0)+1),Te.get(ee.user_id).push("D")}),ce.filter(ee=>!be.find(Ce=>Ce.user_id===ee.user_id)).forEach(ee=>Te.get(ee.user_id).push("L")))});const he=v.map(x=>({user_id:x.id,name:x.name,mltPts:T.get(x.id)??0,ocp:F.get(x.id)??0,unicorns:G.get(x.id)??0,wins:K.get(x.id)??0,draws:de.get(x.id)??0,form:Te.get(x.id)??[]}));he.sort((x,ce)=>ce.mltPts-x.mltPts||ce.unicorns-x.unicorns||ce.ocp-x.ocp||x.name.localeCompare(ce.name)),t&&(Fe(he),n?.id&&Ot(`league:mltRows:${n.id}`,he,qt.LEAGUES))})(),()=>{t=!1}},[v,n,S,yt,Ye]);const ls=a.useCallback(async()=>{if(!n||!U){Ze(!0);return}try{const t=await Bt({id:n.id,name:n.name,created_at:n.created_at},U);if(U-t>=4){gt(!0);return}Ze(!0)}catch(t){console.error("[League] Error checking league lock status:",t),Ze(!0)}},[n,U]);function $t(){return e.jsxs("div",{className:"text-center p-8 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("img",{src:"/assets/Volley/volley-with-ball.png",alt:"Volley",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 font-bold",children:"Share your league code with friends to kick things off."}),e.jsx("button",{onClick:ls,className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]})}function Ys(){const t=a.useRef(null);if(a.useEffect(()=>{if(!ot)return;const o=u=>{u.key==="Escape"&&gt(!1)};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[ot]),a.useEffect(()=>(ot?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ot]),!ot)return null;const r=o=>{o.target===o.currentTarget&&gt(!1)};return ps.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:t,className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:r,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"league-locked-error-title",onClick:r,style:{zIndex:1e6},children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-800 px-8 py-8 text-center shadow-2xl max-w-sm w-full",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-red-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-amber-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{id:"league-locked-error-title",className:"text-2xl font-extrabold text-amber-600",children:"League Locked"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."}),e.jsx("button",{onClick:()=>gt(!1),className:"mt-4 px-6 py-2.5 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#156d63] transition-colors",children:"OK"})]})]})})]}),document.body)}function Xs(){const[t,r]=a.useState(""),o=a.useRef(null),u=a.useRef(null);a.useEffect(()=>{if(!nt)return;const N=R=>{R.key==="Escape"&&Ze(!1)};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[nt]);const m=N=>{N.target===N.currentTarget&&Ze(!1)};if(a.useEffect(()=>(nt?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[nt]),!nt||!n)return null;const E=N=>{r(N),window.clearTimeout(E._t),E._t=window.setTimeout(()=>r(""),1600)},P=async()=>{try{await navigator.clipboard.writeText(n.code),E("Code copied")}catch{try{const R=document.createElement("textarea");R.value=n.code,document.body.appendChild(R),R.select(),document.execCommand("copy"),document.body.removeChild(R),E("Code copied")}catch{E("Couldn't copy")}}},C=async()=>{if(!n?.code||typeof window>"u"||typeof navigator>"u")return;const N=`Join my mini league "${n.name}" on TotL!`,R=`${window.location.origin}/league/${n.code}`,O=navigator;if(typeof O.share=="function")try{await O.share({title:`Join ${n.name}`,text:N,url:R});return}catch{return}const ne=`${N}
${R}`;try{await navigator.clipboard.writeText(ne),E("Share text copied")}catch{E("Couldn't share")}},re=e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:o,className:"fixed inset-0 bg-black/50",onClick:m,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999,touchAction:"manipulation"}}),e.jsxs("div",{ref:u,className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 rounded-t-3xl shadow-2xl",role:"dialog","aria-modal":"true","aria-labelledby":"share-league-code-tray-title",onClick:N=>N.stopPropagation(),style:{animation:"slideUp 300ms ease-out",zIndex:1e6,touchAction:"manipulation"},children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[e.jsx("h2",{id:"share-league-code-tray-title",className:"text-lg font-medium text-slate-900 dark:text-slate-100 uppercase tracking-wide",style:{fontFamily:'"Gramatika", sans-serif',fontWeight:700},children:"Share League Code"}),e.jsx("button",{onClick:()=>Ze(!1),className:"w-8 h-8 flex items-center justify-center rounded-full","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 pb-8 max-h-[70vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-3",children:["Share this code (up to ",Ht," members):"]}),e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("code",{className:"flex-1 font-mono text-2xl font-bold text-center py-3 px-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-100",children:n.code})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:P,className:"flex-1 px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-semibold hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors",children:"Copy"}),e.jsx("button",{onClick:C,className:"flex-1 px-4 py-3 rounded-lg bg-[#1C8376] text-white font-semibold hover:bg-[#156b60] transition-colors",children:"Share"})]}),e.jsx("div",{className:`mt-3 text-xs rounded bg-slate-900 text-white px-3 py-2 text-center transition-opacity ${t?"opacity-100":"opacity-0 pointer-events-none"}`,children:t||"â€¦"}),e.jsxs("div",{className:"mt-4 text-xs text-slate-500 dark:text-slate-400 text-center",children:[v.length,"/",Ht," members"]})]})})}),e.jsx("div",{className:"flex justify-center pb-3",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})})]})]});return typeof document<"u"&&document.body?ps.createPortal(re,document.body):re}function Zs(){const t=performance.now();console.log("[MltTab] âš¡ RENDERING START",{mltRowsLength:Se.length,membersLength:v.length,leagueId:n?.id,timestamp:t});const r=performance.now(),o=a.useMemo(()=>S??null,[S]);et(o);const u=performance.now();console.log("[MltTab] âš¡ Hooks complete",{duration:u-r});const m=performance.now(),E=Se.length>0?Se:v.length>0?v.map(O=>({user_id:O.id,name:O.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],P=performance.now();console.log("[MltTab] âš¡ Rows calculated",{rowsLength:E.length,mltRowsLength:Se.length,duration:P-m});const C=["Prem Predictions","FC Football","Easy League"],re=["The Bird league"],N=["gregVjofVcarl","Let Down"],R=!!(n&&!C.includes(n.name)&&!re.includes(n.name)&&!N.includes(n.name));return v.length===1?e.jsx($t,{}):e.jsxs("div",{className:"pt-4",children:[e.jsx(Ta,{rows:E,members:v,showForm:se,currentUserId:i?.id,loading:!1,isLateStartingLeague:R}),e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(Ra,{showForm:se,onToggle:Q}),e.jsxs("button",{onClick:()=>kt(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),n?.name==="API Test"&&e.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:e.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function Qs(){const t=a.useMemo(()=>n?.name==="API Test"?Me??1:S??null,[n?.name,Me,S]),{state:r}=et(t);if(v.length===1)return e.jsx($t,{});if(!t)return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No current gameweek available."});if(!bs(n,t,es))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Predictions Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",t," predictions are not included in this league."]})]})});const o=new Map;It.forEach(h=>{if(h.gw!==t)return;const T=zt(h);T&&o.set(h.fixture_index,T)}),we.forEach(h=>{if(h.gw!==t)return;const T=Ne[h.fixture_index];T&&(T.status==="IN_PLAY"||T.status==="PAUSED"||T.status==="FINISHED")&&(T.homeScore>T.awayScore?o.set(h.fixture_index,"H"):T.awayScore>T.homeScore?o.set(h.fixture_index,"A"):o.set(h.fixture_index,"D"))});const u=a.useMemo(()=>{const h=G=>{if(!G)return"Fixtures";const K=new Date(G);return isNaN(K.getTime())?"Fixtures":K.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},T=new Map;we.filter(G=>G.gw===t).forEach(G=>{const K=h(G.kickoff_time),de=G.kickoff_time?new Date(G.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;T.has(K)||T.set(K,{label:K,key:de,items:[]}),T.get(K).items.push(G)});const F=Array.from(T.values());return F.forEach(G=>G.items.sort((K,de)=>K.fixture_index-de.fixture_index)),F.sort((G,K)=>G.key-K.key),F},[we,t]),m=new Set(we.filter(h=>h.gw===t).map(h=>h.fixture_index)),E=n?.name==="API Test",P=v.length>0&&v.every(h=>He.get(`${h.id}:${t}`)),C=new Map;(!E||P)&&ss.forEach(h=>{if(h.gw!==t||!He.get(`${h.user_id}:${t}`)||!m.has(h.fixture_index))return;const F=C.get(h.fixture_index)??[];F.push(h),C.set(h.fixture_index,F)});const re=$!==null&&$>=t,N=v.filter(h=>!He.get(`${h.id}:${t}`)).length,R=v.filter(h=>!He.get(`${h.id}:${t}`)).map(h=>h.name),O=r!==null&&(r==="DEADLINE_PASSED"||r==="LIVE"||r==="RESULTS_PRE_GW"),ne=E?!P:!P&&!O;return(E?!P:!P&&!O)?e.jsx(ks,{members:v,submittedMap:He,picksGw:t,allSubmitted:P,remaining:N,fixtures:we.filter(h=>h.gw===t),variant:"compact"}):e.jsxs("div",{className:"mt-2 pt-2",children:[ne?e.jsx(ks,{members:v,submittedMap:He,picksGw:t,allSubmitted:P,remaining:N,fixtures:we.filter(h=>h.gw===t),variant:"full"}):null,n?.name==="API Test"&&P&&u.length>0&&!ne&&(()=>{const h=u.flatMap(he=>he.items),T=new Set(h.map(he=>he.fixture_index)),F={};Object.keys(Ne).forEach(he=>{const x=parseInt(he,10);T.has(x)&&(F[x]=Ne[x])});const G=h.some(he=>{const x=F[he.fixture_index];return x&&(x.status==="IN_PLAY"||x.status==="PAUSED")}),K=h.length>0&&h.every(he=>{const x=F[he.fixture_index];return x&&x.status==="FINISHED"}),de=G||K||h.some(he=>F[he.fixture_index]);let Te=0;return i?.id&&h.forEach(he=>{const x=F[he.fixture_index],ce=x&&(x.status==="IN_PLAY"||x.status==="PAUSED"),ge=x&&x.status==="FINISHED";if(x&&(ce||ge)){const ee=(C.get(he.fixture_index)??[]).find(Ce=>Ce.user_id===i.id);if(ee){let Ce=!1;(ee.pick==="H"&&x.homeScore>x.awayScore||ee.pick==="A"&&x.awayScore>x.homeScore||ee.pick==="D"&&x.homeScore===x.awayScore)&&(Ce=!0),Ce&&Te++}}}),e.jsx("div",{className:"mt-3 space-y-6",children:u.map((he,x)=>e.jsx(js,{label:he.label,fixtures:he.items,picksByFixture:C,members:v,outcomes:o,liveScores:F,submittedMap:He,picksGw:t,isApiTestLeague:!0,isFirstSection:x===0,hasLiveGames:G,allGamesFinished:K,hasStarted:de,liveFixturesCount:Te},x))})})(),u.length>0&&n?.name!=="API Test"&&(()=>{const h=It.filter(K=>K.gw===t),T=new Set(h.map(K=>K.fixture_index)),F=u.flatMap(K=>K.items),G=F.length>0&&F.every(K=>{if(T.has(K.fixture_index))return!0;const de=Ne[K.fixture_index];return de&&de.status==="FINISHED"});return e.jsx("div",{className:"mt-3 space-y-6",children:u.map((K,de)=>e.jsx(js,{label:K.label,fixtures:K.items,picksByFixture:C,members:v,outcomes:o,liveScores:Ne,submittedMap:He,picksGw:t,isApiTestLeague:!1,isFirstSection:de===0,allSubmitted:P,resultsPublished:re,allGamesFinished:G,deadlinePassed:O,whoDidntSubmit:R},de))})})(),!u.length&&!ne&&e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-500 dark:text-slate-400",children:["No fixtures for GW ",t,"."]})]})}function ea(){const{state:t}=et(S),r=a.useMemo(()=>n?.name==="API Test"?Me??1:_==="gwr"?je.current&&l||!S?l:t==="LIVE"||t==="RESULTS_PRE_GW"?S:$&&$<S?$:S>1?S-1:S:l,[n?.name,Me,_,l,S,t,$]);et(r);const o=r;if(v.length===1)return e.jsx($t,{});if(!o||j.length===0&&n?.name!=="API Test")return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No gameweek selected."});if(!bs(n,o,es))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Results Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",o," results are not included in this league."]})]})});const u=new Map,m=n?.name==="API Test",E=we.filter(k=>k.gw===o),P=E.some(k=>{const h=Ne[k.fixture_index];return h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")});m&&o===(Me??1)?E.forEach(k=>{const h=Ne[k.fixture_index];h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")&&(h.homeScore>h.awayScore?u.set(k.fixture_index,"H"):h.awayScore>h.homeScore?u.set(k.fixture_index,"A"):u.set(k.fixture_index,"D"))}):P&&o===S?E.forEach(k=>{const h=Ne[k.fixture_index];h&&(h.status==="IN_PLAY"||h.status==="PAUSED"||h.status==="FINISHED")&&(h.homeScore>h.awayScore?u.set(k.fixture_index,"H"):h.awayScore>h.homeScore?u.set(k.fixture_index,"A"):u.set(k.fixture_index,"D"))}):It.forEach(k=>{if(k.gw!==o)return;const h=zt(k);h&&u.set(k.fixture_index,h)});const C=v.map(k=>({user_id:k.id,name:k.name,score:0,unicorns:0})),re=new Map;ss.forEach(k=>{if(k.gw!==o)return;const h=re.get(k.fixture_index)??[];h.push(k),re.set(k.fixture_index,h)}),Array.from(u.entries()).forEach(([k,h])=>{const F=(re.get(k)??[]).filter(G=>G.pick===h).map(G=>G.user_id);if(F.forEach(G=>{const K=C.find(de=>de.user_id===G);K.score+=1}),F.length===1&&v.length>=3){const G=C.find(K=>K.user_id===F[0]);G.unicorns+=1}}),C.sort((k,h)=>h.score-k.score||h.unicorns-k.unicorns||k.name.localeCompare(h.name)),a.useEffect(()=>{if(C.length===0)return;const k=new Map;C.forEach((T,F)=>{k.set(T.user_id,F)});const h=new Set;if(k.forEach((T,F)=>{const G=H.current.get(F);G!==void 0&&G!==T&&h.add(F)}),H.current=k,h.size>0){ze(h);const T=setTimeout(()=>{ze(new Set)},2e3);return()=>clearTimeout(T)}},[C.map(k=>`${k.user_id}-${k.score}-${k.unicorns}`).join(",")]);let N=!1,R=!1,O=!1,ne=!1;if(m&&o===(Me??1)){const k=we;if(k.length>0&&(N=k.every(T=>{const F=Ne[T.fixture_index];return F&&F.status==="FINISHED"}),R=!!k.find(T=>{const F=Ne[T.fixture_index];return F&&(F.status==="IN_PLAY"||F.status==="PAUSED")}),ne=k.some(T=>{const F=Ne[T.fixture_index];return F&&(F.status==="IN_PLAY"||F.status==="PAUSED"||F.status==="FINISHED")}),!N)){const T=new Date;O=k.some(F=>{if(!F.kickoff_time)return!1;const K=new Date(F.kickoff_time).getTime()-T.getTime(),de=Ne[F.fixture_index];return(!de||de.status!=="IN_PLAY"&&de.status!=="PAUSED"&&de.status!=="FINISHED")&&K>0&&K<=1440*60*1e3})}}else{const k=we.filter(h=>h.gw===o);if(k.length>0){const h=k.every(F=>u.has(F.fixture_index)),T=k.some(F=>{const G=Ne[F.fixture_index];return G&&(G.status==="IN_PLAY"||G.status==="PAUSED")});N=h&&!T}}return e.jsxs("div",{children:[e.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),C.length>0&&N&&e.jsx(La,{winnerName:C[0].name,isDraw:C[0].score===C[1]?.score&&C[0].unicorns===C[1]?.unicorns}),e.jsx(Ia,{rows:C,members:v,currentUserId:i?.id,positionChangeKeys:W,isApiTestLeague:m,hasLiveFixtures:R,hasStartingSoonFixtures:O,hasStartedFixtures:ne,allFixturesFinished:N,resGw:o}),j.length>1&&e.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[e.jsx(Ea,{availableGws:j,selectedGw:o,onChange:k=>{je.current=!0,g(k)}}),e.jsxs("button",{onClick:()=>mt(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e.jsx(xs,{isOpen:at,onClose:()=>mt(!1),title:"Weekly Winner",description:`ðŸ† How to Win the Week

The player with the most correct predictions wins.

ðŸ¦„ Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return J?e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:e.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Loadingâ€¦"})}):!n&&!J?e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:e.jsxs("div",{className:"rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-6",children:[e.jsx("div",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"League not found"}),e.jsx(hs,{to:"/leagues",className:"text-slate-600 dark:text-slate-400 underline",children:"Back to Mini Leagues"})]})}):n?e.jsxs("div",{className:`${D?"oldschool-theme":"bg-slate-50 dark:bg-slate-900"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[e.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),e.jsx("div",{ref:Le,className:"league-header-fixed bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx(hs,{to:"/leagues",className:"flex items-center text-slate-600 dark:text-slate-400 -ml-2 px-2 py-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[e.jsx("button",{type:"button",onClick:()=>{q(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 flex-shrink-0 relative cursor-pointer",children:n?e.jsx("img",{src:Wt(n),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:t=>{const r=t.target,u=`/assets/league-avatars/${gs(n.id)}`;r.src!==u&&(r.src=u)}}):e.jsx("div",{className:"w-full h-full bg-slate-200"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 truncate",children:n.name}),l&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Gameweek ",l]})]})]}),e.jsx("div",{className:"relative",style:{zIndex:100},children:e.jsx("button",{onClick:()=>Qe(!pt),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),e.jsx("div",{className:`bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out overflow-hidden ${pt?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-4 py-3",children:[Zt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 dark:border-slate-700 px-0",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Admin"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800 dark:text-white",children:Ts})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("button",{onClick:()=>{Oe(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsxs("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Manage"})]})}),e.jsx("div",{className:"my-3 border-b border-slate-200 dark:border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[$e&&e.jsxs("button",{onClick:()=>{Re(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Edit League Badge"})]}),e.jsxs("button",{onClick:async()=>{Qe(!1),await ls()},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Invite players"})]}),e.jsxs("button",{onClick:()=>{As(),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{children:"Share league code"})]}),e.jsxs("button",{onClick:()=>{le(!0),Qe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-red-600 dark:text-red-400 active:bg-red-100 dark:active:bg-red-900/30 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Leave"})]})]})]})}),e.jsxs("div",{className:`flex border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 gap-2 transition-all duration-300 ease-in-out ${pt?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[e.jsxs("button",{onClick:()=>{ye.current=!0,ie("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="chat"?"text-[#1C8376]":"text-slate-400 dark:text-slate-500"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Chat"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),_==="chat"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(j.length>0||n?.name==="API Test")&&e.jsxs("button",{onClick:()=>{ye.current=!0,ie("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(_==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const t=Pt!=null&&qs==="LIVE";return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),_==="gwr"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(S||n?.name==="API Test")&&e.jsxs("button",{onClick:()=>{ye.current=!0,ie("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="gw"?"text-[#1C8376]":"text-slate-400"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),_==="gw"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),e.jsxs("button",{onClick:()=>{ye.current=!0,ie("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",_==="mlt"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),_==="chat"?e.jsx("div",{className:"chat-tab-wrapper",children:e.jsx(Ca,{miniLeagueId:n?.id??null,memberNames:Is,deepLinkError:fe})}):e.jsx("div",{className:`league-content-wrapper ${pt?"menu-open":""}`,children:e.jsxs("div",{className:"px-1 sm:px-2",children:[_==="mlt"&&(()=>{const t=performance.now();console.log("[League] Rendering MltTab, tab is mlt",{tab:_,mltRowsLength:Se.length,leagueId:n?.id,timestamp:t});const r=e.jsx(Zs,{}),o=performance.now();return console.log("[League] MltTab JSX created",{duration:o-t}),r})(),_==="gw"&&e.jsx(Qs,{}),_==="gwr"&&e.jsx(ea,{})]})}),Zt&&st&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>Oe(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>Oe(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-6 pt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900 mb-6",children:"League Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),e.jsxs("div",{className:"space-y-2",children:[v.filter(t=>t.id!==i?.id).map(t=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-800",children:t.name}),e.jsx("button",{onClick:()=>{Kt(t),Ct(!0),Oe(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-semibold",children:"Remove"})]},t.id)),v.filter(t=>t.id!==i?.id).length===0&&e.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:()=>{Lt(!0),Oe(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2",children:"ðŸ—‘ï¸ End League"})})]})]})]})}),$e&&jt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Re(!1),Pe&&URL.revokeObjectURL(Pe),Xe(null),Ae(null),qe(!1),rt(null)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>{Re(!1),Pe&&URL.revokeObjectURL(Pe),Xe(null),Ae(null),qe(!1),rt(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-4 pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-1",children:"League Badge"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Upload and customize your mini-league badge"}),We?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsx("p",{className:"font-medium",children:"Position your image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),e.jsx("div",{className:"relative w-full",style:{height:"280px"},children:e.jsx(da,{image:We,crop:Cs,zoom:_t,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Vt,onZoomChange:Nt,onCropComplete:Ws,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(_t*100),"%"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:_t,onChange:t=>Nt(Number(t.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Pe?e.jsx("img",{src:Pe,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),ft&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ft}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{Pe&&URL.revokeObjectURL(Pe),Xe(null),Vt({x:0,y:0}),Nt(1),Jt(null),rt(null)},disabled:Ue,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),e.jsx("button",{onClick:Gs,disabled:Ue||!ht,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:Ue?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:e.jsx("img",{src:n?Wt(n):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:t=>{const r=t.target;r.src="/assets/league-avatars/ML-avatar-1.png"}})}),n?.avatar&&e.jsx("button",{onClick:Hs,disabled:Ue,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:t=>{const r=t.target.files?.[0];r&&Bs(r)},disabled:Ue,className:"hidden",id:"badge-upload-input"}),e.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),Ue&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),e.jsx("span",{children:"Processing and uploading..."})]}),Ss&&e.jsx("div",{className:"p-2 bg-emerald-50 border border-emerald-200 rounded-lg text-xs text-emerald-800",children:"âœ“ Badge uploaded successfully!"}),ft&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ft})]})]})]})]})}),e.jsx(xs,{isOpen:vt,onClose:()=>kt(!1),title:"League Points",description:`Win the week â€“ 3 points
Draw â€“ 1 point
Lose â€“ 0 points

ðŸ¤ Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${n&&(["The Bird league"].includes(n.name)||["gregVjofVcarl","Let Down"].includes(n.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),e.jsx(Xs,{}),e.jsx(Ys,{}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',n?.name,`"? You'll need the league code to rejoin later.`]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>le(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:X,children:"Cancel"}),e.jsx("button",{onClick:Ds,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:X,children:X?"Leaving...":"Leave League"})]})]})}),Ls&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",e.jsxs("strong",{children:['"',n?.name,'"']}),". Are you sure?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>it(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:St,children:"Cancel"}),e.jsx("button",{onClick:Ps,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:St,children:St?"Joining...":"Join League"})]})]})}),Es&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",e.jsxs("strong",{children:['"',bt?.name,'"']})," from the league? They will need the league code to rejoin."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ct(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Et,children:"Cancel"}),e.jsx("button",{onClick:Us,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Et,children:Et?"Removing...":"Remove Member"})]})]})}),Rs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"âš ï¸ End League"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",e.jsx("strong",{children:"permanently end"})," the league ",e.jsxs("strong",{children:['"',n?.name,'"']}),"?"]}),e.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Lt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Rt,children:"Cancel"}),e.jsx("button",{onClick:$s,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Rt,children:Rt?"Ending...":"Yes, End League"})]})]})}),n?.name==="API Test"&&e.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),B&&n&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>q(!1),children:e.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:e.jsx("img",{src:Wt(n),alt:"League badge",className:"w-full h-full object-cover",onError:t=>{const r=t.target,u=`/assets/league-avatars/${gs(n.id)}`;r.src!==u&&(r.src=u)}})}),$e&&e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),q(!1),Re(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:e.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("div",{className:"text-white text-xl font-medium",children:n.name})]})})]}):null}export{Ha as default};
