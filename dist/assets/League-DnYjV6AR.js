import{g as En,r as T,s as fe,a as We,j as s,V as An,b as Yr,u as Kr,i as Rn,c as kr,T as Nr,D as Mn,d as Ln,e as Tn,f as Dn,h as Jt,k as Un,l as Pn,m as In,L as Er,n as Qt,o as Ar,I as Rr,p as Tt,q as Mr,C as Fn}from"./index-B7R70hyk.js";function zn(c,u){return u.forEach((function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if(r!=="default"&&!(r in c)){var e=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(c,r,e.get?e:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(c)}function Zr(c,u){return new Promise((function(t,r){let e;return $n(c).then((function(n){try{return e=n,t(new Blob([u.slice(0,2),e,u.slice(2)],{type:"image/jpeg"}))}catch(a){return r(a)}}),r)}))}const $n=c=>new Promise(((u,t)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:e}})=>{const n=new DataView(e);let a=0;if(n.getUint16(a)!==65496)return t("not a valid JPEG");for(a+=2;;){const d=n.getUint16(a);if(d===65498)break;const w=n.getUint16(a+2);if(d===65505&&n.getUint32(a+4)===1165519206){const b=a+10;let o;switch(n.getUint16(b)){case 18761:o=!0;break;case 19789:o=!1;break;default:return t("TIFF header contains invalid endian")}if(n.getUint16(b+2,o)!==42)return t("TIFF header contains invalid version");const i=n.getUint32(b+4,o),l=b+i+2+12*n.getUint16(b+i,o);for(let h=b+i+2;h<l;h+=12)if(n.getUint16(h,o)==274){if(n.getUint16(h+2,o)!==3)return t("Orientation data type is invalid");if(n.getUint32(h+4,o)!==1)return t("Orientation data count is invalid");n.setUint16(h+8,1,o);break}return u(e.slice(a,a+2+w))}a+=2+w}return u(new Blob)})),r.readAsArrayBuffer(c)}));var It={},Wn={get exports(){return It},set exports(c){It=c}};(function(c){var u,t,r={};Wn.exports=r,r.parse=function(e,n){for(var a=r.bin.readUshort,d=r.bin.readUint,w=0,b={},o=new Uint8Array(e),i=o.length-4;d(o,i)!=101010256;)i--;w=i,w+=4;var l=a(o,w+=4);a(o,w+=2);var h=d(o,w+=2),g=d(o,w+=4);w+=4,w=g;for(var N=0;N<l;N++){d(o,w),w+=4,w+=4,w+=4,d(o,w+=4),h=d(o,w+=4);var v=d(o,w+=4),C=a(o,w+=4),U=a(o,w+2),D=a(o,w+4);w+=6;var M=d(o,w+=8);w+=4,w+=C+U+D,r._readLocal(o,M,b,h,v,n)}return b},r._readLocal=function(e,n,a,d,w,b){var o=r.bin.readUshort,i=r.bin.readUint;i(e,n),o(e,n+=4),o(e,n+=2);var l=o(e,n+=2);i(e,n+=2),i(e,n+=4),n+=4;var h=o(e,n+=8),g=o(e,n+=2);n+=2;var N=r.bin.readUTF8(e,n,h);if(n+=h,n+=g,b)a[N]={size:w,csize:d};else{var v=new Uint8Array(e.buffer,n);if(l==0)a[N]=new Uint8Array(v.buffer.slice(n,n+d));else{if(l!=8)throw"unknown compression method: "+l;var C=new Uint8Array(w);r.inflateRaw(v,C),a[N]=C}}},r.inflateRaw=function(e,n){return r.F.inflate(e,n)},r.inflate=function(e,n){return e[0],e[1],r.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),n)},r.deflate=function(e,n){n==null&&(n={level:6});var a=0,d=new Uint8Array(50+Math.floor(1.1*e.length));d[a]=120,d[a+1]=156,a+=2,a=r.F.deflateRaw(e,d,a,n.level);var w=r.adler(e,0,e.length);return d[a+0]=w>>>24&255,d[a+1]=w>>>16&255,d[a+2]=w>>>8&255,d[a+3]=w>>>0&255,new Uint8Array(d.buffer,0,a+4)},r.deflateRaw=function(e,n){n==null&&(n={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),d=r.F.deflateRaw(e,a,d,n.level);return new Uint8Array(a.buffer,0,d)},r.encode=function(e,n){n==null&&(n=!1);var a=0,d=r.bin.writeUint,w=r.bin.writeUshort,b={};for(var o in e){var i=!r._noNeed(o)&&!n,l=e[o],h=r.crc.crc(l,0,l.length);b[o]={cpr:i,usize:l.length,crc:h,file:i?r.deflateRaw(l):l}}for(var o in b)a+=b[o].file.length+30+46+2*r.bin.sizeUTF8(o);a+=22;var g=new Uint8Array(a),N=0,v=[];for(var o in b){var C=b[o];v.push(N),N=r._writeHeader(g,N,o,C,0)}var U=0,D=N;for(var o in b)C=b[o],v.push(N),N=r._writeHeader(g,N,o,C,1,v[U++]);var M=N-D;return d(g,N,101010256),N+=4,w(g,N+=4,U),w(g,N+=2,U),d(g,N+=2,M),d(g,N+=4,D),N+=4,N+=2,g.buffer},r._noNeed=function(e){var n=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},r._writeHeader=function(e,n,a,d,w,b){var o=r.bin.writeUint,i=r.bin.writeUshort,l=d.file;return o(e,n,w==0?67324752:33639248),n+=4,w==1&&(n+=2),i(e,n,20),i(e,n+=2,0),i(e,n+=2,d.cpr?8:0),o(e,n+=2,0),o(e,n+=4,d.crc),o(e,n+=4,l.length),o(e,n+=4,d.usize),i(e,n+=4,r.bin.sizeUTF8(a)),i(e,n+=2,0),n+=2,w==1&&(n+=2,n+=2,o(e,n+=6,b),n+=4),n+=r.bin.writeUTF8(e,n,a),w==0&&(e.set(l,n),n+=l.length),n},r.crc={table:(function(){for(var e=new Uint32Array(256),n=0;n<256;n++){for(var a=n,d=0;d<8;d++)1&a?a=3988292384^a>>>1:a>>>=1;e[n]=a}return e})(),update:function(e,n,a,d){for(var w=0;w<d;w++)e=r.crc.table[255&(e^n[a+w])]^e>>>8;return e},crc:function(e,n,a){return 4294967295^r.crc.update(4294967295,e,n,a)}},r.adler=function(e,n,a){for(var d=1,w=0,b=n,o=n+a;b<o;){for(var i=Math.min(b+5552,o);b<i;)w+=d+=e[b++];d%=65521,w%=65521}return w<<16|d},r.bin={readUshort:function(e,n){return e[n]|e[n+1]<<8},writeUshort:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255},readUint:function(e,n){return 16777216*e[n+3]+(e[n+2]<<16|e[n+1]<<8|e[n])},writeUint:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255,e[n+2]=a>>16&255,e[n+3]=a>>24&255},readASCII:function(e,n,a){for(var d="",w=0;w<a;w++)d+=String.fromCharCode(e[n+w]);return d},writeASCII:function(e,n,a){for(var d=0;d<a.length;d++)e[n+d]=a.charCodeAt(d)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,n,a){for(var d,w="",b=0;b<a;b++)w+="%"+r.bin.pad(e[n+b].toString(16));try{d=decodeURIComponent(w)}catch{return r.bin.readASCII(e,n,a)}return d},writeUTF8:function(e,n,a){for(var d=a.length,w=0,b=0;b<d;b++){var o=a.charCodeAt(b);if((4294967168&o)==0)e[n+w]=o,w++;else if((4294965248&o)==0)e[n+w]=192|o>>6,e[n+w+1]=128|o>>0&63,w+=2;else if((4294901760&o)==0)e[n+w]=224|o>>12,e[n+w+1]=128|o>>6&63,e[n+w+2]=128|o>>0&63,w+=3;else{if((4292870144&o)!=0)throw"e";e[n+w]=240|o>>18,e[n+w+1]=128|o>>12&63,e[n+w+2]=128|o>>6&63,e[n+w+3]=128|o>>0&63,w+=4}}return w},sizeUTF8:function(e){for(var n=e.length,a=0,d=0;d<n;d++){var w=e.charCodeAt(d);if((4294967168&w)==0)a++;else if((4294965248&w)==0)a+=2;else if((4294901760&w)==0)a+=3;else{if((4292870144&w)!=0)throw"e";a+=4}}return a}},r.F={},r.F.deflateRaw=function(e,n,a,d){var w=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],b=r.F.U,o=r.F._goodIndex;r.F._hash;var i=r.F._putsE,l=0,h=a<<3,g=0,N=e.length;if(d==0){for(;l<N;)i(n,h,l+(j=Math.min(65535,N-l))==N?1:0),h=r.F._copyExact(e,l,j,n,h+8),l+=j;return h>>>3}var v=b.lits,C=b.strt,U=b.prev,D=0,M=0,P=0,y=0,F=0,x=0;for(N>2&&(C[x=r.F._hash(e,0)]=0),l=0;l<N;l++){if(F=x,l+1<N-2){x=r.F._hash(e,l+1);var m=l+1&32767;U[m]=C[x],C[x]=m}if(g<=l){(D>14e3||M>26697)&&N-l>100&&(g<l&&(v[D]=l-g,D+=2,g=l),h=r.F._writeBlock(l==N-1||g==N?1:0,v,D,y,e,P,l-P,n,h),D=M=y=0,P=l);var _=0;l<N-2&&(_=r.F._bestMatch(e,l,U,F,Math.min(w[2],N-l),w[3]));var j=_>>>16,A=65535&_;if(_!=0){A=65535&_;var R=o(j=_>>>16,b.of0);b.lhst[257+R]++;var S=o(A,b.df0);b.dhst[S]++,y+=b.exb[R]+b.dxb[S],v[D]=j<<23|l-g,v[D+1]=A<<16|R<<8|S,D+=2,g=l+j}else b.lhst[e[l]]++;M++}}for(P==l&&e.length!=0||(g<l&&(v[D]=l-g,D+=2,g=l),h=r.F._writeBlock(1,v,D,y,e,P,l-P,n,h),D=0,M=0,D=M=y=0,P=l);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(e,n,a,d,w,b){var o=32767&n,i=a[o],l=o-i+32768&32767;if(i==o||d!=r.F._hash(e,n-l))return 0;for(var h=0,g=0,N=Math.min(32767,n);l<=N&&--b!=0&&i!=o;){if(h==0||e[n+h]==e[n+h-l]){var v=r.F._howLong(e,n,l);if(v>h){if(g=l,(h=v)>=w)break;l+2<v&&(v=l+2);for(var C=0,U=0;U<v-2;U++){var D=n-l+U+32768&32767,M=D-a[D]+32768&32767;M>C&&(C=M,i=D)}}}l+=(o=i)-(i=a[o])+32768&32767}return h<<16|g},r.F._howLong=function(e,n,a){if(e[n]!=e[n-a]||e[n+1]!=e[n+1-a]||e[n+2]!=e[n+2-a])return 0;var d=n,w=Math.min(e.length,n+258);for(n+=3;n<w&&e[n]==e[n-a];)n++;return n-d},r.F._hash=function(e,n){return(e[n]<<8|e[n+1])+(e[n+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(e,n,a,d,w,b,o,i,l){var h,g,N,v,C,U,D,M,P,y=r.F.U,F=r.F._putsF,x=r.F._putsE;y.lhst[256]++,g=(h=r.F.getTrees())[0],N=h[1],v=h[2],C=h[3],U=h[4],D=h[5],M=h[6],P=h[7];var m=32+((l+3&7)==0?0:8-(l+3&7))+(o<<3),_=d+r.F.contSize(y.fltree,y.lhst)+r.F.contSize(y.fdtree,y.dhst),j=d+r.F.contSize(y.ltree,y.lhst)+r.F.contSize(y.dtree,y.dhst);j+=14+3*D+r.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var A=0;A<286;A++)y.lhst[A]=0;for(A=0;A<30;A++)y.dhst[A]=0;for(A=0;A<19;A++)y.ihst[A]=0;var R=m<_&&m<j?0:_<j?1:2;if(F(i,l,e),F(i,l+1,R),l+=3,R==0){for(;(7&l)!=0;)l++;l=r.F._copyExact(w,b,o,i,l)}else{var S,E;if(R==1&&(S=y.fltree,E=y.fdtree),R==2){r.F.makeCodes(y.ltree,g),r.F.revCodes(y.ltree,g),r.F.makeCodes(y.dtree,N),r.F.revCodes(y.dtree,N),r.F.makeCodes(y.itree,v),r.F.revCodes(y.itree,v),S=y.ltree,E=y.dtree,x(i,l,C-257),x(i,l+=5,U-1),x(i,l+=5,D-4),l+=4;for(var p=0;p<D;p++)x(i,l+3*p,y.itree[1+(y.ordr[p]<<1)]);l+=3*D,l=r.F._codeTiny(M,y.itree,i,l),l=r.F._codeTiny(P,y.itree,i,l)}for(var f=b,z=0;z<a;z+=2){for(var L=n[z],q=L>>>23,oe=f+(8388607&L);f<oe;)l=r.F._writeLit(w[f++],S,i,l);if(q!=0){var K=n[z+1],ee=K>>16,Z=K>>8&255,W=255&K;x(i,l=r.F._writeLit(257+Z,S,i,l),q-y.of0[Z]),l+=y.exb[Z],F(i,l=r.F._writeLit(W,E,i,l),ee-y.df0[W]),l+=y.dxb[W],f+=q}}l=r.F._writeLit(256,S,i,l)}return l},r.F._copyExact=function(e,n,a,d,w){var b=w>>>3;return d[b]=a,d[b+1]=a>>>8,d[b+2]=255-d[b],d[b+3]=255-d[b+1],b+=4,d.set(new Uint8Array(e.buffer,n,a),b),w+(a+4<<3)},r.F.getTrees=function(){for(var e=r.F.U,n=r.F._hufTree(e.lhst,e.ltree,15),a=r.F._hufTree(e.dhst,e.dtree,15),d=[],w=r.F._lenCodes(e.ltree,d),b=[],o=r.F._lenCodes(e.dtree,b),i=0;i<d.length;i+=2)e.ihst[d[i]]++;for(i=0;i<b.length;i+=2)e.ihst[b[i]]++;for(var l=r.F._hufTree(e.ihst,e.itree,7),h=19;h>4&&e.itree[1+(e.ordr[h-1]<<1)]==0;)h--;return[n,a,l,w,o,h,d,b]},r.F.getSecond=function(e){for(var n=[],a=0;a<e.length;a+=2)n.push(e[a+1]);return n},r.F.nonZero=function(e){for(var n="",a=0;a<e.length;a+=2)e[a+1]!=0&&(n+=(a>>1)+",");return n},r.F.contSize=function(e,n){for(var a=0,d=0;d<n.length;d++)a+=n[d]*e[1+(d<<1)];return a},r.F._codeTiny=function(e,n,a,d){for(var w=0;w<e.length;w+=2){var b=e[w],o=e[w+1];d=r.F._writeLit(b,n,a,d);var i=b==16?2:b==17?3:7;b>15&&(r.F._putsE(a,d,o,i),d+=i)}return d},r.F._lenCodes=function(e,n){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var d=0;d<a;d+=2){var w=e[d+1],b=d+3<a?e[d+3]:-1,o=d+5<a?e[d+5]:-1,i=d==0?-1:e[d-1];if(w==0&&b==w&&o==w){for(var l=d+5;l+2<a&&e[l+2]==w;)l+=2;(h=Math.min(l+1-d>>>1,138))<11?n.push(17,h-3):n.push(18,h-11),d+=2*h-2}else if(w==i&&b==w&&o==w){for(l=d+5;l+2<a&&e[l+2]==w;)l+=2;var h=Math.min(l+1-d>>>1,6);n.push(16,h-3),d+=2*h-2}else n.push(w,0)}return a>>>1},r.F._hufTree=function(e,n,a){var d=[],w=e.length,b=n.length,o=0;for(o=0;o<b;o+=2)n[o]=0,n[o+1]=0;for(o=0;o<w;o++)e[o]!=0&&d.push({lit:o,f:e[o]});var i=d.length,l=d.slice(0);if(i==0)return 0;if(i==1){var h=d[0].lit;return l=h==0?1:0,n[1+(h<<1)]=1,n[1+(l<<1)]=1,1}d.sort((function(M,P){return M.f-P.f}));var g=d[0],N=d[1],v=0,C=1,U=2;for(d[0]={lit:-1,f:g.f+N.f,l:g,r:N,d:0};C!=i-1;)g=v!=C&&(U==i||d[v].f<d[U].f)?d[v++]:d[U++],N=v!=C&&(U==i||d[v].f<d[U].f)?d[v++]:d[U++],d[C++]={lit:-1,f:g.f+N.f,l:g,r:N};var D=r.F.setDepth(d[C-1],0);for(D>a&&(r.F.restrictDepth(l,a,D),D=a),o=0;o<i;o++)n[1+(l[o].lit<<1)]=l[o].d;return D},r.F.setDepth=function(e,n){return e.lit!=-1?(e.d=n,n):Math.max(r.F.setDepth(e.l,n+1),r.F.setDepth(e.r,n+1))},r.F.restrictDepth=function(e,n,a){var d=0,w=1<<a-n,b=0;for(e.sort((function(i,l){return l.d==i.d?i.f-l.f:l.d-i.d})),d=0;d<e.length&&e[d].d>n;d++){var o=e[d].d;e[d].d=n,b+=w-(1<<a-o)}for(b>>>=a-n;b>0;)(o=e[d].d)<n?(e[d].d++,b-=1<<n-o-1):d++;for(;d>=0;d--)e[d].d==n&&b<0&&(e[d].d--,b++);b!=0&&console.log("debt left")},r.F._goodIndex=function(e,n){var a=0;return n[16|a]<=e&&(a|=16),n[8|a]<=e&&(a|=8),n[4|a]<=e&&(a|=4),n[2|a]<=e&&(a|=2),n[1|a]<=e&&(a|=1),a},r.F._writeLit=function(e,n,a,d){return r.F._putsF(a,d,n[e<<1]),d+n[1+(e<<1)]},r.F.inflate=function(e,n){var a=Uint8Array;if(e[0]==3&&e[1]==0)return n||new a(0);var d=r.F,w=d._bitsF,b=d._bitsE,o=d._decodeTiny,i=d.makeCodes,l=d.codes2map,h=d._get17,g=d.U,N=n==null;N&&(n=new a(e.length>>>2<<3));for(var v,C,U=0,D=0,M=0,P=0,y=0,F=0,x=0,m=0,_=0;U==0;)if(U=w(e,_,1),D=w(e,_+1,2),_+=3,D!=0){if(N&&(n=r.F._check(n,m+(1<<17))),D==1&&(v=g.flmap,C=g.fdmap,F=511,x=31),D==2){M=b(e,_,5)+257,P=b(e,_+5,5)+1,y=b(e,_+10,4)+4,_+=14;for(var j=0;j<38;j+=2)g.itree[j]=0,g.itree[j+1]=0;var A=1;for(j=0;j<y;j++){var R=b(e,_+3*j,3);g.itree[1+(g.ordr[j]<<1)]=R,R>A&&(A=R)}_+=3*y,i(g.itree,A),l(g.itree,A,g.imap),v=g.lmap,C=g.dmap,_=o(g.imap,(1<<A)-1,M+P,e,_,g.ttree);var S=d._copyOut(g.ttree,0,M,g.ltree);F=(1<<S)-1;var E=d._copyOut(g.ttree,M,P,g.dtree);x=(1<<E)-1,i(g.ltree,S),l(g.ltree,S,v),i(g.dtree,E),l(g.dtree,E,C)}for(;;){var p=v[h(e,_)&F];_+=15&p;var f=p>>>4;if(!(f>>>8))n[m++]=f;else{if(f==256)break;var z=m+f-254;if(f>264){var L=g.ldef[f-257];z=m+(L>>>3)+b(e,_,7&L),_+=7&L}var q=C[h(e,_)&x];_+=15&q;var oe=q>>>4,K=g.ddef[oe],ee=(K>>>4)+w(e,_,15&K);for(_+=15&K,N&&(n=r.F._check(n,m+(1<<17)));m<z;)n[m]=n[m++-ee],n[m]=n[m++-ee],n[m]=n[m++-ee],n[m]=n[m++-ee];m=z}}}else{(7&_)!=0&&(_+=8-(7&_));var Z=4+(_>>>3),W=e[Z-4]|e[Z-3]<<8;N&&(n=r.F._check(n,m+W)),n.set(new a(e.buffer,e.byteOffset+Z,W),m),_=Z+W<<3,m+=W}return n.length==m?n:n.slice(0,m)},r.F._check=function(e,n){var a=e.length;if(n<=a)return e;var d=new Uint8Array(Math.max(a<<1,n));return d.set(e,0),d},r.F._decodeTiny=function(e,n,a,d,w,b){for(var o=r.F._bitsE,i=r.F._get17,l=0;l<a;){var h=e[i(d,w)&n];w+=15&h;var g=h>>>4;if(g<=15)b[l]=g,l++;else{var N=0,v=0;g==16?(v=3+o(d,w,2),w+=2,N=b[l-1]):g==17?(v=3+o(d,w,3),w+=3):g==18&&(v=11+o(d,w,7),w+=7);for(var C=l+v;l<C;)b[l]=N,l++}}return w},r.F._copyOut=function(e,n,a,d){for(var w=0,b=0,o=d.length>>>1;b<a;){var i=e[b+n];d[b<<1]=0,d[1+(b<<1)]=i,i>w&&(w=i),b++}for(;b<o;)d[b<<1]=0,d[1+(b<<1)]=0,b++;return w},r.F.makeCodes=function(e,n){for(var a,d,w,b,o=r.F.U,i=e.length,l=o.bl_count,h=0;h<=n;h++)l[h]=0;for(h=1;h<i;h+=2)l[e[h]]++;var g=o.next_code;for(a=0,l[0]=0,d=1;d<=n;d++)a=a+l[d-1]<<1,g[d]=a;for(w=0;w<i;w+=2)(b=e[w+1])!=0&&(e[w]=g[b],g[b]++)},r.F.codes2map=function(e,n,a){for(var d=e.length,w=r.F.U.rev15,b=0;b<d;b+=2)if(e[b+1]!=0)for(var o=b>>1,i=e[b+1],l=o<<4|i,h=n-i,g=e[b]<<h,N=g+(1<<h);g!=N;)a[w[g]>>>15-n]=l,g++},r.F.revCodes=function(e,n){for(var a=r.F.U.rev15,d=15-n,w=0;w<e.length;w+=2){var b=e[w]<<n-e[w+1];e[w]=a[b]>>>d}},r.F._putsE=function(e,n,a){a<<=7&n;var d=n>>>3;e[d]|=a,e[d+1]|=a>>>8},r.F._putsF=function(e,n,a){a<<=7&n;var d=n>>>3;e[d]|=a,e[d+1]|=a>>>8,e[d+2]|=a>>>16},r.F._bitsE=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8)>>>(7&n)&(1<<a)-1},r.F._bitsF=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)&(1<<a)-1},r.F._get17=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)},r.F._get25=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16|e[3+(n>>>3)]<<24)>>>(7&n)},r.F.U=(u=Uint16Array,t=Uint32Array,{next_code:new u(16),bl_count:new u(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new u(512),fltree:[],fdmap:new u(32),fdtree:[],lmap:new u(32768),ltree:[],ttree:[],dmap:new u(32768),dtree:[],imap:new u(512),itree:[],rev15:new u(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new u(65536),prev:new u(32768)}),(function(){for(var e=r.F.U,n=0;n<32768;n++){var a=n;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[n]=(a>>>16|a<<16)>>>17}function d(w,b,o){for(;b--!=0;)w.push(0,o)}for(n=0;n<32;n++)e.ldef[n]=e.of0[n]<<3|e.exb[n],e.ddef[n]=e.df0[n]<<4|e.dxb[n];d(e.fltree,144,8),d(e.fltree,112,9),d(e.fltree,24,7),d(e.fltree,8,8),r.F.makeCodes(e.fltree,9),r.F.codes2map(e.fltree,9,e.flmap),r.F.revCodes(e.fltree,9),d(e.fdtree,32,5),r.F.makeCodes(e.fdtree,5),r.F.codes2map(e.fdtree,5,e.fdmap),r.F.revCodes(e.fdtree,5),d(e.itree,19,0),d(e.ltree,286,0),d(e.dtree,30,0),d(e.ttree,320,0)})()})();var On=zn({__proto__:null,default:It},[It]);const ot=(function(){var c={nextZero(o,i){for(;o[i]!=0;)i++;return i},readUshort:(o,i)=>o[i]<<8|o[i+1],writeUshort(o,i,l){o[i]=l>>8&255,o[i+1]=255&l},readUint:(o,i)=>16777216*o[i]+(o[i+1]<<16|o[i+2]<<8|o[i+3]),writeUint(o,i,l){o[i]=l>>24&255,o[i+1]=l>>16&255,o[i+2]=l>>8&255,o[i+3]=255&l},readASCII(o,i,l){let h="";for(let g=0;g<l;g++)h+=String.fromCharCode(o[i+g]);return h},writeASCII(o,i,l){for(let h=0;h<l.length;h++)o[i+h]=l.charCodeAt(h)},readBytes(o,i,l){const h=[];for(let g=0;g<l;g++)h.push(o[i+g]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,i,l){let h,g="";for(let N=0;N<l;N++)g+=`%${c.pad(o[i+N].toString(16))}`;try{h=decodeURIComponent(g)}catch{return c.readASCII(o,i,l)}return h}};function u(o,i,l,h){const g=i*l,N=n(h),v=Math.ceil(i*N/8),C=new Uint8Array(4*g),U=new Uint32Array(C.buffer),{ctype:D}=h,{depth:M}=h,P=c.readUshort;if(D==6){const L=g<<2;if(M==8)for(var y=0;y<L;y+=4)C[y]=o[y],C[y+1]=o[y+1],C[y+2]=o[y+2],C[y+3]=o[y+3];if(M==16)for(y=0;y<L;y++)C[y]=o[y<<1]}else if(D==2){const L=h.tabs.tRNS;if(L==null){if(M==8)for(y=0;y<g;y++){var F=3*y;U[y]=255<<24|o[F+2]<<16|o[F+1]<<8|o[F]}if(M==16)for(y=0;y<g;y++)F=6*y,U[y]=255<<24|o[F+4]<<16|o[F+2]<<8|o[F]}else{var x=L[0];const q=L[1],oe=L[2];if(M==8)for(y=0;y<g;y++){var m=y<<2;F=3*y,U[y]=255<<24|o[F+2]<<16|o[F+1]<<8|o[F],o[F]==x&&o[F+1]==q&&o[F+2]==oe&&(C[m+3]=0)}if(M==16)for(y=0;y<g;y++)m=y<<2,F=6*y,U[y]=255<<24|o[F+4]<<16|o[F+2]<<8|o[F],P(o,F)==x&&P(o,F+2)==q&&P(o,F+4)==oe&&(C[m+3]=0)}}else if(D==3){const L=h.tabs.PLTE,q=h.tabs.tRNS,oe=q?q.length:0;if(M==1)for(var _=0;_<l;_++){var j=_*v,A=_*i;for(y=0;y<i;y++){m=A+y<<2;var R=3*(S=o[j+(y>>3)]>>7-((7&y)<<0)&1);C[m]=L[R],C[m+1]=L[R+1],C[m+2]=L[R+2],C[m+3]=S<oe?q[S]:255}}if(M==2)for(_=0;_<l;_++)for(j=_*v,A=_*i,y=0;y<i;y++)m=A+y<<2,R=3*(S=o[j+(y>>2)]>>6-((3&y)<<1)&3),C[m]=L[R],C[m+1]=L[R+1],C[m+2]=L[R+2],C[m+3]=S<oe?q[S]:255;if(M==4)for(_=0;_<l;_++)for(j=_*v,A=_*i,y=0;y<i;y++)m=A+y<<2,R=3*(S=o[j+(y>>1)]>>4-((1&y)<<2)&15),C[m]=L[R],C[m+1]=L[R+1],C[m+2]=L[R+2],C[m+3]=S<oe?q[S]:255;if(M==8)for(y=0;y<g;y++){var S;m=y<<2,R=3*(S=o[y]),C[m]=L[R],C[m+1]=L[R+1],C[m+2]=L[R+2],C[m+3]=S<oe?q[S]:255}}else if(D==4){if(M==8)for(y=0;y<g;y++){m=y<<2;var E=o[p=y<<1];C[m]=E,C[m+1]=E,C[m+2]=E,C[m+3]=o[p+1]}if(M==16)for(y=0;y<g;y++){var p;m=y<<2,E=o[p=y<<2],C[m]=E,C[m+1]=E,C[m+2]=E,C[m+3]=o[p+2]}}else if(D==0)for(x=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<l;_++){const L=_*v,q=_*i;if(M==1)for(var f=0;f<i;f++){var z=(E=255*(o[L+(f>>>3)]>>>7-(7&f)&1))==255*x?0:255;U[q+f]=z<<24|E<<16|E<<8|E}else if(M==2)for(f=0;f<i;f++)z=(E=85*(o[L+(f>>>2)]>>>6-((3&f)<<1)&3))==85*x?0:255,U[q+f]=z<<24|E<<16|E<<8|E;else if(M==4)for(f=0;f<i;f++)z=(E=17*(o[L+(f>>>1)]>>>4-((1&f)<<2)&15))==17*x?0:255,U[q+f]=z<<24|E<<16|E<<8|E;else if(M==8)for(f=0;f<i;f++)z=(E=o[L+f])==x?0:255,U[q+f]=z<<24|E<<16|E<<8|E;else if(M==16)for(f=0;f<i;f++)E=o[L+(f<<1)],z=P(o,L+(f<<1))==x?0:255,U[q+f]=z<<24|E<<16|E<<8|E}return C}function t(o,i,l,h){const g=n(o),N=Math.ceil(l*g/8),v=new Uint8Array((N+1+o.interlace)*h);return i=o.tabs.CgBI?e(i,v):r(i,v),o.interlace==0?i=a(i,o,0,l,h):o.interlace==1&&(i=(function(U,D){const M=D.width,P=D.height,y=n(D),F=y>>3,x=Math.ceil(M*y/8),m=new Uint8Array(P*x);let _=0;const j=[0,0,4,0,2,0,1],A=[0,4,0,2,0,1,0],R=[8,8,8,4,4,2,2],S=[8,8,4,4,2,2,1];let E=0;for(;E<7;){const f=R[E],z=S[E];let L=0,q=0,oe=j[E];for(;oe<P;)oe+=f,q++;let K=A[E];for(;K<M;)K+=z,L++;const ee=Math.ceil(L*y/8);a(U,D,_,L,q);let Z=0,W=j[E];for(;W<P;){let he=A[E],O=_+Z*ee<<3;for(;he<M;){var p;if(y==1&&(p=(p=U[O>>3])>>7-(7&O)&1,m[W*x+(he>>3)]|=p<<7-((7&he)<<0)),y==2&&(p=(p=U[O>>3])>>6-(7&O)&3,m[W*x+(he>>2)]|=p<<6-((3&he)<<1)),y==4&&(p=(p=U[O>>3])>>4-(7&O)&15,m[W*x+(he>>1)]|=p<<4-((1&he)<<2)),y>=8){const V=W*x+he*F;for(let J=0;J<F;J++)m[V+J]=U[(O>>3)+J]}O+=y,he+=z}Z++,W+=f}L*q!=0&&(_+=q*(1+ee)),E+=1}return m})(i,o)),i}function r(o,i){return e(new Uint8Array(o.buffer,2,o.length-6),i)}var e=(function(){const o={H:{}};return o.H.N=function(i,l){const h=Uint8Array;let g,N,v=0,C=0,U=0,D=0,M=0,P=0,y=0,F=0,x=0;if(i[0]==3&&i[1]==0)return l||new h(0);const m=o.H,_=m.b,j=m.e,A=m.R,R=m.n,S=m.A,E=m.Z,p=m.m,f=l==null;for(f&&(l=new h(i.length>>>2<<5));v==0;)if(v=_(i,x,1),C=_(i,x+1,2),x+=3,C!=0){if(f&&(l=o.H.W(l,F+(1<<17))),C==1&&(g=p.J,N=p.h,P=511,y=31),C==2){U=j(i,x,5)+257,D=j(i,x+5,5)+1,M=j(i,x+10,4)+4,x+=14;let L=1;for(var z=0;z<38;z+=2)p.Q[z]=0,p.Q[z+1]=0;for(z=0;z<M;z++){const K=j(i,x+3*z,3);p.Q[1+(p.X[z]<<1)]=K,K>L&&(L=K)}x+=3*M,R(p.Q,L),S(p.Q,L,p.u),g=p.w,N=p.d,x=A(p.u,(1<<L)-1,U+D,i,x,p.v);const q=m.V(p.v,0,U,p.C);P=(1<<q)-1;const oe=m.V(p.v,U,D,p.D);y=(1<<oe)-1,R(p.C,q),S(p.C,q,g),R(p.D,oe),S(p.D,oe,N)}for(;;){const L=g[E(i,x)&P];x+=15&L;const q=L>>>4;if(!(q>>>8))l[F++]=q;else{if(q==256)break;{let oe=F+q-254;if(q>264){const he=p.q[q-257];oe=F+(he>>>3)+j(i,x,7&he),x+=7&he}const K=N[E(i,x)&y];x+=15&K;const ee=K>>>4,Z=p.c[ee],W=(Z>>>4)+_(i,x,15&Z);for(x+=15&Z;F<oe;)l[F]=l[F++-W],l[F]=l[F++-W],l[F]=l[F++-W],l[F]=l[F++-W];F=oe}}}}else{(7&x)!=0&&(x+=8-(7&x));const L=4+(x>>>3),q=i[L-4]|i[L-3]<<8;f&&(l=o.H.W(l,F+q)),l.set(new h(i.buffer,i.byteOffset+L,q),F),x=L+q<<3,F+=q}return l.length==F?l:l.slice(0,F)},o.H.W=function(i,l){const h=i.length;if(l<=h)return i;const g=new Uint8Array(h<<1);return g.set(i,0),g},o.H.R=function(i,l,h,g,N,v){const C=o.H.e,U=o.H.Z;let D=0;for(;D<h;){const M=i[U(g,N)&l];N+=15&M;const P=M>>>4;if(P<=15)v[D]=P,D++;else{let y=0,F=0;P==16?(F=3+C(g,N,2),N+=2,y=v[D-1]):P==17?(F=3+C(g,N,3),N+=3):P==18&&(F=11+C(g,N,7),N+=7);const x=D+F;for(;D<x;)v[D]=y,D++}}return N},o.H.V=function(i,l,h,g){let N=0,v=0;const C=g.length>>>1;for(;v<h;){const U=i[v+l];g[v<<1]=0,g[1+(v<<1)]=U,U>N&&(N=U),v++}for(;v<C;)g[v<<1]=0,g[1+(v<<1)]=0,v++;return N},o.H.n=function(i,l){const h=o.H.m,g=i.length;let N,v,C,U;const D=h.j;for(var M=0;M<=l;M++)D[M]=0;for(M=1;M<g;M+=2)D[i[M]]++;const P=h.K;for(N=0,D[0]=0,v=1;v<=l;v++)N=N+D[v-1]<<1,P[v]=N;for(C=0;C<g;C+=2)U=i[C+1],U!=0&&(i[C]=P[U],P[U]++)},o.H.A=function(i,l,h){const g=i.length,N=o.H.m.r;for(let v=0;v<g;v+=2)if(i[v+1]!=0){const C=v>>1,U=i[v+1],D=C<<4|U,M=l-U;let P=i[v]<<M;const y=P+(1<<M);for(;P!=y;)h[N[P]>>>15-l]=D,P++}},o.H.l=function(i,l){const h=o.H.m.r,g=15-l;for(let N=0;N<i.length;N+=2){const v=i[N]<<l-i[N+1];i[N]=h[v]>>>g}},o.H.M=function(i,l,h){h<<=7&l;const g=l>>>3;i[g]|=h,i[g+1]|=h>>>8},o.H.I=function(i,l,h){h<<=7&l;const g=l>>>3;i[g]|=h,i[g+1]|=h>>>8,i[g+2]|=h>>>16},o.H.e=function(i,l,h){return(i[l>>>3]|i[1+(l>>>3)]<<8)>>>(7&l)&(1<<h)-1},o.H.b=function(i,l,h){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16)>>>(7&l)&(1<<h)-1},o.H.Z=function(i,l){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16)>>>(7&l)},o.H.i=function(i,l){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16|i[3+(l>>>3)]<<24)>>>(7&l)},o.H.m=(function(){const i=Uint16Array,l=Uint32Array;return{K:new i(16),j:new i(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new i(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new l(32),J:new i(512),_:[],h:new i(32),$:[],w:new i(32768),C:[],v:[],d:new i(32768),D:[],u:new i(512),Q:[],r:new i(32768),s:new l(286),Y:new l(30),a:new l(19),t:new l(15e3),k:new i(65536),g:new i(32768)}})(),(function(){const i=o.H.m;for(var l=0;l<32768;l++){let g=l;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,i.r[l]=(g>>>16|g<<16)>>>17}function h(g,N,v){for(;N--!=0;)g.push(0,v)}for(l=0;l<32;l++)i.q[l]=i.S[l]<<3|i.T[l],i.c[l]=i.p[l]<<4|i.z[l];h(i._,144,8),h(i._,112,9),h(i._,24,7),h(i._,8,8),o.H.n(i._,9),o.H.A(i._,9,i.J),o.H.l(i._,9),h(i.$,32,5),o.H.n(i.$,5),o.H.A(i.$,5,i.h),o.H.l(i.$,5),h(i.Q,19,0),h(i.C,286,0),h(i.D,30,0),h(i.v,320,0)})(),o.H.N})();function n(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function a(o,i,l,h,g){let N=n(i);const v=Math.ceil(h*N/8);let C,U;N=Math.ceil(N/8);let D=o[l],M=0;if(D>1&&(o[l]=[0,0,1][D-2]),D==3)for(M=N;M<v;M++)o[M+1]=o[M+1]+(o[M+1-N]>>>1)&255;for(let P=0;P<g;P++)if(C=l+P*v,U=C+P+1,D=o[U-1],M=0,D==0)for(;M<v;M++)o[C+M]=o[U+M];else if(D==1){for(;M<N;M++)o[C+M]=o[U+M];for(;M<v;M++)o[C+M]=o[U+M]+o[C+M-N]}else if(D==2)for(;M<v;M++)o[C+M]=o[U+M]+o[C+M-v];else if(D==3){for(;M<N;M++)o[C+M]=o[U+M]+(o[C+M-v]>>>1);for(;M<v;M++)o[C+M]=o[U+M]+(o[C+M-v]+o[C+M-N]>>>1)}else{for(;M<N;M++)o[C+M]=o[U+M]+d(0,o[C+M-v],0);for(;M<v;M++)o[C+M]=o[U+M]+d(o[C+M-N],o[C+M-v],o[C+M-N-v])}return o}function d(o,i,l){const h=o+i-l,g=h-o,N=h-i,v=h-l;return g*g<=N*N&&g*g<=v*v?o:N*N<=v*v?i:l}function w(o,i,l){l.width=c.readUint(o,i),i+=4,l.height=c.readUint(o,i),i+=4,l.depth=o[i],i++,l.ctype=o[i],i++,l.compress=o[i],i++,l.filter=o[i],i++,l.interlace=o[i],i++}function b(o,i,l,h,g,N,v,C,U){const D=Math.min(i,g),M=Math.min(l,N);let P=0,y=0;for(let E=0;E<M;E++)for(let p=0;p<D;p++)if(v>=0&&C>=0?(P=E*i+p<<2,y=(C+E)*g+v+p<<2):(P=(-C+E)*i-v+p<<2,y=E*g+p<<2),U==0)h[y]=o[P],h[y+1]=o[P+1],h[y+2]=o[P+2],h[y+3]=o[P+3];else if(U==1){var F=o[P+3]*.00392156862745098,x=o[P]*F,m=o[P+1]*F,_=o[P+2]*F,j=h[y+3]*(1/255),A=h[y]*j,R=h[y+1]*j,S=h[y+2]*j;const f=1-F,z=F+j*f,L=z==0?0:1/z;h[y+3]=255*z,h[y+0]=(x+A*f)*L,h[y+1]=(m+R*f)*L,h[y+2]=(_+S*f)*L}else if(U==2)F=o[P+3],x=o[P],m=o[P+1],_=o[P+2],j=h[y+3],A=h[y],R=h[y+1],S=h[y+2],F==j&&x==A&&m==R&&_==S?(h[y]=0,h[y+1]=0,h[y+2]=0,h[y+3]=0):(h[y]=x,h[y+1]=m,h[y+2]=_,h[y+3]=F);else if(U==3){if(F=o[P+3],x=o[P],m=o[P+1],_=o[P+2],j=h[y+3],A=h[y],R=h[y+1],S=h[y+2],F==j&&x==A&&m==R&&_==S)continue;if(F<220&&j>20)return!1}return!0}return{decode:function(i){const l=new Uint8Array(i);let h=8;const g=c,N=g.readUshort,v=g.readUint,C={tabs:{},frames:[]},U=new Uint8Array(l.length);let D,M=0,P=0;const y=[137,80,78,71,13,10,26,10];for(var F=0;F<8;F++)if(l[F]!=y[F])throw"The input is not a PNG file!";for(;h<l.length;){const E=g.readUint(l,h);h+=4;const p=g.readASCII(l,h,4);if(h+=4,p=="IHDR")w(l,h,C);else if(p=="iCCP"){for(var x=h;l[x]!=0;)x++;g.readASCII(l,h,x-h),l[x+1];const f=l.slice(x+2,h+E);let z=null;try{z=r(f)}catch{z=e(f)}C.tabs[p]=z}else if(p=="CgBI")C.tabs[p]=l.slice(h,h+4);else if(p=="IDAT"){for(F=0;F<E;F++)U[M+F]=l[h+F];M+=E}else if(p=="acTL")C.tabs[p]={num_frames:v(l,h),num_plays:v(l,h+4)},D=new Uint8Array(l.length);else if(p=="fcTL"){P!=0&&((S=C.frames[C.frames.length-1]).data=t(C,D.slice(0,P),S.rect.width,S.rect.height),P=0);const f={x:v(l,h+12),y:v(l,h+16),width:v(l,h+4),height:v(l,h+8)};let z=N(l,h+22);z=N(l,h+20)/(z==0?100:z);const L={rect:f,delay:Math.round(1e3*z),dispose:l[h+24],blend:l[h+25]};C.frames.push(L)}else if(p=="fdAT"){for(F=0;F<E-4;F++)D[P+F]=l[h+F+4];P+=E-4}else if(p=="pHYs")C.tabs[p]=[g.readUint(l,h),g.readUint(l,h+4),l[h+8]];else if(p=="cHRM")for(C.tabs[p]=[],F=0;F<8;F++)C.tabs[p].push(g.readUint(l,h+4*F));else if(p=="tEXt"||p=="zTXt"){C.tabs[p]==null&&(C.tabs[p]={});var m=g.nextZero(l,h),_=g.readASCII(l,h,m-h),j=h+E-m-1;if(p=="tEXt")R=g.readASCII(l,m+1,j);else{var A=r(l.slice(m+2,m+2+j));R=g.readUTF8(A,0,A.length)}C.tabs[p][_]=R}else if(p=="iTXt"){C.tabs[p]==null&&(C.tabs[p]={}),m=0,x=h,m=g.nextZero(l,x),_=g.readASCII(l,x,m-x);const f=l[x=m+1];var R;l[x+1],x+=2,m=g.nextZero(l,x),g.readASCII(l,x,m-x),x=m+1,m=g.nextZero(l,x),g.readUTF8(l,x,m-x),j=E-((x=m+1)-h),f==0?R=g.readUTF8(l,x,j):(A=r(l.slice(x,x+j)),R=g.readUTF8(A,0,A.length)),C.tabs[p][_]=R}else if(p=="PLTE")C.tabs[p]=g.readBytes(l,h,E);else if(p=="hIST"){const f=C.tabs.PLTE.length/3;for(C.tabs[p]=[],F=0;F<f;F++)C.tabs[p].push(N(l,h+2*F))}else if(p=="tRNS")C.ctype==3?C.tabs[p]=g.readBytes(l,h,E):C.ctype==0?C.tabs[p]=N(l,h):C.ctype==2&&(C.tabs[p]=[N(l,h),N(l,h+2),N(l,h+4)]);else if(p=="gAMA")C.tabs[p]=g.readUint(l,h)/1e5;else if(p=="sRGB")C.tabs[p]=l[h];else if(p=="bKGD")C.ctype==0||C.ctype==4?C.tabs[p]=[N(l,h)]:C.ctype==2||C.ctype==6?C.tabs[p]=[N(l,h),N(l,h+2),N(l,h+4)]:C.ctype==3&&(C.tabs[p]=l[h]);else if(p=="IEND")break;h+=E,g.readUint(l,h),h+=4}var S;return P!=0&&((S=C.frames[C.frames.length-1]).data=t(C,D.slice(0,P),S.rect.width,S.rect.height)),C.data=t(C,U,C.width,C.height),delete C.compress,delete C.interlace,delete C.filter,C},toRGBA8:function(i){const l=i.width,h=i.height;if(i.tabs.acTL==null)return[u(i.data,l,h,i).buffer];const g=[];i.frames[0].data==null&&(i.frames[0].data=i.data);const N=l*h*4,v=new Uint8Array(N),C=new Uint8Array(N),U=new Uint8Array(N);for(let M=0;M<i.frames.length;M++){const P=i.frames[M],y=P.rect.x,F=P.rect.y,x=P.rect.width,m=P.rect.height,_=u(P.data,x,m,i);if(M!=0)for(var D=0;D<N;D++)U[D]=v[D];if(P.blend==0?b(_,x,m,v,l,h,y,F,0):P.blend==1&&b(_,x,m,v,l,h,y,F,1),g.push(v.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)b(C,x,m,v,l,h,y,F,0);else if(P.dispose==2)for(D=0;D<N;D++)v[D]=U[D]}}return g},_paeth:d,_copyTile:b,_bin:c}})();(function(){const{_copyTile:c}=ot,{_bin:u}=ot,t=ot._paeth;var r={table:(function(){const x=new Uint32Array(256);for(let m=0;m<256;m++){let _=m;for(let j=0;j<8;j++)1&_?_=3988292384^_>>>1:_>>>=1;x[m]=_}return x})(),update(x,m,_,j){for(let A=0;A<j;A++)x=r.table[255&(x^m[_+A])]^x>>>8;return x},crc:(x,m,_)=>4294967295^r.update(4294967295,x,m,_)};function e(x,m,_,j){m[_]+=x[0]*j>>4,m[_+1]+=x[1]*j>>4,m[_+2]+=x[2]*j>>4,m[_+3]+=x[3]*j>>4}function n(x){return Math.max(0,Math.min(255,x))}function a(x,m){const _=x[0]-m[0],j=x[1]-m[1],A=x[2]-m[2],R=x[3]-m[3];return _*_+j*j+A*A+R*R}function d(x,m,_,j,A,R,S){S==null&&(S=1);const E=j.length,p=[];for(var f=0;f<E;f++){const W=j[f];p.push([W>>>0&255,W>>>8&255,W>>>16&255,W>>>24&255])}for(f=0;f<E;f++){let W=4294967295;for(var z=0,L=0;L<E;L++){var q=a(p[f],p[L]);L!=f&&q<W&&(W=q,z=L)}}const oe=new Uint32Array(A.buffer),K=new Int16Array(m*_*4),ee=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(f=0;f<ee.length;f++)ee[f]=255*((ee[f]+.5)/16-.5);for(let W=0;W<_;W++)for(let he=0;he<m;he++){var Z;f=4*(W*m+he),S!=2?Z=[n(x[f]+K[f]),n(x[f+1]+K[f+1]),n(x[f+2]+K[f+2]),n(x[f+3]+K[f+3])]:(q=ee[4*(3&W)+(3&he)],Z=[n(x[f]+q),n(x[f+1]+q),n(x[f+2]+q),n(x[f+3]+q)]),z=0;let O=16777215;for(L=0;L<E;L++){const te=a(Z,p[L]);te<O&&(O=te,z=L)}const V=p[z],J=[Z[0]-V[0],Z[1]-V[1],Z[2]-V[2],Z[3]-V[3]];S==1&&(he!=m-1&&e(J,K,f+4,7),W!=_-1&&(he!=0&&e(J,K,f+4*m-4,3),e(J,K,f+4*m,5),he!=m-1&&e(J,K,f+4*m+4,1))),R[f>>2]=z,oe[f>>2]=j[z]}}function w(x,m,_,j,A){A==null&&(A={});const{crc:R}=r,S=u.writeUint,E=u.writeUshort,p=u.writeASCII;let f=8;const z=x.frames.length>1;let L,q=!1,oe=33+(z?20:0);if(A.sRGB!=null&&(oe+=13),A.pHYs!=null&&(oe+=21),A.iCCP!=null&&(L=pako.deflate(A.iCCP),oe+=21+L.length+4),x.ctype==3){for(var K=x.plte.length,ee=0;ee<K;ee++)x.plte[ee]>>>24!=255&&(q=!0);oe+=8+3*K+4+(q?8+1*K+4:0)}for(var Z=0;Z<x.frames.length;Z++)z&&(oe+=38),oe+=(V=x.frames[Z]).cimg.length+12,Z!=0&&(oe+=4);oe+=12;const W=new Uint8Array(oe),he=[137,80,78,71,13,10,26,10];for(ee=0;ee<8;ee++)W[ee]=he[ee];if(S(W,f,13),f+=4,p(W,f,"IHDR"),f+=4,S(W,f,m),f+=4,S(W,f,_),f+=4,W[f]=x.depth,f++,W[f]=x.ctype,f++,W[f]=0,f++,W[f]=0,f++,W[f]=0,f++,S(W,f,R(W,f-17,17)),f+=4,A.sRGB!=null&&(S(W,f,1),f+=4,p(W,f,"sRGB"),f+=4,W[f]=A.sRGB,f++,S(W,f,R(W,f-5,5)),f+=4),A.iCCP!=null){const J=13+L.length;S(W,f,J),f+=4,p(W,f,"iCCP"),f+=4,p(W,f,"ICC profile"),f+=11,f+=2,W.set(L,f),f+=L.length,S(W,f,R(W,f-(J+4),J+4)),f+=4}if(A.pHYs!=null&&(S(W,f,9),f+=4,p(W,f,"pHYs"),f+=4,S(W,f,A.pHYs[0]),f+=4,S(W,f,A.pHYs[1]),f+=4,W[f]=A.pHYs[2],f++,S(W,f,R(W,f-13,13)),f+=4),z&&(S(W,f,8),f+=4,p(W,f,"acTL"),f+=4,S(W,f,x.frames.length),f+=4,S(W,f,A.loop!=null?A.loop:0),f+=4,S(W,f,R(W,f-12,12)),f+=4),x.ctype==3){for(S(W,f,3*(K=x.plte.length)),f+=4,p(W,f,"PLTE"),f+=4,ee=0;ee<K;ee++){const J=3*ee,te=x.plte[ee],Q=255&te,H=te>>>8&255,ae=te>>>16&255;W[f+J+0]=Q,W[f+J+1]=H,W[f+J+2]=ae}if(f+=3*K,S(W,f,R(W,f-3*K-4,3*K+4)),f+=4,q){for(S(W,f,K),f+=4,p(W,f,"tRNS"),f+=4,ee=0;ee<K;ee++)W[f+ee]=x.plte[ee]>>>24&255;f+=K,S(W,f,R(W,f-K-4,K+4)),f+=4}}let O=0;for(Z=0;Z<x.frames.length;Z++){var V=x.frames[Z];z&&(S(W,f,26),f+=4,p(W,f,"fcTL"),f+=4,S(W,f,O++),f+=4,S(W,f,V.rect.width),f+=4,S(W,f,V.rect.height),f+=4,S(W,f,V.rect.x),f+=4,S(W,f,V.rect.y),f+=4,E(W,f,j[Z]),f+=2,E(W,f,1e3),f+=2,W[f]=V.dispose,f++,W[f]=V.blend,f++,S(W,f,R(W,f-30,30)),f+=4);const J=V.cimg;S(W,f,(K=J.length)+(Z==0?0:4)),f+=4;const te=f;p(W,f,Z==0?"IDAT":"fdAT"),f+=4,Z!=0&&(S(W,f,O++),f+=4),W.set(J,f),f+=K,S(W,f,R(W,te,f-te)),f+=4}return S(W,f,0),f+=4,p(W,f,"IEND"),f+=4,S(W,f,R(W,f-4,4)),f+=4,W.buffer}function b(x,m,_){for(let j=0;j<x.frames.length;j++){const A=x.frames[j];A.rect.width;const R=A.rect.height,S=new Uint8Array(R*A.bpl+R);A.cimg=h(A.img,R,A.bpp,A.bpl,S,m,_)}}function o(x,m,_,j,A){const R=A[0],S=A[1],E=A[2],p=A[3],f=A[4],z=A[5];let L=6,q=8,oe=255;for(var K=0;K<x.length;K++){const ie=new Uint8Array(x[K]);for(var ee=ie.length,Z=0;Z<ee;Z+=4)oe&=ie[Z+3]}const W=oe!=255,he=(function(_e,je,Le,Re,ke,De){const ye=[];for(var ve=0;ve<_e.length;ve++){const Ue=new Uint8Array(_e[ve]),Ie=new Uint32Array(Ue.buffer);var qe;let Ye=0,Qe=0,et=je,ze=Le,ct=Re?1:0;if(ve!=0){const Ht=De||Re||ve==1||ye[ve-2].dispose!=0?1:2;let gt=0,At=1e9;for(let dt=0;dt<Ht;dt++){var Pe=new Uint8Array(_e[ve-1-dt]);const jt=new Uint32Array(_e[ve-1-dt]);let st=je,tt=Le,rt=-1,xt=-1;for(let ut=0;ut<Le;ut++)for(let at=0;at<je;at++)Ie[Me=ut*je+at]!=jt[Me]&&(at<st&&(st=at),at>rt&&(rt=at),ut<tt&&(tt=ut),ut>xt&&(xt=ut));rt==-1&&(st=tt=rt=xt=0),ke&&((1&st)==1&&st--,(1&tt)==1&&tt--);const vt=(rt-st+1)*(xt-tt+1);vt<At&&(At=vt,gt=dt,Ye=st,Qe=tt,et=rt-st+1,ze=xt-tt+1)}Pe=new Uint8Array(_e[ve-1-gt]),gt==1&&(ye[ve-1].dispose=2),qe=new Uint8Array(et*ze*4),c(Pe,je,Le,qe,et,ze,-Ye,-Qe,0),ct=c(Ue,je,Le,qe,et,ze,-Ye,-Qe,3)?1:0,ct==1?l(Ue,je,Le,qe,{x:Ye,y:Qe,width:et,height:ze}):c(Ue,je,Le,qe,et,ze,-Ye,-Qe,0)}else qe=Ue.slice(0);ye.push({rect:{x:Ye,y:Qe,width:et,height:ze},img:qe,blend:ct,dispose:0})}if(Re)for(ve=0;ve<ye.length;ve++){if((Ve=ye[ve]).blend==1)continue;const Ue=Ve.rect,Ie=ye[ve-1].rect,Ye=Math.min(Ue.x,Ie.x),Qe=Math.min(Ue.y,Ie.y),et={x:Ye,y:Qe,width:Math.max(Ue.x+Ue.width,Ie.x+Ie.width)-Ye,height:Math.max(Ue.y+Ue.height,Ie.y+Ie.height)-Qe};ye[ve-1].dispose=1,ve-1!=0&&i(_e,je,Le,ye,ve-1,et,ke),i(_e,je,Le,ye,ve,et,ke)}let Ke=0;if(_e.length!=1)for(var Me=0;Me<ye.length;Me++){var Ve;Ke+=(Ve=ye[Me]).rect.width*Ve.rect.height}return ye})(x,m,_,R,S,E),O={},V=[],J=[];if(j!=0){const ie=[];for(Z=0;Z<he.length;Z++)ie.push(he[Z].img.buffer);const _e=(function(ke){let De=0;for(var ye=0;ye<ke.length;ye++)De+=ke[ye].byteLength;const ve=new Uint8Array(De);let qe=0;for(ye=0;ye<ke.length;ye++){const Pe=new Uint8Array(ke[ye]),Ke=Pe.length;for(let Me=0;Me<Ke;Me+=4){let Ve=Pe[Me],Ue=Pe[Me+1],Ie=Pe[Me+2];const Ye=Pe[Me+3];Ye==0&&(Ve=Ue=Ie=0),ve[qe+Me]=Ve,ve[qe+Me+1]=Ue,ve[qe+Me+2]=Ie,ve[qe+Me+3]=Ye}qe+=Ke}return ve.buffer})(ie),je=N(_e,j);for(Z=0;Z<je.plte.length;Z++)V.push(je.plte[Z].est.rgba);let Le=0;for(Z=0;Z<he.length;Z++){const Re=(Q=he[Z]).img.length;var te=new Uint8Array(je.inds.buffer,Le>>2,Re>>2);J.push(te);const ke=new Uint8Array(je.abuf,Le,Re);z&&d(Q.img,Q.rect.width,Q.rect.height,V,ke,te),Q.img.set(ke),Le+=Re}}else for(K=0;K<he.length;K++){var Q=he[K];const ie=new Uint32Array(Q.img.buffer);var H=Q.rect.width;for(ee=ie.length,te=new Uint8Array(ee),J.push(te),Z=0;Z<ee;Z++){const _e=ie[Z];if(Z!=0&&_e==ie[Z-1])te[Z]=te[Z-1];else if(Z>H&&_e==ie[Z-H])te[Z]=te[Z-H];else{let je=O[_e];if(je==null&&(O[_e]=je=V.length,V.push(_e),V.length>=300))break;te[Z]=je}}}const ae=V.length;for(ae<=256&&f==0&&(q=ae<=2?1:ae<=4?2:ae<=16?4:8,q=Math.max(q,p)),K=0;K<he.length;K++){(Q=he[K]).rect.x,Q.rect.y,H=Q.rect.width;const ie=Q.rect.height;let _e=Q.img;new Uint32Array(_e.buffer);let je=4*H,Le=4;if(ae<=256&&f==0){je=Math.ceil(q*H/8);var le=new Uint8Array(je*ie);const Re=J[K];for(let ke=0;ke<ie;ke++){Z=ke*je;const De=ke*H;if(q==8)for(var ne=0;ne<H;ne++)le[Z+ne]=Re[De+ne];else if(q==4)for(ne=0;ne<H;ne++)le[Z+(ne>>1)]|=Re[De+ne]<<4-4*(1&ne);else if(q==2)for(ne=0;ne<H;ne++)le[Z+(ne>>2)]|=Re[De+ne]<<6-2*(3&ne);else if(q==1)for(ne=0;ne<H;ne++)le[Z+(ne>>3)]|=Re[De+ne]<<7-1*(7&ne)}_e=le,L=3,Le=1}else if(W==0&&he.length==1){le=new Uint8Array(H*ie*3);const Re=H*ie;for(Z=0;Z<Re;Z++){const ke=3*Z,De=4*Z;le[ke]=_e[De],le[ke+1]=_e[De+1],le[ke+2]=_e[De+2]}_e=le,L=2,Le=3,je=3*H}Q.img=_e,Q.bpl=je,Q.bpp=Le}return{ctype:L,depth:q,plte:V,frames:he}}function i(x,m,_,j,A,R,S){const E=Uint8Array,p=Uint32Array,f=new E(x[A-1]),z=new p(x[A-1]),L=A+1<x.length?new E(x[A+1]):null,q=new E(x[A]),oe=new p(q.buffer);let K=m,ee=_,Z=-1,W=-1;for(let O=0;O<R.height;O++)for(let V=0;V<R.width;V++){const J=R.x+V,te=R.y+O,Q=te*m+J,H=oe[Q];H==0||j[A-1].dispose==0&&z[Q]==H&&(L==null||L[4*Q+3]!=0)||(J<K&&(K=J),J>Z&&(Z=J),te<ee&&(ee=te),te>W&&(W=te))}Z==-1&&(K=ee=Z=W=0),S&&((1&K)==1&&K--,(1&ee)==1&&ee--),R={x:K,y:ee,width:Z-K+1,height:W-ee+1};const he=j[A];he.rect=R,he.blend=1,he.img=new Uint8Array(R.width*R.height*4),j[A-1].dispose==0?(c(f,m,_,he.img,R.width,R.height,-R.x,-R.y,0),l(q,m,_,he.img,R)):c(q,m,_,he.img,R.width,R.height,-R.x,-R.y,0)}function l(x,m,_,j,A){c(x,m,_,j,A.width,A.height,-A.x,-A.y,2)}function h(x,m,_,j,A,R,S){const E=[];let p,f=[0,1,2,3,4];R!=-1?f=[R]:(m*j>5e5||_==1)&&(f=[0]),S&&(p={level:0});const z=On;for(var L=0;L<f.length;L++){for(let K=0;K<m;K++)g(A,x,K,j,_,f[L]);E.push(z.deflate(A,p))}let q,oe=1e9;for(L=0;L<E.length;L++)E[L].length<oe&&(q=L,oe=E[L].length);return E[q]}function g(x,m,_,j,A,R){const S=_*j;let E=S+_;if(x[E]=R,E++,R==0)if(j<500)for(var p=0;p<j;p++)x[E+p]=m[S+p];else x.set(new Uint8Array(m.buffer,S,j),E);else if(R==1){for(p=0;p<A;p++)x[E+p]=m[S+p];for(p=A;p<j;p++)x[E+p]=m[S+p]-m[S+p-A]+256&255}else if(_==0){for(p=0;p<A;p++)x[E+p]=m[S+p];if(R==2)for(p=A;p<j;p++)x[E+p]=m[S+p];if(R==3)for(p=A;p<j;p++)x[E+p]=m[S+p]-(m[S+p-A]>>1)+256&255;if(R==4)for(p=A;p<j;p++)x[E+p]=m[S+p]-t(m[S+p-A],0,0)+256&255}else{if(R==2)for(p=0;p<j;p++)x[E+p]=m[S+p]+256-m[S+p-j]&255;if(R==3){for(p=0;p<A;p++)x[E+p]=m[S+p]+256-(m[S+p-j]>>1)&255;for(p=A;p<j;p++)x[E+p]=m[S+p]+256-(m[S+p-j]+m[S+p-A]>>1)&255}if(R==4){for(p=0;p<A;p++)x[E+p]=m[S+p]+256-t(0,m[S+p-j],0)&255;for(p=A;p<j;p++)x[E+p]=m[S+p]+256-t(m[S+p-A],m[S+p-j],m[S+p-A-j])&255}}}function N(x,m){const _=new Uint8Array(x),j=_.slice(0),A=new Uint32Array(j.buffer),R=v(j,m),S=R[0],E=R[1],p=_.length,f=new Uint8Array(p>>2);let z;if(_.length<2e7)for(var L=0;L<p;L+=4)z=C(S,q=_[L]*(1/255),oe=_[L+1]*(1/255),K=_[L+2]*(1/255),ee=_[L+3]*(1/255)),f[L>>2]=z.ind,A[L>>2]=z.est.rgba;else for(L=0;L<p;L+=4){var q=_[L]*.00392156862745098,oe=_[L+1]*(1/255),K=_[L+2]*(1/255),ee=_[L+3]*(1/255);for(z=S;z.left;)z=U(z.est,q,oe,K,ee)<=0?z.left:z.right;f[L>>2]=z.ind,A[L>>2]=z.est.rgba}return{abuf:j.buffer,inds:f,plte:E}}function v(x,m,_){_==null&&(_=1e-4);const j=new Uint32Array(x.buffer),A={i0:0,i1:x.length,bst:null,est:null,tdst:0,left:null,right:null};A.bst=P(x,A.i0,A.i1),A.est=y(A.bst);const R=[A];for(;R.length<m;){let E=0,p=0;for(var S=0;S<R.length;S++)R[S].est.L>E&&(E=R[S].est.L,p=S);if(E<_)break;const f=R[p],z=D(x,j,f.i0,f.i1,f.est.e,f.est.eMq255);if(f.i0>=z||f.i1<=z){f.est.L=0;continue}const L={i0:f.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};L.bst=P(x,L.i0,L.i1),L.est=y(L.bst);const q={i0:z,i1:f.i1,bst:null,est:null,tdst:0,left:null,right:null};for(q.bst={R:[],m:[],N:f.bst.N-L.bst.N},S=0;S<16;S++)q.bst.R[S]=f.bst.R[S]-L.bst.R[S];for(S=0;S<4;S++)q.bst.m[S]=f.bst.m[S]-L.bst.m[S];q.est=y(q.bst),f.left=L,f.right=q,R[p]=L,R.push(q)}for(R.sort(((E,p)=>p.bst.N-E.bst.N)),S=0;S<R.length;S++)R[S].ind=S;return[A,R]}function C(x,m,_,j,A){if(x.left==null)return x.tdst=(function(L,q,oe,K,ee){const Z=q-L[0],W=oe-L[1],he=K-L[2],O=ee-L[3];return Z*Z+W*W+he*he+O*O})(x.est.q,m,_,j,A),x;const R=U(x.est,m,_,j,A);let S=x.left,E=x.right;R>0&&(S=x.right,E=x.left);const p=C(S,m,_,j,A);if(p.tdst<=R*R)return p;const f=C(E,m,_,j,A);return f.tdst<p.tdst?f:p}function U(x,m,_,j,A){const{e:R}=x;return R[0]*m+R[1]*_+R[2]*j+R[3]*A-x.eMq}function D(x,m,_,j,A,R){for(j-=4;_<j;){for(;M(x,_,A)<=R;)_+=4;for(;M(x,j,A)>R;)j-=4;if(_>=j)break;const S=m[_>>2];m[_>>2]=m[j>>2],m[j>>2]=S,_+=4,j-=4}for(;M(x,_,A)>R;)_-=4;return _+4}function M(x,m,_){return x[m]*_[0]+x[m+1]*_[1]+x[m+2]*_[2]+x[m+3]*_[3]}function P(x,m,_){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],A=[0,0,0,0],R=_-m>>2;for(let S=m;S<_;S+=4){const E=x[S]*.00392156862745098,p=x[S+1]*(1/255),f=x[S+2]*(1/255),z=x[S+3]*(1/255);A[0]+=E,A[1]+=p,A[2]+=f,A[3]+=z,j[0]+=E*E,j[1]+=E*p,j[2]+=E*f,j[3]+=E*z,j[5]+=p*p,j[6]+=p*f,j[7]+=p*z,j[10]+=f*f,j[11]+=f*z,j[15]+=z*z}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:A,N:R}}function y(x){const{R:m}=x,{m:_}=x,{N:j}=x,A=_[0],R=_[1],S=_[2],E=_[3],p=j==0?0:1/j,f=[m[0]-A*A*p,m[1]-A*R*p,m[2]-A*S*p,m[3]-A*E*p,m[4]-R*A*p,m[5]-R*R*p,m[6]-R*S*p,m[7]-R*E*p,m[8]-S*A*p,m[9]-S*R*p,m[10]-S*S*p,m[11]-S*E*p,m[12]-E*A*p,m[13]-E*R*p,m[14]-E*S*p,m[15]-E*E*p],z=f,L=F;let q=[Math.random(),Math.random(),Math.random(),Math.random()],oe=0,K=0;if(j!=0)for(let Z=0;Z<16&&(q=L.multVec(z,q),K=Math.sqrt(L.dot(q,q)),q=L.sml(1/K,q),!(Z!=0&&Math.abs(K-oe)<1e-9));Z++)oe=K;const ee=[A*p,R*p,S*p,E*p];return{Cov:f,q:ee,e:q,L:oe,eMq255:L.dot(L.sml(255,ee),q),eMq:L.dot(q,ee),rgba:(Math.round(255*ee[3])<<24|Math.round(255*ee[2])<<16|Math.round(255*ee[1])<<8|Math.round(255*ee[0])<<0)>>>0}}var F={multVec:(x,m)=>[x[0]*m[0]+x[1]*m[1]+x[2]*m[2]+x[3]*m[3],x[4]*m[0]+x[5]*m[1]+x[6]*m[2]+x[7]*m[3],x[8]*m[0]+x[9]*m[1]+x[10]*m[2]+x[11]*m[3],x[12]*m[0]+x[13]*m[1]+x[14]*m[2]+x[15]*m[3]],dot:(x,m)=>x[0]*m[0]+x[1]*m[1]+x[2]*m[2]+x[3]*m[3],sml:(x,m)=>[x*m[0],x*m[1],x*m[2],x*m[3]]};ot.encode=function(m,_,j,A,R,S,E){A==null&&(A=0),E==null&&(E=!1);const p=o(m,_,j,A,[!1,!1,!1,0,E,!1]);return b(p,-1),w(p,_,j,R,S)},ot.encodeLL=function(m,_,j,A,R,S,E,p){const f={ctype:0+(A==1?0:2)+(R==0?0:4),depth:S,frames:[]},z=(A+R)*S,L=z*_;for(let q=0;q<m.length;q++)f.frames.push({rect:{x:0,y:0,width:_,height:j},img:new Uint8Array(m[q]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(L/8)});return b(f,0,!0),w(f,_,j,E,p)},ot.encode.compress=o,ot.encode.dither=d,ot.quantize=N,ot.quantize.getKDtree=v,ot.quantize.getNearest=C})();const Jr={toArrayBuffer(c,u){const t=c.width,r=c.height,e=t<<2,n=c.getContext("2d").getImageData(0,0,t,r),a=new Uint32Array(n.data.buffer),d=(32*t+31)/32<<2,w=d*r,b=122+w,o=new ArrayBuffer(b),i=new DataView(o),l=1<<20;let h,g,N,v,C=l,U=0,D=0,M=0;function P(x){i.setUint16(D,x,!0),D+=2}function y(x){i.setUint32(D,x,!0),D+=4}function F(x){D+=x}P(19778),y(b),F(4),y(122),y(108),y(t),y(-r>>>0),P(1),P(32),y(3),y(w),y(2835),y(2835),F(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),(function x(){for(;U<r&&C>0;){for(v=122+U*d,h=0;h<e;)C--,g=a[M++],N=g>>>24,i.setUint32(v+h,g<<8|N),h+=4;U++}M<a.length?(C=l,setTimeout(x,Jr._dly)):u(o)})()},toBlob(c,u){this.toArrayBuffer(c,(t=>{u(new Blob([t],{type:"image/bmp"}))}))},_dly:9};var Xe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Hn={[Xe.CHROME]:16384,[Xe.FIREFOX]:11180,[Xe.DESKTOP_SAFARI]:16384,[Xe.IE]:8192,[Xe.IOS]:4096,[Xe.ETC]:8192};const cr=typeof window<"u",Qr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ft=cr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Bn=(cr||Qr)&&(Ft&&Ft.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Xr=(cr||Qr)&&(Ft&&Ft.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function dr(c,u,t=Date.now()){return new Promise((r=>{const e=c.split(","),n=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let d=a.length;const w=new Uint8Array(d);for(;d--;)w[d]=a.charCodeAt(d);const b=new Blob([w],{type:n});b.name=u,b.lastModified=t,r(b)}))}function en(c){return new Promise(((u,t)=>{const r=new Xr;r.onload=()=>u(r.result),r.onerror=e=>t(e),r.readAsDataURL(c)}))}function tn(c){return new Promise(((u,t)=>{const r=new Image;r.onload=()=>u(r),r.onerror=e=>t(e),r.src=c}))}function bt(){if(bt.cachedResult!==void 0)return bt.cachedResult;let c=Xe.ETC;const{userAgent:u}=navigator;return/Chrom(e|ium)/i.test(u)?c=Xe.CHROME:/iP(ad|od|hone)/i.test(u)&&/WebKit/i.test(u)?c=Xe.IOS:/Safari/i.test(u)?c=Xe.DESKTOP_SAFARI:/Firefox/i.test(u)?c=Xe.FIREFOX:(/MSIE/i.test(u)||document.documentMode)&&(c=Xe.IE),bt.cachedResult=c,bt.cachedResult}function rn(c,u){const t=bt(),r=Hn[t];let e=c,n=u,a=e*n;const d=e>n?n/e:e/n;for(;a>r*r;){const w=(r+e)/2,b=(r+n)/2;w<b?(n=b,e=b*d):(n=w*d,e=w),a=e*n}return{width:e,height:n}}function Wt(c,u){let t,r;try{if(t=new OffscreenCanvas(c,u),r=t.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{t=document.createElement("canvas"),r=t.getContext("2d")}return t.width=c,t.height=u,[t,r]}function nn(c,u){const{width:t,height:r}=rn(c.width,c.height),[e,n]=Wt(t,r);return u&&/jpe?g/.test(u)&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height)),n.drawImage(c,0,0,e.width,e.height),e}function Pt(){return Pt.cachedResult!==void 0||(Pt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Pt.cachedResult}function zt(c,u={}){return new Promise((function(t,r){let e,n;var a=function(){try{return n=nn(e,u.fileType||c.type),t([e,n])}catch(w){return r(w)}},d=function(w){try{var b=function(o){try{throw o}catch(i){return r(i)}};try{let o;return en(c).then((function(i){try{return o=i,tn(o).then((function(l){try{return e=l,(function(){try{return a()}catch(h){return r(h)}})()}catch(h){return b(h)}}),b)}catch(l){return b(l)}}),b)}catch(o){b(o)}}catch(o){return r(o)}};try{if(Pt()||[Xe.DESKTOP_SAFARI,Xe.MOBILE_SAFARI].includes(bt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(c).then((function(w){try{return e=w,a()}catch{return d()}}),d)}catch{d()}}))}function $t(c,u,t,r,e=1){return new Promise((function(n,a){let d;if(u==="image/png"){let b,o,i;return b=c.getContext("2d"),{data:o}=b.getImageData(0,0,c.width,c.height),i=ot.encode([o.buffer],c.width,c.height,4096*e),d=new Blob([i],{type:u}),d.name=t,d.lastModified=r,w.call(this)}{let b=function(){return w.call(this)};if(u==="image/bmp")return new Promise((o=>Jr.toBlob(c,o))).then((function(o){try{return d=o,d.name=t,d.lastModified=r,b.call(this)}catch(i){return a(i)}}).bind(this),a);{let o=function(){return b.call(this)};if(typeof OffscreenCanvas=="function"&&c instanceof OffscreenCanvas)return c.convertToBlob({type:u,quality:e}).then((function(i){try{return d=i,d.name=t,d.lastModified=r,o.call(this)}catch(l){return a(l)}}).bind(this),a);{let i;return i=c.toDataURL(u,e),dr(i,t,r).then((function(l){try{return d=l,o.call(this)}catch(h){return a(h)}}).bind(this),a)}}}function w(){return n(d)}}))}function lt(c){c.width=0,c.height=0}function yt(){return new Promise((function(c,u){let t,r,e,n;return yt.cachedResult!==void 0?c(yt.cachedResult):dr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(a){try{return t=a,zt(t).then((function(d){try{return r=d[1],$t(r,t.type,t.name,t.lastModified).then((function(w){try{return e=w,lt(r),zt(e).then((function(b){try{return n=b[0],yt.cachedResult=n.width===1&&n.height===2,c(yt.cachedResult)}catch(o){return u(o)}}),u)}catch(b){return u(b)}}),u)}catch(w){return u(w)}}),u)}catch(d){return u(d)}}),u)}))}function sn(c){return new Promise(((u,t)=>{const r=new Xr;r.onload=e=>{const n=new DataView(e.target.result);if(n.getUint16(0,!1)!=65496)return u(-2);const a=n.byteLength;let d=2;for(;d<a;){if(n.getUint16(d+2,!1)<=8)return u(-1);const w=n.getUint16(d,!1);if(d+=2,w==65505){if(n.getUint32(d+=2,!1)!=1165519206)return u(-1);const b=n.getUint16(d+=6,!1)==18761;d+=n.getUint32(d+4,b);const o=n.getUint16(d,b);d+=2;for(let i=0;i<o;i++)if(n.getUint16(d+12*i,b)==274)return u(n.getUint16(d+12*i+8,b))}else{if((65280&w)!=65280)break;d+=n.getUint16(d,!1)}}return u(-1)},r.onerror=e=>t(e),r.readAsArrayBuffer(c)}))}function an(c,u){const{width:t}=c,{height:r}=c,{maxWidthOrHeight:e}=u;let n,a=c;return isFinite(e)&&(t>e||r>e)&&([a,n]=Wt(t,r),t>r?(a.width=e,a.height=r/t*e):(a.width=t/r*e,a.height=e),n.drawImage(c,0,0,a.width,a.height),lt(c)),a}function on(c,u){const{width:t}=c,{height:r}=c,[e,n]=Wt(t,r);switch(u>4&&u<9?(e.width=r,e.height=t):(e.width=t,e.height=r),u){case 2:n.transform(-1,0,0,1,t,0);break;case 3:n.transform(-1,0,0,-1,t,r);break;case 4:n.transform(1,0,0,-1,0,r);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,r,0);break;case 7:n.transform(0,-1,-1,0,r,t);break;case 8:n.transform(0,-1,1,0,0,t)}return n.drawImage(c,0,0,t,r),lt(c),e}function Lr(c,u,t=0){return new Promise((function(r,e){let n,a,d,w,b,o,i,l,h,g,N,v,C,U,D,M,P,y,F,x;function m(j=5){if(u.signal&&u.signal.aborted)throw u.signal.reason;n+=j,u.onProgress(Math.min(n,100))}function _(j){if(u.signal&&u.signal.aborted)throw u.signal.reason;n=Math.min(Math.max(j,n),100),u.onProgress(n)}return n=t,a=u.maxIteration||10,d=1024*u.maxSizeMB*1024,m(),zt(c,u).then((function(j){try{return[,w]=j,m(),b=an(w,u),m(),new Promise((function(A,R){var S;if(!(S=u.exifOrientation))return sn(c).then((function(p){try{return S=p,E.call(this)}catch(f){return R(f)}}).bind(this),R);function E(){return A(S)}return E.call(this)})).then((function(A){try{return o=A,m(),yt().then((function(R){try{return i=R?b:on(b,o),m(),l=u.initialQuality||1,h=u.fileType||c.type,$t(i,h,c.name,c.lastModified,l).then((function(S){try{{let p=function(){if(a--&&(D>d||D>C)){let z,L;return z=x?.95*F.width:F.width,L=x?.95*F.height:F.height,[P,y]=Wt(z,L),y.drawImage(F,0,0,z,L),l*=h==="image/png"?.85:.95,$t(P,h,c.name,c.lastModified,l).then((function(q){try{return M=q,lt(F),F=P,D=M.size,_(Math.min(99,Math.floor((U-D)/(U-d)*100))),p}catch(oe){return e(oe)}}),e)}return[1]},f=function(){return lt(F),lt(P),lt(b),lt(i),lt(w),_(100),r(M)};if(g=S,m(),N=g.size>d,v=g.size>c.size,!N&&!v)return _(100),r(g);var E;return C=c.size,U=g.size,D=U,F=i,x=!u.alwaysKeepResolution&&N,(E=(function(z){for(;z;){if(z.then)return void z.then(E,e);try{if(z.pop){if(z.length)return z.pop()?f.call(this):z;z=p}else z=z.call(this)}catch(L){return e(L)}}}).bind(this))(p)}}catch(p){return e(p)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)}catch(R){return e(R)}}).bind(this),e)}catch(A){return e(A)}}).bind(this),e)}))}const Gn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Xt;function qn(c,u){return new Promise(((t,r)=>{Xt||(Xt=(function(a){const d=[];return d.push(a),URL.createObjectURL(new Blob(d))})(Gn));const e=new Worker(Xt);e.addEventListener("message",(function(a){if(u.signal&&u.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return r(new Error(a.data.error)),void e.terminate();t(a.data.file),e.terminate()}else u.onProgress(a.data.progress)})),e.addEventListener("error",r),u.signal&&u.signal.addEventListener("abort",(()=>{r(u.signal.reason),e.terminate()})),e.postMessage({file:c,imageCompressionLibUrl:u.libURL,options:{...u,onProgress:void 0,signal:void 0}})}))}function Ge(c,u){return new Promise((function(t,r){let e,n,a,d,w,b;if(e={...u},a=0,{onProgress:d}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,w=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=h=>{a=h,typeof d=="function"&&d(a)},!(c instanceof Blob||c instanceof Bn))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(c.type))return r(new Error("The file given is not an image"));if(b=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!w||typeof Worker!="function"||b)return Lr(c,e).then((function(h){try{return n=h,l.call(this)}catch(g){return r(g)}}).bind(this),r);var o=(function(){try{return l.call(this)}catch(h){return r(h)}}).bind(this),i=function(h){try{return Lr(c,e).then((function(g){try{return n=g,o()}catch(N){return r(N)}}),r)}catch(g){return r(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",qn(c,e).then((function(h){try{return n=h,o()}catch{return i()}}),i)}catch{i()}function l(){try{n.name=c.name,n.lastModified=c.lastModified}catch{}try{e.preserveExif&&c.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===c.type)&&(n=Zr(c,n))}catch{}return t(n)}}))}Ge.getDataUrlFromFile=en,Ge.getFilefromDataUrl=dr,Ge.loadImage=tn,Ge.drawImageInCanvas=nn,Ge.drawFileInCanvas=zt,Ge.canvasToFile=$t,Ge.getExifOrientation=sn,Ge.handleMaxWidthOrHeight=an,Ge.followExifOrientation=on,Ge.cleanupCanvasMemory=lt,Ge.isAutoOrientationInBrowser=yt,Ge.approximateBelowMaximumCanvasSizeOfBrowser=rn,Ge.copyExifWithoutOrientation=Zr,Ge.getBrowserName=bt,Ge.version="2.0.2";var lr=function(c,u){return lr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])},lr(c,u)};function Vn(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");lr(c,u);function t(){this.constructor=c}c.prototype=u===null?Object.create(u):(t.prototype=u.prototype,new t)}var Oe=function(){return Oe=Object.assign||function(u){for(var t,r=1,e=arguments.length;r<e;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(u[n]=t[n])}return u},Oe.apply(this,arguments)};var er,Tr;function Yn(){if(Tr)return er;Tr=1;var c=!1,u,t,r,e,n,a,d,w,b,o,i,l,h,g,N;function v(){if(!c){c=!0;var U=navigator.userAgent,D=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(U),M=/(Mac OS X)|(Windows)|(Linux)/.exec(U);if(l=/\b(iPhone|iP[ao]d)/.exec(U),h=/\b(iP[ao]d)/.exec(U),o=/Android/i.exec(U),g=/FBAN\/\w+;/i.exec(U),N=/Mobile/i.exec(U),i=!!/Win64/.exec(U),D){u=D[1]?parseFloat(D[1]):D[5]?parseFloat(D[5]):NaN,u&&document&&document.documentMode&&(u=document.documentMode);var P=/(?:Trident\/(\d+.\d+))/.exec(U);a=P?parseFloat(P[1])+4:u,t=D[2]?parseFloat(D[2]):NaN,r=D[3]?parseFloat(D[3]):NaN,e=D[4]?parseFloat(D[4]):NaN,e?(D=/(?:Chrome\/(\d+\.\d+))/.exec(U),n=D&&D[1]?parseFloat(D[1]):NaN):n=NaN}else u=t=r=n=e=NaN;if(M){if(M[1]){var y=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(U);d=y?parseFloat(y[1].replace("_",".")):!0}else d=!1;w=!!M[2],b=!!M[3]}else d=w=b=!1}}var C={ie:function(){return v()||u},ieCompatibilityMode:function(){return v()||a>u},ie64:function(){return C.ie()&&i},firefox:function(){return v()||t},opera:function(){return v()||r},webkit:function(){return v()||e},safari:function(){return C.webkit()},chrome:function(){return v()||n},windows:function(){return v()||w},osx:function(){return v()||d},linux:function(){return v()||b},iphone:function(){return v()||l},mobile:function(){return v()||l||h||o||N},nativeApp:function(){return v()||g},android:function(){return v()||o},ipad:function(){return v()||h}};return er=C,er}var tr,Dr;function Kn(){if(Dr)return tr;Dr=1;var c=!!(typeof window<"u"&&window.document&&window.document.createElement),u={canUseDOM:c,canUseWorkers:typeof Worker<"u",canUseEventListeners:c&&!!(window.addEventListener||window.attachEvent),canUseViewport:c&&!!window.screen,isInWorker:!c};return tr=u,tr}var rr,Ur;function Zn(){if(Ur)return rr;Ur=1;var c=Kn(),u;c.canUseDOM&&(u=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function t(r,e){if(!c.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+r,a=n in document;if(!a){var d=document.createElement("div");d.setAttribute(n,"return;"),a=typeof d[n]=="function"}return!a&&u&&r==="wheel"&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}return rr=t,rr}var nr,Pr;function Jn(){if(Pr)return nr;Pr=1;var c=Yn(),u=Zn(),t=10,r=40,e=800;function n(a){var d=0,w=0,b=0,o=0;return"detail"in a&&(w=a.detail),"wheelDelta"in a&&(w=-a.wheelDelta/120),"wheelDeltaY"in a&&(w=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(d=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(d=w,w=0),b=d*t,o=w*t,"deltaY"in a&&(o=a.deltaY),"deltaX"in a&&(b=a.deltaX),(b||o)&&a.deltaMode&&(a.deltaMode==1?(b*=r,o*=r):(b*=e,o*=e)),b&&!d&&(d=b<1?-1:1),o&&!w&&(w=o<1?-1:1),{spinX:d,spinY:w,pixelX:b,pixelY:o}}return n.getEventType=function(){return c.firefox()?"DOMMouseScroll":u("wheel")?"wheel":"mousewheel"},nr=n,nr}var sr,Ir;function Qn(){return Ir||(Ir=1,sr=Jn()),sr}var Xn=Qn();const es=En(Xn);function ts(c,u,t,r,e,n){n===void 0&&(n=0);var a=_t(c,u,n),d=a.width,w=a.height,b=Math.min(d,t),o=Math.min(w,r);return b>o*e?{width:o*e,height:o}:{width:b,height:b/e}}function rs(c){return c.width>c.height?c.width/c.naturalWidth:c.height/c.naturalHeight}function kt(c,u,t,r,e){e===void 0&&(e=0);var n=_t(u.width,u.height,e),a=n.width,d=n.height;return{x:Fr(c.x,a,t.width,r),y:Fr(c.y,d,t.height,r)}}function Fr(c,u,t,r){var e=u*r/2-t/2;return Ot(c,-e,e)}function zr(c,u){return Math.sqrt(Math.pow(c.y-u.y,2)+Math.pow(c.x-u.x,2))}function $r(c,u){return Math.atan2(u.y-c.y,u.x-c.x)*180/Math.PI}function ns(c,u,t,r,e,n,a){n===void 0&&(n=0),a===void 0&&(a=!0);var d=a?ss:as,w=_t(u.width,u.height,n),b=_t(u.naturalWidth,u.naturalHeight,n),o={x:d(100,((w.width-t.width/e)/2-c.x/e)/w.width*100),y:d(100,((w.height-t.height/e)/2-c.y/e)/w.height*100),width:d(100,t.width/w.width*100/e),height:d(100,t.height/w.height*100/e)},i=Math.round(d(b.width,o.width*b.width/100)),l=Math.round(d(b.height,o.height*b.height/100)),h=b.width>=b.height*r,g=h?{width:Math.round(l*r),height:l}:{width:i,height:Math.round(i/r)},N=Oe(Oe({},g),{x:Math.round(d(b.width-g.width,o.x*b.width/100)),y:Math.round(d(b.height-g.height,o.y*b.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:N}}function ss(c,u){return Math.min(c,Math.max(0,u))}function as(c,u){return u}function os(c,u,t,r,e,n){var a=_t(u.width,u.height,t),d=Ot(r.width/a.width*(100/c.width),e,n),w={x:d*a.width/2-r.width/2-a.width*d*(c.x/100),y:d*a.height/2-r.height/2-a.height*d*(c.y/100)};return{crop:w,zoom:d}}function is(c,u,t){var r=rs(u);return t.height>t.width?t.height/(c.height*r):t.width/(c.width*r)}function ls(c,u,t,r,e,n){t===void 0&&(t=0);var a=_t(u.naturalWidth,u.naturalHeight,t),d=Ot(is(c,u,r),e,n),w=r.height>r.width?r.height/c.height:r.width/c.width,b={x:((a.width-c.width)/2-c.x)*w,y:((a.height-c.height)/2-c.y)*w};return{crop:b,zoom:d}}function Wr(c,u){return{x:(u.x+c.x)/2,y:(u.y+c.y)/2}}function cs(c){return c*Math.PI/180}function _t(c,u,t){var r=cs(t);return{width:Math.abs(Math.cos(r)*c)+Math.abs(Math.sin(r)*u),height:Math.abs(Math.sin(r)*c)+Math.abs(Math.cos(r)*u)}}function Ot(c,u,t){return Math.min(Math.max(c,u),t)}function Dt(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return c.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var ds=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,us=1,fs=3,hs=1,ms=(function(c){Vn(u,c);function u(){var t=c!==null&&c.apply(this,arguments)||this;return t.cropperRef=T.createRef(),t.imageRef=T.createRef(),t.videoRef=T.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.previousCropSize=null,t.isInitialized=!1,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var r=!0;t.resizeObserver=new window.ResizeObserver(function(e){if(r){r=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(r){return r.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var r=t.computeSizes();r&&(t.previousCropSize=r,t.emitCropData(),t.setInitialCrop(r),t.isInitialized=!0),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(r){if(t.props.initialCroppedAreaPercentages){var e=os(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),n=e.crop,a=e.zoom;t.props.onCropChange(n),t.props.onZoomChange&&t.props.onZoomChange(a)}else if(t.props.initialCroppedAreaPixels){var d=ls(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),n=d.crop,a=d.zoom;t.props.onCropChange(n),t.props.onZoomChange&&t.props.onZoomChange(a)}},t.computeSizes=function(){var r,e,n,a,d,w,b=t.imageRef.current||t.videoRef.current;if(b&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var o=t.containerRect.width/t.containerRect.height,i=((r=t.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((e=t.videoRef.current)===null||e===void 0?void 0:e.videoWidth)||0,l=((n=t.imageRef.current)===null||n===void 0?void 0:n.naturalHeight)||((a=t.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,h=b.offsetWidth<i||b.offsetHeight<l,g=i/l,N=void 0;if(h)switch(t.state.mediaObjectFit){default:case"contain":N=o>g?{width:t.containerRect.height*g,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/g};break;case"horizontal-cover":N={width:t.containerRect.width,height:t.containerRect.width/g};break;case"vertical-cover":N={width:t.containerRect.height*g,height:t.containerRect.height};break}else N={width:b.offsetWidth,height:b.offsetHeight};t.mediaSize=Oe(Oe({},N),{naturalWidth:i,naturalHeight:l}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var v=t.props.cropSize?t.props.cropSize:ts(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((d=t.state.cropSize)===null||d===void 0?void 0:d.height)!==v.height||((w=t.state.cropSize)===null||w===void 0?void 0:w.width)!==v.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(v),t.setState({cropSize:v},t.recomputeCropPosition),t.props.setCropSize&&t.props.setCropSize(v),v}},t.saveContainerPosition=function(){if(t.containerRef){var r=t.containerRef.getBoundingClientRect();t.containerPosition={x:r.left,y:r.top}}},t.onMouseDown=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(u.getMousePoint(r)))},t.onMouseMove=function(r){return t.onDrag(u.getMousePoint(r))},t.onScroll=function(r){t.currentDoc&&(r.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(r){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(r))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),r.touches.length===2?t.onPinchStart(r):r.touches.length===1&&t.onDragStart(u.getTouchPoint(r.touches[0]))))},t.onTouchMove=function(r){r.preventDefault(),r.touches.length===2?t.onPinchMove(r):r.touches.length===1&&t.onDrag(u.getTouchPoint(r.touches[0]))},t.onGestureStart=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(r){if(r.preventDefault(),!t.isTouching){var e=u.getMousePoint(r),n=t.gestureZoomStart-1+r.scale;if(t.setNewZoom(n,e,{shouldUpdatePosition:!0}),t.props.onRotationChange){var a=t.gestureRotationStart+r.rotation;t.props.onRotationChange(a)}}},t.onGestureEnd=function(r){t.cleanEvents()},t.onDragStart=function(r){var e,n,a=r.x,d=r.y;t.dragStartPosition={x:a,y:d},t.dragStartCrop=Oe({},t.props.crop),(n=(e=t.props).onInteractionStart)===null||n===void 0||n.call(e)},t.onDrag=function(r){var e=r.x,n=r.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(e===void 0||n===void 0)){var a=e-t.dragStartPosition.x,d=n-t.dragStartPosition.y,w={x:t.dragStartCrop.x+a,y:t.dragStartCrop.y+d},b=t.props.restrictPosition?kt(w,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):w;t.props.onCropChange(b)}}))},t.onDragStopped=function(){var r,e;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(e=(r=t.props).onInteractionEnd)===null||e===void 0||e.call(r)},t.onWheel=function(r){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(r))){r.preventDefault();var e=u.getMousePoint(r),n=es(r).pixelY,a=t.props.zoom-n*t.props.zoomSpeed/200;t.setNewZoom(a,e,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var d,w;return(w=(d=t.props).onInteractionStart)===null||w===void 0?void 0:w.call(d)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var d,w;return(w=(d=t.props).onInteractionEnd)===null||w===void 0?void 0:w.call(d)})},250)}},t.getPointOnContainer=function(r,e){var n=r.x,a=r.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(n-e.x),y:t.containerRect.height/2-(a-e.y)}},t.getPointOnMedia=function(r){var e=r.x,n=r.y,a=t.props,d=a.crop,w=a.zoom;return{x:(e+d.x)/w,y:(n+d.y)/w}},t.setNewZoom=function(r,e,n){var a=n===void 0?{}:n,d=a.shouldUpdatePosition,w=d===void 0?!0:d;if(!(!t.state.cropSize||!t.props.onZoomChange)){var b=Ot(r,t.props.minZoom,t.props.maxZoom);if(w){var o=t.getPointOnContainer(e,t.containerPosition),i=t.getPointOnMedia(o),l={x:i.x*b-o.x,y:i.y*b-o.y},h=t.props.restrictPosition?kt(l,t.mediaSize,t.state.cropSize,b,t.props.rotation):l;t.props.onCropChange(h)}t.props.onZoomChange(b)}},t.getCropData=function(){if(!t.state.cropSize)return null;var r=t.props.restrictPosition?kt(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return ns(r,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var r=t.getCropData();if(r){var e=r.croppedAreaPercentages,n=r.croppedAreaPixels;t.props.onCropComplete&&t.props.onCropComplete(e,n),t.props.onCropAreaChange&&t.props.onCropAreaChange(e,n)}},t.emitCropAreaChange=function(){var r=t.getCropData();if(r){var e=r.croppedAreaPercentages,n=r.croppedAreaPixels;t.props.onCropAreaChange&&t.props.onCropAreaChange(e,n)}},t.recomputeCropPosition=function(){var r,e;if(t.state.cropSize){var n=t.props.crop;if(t.isInitialized&&(!((r=t.previousCropSize)===null||r===void 0)&&r.width)&&(!((e=t.previousCropSize)===null||e===void 0)&&e.height)){var a=Math.abs(t.previousCropSize.width-t.state.cropSize.width)>1e-6||Math.abs(t.previousCropSize.height-t.state.cropSize.height)>1e-6;if(a){var d=t.state.cropSize.width/t.previousCropSize.width,w=t.state.cropSize.height/t.previousCropSize.height;n={x:t.props.crop.x*d,y:t.props.crop.y*w}}}var b=t.props.restrictPosition?kt(n,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):n;t.previousCropSize=t.state.cropSize,t.props.onCropChange(b),t.emitCropData()}},t.onKeyDown=function(r){var e,n,a=t.props,d=a.crop,w=a.onCropChange,b=a.keyboardStep,o=a.zoom,i=a.rotation,l=b;if(t.state.cropSize){r.shiftKey&&(l*=.2);var h=Oe({},d);switch(r.key){case"ArrowUp":h.y-=l,r.preventDefault();break;case"ArrowDown":h.y+=l,r.preventDefault();break;case"ArrowLeft":h.x-=l,r.preventDefault();break;case"ArrowRight":h.x+=l,r.preventDefault();break;default:return}t.props.restrictPosition&&(h=kt(h,t.mediaSize,t.state.cropSize,o,i)),r.repeat||(n=(e=t.props).onInteractionStart)===null||n===void 0||n.call(e),w(h)}},t.onKeyUp=function(r){var e,n;switch(r.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":r.preventDefault();break;default:return}t.emitCropData(),(n=(e=t.props).onInteractionEnd)===null||n===void 0||n.call(e)},t}return u.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=ds,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},u.prototype.componentWillUnmount=function(){var t,r;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((r=this.styleRef.parentNode)===null||r===void 0||r.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},u.prototype.componentDidUpdate=function(t){var r,e,n,a,d,w,b,o,i;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((r=t.cropSize)===null||r===void 0?void 0:r.height)!==((e=this.props.cropSize)===null||e===void 0?void 0:e.height)||((n=t.cropSize)===null||n===void 0?void 0:n.width)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.width)?this.computeSizes():(((d=t.crop)===null||d===void 0?void 0:d.x)!==((w=this.props.crop)===null||w===void 0?void 0:w.x)||((b=t.crop)===null||b===void 0?void 0:b.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((i=this.videoRef.current)===null||i===void 0||i.load());var l=this.getObjectFit();l!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:l},this.computeSizes)},u.prototype.getAspect=function(){var t=this.props,r=t.cropSize,e=t.aspect;return r?r.width/r.height:e},u.prototype.getObjectFit=function(){var t,r,e,n;if(this.props.objectFit==="cover"){var a=this.imageRef.current||this.videoRef.current;if(a&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var d=this.containerRect.width/this.containerRect.height,w=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((r=this.videoRef.current)===null||r===void 0?void 0:r.videoWidth)||0,b=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoHeight)||0,o=w/b;return o<d?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},u.prototype.onPinchStart=function(t){var r=u.getTouchPoint(t.touches[0]),e=u.getTouchPoint(t.touches[1]);this.lastPinchDistance=zr(r,e),this.lastPinchRotation=$r(r,e),this.onDragStart(Wr(r,e))},u.prototype.onPinchMove=function(t){var r=this;if(!(!this.currentDoc||!this.currentWindow)){var e=u.getTouchPoint(t.touches[0]),n=u.getTouchPoint(t.touches[1]),a=Wr(e,n);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var d=zr(e,n),w=r.props.zoom*(d/r.lastPinchDistance);r.setNewZoom(w,a,{shouldUpdatePosition:!1}),r.lastPinchDistance=d;var b=$r(e,n),o=r.props.rotation+(b-r.lastPinchRotation);r.props.onRotationChange&&r.props.onRotationChange(o),r.lastPinchRotation=b})}},u.prototype.render=function(){var t=this,r,e=this.props,n=e.image,a=e.video,d=e.mediaProps,w=e.cropperProps,b=e.transform,o=e.crop,i=o.x,l=o.y,h=e.rotation,g=e.zoom,N=e.cropShape,v=e.showGrid,C=e.roundCropAreaPixels,U=e.style,D=U.containerStyle,M=U.cropAreaStyle,P=U.mediaStyle,y=e.classes,F=y.containerClassName,x=y.cropAreaClassName,m=y.mediaClassName,_=(r=this.state.mediaObjectFit)!==null&&r!==void 0?r:this.getObjectFit();return T.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(A){return t.containerRef=A},"data-testid":"container",style:D,className:Dt("reactEasyCrop_Container",F)},n?T.createElement("img",Oe({alt:"",className:Dt("reactEasyCrop_Image",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},d,{src:n,ref:this.imageRef,style:Oe(Oe({},P),{transform:b||"translate(".concat(i,"px, ").concat(l,"px) rotate(").concat(h,"deg) scale(").concat(g,")")}),onLoad:this.onMediaLoad})):a&&T.createElement("video",Oe({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Dt("reactEasyCrop_Video",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},d,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:Oe(Oe({},P),{transform:b||"translate(".concat(i,"px, ").concat(l,"px) rotate(").concat(h,"deg) scale(").concat(g,")")}),controls:!1}),(Array.isArray(a)?a:[{src:a}]).map(function(j){return T.createElement("source",Oe({key:j.src},j))})),this.state.cropSize&&T.createElement("div",Oe({ref:this.cropperRef,style:Oe(Oe({},M),{width:C?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:C?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Dt("reactEasyCrop_CropArea",N==="round"&&"reactEasyCrop_CropAreaRound",v&&"reactEasyCrop_CropAreaGrid",x)},w)))},u.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:fs,minZoom:us,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:hs},u.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},u.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},u})(T.Component);const Be=[];for(let c=0;c<256;++c)Be.push((c+256).toString(16).slice(1));function ps(c,u=0){return(Be[c[u+0]]+Be[c[u+1]]+Be[c[u+2]]+Be[c[u+3]]+"-"+Be[c[u+4]]+Be[c[u+5]]+"-"+Be[c[u+6]]+Be[c[u+7]]+"-"+Be[c[u+8]]+Be[c[u+9]]+"-"+Be[c[u+10]]+Be[c[u+11]]+Be[c[u+12]]+Be[c[u+13]]+Be[c[u+14]]+Be[c[u+15]]).toLowerCase()}let ar;const gs=new Uint8Array(16);function xs(){if(!ar){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ar=crypto.getRandomValues.bind(crypto)}return ar(gs)}const ws=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Or={randomUUID:ws};function bs(c,u,t){c=c||{};const r=c.random??c.rng?.()??xs();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ps(r)}function vs(c,u,t){return Or.randomUUID&&!c?Or.randomUUID():bs(c)}const Hr=50,Ut=c=>{let u=null;if(c.reply_to){const t=Array.isArray(c.reply_to)?c.reply_to[0]:c.reply_to;c.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",c.reply_to_message_id,"reply_to:",c.reply_to,"replyToData:",t),t&&console.log("[normalizeMessage] replyToData.id:",t.id,"replyToData.user_id:",t.user_id,"replyToData.content:",t.content)),t&&t.id&&t.user_id?u={id:t.id,content:t.content||"",user_id:t.user_id,author_name:t.author_name}:c.reply_to_message_id&&t&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",t,"has id:",!!t?.id,"has user_id:",!!t?.user_id)}return{id:c.id,league_id:c.league_id,user_id:c.user_id,content:c.content,created_at:c.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:c.reply_to_message_id??null,reply_to:u}},Nt=c=>{const u=new Map;for(const t of c)u.set(t.id,t);return Array.from(u.values()).sort((t,r)=>new Date(t.created_at).getTime()-new Date(r.created_at).getTime())};function ys(c,u={}){const{userId:t,enabled:r=!0,autoSubscribe:e=!0}=u,n=()=>!c||!r?[]:We(`chat:messages:${c}`)||[],[a,d]=T.useState(n),[w,b]=T.useState(!1),[o,i]=T.useState(!1),[l,h]=T.useState(!0),[g,N]=T.useState(null),v=T.useRef(null),C=T.useRef(null),U=T.useCallback(x=>{d(m=>{const _=x(m);return v.current=_.length?_[0].created_at:null,_})},[]),D=T.useCallback(async({before:x,append:m})=>{if(!c||!r)return;console.log("[fetchPage] Starting fetch for league:",c,"append:",m,"before:",x);const _=fe.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",c).order("created_at",{ascending:!1}).limit(Hr);x&&_.lt("created_at",x);const{data:j,error:A}=await _;if(A)throw console.error("[useMiniLeagueChat] Error fetching messages:",A),A;console.log("[fetchPage] Fetched",j?.length||0,"messages from database");const R=(j??[]).filter(f=>f.reply_to_message_id),S=[...new Set(R.map(f=>f.reply_to_message_id))];console.log("[fetchPage] Found",R.length,"messages with reply_to_message_id, unique reply IDs:",S.length);let E=new Map;if(S.length>0){const{data:f,error:z}=await fe.from("league_messages").select("id, content, user_id").in("id",S);z&&console.error("[useMiniLeagueChat] Error fetching reply messages:",z),!z&&f&&f.forEach(L=>{E.set(L.id,L)})}if(j&&j.length>0){const f=j.filter(z=>z.reply_to_message_id);f.length>0&&(console.log("[fetchPage] Found",f.length,"messages with reply_to_message_id"),f.slice(0,3).forEach(z=>{const L=E.get(z.reply_to_message_id);console.log("[fetchPage] Message",z.id,"reply_to_message_id:",z.reply_to_message_id,"replyData:",L)}))}const p=(j??[]).map(f=>{if(f.reply_to_message_id){const z=E.get(f.reply_to_message_id);z?f.reply_to=z:f.reply_to=null}else f.reply_to=null;return Ut(f)}).reverse();U(f=>Nt(m?[...p,...f]:p)),(j??[]).length<Hr?h(!1):m||h(!0)},[c,r,U]),M=T.useCallback(async()=>{if(!c||!r){d([]),h(!0);return}const x=a.length>0;x||b(!0),N(null),v.current=null;try{const m=We(`chat:messages:${c}`);if(m&&m.length>0){U(()=>m),m.length>0&&(v.current=m[0].created_at),h(m.length>=50),x||b(!1),D({append:!1}).catch(_=>{console.warn("[useMiniLeagueChat] Background refresh failed:",_)});return}await D({append:!1})}catch(m){console.error("[useMiniLeagueChat] Error in refresh:",m),N(m?.message??"Failed to load chat")}finally{x||b(!1)}},[c,r,D,U,a.length]);T.useEffect(()=>{if(!c||!r){d([]),h(!0),C.current=null;return}if(C.current===c)return;C.current=c;const x=a.length>0,m=We(`chat:messages:${c}`);if(x||m&&m.length>0){!x&&m?(U(()=>m),m.length>0&&(v.current=m[0].created_at),h(m.length>=50)):x&&a.length>0&&(v.current=a[0].created_at,h(a.length>=50)),C.current=null;return}let _=!0;if(M().finally(()=>{_&&C.current===c&&(C.current=null)}),!e)return()=>{_=!1};const j=fe.channel(`league-messages:${c}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${c}`},async R=>{if(!_)return;const{data:S}=await fe.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",R.new.id).single();if(S){if(S.reply_to_message_id){const{data:p}=await fe.from("league_messages").select("id, content, user_id").eq("id",S.reply_to_message_id).single();p&&(S.reply_to=p)}const E=Ut(S);U(p=>p.some(f=>f.id===E.id)?p:Nt([...p,E]))}else{console.warn("[useMiniLeagueChat] Failed to fetch full message, using payload data:",R.new.id);const E=Ut(R.new);U(p=>p.some(f=>f.id===E.id)?p:Nt([...p,E]))}}).subscribe(),A=()=>{_&&document.visibilityState==="visible"&&M()};return document.addEventListener("visibilitychange",A),()=>{_=!1,document.removeEventListener("visibilitychange",A),fe.removeChannel(j)}},[c,r,e,M,U]);const P=T.useCallback(async()=>{if(!c||!r||!l||o)return;const x=v.current??a[0]?.created_at;if(x){i(!0);try{await D({before:x,append:!0})}catch(m){console.error("[useMiniLeagueChat] Error loading more messages:",m),N(m?.message??"Failed to load more messages")}finally{i(!1)}}},[c,r,l,o,D,a]),y=T.useCallback(async(x,m)=>{if(!c||!t)throw new Error("Missing league or user");const _=x.trim();if(!_)return;const j=vs(),A=`optimistic-${j}`,R={id:A,client_msg_id:j,league_id:c,user_id:t,content:_,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:m??null};U(p=>Nt([...p,R]));const{data:S,error:E}=await fe.from("league_messages").insert({league_id:c,user_id:t,content:_,reply_to_message_id:m??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(S&&S.reply_to_message_id){const{data:p}=await fe.from("league_messages").select("id, content, user_id").eq("id",S.reply_to_message_id).single();p&&(S.reply_to=p)}if(E)throw console.error("[useMiniLeagueChat] Error sending message:",E),U(p=>p.map(f=>f.id===A?{...f,status:"error"}:f)),E;if(S){const p=Ut(S);p.client_msg_id=j,U(f=>f.map(z=>z.id===A?{...p,status:"sent",client_msg_id:j}:z))}},[c,t,U]),F=T.useMemo(()=>a.slice(-5),[a]);return{messages:a,previewMessages:F,loading:w,loadingMore:o,hasMore:l,error:g,refresh:M,loadMore:P,sendMessage:y}}const _s={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},js={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},Cs=["","",""],Ss=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function ks({author:c,text:u,time:t,isOwnMessage:r,shape:e="single",messageId:n,reactions:a=[],onReactionClick:d,replyTo:w,onMessageClick:b}){const o="text-left",i=r?"bg-[#1C8376] text-white":"bg-white text-slate-900",l=r?js:_s,h="max-w-[85%]",[g,N]=T.useState(!1),[v,C]=T.useState(!1),U=T.useRef(null);T.useEffect(()=>{if(!g)return;const P=F=>{U.current&&!U.current.contains(F.target)&&N(!1)},y=setTimeout(()=>{document.addEventListener("mousedown",P)},100);return()=>{clearTimeout(y),document.removeEventListener("mousedown",P)}},[g]);const D=P=>{n&&d&&d(n,P),N(!1),C(!1)},M=P=>{const y=P.target;y.closest("button")||y.closest("[data-reaction]")||b&&b()};return s.jsxs("div",{className:`inline-block ${h} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},children:[s.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${o} ${i} ${l[e]} ${b?"cursor-pointer":""}`,onClick:M,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[c&&!r&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:c}),w&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${r?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-xs`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[s.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w.authorName||"Unknown"}),s.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:w.content})]}),s.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[s.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:u}),s.jsx("span",{className:`text-[11px] relative top-1 ${r?"text-[#DCDCDD]":"text-slate-400"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:t})]})]}),n&&!r&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[g&&s.jsxs("div",{ref:U,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[Cs.map(P=>s.jsx("button",{onClick:()=>D(P),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${P}`,children:P},P)),b&&s.jsx("button",{onClick:()=>{N(!1),b()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{N(!1),C(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>N(!g),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),v&&n&&!r&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>C(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>C(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 rounded-lg",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:Ss.map(P=>s.jsx("button",{onClick:()=>{n&&d&&d(n,P),C(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 flex items-center justify-center text-2xl",title:P,children:P},P))})]})})]}),a.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${r?"justify-end":"justify-start"}`,children:a.map(P=>s.jsxs("button",{onClick:()=>D(P.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${P.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700"}`,children:[s.jsx("span",{className:"text-base",children:P.emoji}),s.jsx("span",{children:P.count})]},P.emoji))})]})}function Ns({author:c,messages:u,isOwnMessage:t,avatarInitials:r,userId:e,reactions:n,onReactionClick:a,onMessageClick:d}){c==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",t,"messages:",u.length);const w=t?"justify-end":"justify-start",b=e===Yr;return s.jsxs("div",{className:`flex items-end gap-2 w-full ${w}`,children:[t?s.jsx("div",{className:"w-8 flex-shrink-0"}):b?s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:An,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs font-semibold text-slate-500 flex-shrink-0",children:(r||c.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:u.map((o,i)=>{const l=u.length===1?"single":i===0?"top":i===u.length-1?"bottom":"middle",h=o.messageId||o.id;let g="";if(typeof o.text=="string")g=o.text;else if(typeof o.text=="object"&&o.text!==null){const N=o.text?.props?.children||String(o.text);g=typeof N=="string"?N:String(N)}else g=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${t?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${t?"justify-end":"justify-start"}`,children:[s.jsx(ks,{author:!t&&i===0?c:void 0,text:o.text,time:o.time,isOwnMessage:t,shape:l,messageId:h,reactions:n?.[h]||[],onReactionClick:a,replyTo:o.replyTo,onMessageClick:d?()=>d(h,g,!t&&i===0?c:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function Es({groups:c,reactions:u,onReactionClick:t,onMessageClick:r}){const e=c.filter(n=>n.author==="Unknown");return e.length>0&&(console.error("[ChatThread] RENDERING with",e.length,'groups with "Unknown" author!'),e.forEach((n,a)=>{console.error(`[ChatThread] Group ${a}: id="${n.id}", author="${n.author}", messages=${n.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:c.map((n,a)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[n.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:n.dayLabel}),s.jsx(Ns,{author:n.author,avatarInitials:n.avatarInitials,isOwnMessage:n.isOwnMessage,userId:n.userId,messages:n.messages,reactions:u,onReactionClick:t,onMessageClick:r},`${n.id}-${n.author}-${a}`)]},`${n.id}-${n.author}-${a}`))})}const As=c=>new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Rs=c=>new Date(c).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Br=c=>{if(!c)return"?";const u=c.trim().split(/\s+/);return u.length===1?u[0][0]?.toUpperCase()??"?":`${u[0][0]?.toUpperCase()??""}${u[u.length-1][0]?.toUpperCase()??""}`},Et=(c,u)=>u?u instanceof Map?u.get(c)??"":u[c]??"":"";function Ms({miniLeagueId:c,memberNames:u,deepLinkError:t}){const{user:r}=Kr(),{messages:e,loading:n,loadingMore:a,hasMore:d,error:w,loadMore:b,sendMessage:o}=ys(c,{userId:r?.id,enabled:!!c}),[i,l]=T.useState(""),[h,g]=T.useState(!1),[N,v]=T.useState({}),[C,U]=T.useState(null),[D,M]=T.useState([]);T.useEffect(()=>{if(!c||!r?.id)return;const O=async()=>{try{const{error:J}=await fe.from("chat_presence").upsert({league_id:c,user_id:r.id,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});J&&console.error("[MiniLeagueChatBeta] Failed to update presence:",J)}catch(J){console.error("[MiniLeagueChatBeta] Failed to update presence:",J)}};O();const V=setInterval(O,1e4);return()=>{clearInterval(V)}},[c,r?.id]);const[P,y]=T.useState(0),F=T.useRef(!1),x=T.useRef(!1),m=T.useRef(!1),_=T.useRef(null),j=T.useRef(null),A=T.useRef(null),[R,S]=T.useState(0),E=T.useCallback(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[]),p=T.useCallback((O=[0,100,300,500,700])=>{requestAnimationFrame(()=>{O.forEach(V=>{setTimeout(()=>E(),V)})})},[E]);T.useEffect(()=>{if(e.length===0||!r?.id)return;const O=e.map(J=>J.id).filter(J=>!J.startsWith("optimistic-"));if(O.length===0)return;(async()=>{try{const{data:J,error:te}=await fe.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",O);if(te){console.error("[MiniLeagueChatBeta] Error loading reactions:",te),M(ae=>[...ae,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${te.message}`,timestamp:Date.now()}]);return}const Q={};(J||[]).forEach(ae=>{Q[ae.message_id]||(Q[ae.message_id]={}),Q[ae.message_id][ae.emoji]||(Q[ae.message_id][ae.emoji]={count:0,hasUserReacted:!1}),Q[ae.message_id][ae.emoji].count++,ae.user_id===r.id&&(Q[ae.message_id][ae.emoji].hasUserReacted=!0)});const H={};Object.keys(Q).forEach(ae=>{H[ae]=Object.entries(Q[ae]).map(([le,ne])=>({emoji:le,count:ne.count,hasUserReacted:ne.hasUserReacted}))}),v(H)}catch(J){console.error("[MiniLeagueChatBeta] Error in loadReactions:",J),M(te=>[...te,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${J?.message||String(J)}`,timestamp:Date.now()}])}})()},[e,r?.id]),T.useEffect(()=>{if(e.length===0||!r?.id)return;const O=e.map(J=>J.id).filter(J=>!J.startsWith("optimistic-"));if(O.length===0)return;const V=fe.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:te,error:Q}=await fe.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",O);if(Q){console.error("[MiniLeagueChatBeta] Error reloading reactions:",Q),M(le=>[...le,{id:`reactions-reload-${Date.now()}`,message:`Failed to reload reactions: ${Q.message}`,timestamp:Date.now()}]);return}const H={};(te||[]).forEach(le=>{H[le.message_id]||(H[le.message_id]={}),H[le.message_id][le.emoji]||(H[le.message_id][le.emoji]={count:0,hasUserReacted:!1}),H[le.message_id][le.emoji].count++,le.user_id===r.id&&(H[le.message_id][le.emoji].hasUserReacted=!0)});const ae={};Object.keys(H).forEach(le=>{ae[le]=Object.entries(H[le]).map(([ne,ie])=>({emoji:ne,count:ie.count,hasUserReacted:ie.hasUserReacted}))}),v(ae)}catch(te){console.error("[MiniLeagueChatBeta] Error in reaction subscription handler:",te),M(Q=>[...Q,{id:`reactions-sub-${Date.now()}`,message:`Error updating reactions: ${te?.message||String(te)}`,timestamp:Date.now()}])}})()}).subscribe();return()=>{fe.removeChannel(V)}},[e,r?.id]);const f=T.useCallback(async(O,V)=>{if(!r?.id)return;const te=(N[O]||[]).find(Q=>Q.emoji===V&&Q.hasUserReacted);if(v(Q=>{const H={...Q},ae=H[O]||[];if(te){const le=ae.map(ne=>ne.emoji===V?{...ne,count:Math.max(0,ne.count-1),hasUserReacted:!1}:ne).filter(ne=>ne.count>0||ne.emoji!==V);le.length===0?delete H[O]:H[O]=le}else ae.find(ne=>ne.emoji===V)?H[O]=ae.map(ne=>ne.emoji===V?{...ne,count:ne.count+1,hasUserReacted:!0}:ne):H[O]=[...ae,{emoji:V,count:1,hasUserReacted:!0}];return H}),te){const{error:Q}=await fe.from("league_message_reactions").delete().eq("message_id",O).eq("user_id",r.id).eq("emoji",V);Q&&v(H=>{const ae={...H},le=ae[O]||[];return le.find(ie=>ie.emoji===V)?ae[O]=le.map(ie=>ie.emoji===V?{...ie,count:ie.count+1,hasUserReacted:!0}:ie):ae[O]=[...le,{emoji:V,count:1,hasUserReacted:!0}],ae})}else{const{error:Q}=await fe.from("league_message_reactions").upsert({message_id:O,user_id:r.id,emoji:V});Q&&(console.error("[MiniLeagueChatBeta] Error adding reaction:",Q),M(H=>[...H,{id:`reaction-add-${Date.now()}`,message:`Failed to add reaction: ${Q.message}`,timestamp:Date.now()}]),v(H=>{const ae={...H},ne=(ae[O]||[]).map(ie=>ie.emoji===V?{...ie,count:Math.max(0,ie.count-1),hasUserReacted:!1}:ie).filter(ie=>ie.count>0||ie.emoji!==V);return ne.length===0?delete ae[O]:ae[O]=ne,ae}))}},[r?.id,N]);T.useEffect(()=>{F.current=!1,x.current=!1},[c]),T.useEffect(()=>{!i&&j.current&&(j.current.style.height="auto",j.current.style.height="42px")},[i]);const z=T.useCallback((O,V=[0,100,300,500,700])=>{const J=A.current?.offsetHeight||72;if(O>0){const te=O+J;S(O),_.current&&(_.current.style.paddingBottom=`${te+8}px`)}else S(0),_.current&&(_.current.style.paddingBottom=`${J+8}px`);p(V)},[p]);T.useEffect(()=>{const O=window.visualViewport;let V=null,J=0,te=!1;const Q=()=>{if(O){const ie=window.innerHeight,_e=O.height,je=O.offsetTop+_e;return Math.max(0,ie-je)}else return 0},H=()=>{V&&(clearTimeout(V),V=null),V=setTimeout(()=>{const ie=Q();Math.abs(ie-J)<10&&ie>0&&!te||(J=ie,z(ie))},50)};O&&(O.addEventListener("resize",H),O.addEventListener("scroll",H)),window.addEventListener("resize",H);const ae=()=>{te=!0,setTimeout(H,50),setTimeout(H,150),setTimeout(H,300),setTimeout(H,500)},le=()=>{te=!1,setTimeout(H,100)},ne=setTimeout(()=>{j.current&&(j.current.addEventListener("focus",ae),j.current.addEventListener("blur",le))},100);return H(),()=>{V&&clearTimeout(V),clearTimeout(ne),O&&(O.removeEventListener("resize",H),O.removeEventListener("scroll",H)),window.removeEventListener("resize",H),j.current&&(j.current.removeEventListener("focus",ae),j.current.removeEventListener("blur",le))}},[z]),T.useEffect(()=>{if(typeof window>"u")return;const O=()=>{const V=window.visualViewport;let J=0;if(V){const te=window.innerHeight,Q=V.height,H=V.offsetTop+Q;J=Math.max(0,te-H)}z(J)};return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[z]),T.useEffect(()=>{if(_.current&&A.current){const O=A.current.offsetHeight||72;_.current.style.paddingBottom=`${O+8}px`}},[]);const L=()=>{j.current&&j.current.removeAttribute("readonly");const O=()=>{const V=window.visualViewport;let J=0;if(V){const te=window.innerHeight,Q=V.height,H=V.offsetTop+Q;J=Math.max(0,te-H)}z(J,[0,100,200,400,600,800])};setTimeout(O,50),setTimeout(O,150),setTimeout(O,300),setTimeout(O,500),p([100,200,400,600])},q=O=>{const V=O.target;!(V.tagName==="A"||V.tagName==="BUTTON"||V.closest("a, button"))&&j.current&&document.activeElement===j.current&&j.current.blur()},oe=T.useMemo(()=>{if(!r)return"";const O=r.user_metadata??{};return O.display_name||O.full_name||r.email||""},[r]),K=T.useMemo(()=>{if(!e.length)return[];if(!(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1))return[];let V=null;return e.reduce((Q,H)=>{const ae=H.user_id===r?.id,ie=Et(H.user_id,u)||(ae?oe:"")||(ae?"You":"Unknown"),_e=ae?void 0:Br(ie),Le=new Date(H.created_at).toDateString(),Re=Le!==V;Re&&(V=Le);const ke=H.reply_to?Et(H.reply_to.user_id,u)||"Unknown":null,De={id:H.id,text:H.content,time:As(H.created_at),status:H.status&&H.status!=="sent"?H.status:void 0,messageId:H.id,replyTo:H.reply_to?{id:H.reply_to.id,content:H.reply_to.content,authorName:ke||void 0}:null},ye=Q[Q.length-1],ve=ye?.messages.length>0&&ye.messages[0].messageId?e.find(Pe=>Pe.id===ye.messages[0].messageId)?.user_id:null;if(ye&&!Re&&ye.isOwnMessage===ae&&ve===H.user_id){const Pe=ye.id.includes("-")?ye.id.split("-")[0]:ye.id,Ke=ye.messages.map(Ve=>{const Ue=Ve.messageId?e.find(Ie=>Ie.id===Ve.messageId):null;if(Ue?.reply_to){const Ie=Et(Ue.reply_to.user_id,u)||"Unknown";return{...Ve,replyTo:Ve.replyTo?{...Ve.replyTo,authorName:Ie}:null}}return Ve}),Me={...ye,id:`${Pe}-${ie}`,author:ie,avatarInitials:_e,userId:H.user_id,messages:[...Ke,De]};return[...Q.slice(0,-1),Me]}else return[...Q,{id:`${H.id}-${ie}`,author:ie,avatarInitials:_e,isOwnMessage:ae,userId:H.user_id,dayLabel:Re?Rs(H.created_at):void 0,messages:[De]}]},[]).map(Q=>{const H={...Q},ae=H.messages.map(le=>{const ne=le.messageId?e.find(ie=>ie.id===le.messageId):null;if(ne?.reply_to&&le.replyTo){const ie=Et(ne.reply_to.user_id,u)||"Unknown";if(ie!==le.replyTo.authorName)return{...le,replyTo:{...le.replyTo,authorName:ie}}}return le});if(H.author==="Unknown"&&H.messages.length>0&&H.messages[0].messageId){const le=e.find(ne=>ne.id===H.messages[0].messageId);if(le){const ne=Et(le.user_id,u);if(ne&&ne!=="Unknown"){const ie=H.id.includes("-")?H.id.split("-")[0]:H.id;return{...H,id:`${ie}-${ne}`,author:ne,avatarInitials:Br(ne),userId:le.user_id,messages:ae}}}}return{...H,messages:ae}})},[oe,u,e,r?.id,P]);T.useEffect(()=>{(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1)&&P===0&&y(1)},[u,P]),T.useEffect(()=>{const O=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1,V=K.some(J=>J.author==="Unknown");O&&V&&K.length>0&&(setTimeout(()=>{y(J=>J+1)},50),setTimeout(()=>{y(J=>J+1)},200))},[K,u]);const ee=T.useMemo(()=>{const O=K.map(J=>J.author).join(","),V=K.some(J=>J.author==="Unknown");return`chat-${K.length}-${V?"unknown":"resolved"}-${P}-${O.slice(0,50)}`},[K,P]),Z=T.useCallback(O=>{_.current=O,O&&e.length>0&&K.length>0&&requestAnimationFrame(()=>{O&&(O.scrollTop=O.scrollHeight)})},[e.length,K.length]),W=T.useCallback(async O=>{if(!c||!r?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const J=r.user_metadata?.display_name||r.user_metadata?.full_name||r.email||"User",te={timestamp:new Date().toISOString(),leagueId:c,senderId:r.id,ok:!1,sent:0,error:"Unknown error"};try{const Q=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:c,senderId:r.id,senderName:J,content:O,activeUserIds:[r.id]})}),H=await Q.json().catch(ae=>(te.error=`Failed to parse response: ${ae?.message||String(ae)}`,te.httpStatus=Q.status,{ok:!1,error:"Failed to parse response"}));Object.assign(te,{ok:H.ok,sent:H.sent||0,recipients:H.recipients||0,message:H.message,error:H.error,details:H.details,httpStatus:Q.status,fullResponse:H})}catch(Q){te.error=Q?.message||String(Q),te.exception=!0}finally{try{const Q=JSON.parse(localStorage.getItem("notification_logs")||"[]");Q.push(te);const H=Q.slice(-50);localStorage.setItem("notification_logs",JSON.stringify(H))}catch(Q){console.error("[MiniLeagueChatBeta] Error storing notification log:",Q),M(H=>[...H,{id:`notif-log-${Date.now()}`,message:`Failed to log notification: ${Q?.message||String(Q)}`,timestamp:Date.now()}])}}},[c,r?.id]),he=T.useCallback(async()=>{const O=i.trim();if(!(!c||!O||h))try{g(!0),l(""),j.current&&(j.current.style.height="auto",j.current.style.height="42px"),await o(O,C?.id||null),await W(O),U(null),p([0,150,300])}catch(V){console.error("[MiniLeagueChatBeta] Error sending message:",V),M(J=>[...J,{id:`send-${Date.now()}`,message:`Failed to send message: ${V?.message||String(V)}`,timestamp:Date.now()}]),l(O)}finally{g(!1)}},[i,c,W,p,o,h,C]);return T.useEffect(()=>{t&&M(O=>O.some(V=>V.message.includes("Deep Link"))?O:[...O,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${t}`,timestamp:Date.now()}])},[t]),T.useEffect(()=>{if(D.length===0)return;const O=setTimeout(()=>{M(V=>V.filter(J=>Date.now()-J.timestamp<5e3))},5e3);return()=>clearTimeout(O)},[D]),T.useEffect(()=>{c&&(x.current=!1,m.current=!1)},[c]),T.useEffect(()=>{if(e.length>0&&(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1)){m.current=!0;return}if(!n&&e.length>=0){const O=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1;if(e.length===0||O){const V=setTimeout(()=>{m.current=!0},50);return()=>clearTimeout(V)}}},[n,e.length,u]),e.length===0||K.length===0?null:s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[D.length>0&&s.jsx("div",{className:"px-4 pt-2 space-y-2",children:D.map(O=>s.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[s.jsx("span",{className:"flex-1",children:O.message}),s.jsx("button",{onClick:()=>M(V=>V.filter(J=>J.id!==O.id)),className:"text-red-600 flex-shrink-0",children:""})]},O.id))}),s.jsxs("div",{ref:Z,className:"flex-1 overflow-y-auto px-4 py-5",onClick:q,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%"},children:[d&&c&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:b,disabled:a,children:a?"Loading earlier":"Load earlier messages"}),e.length>0&&K.length>0?s.jsx(Es,{groups:K,reactions:N,onReactionClick:f,onMessageClick:(O,V,J)=>{const te=e.find(Q=>Q.id===O);if(te){let Q="";if(typeof V=="string")Q=V;else if(typeof V=="object"&&V!==null){const H=V?.props?.children||String(V);Q=typeof H=="string"?H:String(H)}else Q=String(V);U({id:O,content:Q||te.content,authorName:J}),setTimeout(()=>{j.current?.focus()},100)}}},ee):null]}),s.jsxs("div",{ref:A,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:R>0?"fixed":"relative",bottom:R>0?`${R}px`:"0",left:R>0?0:"auto",right:R>0?0:"auto",width:"100%",maxWidth:R>0?"440px":"100%",marginLeft:R>0?"auto":void 0,marginRight:R>0?"auto":void 0,zIndex:R>0?100:"auto",boxShadow:R>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[C&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",C.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:C.content})]}),s.jsx("button",{onClick:()=>U(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:j,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:i,disabled:!c||h,placeholder:c?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",onKeyDown:O=>{if(O.key==="Escape"&&C){U(null),O.preventDefault();return}O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),he())},onChange:O=>{l(O.target.value),j.current&&(j.current.style.height="auto",j.current.style.height=`${Math.min(j.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const V=window.visualViewport;if(V){const J=window.innerHeight,te=V.height,Q=V.offsetTop+te,H=J-Q;z(H,[0,100])}})},onFocus:L,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:he,disabled:!c||h||!i.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),w&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[w,"  try again or switch to the classic chat tab."]})]})]})}function Ls({winnerName:c,isDraw:u}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:u?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[c," Wins!"]})})})}function Ts({availableGws:c,selectedGw:u,onChange:t,className:r=""}){return c.length<=1?null:s.jsx("div",{className:`flex-1 ${r}`,children:s.jsx("select",{value:u||void 0,onChange:e=>{const n=parseInt(e.target.value,10);t(n)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:c.map(e=>s.jsxs("option",{value:e,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",e]},e))})})}function Ds({showForm:c,onToggle:u}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>u(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${c?"text-slate-600":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>u(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${c?"bg-[#1C8376] text-white shadow-sm":"text-slate-600"}`,children:"Form"})]})}function Us({form:c}){const u=c.slice(-5),t=5-u.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:t}).map((r,e)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${e}`)),u.map((r,e)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${r==="W"?"bg-green-100 text-green-700":r==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:r},e))]})}function Ps({rows:c,members:u,showForm:t,currentUserId:r,loading:e,isLateStartingLeague:n}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),t?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:n?"CP":"OCP"}),u.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[c.map((a,d)=>{const w=a.user_id===r,b=d===c.length-1;return s.jsxs("tr",{className:w?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...b?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:d+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:a.name}),t?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(Us,{form:a.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.ocp}),u.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-10 pl-1 pr-1",children:a.mltPts})]})]},a.user_id)}),e&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!e&&!c.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function Is({rows:c,members:u,currentUserId:t,positionChangeKeys:r,isApiTestLeague:e,hasLiveFixtures:n,hasStartingSoonFixtures:a,hasStartedFixtures:d,allFixturesFinished:w,resGw:b}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",e&&n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),e&&!w&&a&&!n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:d?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),u.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[c.map((o,i)=>{const l=o.user_id===t,h=i===c.length-1,g=r.has(o.user_id);return s.jsxs("tr",{className:`${l?"flash-user-row":""} ${g?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...h?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:i+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[e&&n&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),e&&!n&&a&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-[50px] pl-1 pr-1 ${e&&n?"pulse-live-score":""}`,children:o.score}),u.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1 ${e&&n?"pulse-live-score":""}`,children:o.unicorns})]},o.user_id)}),!c.length&&s.jsx("tr",{className:"bg-slate-50",children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center bg-slate-50",colSpan:u.length>=3?4:3,children:["No results recorded for GW ",b," yet."]})})]})]})})]})}function Fs(c){const u=Rn(),t=encodeURIComponent(c);if(u){const r=`whatsapp://send?text=${t}`;let e=!1,n=!1;try{const a=document.createElement("a");a.href=r,a.style.display="none",document.body.appendChild(a),a.click(),e=!0,setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},100)}catch{}if(!e)try{window.open(r),n=!0}catch{}if(!e&&!n)try{window.location.href=r}catch{window.open(`https://wa.me/?text=${t}`,"_blank")}}else{const r=`https://wa.me/?text=${t}`;try{window.open(r,"_blank")}catch{navigator.clipboard.writeText(c).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+c)})}}}function zs(c,u){const t=new Date(u.find(i=>i.gw===c)?.kickoff_time||""),r=new Date(t.getTime()-4500*1e3),e=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],n=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],a=e[r.getUTCDay()],d=r.getUTCDate(),w=n[r.getUTCMonth()],b=r.getUTCHours().toString().padStart(2,"0"),o=r.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${c} Predictions Reminder!

DEADLINE: THIS ${a} ${d} ${w}, ${b}:${o} BST

Don't forget!
playtotl.com`}function $s(c,u){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",c);try{const t=zs(c,u);console.log("[SubmissionStatusTable] Generated message:",t),Fs(t)}catch(t){console.error("[SubmissionStatusTable] Error in handleShareReminder:",t),alert("Error sharing reminder. Please try again.")}}function Gr({members:c,submittedMap:u,picksGw:t,allSubmitted:r,remaining:e,fixtures:n,onShareReminder:a,variant:d="full"}){const w=a||(()=>$s(t,n)),b=n.map(g=>g.kickoff_time).filter(g=>!!g).map(g=>new Date(g)).filter(g=>!isNaN(g.getTime())),o=b.length>0?new Date(Math.min(...b.map(g=>g.getTime()))):null,i=o?new Date(o.getTime()-4500*1e3):null,l=i?new Date>=i:!1;let h="";if(i){const g=d==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],v=g[i.getUTCDay()],C=i.getUTCDate(),U=N[i.getUTCMonth()],D=i.getUTCHours().toString().padStart(2,"0"),M=i.getUTCMinutes().toString().padStart(2,"0");h=`${v} ${C} ${U}, ${D}:${M} BST`}return d==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",c.length," to submit."]})}),!r&&s.jsxs("button",{type:"button",onClick:g=>{g.preventDefault(),g.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),w()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${l?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),l?"Deadline Passed:":"Deadline:",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:c.slice().sort((g,N)=>g.name.localeCompare(N.name)).map(g=>{const N=`${g.id}:${t}`,v=!!u.get(N);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:g.name}),s.jsx("td",{className:"px-4 py-3",children:v?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},g.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:r?s.jsxs(s.Fragment,{children:["All ",c.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",c.length," to submit."]})}),!r&&s.jsxs("button",{type:"button",onClick:g=>{g.preventDefault(),g.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),w()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-sm ${l?"text-orange-600 font-semibold":"text-slate-600"}`,children:[l?" Deadline Passed:":" Deadline:",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:c.slice().sort((g,N)=>g.name.localeCompare(N.name)).map(g=>{const N=`${g.id}:${t}`,v=!!u.get(N);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:g.name}),s.jsx("td",{className:"px-4 py-3",children:v?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},g.id)})})]})})]})}function qr({letter:c,correct:u,unicorn:t,hasSubmitted:r,isLive:e,isOngoing:n,isFinished:a}){let d;return u===!0?e||n?d="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":a?d="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":d="bg-emerald-600 text-white border-emerald-600":r?d="bg-emerald-600 text-white border-emerald-600":d="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",d].join(" "),title:t?"Correct!":void 0,children:c})}function Ws(c,u){return c==="FINISHED"?"FT":c==="PAUSED"?"HT":c==="IN_PLAY"?u==null?"LIVE":`${u}'`:"LIVE"}function Os(c){const u=(c||"?").trim().split(/\s+/);return u.length?u.length===1?u[0].slice(0,1).toUpperCase():(u[0][0]+u[u.length-1][0]).toUpperCase():"?"}function Hs({fixture:c,picks:u,members:t,outcome:r,liveScore:e,submittedMap:n,picksGw:a,isApiTestLeague:d=!1}){const w=c.home_code||c.home_team||c.home_name||"",b=c.away_code||c.away_team||c.away_name||"",o=kr(w)||c.home_name||c.home_team||"Home",i=kr(b)||c.away_name||c.away_team||"Away",h=(M=>{if(!M)return"";const P=new Date(M);if(isNaN(P.getTime()))return"";const y=String(P.getUTCHours()).padStart(2,"0"),F=String(P.getUTCMinutes()).padStart(2,"0");return`${y}:${F}`})(c.kickoff_time),g=!!(e&&e.status==="IN_PLAY"),N=!!(e&&(e.status==="PAUSED"||e.status==="HALF_TIME"||e.status==="HT")),v=!!(e&&e.status==="FINISHED"),C=g||N;let U=null;d&&e?e.homeScore>e.awayScore?U="H":e.awayScore>e.homeScore?U="A":e.homeScore===e.awayScore&&(U="D"):U=r;const D=M=>{const P=u.filter(m=>m.pick===M),y=u.length===t.length&&P.length===t.length,F=4,x=[];for(let m=0;m<P.length;m+=F){const _=P.slice(m,m+F);x.push(_)}return s.jsx("div",{className:"flex flex-col gap-1",children:x.map((m,_)=>s.jsx("div",{className:"flex items-center justify-center",children:m.map((j,A)=>{const R=t.find(f=>f.id===j.user_id),S=Os(R?.name??"?"),E=n.has(`${j.user_id}:${a}`),p=U&&U===M?!0:null;return y?s.jsx("span",{className:"inline-block",style:{marginLeft:A>0?"-8px":"0",position:"relative",zIndex:A},children:s.jsx(qr,{letter:S,correct:p,unicorn:p===!0,hasSubmitted:E,isLive:g,isOngoing:C,isFinished:v})},j.user_id):s.jsx(qr,{letter:S,correct:p,unicorn:p===!0,hasSubmitted:E,isLive:g,isOngoing:C,isFinished:v},j.user_id)})},_))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(g||N)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),v&&!g&&!N&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${C?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(Nr,{code:c.home_code||void 0,crest:c.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:e&&(g||N||v)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[e.homeScore," - ",e.awayScore]}):s.jsx("span",{children:h})}),s.jsx(Nr,{code:c.away_code||void 0,crest:c.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:i})})]}),e&&(C||v)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${C?"text-red-600":"text-slate-500"}`,children:Ws(e.status,e.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("A")})})]})]})})}function Vr({label:c,fixtures:u,picksByFixture:t,members:r,outcomes:e,liveScores:n,submittedMap:a,picksGw:d,isApiTestLeague:w=!1,isFirstSection:b=!1,hasLiveGames:o=!1,allGamesFinished:i=!1,allSubmitted:l=!1,resultsPublished:h=!1,deadlinePassed:g=!1,whoDidntSubmit:N=[],liveFixturesCount:v,hasStarted:C=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(Mn,{date:c,className:"text-lg font-normal"}),b&&s.jsxs(s.Fragment,{children:[w&&o&&v!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:v}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:u.length})]})]}),w&&i&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),w&&!C&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&l&&h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!w&&l&&!h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&g&&!l&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",N.length>0&&`(${N.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[u.map(U=>{try{const D=t.get(U.fixture_index)??[],M=e.get(U.fixture_index)||null,P=n[U.fixture_index]||null;return s.jsx(Hs,{fixture:U,picks:D,members:r,outcome:M,liveScore:P,submittedMap:a,picksGw:d,isApiTestLeague:w},`${U.gw}-${U.fixture_index}`)}catch(D){return console.error("Error rendering fixture:",D,U),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",U.fixture_index]},`${U.gw}-${U.fixture_index}`)}}),!u.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const or=8;function ir(c){return c.result==="H"||c.result==="D"||c.result==="A"?c.result:typeof c.home_goals=="number"&&typeof c.away_goals=="number"?c.home_goals>c.away_goals?"H":c.home_goals<c.away_goals?"A":"D":null}function Gs(){const{code:c=""}=Ln(),[u,t]=Tn(),{user:r}=Kr(),[e]=T.useState(()=>{const k=localStorage.getItem("oldSchoolMode");return k?JSON.parse(k):!1});T.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(e))},[e]),T.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const k=()=>{const G=document.querySelector(".league-header-fixed");if(G){const de=G.style.top||window.getComputedStyle(G).top;de!=="0px"&&de!=="0"&&(G.style.top="0",G.style.transform="translate3d(0, 0, 0)")}},I=()=>{k(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},$=G=>{const de=G.target;de.closest(".league-content-wrapper")||de.closest(".league-header-fixed")||de.closest(".chat-tab-wrapper")||G.preventDefault()};window.addEventListener("scroll",I,{passive:!0}),document.addEventListener("touchmove",$,{passive:!1});const B=setInterval(k,100);return k(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",I),document.removeEventListener("touchmove",$),clearInterval(B)}},[]),T.useEffect(()=>{const k=$=>{const B=$.target;(B.tagName==="INPUT"||B.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const G=document.querySelector(".league-header-fixed");G&&(G.style.top="0")},100)},I=()=>{const $=document.querySelector(".league-header-fixed");$&&($.style.top="0")};return document.addEventListener("focusin",k),window.addEventListener("resize",I),window.addEventListener("orientationchange",I),()=>{document.removeEventListener("focusin",k),window.removeEventListener("resize",I),window.removeEventListener("orientationchange",I)}},[]),T.useEffect(()=>{if(typeof window>"u")return;const k=window.visualViewport;if(!k)return;let I=null;const $=()=>{const G=F.current;if(!G)return;const de=k.offsetTop??0;G.style.setProperty("transform",`translate3d(0, ${de}px, 0)`,"important")},B=()=>{I&&cancelAnimationFrame(I),I=window.requestAnimationFrame($)};return B(),k.addEventListener("resize",B),k.addEventListener("scroll",B),()=>{I&&cancelAnimationFrame(I),k.removeEventListener("resize",B),k.removeEventListener("scroll",B),F.current&&F.current.style.removeProperty("transform")}},[]);const n=()=>{if(!c)return null;try{const k=We(`leagues:${r?.id||""}`);if(k){const I=k.find($=>$.code.toUpperCase()===c.toUpperCase());if(I)return I}}catch{}return null},[a,d]=T.useState(()=>n()),[w,b]=T.useState(!1),o=()=>{const k=n();if(!k?.id)return[];try{const I=We(`league:members:${k.id}`);if(I&&I.length>0)return I.map(([$,B])=>({id:$,name:B||"(no name)"}))}catch{}return[]},[i,l]=T.useState(o),[h,g]=T.useState(()=>!n()),N="chat",[v,C]=T.useState(N),[U,D]=T.useState(null),M=T.useRef(v);T.useEffect(()=>{M.current=v},[v]);const P=T.useRef(!1),y=T.useRef(!1);T.useEffect(()=>{const k=u.get("tab"),I=u.get("leagueCode");if(D(null),k==="chat"||I){if(I&&c!==I){D(`Deep link mismatch: URL has leagueCode=${I} but we're on league ${c}. Current URL: ${window.location.href}`);return}if(k==="chat"){v!=="chat"&&(C("chat"),setTimeout(()=>{M.current!=="chat"&&D(`Failed to open chat tab. Current tab: ${M.current}, Expected: chat. URL: ${window.location.href}`)},300));const $=setTimeout(()=>{t({},{replace:!0})},200);return()=>clearTimeout($)}}},[u,t,v,c]);const F=T.useRef(null),[x,m]=T.useState(!1),[_,j]=T.useState(!1),[A,R]=T.useState(!1),S=()=>{try{return We("app_meta:current_gw")?.current_gw??null}catch{return null}},[E,p]=T.useState(S),[f,z]=T.useState(null),[L,q]=T.useState(S),oe=()=>{try{return We("app:available_gws")??[]}catch{return[]}},[K,ee]=T.useState(()=>oe()),Z=T.useRef({}),W=T.useRef({}),he=T.useRef(new Map),[O,V]=T.useState(new Set),[J,te]=T.useState(!1),[Q,H]=T.useState(!1),[ae,le]=T.useState(0),[ne,ie]=T.useState(!1),[_e,je]=T.useState(!1),[Le,Re]=T.useState(!1),[ke,De]=T.useState(!1),[ye,ve]=T.useState(null),[qe,Pe]=T.useState(!1),[Ke,Me]=T.useState(null),[Ve,Ue]=T.useState({x:0,y:0}),[Ie,Ye]=T.useState(1),[Qe,et]=T.useState(null),[ze,ct]=T.useState(null),[Ht,gt]=T.useState(!1),[At,dt]=T.useState(!1),[jt,st]=T.useState(!1),[tt,rt]=T.useState(!1),[xt,vt]=T.useState(!1),[ut,at]=T.useState(!1),[Rt,ur]=T.useState(null),[Bt,fr]=T.useState(!1),[Gt,hr]=T.useState(!1),[Ct,ln]=T.useState(null),ft=T.useMemo(()=>!!r?.id&&i.some(k=>k.id===r.id),[r?.id,i]),mr=T.useMemo(()=>!!r?.id&&!!Ct&&Ct.id===r.id,[r?.id,Ct]),cn=T.useMemo(()=>Ct?.name??"League admin",[Ct]),dn=T.useMemo(()=>{const k=new Map;return i.forEach(I=>k.set(I.id,I.name)),k.set(Yr,Dn),k},[i]),pr=T.useCallback(()=>{if(!a?.code||typeof window>"u"||typeof navigator>"u")return;const k=`Join my mini league "${a.name}" on TotL!`,I=`${window.location.origin}/league/${a.code}`,$=navigator;if(typeof $.share=="function"){$.share({title:`Join ${a.name}`,text:k,url:I}).catch(()=>{});return}const B=`${k}
${I}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(B).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",a.code)}):window.prompt?.("Share this league code:",a.code)},[a]),un=T.useCallback(async()=>{if(!(!a?.id||!r?.id)){R(!0);try{const{error:k}=await fe.from("league_members").delete().eq("league_id",a.id).eq("user_id",r.id);if(k)throw k;typeof window<"u"&&(window.location.href="/leagues")}catch(k){typeof window<"u"&&window.alert?.(k?.message??"Failed to leave league. Please try again.")}finally{R(!1),j(!1)}}},[a?.id,r?.id]),fn=T.useCallback(async()=>{if(!(!a?.id||!r?.id)){st(!0);try{if(i.length>=or){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),dt(!1);return}const{error:k}=await fe.from("league_members").insert({league_id:a.id,user_id:r.id});if(k)throw k;const I=r.user_metadata?.display_name||r.email||"Someone";try{const $=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:a.id,userId:r.id,userName:I})}),B=await $.text();try{B&&JSON.parse(B)}catch{}$.ok}catch{}typeof window<"u"&&window.location.reload()}catch(k){typeof window<"u"&&window.alert?.(k?.message??"Failed to join league.")}finally{st(!1)}}},[a?.id,r?.id,i.length]),hn=T.useCallback(async()=>{if(!(!Rt||!a?.id||!r?.id)){fr(!0);try{const{error:k}=await fe.from("league_members").delete().eq("league_id",a.id).eq("user_id",Rt.id);if(k)throw k;typeof window<"u"&&window.location.reload()}catch(k){typeof window<"u"&&window.alert?.(k?.message??"Failed to remove member.")}finally{fr(!1),vt(!1),ur(null)}}},[a?.id,Rt,r?.id]),mn=T.useCallback(async()=>{if(!(!a?.id||!r?.id)){hr(!0);try{const{error:k}=await fe.from("league_members").delete().eq("league_id",a.id);if(k)throw k;const{error:I}=await fe.from("leagues").delete().eq("id",a.id);if(I)throw I;typeof window<"u"&&(window.location.href="/leagues")}catch(k){typeof window<"u"&&window.alert?.(k?.message??"Failed to end league.")}finally{hr(!1),at(!1)}}},[a?.id,r?.id]),pn=k=>new Promise((I,$)=>{const B=new Image;B.addEventListener("load",()=>I(B)),B.addEventListener("error",G=>$(G)),B.src=k}),gr=async(k,I)=>{const $=await pn(k),B=document.createElement("canvas"),G=B.getContext("2d");if(!G)throw new Error("No 2d context");return B.width=I.width,B.height=I.height,G.drawImage($,I.x,I.y,I.width,I.height,0,0,I.width,I.height),new Promise((de,pe)=>{B.toBlob(re=>{if(!re){pe(new Error("Canvas is empty"));return}de(re)},"image/jpeg",.9)})},gn=T.useCallback(k=>{if(!a?.id||!ft){ve("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(k.type)){ve("Please upload a PNG, JPG, or WebP image.");return}const $=20*1024*1024;if(k.size>$){ve("Please choose an image smaller than 20MB.");return}if(ve(null),Pe(!1),k.size>5*1024*1024)Ge(k,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(B=>{const G=new FileReader;G.onload=()=>{Me(G.result)},G.readAsDataURL(B)}).catch(()=>{ve("Failed to process image. Please try a smaller file.")});else{const B=new FileReader;B.onload=()=>{Me(B.result)},B.readAsDataURL(k)}},[ft,a?.id]),xn=T.useCallback(async(k,I)=>{if(et(I),Ke)try{const $=await gr(Ke,I),B=URL.createObjectURL($);ct(B)}catch{}},[Ke]),wn=T.useCallback(async()=>{if(!(!Ke||!Qe||!a?.id||!ft)){ve(null),Pe(!1),De(!0);try{const k=await gr(Ke,Qe),I=new File([k],"badge.jpg",{type:"image/jpeg"}),$=await Ge(I,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if($.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const B=`${a.id}-${Date.now()}.jpg`,{error:G}=await fe.storage.from("league-avatars").upload(B,$,{cacheControl:"3600",upsert:!0,contentType:$.type});if(G)throw G;const{data:de}=fe.storage.from("league-avatars").getPublicUrl(B),pe=de?.publicUrl;if(!pe)throw new Error("Unable to get public URL for badge.");const{error:re}=await fe.from("leagues").update({avatar:pe}).eq("id",a.id);if(re)throw re;d(Ne=>Ne&&{...Ne,avatar:pe}),Pe(!0),ze&&URL.revokeObjectURL(ze),Me(null),ct(null),Re(!1),r?.id&&(Jt(r.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:pe}})))}catch(k){ve(k?.message??"Failed to upload badge. Please try again.")}finally{De(!1)}}},[Ke,Qe,ft,a?.id,r?.id]),bn=T.useCallback(async()=>{if(!(!a?.id||!ft)){ve(null),Pe(!1),De(!0);try{const{error:k}=await fe.from("leagues").update({avatar:null}).eq("id",a.id);if(k)throw k;d(I=>I&&{...I,avatar:null}),Pe(!0),r?.id&&(Jt(r.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:null}})))}catch(k){ve(k?.message??"Failed to remove badge. Please try again.")}finally{De(!1)}}},[ft,a?.id]),[xr,vn]=T.useState(new Map);T.useEffect(()=>{(async()=>{const k=new Map,{data:I}=await fe.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:$}=await fe.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),B=new Map;if(I&&I.forEach(G=>{(!B.has(G.gw)||G.kickoff_time&&new Date(G.kickoff_time)<new Date(B.get(G.gw)))&&G.kickoff_time&&B.set(G.gw,G.kickoff_time)}),$&&$.length>0){const G=$.find(de=>de.kickoff_time)?.kickoff_time;if(G){const de=B.get(1);(!de||new Date(G)<new Date(de))&&B.set(1,G)}}B.forEach((G,de)=>{const pe=new Date(G),re=new Date(pe.getTime()-4500*1e3);k.set(de,re)}),vn(k)})()},[]),T.useEffect(()=>{const k=I=>{const $=I.target;J&&!$.closest(".gw-dropdown-container")&&te(!1)};return J&&document.addEventListener("click",k),()=>document.removeEventListener("click",k)},[J]),T.useEffect(()=>{let k=!0;return(async()=>{const{data:I}=await fe.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!k)return;p(I?.current_gw??null);const{data:$}=await fe.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!k)return;z($&&$.length?$[0].gw:null);const{data:B}=await fe.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!k)return;const G=B?[...new Set(B.map(pe=>pe.gw))].sort((pe,re)=>re-pe):[],de=I?.current_gw;de&&!G.includes(de)&&G.unshift(de),ee(G),(G.length>0&&!L||G.length>0&&L&&!G.includes(L))&&q(G[0])})(),()=>{k=!1}},[ae]);const yn=T.useMemo(()=>i.map(k=>k.id).sort().join(","),[i]),mt=T.useMemo(()=>i.map(k=>k.id),[yn]),[Te,wr]=T.useState([]),[br,qt]=T.useState([]),[vr,Vt]=T.useState([]),[yr,Yt]=T.useState([]),St=T.useRef(""),_r=T.useRef(0),jr=T.useMemo(()=>{const k=Te?.length||0;if(k===_r.current&&St.current&&(Te?.map(B=>B.api_match_id).filter(B=>B!=null).sort().join(",")||"")===St.current)return St.current;if(_r.current=k,!Te||Te.length===0)return St.current="","";const I=Te.map($=>$.api_match_id).filter($=>$!=null).sort().join(",");return St.current=I,I},[Te]),Mt=T.useMemo(()=>a?.name==="API Test",[a?.name]),[it,Cr]=T.useState(null);T.useEffect(()=>{if(!Mt){Cr(null);return}let k=!0;return(async()=>{const{data:I}=await fe.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let $=I?.current_test_gw??1;if($&&$!==1){const{data:B}=await fe.from("app_fixtures").select("gw").eq("gw",$).limit(1).maybeSingle();if(!B){const{data:G}=await fe.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();G&&($=1)}}k&&Cr($)})(),()=>{k=!1}},[Mt]);const _n=T.useMemo(()=>Mt&&it!==null?it:E||L||void 0,[Mt,it,E,L]),Kt=T.useRef({key:"",array:void 0}),jn=T.useMemo(()=>{const k=jr||"";if(Kt.current.key===k)return Kt.current.array;const I=k?k.split(",").map($=>parseInt($,10)).filter($=>!isNaN($)):void 0;return Kt.current={key:k,array:I},I},[jr]),{liveScores:Sr}=Un(_n,jn),Ze=T.useMemo(()=>{const k={};if(!Te||Te.length===0)return Object.keys(W.current).length===0?W.current:(W.current=k,k);Te.forEach(de=>{const pe=de.api_match_id;if(pe){const re=Sr.get(pe);re&&(k[de.fixture_index]={homeScore:re.home_score??0,awayScore:re.away_score??0,status:re.status||"SCHEDULED",minute:re.minute??null})}});const I=W.current,$=Object.keys(k).map(Number),B=Object.keys(I).map(Number);if($.length!==B.length)return W.current=k,k;let G=!1;for(const de of $){const pe=k[de],re=I[de];if(!re||pe.homeScore!==re.homeScore||pe.awayScore!==re.awayScore||pe.status!==re.status||pe.minute!==re.minute){G=!0;break}}return G?(W.current=k,k):I},[Sr,Te]),Cn=()=>{try{if(console.log("[League] getInitialMltRows called",{code:c,userId:r?.id}),c&&r?.id){const I=We(`leagues:${r.id}`);if(console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!I,length:I?.length}),I&&Array.isArray(I)){const $=I.find(B=>B.code.toUpperCase()===c.toUpperCase());if(console.log("[League] getInitialMltRows - found league",{found:!!$,leagueId:$?.id}),$?.id){const B=`league:mltRows:${$.id}`,G=We(B);if(console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!G,length:G?.length,cacheKey:B,cachedType:typeof G,isArray:Array.isArray(G),rawCache:G}),G&&Array.isArray(G)&&G.length>0)return console.log("[League]  getInitialMltRows returning cached rows",G.length),G;console.log("[League]  Cache check failed",{cached:!!G,isArray:Array.isArray(G),length:G?.length,cacheKey:B})}}}const k=n();if(console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!k,leagueId:k?.id}),k?.id){const I=We(`league:mltRows:${k.id}`);if(console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!I,length:I?.length}),I&&Array.isArray(I)&&I.length>0)return console.log("[League]  getInitialMltRows returning cached rows from initialLeague",I.length),I}if(c&&r?.id){const I=We(`leagues:${r.id}`);if(I&&Array.isArray(I)){for(const $ of I)if($.code?.toUpperCase()===c.toUpperCase()&&$.id){const B=We(`league:mltRows:${$.id}`);if(B&&Array.isArray(B)&&B.length>0)return console.log("[League]  getInitialMltRows returning cached rows from strategy 3",B.length),B}}}console.log("[League]  getInitialMltRows returning empty array - cache miss")}catch(k){console.error("[League]  getInitialMltRows error",k)}return[]},[nt,ht]=T.useState(Cn);T.useEffect(()=>{console.log("[League] Tab changed to:",v,"mltRows.length:",nt.length)},[v,nt.length]),T.useEffect(()=>{if(a?.id){const k=`league:mltRows:${a.id}`,I=We(k);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:a.id,cacheKey:k,hasCached:!!I,cachedLength:I?.length,currentMltRowsLength:nt.length}),I&&I.length>0)nt.length===0?(console.log("[League]  Setting mltRows from cache",I.length),ht(I)):console.log("[League] mltRows already populated, skipping");else{console.log("[League]  No cached mltRows found - will retry multiple times");let $=0;const B=10,G=[50,100,150,200,250,300,400,500,600,800],de=()=>{if($>=B){console.log("[League]  Max retries reached, giving up on cache");return}const re=setTimeout(()=>{$++;const Ne=We(k);Ne&&Ne.length>0&&nt.length===0?(console.log(`[League]  Retry ${$} successful - Setting mltRows from cache`,Ne.length),ht(Ne)):$<B&&de()},G[$]||800);return()=>clearTimeout(re)};return de()}}else console.log("[League]  No league.id available yet")},[a?.id,nt.length]),T.useEffect(()=>{let k=!0;return(async()=>{let $=a;if(!$){const{data:re}=await fe.from("leagues").select("id,name,code,created_at,avatar").eq("code",c).maybeSingle();if(!k)return;if(!re){d(null),l([]),g(!1);return}$=re,d($)}const B=We(`league:members:${$.id}`);let G=[];if(B&&B.length>0)G=B.map(([re,Ne])=>({id:re,name:Ne||"(no name)"})),g(!1);else{const{data:re}=await fe.from("league_members").select("users(id,name),created_at").eq("league_id",$.id).order("created_at",{ascending:!0});G=re?.map(Ne=>({id:Ne.users.id,name:Ne.users.name??"(no name)"}))??[],g(!1)}const de=[...G].sort((re,Ne)=>re.name.localeCompare(Ne.name));l(de);const pe=G[0];ln(pe),r?.id&&!G.some(re=>re.id===r.id)&&dt(!0),g(!1)})(),()=>{k=!1}},[c]),T.useEffect(()=>{},[a,v]),T.useEffect(()=>{if(v!=="chat"||!a?.id||!r?.id)return;(async()=>{await fe.from("league_message_reads").upsert({league_id:a.id,user_id:r.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),Jt(r.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:a.id,userId:r.id}}))})()},[v,a?.id,r?.id]),T.useEffect(()=>{let k=!0;return(async()=>{const I=a?.name==="API Test";let $=it??1;if(I){const{data:se}=await fe.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if($=se?.current_test_gw??1,$&&$!==1){const{data:ge}=await fe.from("app_fixtures").select("gw").eq("gw",$).limit(1).maybeSingle();if(!ge){const{data:Ee}=await fe.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Ee&&($=1)}}}const B=I&&(v==="gw"||v==="gwr");let G=null;if(v==="gwr"?y.current&&L?G=L:E?f&&f<E?G=f:G=E>1?E-1:E:G=L:G=E,I&&(v==="gw"||v==="gwr")&&(G=$),v==="gw"&&!I&&mt.length>0){const{data:se}=await fe.from("app_gw_submissions").select("gw").in("user_id",mt).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(se&&se.length>0){const ge=[...new Set(se.map(Ee=>Ee.gw))].sort((Ee,Se)=>(Se||0)-(Ee||0));for(const Ee of ge)if(Ee){const{data:Se}=await fe.from("app_fixtures").select("gw").eq("gw",Ee).limit(1);if(Se&&Se.length>0){G=Ee;break}}}!G&&E&&(G=E)}if(!G&&!B){wr([]),qt([]),Vt([]),Yt([]);return}let de;if(B){const{data:se}=await fe.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",$).order("fixture_index",{ascending:!0});de=se?.map(ge=>({...ge,gw:ge.test_gw}))||null}else{const{data:se}=await fe.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",G).order("fixture_index",{ascending:!0});de=se||null}if(!k)return;if(wr(se=>{const ge=de??[];return se.length!==ge.length?ge:se.length===0&&ge.length===0?se:se.some((Se,X)=>!ge[X]||Se.id!==ge[X].id||Se.fixture_index!==ge[X].fixture_index)||ge.some((Se,X)=>!se[X]||Se.id!==se[X].id||Se.fixture_index!==se[X].fixture_index)?ge:se}),!mt.length){qt([]),Vt([]),Yt([]);return}let pe=null,re;if(B){const{data:se}=await fe.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",$).in("user_id",mt);pe=se?.map(ce=>({...ce,gw:ce.matchday}))||null;const{data:ge,error:Ee}=await fe.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",$).not("submitted_at","is",null).in("user_id",mt),{data:Se}=await fe.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",$).order("fixture_index",{ascending:!0}),X=new Set((Se||[]).map(ce=>ce.fixture_index)),Y=[];if(ge&&pe&&Se){const ce=X.size,me=new Date("2025-11-18T00:00:00Z");ge.forEach(be=>{const Fe=(pe||[]).filter(Je=>Je.user_id===be.user_id&&Je.matchday===$).filter(Je=>X.has(Je.fixture_index)),ue=Fe.length===ce&&ce>0,xe=new Set(Fe.map(Je=>Je.fixture_index)).size===ce,He=be.submitted_at?new Date(be.submitted_at):null,Ce=He&&He>=me;ue&&xe&&Ce&&Y.push(be)})}re=Y.map(ce=>({...ce,gw:ce.matchday}))||null}else{const{data:se}=await fe.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",G).in("user_id",mt);pe=se;const{data:ge}=await fe.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",G).in("user_id",mt);re=ge}if(!k)return;qt(se=>{const ge=pe??[];if(se.length!==ge.length)return ge;if(se.length===0&&ge.length===0)return se;const Ee=JSON.stringify(se.sort((X,Y)=>X.fixture_index-Y.fixture_index)),Se=JSON.stringify(ge.sort((X,Y)=>X.fixture_index-Y.fixture_index));return Ee===Se?se:ge}),Vt(se=>{const ge=re??[];if(se.length!==ge.length)return ge;if(se.length===0&&ge.length===0)return se;const Ee=JSON.stringify(se),Se=JSON.stringify(ge);return Ee===Se?se:ge});const{data:Ne}=await fe.from("app_gw_results").select("gw,fixture_index,result").eq("gw",B?1:G||0);k&&Yt(se=>{const ge=Ne??[];if(se.length!==ge.length)return ge;if(se.length===0&&ge.length===0)return se;const Ee=JSON.stringify(se.sort((X,Y)=>X.fixture_index-Y.fixture_index)),Se=JSON.stringify(ge.sort((X,Y)=>X.fixture_index-Y.fixture_index));return Ee===Se?se:ge})})(),()=>{k=!1}},[v,E,f,L,mt]),T.useEffect(()=>{Z.current=Ze},[Ze]);const pt=T.useMemo(()=>{const k=new Map;return vr.forEach(I=>{if(I.submitted_at){const $=`${I.user_id}:${I.gw}`;k.set($,!0)}}),k},[vr]),Lt=T.useCallback(k=>k.map(I=>({user_id:I.id,name:I.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);T.useEffect(()=>{const k=fe.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{le(I=>I+1)}).subscribe();return()=>{fe.removeChannel(k)}},[]),T.useEffect(()=>{let k=!0;return(async()=>{if(nt.length>0)return;if(a?.id){const ue=We(`league:mltRows:${a.id}`);if(ue&&ue.length>0){ht(ue);return}}if(!i.length){We(`league:mltRows:${a?.id||""}`)||ht([]);return}if(a?.name==="API Test"){ht(Lt(i));return}const I=a?.id&&We(`league:mltRows:${a.id}`);if(I&&I.length>0){ht(I);return}if(E===null)return;const{data:$}=await fe.from("app_gw_results").select("gw,fixture_index,result"),B=$??[],G=new Map;if(B.forEach(ue=>{const we=ir(ue);we&&G.set(`${ue.gw}:${ue.fixture_index}`,we)}),G.size===0){ht(Lt(i));return}const de=[...new Set(Array.from(G.keys()).map(ue=>parseInt(ue.split(":")[0],10)))].sort((ue,we)=>ue-we),pe=["Prem Predictions","FC Football","Easy League"],re=["The Bird league"],Ne=await Pn(a,E);let se=de.filter(ue=>ue>=Ne);if(E!==null&&se.includes(E)){const{data:ue}=await fe.from("app_fixtures").select("fixture_index").eq("gw",E),we=ue?.length??0,xe=Array.from(G.keys()).filter(He=>parseInt(He.split(":")[0],10)===E).length;we>0&&xe<we&&(se=se.filter(He=>He<E))}else E!==null&&(se=se.filter(ue=>ue<E));if(!pe.includes(a?.name||"")&&!re.includes(a?.name||"")&&se.length===0){ht(Lt(i));return}const{data:ge}=await fe.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",i.map(ue=>ue.id)).in("gw",se),Ee=ge??[],Se=new Map;se.forEach(ue=>{const we=new Map;i.forEach(xe=>we.set(xe.id,{user_id:xe.id,score:0,unicorns:0})),Se.set(ue,we)}),se.forEach(ue=>{Array.from(G.entries()).filter(([xe])=>parseInt(xe.split(":")[0],10)===ue).map(([xe,He])=>({idx:parseInt(xe.split(":")[1],10),out:He})).forEach(({idx:xe,out:He})=>{const Ce=Ee.filter($e=>$e.gw===ue&&$e.fixture_index===xe),Je=Ce.filter($e=>$e.pick===He).map($e=>$e.user_id),wt=Se.get(ue);if(Ce.forEach($e=>{if($e.pick===He){const Zt=wt.get($e.user_id);Zt.score+=1}}),Je.length===1&&i.length>=3){const $e=Je[0],Zt=wt.get($e);Zt.unicorns+=1}})});const X=new Map,Y=new Map,ce=new Map,me=new Map,be=new Map,Ae=new Map;i.forEach(ue=>{X.set(ue.id,0),Y.set(ue.id,0),ce.set(ue.id,0),me.set(ue.id,0),be.set(ue.id,0),Ae.set(ue.id,[])}),se.forEach(ue=>{const we=Array.from(Se.get(ue).values());if(we.forEach(Ce=>{Y.set(Ce.user_id,(Y.get(Ce.user_id)??0)+Ce.score),ce.set(Ce.user_id,(ce.get(Ce.user_id)??0)+Ce.unicorns)}),we.sort((Ce,Je)=>Je.score-Ce.score||Je.unicorns-Ce.unicorns),!we.length)return;const xe=we[0],He=we.filter(Ce=>Ce.score===xe.score&&Ce.unicorns===xe.unicorns);He.length===1?(X.set(xe.user_id,(X.get(xe.user_id)??0)+3),me.set(xe.user_id,(me.get(xe.user_id)??0)+1),Ae.get(xe.user_id).push("W"),we.slice(1).forEach(Ce=>Ae.get(Ce.user_id).push("L"))):(He.forEach(Ce=>{X.set(Ce.user_id,(X.get(Ce.user_id)??0)+1),be.set(Ce.user_id,(be.get(Ce.user_id)??0)+1),Ae.get(Ce.user_id).push("D")}),we.filter(Ce=>!He.find(Je=>Je.user_id===Ce.user_id)).forEach(Ce=>Ae.get(Ce.user_id).push("L")))});const Fe=i.map(ue=>({user_id:ue.id,name:ue.name,mltPts:X.get(ue.id)??0,ocp:Y.get(ue.id)??0,unicorns:ce.get(ue.id)??0,wins:me.get(ue.id)??0,draws:be.get(ue.id)??0,form:Ae.get(ue.id)??[]}));Fe.sort((ue,we)=>we.mltPts-ue.mltPts||we.unicorns-ue.unicorns||we.ocp-ue.ocp||ue.name.localeCompare(we.name)),k&&(ht(Fe),a?.id&&In(`league:mltRows:${a.id}`,Fe,Fn.LEAGUES))})(),()=>{k=!1}},[i,a,E,Lt,ae]);function Sn(){const k=performance.now();console.log("[MltTab]  RENDERING START",{mltRowsLength:nt.length,membersLength:i.length,leagueId:a?.id,timestamp:k});const I=performance.now(),$=T.useMemo(()=>E??null,[E]);Tt($);const B=performance.now();console.log("[MltTab]  Hooks complete",{duration:B-I});const G=performance.now(),de=nt.length>0?nt:i.length>0?i.map(Ee=>({user_id:Ee.id,name:Ee.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],pe=performance.now();console.log("[MltTab]  Rows calculated",{rowsLength:de.length,mltRowsLength:nt.length,duration:pe-G});const re=["Prem Predictions","FC Football","Easy League"],Ne=["The Bird league"],se=["gregVjofVcarl","Let Down"],ge=!!(a&&!re.includes(a.name)&&!Ne.includes(a.name)&&!se.includes(a.name));return i.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>gt(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(Ps,{rows:de,members:i,showForm:x,currentUserId:r?.id,loading:!1,isLateStartingLeague:ge}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(Ds,{showForm:x,onToggle:m}),s.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function kn(){const k=T.useMemo(()=>a?.name==="API Test"?it??1:E??null,[a?.name,it,E]),{state:I}=Tt(k);if(!k)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!Mr(a,k,xr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",k," predictions are not included in this league."]})]})});const $=new Map;yr.forEach(Y=>{if(Y.gw!==k)return;const ce=ir(Y);ce&&$.set(Y.fixture_index,ce)}),Te.forEach(Y=>{if(Y.gw!==k)return;const ce=Ze[Y.fixture_index];ce&&(ce.status==="IN_PLAY"||ce.status==="PAUSED"||ce.status==="FINISHED")&&(ce.homeScore>ce.awayScore?$.set(Y.fixture_index,"H"):ce.awayScore>ce.homeScore?$.set(Y.fixture_index,"A"):$.set(Y.fixture_index,"D"))});const B=T.useMemo(()=>{const Y=be=>{if(!be)return"Fixtures";const Ae=new Date(be);return isNaN(Ae.getTime())?"Fixtures":Ae.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},ce=new Map;Te.filter(be=>be.gw===k).forEach(be=>{const Ae=Y(be.kickoff_time),Fe=be.kickoff_time?new Date(be.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;ce.has(Ae)||ce.set(Ae,{label:Ae,key:Fe,items:[]}),ce.get(Ae).items.push(be)});const me=Array.from(ce.values());return me.forEach(be=>be.items.sort((Ae,Fe)=>Ae.fixture_index-Fe.fixture_index)),me.sort((be,Ae)=>be.key-Ae.key),me},[Te,k]),G=new Set(Te.filter(Y=>Y.gw===k).map(Y=>Y.fixture_index)),de=a?.name==="API Test",pe=i.length>0&&i.every(Y=>pt.get(`${Y.id}:${k}`)),re=new Map;(!de||pe)&&br.forEach(Y=>{if(Y.gw!==k||!pt.get(`${Y.user_id}:${k}`)||!G.has(Y.fixture_index))return;const me=re.get(Y.fixture_index)??[];me.push(Y),re.set(Y.fixture_index,me)});const Ne=f!==null&&f>=k,se=i.filter(Y=>!pt.get(`${Y.id}:${k}`)).length,ge=i.filter(Y=>!pt.get(`${Y.id}:${k}`)).map(Y=>Y.name),Ee=I!==null&&(I==="DEADLINE_PASSED"||I==="LIVE"||I==="RESULTS_PRE_GW"),Se=de?!pe:!pe&&!Ee;return(de?!pe:!pe&&!Ee)?s.jsx(Gr,{members:i,submittedMap:pt,picksGw:k,allSubmitted:pe,remaining:se,fixtures:Te.filter(Y=>Y.gw===k),variant:"compact"}):s.jsxs("div",{className:"mt-2 pt-2",children:[Se?s.jsx(Gr,{members:i,submittedMap:pt,picksGw:k,allSubmitted:pe,remaining:se,fixtures:Te.filter(Y=>Y.gw===k),variant:"full"}):null,a?.name==="API Test"&&pe&&B.length>0&&!Se&&(()=>{const Y=B.flatMap(we=>we.items),ce=new Set(Y.map(we=>we.fixture_index)),me={};Object.keys(Ze).forEach(we=>{const xe=parseInt(we,10);ce.has(xe)&&(me[xe]=Ze[xe])});const be=Y.some(we=>{const xe=me[we.fixture_index];return xe&&(xe.status==="IN_PLAY"||xe.status==="PAUSED")}),Ae=Y.length>0&&Y.every(we=>{const xe=me[we.fixture_index];return xe&&xe.status==="FINISHED"}),Fe=be||Ae||Y.some(we=>me[we.fixture_index]);let ue=0;return r?.id&&Y.forEach(we=>{const xe=me[we.fixture_index],He=xe&&(xe.status==="IN_PLAY"||xe.status==="PAUSED"),Ce=xe&&xe.status==="FINISHED";if(xe&&(He||Ce)){const wt=(re.get(we.fixture_index)??[]).find($e=>$e.user_id===r.id);if(wt){let $e=!1;(wt.pick==="H"&&xe.homeScore>xe.awayScore||wt.pick==="A"&&xe.awayScore>xe.homeScore||wt.pick==="D"&&xe.homeScore===xe.awayScore)&&($e=!0),$e&&ue++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:B.map((we,xe)=>s.jsx(Vr,{label:we.label,fixtures:we.items,picksByFixture:re,members:i,outcomes:$,liveScores:me,submittedMap:pt,picksGw:k,isApiTestLeague:!0,isFirstSection:xe===0,hasLiveGames:be,allGamesFinished:Ae,hasStarted:Fe,liveFixturesCount:ue},xe))})})(),B.length>0&&a?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:B.map((Y,ce)=>s.jsx(Vr,{label:Y.label,fixtures:Y.items,picksByFixture:re,members:i,outcomes:$,liveScores:Ze,submittedMap:pt,picksGw:k,isApiTestLeague:!1,isFirstSection:ce===0,allSubmitted:pe,resultsPublished:Ne,deadlinePassed:Ee,whoDidntSubmit:ge},ce))}),!B.length&&!Se&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",k,"."]})]})}function Nn(){const{state:k}=Tt(E),I=T.useMemo(()=>a?.name==="API Test"?it??1:v==="gwr"?y.current&&L||!E?L:k==="LIVE"||k==="RESULTS_PRE_GW"?E:f&&f<E?f:E>1?E-1:E:L,[a?.name,it,v,L,E,k,f]);Tt(I);const $=I;if(!$||K.length===0&&a?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!Mr(a,$,xr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",$," results are not included in this league."]})]})});const B=new Map,G=a?.name==="API Test",de=Te.filter(X=>X.gw===$),pe=de.some(X=>{const Y=Ze[X.fixture_index];return Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")});G&&$===(it??1)?de.forEach(X=>{const Y=Ze[X.fixture_index];Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")&&(Y.homeScore>Y.awayScore?B.set(X.fixture_index,"H"):Y.awayScore>Y.homeScore?B.set(X.fixture_index,"A"):B.set(X.fixture_index,"D"))}):pe&&$===E?de.forEach(X=>{const Y=Ze[X.fixture_index];Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")&&(Y.homeScore>Y.awayScore?B.set(X.fixture_index,"H"):Y.awayScore>Y.homeScore?B.set(X.fixture_index,"A"):B.set(X.fixture_index,"D"))}):yr.forEach(X=>{if(X.gw!==$)return;const Y=ir(X);Y&&B.set(X.fixture_index,Y)});const re=i.map(X=>({user_id:X.id,name:X.name,score:0,unicorns:0})),Ne=new Map;br.forEach(X=>{if(X.gw!==$)return;const Y=Ne.get(X.fixture_index)??[];Y.push(X),Ne.set(X.fixture_index,Y)}),Array.from(B.entries()).forEach(([X,Y])=>{const me=(Ne.get(X)??[]).filter(be=>be.pick===Y).map(be=>be.user_id);if(me.forEach(be=>{const Ae=re.find(Fe=>Fe.user_id===be);Ae.score+=1}),me.length===1&&i.length>=3){const be=re.find(Ae=>Ae.user_id===me[0]);be.unicorns+=1}}),re.sort((X,Y)=>Y.score-X.score||Y.unicorns-X.unicorns||X.name.localeCompare(Y.name)),T.useEffect(()=>{if(re.length===0)return;const X=new Map;re.forEach((ce,me)=>{X.set(ce.user_id,me)});const Y=new Set;if(X.forEach((ce,me)=>{const be=he.current.get(me);be!==void 0&&be!==ce&&Y.add(me)}),he.current=X,Y.size>0){V(Y);const ce=setTimeout(()=>{V(new Set)},2e3);return()=>clearTimeout(ce)}},[re.map(X=>`${X.user_id}-${X.score}-${X.unicorns}`).join(",")]);let se=!1,ge=!1,Ee=!1,Se=!1;if(G&&$===(it??1)){const X=Te;if(X.length>0&&(se=X.every(ce=>{const me=Ze[ce.fixture_index];return me&&me.status==="FINISHED"}),ge=!!X.find(ce=>{const me=Ze[ce.fixture_index];return me&&(me.status==="IN_PLAY"||me.status==="PAUSED")}),Se=X.some(ce=>{const me=Ze[ce.fixture_index];return me&&(me.status==="IN_PLAY"||me.status==="PAUSED"||me.status==="FINISHED")}),!se)){const ce=new Date;Ee=X.some(me=>{if(!me.kickoff_time)return!1;const Ae=new Date(me.kickoff_time).getTime()-ce.getTime(),Fe=Ze[me.fixture_index];return(!Fe||Fe.status!=="IN_PLAY"&&Fe.status!=="PAUSED"&&Fe.status!=="FINISHED")&&Ae>0&&Ae<=1440*60*1e3})}}else{const X=Te.filter(Y=>Y.gw===$);if(X.length>0){const Y=X.every(me=>B.has(me.fixture_index)),ce=X.some(me=>{const be=Ze[me.fixture_index];return be&&(be.status==="IN_PLAY"||be.status==="PAUSED")});se=Y&&!ce}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),re.length>0&&se&&s.jsx(Ls,{winnerName:re[0].name,isDraw:re[0].score===re[1]?.score&&re[0].unicorns===re[1]?.unicorns}),s.jsx(Is,{rows:re,members:i,currentUserId:r?.id,positionChangeKeys:O,isApiTestLeague:G,hasLiveFixtures:ge,hasStartingSoonFixtures:Ee,hasStartedFixtures:Se,allFixturesFinished:se,resGw:$}),K.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(Ts,{availableGws:K,selectedGw:$,onChange:X=>{y.current=!0,q(X)}}),s.jsxs("button",{onClick:()=>je(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(Rr,{isOpen:_e,onClose:()=>je(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return T.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[v]),h?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!a&&!h?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(Er,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):a?s.jsxs("div",{className:`${e?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:F,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(Er,{to:"/leagues",className:"flex items-center text-slate-600 -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{b(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative cursor-pointer",children:a?s.jsx("img",{src:Qt(a),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:k=>{const I=k.target,B=`/assets/league-avatars/${Ar(a.id)}`;I.src!==B&&(I.src=B)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:a.name}),L&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",L]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>rt(!tt),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${tt?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[mr&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:cn})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{H(!0),rt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[ft&&s.jsxs("button",{onClick:()=>{Re(!0),rt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{gt(!0),rt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{pr(),rt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{j(!0),rt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 active:bg-red-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${tt?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{P.current=!0,C("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),v==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(K.length>0||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{P.current=!0,C("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(v==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const k=new Date,I=Te[0],$=I?.kickoff_time?new Date(I.kickoff_time):null,B=$&&$<=k,de=Te[Te.length-1]?.fixture_index,re=(de!==void 0?Ze[de]:null)?.status==="FINISHED",Ne=B&&!re;return s.jsxs(s.Fragment,{children:[Ne&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),v==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(E||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{P.current=!0,C("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),v==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{console.log("[League] GW Table tab clicked, setting tab to mlt"),P.current=!0,C("mlt"),console.log("[League] Tab set to mlt, mltRows.length:",nt.length)},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",v==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),v==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(Ms,{miniLeagueId:a?.id??null,memberNames:dn,deepLinkError:U})}):s.jsx("div",{className:`league-content-wrapper ${tt?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[v==="mlt"&&(()=>{const k=performance.now();console.log("[League] Rendering MltTab, tab is mlt",{tab:v,mltRowsLength:nt.length,leagueId:a?.id,timestamp:k});const I=s.jsx(Sn,{}),$=performance.now();return console.log("[League] MltTab JSX created",{duration:$-k}),I})(),v==="gw"&&s.jsx(kn,{}),v==="gwr"&&s.jsx(Nn,{})]})}),mr&&Q&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>H(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("button",{onClick:()=>H(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[i.filter(k=>k.id!==r?.id).map(k=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:k.name}),s.jsx("button",{onClick:()=>{ur(k),vt(!0),H(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-medium",children:"Remove"})]},k.id)),i.filter(k=>k.id!==r?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{at(!0),H(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),ft&&Le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Re(!1),ze&&URL.revokeObjectURL(ze),Me(null),ve(null),Pe(!1),ct(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("button",{onClick:()=>{Re(!1),ze&&URL.revokeObjectURL(ze),Me(null),ve(null),Pe(!1),ct(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Ke?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(ms,{image:Ke,crop:Ve,zoom:Ie,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Ue,onZoomChange:Ye,onCropComplete:xn,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(Ie*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:Ie,onChange:k=>Ye(Number(k.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:ze?s.jsx("img",{src:ze,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),ye&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ye}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{ze&&URL.revokeObjectURL(ze),Me(null),Ue({x:0,y:0}),Ye(1),et(null),ct(null)},disabled:ke,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:wn,disabled:ke||!Qe,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:ke?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:a?Qt(a):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:k=>{const I=k.target;I.src="/assets/league-avatars/ML-avatar-1.png"}})}),a?.avatar&&s.jsx("button",{onClick:bn,disabled:ke,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:k=>{const I=k.target.files?.[0];I&&gn(I)},disabled:ke,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),ke&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),qe&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),ye&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ye})]})]})]})]})}),s.jsx(Rr,{isOpen:ne,onClose:()=>ie(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${a&&(["The Bird league"].includes(a.name)||["gregVjofVcarl","Let Down"].includes(a.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),Ht&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",or," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:a.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a.code)},className:"px-3 py-1.5 border rounded-md text-sm",children:"Copy"}),s.jsx("button",{onClick:pr,className:"px-3 py-1.5 border rounded-md text-sm",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[i.length,"/",or," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>gt(!1),className:"px-4 py-2 border border-slate-300 rounded-md",children:"Close"})})]})}),_&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',a?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>j(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:A,children:"Cancel"}),s.jsx("button",{onClick:un,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:A,children:A?"Leaving...":"Leave League"})]})]})}),At&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',a?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>dt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:jt,children:"Cancel"}),s.jsx("button",{onClick:fn,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:jt,children:jt?"Joining...":"Join League"})]})]})}),xt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',Rt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>vt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Bt,children:"Cancel"}),s.jsx("button",{onClick:hn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Bt,children:Bt?"Removing...":"Remove Member"})]})]})}),ut&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',a?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>at(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Gt,children:"Cancel"}),s.jsx("button",{onClick:mn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Gt,children:Gt?"Ending...":"Yes, End League"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),w&&a&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>b(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:Qt(a),alt:"League badge",className:"w-full h-full object-cover",onError:k=>{const I=k.target,B=`/assets/league-avatars/${Ar(a.id)}`;I.src!==B&&(I.src=B)}})}),ft&&s.jsx("button",{type:"button",onClick:k=>{k.stopPropagation(),b(!1),Re(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:a.name})]})})]}):null}export{Gs as default};
