import{u as k,r as o,s as b,j as e,L as G,P as S}from"./index-DB0hCmCE.js";import{N as u}from"./NotificationSection-DLlCopCf.js";function P(){const{user:r}=k(),[N,j]=o.useState(!0),[v,h]=o.useState(!1),[p,l]=o.useState([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:!0}]),[g,d]=o.useState([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:!0},{id:"score-updates",label:"Score Updates",description:"Get notified when match scores are updated",enabled:!0},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:!0},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:!0}]),[w]=o.useState([{id:"system-updates",label:"System Updates",description:"Important updates and announcements",enabled:!0,disabled:!0}]);o.useEffect(()=>{r&&y()},[r]);async function y(){if(r)try{const{data:s,error:i}=await b.from("user_notification_preferences").select("*").eq("user_id",r.id).maybeSingle();if(i&&i.code!=="PGRST116"&&console.error("Error loading preferences:",i),s){const n=s.preferences||{};l([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:n["chat-messages"]!==!1}]),d([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:n["new-gameweek"]!==!1},{id:"score-updates",label:"Score Updates",description:"Get notified when match scores are updated",enabled:n["score-updates"]!==!1},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:n["final-whistle"]!==!1},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:n["gw-results"]!==!1}])}}catch(s){console.error("Error loading notification preferences:",s)}finally{j(!1)}}async function c(s,i,n){if(r){h(!0);try{s==="chat"?l(a=>a.map(t=>t.id===i?{...t,enabled:n}:t)):s==="game"&&d(a=>a.map(t=>t.id===i?{...t,enabled:n}:t));const f=[...p,...g,...w],m={};f.forEach(a=>{a.id===i?m[a.id]=n:m[a.id]=a.enabled});const{error:x}=await b.from("user_notification_preferences").upsert({user_id:r.id,preferences:m,updated_at:new Date().toISOString()},{onConflict:"user_id"});x&&(console.error("Error saving preferences:",x),s==="chat"?l(a=>a.map(t=>t.id===i?{...t,enabled:!n}:t)):s==="game"&&d(a=>a.map(t=>t.id===i?{...t,enabled:!n}:t)))}catch(f){console.error("Error toggling notification:",f)}finally{h(!1)}}}return r?N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Loading notification preferences..."})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(G,{to:"/profile",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 mb-4 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:"Back to Profile"})]}),e.jsx(S,{title:"Notification Centre",as:"h1",className:"mb-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{title:"Chat Notifications",description:"Control when you receive notifications for mini-league messages",options:p,onToggle:(s,i)=>c("chat",s,i)}),e.jsx(u,{title:"Game Notifications",description:"Stay updated on match results and scores",options:g,onToggle:(s,i)=>c("game",s,i)}),e.jsx(u,{title:"System Notifications",description:"Important updates and announcements",options:w,onToggle:(s,i)=>c("system",s,i)})]}),v&&e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Saving preferences..."})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Please sign in to view your notification preferences."})})})})}export{P as default};
