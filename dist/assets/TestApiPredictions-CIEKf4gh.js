import{j as e,u as ft,m as xt,a as g,c as ht,s as A,k as De,l as pt,C as gt,D as bt,h as $,n as yt,o as wt}from"./index--6UN4cWN.js";import{T as ve}from"./TeamBadge-CsbY6ckb.js";function vt(n,y,d=!1){if(n==="FINISHED")return"FT";if(n==="PAUSED")return"HT";if(n==="IN_PLAY"){if(y==null)return"LIVE";if(d)return`${y}'`;if(y>=1&&y<=45)return"First Half";if(y>45&&y<=50)return"45+";if(y>50)return"Second Half"}return"LIVE"}function Ke({fixture:n,homeColor:y="#EF0107",awayColor:d="#034694",showSwipeHint:J=!0}){const N=n.kickoff_time?new Date(n.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):null,k=n.kickoff_time?new Date(n.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):null;return e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none flex flex-col",style:{pointerEvents:"none",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",width:"100%",height:"100%"},children:[e.jsxs("div",{className:"pt-2 px-8 pb-8 relative flex-shrink-0 pointer-events-none",style:{pointerEvents:"none"},children:[J&&e.jsx("div",{className:"absolute top-2 right-4 flex items-center gap-2 text-slate-400 text-xs font-semibold pointer-events-none",style:{pointerEvents:"none"},children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/4603/4603384.png",alt:"Swipe gesture icon",className:"w-6 h-6 opacity-80 pointer-events-none",style:{pointerEvents:"none"}})}),(N||k)&&e.jsx("div",{className:"text-center mb-6 pointer-events-none",style:{pointerEvents:"none"},children:e.jsxs("div",{className:"text-sm text-slate-500 font-medium pointer-events-none",style:{pointerEvents:"none"},children:[N,N&&k&&e.jsx("span",{className:"mx-2 pointer-events-none",style:{pointerEvents:"none"},children:"â€¢"}),k&&e.jsx("span",{className:"text-slate-700 pointer-events-none",style:{pointerEvents:"none"},children:k})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-10 mb-4 relative pointer-events-none mt-6",style:{pointerEvents:"none"},children:[e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"pointer-events-none",style:{pointerEvents:"none"},children:e.jsx(ve,{code:n.home_code,crest:n.home_crest,size:120})}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px] pointer-events-none",style:{pointerEvents:"none"},children:n.home_team||n.home_name})]}),e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"pointer-events-none",style:{pointerEvents:"none"},children:e.jsx(ve,{code:n.away_code,crest:n.away_crest,size:120})}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px] pointer-events-none",style:{pointerEvents:"none"},children:n.away_team||n.away_name})]})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden pointer-events-none min-h-[192px]",style:{pointerEvents:"none"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:y,clipPath:"polygon(0 0, 0 100%, 100% 100%)",pointerEvents:"none"}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:d,clipPath:"polygon(0 0, 100% 0, 100% 100%)",pointerEvents:"none"}})]})]})}function jt({score:n,total:y,topPercent:d}){const J=y>0?n/y*100:0;return e.jsx("div",{className:"mb-4 rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[n,"/",y]}),d!=null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",d,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${J}%`}})})]})})}function kt({success:n,message:y,onClose:d}){return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[n?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${n?"text-emerald-700":"text-amber-600"}`,children:n?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:y}),d&&e.jsx("button",{onClick:d,className:"mt-4 px-6 py-2 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#1C8376]/90 transition-colors",children:"Close"})]})]})})}function _t(n){let y=0;for(let k=0;k<n.length;k++)y=n.charCodeAt(k)+((y<<5)-y);const d=Math.abs(y%360),J=60+Math.abs(y)%20,N=45+Math.abs(y)%15;return`hsl(${d}, ${J}%, ${N}%)`}function we(n,y){return n&&Xe[n]?Xe[n].primary:_t(n||y||"default")}const Xe={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function At(){const{user:n}=ft(),y=xt(),[d,J]=g.useState(null),[N,k]=g.useState(0),K=(()=>{if(typeof window>"u"||!n?.id)return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1};try{const s=De("app_meta")?.current_gw||14,i=`predictions:${n.id}:${s}`,r=De(i);if(r&&r.fixtures&&Array.isArray(r.fixtures)&&r.fixtures.length>0){const u=new Map;r.picks&&Array.isArray(r.picks)&&r.picks.forEach(j=>{u.set(j.fixture_index,j)});const a=new Map;return r.results&&Array.isArray(r.results)&&r.results.forEach(j=>{a.set(j.fixture_index,j.result)}),{fixtures:r.fixtures,picks:u,submitted:r.submitted||!1,results:a,loading:!1,picksChecked:!0,submissionChecked:!0}}}catch{}return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1}})(),[f,fe]=g.useState(K.fixtures),[C,q]=g.useState(K.picks),[U,je]=g.useState(K.results),Je=()=>{if(typeof window>"u")return"cards";try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true"){if(n?.id&&s.endsWith(`_${n.id}`))return console.log('[TestApiPredictions] ðŸš« Initial viewMode set to "list" - found submission in sessionStorage for user'),"list";if(!n?.id)return console.log('[TestApiPredictions] ðŸš« Initial viewMode set to "list" - found submission in sessionStorage (user ID not available yet)'),"list"}}}catch{}return"cards"},[O,Y]=g.useState(()=>{const t=Je();return K.submitted?"list":t}),[F,xe]=g.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[le,Le]=g.useState(!1),[X,Ie]=g.useState(!1),[ke,ne]=g.useState(null),[Qe,Ze]=g.useState(!1),[_e,Q]=g.useState(null),[ce,Z]=g.useState(K.loading),[Ne,he]=g.useState(K.picksChecked),[ee,oe]=g.useState(K.submissionChecked),te=()=>{if(typeof window>"u"||!d||!n?.id)return!1;const t=`test_api_submitted_${d}_${n.id}`;return sessionStorage.getItem(t)==="true"},se=t=>{if(typeof window>"u"||!d||!n?.id)return;const s=`test_api_submitted_${d}_${n?.id}`;t?sessionStorage.setItem(s,"true"):sessionStorage.removeItem(s)},D=g.useRef(te()),[x,R]=g.useState(()=>{if(K.submitted)return D.current=!0,!0;if(typeof window>"u"||!n?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${n.id}`)&&sessionStorage.getItem(s)==="true")return D.current=!0,!0}}catch{}return!1});g.useEffect(()=>{if(d&&n?.id&&typeof window<"u")try{const t=`test_api_submitted_${d}_${n.id}`;sessionStorage.getItem(t)==="true"&&(console.log('[TestApiPredictions] ðŸš« Setting viewMode to "list" immediately - user has submitted (from sessionStorage)'),Y("list"),R(!0),D.current=!0)}catch{}},[d,n?.id]),g.useEffect(()=>{x&&O==="cards"&&(console.log('[TestApiPredictions] âœ… FORCING viewMode to "list" - user has submitted'),Y("list"))},[x,O]),g.useEffect(()=>{!ce&&!x&&f.length>0&&N===0&&Y("cards")},[ce,x,f.length,N]);const[et,pe]=g.useState(null),[tt,st]=g.useState(!1),[ge,rt]=g.useState([]),[$e,it]=g.useState(new Set),[Be,nt]=g.useState(null),[We,ot]=g.useState([]),{liveScores:Se}=ht(d||void 0,We.length>0?We:void 0),ae=g.useMemo(()=>{const t={};return f.forEach(s=>{if(s.api_match_id&&Se.has(s.api_match_id)){const i=Se.get(s.api_match_id);t[s.fixture_index]={homeScore:i.home_score??0,awayScore:i.away_score??0,status:i.status||"SCHEDULED",minute:i.minute,goals:i.goals||null,red_cards:i.red_cards||null,home_team:i.home_team||null,away_team:i.away_team||null}}}),t},[Se,f]),at=()=>{if(typeof window>"u")return!0;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true")return!1}}catch{}return!0},Ce=g.useRef(at());g.useEffect(()=>{const t=te();(x||t&&D.current)&&(Ce.current=!1)},[x]),g.useEffect(()=>{const t=document.documentElement,s=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const r=setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(r),t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),g.useEffect(()=>{const t=N>=f.length,s=O==="cards"&&!t&&f.length>0&&!x,i=document.documentElement,r=document.body,u=document.getElementById("root"),a=()=>{i.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),u&&u.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),u&&u.style.removeProperty("overflow")};if(!s){a();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),r.style.setProperty("overflow","hidden","important"),r.style.setProperty("position","fixed","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("height","100%","important"),r.style.setProperty("top","0","important"),u&&u.style.setProperty("overflow","hidden","important");const j=l=>{l.preventDefault()},c=l=>{l.target.closest('[style*="aspectRatio"]')||l.preventDefault()};return window.addEventListener("wheel",j,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),()=>{a(),window.removeEventListener("wheel",j),document.removeEventListener("touchmove",c)}},[O,N,f.length,x]);const de=g.useMemo(()=>f.length===0?!1:f.every(t=>C.has(t.fixture_index)),[f,C]),lt=g.useRef(null),Ee=g.useRef({x:0,y:0}),Pe=g.useRef(!1);g.useEffect(()=>{let t=!0;return(async()=>{try{let s=null;const{data:i}=await A.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(s=i?.current_gw??14,!s){t&&(fe([]),Z(!1));return}J(s);const r=`predictions:${n?.id}:${s}`;let u=!1;try{const o=De(r);if(o&&o.fixtures&&Array.isArray(o.fixtures)&&o.fixtures.length>0){if(fe(o.fixtures),Z(!1),o.picks&&Array.isArray(o.picks)){const w=new Map;o.picks.forEach(_=>{w.set(_.fixture_index,_)}),q(w)}if(o.submitted!==void 0&&(R(o.submitted),D.current=o.submitted,se(o.submitted),oe(!0)),o.results&&Array.isArray(o.results)){const w=new Map;o.results.forEach(_=>{w.set(_.fixture_index,_.result)}),je(w)}he(!0),u=!0}}catch{}u||(f.length===0&&Z(!0),he(!1),oe(!1));const{data:a,error:j}=await A.from("app_fixtures").select("*").eq("gw",s).order("fixture_index",{ascending:!0});if(j)throw new Error(`Failed to load test fixtures: ${j.message}`);if(!a||a.length===0){t&&(fe([]),Z(!1));return}const c=a.map(o=>({id:o.id||String(o.api_match_id||o.fixture_index),gw:s,fixture_index:o.fixture_index,home_team:o.home_team,away_team:o.away_team,home_code:o.home_code,away_code:o.away_code,home_name:o.home_name,away_name:o.away_name,home_crest:null,away_crest:null,kickoff_time:o.kickoff_time,api_match_id:o.api_match_id||null}));t&&(fe(c),Z(!1),je(new Map));const l=c.map(o=>o.api_match_id).filter(o=>o!=null);t&&l.length>0&&ot(l);let L=!1;if(n?.id&&c.length>0){const{data:o}=await A.from("app_gw_submissions").select("submitted_at").eq("gw",s).eq("user_id",n.id).maybeSingle();if(t&&o?.submitted_at)L=!0,R(!0),Y("list"),D.current=!0,se(!0),oe(!0);else{R(!1);const w=te();w&&o?.submitted_at?(R(!0),Y("list"),L=!0,D.current=!0):(w&&!o?.submitted_at&&se(!1),D.current=!1),oe(!0)}}else t&&(R(!1),oe(!0));let G=!1;if(n?.id&&c.length>0&&!L){const{data:o,error:w}=await A.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",n.id);if(!w&&o&&o.length>0){const _=new Set(c.map(M=>M.fixture_index)),S=o.filter(M=>_.has(M.fixture_index)),E=c.every(M=>S.some(H=>H.fixture_index===M.fixture_index)),T=S.length===c.length;if(E&&T&&S.length>0){const M=new Map;S.forEach(H=>{M.set(H.fixture_index,{fixture_index:H.fixture_index,pick:H.pick,matchday:H.gw||s})}),t&&(q(M),G=!0)}else t&&o.length>0&&(console.log("[TestApiPredictions] Picks found but don't match current fixtures - clearing old picks"),await A.from("app_picks").delete().eq("gw",s).eq("user_id",n.id),q(new Map),G=!1)}}else if(L&&n?.id&&c.length>0){const{data:o,error:w}=await A.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",n.id);if(!w&&o&&o.length>0){const _=new Set(c.map(E=>E.fixture_index)),S=o.filter(E=>_.has(E.fixture_index));if(S.length===c.length){const E=new Map;S.forEach(T=>{E.set(T.fixture_index,{fixture_index:T.fixture_index,pick:T.pick,matchday:T.gw||s})}),t&&(q(E),G=!0)}}t&&!G&&(R(!1),await A.from("app_gw_submissions").delete().eq("gw",s).eq("user_id",n.id))}if(t&&c.length>0&&n?.id){const{data:o}=await A.from("leagues").select("id").eq("name","API Test").maybeSingle();if(o){t&&nt(o.id);const{data:w}=await A.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",o.id);if(w){const _=w.map(I=>({id:I.user_id,name:I.profiles?.name||"Unknown"}));t&&rt(_);const S=_.map(I=>I.id),{data:E}=await A.from("app_gw_submissions").select("user_id, submitted_at").eq("gw",s).in("user_id",S).not("submitted_at","is",null),{data:T}=await A.from("app_picks").select("user_id, fixture_index").eq("gw",s).in("user_id",S),me=new Set(c.map(I=>I.fixture_index)),M=me.size,H=new Date("2025-11-18T00:00:00Z"),ie=new Set;E&&T&&M>0&&E.forEach(I=>{const B=(T??[]).filter(P=>P.user_id===I.user_id).filter(P=>me.has(P.fixture_index)),b=B.length===M,m=new Set(B.map(P=>P.fixture_index)).size===M,h=I.submitted_at?new Date(I.submitted_at):null,p=h&&h>=H;b&&m&&p&&ie.add(I.user_id)});const ue=S.length>0&&ie.size===S.length;t&&(st(ue),it(ie))}}}if(t&&(he(!0),ee||oe(!0)),t&&c.length>0&&(G&&!L?k(c.length):L&&G||(k(0),Y("cards"))),t&&c.length>0&&n?.id&&s)try{const o=[];C.forEach((_,S)=>{o.push({fixture_index:S,pick:_.pick,matchday:_.matchday})});const w=[];U.forEach((_,S)=>{w.push({fixture_index:S,result:_})}),pt(r,{fixtures:c,picks:o,submitted:L,results:w},gt.PREDICTIONS)}catch(o){console.warn("[TestApiPredictions] Failed to cache data:",o)}}catch(s){console.error("Error loading test API data:",s),t&&he(!0)}finally{t&&Z(!1)}})(),()=>{t=!1}},[n?.id]),g.useEffect(()=>{const t=new Map;f.forEach(i=>{const r=ae[i.fixture_index];r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")&&(r.homeScore>r.awayScore?t.set(i.fixture_index,"H"):r.awayScore>r.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),je(t)},[ae,f]),g.useEffect(()=>{if(!d||!n?.id||U.size===0||f.length===0){pe(null);return}let t=0;if(f.forEach(s=>{const i=U.get(s.fixture_index),r=C.get(s.fixture_index);i&&r&&i===r.pick&&t++}),t===0){pe(null);return}(async()=>{try{const{data:s}=await A.from("app_picks").select("user_id, fixture_index, pick").eq("gw",d);if(s){const i=new Map;s.forEach(c=>{const l=U.get(c.fixture_index),L=i.get(c.user_id)||0;l&&l===c.pick?i.set(c.user_id,L+1):i.set(c.user_id,L)});const r=Array.from(i.values()).sort((c,l)=>l-c),u=r.filter(c=>c>=t).length,a=r.length,j=a>0?Math.round(u/a*100):null;pe(j)}}catch(s){console.error("[TestApiPredictions] Error calculating top percent:",s),pe(null)}})()},[U,C,f,d,n?.id]);const V=f[N],be=g.useMemo(()=>{let t=0;return f.forEach(s=>{const i=U.get(s.fixture_index),r=C.get(s.fixture_index);i&&r&&r.pick===i&&(t+=1)}),t},[f,U,C]),He=(t,s)=>{X||x||(Le(!0),Ee.current={x:t,y:s},ne(null))},Re=(t,s)=>{if(!le||X||x)return;const i=t-Ee.current.x,r=s-Ee.current.y,u=i*.1;xe({x:i,y:r,rotation:u,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(r)?ne(i>0?"away":"home"):r>50&&r>Math.abs(i)?ne("draw"):ne(null)},Ae=()=>{if(!le||X||x)return;Le(!1);const{x:t,y:s}=F,i=100;let r=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(s)?r=t>0?"A":"H":s>i&&s>Math.abs(t)&&(r="D"),r?qe(r):(xe({x:0,y:0,rotation:0,opacity:1,scale:1}),ne(null))},ct=t=>{t.touches.length===1&&He(t.touches[0].clientX,t.touches[0].clientY)},dt=t=>{t.touches.length===1&&le&&(t.preventDefault(),Re(t.touches[0].clientX,t.touches[0].clientY))},ze=t=>{t.touches.length>0||(t.preventDefault(),Ae())},qe=async t=>{Ie(!0),ne(null);const s=t==="H"?-1:t==="A"?1:0,i=s*window.innerWidth,r=t==="D"?window.innerHeight:0;xe({x:i,y:r,rotation:s*30,opacity:0,scale:.8}),await ye(t),setTimeout(()=>{Pe.current=!0,Qe?(k(f.length),Ze(!1)):k(N+1),xe({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{Pe.current=!1,Ie(!1)})},300)},Te=t=>{!X&&!x&&qe(t)},ye=t=>{if(!V||!d)return;const s=new Map(C);s.set(V.fixture_index,{fixture_index:V.fixture_index,pick:t,matchday:d}),q(s)},mt=async()=>{if(!(!n?.id||!d))try{const{error:t}=await A.from("app_gw_submissions").delete().eq("user_id",n.id).eq("gw",d);t?console.error("[TestApiPredictions] Error deleting test_api_submission:",t):console.log("[TestApiPredictions] âœ… Successfully deleted submission on Start Over");const{error:s}=await A.from("app_picks").delete().eq("user_id",n.id).eq("gw",d);s?console.error("[TestApiPredictions] âŒ Error deleting test_api_picks:",s):console.log("[TestApiPredictions] âœ… Successfully deleted picks on Start Over"),q(new Map),k(0),R(!1),Y("cards"),D.current=!1,se(!1),Z(!1),n?.id&&d&&yt(`predictions:${n.id}:${d}`),console.log("[TestApiPredictions] âœ… All picks and submissions cleared - reset to swipe mode")}catch(t){console.error("[TestApiPredictions] âŒ Error resetting picks:",t),q(new Map),k(0),R(!1),Y("cards"),D.current=!1,se(!1)}},Me=async()=>{if(!de){Q({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>Q(null),2200);return}if(!(!n?.id||!d))try{const{data:t}=await A.from("app_gw_submissions").select("submitted_at").eq("user_id",n.id).eq("gw",d).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen if Start Over worked"),R(!0);return}const s=Array.from(C.values()).filter(u=>u.matchday===d).map(u=>({user_id:n.id,gw:d,fixture_index:u.fixture_index,pick:u.pick}));if(s.length!==f.length)throw new Error(`Expected ${f.length} picks but got ${s.length}`);const{error:i}=await A.from("app_picks").upsert(s,{onConflict:"user_id,gw,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:r}=await A.from("app_gw_submissions").upsert({user_id:n.id,gw:d,submitted_at:new Date().toISOString()},{onConflict:"user_id,gw"});if(r)throw console.error("[TestApiPredictions] Error saving submission:",r),r;console.log("[TestApiPredictions] Successfully confirmed test picks and submission"),R(!0),D.current=!0,se(!0),n?.id&&wt(n.id),Q({success:!0,message:"Your test predictions are locked in. Good luck!"}),setTimeout(()=>{Q(null)},2500),Be&&d&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:Be,matchday:d,isTestApi:!0})}).catch(u=>{console.error("[TestApiPredictions] Failed to check final submission:",u)})}catch(t){console.error("Error confirming test picks:",t),Q({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>Q(null),2200)}},ut={loading:ce,currentTestGw:!!d,picksChecked:Ne,submissionChecked:ee,submitted:x,sessionStorageSubmitted:te()};if(console.log("[TestApiPredictions] Render check - loading state:",ut),ce||f.length===0||!ee||!Ne)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(ce&&f.length===0)return e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>y("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"âœ•"}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:d?`Game Week ${d}`:"Loading..."})]})})}),e.jsx("div",{className:"flex items-center justify-center flex-1",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1C8376]"})})]});if((!Ne||!ee)&&f.length>0)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(f.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>y("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const Ge=te(),Ue=x||!ee&&Ge;if(console.log("[TestApiPredictions] Checking if submitted - state:",x,"sessionStorage:",Ge,"submissionChecked:",ee,"isUserSubmitted:",Ue),Ue){if(console.log("[TestApiPredictions] âœ… Showing submitted view"),!tt&&ge.length>0){const t=ge.filter(s=>!$e.has(s.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>y("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",d]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:t})," of ",ge.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:ge.slice().sort((s,i)=>s.name.localeCompare(i.name)).map(s=>{const i=$e.has(s.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx("td",{className:"px-4 py-3",children:i?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},s.id)})})]})})]})})})]})}return f.forEach(t=>{const s=ae[t.fixture_index],i=s&&(s.status==="IN_PLAY"||s.status==="PAUSED"),r=s&&s.status==="FINISHED";if(s&&(i||r)){const u=C.get(t.fixture_index);u&&(u.pick==="H"&&s.homeScore>s.awayScore||u.pick==="A"&&s.awayScore>s.homeScore||u.pick==="D"&&(s.homeScore,s.awayScore))}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>y("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",d]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[(()=>{const t=f.length>0&&f.some(i=>{const r=ae[i.fixture_index];return r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")});let s=0;if(t?f.forEach(i=>{const r=ae[i.fixture_index],u=C.get(i.fixture_index);if(r&&u){let a=!1;(u.pick==="H"&&r.homeScore>r.awayScore||u.pick==="A"&&r.awayScore>r.homeScore||u.pick==="D"&&r.homeScore===r.awayScore)&&(a=!0),a&&s++}}):x&&f.forEach(i=>{const r=U.get(i.fixture_index),u=C.get(i.fixture_index);r&&u&&r===u.pick&&s++}),t||x&&f.length>0){const i=t?s:x?be:0;return e.jsx(jt,{score:i,total:f.length,topPercent:et})}return null})(),e.jsx("div",{className:"space-y-6 [&>div:first-child]:mt-0",children:(()=>{const t=[];let s="",i=[];return f.forEach(r=>{const u=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";u!==s?(i.length>0&&t.push({label:s,items:i}),s=u,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,u)=>e.jsxs("div",{className:u>0?"mt-6":"",children:[e.jsx(bt,{date:r.label}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:r.items.map((a,j)=>{const c=C.get(a.fixture_index),l=ae[a.fixture_index],L=l&&l.status==="IN_PLAY",G=l&&(l.status==="PAUSED"||l.status==="HALF_TIME"||l.status==="HT"),o=l&&l.status==="FINISHED",w=L||G,_=a.home_team||a.home_name||a.home_code||"",S=a.away_team||a.away_name||a.away_code||"",E=$(_),T=$(S),me=a.kickoff_time?(()=>{const v=new Date(a.kickoff_time),B=String(v.getUTCHours()).padStart(2,"0"),b=String(v.getUTCMinutes()).padStart(2,"0");return`${B}:${b}`})():"â€”",M=v=>{const B=c?.pick===v;let b=!1;return l&&(v==="H"&&l.homeScore>l.awayScore||v==="A"&&l.awayScore>l.homeScore||v==="D"&&l.homeScore===l.awayScore)&&(b=!0),{isPicked:B,isCorrectResult:b,isCorrect:B&&b,isWrong:B&&(w||o)&&!b}},H=M("H"),ie=M("D"),ue=M("A"),I=(v,B)=>{const b="h-16 rounded-xl border text-sm font-medium transition-all flex items-center justify-center select-none";return L||w?v.isCorrect?`${b} bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50`:v.isWrong?`${b} bg-[#1C8376] text-white border-[#1C8376]`:v.isPicked?`${b} bg-[#1C8376] text-white border-[#1C8376]`:v.isCorrectResult&&!v.isPicked?`${b} bg-slate-50 text-slate-600 border-2 border-slate-300 animate-pulse`:`${b} bg-slate-50 text-slate-600 border-slate-200`:o?v.isCorrect?`${b} bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-2xl shadow-yellow-400/40 transform scale-110 rotate-1 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]`:v.isWrong?`${b} bg-[#1C8376] text-white border-[#1C8376]`:v.isCorrectResult&&!v.isPicked?`${b} bg-slate-50 text-slate-600 border-4 border-emerald-600`:v.isPicked?`${b} bg-[#1C8376] text-white border-[#1C8376]`:`${b} bg-slate-50 text-slate-600 border-slate-200`:v.isPicked?`${b} bg-[#1C8376] text-white border-[#1C8376]`:`${b} bg-slate-50 text-slate-600 border-slate-200`};return e.jsx("li",{className:j>0?"border-t":"",children:e.jsxs("div",{className:"p-4 bg-white relative",children:[(L||G)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),e.jsx("div",{className:`flex flex-col px-2 pb-3 ${w?"pt-4":"pt-1"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`break-words ${l&&(w||o)&&l.homeScore>l.awayScore?"font-bold":"font-medium"}`,children:E}),e.jsx("img",{src:`/assets/badges/${(a.home_code||_).toUpperCase()}.png`,alt:E,className:"w-5 h-5",onError:v=>{v.currentTarget.style.opacity="0.35"}})]}),l&&(w||o)&&(()=>{const v=(l.goals||[]).filter(m=>{if(!m||!m.team)return!1;const h=m.team||"",p=$(h),P=l.home_team?$(l.home_team):E;return p===P||p===E||p===$(a.home_team||"")||p===$(a.home_name||"")||h.toLowerCase()===(l.home_team||"").toLowerCase()||h.toLowerCase()===E.toLowerCase()||h.toLowerCase()===(a.home_team||"").toLowerCase()||h.toLowerCase()===(a.home_name||"").toLowerCase()}),B=(l.red_cards||[]).filter(m=>{const h=m.team||"",p=$(h);return p===E||p===$(a.home_team||"")}),b=[],z=new Map;return v.forEach(m=>{const h=m.scorer||"Unknown",p=m.minute;z.has(h)||z.set(h,[]),p!=null&&z.get(h).push(p)}),z.forEach((m,h)=>{const p=m.sort((P,Fe)=>P-Fe);b.push({type:"goal",minute:p[0],scorer:h,minutes:p})}),B.forEach(m=>{b.push({type:"red_card",minute:m.minute,player:m.player||"Unknown"})}),b.sort((m,h)=>m.minute===null?1:h.minute===null?-1:m.minute-h.minute),b.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-end gap-0.5",children:b.map((m,h)=>m.type==="goal"?e.jsxs("span",{className:"text-[11px] text-slate-600",children:[m.scorer," ",m.minutes.sort((p,P)=>p-P).map(p=>`${p}'`).join(", ")]},h):e.jsxs("span",{className:"text-[11px] text-slate-600",children:["ðŸŸ¥ ",m.player," ",m.minute,"'"]},h))})})()]}),e.jsx("div",{className:"px-4 flex flex-col items-center",children:l&&(w||o)?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-base text-slate-900",children:[l.homeScore," - ",l.awayScore]}),e.jsx("span",{className:`text-[10px] font-semibold mt-0.5 ${w?"text-red-600":"text-slate-500"}`,children:vt(l.status,l.minute,!0)})]}):e.jsx("span",{className:"text-slate-500 text-sm",children:me})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/assets/badges/${(a.away_code||S).toUpperCase()}.png`,alt:T,className:"w-5 h-5",onError:v=>{v.currentTarget.style.opacity="0.35"}}),e.jsx("div",{className:`break-words ${l&&(w||o)&&l.awayScore>l.homeScore?"font-bold":"font-medium"}`,children:T})]}),l&&(w||o)&&(()=>{const v=(l.goals||[]).filter(m=>{if(!m||!m.team)return!1;const h=m.team||"",p=$(h),P=l.away_team?$(l.away_team):T;return p===P||p===T||p===$(a.away_team||"")||p===$(a.away_name||"")||h.toLowerCase()===(l.away_team||"").toLowerCase()||h.toLowerCase()===T.toLowerCase()||h.toLowerCase()===(a.away_team||"").toLowerCase()||h.toLowerCase()===(a.away_name||"").toLowerCase()}),B=(l.red_cards||[]).filter(m=>{const h=m.team||"",p=$(h);return p===T||p===$(a.away_team||"")}),b=[],z=new Map;return v.forEach(m=>{const h=m.scorer||"Unknown",p=m.minute;z.has(h)||z.set(h,[]),p!=null&&z.get(h).push(p)}),z.forEach((m,h)=>{const p=m.sort((P,Fe)=>P-Fe);b.push({type:"goal",minute:p[0],scorer:h,minutes:p})}),B.forEach(m=>{b.push({type:"red_card",minute:m.minute,player:m.player||"Unknown"})}),b.sort((m,h)=>m.minute===null?1:h.minute===null?-1:m.minute-h.minute),b.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-start gap-0.5",children:b.map((m,h)=>m.type==="goal"?e.jsxs("span",{className:"text-[11px] text-slate-600",children:[m.scorer," ",m.minutes.sort((p,P)=>p-P).map(p=>`${p}'`).join(", ")]},h):e.jsxs("span",{className:"text-[11px] text-slate-600",children:["ðŸŸ¥ ",m.player," ",m.minute,"'"]},h))})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 relative mt-4",children:[e.jsx("div",{className:`${I(H)} flex items-center justify-center`,children:e.jsx("span",{className:`${H.isCorrect?"font-bold":""} ${H.isWrong&&o?"line-through decoration-2 decoration-white":""}`,children:"Home Win"})}),e.jsx("div",{className:`${I(ie)} flex items-center justify-center`,children:e.jsx("span",{className:`${ie.isCorrect?"font-bold":""} ${ie.isWrong&&o?"line-through decoration-2 decoration-white":""}`,children:"Draw"})}),e.jsx("div",{className:`${I(ue)} flex items-center justify-center`,children:e.jsx("span",{className:`${ue.isCorrect?"font-bold":""} ${ue.isWrong&&o?"line-through decoration-2 decoration-white":""}`,children:"Away Win"})})]})]})},a.id)})})})]},u))})()})]})})]})}const Oe=te();if(!x&&Oe&&ee&&(console.log("[TestApiPredictions] WARNING: sessionStorage says submitted but state says no - clearing sessionStorage"),se(!1),D.current=!1),console.log("[TestApiPredictions] Review mode check - submitted:",x,"ref:",D.current,"sessionStorage:",Oe),console.log("[TestApiPredictions] Review mode check - currentIndex:",N,"fixtures.length:",f.length,"submitted:",x),N>=f.length)return console.log("[TestApiPredictions] âœ… Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[_e&&e.jsx(kt,{success:_e.success,message:_e.message,onClose:()=>Q(null)}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>k(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),de&&!x?e.jsx("button",{onClick:Me,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):x?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"âœ“ Submitted"}):C.size>0?e.jsx("button",{onClick:Me,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>k(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:x?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let s="",i=[];return f.forEach(r=>{const u=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";u!==s?(i.length>0&&t.push({label:s,items:i}),s=u,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,u)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:r.label}),e.jsx("div",{className:"space-y-4",children:r.items.map(a=>{const j=C.get(a.fixture_index),c=U.get(a.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:a.home_team||a.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ve,{code:a.home_code,crest:a.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:a.kickoff_time?new Date(a.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(ve,{code:a.away_code,crest:a.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:a.away_team||a.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(x)return;const l=new Map(C);l.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"H",matchday:d}),q(l),ye("H")},disabled:x,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${j?.pick==="H"?c&&c==="H"&&j.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="D"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="H"?"bg-gray-300 text-slate-700 border-gray-400":x?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(x)return;const l=new Map(C);l.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"D",matchday:d}),q(l),ye("D")},disabled:x,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${j?.pick==="D"?c&&c==="D"&&j.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="D"?"bg-gray-300 text-slate-700 border-gray-400":x?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(x)return;const l=new Map(C);l.set(a.fixture_index,{fixture_index:a.fixture_index,pick:"A",matchday:d}),q(l),ye("A")},disabled:x,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${j?.pick==="A"?c&&c==="A"&&j.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="A"?"bg-gray-300 text-slate-700 border-gray-400":x?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},a.id)})})]},u))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:x?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",d," have been confirmed."]}),be>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[be,"/",f.length]})]}):e.jsxs(e.Fragment,{children:[!de&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{onClick:mt,disabled:x,className:"w-full py-3 bg-slate-200 text-slate-700 rounded-2xl font-semibold hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Over"}),e.jsx("button",{onClick:Me,disabled:!de,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Confirm Predictions (TEST)":"Complete All Predictions First"}),e.jsx("button",{onClick:()=>y("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})})})]});const Ye=te(),Ve=(()=>{if(typeof window>"u"||!n?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${n.id}`)&&sessionStorage.getItem(s)==="true")return!0}}catch{}return!1})(),W=x||Ye&&D.current||Ve,re=W?"list":O;return W&&O==="cards"?(console.log("[TestApiPredictions] ðŸš« BLOCKING cards - submission detected, viewMode still cards, showing loading"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):(console.log("[TestApiPredictions] ðŸ”´ SWIPE VIEW CHECK - submitted:",x,"ref:",D.current,"sessionStorage:",Ye,"anySessionStorage:",Ve,"checkSubmittedBeforeSwipe:",W,"viewMode:",O,"effectiveViewMode:",re),console.log("[TestApiPredictions] âœ… Showing view - mode:",re),!V&&f.length>0?(console.log("[TestApiPredictions] âš ï¸ currentFixture is undefined, resetting to index 0"),k(0),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):f.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"No fixtures available"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Check back later for Test GW ",d," fixtures."]})]})}):e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[Ce.current&&!W&&!x&&re==="cards"&&O==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",style:{display:W?"none":"block"},children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>y("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"âœ•"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",d]}),!W&&re==="cards"&&e.jsxs("button",{onClick:()=>k(f.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),!W&&re==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-0",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:f.map((t,s)=>{const i=s<N,r=s===N;return e.jsx("div",{className:`flex items-center justify-center transition-all ${r?"h-2 w-6 rounded-full bg-[#178f72]":"h-3 w-3 rounded-full"} ${i&&!r?"bg-[#116f59]":r?"":"bg-white"}`},s)})})})]})}),(W||re==="list")&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>y("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",d," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:be})]})})}),!W&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{Y("cards"),k(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}),Ce.current&&!W&&!x&&re==="cards"&&O==="cards"&&e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1",style:{height:"100%",paddingBottom:"120px"},children:[e.jsxs("div",{className:"flex items-center justify-center px-4 relative overflow-hidden flex-1",style:{minHeight:0,width:"100%",paddingTop:"0.125rem"},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${ke==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"â†"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${ke==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"â†’"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${ke==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"â†“"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75",display:W?"none":"block"},children:[N<f.length-1&&(()=>{const t=f[N+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:le||X?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsx(Ke,{fixture:t,homeColor:we(t.home_code,t.home_name),awayColor:we(t.away_code,t.away_name),showSwipeHint:!1})},N+1)})(),e.jsx("div",{className:"absolute inset-0 z-10",style:{transform:`translate(${F.x}px, ${F.y}px) rotate(${F.rotation}deg) scale(${F.scale})`,opacity:F.opacity,transition:le||Pe.current?"none":"all 0.3s ease-out",pointerEvents:"none",display:W?"none":"block"},children:e.jsx(Ke,{fixture:V,homeColor:we(V.home_code,V.home_name),awayColor:we(V.away_code,V.away_name),showSwipeHint:!0})}),e.jsx("div",{ref:lt,className:"absolute inset-0 z-50 cursor-grab active:cursor-grabbing",style:{touchAction:"none",WebkitTouchCallout:"none",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"auto",backgroundColor:"transparent",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",margin:0,padding:0},onMouseDown:t=>{t.preventDefault(),!x&&He(t.clientX,t.clientY)},onMouseMove:t=>{t.preventDefault(),!x&&Re(t.clientX,t.clientY)},onMouseUp:t=>{t.preventDefault(),Ae()},onMouseLeave:t=>{t.preventDefault(),Ae()},onTouchStart:ct,onTouchMove:dt,onTouchEnd:ze,onTouchCancel:ze})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 pt-3 px-4 bg-[#eef4f3] z-[10000] safe-area-inset-bottom",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom, 0px))"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>Te("H"),disabled:X||x,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:F.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(F.x)/150)})`:void 0,color:F.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>Te("D"),disabled:X||x,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:F.y>30?`rgba(59, 130, 246, ${Math.min(.8,F.y/150)})`:void 0,color:F.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>Te("A"),disabled:X||x,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:F.x>30?`rgba(34, 197, 94, ${Math.min(.8,F.x/150)})`:void 0,color:F.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]}))}export{At as default};
