import{g as jn,r as D,s as ce,j as s,V as Sn,a as Br,u as Hr,i as kn,b as yr,T as _r,D as Cn,c as Nn,d as En,e as An,f as Yt,h as Ln,k as Rn,L as jr,l as Zt,m as Sr,I as kr,n as Jt,o as Cr}from"./index-C9jSZaHd.js";function Mn(d,u){return u.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(n){if(n!=="default"&&!(n in d)){var t=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(d,n,t.get?t:{enumerable:!0,get:function(){return r[n]}})}}))})),Object.freeze(d)}function Gr(d,u){return new Promise((function(r,n){let t;return Tn(d).then((function(e){try{return t=e,r(new Blob([u.slice(0,2),t,u.slice(2)],{type:"image/jpeg"}))}catch(i){return n(i)}}),n)}))}const Tn=d=>new Promise(((u,r)=>{const n=new FileReader;n.addEventListener("load",(({target:{result:t}})=>{const e=new DataView(t);let i=0;if(e.getUint16(i)!==65496)return r("not a valid JPEG");for(i+=2;;){const c=e.getUint16(i);if(c===65498)break;const b=e.getUint16(i+2);if(c===65505&&e.getUint32(i+4)===1165519206){const p=i+10;let o;switch(e.getUint16(p)){case 18761:o=!0;break;case 19789:o=!1;break;default:return r("TIFF header contains invalid endian")}if(e.getUint16(p+2,o)!==42)return r("TIFF header contains invalid version");const l=e.getUint32(p+4,o),a=p+l+2+12*e.getUint16(p+l,o);for(let h=p+l+2;h<a;h+=12)if(e.getUint16(h,o)==274){if(e.getUint16(h+2,o)!==3)return r("Orientation data type is invalid");if(e.getUint32(h+4,o)!==1)return r("Orientation data count is invalid");e.setUint16(h+8,1,o);break}return u(t.slice(i,i+2+b))}i+=2+b}return u(new Blob)})),n.readAsArrayBuffer(d)}));var Ut={},Dn={get exports(){return Ut},set exports(d){Ut=d}};(function(d){var u,r,n={};Dn.exports=n,n.parse=function(t,e){for(var i=n.bin.readUshort,c=n.bin.readUint,b=0,p={},o=new Uint8Array(t),l=o.length-4;c(o,l)!=101010256;)l--;b=l,b+=4;var a=i(o,b+=4);i(o,b+=2);var h=c(o,b+=2),f=c(o,b+=4);b+=4,b=f;for(var S=0;S<a;S++){c(o,b),b+=4,b+=4,b+=4,c(o,b+=4),h=c(o,b+=4);var E=c(o,b+=4),j=i(o,b+=4),$=i(o,b+2),U=i(o,b+4);b+=6;var M=c(o,b+=8);b+=4,b+=j+$+U,n._readLocal(o,M,p,h,E,e)}return p},n._readLocal=function(t,e,i,c,b,p){var o=n.bin.readUshort,l=n.bin.readUint;l(t,e),o(t,e+=4),o(t,e+=2);var a=o(t,e+=2);l(t,e+=2),l(t,e+=4),e+=4;var h=o(t,e+=8),f=o(t,e+=2);e+=2;var S=n.bin.readUTF8(t,e,h);if(e+=h,e+=f,p)i[S]={size:b,csize:c};else{var E=new Uint8Array(t.buffer,e);if(a==0)i[S]=new Uint8Array(E.buffer.slice(e,e+c));else{if(a!=8)throw"unknown compression method: "+a;var j=new Uint8Array(b);n.inflateRaw(E,j),i[S]=j}}},n.inflateRaw=function(t,e){return n.F.inflate(t,e)},n.inflate=function(t,e){return t[0],t[1],n.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),e)},n.deflate=function(t,e){e==null&&(e={level:6});var i=0,c=new Uint8Array(50+Math.floor(1.1*t.length));c[i]=120,c[i+1]=156,i+=2,i=n.F.deflateRaw(t,c,i,e.level);var b=n.adler(t,0,t.length);return c[i+0]=b>>>24&255,c[i+1]=b>>>16&255,c[i+2]=b>>>8&255,c[i+3]=b>>>0&255,new Uint8Array(c.buffer,0,i+4)},n.deflateRaw=function(t,e){e==null&&(e={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),c=n.F.deflateRaw(t,i,c,e.level);return new Uint8Array(i.buffer,0,c)},n.encode=function(t,e){e==null&&(e=!1);var i=0,c=n.bin.writeUint,b=n.bin.writeUshort,p={};for(var o in t){var l=!n._noNeed(o)&&!e,a=t[o],h=n.crc.crc(a,0,a.length);p[o]={cpr:l,usize:a.length,crc:h,file:l?n.deflateRaw(a):a}}for(var o in p)i+=p[o].file.length+30+46+2*n.bin.sizeUTF8(o);i+=22;var f=new Uint8Array(i),S=0,E=[];for(var o in p){var j=p[o];E.push(S),S=n._writeHeader(f,S,o,j,0)}var $=0,U=S;for(var o in p)j=p[o],E.push(S),S=n._writeHeader(f,S,o,j,1,E[$++]);var M=S-U;return c(f,S,101010256),S+=4,b(f,S+=4,$),b(f,S+=2,$),c(f,S+=2,M),c(f,S+=4,U),S+=4,S+=2,f.buffer},n._noNeed=function(t){var e=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(e)!=-1},n._writeHeader=function(t,e,i,c,b,p){var o=n.bin.writeUint,l=n.bin.writeUshort,a=c.file;return o(t,e,b==0?67324752:33639248),e+=4,b==1&&(e+=2),l(t,e,20),l(t,e+=2,0),l(t,e+=2,c.cpr?8:0),o(t,e+=2,0),o(t,e+=4,c.crc),o(t,e+=4,a.length),o(t,e+=4,c.usize),l(t,e+=4,n.bin.sizeUTF8(i)),l(t,e+=2,0),e+=2,b==1&&(e+=2,e+=2,o(t,e+=6,p),e+=4),e+=n.bin.writeUTF8(t,e,i),b==0&&(t.set(a,e),e+=a.length),e},n.crc={table:(function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var i=e,c=0;c<8;c++)1&i?i=3988292384^i>>>1:i>>>=1;t[e]=i}return t})(),update:function(t,e,i,c){for(var b=0;b<c;b++)t=n.crc.table[255&(t^e[i+b])]^t>>>8;return t},crc:function(t,e,i){return 4294967295^n.crc.update(4294967295,t,e,i)}},n.adler=function(t,e,i){for(var c=1,b=0,p=e,o=e+i;p<o;){for(var l=Math.min(p+5552,o);p<l;)b+=c+=t[p++];c%=65521,b%=65521}return b<<16|c},n.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255,t[e+2]=i>>16&255,t[e+3]=i>>24&255},readASCII:function(t,e,i){for(var c="",b=0;b<i;b++)c+=String.fromCharCode(t[e+b]);return c},writeASCII:function(t,e,i){for(var c=0;c<i.length;c++)t[e+c]=i.charCodeAt(c)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,e,i){for(var c,b="",p=0;p<i;p++)b+="%"+n.bin.pad(t[e+p].toString(16));try{c=decodeURIComponent(b)}catch{return n.bin.readASCII(t,e,i)}return c},writeUTF8:function(t,e,i){for(var c=i.length,b=0,p=0;p<c;p++){var o=i.charCodeAt(p);if((4294967168&o)==0)t[e+b]=o,b++;else if((4294965248&o)==0)t[e+b]=192|o>>6,t[e+b+1]=128|o>>0&63,b+=2;else if((4294901760&o)==0)t[e+b]=224|o>>12,t[e+b+1]=128|o>>6&63,t[e+b+2]=128|o>>0&63,b+=3;else{if((4292870144&o)!=0)throw"e";t[e+b]=240|o>>18,t[e+b+1]=128|o>>12&63,t[e+b+2]=128|o>>6&63,t[e+b+3]=128|o>>0&63,b+=4}}return b},sizeUTF8:function(t){for(var e=t.length,i=0,c=0;c<e;c++){var b=t.charCodeAt(c);if((4294967168&b)==0)i++;else if((4294965248&b)==0)i+=2;else if((4294901760&b)==0)i+=3;else{if((4292870144&b)!=0)throw"e";i+=4}}return i}},n.F={},n.F.deflateRaw=function(t,e,i,c){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],p=n.F.U,o=n.F._goodIndex;n.F._hash;var l=n.F._putsE,a=0,h=i<<3,f=0,S=t.length;if(c==0){for(;a<S;)l(e,h,a+(N=Math.min(65535,S-a))==S?1:0),h=n.F._copyExact(t,a,N,e,h+8),a+=N;return h>>>3}var E=p.lits,j=p.strt,$=p.prev,U=0,M=0,F=0,v=0,z=0,m=0;for(S>2&&(j[m=n.F._hash(t,0)]=0),a=0;a<S;a++){if(z=m,a+1<S-2){m=n.F._hash(t,a+1);var g=a+1&32767;$[g]=j[m],j[m]=g}if(f<=a){(U>14e3||M>26697)&&S-a>100&&(f<a&&(E[U]=a-f,U+=2,f=a),h=n.F._writeBlock(a==S-1||f==S?1:0,E,U,v,t,F,a-F,e,h),U=M=v=0,F=a);var _=0;a<S-2&&(_=n.F._bestMatch(t,a,$,z,Math.min(b[2],S-a),b[3]));var N=_>>>16,y=65535&_;if(_!=0){y=65535&_;var R=o(N=_>>>16,p.of0);p.lhst[257+R]++;var C=o(y,p.df0);p.dhst[C]++,v+=p.exb[R]+p.dxb[C],E[U]=N<<23|a-f,E[U+1]=y<<16|R<<8|C,U+=2,f=a+N}else p.lhst[t[a]]++;M++}}for(F==a&&t.length!=0||(f<a&&(E[U]=a-f,U+=2,f=a),h=n.F._writeBlock(1,E,U,v,t,F,a-F,e,h),U=0,M=0,U=M=v=0,F=a);(7&h)!=0;)h++;return h>>>3},n.F._bestMatch=function(t,e,i,c,b,p){var o=32767&e,l=i[o],a=o-l+32768&32767;if(l==o||c!=n.F._hash(t,e-a))return 0;for(var h=0,f=0,S=Math.min(32767,e);a<=S&&--p!=0&&l!=o;){if(h==0||t[e+h]==t[e+h-a]){var E=n.F._howLong(t,e,a);if(E>h){if(f=a,(h=E)>=b)break;a+2<E&&(E=a+2);for(var j=0,$=0;$<E-2;$++){var U=e-a+$+32768&32767,M=U-i[U]+32768&32767;M>j&&(j=M,l=U)}}}a+=(o=l)-(l=i[o])+32768&32767}return h<<16|f},n.F._howLong=function(t,e,i){if(t[e]!=t[e-i]||t[e+1]!=t[e+1-i]||t[e+2]!=t[e+2-i])return 0;var c=e,b=Math.min(t.length,e+258);for(e+=3;e<b&&t[e]==t[e-i];)e++;return e-c},n.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(t,e,i,c,b,p,o,l,a){var h,f,S,E,j,$,U,M,F,v=n.F.U,z=n.F._putsF,m=n.F._putsE;v.lhst[256]++,f=(h=n.F.getTrees())[0],S=h[1],E=h[2],j=h[3],$=h[4],U=h[5],M=h[6],F=h[7];var g=32+((a+3&7)==0?0:8-(a+3&7))+(o<<3),_=c+n.F.contSize(v.fltree,v.lhst)+n.F.contSize(v.fdtree,v.dhst),N=c+n.F.contSize(v.ltree,v.lhst)+n.F.contSize(v.dtree,v.dhst);N+=14+3*U+n.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var y=0;y<286;y++)v.lhst[y]=0;for(y=0;y<30;y++)v.dhst[y]=0;for(y=0;y<19;y++)v.ihst[y]=0;var R=g<_&&g<N?0:_<N?1:2;if(z(l,a,t),z(l,a+1,R),a+=3,R==0){for(;(7&a)!=0;)a++;a=n.F._copyExact(b,p,o,l,a)}else{var C,A;if(R==1&&(C=v.fltree,A=v.fdtree),R==2){n.F.makeCodes(v.ltree,f),n.F.revCodes(v.ltree,f),n.F.makeCodes(v.dtree,S),n.F.revCodes(v.dtree,S),n.F.makeCodes(v.itree,E),n.F.revCodes(v.itree,E),C=v.ltree,A=v.dtree,m(l,a,j-257),m(l,a+=5,$-1),m(l,a+=5,U-4),a+=4;for(var x=0;x<U;x++)m(l,a+3*x,v.itree[1+(v.ordr[x]<<1)]);a+=3*U,a=n.F._codeTiny(M,v.itree,l,a),a=n.F._codeTiny(F,v.itree,l,a)}for(var w=p,B=0;B<i;B+=2){for(var P=e[B],G=P>>>23,oe=w+(8388607&P);w<oe;)a=n.F._writeLit(b[w++],C,l,a);if(G!=0){var X=e[B+1],I=X>>16,T=X>>8&255,L=255&X;m(l,a=n.F._writeLit(257+T,C,l,a),G-v.of0[T]),a+=v.exb[T],z(l,a=n.F._writeLit(L,A,l,a),I-v.df0[L]),a+=v.dxb[L],w+=G}}a=n.F._writeLit(256,C,l,a)}return a},n.F._copyExact=function(t,e,i,c,b){var p=b>>>3;return c[p]=i,c[p+1]=i>>>8,c[p+2]=255-c[p],c[p+3]=255-c[p+1],p+=4,c.set(new Uint8Array(t.buffer,e,i),p),b+(i+4<<3)},n.F.getTrees=function(){for(var t=n.F.U,e=n.F._hufTree(t.lhst,t.ltree,15),i=n.F._hufTree(t.dhst,t.dtree,15),c=[],b=n.F._lenCodes(t.ltree,c),p=[],o=n.F._lenCodes(t.dtree,p),l=0;l<c.length;l+=2)t.ihst[c[l]]++;for(l=0;l<p.length;l+=2)t.ihst[p[l]]++;for(var a=n.F._hufTree(t.ihst,t.itree,7),h=19;h>4&&t.itree[1+(t.ordr[h-1]<<1)]==0;)h--;return[e,i,a,b,o,h,c,p]},n.F.getSecond=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(t[i+1]);return e},n.F.nonZero=function(t){for(var e="",i=0;i<t.length;i+=2)t[i+1]!=0&&(e+=(i>>1)+",");return e},n.F.contSize=function(t,e){for(var i=0,c=0;c<e.length;c++)i+=e[c]*t[1+(c<<1)];return i},n.F._codeTiny=function(t,e,i,c){for(var b=0;b<t.length;b+=2){var p=t[b],o=t[b+1];c=n.F._writeLit(p,e,i,c);var l=p==16?2:p==17?3:7;p>15&&(n.F._putsE(i,c,o,l),c+=l)}return c},n.F._lenCodes=function(t,e){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var c=0;c<i;c+=2){var b=t[c+1],p=c+3<i?t[c+3]:-1,o=c+5<i?t[c+5]:-1,l=c==0?-1:t[c-1];if(b==0&&p==b&&o==b){for(var a=c+5;a+2<i&&t[a+2]==b;)a+=2;(h=Math.min(a+1-c>>>1,138))<11?e.push(17,h-3):e.push(18,h-11),c+=2*h-2}else if(b==l&&p==b&&o==b){for(a=c+5;a+2<i&&t[a+2]==b;)a+=2;var h=Math.min(a+1-c>>>1,6);e.push(16,h-3),c+=2*h-2}else e.push(b,0)}return i>>>1},n.F._hufTree=function(t,e,i){var c=[],b=t.length,p=e.length,o=0;for(o=0;o<p;o+=2)e[o]=0,e[o+1]=0;for(o=0;o<b;o++)t[o]!=0&&c.push({lit:o,f:t[o]});var l=c.length,a=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return a=h==0?1:0,e[1+(h<<1)]=1,e[1+(a<<1)]=1,1}c.sort((function(M,F){return M.f-F.f}));var f=c[0],S=c[1],E=0,j=1,$=2;for(c[0]={lit:-1,f:f.f+S.f,l:f,r:S,d:0};j!=l-1;)f=E!=j&&($==l||c[E].f<c[$].f)?c[E++]:c[$++],S=E!=j&&($==l||c[E].f<c[$].f)?c[E++]:c[$++],c[j++]={lit:-1,f:f.f+S.f,l:f,r:S};var U=n.F.setDepth(c[j-1],0);for(U>i&&(n.F.restrictDepth(a,i,U),U=i),o=0;o<l;o++)e[1+(a[o].lit<<1)]=a[o].d;return U},n.F.setDepth=function(t,e){return t.lit!=-1?(t.d=e,e):Math.max(n.F.setDepth(t.l,e+1),n.F.setDepth(t.r,e+1))},n.F.restrictDepth=function(t,e,i){var c=0,b=1<<i-e,p=0;for(t.sort((function(l,a){return a.d==l.d?l.f-a.f:a.d-l.d})),c=0;c<t.length&&t[c].d>e;c++){var o=t[c].d;t[c].d=e,p+=b-(1<<i-o)}for(p>>>=i-e;p>0;)(o=t[c].d)<e?(t[c].d++,p-=1<<e-o-1):c++;for(;c>=0;c--)t[c].d==e&&p<0&&(t[c].d--,p++);p!=0&&console.log("debt left")},n.F._goodIndex=function(t,e){var i=0;return e[16|i]<=t&&(i|=16),e[8|i]<=t&&(i|=8),e[4|i]<=t&&(i|=4),e[2|i]<=t&&(i|=2),e[1|i]<=t&&(i|=1),i},n.F._writeLit=function(t,e,i,c){return n.F._putsF(i,c,e[t<<1]),c+e[1+(t<<1)]},n.F.inflate=function(t,e){var i=Uint8Array;if(t[0]==3&&t[1]==0)return e||new i(0);var c=n.F,b=c._bitsF,p=c._bitsE,o=c._decodeTiny,l=c.makeCodes,a=c.codes2map,h=c._get17,f=c.U,S=e==null;S&&(e=new i(t.length>>>2<<3));for(var E,j,$=0,U=0,M=0,F=0,v=0,z=0,m=0,g=0,_=0;$==0;)if($=b(t,_,1),U=b(t,_+1,2),_+=3,U!=0){if(S&&(e=n.F._check(e,g+(1<<17))),U==1&&(E=f.flmap,j=f.fdmap,z=511,m=31),U==2){M=p(t,_,5)+257,F=p(t,_+5,5)+1,v=p(t,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)f.itree[N]=0,f.itree[N+1]=0;var y=1;for(N=0;N<v;N++){var R=p(t,_+3*N,3);f.itree[1+(f.ordr[N]<<1)]=R,R>y&&(y=R)}_+=3*v,l(f.itree,y),a(f.itree,y,f.imap),E=f.lmap,j=f.dmap,_=o(f.imap,(1<<y)-1,M+F,t,_,f.ttree);var C=c._copyOut(f.ttree,0,M,f.ltree);z=(1<<C)-1;var A=c._copyOut(f.ttree,M,F,f.dtree);m=(1<<A)-1,l(f.ltree,C),a(f.ltree,C,E),l(f.dtree,A),a(f.dtree,A,j)}for(;;){var x=E[h(t,_)&z];_+=15&x;var w=x>>>4;if(!(w>>>8))e[g++]=w;else{if(w==256)break;var B=g+w-254;if(w>264){var P=f.ldef[w-257];B=g+(P>>>3)+p(t,_,7&P),_+=7&P}var G=j[h(t,_)&m];_+=15&G;var oe=G>>>4,X=f.ddef[oe],I=(X>>>4)+b(t,_,15&X);for(_+=15&X,S&&(e=n.F._check(e,g+(1<<17)));g<B;)e[g]=e[g++-I],e[g]=e[g++-I],e[g]=e[g++-I],e[g]=e[g++-I];g=B}}}else{(7&_)!=0&&(_+=8-(7&_));var T=4+(_>>>3),L=t[T-4]|t[T-3]<<8;S&&(e=n.F._check(e,g+L)),e.set(new i(t.buffer,t.byteOffset+T,L),g),_=T+L<<3,g+=L}return e.length==g?e:e.slice(0,g)},n.F._check=function(t,e){var i=t.length;if(e<=i)return t;var c=new Uint8Array(Math.max(i<<1,e));return c.set(t,0),c},n.F._decodeTiny=function(t,e,i,c,b,p){for(var o=n.F._bitsE,l=n.F._get17,a=0;a<i;){var h=t[l(c,b)&e];b+=15&h;var f=h>>>4;if(f<=15)p[a]=f,a++;else{var S=0,E=0;f==16?(E=3+o(c,b,2),b+=2,S=p[a-1]):f==17?(E=3+o(c,b,3),b+=3):f==18&&(E=11+o(c,b,7),b+=7);for(var j=a+E;a<j;)p[a]=S,a++}}return b},n.F._copyOut=function(t,e,i,c){for(var b=0,p=0,o=c.length>>>1;p<i;){var l=t[p+e];c[p<<1]=0,c[1+(p<<1)]=l,l>b&&(b=l),p++}for(;p<o;)c[p<<1]=0,c[1+(p<<1)]=0,p++;return b},n.F.makeCodes=function(t,e){for(var i,c,b,p,o=n.F.U,l=t.length,a=o.bl_count,h=0;h<=e;h++)a[h]=0;for(h=1;h<l;h+=2)a[t[h]]++;var f=o.next_code;for(i=0,a[0]=0,c=1;c<=e;c++)i=i+a[c-1]<<1,f[c]=i;for(b=0;b<l;b+=2)(p=t[b+1])!=0&&(t[b]=f[p],f[p]++)},n.F.codes2map=function(t,e,i){for(var c=t.length,b=n.F.U.rev15,p=0;p<c;p+=2)if(t[p+1]!=0)for(var o=p>>1,l=t[p+1],a=o<<4|l,h=e-l,f=t[p]<<h,S=f+(1<<h);f!=S;)i[b[f]>>>15-e]=a,f++},n.F.revCodes=function(t,e){for(var i=n.F.U.rev15,c=15-e,b=0;b<t.length;b+=2){var p=t[b]<<e-t[b+1];t[b]=i[p]>>>c}},n.F._putsE=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8},n.F._putsF=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8,t[c+2]|=i>>>16},n.F._bitsE=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<i)-1},n.F._bitsF=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<i)-1},n.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},n.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},n.F.U=(u=Uint16Array,r=Uint32Array,{next_code:new u(16),bl_count:new u(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new u(512),fltree:[],fdmap:new u(32),fdtree:[],lmap:new u(32768),ltree:[],ttree:[],dmap:new u(32768),dtree:[],imap:new u(512),itree:[],rev15:new u(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new u(65536),prev:new u(32768)}),(function(){for(var t=n.F.U,e=0;e<32768;e++){var i=e;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[e]=(i>>>16|i<<16)>>>17}function c(b,p,o){for(;p--!=0;)b.push(0,o)}for(e=0;e<32;e++)t.ldef[e]=t.of0[e]<<3|t.exb[e],t.ddef[e]=t.df0[e]<<4|t.dxb[e];c(t.fltree,144,8),c(t.fltree,112,9),c(t.fltree,24,7),c(t.fltree,8,8),n.F.makeCodes(t.fltree,9),n.F.codes2map(t.fltree,9,t.flmap),n.F.revCodes(t.fltree,9),c(t.fdtree,32,5),n.F.makeCodes(t.fdtree,5),n.F.codes2map(t.fdtree,5,t.fdmap),n.F.revCodes(t.fdtree,5),c(t.itree,19,0),c(t.ltree,286,0),c(t.dtree,30,0),c(t.ttree,320,0)})()})();var Pn=Mn({__proto__:null,default:Ut},[Ut]);const st=(function(){var d={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,a){o[l]=a>>8&255,o[l+1]=255&a},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,a){o[l]=a>>24&255,o[l+1]=a>>16&255,o[l+2]=a>>8&255,o[l+3]=255&a},readASCII(o,l,a){let h="";for(let f=0;f<a;f++)h+=String.fromCharCode(o[l+f]);return h},writeASCII(o,l,a){for(let h=0;h<a.length;h++)o[l+h]=a.charCodeAt(h)},readBytes(o,l,a){const h=[];for(let f=0;f<a;f++)h.push(o[l+f]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,a){let h,f="";for(let S=0;S<a;S++)f+=`%${d.pad(o[l+S].toString(16))}`;try{h=decodeURIComponent(f)}catch{return d.readASCII(o,l,a)}return h}};function u(o,l,a,h){const f=l*a,S=e(h),E=Math.ceil(l*S/8),j=new Uint8Array(4*f),$=new Uint32Array(j.buffer),{ctype:U}=h,{depth:M}=h,F=d.readUshort;if(U==6){const P=f<<2;if(M==8)for(var v=0;v<P;v+=4)j[v]=o[v],j[v+1]=o[v+1],j[v+2]=o[v+2],j[v+3]=o[v+3];if(M==16)for(v=0;v<P;v++)j[v]=o[v<<1]}else if(U==2){const P=h.tabs.tRNS;if(P==null){if(M==8)for(v=0;v<f;v++){var z=3*v;$[v]=255<<24|o[z+2]<<16|o[z+1]<<8|o[z]}if(M==16)for(v=0;v<f;v++)z=6*v,$[v]=255<<24|o[z+4]<<16|o[z+2]<<8|o[z]}else{var m=P[0];const G=P[1],oe=P[2];if(M==8)for(v=0;v<f;v++){var g=v<<2;z=3*v,$[v]=255<<24|o[z+2]<<16|o[z+1]<<8|o[z],o[z]==m&&o[z+1]==G&&o[z+2]==oe&&(j[g+3]=0)}if(M==16)for(v=0;v<f;v++)g=v<<2,z=6*v,$[v]=255<<24|o[z+4]<<16|o[z+2]<<8|o[z],F(o,z)==m&&F(o,z+2)==G&&F(o,z+4)==oe&&(j[g+3]=0)}}else if(U==3){const P=h.tabs.PLTE,G=h.tabs.tRNS,oe=G?G.length:0;if(M==1)for(var _=0;_<a;_++){var N=_*E,y=_*l;for(v=0;v<l;v++){g=y+v<<2;var R=3*(C=o[N+(v>>3)]>>7-((7&v)<<0)&1);j[g]=P[R],j[g+1]=P[R+1],j[g+2]=P[R+2],j[g+3]=C<oe?G[C]:255}}if(M==2)for(_=0;_<a;_++)for(N=_*E,y=_*l,v=0;v<l;v++)g=y+v<<2,R=3*(C=o[N+(v>>2)]>>6-((3&v)<<1)&3),j[g]=P[R],j[g+1]=P[R+1],j[g+2]=P[R+2],j[g+3]=C<oe?G[C]:255;if(M==4)for(_=0;_<a;_++)for(N=_*E,y=_*l,v=0;v<l;v++)g=y+v<<2,R=3*(C=o[N+(v>>1)]>>4-((1&v)<<2)&15),j[g]=P[R],j[g+1]=P[R+1],j[g+2]=P[R+2],j[g+3]=C<oe?G[C]:255;if(M==8)for(v=0;v<f;v++){var C;g=v<<2,R=3*(C=o[v]),j[g]=P[R],j[g+1]=P[R+1],j[g+2]=P[R+2],j[g+3]=C<oe?G[C]:255}}else if(U==4){if(M==8)for(v=0;v<f;v++){g=v<<2;var A=o[x=v<<1];j[g]=A,j[g+1]=A,j[g+2]=A,j[g+3]=o[x+1]}if(M==16)for(v=0;v<f;v++){var x;g=v<<2,A=o[x=v<<2],j[g]=A,j[g+1]=A,j[g+2]=A,j[g+3]=o[x+2]}}else if(U==0)for(m=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<a;_++){const P=_*E,G=_*l;if(M==1)for(var w=0;w<l;w++){var B=(A=255*(o[P+(w>>>3)]>>>7-(7&w)&1))==255*m?0:255;$[G+w]=B<<24|A<<16|A<<8|A}else if(M==2)for(w=0;w<l;w++)B=(A=85*(o[P+(w>>>2)]>>>6-((3&w)<<1)&3))==85*m?0:255,$[G+w]=B<<24|A<<16|A<<8|A;else if(M==4)for(w=0;w<l;w++)B=(A=17*(o[P+(w>>>1)]>>>4-((1&w)<<2)&15))==17*m?0:255,$[G+w]=B<<24|A<<16|A<<8|A;else if(M==8)for(w=0;w<l;w++)B=(A=o[P+w])==m?0:255,$[G+w]=B<<24|A<<16|A<<8|A;else if(M==16)for(w=0;w<l;w++)A=o[P+(w<<1)],B=F(o,P+(w<<1))==m?0:255,$[G+w]=B<<24|A<<16|A<<8|A}return j}function r(o,l,a,h){const f=e(o),S=Math.ceil(a*f/8),E=new Uint8Array((S+1+o.interlace)*h);return l=o.tabs.CgBI?t(l,E):n(l,E),o.interlace==0?l=i(l,o,0,a,h):o.interlace==1&&(l=(function($,U){const M=U.width,F=U.height,v=e(U),z=v>>3,m=Math.ceil(M*v/8),g=new Uint8Array(F*m);let _=0;const N=[0,0,4,0,2,0,1],y=[0,4,0,2,0,1,0],R=[8,8,8,4,4,2,2],C=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const w=R[A],B=C[A];let P=0,G=0,oe=N[A];for(;oe<F;)oe+=w,G++;let X=y[A];for(;X<M;)X+=B,P++;const I=Math.ceil(P*v/8);i($,U,_,P,G);let T=0,L=N[A];for(;L<F;){let Q=y[A],Z=_+T*I<<3;for(;Q<M;){var x;if(v==1&&(x=(x=$[Z>>3])>>7-(7&Z)&1,g[L*m+(Q>>3)]|=x<<7-((7&Q)<<0)),v==2&&(x=(x=$[Z>>3])>>6-(7&Z)&3,g[L*m+(Q>>2)]|=x<<6-((3&Q)<<1)),v==4&&(x=(x=$[Z>>3])>>4-(7&Z)&15,g[L*m+(Q>>1)]|=x<<4-((1&Q)<<2)),v>=8){const O=L*m+Q*z;for(let ee=0;ee<z;ee++)g[O+ee]=$[(Z>>3)+ee]}Z+=v,Q+=B}T++,L+=w}P*G!=0&&(_+=G*(1+I)),A+=1}return g})(l,o)),l}function n(o,l){return t(new Uint8Array(o.buffer,2,o.length-6),l)}var t=(function(){const o={H:{}};return o.H.N=function(l,a){const h=Uint8Array;let f,S,E=0,j=0,$=0,U=0,M=0,F=0,v=0,z=0,m=0;if(l[0]==3&&l[1]==0)return a||new h(0);const g=o.H,_=g.b,N=g.e,y=g.R,R=g.n,C=g.A,A=g.Z,x=g.m,w=a==null;for(w&&(a=new h(l.length>>>2<<5));E==0;)if(E=_(l,m,1),j=_(l,m+1,2),m+=3,j!=0){if(w&&(a=o.H.W(a,z+(1<<17))),j==1&&(f=x.J,S=x.h,F=511,v=31),j==2){$=N(l,m,5)+257,U=N(l,m+5,5)+1,M=N(l,m+10,4)+4,m+=14;let P=1;for(var B=0;B<38;B+=2)x.Q[B]=0,x.Q[B+1]=0;for(B=0;B<M;B++){const X=N(l,m+3*B,3);x.Q[1+(x.X[B]<<1)]=X,X>P&&(P=X)}m+=3*M,R(x.Q,P),C(x.Q,P,x.u),f=x.w,S=x.d,m=y(x.u,(1<<P)-1,$+U,l,m,x.v);const G=g.V(x.v,0,$,x.C);F=(1<<G)-1;const oe=g.V(x.v,$,U,x.D);v=(1<<oe)-1,R(x.C,G),C(x.C,G,f),R(x.D,oe),C(x.D,oe,S)}for(;;){const P=f[A(l,m)&F];m+=15&P;const G=P>>>4;if(!(G>>>8))a[z++]=G;else{if(G==256)break;{let oe=z+G-254;if(G>264){const Q=x.q[G-257];oe=z+(Q>>>3)+N(l,m,7&Q),m+=7&Q}const X=S[A(l,m)&v];m+=15&X;const I=X>>>4,T=x.c[I],L=(T>>>4)+_(l,m,15&T);for(m+=15&T;z<oe;)a[z]=a[z++-L],a[z]=a[z++-L],a[z]=a[z++-L],a[z]=a[z++-L];z=oe}}}}else{(7&m)!=0&&(m+=8-(7&m));const P=4+(m>>>3),G=l[P-4]|l[P-3]<<8;w&&(a=o.H.W(a,z+G)),a.set(new h(l.buffer,l.byteOffset+P,G),z),m=P+G<<3,z+=G}return a.length==z?a:a.slice(0,z)},o.H.W=function(l,a){const h=l.length;if(a<=h)return l;const f=new Uint8Array(h<<1);return f.set(l,0),f},o.H.R=function(l,a,h,f,S,E){const j=o.H.e,$=o.H.Z;let U=0;for(;U<h;){const M=l[$(f,S)&a];S+=15&M;const F=M>>>4;if(F<=15)E[U]=F,U++;else{let v=0,z=0;F==16?(z=3+j(f,S,2),S+=2,v=E[U-1]):F==17?(z=3+j(f,S,3),S+=3):F==18&&(z=11+j(f,S,7),S+=7);const m=U+z;for(;U<m;)E[U]=v,U++}}return S},o.H.V=function(l,a,h,f){let S=0,E=0;const j=f.length>>>1;for(;E<h;){const $=l[E+a];f[E<<1]=0,f[1+(E<<1)]=$,$>S&&(S=$),E++}for(;E<j;)f[E<<1]=0,f[1+(E<<1)]=0,E++;return S},o.H.n=function(l,a){const h=o.H.m,f=l.length;let S,E,j,$;const U=h.j;for(var M=0;M<=a;M++)U[M]=0;for(M=1;M<f;M+=2)U[l[M]]++;const F=h.K;for(S=0,U[0]=0,E=1;E<=a;E++)S=S+U[E-1]<<1,F[E]=S;for(j=0;j<f;j+=2)$=l[j+1],$!=0&&(l[j]=F[$],F[$]++)},o.H.A=function(l,a,h){const f=l.length,S=o.H.m.r;for(let E=0;E<f;E+=2)if(l[E+1]!=0){const j=E>>1,$=l[E+1],U=j<<4|$,M=a-$;let F=l[E]<<M;const v=F+(1<<M);for(;F!=v;)h[S[F]>>>15-a]=U,F++}},o.H.l=function(l,a){const h=o.H.m.r,f=15-a;for(let S=0;S<l.length;S+=2){const E=l[S]<<a-l[S+1];l[S]=h[E]>>>f}},o.H.M=function(l,a,h){h<<=7&a;const f=a>>>3;l[f]|=h,l[f+1]|=h>>>8},o.H.I=function(l,a,h){h<<=7&a;const f=a>>>3;l[f]|=h,l[f+1]|=h>>>8,l[f+2]|=h>>>16},o.H.e=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8)>>>(7&a)&(1<<h)-1},o.H.b=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)&(1<<h)-1},o.H.Z=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)},o.H.i=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16|l[3+(a>>>3)]<<24)>>>(7&a)},o.H.m=(function(){const l=Uint16Array,a=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new a(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new a(286),Y:new a(30),a:new a(19),t:new a(15e3),k:new l(65536),g:new l(32768)}})(),(function(){const l=o.H.m;for(var a=0;a<32768;a++){let f=a;f=(2863311530&f)>>>1|(1431655765&f)<<1,f=(3435973836&f)>>>2|(858993459&f)<<2,f=(4042322160&f)>>>4|(252645135&f)<<4,f=(4278255360&f)>>>8|(16711935&f)<<8,l.r[a]=(f>>>16|f<<16)>>>17}function h(f,S,E){for(;S--!=0;)f.push(0,E)}for(a=0;a<32;a++)l.q[a]=l.S[a]<<3|l.T[a],l.c[a]=l.p[a]<<4|l.z[a];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)})(),o.H.N})();function e(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function i(o,l,a,h,f){let S=e(l);const E=Math.ceil(h*S/8);let j,$;S=Math.ceil(S/8);let U=o[a],M=0;if(U>1&&(o[a]=[0,0,1][U-2]),U==3)for(M=S;M<E;M++)o[M+1]=o[M+1]+(o[M+1-S]>>>1)&255;for(let F=0;F<f;F++)if(j=a+F*E,$=j+F+1,U=o[$-1],M=0,U==0)for(;M<E;M++)o[j+M]=o[$+M];else if(U==1){for(;M<S;M++)o[j+M]=o[$+M];for(;M<E;M++)o[j+M]=o[$+M]+o[j+M-S]}else if(U==2)for(;M<E;M++)o[j+M]=o[$+M]+o[j+M-E];else if(U==3){for(;M<S;M++)o[j+M]=o[$+M]+(o[j+M-E]>>>1);for(;M<E;M++)o[j+M]=o[$+M]+(o[j+M-E]+o[j+M-S]>>>1)}else{for(;M<S;M++)o[j+M]=o[$+M]+c(0,o[j+M-E],0);for(;M<E;M++)o[j+M]=o[$+M]+c(o[j+M-S],o[j+M-E],o[j+M-S-E])}return o}function c(o,l,a){const h=o+l-a,f=h-o,S=h-l,E=h-a;return f*f<=S*S&&f*f<=E*E?o:S*S<=E*E?l:a}function b(o,l,a){a.width=d.readUint(o,l),l+=4,a.height=d.readUint(o,l),l+=4,a.depth=o[l],l++,a.ctype=o[l],l++,a.compress=o[l],l++,a.filter=o[l],l++,a.interlace=o[l],l++}function p(o,l,a,h,f,S,E,j,$){const U=Math.min(l,f),M=Math.min(a,S);let F=0,v=0;for(let A=0;A<M;A++)for(let x=0;x<U;x++)if(E>=0&&j>=0?(F=A*l+x<<2,v=(j+A)*f+E+x<<2):(F=(-j+A)*l-E+x<<2,v=A*f+x<<2),$==0)h[v]=o[F],h[v+1]=o[F+1],h[v+2]=o[F+2],h[v+3]=o[F+3];else if($==1){var z=o[F+3]*.00392156862745098,m=o[F]*z,g=o[F+1]*z,_=o[F+2]*z,N=h[v+3]*(1/255),y=h[v]*N,R=h[v+1]*N,C=h[v+2]*N;const w=1-z,B=z+N*w,P=B==0?0:1/B;h[v+3]=255*B,h[v+0]=(m+y*w)*P,h[v+1]=(g+R*w)*P,h[v+2]=(_+C*w)*P}else if($==2)z=o[F+3],m=o[F],g=o[F+1],_=o[F+2],N=h[v+3],y=h[v],R=h[v+1],C=h[v+2],z==N&&m==y&&g==R&&_==C?(h[v]=0,h[v+1]=0,h[v+2]=0,h[v+3]=0):(h[v]=m,h[v+1]=g,h[v+2]=_,h[v+3]=z);else if($==3){if(z=o[F+3],m=o[F],g=o[F+1],_=o[F+2],N=h[v+3],y=h[v],R=h[v+1],C=h[v+2],z==N&&m==y&&g==R&&_==C)continue;if(z<220&&N>20)return!1}return!0}return{decode:function(l){const a=new Uint8Array(l);let h=8;const f=d,S=f.readUshort,E=f.readUint,j={tabs:{},frames:[]},$=new Uint8Array(a.length);let U,M=0,F=0;const v=[137,80,78,71,13,10,26,10];for(var z=0;z<8;z++)if(a[z]!=v[z])throw"The input is not a PNG file!";for(;h<a.length;){const A=f.readUint(a,h);h+=4;const x=f.readASCII(a,h,4);if(h+=4,x=="IHDR")b(a,h,j);else if(x=="iCCP"){for(var m=h;a[m]!=0;)m++;f.readASCII(a,h,m-h),a[m+1];const w=a.slice(m+2,h+A);let B=null;try{B=n(w)}catch{B=t(w)}j.tabs[x]=B}else if(x=="CgBI")j.tabs[x]=a.slice(h,h+4);else if(x=="IDAT"){for(z=0;z<A;z++)$[M+z]=a[h+z];M+=A}else if(x=="acTL")j.tabs[x]={num_frames:E(a,h),num_plays:E(a,h+4)},U=new Uint8Array(a.length);else if(x=="fcTL"){F!=0&&((C=j.frames[j.frames.length-1]).data=r(j,U.slice(0,F),C.rect.width,C.rect.height),F=0);const w={x:E(a,h+12),y:E(a,h+16),width:E(a,h+4),height:E(a,h+8)};let B=S(a,h+22);B=S(a,h+20)/(B==0?100:B);const P={rect:w,delay:Math.round(1e3*B),dispose:a[h+24],blend:a[h+25]};j.frames.push(P)}else if(x=="fdAT"){for(z=0;z<A-4;z++)U[F+z]=a[h+z+4];F+=A-4}else if(x=="pHYs")j.tabs[x]=[f.readUint(a,h),f.readUint(a,h+4),a[h+8]];else if(x=="cHRM")for(j.tabs[x]=[],z=0;z<8;z++)j.tabs[x].push(f.readUint(a,h+4*z));else if(x=="tEXt"||x=="zTXt"){j.tabs[x]==null&&(j.tabs[x]={});var g=f.nextZero(a,h),_=f.readASCII(a,h,g-h),N=h+A-g-1;if(x=="tEXt")R=f.readASCII(a,g+1,N);else{var y=n(a.slice(g+2,g+2+N));R=f.readUTF8(y,0,y.length)}j.tabs[x][_]=R}else if(x=="iTXt"){j.tabs[x]==null&&(j.tabs[x]={}),g=0,m=h,g=f.nextZero(a,m),_=f.readASCII(a,m,g-m);const w=a[m=g+1];var R;a[m+1],m+=2,g=f.nextZero(a,m),f.readASCII(a,m,g-m),m=g+1,g=f.nextZero(a,m),f.readUTF8(a,m,g-m),N=A-((m=g+1)-h),w==0?R=f.readUTF8(a,m,N):(y=n(a.slice(m,m+N)),R=f.readUTF8(y,0,y.length)),j.tabs[x][_]=R}else if(x=="PLTE")j.tabs[x]=f.readBytes(a,h,A);else if(x=="hIST"){const w=j.tabs.PLTE.length/3;for(j.tabs[x]=[],z=0;z<w;z++)j.tabs[x].push(S(a,h+2*z))}else if(x=="tRNS")j.ctype==3?j.tabs[x]=f.readBytes(a,h,A):j.ctype==0?j.tabs[x]=S(a,h):j.ctype==2&&(j.tabs[x]=[S(a,h),S(a,h+2),S(a,h+4)]);else if(x=="gAMA")j.tabs[x]=f.readUint(a,h)/1e5;else if(x=="sRGB")j.tabs[x]=a[h];else if(x=="bKGD")j.ctype==0||j.ctype==4?j.tabs[x]=[S(a,h)]:j.ctype==2||j.ctype==6?j.tabs[x]=[S(a,h),S(a,h+2),S(a,h+4)]:j.ctype==3&&(j.tabs[x]=a[h]);else if(x=="IEND")break;h+=A,f.readUint(a,h),h+=4}var C;return F!=0&&((C=j.frames[j.frames.length-1]).data=r(j,U.slice(0,F),C.rect.width,C.rect.height)),j.data=r(j,$,j.width,j.height),delete j.compress,delete j.interlace,delete j.filter,j},toRGBA8:function(l){const a=l.width,h=l.height;if(l.tabs.acTL==null)return[u(l.data,a,h,l).buffer];const f=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const S=a*h*4,E=new Uint8Array(S),j=new Uint8Array(S),$=new Uint8Array(S);for(let M=0;M<l.frames.length;M++){const F=l.frames[M],v=F.rect.x,z=F.rect.y,m=F.rect.width,g=F.rect.height,_=u(F.data,m,g,l);if(M!=0)for(var U=0;U<S;U++)$[U]=E[U];if(F.blend==0?p(_,m,g,E,a,h,v,z,0):F.blend==1&&p(_,m,g,E,a,h,v,z,1),f.push(E.buffer.slice(0)),F.dispose!=0){if(F.dispose==1)p(j,m,g,E,a,h,v,z,0);else if(F.dispose==2)for(U=0;U<S;U++)E[U]=$[U]}}return f},_paeth:c,_copyTile:p,_bin:d}})();(function(){const{_copyTile:d}=st,{_bin:u}=st,r=st._paeth;var n={table:(function(){const m=new Uint32Array(256);for(let g=0;g<256;g++){let _=g;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;m[g]=_}return m})(),update(m,g,_,N){for(let y=0;y<N;y++)m=n.table[255&(m^g[_+y])]^m>>>8;return m},crc:(m,g,_)=>4294967295^n.update(4294967295,m,g,_)};function t(m,g,_,N){g[_]+=m[0]*N>>4,g[_+1]+=m[1]*N>>4,g[_+2]+=m[2]*N>>4,g[_+3]+=m[3]*N>>4}function e(m){return Math.max(0,Math.min(255,m))}function i(m,g){const _=m[0]-g[0],N=m[1]-g[1],y=m[2]-g[2],R=m[3]-g[3];return _*_+N*N+y*y+R*R}function c(m,g,_,N,y,R,C){C==null&&(C=1);const A=N.length,x=[];for(var w=0;w<A;w++){const L=N[w];x.push([L>>>0&255,L>>>8&255,L>>>16&255,L>>>24&255])}for(w=0;w<A;w++){let L=4294967295;for(var B=0,P=0;P<A;P++){var G=i(x[w],x[P]);P!=w&&G<L&&(L=G,B=P)}}const oe=new Uint32Array(y.buffer),X=new Int16Array(g*_*4),I=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(w=0;w<I.length;w++)I[w]=255*((I[w]+.5)/16-.5);for(let L=0;L<_;L++)for(let Q=0;Q<g;Q++){var T;w=4*(L*g+Q),C!=2?T=[e(m[w]+X[w]),e(m[w+1]+X[w+1]),e(m[w+2]+X[w+2]),e(m[w+3]+X[w+3])]:(G=I[4*(3&L)+(3&Q)],T=[e(m[w]+G),e(m[w+1]+G),e(m[w+2]+G),e(m[w+3]+G)]),B=0;let Z=16777215;for(P=0;P<A;P++){const te=i(T,x[P]);te<Z&&(Z=te,B=P)}const O=x[B],ee=[T[0]-O[0],T[1]-O[1],T[2]-O[2],T[3]-O[3]];C==1&&(Q!=g-1&&t(ee,X,w+4,7),L!=_-1&&(Q!=0&&t(ee,X,w+4*g-4,3),t(ee,X,w+4*g,5),Q!=g-1&&t(ee,X,w+4*g+4,1))),R[w>>2]=B,oe[w>>2]=N[B]}}function b(m,g,_,N,y){y==null&&(y={});const{crc:R}=n,C=u.writeUint,A=u.writeUshort,x=u.writeASCII;let w=8;const B=m.frames.length>1;let P,G=!1,oe=33+(B?20:0);if(y.sRGB!=null&&(oe+=13),y.pHYs!=null&&(oe+=21),y.iCCP!=null&&(P=pako.deflate(y.iCCP),oe+=21+P.length+4),m.ctype==3){for(var X=m.plte.length,I=0;I<X;I++)m.plte[I]>>>24!=255&&(G=!0);oe+=8+3*X+4+(G?8+1*X+4:0)}for(var T=0;T<m.frames.length;T++)B&&(oe+=38),oe+=(O=m.frames[T]).cimg.length+12,T!=0&&(oe+=4);oe+=12;const L=new Uint8Array(oe),Q=[137,80,78,71,13,10,26,10];for(I=0;I<8;I++)L[I]=Q[I];if(C(L,w,13),w+=4,x(L,w,"IHDR"),w+=4,C(L,w,g),w+=4,C(L,w,_),w+=4,L[w]=m.depth,w++,L[w]=m.ctype,w++,L[w]=0,w++,L[w]=0,w++,L[w]=0,w++,C(L,w,R(L,w-17,17)),w+=4,y.sRGB!=null&&(C(L,w,1),w+=4,x(L,w,"sRGB"),w+=4,L[w]=y.sRGB,w++,C(L,w,R(L,w-5,5)),w+=4),y.iCCP!=null){const ee=13+P.length;C(L,w,ee),w+=4,x(L,w,"iCCP"),w+=4,x(L,w,"ICC profile"),w+=11,w+=2,L.set(P,w),w+=P.length,C(L,w,R(L,w-(ee+4),ee+4)),w+=4}if(y.pHYs!=null&&(C(L,w,9),w+=4,x(L,w,"pHYs"),w+=4,C(L,w,y.pHYs[0]),w+=4,C(L,w,y.pHYs[1]),w+=4,L[w]=y.pHYs[2],w++,C(L,w,R(L,w-13,13)),w+=4),B&&(C(L,w,8),w+=4,x(L,w,"acTL"),w+=4,C(L,w,m.frames.length),w+=4,C(L,w,y.loop!=null?y.loop:0),w+=4,C(L,w,R(L,w-12,12)),w+=4),m.ctype==3){for(C(L,w,3*(X=m.plte.length)),w+=4,x(L,w,"PLTE"),w+=4,I=0;I<X;I++){const ee=3*I,te=m.plte[I],ae=255&te,ie=te>>>8&255,qe=te>>>16&255;L[w+ee+0]=ae,L[w+ee+1]=ie,L[w+ee+2]=qe}if(w+=3*X,C(L,w,R(L,w-3*X-4,3*X+4)),w+=4,G){for(C(L,w,X),w+=4,x(L,w,"tRNS"),w+=4,I=0;I<X;I++)L[w+I]=m.plte[I]>>>24&255;w+=X,C(L,w,R(L,w-X-4,X+4)),w+=4}}let Z=0;for(T=0;T<m.frames.length;T++){var O=m.frames[T];B&&(C(L,w,26),w+=4,x(L,w,"fcTL"),w+=4,C(L,w,Z++),w+=4,C(L,w,O.rect.width),w+=4,C(L,w,O.rect.height),w+=4,C(L,w,O.rect.x),w+=4,C(L,w,O.rect.y),w+=4,A(L,w,N[T]),w+=2,A(L,w,1e3),w+=2,L[w]=O.dispose,w++,L[w]=O.blend,w++,C(L,w,R(L,w-30,30)),w+=4);const ee=O.cimg;C(L,w,(X=ee.length)+(T==0?0:4)),w+=4;const te=w;x(L,w,T==0?"IDAT":"fdAT"),w+=4,T!=0&&(C(L,w,Z++),w+=4),L.set(ee,w),w+=X,C(L,w,R(L,te,w-te)),w+=4}return C(L,w,0),w+=4,x(L,w,"IEND"),w+=4,C(L,w,R(L,w-4,4)),w+=4,L.buffer}function p(m,g,_){for(let N=0;N<m.frames.length;N++){const y=m.frames[N];y.rect.width;const R=y.rect.height,C=new Uint8Array(R*y.bpl+R);y.cimg=h(y.img,R,y.bpp,y.bpl,C,g,_)}}function o(m,g,_,N,y){const R=y[0],C=y[1],A=y[2],x=y[3],w=y[4],B=y[5];let P=6,G=8,oe=255;for(var X=0;X<m.length;X++){const Ae=new Uint8Array(m[X]);for(var I=Ae.length,T=0;T<I;T+=4)oe&=Ae[T+3]}const L=oe!=255,Q=(function(be,ve,ye,Ce,Me,Le){const Se=[];for(var xe=0;xe<be.length;xe++){const Fe=new Uint8Array(be[xe]),De=new Uint32Array(Fe.buffer);var Te;let ze=0,tt=0,Ke=ve,ut=ye,mt=Ce?1:0;if(xe!=0){const vt=Le||Ce||xe==1||Se[xe-2].dispose!=0?1:2;let xt=0,pt=1e9;for(let Xe=0;Xe<vt;Xe++){var Ve=new Uint8Array(be[xe-1-Xe]);const Ot=new Uint32Array(be[xe-1-Xe]);let et=ve,ot=ye,at=-1,it=-1;for(let rt=0;rt<ye;rt++)for(let lt=0;lt<ve;lt++)De[Ue=rt*ve+lt]!=Ot[Ue]&&(lt<et&&(et=lt),lt>at&&(at=lt),rt<ot&&(ot=rt),rt>it&&(it=rt));at==-1&&(et=ot=at=it=0),Me&&((1&et)==1&&et--,(1&ot)==1&&ot--);const yt=(at-et+1)*(it-ot+1);yt<pt&&(pt=yt,xt=Xe,ze=et,tt=ot,Ke=at-et+1,ut=it-ot+1)}Ve=new Uint8Array(be[xe-1-xt]),xt==1&&(Se[xe-1].dispose=2),Te=new Uint8Array(Ke*ut*4),d(Ve,ve,ye,Te,Ke,ut,-ze,-tt,0),mt=d(Fe,ve,ye,Te,Ke,ut,-ze,-tt,3)?1:0,mt==1?a(Fe,ve,ye,Te,{x:ze,y:tt,width:Ke,height:ut}):d(Fe,ve,ye,Te,Ke,ut,-ze,-tt,0)}else Te=Fe.slice(0);Se.push({rect:{x:ze,y:tt,width:Ke,height:ut},img:Te,blend:mt,dispose:0})}if(Ce)for(xe=0;xe<Se.length;xe++){if((Qe=Se[xe]).blend==1)continue;const Fe=Qe.rect,De=Se[xe-1].rect,ze=Math.min(Fe.x,De.x),tt=Math.min(Fe.y,De.y),Ke={x:ze,y:tt,width:Math.max(Fe.x+Fe.width,De.x+De.width)-ze,height:Math.max(Fe.y+Fe.height,De.y+De.height)-tt};Se[xe-1].dispose=1,xe-1!=0&&l(be,ve,ye,Se,xe-1,Ke,Me),l(be,ve,ye,Se,xe,Ke,Me)}let Je=0;if(be.length!=1)for(var Ue=0;Ue<Se.length;Ue++){var Qe;Je+=(Qe=Se[Ue]).rect.width*Qe.rect.height}return Se})(m,g,_,R,C,A),Z={},O=[],ee=[];if(N!=0){const Ae=[];for(T=0;T<Q.length;T++)Ae.push(Q[T].img.buffer);const be=(function(Me){let Le=0;for(var Se=0;Se<Me.length;Se++)Le+=Me[Se].byteLength;const xe=new Uint8Array(Le);let Te=0;for(Se=0;Se<Me.length;Se++){const Ve=new Uint8Array(Me[Se]),Je=Ve.length;for(let Ue=0;Ue<Je;Ue+=4){let Qe=Ve[Ue],Fe=Ve[Ue+1],De=Ve[Ue+2];const ze=Ve[Ue+3];ze==0&&(Qe=Fe=De=0),xe[Te+Ue]=Qe,xe[Te+Ue+1]=Fe,xe[Te+Ue+2]=De,xe[Te+Ue+3]=ze}Te+=Je}return xe.buffer})(Ae),ve=S(be,N);for(T=0;T<ve.plte.length;T++)O.push(ve.plte[T].est.rgba);let ye=0;for(T=0;T<Q.length;T++){const Ce=(ae=Q[T]).img.length;var te=new Uint8Array(ve.inds.buffer,ye>>2,Ce>>2);ee.push(te);const Me=new Uint8Array(ve.abuf,ye,Ce);B&&c(ae.img,ae.rect.width,ae.rect.height,O,Me,te),ae.img.set(Me),ye+=Ce}}else for(X=0;X<Q.length;X++){var ae=Q[X];const Ae=new Uint32Array(ae.img.buffer);var ie=ae.rect.width;for(I=Ae.length,te=new Uint8Array(I),ee.push(te),T=0;T<I;T++){const be=Ae[T];if(T!=0&&be==Ae[T-1])te[T]=te[T-1];else if(T>ie&&be==Ae[T-ie])te[T]=te[T-ie];else{let ve=Z[be];if(ve==null&&(Z[be]=ve=O.length,O.push(be),O.length>=300))break;te[T]=ve}}}const qe=O.length;for(qe<=256&&w==0&&(G=qe<=2?1:qe<=4?2:qe<=16?4:8,G=Math.max(G,x)),X=0;X<Q.length;X++){(ae=Q[X]).rect.x,ae.rect.y,ie=ae.rect.width;const Ae=ae.rect.height;let be=ae.img;new Uint32Array(be.buffer);let ve=4*ie,ye=4;if(qe<=256&&w==0){ve=Math.ceil(G*ie/8);var He=new Uint8Array(ve*Ae);const Ce=ee[X];for(let Me=0;Me<Ae;Me++){T=Me*ve;const Le=Me*ie;if(G==8)for(var Ne=0;Ne<ie;Ne++)He[T+Ne]=Ce[Le+Ne];else if(G==4)for(Ne=0;Ne<ie;Ne++)He[T+(Ne>>1)]|=Ce[Le+Ne]<<4-4*(1&Ne);else if(G==2)for(Ne=0;Ne<ie;Ne++)He[T+(Ne>>2)]|=Ce[Le+Ne]<<6-2*(3&Ne);else if(G==1)for(Ne=0;Ne<ie;Ne++)He[T+(Ne>>3)]|=Ce[Le+Ne]<<7-1*(7&Ne)}be=He,P=3,ye=1}else if(L==0&&Q.length==1){He=new Uint8Array(ie*Ae*3);const Ce=ie*Ae;for(T=0;T<Ce;T++){const Me=3*T,Le=4*T;He[Me]=be[Le],He[Me+1]=be[Le+1],He[Me+2]=be[Le+2]}be=He,P=2,ye=3,ve=3*ie}ae.img=be,ae.bpl=ve,ae.bpp=ye}return{ctype:P,depth:G,plte:O,frames:Q}}function l(m,g,_,N,y,R,C){const A=Uint8Array,x=Uint32Array,w=new A(m[y-1]),B=new x(m[y-1]),P=y+1<m.length?new A(m[y+1]):null,G=new A(m[y]),oe=new x(G.buffer);let X=g,I=_,T=-1,L=-1;for(let Z=0;Z<R.height;Z++)for(let O=0;O<R.width;O++){const ee=R.x+O,te=R.y+Z,ae=te*g+ee,ie=oe[ae];ie==0||N[y-1].dispose==0&&B[ae]==ie&&(P==null||P[4*ae+3]!=0)||(ee<X&&(X=ee),ee>T&&(T=ee),te<I&&(I=te),te>L&&(L=te))}T==-1&&(X=I=T=L=0),C&&((1&X)==1&&X--,(1&I)==1&&I--),R={x:X,y:I,width:T-X+1,height:L-I+1};const Q=N[y];Q.rect=R,Q.blend=1,Q.img=new Uint8Array(R.width*R.height*4),N[y-1].dispose==0?(d(w,g,_,Q.img,R.width,R.height,-R.x,-R.y,0),a(G,g,_,Q.img,R)):d(G,g,_,Q.img,R.width,R.height,-R.x,-R.y,0)}function a(m,g,_,N,y){d(m,g,_,N,y.width,y.height,-y.x,-y.y,2)}function h(m,g,_,N,y,R,C){const A=[];let x,w=[0,1,2,3,4];R!=-1?w=[R]:(g*N>5e5||_==1)&&(w=[0]),C&&(x={level:0});const B=Pn;for(var P=0;P<w.length;P++){for(let X=0;X<g;X++)f(y,m,X,N,_,w[P]);A.push(B.deflate(y,x))}let G,oe=1e9;for(P=0;P<A.length;P++)A[P].length<oe&&(G=P,oe=A[P].length);return A[G]}function f(m,g,_,N,y,R){const C=_*N;let A=C+_;if(m[A]=R,A++,R==0)if(N<500)for(var x=0;x<N;x++)m[A+x]=g[C+x];else m.set(new Uint8Array(g.buffer,C,N),A);else if(R==1){for(x=0;x<y;x++)m[A+x]=g[C+x];for(x=y;x<N;x++)m[A+x]=g[C+x]-g[C+x-y]+256&255}else if(_==0){for(x=0;x<y;x++)m[A+x]=g[C+x];if(R==2)for(x=y;x<N;x++)m[A+x]=g[C+x];if(R==3)for(x=y;x<N;x++)m[A+x]=g[C+x]-(g[C+x-y]>>1)+256&255;if(R==4)for(x=y;x<N;x++)m[A+x]=g[C+x]-r(g[C+x-y],0,0)+256&255}else{if(R==2)for(x=0;x<N;x++)m[A+x]=g[C+x]+256-g[C+x-N]&255;if(R==3){for(x=0;x<y;x++)m[A+x]=g[C+x]+256-(g[C+x-N]>>1)&255;for(x=y;x<N;x++)m[A+x]=g[C+x]+256-(g[C+x-N]+g[C+x-y]>>1)&255}if(R==4){for(x=0;x<y;x++)m[A+x]=g[C+x]+256-r(0,g[C+x-N],0)&255;for(x=y;x<N;x++)m[A+x]=g[C+x]+256-r(g[C+x-y],g[C+x-N],g[C+x-y-N])&255}}}function S(m,g){const _=new Uint8Array(m),N=_.slice(0),y=new Uint32Array(N.buffer),R=E(N,g),C=R[0],A=R[1],x=_.length,w=new Uint8Array(x>>2);let B;if(_.length<2e7)for(var P=0;P<x;P+=4)B=j(C,G=_[P]*(1/255),oe=_[P+1]*(1/255),X=_[P+2]*(1/255),I=_[P+3]*(1/255)),w[P>>2]=B.ind,y[P>>2]=B.est.rgba;else for(P=0;P<x;P+=4){var G=_[P]*.00392156862745098,oe=_[P+1]*(1/255),X=_[P+2]*(1/255),I=_[P+3]*(1/255);for(B=C;B.left;)B=$(B.est,G,oe,X,I)<=0?B.left:B.right;w[P>>2]=B.ind,y[P>>2]=B.est.rgba}return{abuf:N.buffer,inds:w,plte:A}}function E(m,g,_){_==null&&(_=1e-4);const N=new Uint32Array(m.buffer),y={i0:0,i1:m.length,bst:null,est:null,tdst:0,left:null,right:null};y.bst=F(m,y.i0,y.i1),y.est=v(y.bst);const R=[y];for(;R.length<g;){let A=0,x=0;for(var C=0;C<R.length;C++)R[C].est.L>A&&(A=R[C].est.L,x=C);if(A<_)break;const w=R[x],B=U(m,N,w.i0,w.i1,w.est.e,w.est.eMq255);if(w.i0>=B||w.i1<=B){w.est.L=0;continue}const P={i0:w.i0,i1:B,bst:null,est:null,tdst:0,left:null,right:null};P.bst=F(m,P.i0,P.i1),P.est=v(P.bst);const G={i0:B,i1:w.i1,bst:null,est:null,tdst:0,left:null,right:null};for(G.bst={R:[],m:[],N:w.bst.N-P.bst.N},C=0;C<16;C++)G.bst.R[C]=w.bst.R[C]-P.bst.R[C];for(C=0;C<4;C++)G.bst.m[C]=w.bst.m[C]-P.bst.m[C];G.est=v(G.bst),w.left=P,w.right=G,R[x]=P,R.push(G)}for(R.sort(((A,x)=>x.bst.N-A.bst.N)),C=0;C<R.length;C++)R[C].ind=C;return[y,R]}function j(m,g,_,N,y){if(m.left==null)return m.tdst=(function(P,G,oe,X,I){const T=G-P[0],L=oe-P[1],Q=X-P[2],Z=I-P[3];return T*T+L*L+Q*Q+Z*Z})(m.est.q,g,_,N,y),m;const R=$(m.est,g,_,N,y);let C=m.left,A=m.right;R>0&&(C=m.right,A=m.left);const x=j(C,g,_,N,y);if(x.tdst<=R*R)return x;const w=j(A,g,_,N,y);return w.tdst<x.tdst?w:x}function $(m,g,_,N,y){const{e:R}=m;return R[0]*g+R[1]*_+R[2]*N+R[3]*y-m.eMq}function U(m,g,_,N,y,R){for(N-=4;_<N;){for(;M(m,_,y)<=R;)_+=4;for(;M(m,N,y)>R;)N-=4;if(_>=N)break;const C=g[_>>2];g[_>>2]=g[N>>2],g[N>>2]=C,_+=4,N-=4}for(;M(m,_,y)>R;)_-=4;return _+4}function M(m,g,_){return m[g]*_[0]+m[g+1]*_[1]+m[g+2]*_[2]+m[g+3]*_[3]}function F(m,g,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=[0,0,0,0],R=_-g>>2;for(let C=g;C<_;C+=4){const A=m[C]*.00392156862745098,x=m[C+1]*(1/255),w=m[C+2]*(1/255),B=m[C+3]*(1/255);y[0]+=A,y[1]+=x,y[2]+=w,y[3]+=B,N[0]+=A*A,N[1]+=A*x,N[2]+=A*w,N[3]+=A*B,N[5]+=x*x,N[6]+=x*w,N[7]+=x*B,N[10]+=w*w,N[11]+=w*B,N[15]+=B*B}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:y,N:R}}function v(m){const{R:g}=m,{m:_}=m,{N}=m,y=_[0],R=_[1],C=_[2],A=_[3],x=N==0?0:1/N,w=[g[0]-y*y*x,g[1]-y*R*x,g[2]-y*C*x,g[3]-y*A*x,g[4]-R*y*x,g[5]-R*R*x,g[6]-R*C*x,g[7]-R*A*x,g[8]-C*y*x,g[9]-C*R*x,g[10]-C*C*x,g[11]-C*A*x,g[12]-A*y*x,g[13]-A*R*x,g[14]-A*C*x,g[15]-A*A*x],B=w,P=z;let G=[Math.random(),Math.random(),Math.random(),Math.random()],oe=0,X=0;if(N!=0)for(let T=0;T<16&&(G=P.multVec(B,G),X=Math.sqrt(P.dot(G,G)),G=P.sml(1/X,G),!(T!=0&&Math.abs(X-oe)<1e-9));T++)oe=X;const I=[y*x,R*x,C*x,A*x];return{Cov:w,q:I,e:G,L:oe,eMq255:P.dot(P.sml(255,I),G),eMq:P.dot(G,I),rgba:(Math.round(255*I[3])<<24|Math.round(255*I[2])<<16|Math.round(255*I[1])<<8|Math.round(255*I[0])<<0)>>>0}}var z={multVec:(m,g)=>[m[0]*g[0]+m[1]*g[1]+m[2]*g[2]+m[3]*g[3],m[4]*g[0]+m[5]*g[1]+m[6]*g[2]+m[7]*g[3],m[8]*g[0]+m[9]*g[1]+m[10]*g[2]+m[11]*g[3],m[12]*g[0]+m[13]*g[1]+m[14]*g[2]+m[15]*g[3]],dot:(m,g)=>m[0]*g[0]+m[1]*g[1]+m[2]*g[2]+m[3]*g[3],sml:(m,g)=>[m*g[0],m*g[1],m*g[2],m*g[3]]};st.encode=function(g,_,N,y,R,C,A){y==null&&(y=0),A==null&&(A=!1);const x=o(g,_,N,y,[!1,!1,!1,0,A,!1]);return p(x,-1),b(x,_,N,R,C)},st.encodeLL=function(g,_,N,y,R,C,A,x){const w={ctype:0+(y==1?0:2)+(R==0?0:4),depth:C,frames:[]},B=(y+R)*C,P=B*_;for(let G=0;G<g.length;G++)w.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(g[G]),blend:0,dispose:1,bpp:Math.ceil(B/8),bpl:Math.ceil(P/8)});return p(w,0,!0),b(w,_,N,A,x)},st.encode.compress=o,st.encode.dither=c,st.quantize=S,st.quantize.getKDtree=E,st.quantize.getNearest=j})();const qr={toArrayBuffer(d,u){const r=d.width,n=d.height,t=r<<2,e=d.getContext("2d").getImageData(0,0,r,n),i=new Uint32Array(e.data.buffer),c=(32*r+31)/32<<2,b=c*n,p=122+b,o=new ArrayBuffer(p),l=new DataView(o),a=1<<20;let h,f,S,E,j=a,$=0,U=0,M=0;function F(m){l.setUint16(U,m,!0),U+=2}function v(m){l.setUint32(U,m,!0),U+=4}function z(m){U+=m}F(19778),v(p),z(4),v(122),v(108),v(r),v(-n>>>0),F(1),F(32),v(3),v(b),v(2835),v(2835),z(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),(function m(){for(;$<n&&j>0;){for(E=122+$*c,h=0;h<t;)j--,f=i[M++],S=f>>>24,l.setUint32(E+h,f<<8|S),h+=4;$++}M<i.length?(j=a,setTimeout(m,qr._dly)):u(o)})()},toBlob(d,u){this.toArrayBuffer(d,(r=>{u(new Blob([r],{type:"image/bmp"}))}))},_dly:9};var Ye={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Un={[Ye.CHROME]:16384,[Ye.FIREFOX]:11180,[Ye.DESKTOP_SAFARI]:16384,[Ye.IE]:8192,[Ye.IOS]:4096,[Ye.ETC]:8192};const lr=typeof window<"u",Vr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,It=lr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),In=(lr||Vr)&&(It&&It.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Kr=(lr||Vr)&&(It&&It.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function cr(d,u,r=Date.now()){return new Promise((n=>{const t=d.split(","),e=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]);let c=i.length;const b=new Uint8Array(c);for(;c--;)b[c]=i.charCodeAt(c);const p=new Blob([b],{type:e});p.name=u,p.lastModified=r,n(p)}))}function Yr(d){return new Promise(((u,r)=>{const n=new Kr;n.onload=()=>u(n.result),n.onerror=t=>r(t),n.readAsDataURL(d)}))}function Zr(d){return new Promise(((u,r)=>{const n=new Image;n.onload=()=>u(n),n.onerror=t=>r(t),n.src=d}))}function gt(){if(gt.cachedResult!==void 0)return gt.cachedResult;let d=Ye.ETC;const{userAgent:u}=navigator;return/Chrom(e|ium)/i.test(u)?d=Ye.CHROME:/iP(ad|od|hone)/i.test(u)&&/WebKit/i.test(u)?d=Ye.IOS:/Safari/i.test(u)?d=Ye.DESKTOP_SAFARI:/Firefox/i.test(u)?d=Ye.FIREFOX:(/MSIE/i.test(u)||document.documentMode)&&(d=Ye.IE),gt.cachedResult=d,gt.cachedResult}function Jr(d,u){const r=gt(),n=Un[r];let t=d,e=u,i=t*e;const c=t>e?e/t:t/e;for(;i>n*n;){const b=(n+t)/2,p=(n+e)/2;b<p?(e=p,t=p*c):(e=b*c,t=b),i=t*e}return{width:t,height:e}}function $t(d,u){let r,n;try{if(r=new OffscreenCanvas(d,u),n=r.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),n=r.getContext("2d")}return r.width=d,r.height=u,[r,n]}function Qr(d,u){const{width:r,height:n}=Jr(d.width,d.height),[t,e]=$t(r,n);return u&&/jpe?g/.test(u)&&(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)),e.drawImage(d,0,0,t.width,t.height),t}function Pt(){return Pt.cachedResult!==void 0||(Pt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Pt.cachedResult}function Ft(d,u={}){return new Promise((function(r,n){let t,e;var i=function(){try{return e=Qr(t,u.fileType||d.type),r([t,e])}catch(b){return n(b)}},c=function(b){try{var p=function(o){try{throw o}catch(l){return n(l)}};try{let o;return Yr(d).then((function(l){try{return o=l,Zr(o).then((function(a){try{return t=a,(function(){try{return i()}catch(h){return n(h)}})()}catch(h){return p(h)}}),p)}catch(a){return p(a)}}),p)}catch(o){p(o)}}catch(o){return n(o)}};try{if(Pt()||[Ye.DESKTOP_SAFARI,Ye.MOBILE_SAFARI].includes(gt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(d).then((function(b){try{return t=b,i()}catch{return c()}}),c)}catch{c()}}))}function zt(d,u,r,n,t=1){return new Promise((function(e,i){let c;if(u==="image/png"){let p,o,l;return p=d.getContext("2d"),{data:o}=p.getImageData(0,0,d.width,d.height),l=st.encode([o.buffer],d.width,d.height,4096*t),c=new Blob([l],{type:u}),c.name=r,c.lastModified=n,b.call(this)}{let p=function(){return b.call(this)};if(u==="image/bmp")return new Promise((o=>qr.toBlob(d,o))).then((function(o){try{return c=o,c.name=r,c.lastModified=n,p.call(this)}catch(l){return i(l)}}).bind(this),i);{let o=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&d instanceof OffscreenCanvas)return d.convertToBlob({type:u,quality:t}).then((function(l){try{return c=l,c.name=r,c.lastModified=n,o.call(this)}catch(a){return i(a)}}).bind(this),i);{let l;return l=d.toDataURL(u,t),cr(l,r,n).then((function(a){try{return c=a,o.call(this)}catch(h){return i(h)}}).bind(this),i)}}}function b(){return e(c)}}))}function dt(d){d.width=0,d.height=0}function wt(){return new Promise((function(d,u){let r,n,t,e;return wt.cachedResult!==void 0?d(wt.cachedResult):cr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(i){try{return r=i,Ft(r).then((function(c){try{return n=c[1],zt(n,r.type,r.name,r.lastModified).then((function(b){try{return t=b,dt(n),Ft(t).then((function(p){try{return e=p[0],wt.cachedResult=e.width===1&&e.height===2,d(wt.cachedResult)}catch(o){return u(o)}}),u)}catch(p){return u(p)}}),u)}catch(b){return u(b)}}),u)}catch(c){return u(c)}}),u)}))}function Xr(d){return new Promise(((u,r)=>{const n=new Kr;n.onload=t=>{const e=new DataView(t.target.result);if(e.getUint16(0,!1)!=65496)return u(-2);const i=e.byteLength;let c=2;for(;c<i;){if(e.getUint16(c+2,!1)<=8)return u(-1);const b=e.getUint16(c,!1);if(c+=2,b==65505){if(e.getUint32(c+=2,!1)!=1165519206)return u(-1);const p=e.getUint16(c+=6,!1)==18761;c+=e.getUint32(c+4,p);const o=e.getUint16(c,p);c+=2;for(let l=0;l<o;l++)if(e.getUint16(c+12*l,p)==274)return u(e.getUint16(c+12*l+8,p))}else{if((65280&b)!=65280)break;c+=e.getUint16(c,!1)}}return u(-1)},n.onerror=t=>r(t),n.readAsArrayBuffer(d)}))}function en(d,u){const{width:r}=d,{height:n}=d,{maxWidthOrHeight:t}=u;let e,i=d;return isFinite(t)&&(r>t||n>t)&&([i,e]=$t(r,n),r>n?(i.width=t,i.height=n/r*t):(i.width=r/n*t,i.height=t),e.drawImage(d,0,0,i.width,i.height),dt(d)),i}function tn(d,u){const{width:r}=d,{height:n}=d,[t,e]=$t(r,n);switch(u>4&&u<9?(t.width=n,t.height=r):(t.width=r,t.height=n),u){case 2:e.transform(-1,0,0,1,r,0);break;case 3:e.transform(-1,0,0,-1,r,n);break;case 4:e.transform(1,0,0,-1,0,n);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,n,0);break;case 7:e.transform(0,-1,-1,0,n,r);break;case 8:e.transform(0,-1,1,0,0,r)}return e.drawImage(d,0,0,r,n),dt(d),t}function Nr(d,u,r=0){return new Promise((function(n,t){let e,i,c,b,p,o,l,a,h,f,S,E,j,$,U,M,F,v,z,m;function g(N=5){if(u.signal&&u.signal.aborted)throw u.signal.reason;e+=N,u.onProgress(Math.min(e,100))}function _(N){if(u.signal&&u.signal.aborted)throw u.signal.reason;e=Math.min(Math.max(N,e),100),u.onProgress(e)}return e=r,i=u.maxIteration||10,c=1024*u.maxSizeMB*1024,g(),Ft(d,u).then((function(N){try{return[,b]=N,g(),p=en(b,u),g(),new Promise((function(y,R){var C;if(!(C=u.exifOrientation))return Xr(d).then((function(x){try{return C=x,A.call(this)}catch(w){return R(w)}}).bind(this),R);function A(){return y(C)}return A.call(this)})).then((function(y){try{return o=y,g(),wt().then((function(R){try{return l=R?p:tn(p,o),g(),a=u.initialQuality||1,h=u.fileType||d.type,zt(l,h,d.name,d.lastModified,a).then((function(C){try{{let x=function(){if(i--&&(U>c||U>j)){let B,P;return B=m?.95*z.width:z.width,P=m?.95*z.height:z.height,[F,v]=$t(B,P),v.drawImage(z,0,0,B,P),a*=h==="image/png"?.85:.95,zt(F,h,d.name,d.lastModified,a).then((function(G){try{return M=G,dt(z),z=F,U=M.size,_(Math.min(99,Math.floor(($-U)/($-c)*100))),x}catch(oe){return t(oe)}}),t)}return[1]},w=function(){return dt(z),dt(F),dt(p),dt(l),dt(b),_(100),n(M)};if(f=C,g(),S=f.size>c,E=f.size>d.size,!S&&!E)return _(100),n(f);var A;return j=d.size,$=f.size,U=$,z=l,m=!u.alwaysKeepResolution&&S,(A=(function(B){for(;B;){if(B.then)return void B.then(A,t);try{if(B.pop){if(B.length)return B.pop()?w.call(this):B;B=x}else B=B.call(this)}catch(P){return t(P)}}}).bind(this))(x)}}catch(x){return t(x)}}).bind(this),t)}catch(C){return t(C)}}).bind(this),t)}catch(R){return t(R)}}).bind(this),t)}catch(y){return t(y)}}).bind(this),t)}))}const Fn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Qt;function zn(d,u){return new Promise(((r,n)=>{Qt||(Qt=(function(i){const c=[];return c.push(i),URL.createObjectURL(new Blob(c))})(Fn));const t=new Worker(Qt);t.addEventListener("message",(function(i){if(u.signal&&u.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return n(new Error(i.data.error)),void t.terminate();r(i.data.file),t.terminate()}else u.onProgress(i.data.progress)})),t.addEventListener("error",n),u.signal&&u.signal.addEventListener("abort",(()=>{n(u.signal.reason),t.terminate()})),t.postMessage({file:d,imageCompressionLibUrl:u.libURL,options:{...u,onProgress:void 0,signal:void 0}})}))}function Be(d,u){return new Promise((function(r,n){let t,e,i,c,b,p;if(t={...u},i=0,{onProgress:c}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=h=>{i=h,typeof c=="function"&&c(i)},!(d instanceof Blob||d instanceof In))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(d.type))return n(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||p)return Nr(d,t).then((function(h){try{return e=h,a.call(this)}catch(f){return n(f)}}).bind(this),n);var o=(function(){try{return a.call(this)}catch(h){return n(h)}}).bind(this),l=function(h){try{return Nr(d,t).then((function(f){try{return e=f,o()}catch(S){return n(S)}}),n)}catch(f){return n(f)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",zn(d,t).then((function(h){try{return e=h,o()}catch{return l()}}),l)}catch{l()}function a(){try{e.name=d.name,e.lastModified=d.lastModified}catch{}try{t.preserveExif&&d.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===d.type)&&(e=Gr(d,e))}catch{}return r(e)}}))}Be.getDataUrlFromFile=Yr,Be.getFilefromDataUrl=cr,Be.loadImage=Zr,Be.drawImageInCanvas=Qr,Be.drawFileInCanvas=Ft,Be.canvasToFile=zt,Be.getExifOrientation=Xr,Be.handleMaxWidthOrHeight=en,Be.followExifOrientation=tn,Be.cleanupCanvasMemory=dt,Be.isAutoOrientationInBrowser=wt,Be.approximateBelowMaximumCanvasSizeOfBrowser=Jr,Be.copyExifWithoutOrientation=Gr,Be.getBrowserName=gt,Be.version="2.0.2";var ir=function(d,u){return ir=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])},ir(d,u)};function $n(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");ir(d,u);function r(){this.constructor=d}d.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}var $e=function(){return $e=Object.assign||function(u){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e])}return u},$e.apply(this,arguments)};var Xt,Er;function Wn(){if(Er)return Xt;Er=1;var d=!1,u,r,n,t,e,i,c,b,p,o,l,a,h,f,S;function E(){if(!d){d=!0;var $=navigator.userAgent,U=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec($),M=/(Mac OS X)|(Windows)|(Linux)/.exec($);if(a=/\b(iPhone|iP[ao]d)/.exec($),h=/\b(iP[ao]d)/.exec($),o=/Android/i.exec($),f=/FBAN\/\w+;/i.exec($),S=/Mobile/i.exec($),l=!!/Win64/.exec($),U){u=U[1]?parseFloat(U[1]):U[5]?parseFloat(U[5]):NaN,u&&document&&document.documentMode&&(u=document.documentMode);var F=/(?:Trident\/(\d+.\d+))/.exec($);i=F?parseFloat(F[1])+4:u,r=U[2]?parseFloat(U[2]):NaN,n=U[3]?parseFloat(U[3]):NaN,t=U[4]?parseFloat(U[4]):NaN,t?(U=/(?:Chrome\/(\d+\.\d+))/.exec($),e=U&&U[1]?parseFloat(U[1]):NaN):e=NaN}else u=r=n=e=t=NaN;if(M){if(M[1]){var v=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec($);c=v?parseFloat(v[1].replace("_",".")):!0}else c=!1;b=!!M[2],p=!!M[3]}else c=b=p=!1}}var j={ie:function(){return E()||u},ieCompatibilityMode:function(){return E()||i>u},ie64:function(){return j.ie()&&l},firefox:function(){return E()||r},opera:function(){return E()||n},webkit:function(){return E()||t},safari:function(){return j.webkit()},chrome:function(){return E()||e},windows:function(){return E()||b},osx:function(){return E()||c},linux:function(){return E()||p},iphone:function(){return E()||a},mobile:function(){return E()||a||h||o||S},nativeApp:function(){return E()||f},android:function(){return E()||o},ipad:function(){return E()||h}};return Xt=j,Xt}var er,Ar;function On(){if(Ar)return er;Ar=1;var d=!!(typeof window<"u"&&window.document&&window.document.createElement),u={canUseDOM:d,canUseWorkers:typeof Worker<"u",canUseEventListeners:d&&!!(window.addEventListener||window.attachEvent),canUseViewport:d&&!!window.screen,isInWorker:!d};return er=u,er}var tr,Lr;function Bn(){if(Lr)return tr;Lr=1;var d=On(),u;d.canUseDOM&&(u=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function r(n,t){if(!d.canUseDOM||t&&!("addEventListener"in document))return!1;var e="on"+n,i=e in document;if(!i){var c=document.createElement("div");c.setAttribute(e,"return;"),i=typeof c[e]=="function"}return!i&&u&&n==="wheel"&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i}return tr=r,tr}var rr,Rr;function Hn(){if(Rr)return rr;Rr=1;var d=Wn(),u=Bn(),r=10,n=40,t=800;function e(i){var c=0,b=0,p=0,o=0;return"detail"in i&&(b=i.detail),"wheelDelta"in i&&(b=-i.wheelDelta/120),"wheelDeltaY"in i&&(b=-i.wheelDeltaY/120),"wheelDeltaX"in i&&(c=-i.wheelDeltaX/120),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(c=b,b=0),p=c*r,o=b*r,"deltaY"in i&&(o=i.deltaY),"deltaX"in i&&(p=i.deltaX),(p||o)&&i.deltaMode&&(i.deltaMode==1?(p*=n,o*=n):(p*=t,o*=t)),p&&!c&&(c=p<1?-1:1),o&&!b&&(b=o<1?-1:1),{spinX:c,spinY:b,pixelX:p,pixelY:o}}return e.getEventType=function(){return d.firefox()?"DOMMouseScroll":u("wheel")?"wheel":"mousewheel"},rr=e,rr}var nr,Mr;function Gn(){return Mr||(Mr=1,nr=Hn()),nr}var qn=Gn();const Vn=jn(qn);function Kn(d,u,r,n,t,e){e===void 0&&(e=0);var i=bt(d,u,e),c=i.width,b=i.height,p=Math.min(c,r),o=Math.min(b,n);return p>o*t?{width:o*t,height:o}:{width:p,height:p/t}}function Yn(d){return d.width>d.height?d.width/d.naturalWidth:d.height/d.naturalHeight}function Nt(d,u,r,n,t){t===void 0&&(t=0);var e=bt(u.width,u.height,t),i=e.width,c=e.height;return{x:Tr(d.x,i,r.width,n),y:Tr(d.y,c,r.height,n)}}function Tr(d,u,r,n){var t=u*n/2-r/2;return Wt(d,-t,t)}function Dr(d,u){return Math.sqrt(Math.pow(d.y-u.y,2)+Math.pow(d.x-u.x,2))}function Pr(d,u){return Math.atan2(u.y-d.y,u.x-d.x)*180/Math.PI}function Zn(d,u,r,n,t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);var c=i?Jn:Qn,b=bt(u.width,u.height,e),p=bt(u.naturalWidth,u.naturalHeight,e),o={x:c(100,((b.width-r.width/t)/2-d.x/t)/b.width*100),y:c(100,((b.height-r.height/t)/2-d.y/t)/b.height*100),width:c(100,r.width/b.width*100/t),height:c(100,r.height/b.height*100/t)},l=Math.round(c(p.width,o.width*p.width/100)),a=Math.round(c(p.height,o.height*p.height/100)),h=p.width>=p.height*n,f=h?{width:Math.round(a*n),height:a}:{width:l,height:Math.round(l/n)},S=$e($e({},f),{x:Math.round(c(p.width-f.width,o.x*p.width/100)),y:Math.round(c(p.height-f.height,o.y*p.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:S}}function Jn(d,u){return Math.min(d,Math.max(0,u))}function Qn(d,u){return u}function Xn(d,u,r,n,t,e){var i=bt(u.width,u.height,r),c=Wt(n.width/i.width*(100/d.width),t,e),b={x:c*i.width/2-n.width/2-i.width*c*(d.x/100),y:c*i.height/2-n.height/2-i.height*c*(d.y/100)};return{crop:b,zoom:c}}function es(d,u,r){var n=Yn(u);return r.height>r.width?r.height/(d.height*n):r.width/(d.width*n)}function ts(d,u,r,n,t,e){r===void 0&&(r=0);var i=bt(u.naturalWidth,u.naturalHeight,r),c=Wt(es(d,u,n),t,e),b=n.height>n.width?n.height/d.height:n.width/d.width,p={x:((i.width-d.width)/2-d.x)*b,y:((i.height-d.height)/2-d.y)*b};return{crop:p,zoom:c}}function Ur(d,u){return{x:(u.x+d.x)/2,y:(u.y+d.y)/2}}function rs(d){return d*Math.PI/180}function bt(d,u,r){var n=rs(r);return{width:Math.abs(Math.cos(n)*d)+Math.abs(Math.sin(n)*u),height:Math.abs(Math.sin(n)*d)+Math.abs(Math.cos(n)*u)}}function Wt(d,u,r){return Math.min(Math.max(d,u),r)}function Tt(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return d.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var ns=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,ss=1,os=3,as=1,is=(function(d){$n(u,d);function u(){var r=d!==null&&d.apply(this,arguments)||this;return r.cropperRef=D.createRef(),r.imageRef=D.createRef(),r.videoRef=D.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var n=!0;r.resizeObserver=new window.ResizeObserver(function(t){if(n){n=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(n){return n.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var n=r.computeSizes();n&&(r.previousCropSize=n,r.emitCropData(),r.setInitialCrop(n),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(n){if(r.props.initialCroppedAreaPercentages){var t=Xn(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=t.crop,i=t.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}else if(r.props.initialCroppedAreaPixels){var c=ts(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=c.crop,i=c.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}},r.computeSizes=function(){var n,t,e,i,c,b,p=r.imageRef.current||r.videoRef.current;if(p&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var o=r.containerRect.width/r.containerRect.height,l=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((t=r.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,a=((e=r.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((i=r.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,h=p.offsetWidth<l||p.offsetHeight<a,f=l/a,S=void 0;if(h)switch(r.state.mediaObjectFit){default:case"contain":S=o>f?{width:r.containerRect.height*f,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/f};break;case"horizontal-cover":S={width:r.containerRect.width,height:r.containerRect.width/f};break;case"vertical-cover":S={width:r.containerRect.height*f,height:r.containerRect.height};break}else S={width:p.offsetWidth,height:p.offsetHeight};r.mediaSize=$e($e({},S),{naturalWidth:l,naturalHeight:a}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var E=r.props.cropSize?r.props.cropSize:Kn(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((c=r.state.cropSize)===null||c===void 0?void 0:c.height)!==E.height||((b=r.state.cropSize)===null||b===void 0?void 0:b.width)!==E.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(E),r.setState({cropSize:E},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(E),E}},r.saveContainerPosition=function(){if(r.containerRef){var n=r.containerRef.getBoundingClientRect();r.containerPosition={x:n.left,y:n.top}}},r.onMouseDown=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(u.getMousePoint(n)))},r.onMouseMove=function(n){return r.onDrag(u.getMousePoint(n))},r.onScroll=function(n){r.currentDoc&&(n.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(n){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(n))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),n.touches.length===2?r.onPinchStart(n):n.touches.length===1&&r.onDragStart(u.getTouchPoint(n.touches[0]))))},r.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?r.onPinchMove(n):n.touches.length===1&&r.onDrag(u.getTouchPoint(n.touches[0]))},r.onGestureStart=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(n){if(n.preventDefault(),!r.isTouching){var t=u.getMousePoint(n),e=r.gestureZoomStart-1+n.scale;if(r.setNewZoom(e,t,{shouldUpdatePosition:!0}),r.props.onRotationChange){var i=r.gestureRotationStart+n.rotation;r.props.onRotationChange(i)}}},r.onGestureEnd=function(n){r.cleanEvents()},r.onDragStart=function(n){var t,e,i=n.x,c=n.y;r.dragStartPosition={x:i,y:c},r.dragStartCrop=$e({},r.props.crop),(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t)},r.onDrag=function(n){var t=n.x,e=n.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(t===void 0||e===void 0)){var i=t-r.dragStartPosition.x,c=e-r.dragStartPosition.y,b={x:r.dragStartCrop.x+i,y:r.dragStartCrop.y+c},p=r.props.restrictPosition?Nt(b,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):b;r.props.onCropChange(p)}}))},r.onDragStopped=function(){var n,t;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(t=(n=r.props).onInteractionEnd)===null||t===void 0||t.call(n)},r.onWheel=function(n){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(n))){n.preventDefault();var t=u.getMousePoint(n),e=Vn(n).pixelY,i=r.props.zoom-e*r.props.zoomSpeed/200;r.setNewZoom(i,t,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var c,b;return(b=(c=r.props).onInteractionStart)===null||b===void 0?void 0:b.call(c)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var c,b;return(b=(c=r.props).onInteractionEnd)===null||b===void 0?void 0:b.call(c)})},250)}},r.getPointOnContainer=function(n,t){var e=n.x,i=n.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(e-t.x),y:r.containerRect.height/2-(i-t.y)}},r.getPointOnMedia=function(n){var t=n.x,e=n.y,i=r.props,c=i.crop,b=i.zoom;return{x:(t+c.x)/b,y:(e+c.y)/b}},r.setNewZoom=function(n,t,e){var i=e===void 0?{}:e,c=i.shouldUpdatePosition,b=c===void 0?!0:c;if(!(!r.state.cropSize||!r.props.onZoomChange)){var p=Wt(n,r.props.minZoom,r.props.maxZoom);if(b){var o=r.getPointOnContainer(t,r.containerPosition),l=r.getPointOnMedia(o),a={x:l.x*p-o.x,y:l.y*p-o.y},h=r.props.restrictPosition?Nt(a,r.mediaSize,r.state.cropSize,p,r.props.rotation):a;r.props.onCropChange(h)}r.props.onZoomChange(p)}},r.getCropData=function(){if(!r.state.cropSize)return null;var n=r.props.restrictPosition?Nt(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return Zn(n,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,e),r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.emitCropAreaChange=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.recomputeCropPosition=function(){var n,t;if(r.state.cropSize){var e=r.props.crop;if(r.isInitialized&&(!((n=r.previousCropSize)===null||n===void 0)&&n.width)&&(!((t=r.previousCropSize)===null||t===void 0)&&t.height)){var i=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(i){var c=r.state.cropSize.width/r.previousCropSize.width,b=r.state.cropSize.height/r.previousCropSize.height;e={x:r.props.crop.x*c,y:r.props.crop.y*b}}}var p=r.props.restrictPosition?Nt(e,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):e;r.previousCropSize=r.state.cropSize,r.props.onCropChange(p),r.emitCropData()}},r.onKeyDown=function(n){var t,e,i=r.props,c=i.crop,b=i.onCropChange,p=i.keyboardStep,o=i.zoom,l=i.rotation,a=p;if(r.state.cropSize){n.shiftKey&&(a*=.2);var h=$e({},c);switch(n.key){case"ArrowUp":h.y-=a,n.preventDefault();break;case"ArrowDown":h.y+=a,n.preventDefault();break;case"ArrowLeft":h.x-=a,n.preventDefault();break;case"ArrowRight":h.x+=a,n.preventDefault();break;default:return}r.props.restrictPosition&&(h=Nt(h,r.mediaSize,r.state.cropSize,o,l)),n.repeat||(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t),b(h)}},r.onKeyUp=function(n){var t,e;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}r.emitCropData(),(e=(t=r.props).onInteractionEnd)===null||e===void 0||e.call(t)},r}return u.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=ns,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},u.prototype.componentWillUnmount=function(){var r,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},u.prototype.componentDidUpdate=function(r){var n,t,e,i,c,b,p,o,l;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((n=r.cropSize)===null||n===void 0?void 0:n.height)!==((t=this.props.cropSize)===null||t===void 0?void 0:t.height)||((e=r.cropSize)===null||e===void 0?void 0:e.width)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.width)?this.computeSizes():(((c=r.crop)===null||c===void 0?void 0:c.x)!==((b=this.props.crop)===null||b===void 0?void 0:b.x)||((p=r.crop)===null||p===void 0?void 0:p.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((l=this.videoRef.current)===null||l===void 0||l.load());var a=this.getObjectFit();a!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:a},this.computeSizes)},u.prototype.getAspect=function(){var r=this.props,n=r.cropSize,t=r.aspect;return n?n.width/n.height:t},u.prototype.getObjectFit=function(){var r,n,t,e;if(this.props.objectFit==="cover"){var i=this.imageRef.current||this.videoRef.current;if(i&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,b=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,p=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalHeight)||((e=this.videoRef.current)===null||e===void 0?void 0:e.videoHeight)||0,o=b/p;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},u.prototype.onPinchStart=function(r){var n=u.getTouchPoint(r.touches[0]),t=u.getTouchPoint(r.touches[1]);this.lastPinchDistance=Dr(n,t),this.lastPinchRotation=Pr(n,t),this.onDragStart(Ur(n,t))},u.prototype.onPinchMove=function(r){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var t=u.getTouchPoint(r.touches[0]),e=u.getTouchPoint(r.touches[1]),i=Ur(t,e);this.onDrag(i),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=Dr(t,e),b=n.props.zoom*(c/n.lastPinchDistance);n.setNewZoom(b,i,{shouldUpdatePosition:!1}),n.lastPinchDistance=c;var p=Pr(t,e),o=n.props.rotation+(p-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(o),n.lastPinchRotation=p})}},u.prototype.render=function(){var r=this,n,t=this.props,e=t.image,i=t.video,c=t.mediaProps,b=t.cropperProps,p=t.transform,o=t.crop,l=o.x,a=o.y,h=t.rotation,f=t.zoom,S=t.cropShape,E=t.showGrid,j=t.roundCropAreaPixels,$=t.style,U=$.containerStyle,M=$.cropAreaStyle,F=$.mediaStyle,v=t.classes,z=v.containerClassName,m=v.cropAreaClassName,g=v.mediaClassName,_=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return D.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(y){return r.containerRef=y},"data-testid":"container",style:U,className:Tt("reactEasyCrop_Container",z)},e?D.createElement("img",$e({alt:"",className:Tt("reactEasyCrop_Image",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",g)},c,{src:e,ref:this.imageRef,style:$e($e({},F),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(f,")")}),onLoad:this.onMediaLoad})):i&&D.createElement("video",$e({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Tt("reactEasyCrop_Video",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",g)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:$e($e({},F),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(f,")")}),controls:!1}),(Array.isArray(i)?i:[{src:i}]).map(function(N){return D.createElement("source",$e({key:N.src},N))})),this.state.cropSize&&D.createElement("div",$e({ref:this.cropperRef,style:$e($e({},M),{width:j?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:j?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Tt("reactEasyCrop_CropArea",S==="round"&&"reactEasyCrop_CropAreaRound",E&&"reactEasyCrop_CropAreaGrid",m)},b)))},u.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:os,minZoom:ss,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:as},u.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u})(D.Component);const Oe=[];for(let d=0;d<256;++d)Oe.push((d+256).toString(16).slice(1));function ls(d,u=0){return(Oe[d[u+0]]+Oe[d[u+1]]+Oe[d[u+2]]+Oe[d[u+3]]+"-"+Oe[d[u+4]]+Oe[d[u+5]]+"-"+Oe[d[u+6]]+Oe[d[u+7]]+"-"+Oe[d[u+8]]+Oe[d[u+9]]+"-"+Oe[d[u+10]]+Oe[d[u+11]]+Oe[d[u+12]]+Oe[d[u+13]]+Oe[d[u+14]]+Oe[d[u+15]]).toLowerCase()}let sr;const cs=new Uint8Array(16);function ds(){if(!sr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");sr=crypto.getRandomValues.bind(crypto)}return sr(cs)}const us=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ir={randomUUID:us};function fs(d,u,r){d=d||{};const n=d.random??d.rng?.()??ds();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ls(n)}function hs(d,u,r){return Ir.randomUUID&&!d?Ir.randomUUID():fs(d)}const Fr=50,Dt=d=>{let u=null;if(d.reply_to){const r=Array.isArray(d.reply_to)?d.reply_to[0]:d.reply_to;d.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",d.reply_to_message_id,"reply_to:",d.reply_to,"replyToData:",r),r&&console.log("[normalizeMessage] replyToData.id:",r.id,"replyToData.user_id:",r.user_id,"replyToData.content:",r.content)),r&&r.id&&r.user_id?u={id:r.id,content:r.content||"",user_id:r.user_id,author_name:r.author_name}:d.reply_to_message_id&&r&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",r,"has id:",!!r?.id,"has user_id:",!!r?.user_id)}return{id:d.id,league_id:d.league_id,user_id:d.user_id,content:d.content,created_at:d.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:d.reply_to_message_id??null,reply_to:u}},Et=d=>{const u=new Map;for(const r of d)u.set(r.id,r);return Array.from(u.values()).sort((r,n)=>new Date(r.created_at).getTime()-new Date(n.created_at).getTime())};function ms(d,u={}){const{userId:r,enabled:n=!0,autoSubscribe:t=!0}=u,[e,i]=D.useState([]),[c,b]=D.useState(!1),[p,o]=D.useState(!1),[l,a]=D.useState(!0),[h,f]=D.useState(null),S=D.useRef(null),E=D.useCallback(v=>{i(z=>{const m=v(z);return S.current=m.length?m[0].created_at:null,m})},[]),j=D.useCallback(async({before:v,append:z})=>{if(!d||!n)return;console.log("[fetchPage] Starting fetch for league:",d,"append:",z,"before:",v);const m=ce.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",d).order("created_at",{ascending:!1}).limit(Fr);v&&m.lt("created_at",v);const{data:g,error:_}=await m;if(_)throw console.error("[useMiniLeagueChat] Error fetching messages:",_),_;console.log("[fetchPage] Fetched",g?.length||0,"messages from database");const N=(g??[]).filter(A=>A.reply_to_message_id),y=[...new Set(N.map(A=>A.reply_to_message_id))];console.log("[fetchPage] Found",N.length,"messages with reply_to_message_id, unique reply IDs:",y.length);let R=new Map;if(y.length>0){const{data:A,error:x}=await ce.from("league_messages").select("id, content, user_id").in("id",y);x&&console.error("[useMiniLeagueChat] Error fetching reply messages:",x),!x&&A&&A.forEach(w=>{R.set(w.id,w)})}if(g&&g.length>0){const A=g.filter(x=>x.reply_to_message_id);A.length>0&&(console.log("[fetchPage] Found",A.length,"messages with reply_to_message_id"),A.slice(0,3).forEach(x=>{const w=R.get(x.reply_to_message_id);console.log("[fetchPage] Message",x.id,"reply_to_message_id:",x.reply_to_message_id,"replyData:",w)}))}const C=(g??[]).map(A=>{if(A.reply_to_message_id){const x=R.get(A.reply_to_message_id);x?A.reply_to=x:A.reply_to=null}else A.reply_to=null;return Dt(A)}).reverse();E(A=>Et(z?[...C,...A]:C)),(g??[]).length<Fr?a(!1):z||a(!0)},[d,n,E]),$=D.useCallback(async()=>{if(!d||!n){i([]),a(!0);return}b(!0),f(null),S.current=null;try{await j({append:!1})}catch(v){console.error("[useMiniLeagueChat] Error in refresh:",v),f(v?.message??"Failed to load chat")}finally{b(!1)}},[d,n,j]);D.useEffect(()=>{if(!d||!n){i([]),a(!0);return}let v=!0;if($(),!t)return()=>{v=!1};const z=ce.channel(`league-messages:${d}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${d}`},async g=>{if(!v)return;const{data:_}=await ce.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",g.new.id).single();if(_){if(_.reply_to_message_id){const{data:y}=await ce.from("league_messages").select("id, content, user_id").eq("id",_.reply_to_message_id).single();y&&(_.reply_to=y)}const N=Dt(_);E(y=>y.some(R=>R.id===N.id)?y:Et([...y,N]))}else{console.warn("[useMiniLeagueChat] Failed to fetch full message, using payload data:",g.new.id);const N=Dt(g.new);E(y=>y.some(R=>R.id===N.id)?y:Et([...y,N]))}}).subscribe(),m=()=>{v&&document.visibilityState==="visible"&&$()};return document.addEventListener("visibilitychange",m),()=>{v=!1,document.removeEventListener("visibilitychange",m),ce.removeChannel(z)}},[d,n,t,$,E]);const U=D.useCallback(async()=>{if(!d||!n||!l||p)return;const v=S.current??e[0]?.created_at;if(v){o(!0);try{await j({before:v,append:!0})}catch(z){console.error("[useMiniLeagueChat] Error loading more messages:",z),f(z?.message??"Failed to load more messages")}finally{o(!1)}}},[d,n,l,p,j,e]),M=D.useCallback(async(v,z)=>{if(!d||!r)throw new Error("Missing league or user");const m=v.trim();if(!m)return;const g=hs(),_=`optimistic-${g}`,N={id:_,client_msg_id:g,league_id:d,user_id:r,content:m,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:z??null};E(C=>Et([...C,N]));const{data:y,error:R}=await ce.from("league_messages").insert({league_id:d,user_id:r,content:m,reply_to_message_id:z??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(y&&y.reply_to_message_id){const{data:C}=await ce.from("league_messages").select("id, content, user_id").eq("id",y.reply_to_message_id).single();C&&(y.reply_to=C)}if(R)throw console.error("[useMiniLeagueChat] Error sending message:",R),E(C=>C.map(A=>A.id===_?{...A,status:"error"}:A)),R;if(y){const C=Dt(y);C.client_msg_id=g,E(A=>A.map(x=>x.id===_?{...C,status:"sent",client_msg_id:g}:x))}},[d,r,E]),F=D.useMemo(()=>e.slice(-5),[e]);return{messages:e,previewMessages:F,loading:c,loadingMore:p,hasMore:l,error:h,refresh:$,loadMore:U,sendMessage:M}}const ps={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},gs={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},xs=["","",""],ws=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function bs({author:d,text:u,time:r,isOwnMessage:n,shape:t="single",messageId:e,reactions:i=[],onReactionClick:c,replyTo:b,onMessageClick:p}){const o=n?"text-right":"text-left",l=n?"bg-[#1C8376] text-white":"bg-white text-slate-900",a=n?gs:ps,h="max-w-[80%]",[f,S]=D.useState(!1),[E,j]=D.useState(!1),$=D.useRef(null);D.useEffect(()=>{if(!f)return;const F=z=>{$.current&&!$.current.contains(z.target)&&S(!1)},v=setTimeout(()=>{document.addEventListener("mousedown",F)},100);return()=>{clearTimeout(v),document.removeEventListener("mousedown",F)}},[f]);const U=F=>{e&&c&&c(e,F),S(!1),j(!1)},M=F=>{const v=F.target;v.closest("button")||v.closest("[data-reaction]")||p&&p()};return s.jsxs("div",{className:`inline-block w-fit ${h} min-w-0 relative`,children:[s.jsxs("div",{className:`px-3 py-2 text-sm leading-snug shadow-sm whitespace-normal break-words ${o} ${l} ${a[t]} ${p?"cursor-pointer":""}`,onClick:M,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[d&&!n&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:d}),b&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${n?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-sm`,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[s.jsx("div",{className:"font-medium text-xs mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:b.authorName||"Unknown"}),s.jsx("div",{className:"text-xs line-clamp-2 truncate break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:b.content})]}),s.jsx("div",{style:{wordBreak:"break-word",overflowWrap:"break-word"},children:u}),s.jsx("div",{className:"text-[11px] text-[#DCDCDD] mt-1",children:r})]}),e&&!n&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[f&&s.jsxs("div",{ref:$,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[xs.map(F=>s.jsx("button",{onClick:()=>U(F),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${F}`,children:F},F)),p&&s.jsx("button",{onClick:()=>{S(!1),p()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{S(!1),j(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>S(!f),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),E&&e&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>j(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>j(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 rounded-lg",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:ws.map(F=>s.jsx("button",{onClick:()=>{e&&c&&c(e,F),j(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 flex items-center justify-center text-2xl",title:F,children:F},F))})]})})]}),i.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${n?"justify-end":"justify-start"}`,children:i.map(F=>s.jsxs("button",{onClick:()=>U(F.emoji),className:`px-2 py-0.5 rounded-full text-xs flex items-center gap-1 ${F.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700"}`,children:[s.jsx("span",{children:F.emoji}),s.jsx("span",{children:F.count})]},F.emoji))})]})}function vs({author:d,messages:u,isOwnMessage:r,avatarInitials:n,userId:t,reactions:e,onReactionClick:i,onMessageClick:c}){d==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",r,"messages:",u.length);const b=r?"justify-end":"justify-start",p=t===Br;return s.jsxs("div",{className:`flex items-end gap-3 w-full ${b}`,children:[r?s.jsx("div",{className:"w-10 flex-shrink-0"}):p?s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:Sn,alt:"Volley",className:"w-10 h-10 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-sm font-semibold text-slate-500 flex-shrink-0",children:(n||d.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:u.map((o,l)=>{const a=u.length===1?"single":l===0?"top":l===u.length-1?"bottom":"middle",h=o.messageId||o.id;let f="";if(typeof o.text=="string")f=o.text;else if(typeof o.text=="object"&&o.text!==null){const S=o.text?.props?.children||String(o.text);f=typeof S=="string"?S:String(S)}else f=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${r?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${r?"justify-end":"justify-start"}`,children:[s.jsx(bs,{author:!r&&l===0?d:void 0,text:o.text,time:o.time,isOwnMessage:r,shape:a,messageId:h,reactions:e?.[h]||[],onReactionClick:i,replyTo:o.replyTo,onMessageClick:c?()=>c(h,f,!r&&l===0?d:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function ys({groups:d,reactions:u,onReactionClick:r,onMessageClick:n}){const t=d.filter(e=>e.author==="Unknown");return t.length>0&&(console.error("[ChatThread] RENDERING with",t.length,'groups with "Unknown" author!'),t.forEach((e,i)=>{console.error(`[ChatThread] Group ${i}: id="${e.id}", author="${e.author}", messages=${e.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:d.map((e,i)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[e.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:e.dayLabel}),s.jsx(vs,{author:e.author,avatarInitials:e.avatarInitials,isOwnMessage:e.isOwnMessage,userId:e.userId,messages:e.messages,reactions:u,onReactionClick:r,onMessageClick:n},`${e.id}-${e.author}-${i}`)]},`${e.id}-${e.author}-${i}`))})}const _s=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),js=d=>new Date(d).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),zr=d=>{if(!d)return"?";const u=d.trim().split(/\s+/);return u.length===1?u[0][0]?.toUpperCase()??"?":`${u[0][0]?.toUpperCase()??""}${u[u.length-1][0]?.toUpperCase()??""}`},At=(d,u)=>u?u instanceof Map?u.get(d)??"":u[d]??"":"";function Ss({miniLeagueId:d,memberNames:u,deepLinkError:r}){const{user:n}=Hr(),{messages:t,loading:e,loadingMore:i,hasMore:c,error:b,loadMore:p,sendMessage:o}=ms(d,{userId:n?.id,enabled:!!d}),[l,a]=D.useState(""),[h,f]=D.useState(!1),[S,E]=D.useState({}),[j,$]=D.useState(null),[U,M]=D.useState([]);D.useEffect(()=>{if(!d||!n?.id)return;const I=async()=>{try{const{error:L}=await ce.from("chat_presence").upsert({league_id:d,user_id:n.id,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});L&&console.error("[MiniLeagueChatBeta] Failed to update presence:",L)}catch(L){console.error("[MiniLeagueChatBeta] Failed to update presence:",L)}};I();const T=setInterval(I,1e4);return()=>{clearInterval(T)}},[d,n?.id]);const[F,v]=D.useState(0),z=D.useRef(null),m=D.useRef(null),g=D.useRef(null),[_,N]=D.useState(0),y=D.useCallback(()=>{z.current&&(z.current.scrollTop=z.current.scrollHeight)},[]),R=D.useCallback((I=[0,100,300,500,700])=>{requestAnimationFrame(()=>{I.forEach(T=>{setTimeout(()=>y(),T)})})},[y]);D.useEffect(()=>{if(t.length===0||!n?.id)return;const I=t.map(L=>L.id).filter(L=>!L.startsWith("optimistic-"));if(I.length===0)return;(async()=>{try{const{data:L,error:Q}=await ce.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",I);if(Q){console.error("[MiniLeagueChatBeta] Error loading reactions:",Q),M(ee=>[...ee,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${Q.message}`,timestamp:Date.now()}]);return}const Z={};(L||[]).forEach(ee=>{Z[ee.message_id]||(Z[ee.message_id]={}),Z[ee.message_id][ee.emoji]||(Z[ee.message_id][ee.emoji]={count:0,hasUserReacted:!1}),Z[ee.message_id][ee.emoji].count++,ee.user_id===n.id&&(Z[ee.message_id][ee.emoji].hasUserReacted=!0)});const O={};Object.keys(Z).forEach(ee=>{O[ee]=Object.entries(Z[ee]).map(([te,ae])=>({emoji:te,count:ae.count,hasUserReacted:ae.hasUserReacted}))}),E(O)}catch(L){console.error("[MiniLeagueChatBeta] Error in loadReactions:",L),M(Q=>[...Q,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${L?.message||String(L)}`,timestamp:Date.now()}])}})()},[t,n?.id]),D.useEffect(()=>{if(t.length===0||!n?.id)return;const I=t.map(L=>L.id).filter(L=>!L.startsWith("optimistic-"));if(I.length===0)return;const T=ce.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:Q,error:Z}=await ce.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",I);if(Z){console.error("[MiniLeagueChatBeta] Error reloading reactions:",Z),M(te=>[...te,{id:`reactions-reload-${Date.now()}`,message:`Failed to reload reactions: ${Z.message}`,timestamp:Date.now()}]);return}const O={};(Q||[]).forEach(te=>{O[te.message_id]||(O[te.message_id]={}),O[te.message_id][te.emoji]||(O[te.message_id][te.emoji]={count:0,hasUserReacted:!1}),O[te.message_id][te.emoji].count++,te.user_id===n.id&&(O[te.message_id][te.emoji].hasUserReacted=!0)});const ee={};Object.keys(O).forEach(te=>{ee[te]=Object.entries(O[te]).map(([ae,ie])=>({emoji:ae,count:ie.count,hasUserReacted:ie.hasUserReacted}))}),E(ee)}catch(Q){console.error("[MiniLeagueChatBeta] Error in reaction subscription handler:",Q),M(Z=>[...Z,{id:`reactions-sub-${Date.now()}`,message:`Error updating reactions: ${Q?.message||String(Q)}`,timestamp:Date.now()}])}})()}).subscribe();return()=>{ce.removeChannel(T)}},[t,n?.id]);const C=D.useCallback(async(I,T)=>{if(!n?.id)return;const Q=(S[I]||[]).find(Z=>Z.emoji===T&&Z.hasUserReacted);if(E(Z=>{const O={...Z},ee=O[I]||[];if(Q){const te=ee.map(ae=>ae.emoji===T?{...ae,count:Math.max(0,ae.count-1),hasUserReacted:!1}:ae).filter(ae=>ae.count>0||ae.emoji!==T);te.length===0?delete O[I]:O[I]=te}else ee.find(ae=>ae.emoji===T)?O[I]=ee.map(ae=>ae.emoji===T?{...ae,count:ae.count+1,hasUserReacted:!0}:ae):O[I]=[...ee,{emoji:T,count:1,hasUserReacted:!0}];return O}),Q){const{error:Z}=await ce.from("league_message_reactions").delete().eq("message_id",I).eq("user_id",n.id).eq("emoji",T);Z&&E(O=>{const ee={...O},te=ee[I]||[];return te.find(ie=>ie.emoji===T)?ee[I]=te.map(ie=>ie.emoji===T?{...ie,count:ie.count+1,hasUserReacted:!0}:ie):ee[I]=[...te,{emoji:T,count:1,hasUserReacted:!0}],ee})}else{const{error:Z}=await ce.from("league_message_reactions").upsert({message_id:I,user_id:n.id,emoji:T});Z&&(console.error("[MiniLeagueChatBeta] Error adding reaction:",Z),M(O=>[...O,{id:`reaction-add-${Date.now()}`,message:`Failed to add reaction: ${Z.message}`,timestamp:Date.now()}]),E(O=>{const ee={...O},ae=(ee[I]||[]).map(ie=>ie.emoji===T?{...ie,count:Math.max(0,ie.count-1),hasUserReacted:!1}:ie).filter(ie=>ie.count>0||ie.emoji!==T);return ae.length===0?delete ee[I]:ee[I]=ae,ee}))}},[n?.id,S]);D.useEffect(()=>{t.length>0&&R([0,150,300])},[t.length,R]),D.useEffect(()=>{!l&&m.current&&(m.current.style.height="auto",m.current.style.height="42px")},[l]);const A=D.useCallback((I,T=[0,100,300,500,700])=>{const L=g.current?.offsetHeight||72;if(I>0){const Q=I+L;N(I),z.current&&(z.current.style.paddingBottom=`${Q+8}px`)}else N(0),z.current&&(z.current.style.paddingBottom=`${L+8}px`);R(T)},[R]);D.useEffect(()=>{const I=window.visualViewport;let T=null,L=0,Q=!1;const Z=()=>{if(I){const ie=window.innerHeight,qe=I.height,He=I.offsetTop+qe;return Math.max(0,ie-He)}else return 0},O=()=>{T&&(clearTimeout(T),T=null),T=setTimeout(()=>{const ie=Z();Math.abs(ie-L)<10&&ie>0&&!Q||(L=ie,A(ie))},50)};I&&(I.addEventListener("resize",O),I.addEventListener("scroll",O)),window.addEventListener("resize",O);const ee=()=>{Q=!0,setTimeout(O,50),setTimeout(O,150),setTimeout(O,300),setTimeout(O,500)},te=()=>{Q=!1,setTimeout(O,100)},ae=setTimeout(()=>{m.current&&(m.current.addEventListener("focus",ee),m.current.addEventListener("blur",te))},100);return O(),()=>{T&&clearTimeout(T),clearTimeout(ae),I&&(I.removeEventListener("resize",O),I.removeEventListener("scroll",O)),window.removeEventListener("resize",O),m.current&&(m.current.removeEventListener("focus",ee),m.current.removeEventListener("blur",te))}},[A]),D.useEffect(()=>{if(typeof window>"u")return;const I=()=>{const T=window.visualViewport;let L=0;if(T){const Q=window.innerHeight,Z=T.height,O=T.offsetTop+Z;L=Math.max(0,Q-O)}A(L)};return window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[A]),D.useEffect(()=>{if(z.current&&g.current){const I=g.current.offsetHeight||72;z.current.style.paddingBottom=`${I+8}px`}},[]);const x=()=>{m.current&&m.current.removeAttribute("readonly");const I=()=>{const T=window.visualViewport;let L=0;if(T){const Q=window.innerHeight,Z=T.height,O=T.offsetTop+Z;L=Math.max(0,Q-O)}A(L,[0,100,200,400,600,800])};setTimeout(I,50),setTimeout(I,150),setTimeout(I,300),setTimeout(I,500),R([100,200,400,600])},w=I=>{const T=I.target;!(T.tagName==="A"||T.tagName==="BUTTON"||T.closest("a, button"))&&m.current&&document.activeElement===m.current&&m.current.blur()},B=D.useMemo(()=>{if(!n)return"";const I=n.user_metadata??{};return I.display_name||I.full_name||n.email||""},[n]),P=D.useMemo(()=>{if(!t.length)return[];if(!(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1))return[];let T=null;return t.reduce((Z,O)=>{const ee=O.user_id===n?.id,ie=At(O.user_id,u)||(ee?B:"")||(ee?"You":"Unknown"),qe=ee?void 0:zr(ie),Ne=new Date(O.created_at).toDateString(),Ae=Ne!==T;Ae&&(T=Ne);const be=O.reply_to?At(O.reply_to.user_id,u)||"Unknown":null,ve={id:O.id,text:O.content,time:_s(O.created_at),status:O.status&&O.status!=="sent"?O.status:void 0,messageId:O.id,replyTo:O.reply_to?{id:O.reply_to.id,content:O.reply_to.content,authorName:be||void 0}:null},ye=Z[Z.length-1],Ce=ye?.messages.length>0&&ye.messages[0].messageId?t.find(Le=>Le.id===ye.messages[0].messageId)?.user_id:null;if(ye&&!Ae&&ye.isOwnMessage===ee&&Ce===O.user_id){const Le=ye.id.includes("-")?ye.id.split("-")[0]:ye.id,Se=ye.messages.map(Te=>{const Ve=Te.messageId?t.find(Je=>Je.id===Te.messageId):null;if(Ve?.reply_to){const Je=At(Ve.reply_to.user_id,u)||"Unknown";return{...Te,replyTo:Te.replyTo?{...Te.replyTo,authorName:Je}:null}}return Te}),xe={...ye,id:`${Le}-${ie}`,author:ie,avatarInitials:qe,userId:O.user_id,messages:[...Se,ve]};return[...Z.slice(0,-1),xe]}else return[...Z,{id:`${O.id}-${ie}`,author:ie,avatarInitials:qe,isOwnMessage:ee,userId:O.user_id,dayLabel:Ae?js(O.created_at):void 0,messages:[ve]}]},[]).map(Z=>{const O={...Z},ee=O.messages.map(te=>{const ae=te.messageId?t.find(ie=>ie.id===te.messageId):null;if(ae?.reply_to&&te.replyTo){const ie=At(ae.reply_to.user_id,u)||"Unknown";if(ie!==te.replyTo.authorName)return{...te,replyTo:{...te.replyTo,authorName:ie}}}return te});if(O.author==="Unknown"&&O.messages.length>0&&O.messages[0].messageId){const te=t.find(ae=>ae.id===O.messages[0].messageId);if(te){const ae=At(te.user_id,u);if(ae&&ae!=="Unknown"){const ie=O.id.includes("-")?O.id.split("-")[0]:O.id;return{...O,id:`${ie}-${ae}`,author:ae,avatarInitials:zr(ae),userId:te.user_id,messages:ee}}}}return{...O,messages:ee}})},[B,u,t,n?.id,F]);D.useEffect(()=>{(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1)&&F===0&&v(1)},[u,F]),D.useEffect(()=>{const I=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1,T=P.some(L=>L.author==="Unknown");I&&T&&P.length>0&&(setTimeout(()=>{v(L=>L+1)},50),setTimeout(()=>{v(L=>L+1)},200))},[P,u]);const G=D.useMemo(()=>{const I=P.map(L=>L.author).join(","),T=P.some(L=>L.author==="Unknown");return`chat-${P.length}-${T?"unknown":"resolved"}-${F}-${I.slice(0,50)}`},[P,F]),oe=D.useCallback(async I=>{if(!d||!n?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const L=n.user_metadata?.display_name||n.user_metadata?.full_name||n.email||"User",Q={timestamp:new Date().toISOString(),leagueId:d,senderId:n.id,ok:!1,sent:0,error:"Unknown error"};try{const Z=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:d,senderId:n.id,senderName:L,content:I,activeUserIds:[n.id]})}),O=await Z.json().catch(ee=>(Q.error=`Failed to parse response: ${ee?.message||String(ee)}`,Q.httpStatus=Z.status,{ok:!1,error:"Failed to parse response"}));Object.assign(Q,{ok:O.ok,sent:O.sent||0,recipients:O.recipients||0,message:O.message,error:O.error,details:O.details,httpStatus:Z.status,fullResponse:O})}catch(Z){Q.error=Z?.message||String(Z),Q.exception=!0}finally{try{const Z=JSON.parse(localStorage.getItem("notification_logs")||"[]");Z.push(Q);const O=Z.slice(-50);localStorage.setItem("notification_logs",JSON.stringify(O))}catch(Z){console.error("[MiniLeagueChatBeta] Error storing notification log:",Z),M(O=>[...O,{id:`notif-log-${Date.now()}`,message:`Failed to log notification: ${Z?.message||String(Z)}`,timestamp:Date.now()}])}}},[d,n?.id]),X=D.useCallback(async()=>{const I=l.trim();if(!(!d||!I||h))try{f(!0),a(""),m.current&&(m.current.style.height="auto",m.current.style.height="42px"),await o(I,j?.id||null),await oe(I),$(null),R([0,150,300])}catch(T){console.error("[MiniLeagueChatBeta] Error sending message:",T),M(L=>[...L,{id:`send-${Date.now()}`,message:`Failed to send message: ${T?.message||String(T)}`,timestamp:Date.now()}]),a(I)}finally{f(!1)}},[l,d,oe,R,o,h,j]);return D.useEffect(()=>{r&&M(I=>I.some(T=>T.message.includes("Deep Link"))?I:[...I,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${r}`,timestamp:Date.now()}])},[r]),D.useEffect(()=>{if(U.length===0)return;const I=setTimeout(()=>{M(T=>T.filter(L=>Date.now()-L.timestamp<5e3))},5e3);return()=>clearTimeout(I)},[U]),s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[U.length>0&&s.jsx("div",{className:"px-4 pt-2 space-y-2",children:U.map(I=>s.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[s.jsx("span",{className:"flex-1",children:I.message}),s.jsx("button",{onClick:()=>M(T=>T.filter(L=>L.id!==I.id)),className:"text-red-600 flex-shrink-0",children:""})]},I.id))}),s.jsxs("div",{ref:z,className:"flex-1 overflow-y-auto px-4 py-5",onClick:w,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%"},children:[c&&d&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:p,disabled:i,children:i?"Loading earlier":"Load earlier messages"}),P.length===0&&!e?s.jsx("div",{className:"text-center text-sm text-slate-500 mt-8",children:"Say hi to kick off this chat!"}):s.jsx(ys,{groups:P,reactions:S,onReactionClick:C,onMessageClick:(I,T,L)=>{const Q=t.find(Z=>Z.id===I);if(Q){let Z="";if(typeof T=="string")Z=T;else if(typeof T=="object"&&T!==null){const O=T?.props?.children||String(T);Z=typeof O=="string"?O:String(O)}else Z=String(T);$({id:I,content:Z||Q.content,authorName:L}),setTimeout(()=>{m.current?.focus()},100)}}},G)]}),s.jsxs("div",{ref:g,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:_>0?"fixed":"relative",bottom:_>0?`${_}px`:"0",left:_>0?0:"auto",right:_>0?0:"auto",width:"100%",maxWidth:_>0?"440px":"100%",marginLeft:_>0?"auto":void 0,marginRight:_>0?"auto":void 0,zIndex:_>0?100:"auto",boxShadow:_>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[j&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",j.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:j.content})]}),s.jsx("button",{onClick:()=>$(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:m,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:l,disabled:!d||h,placeholder:d?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",onKeyDown:I=>{if(I.key==="Escape"&&j){$(null),I.preventDefault();return}I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),X())},onChange:I=>{a(I.target.value),m.current&&(m.current.style.height="auto",m.current.style.height=`${Math.min(m.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const T=window.visualViewport;if(T){const L=window.innerHeight,Q=T.height,Z=T.offsetTop+Q,O=L-Z;A(O,[0,100])}})},onFocus:x,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:X,disabled:!d||h||!l.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),b&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[b,"  try again or switch to the classic chat tab."]})]})]})}function ks({winnerName:d,isDraw:u}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:u?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[d," Wins!"]})})})}function Cs({availableGws:d,selectedGw:u,onChange:r,className:n=""}){return d.length<=1?null:s.jsx("div",{className:`flex-1 ${n}`,children:s.jsx("select",{value:u||void 0,onChange:t=>{const e=parseInt(t.target.value,10);r(e)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:d.map(t=>s.jsxs("option",{value:t,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",t]},t))})})}function Ns({showForm:d,onToggle:u}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>u(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${d?"text-slate-600":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>u(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${d?"bg-[#1C8376] text-white shadow-sm":"text-slate-600"}`,children:"Form"})]})}function Es({form:d}){const u=d.slice(-5),r=5-u.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:r}).map((n,t)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${t}`)),u.map((n,t)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${n==="W"?"bg-green-100 text-green-700":n==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n},t))]})}function As({rows:d,members:u,showForm:r,currentUserId:n,loading:t,isLateStartingLeague:e}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),r?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:e?"CP":"OCP"}),u.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[d.map((i,c)=>{const b=i.user_id===n,p=c===d.length-1;return s.jsxs("tr",{className:b?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...p?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:i.name}),r?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(Es,{form:i.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.ocp}),u.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:i.mltPts})]})]},i.user_id)}),t&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!t&&!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function Ls({rows:d,members:u,currentUserId:r,positionChangeKeys:n,isApiTestLeague:t,hasLiveFixtures:e,hasStartingSoonFixtures:i,hasStartedFixtures:c,allFixturesFinished:b,resGw:p}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",t&&e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),t&&!b&&i&&!e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),u.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[d.map((o,l)=>{const a=o.user_id===r,h=l===d.length-1,f=n.has(o.user_id);return s.jsxs("tr",{className:`${a?"flash-user-row":""} ${f?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...h?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:l+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[t&&e&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),t&&!e&&i&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-[50px] pl-1 pr-1 ${t&&e?"pulse-live-score":""}`,children:o.score}),u.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1 ${t&&e?"pulse-live-score":""}`,children:o.unicorns})]},o.user_id)}),!d.length&&s.jsx("tr",{className:"bg-slate-50",children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center bg-slate-50",colSpan:u.length>=3?4:3,children:["No results recorded for GW ",p," yet."]})})]})]})})]})}function Rs(d){const u=kn(),r=encodeURIComponent(d);if(u){const n=`whatsapp://send?text=${r}`;let t=!1,e=!1;try{const i=document.createElement("a");i.href=n,i.style.display="none",document.body.appendChild(i),i.click(),t=!0,setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},100)}catch{}if(!t)try{window.open(n),e=!0}catch{}if(!t&&!e)try{window.location.href=n}catch{window.open(`https://wa.me/?text=${r}`,"_blank")}}else{const n=`https://wa.me/?text=${r}`;try{window.open(n,"_blank")}catch{navigator.clipboard.writeText(d).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+d)})}}}function Ms(d,u){const r=new Date(u.find(l=>l.gw===d)?.kickoff_time||""),n=new Date(r.getTime()-4500*1e3),t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],e=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],i=t[n.getUTCDay()],c=n.getUTCDate(),b=e[n.getUTCMonth()],p=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${d} Predictions Reminder!

DEADLINE: THIS ${i} ${c} ${b}, ${p}:${o} BST

Don't forget!
playtotl.com`}function Ts(d,u){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",d);try{const r=Ms(d,u);console.log("[SubmissionStatusTable] Generated message:",r),Rs(r)}catch(r){console.error("[SubmissionStatusTable] Error in handleShareReminder:",r),alert("Error sharing reminder. Please try again.")}}function $r({members:d,submittedMap:u,picksGw:r,allSubmitted:n,remaining:t,fixtures:e,onShareReminder:i,variant:c="full"}){const b=i||(()=>Ts(r,e)),p=e.map(f=>f.kickoff_time).filter(f=>!!f).map(f=>new Date(f)).filter(f=>!isNaN(f.getTime())),o=p.length>0?new Date(Math.min(...p.map(f=>f.getTime()))):null,l=o?new Date(o.getTime()-4500*1e3):null,a=l?new Date>=l:!1;let h="";if(l){const f=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=f[l.getUTCDay()],j=l.getUTCDate(),$=S[l.getUTCMonth()],U=l.getUTCHours().toString().padStart(2,"0"),M=l.getUTCMinutes().toString().padStart(2,"0");h=`${E} ${j} ${$}, ${U}:${M} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),b()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${a?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),a?"Deadline Passed:":"Deadline:",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((f,S)=>f.name.localeCompare(S.name)).map(f=>{const S=`${f.id}:${r}`,E=!!u.get(S);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:f.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},f.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:n?s.jsxs(s.Fragment,{children:["All ",d.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),b()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-sm ${a?"text-orange-600 font-semibold":"text-slate-600"}`,children:[a?" Deadline Passed:":" Deadline:",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((f,S)=>f.name.localeCompare(S.name)).map(f=>{const S=`${f.id}:${r}`,E=!!u.get(S);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:f.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},f.id)})})]})})]})}function Wr({letter:d,correct:u,unicorn:r,hasSubmitted:n,isLive:t,isOngoing:e,isFinished:i}){let c;return u===!0?t||e?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":i?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":n?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:r?"Correct!":void 0,children:d})}function Ds(d,u){return d==="FINISHED"?"FT":d==="PAUSED"?"HT":d==="IN_PLAY"?u==null?"LIVE":`${u}'`:"LIVE"}function Ps(d){const u=(d||"?").trim().split(/\s+/);return u.length?u.length===1?u[0].slice(0,1).toUpperCase():(u[0][0]+u[u.length-1][0]).toUpperCase():"?"}function Us({fixture:d,picks:u,members:r,outcome:n,liveScore:t,submittedMap:e,picksGw:i,isApiTestLeague:c=!1}){const b=d.home_code||d.home_team||d.home_name||"",p=d.away_code||d.away_team||d.away_name||"",o=yr(b)||d.home_name||d.home_team||"Home",l=yr(p)||d.away_name||d.away_team||"Away",h=(M=>{if(!M)return"";const F=new Date(M);if(isNaN(F.getTime()))return"";const v=String(F.getUTCHours()).padStart(2,"0"),z=String(F.getUTCMinutes()).padStart(2,"0");return`${v}:${z}`})(d.kickoff_time),f=!!(t&&t.status==="IN_PLAY"),S=!!(t&&(t.status==="PAUSED"||t.status==="HALF_TIME"||t.status==="HT")),E=!!(t&&t.status==="FINISHED"),j=f||S;let $=null;c&&t?t.homeScore>t.awayScore?$="H":t.awayScore>t.homeScore?$="A":t.homeScore===t.awayScore&&($="D"):$=n;const U=M=>{const F=u.filter(g=>g.pick===M),v=u.length===r.length&&F.length===r.length,z=4,m=[];for(let g=0;g<F.length;g+=z){const _=F.slice(g,g+z);m.push(_)}return s.jsx("div",{className:"flex flex-col gap-1",children:m.map((g,_)=>s.jsx("div",{className:"flex items-center justify-center",children:g.map((N,y)=>{const R=r.find(w=>w.id===N.user_id),C=Ps(R?.name??"?"),A=e.has(`${N.user_id}:${i}`),x=$&&$===M?!0:null;return v?s.jsx("span",{className:"inline-block",style:{marginLeft:y>0?"-8px":"0",position:"relative",zIndex:y},children:s.jsx(Wr,{letter:C,correct:x,unicorn:x===!0,hasSubmitted:A,isLive:f,isOngoing:j,isFinished:E})},N.user_id):s.jsx(Wr,{letter:C,correct:x,unicorn:x===!0,hasSubmitted:A,isLive:f,isOngoing:j,isFinished:E},N.user_id)})},_))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(f||S)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),E&&!f&&!S&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${j?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(_r,{code:d.home_code||void 0,crest:d.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:t&&(f||S||E)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[t.homeScore," - ",t.awayScore]}):s.jsx("span",{children:h})}),s.jsx(_r,{code:d.away_code||void 0,crest:d.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:l})})]}),t&&(j||E)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${j?"text-red-600":"text-slate-500"}`,children:Ds(t.status,t.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:U("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:U("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:U("A")})})]})]})})}function Or({label:d,fixtures:u,picksByFixture:r,members:n,outcomes:t,liveScores:e,submittedMap:i,picksGw:c,isApiTestLeague:b=!1,isFirstSection:p=!1,hasLiveGames:o=!1,allGamesFinished:l=!1,allSubmitted:a=!1,resultsPublished:h=!1,deadlinePassed:f=!1,whoDidntSubmit:S=[],liveFixturesCount:E,hasStarted:j=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(Cn,{date:d,className:"text-lg font-normal"}),p&&s.jsxs(s.Fragment,{children:[b&&o&&E!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:E}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:u.length})]})]}),b&&l&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),b&&!j&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&a&&h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!b&&a&&!h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&f&&!a&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",S.length>0&&`(${S.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[u.map($=>{try{const U=r.get($.fixture_index)??[],M=t.get($.fixture_index)||null,F=e[$.fixture_index]||null;return s.jsx(Us,{fixture:$,picks:U,members:n,outcome:M,liveScore:F,submittedMap:i,picksGw:c,isApiTestLeague:b},`${$.gw}-${$.fixture_index}`)}catch(U){return console.error("Error rendering fixture:",U,$),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",$.fixture_index]},`${$.gw}-${$.fixture_index}`)}}),!u.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const or=8;function ar(d){return d.result==="H"||d.result==="D"||d.result==="A"?d.result:typeof d.home_goals=="number"&&typeof d.away_goals=="number"?d.home_goals>d.away_goals?"H":d.home_goals<d.away_goals?"A":"D":null}function Fs(){const{code:d=""}=Nn(),[u,r]=En(),{user:n}=Hr(),[t]=D.useState(()=>{const k=localStorage.getItem("oldSchoolMode");return k?JSON.parse(k):!1});D.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(t))},[t]),D.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const k=()=>{const K=document.querySelector(".league-header-fixed");if(K){const le=K.style.top||window.getComputedStyle(K).top;le!=="0px"&&le!=="0"&&(K.style.top="0",K.style.transform="translate3d(0, 0, 0)")}},W=()=>{k(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},H=K=>{const le=K.target;le.closest(".league-content-wrapper")||le.closest(".league-header-fixed")||le.closest(".chat-tab-wrapper")||K.preventDefault()};window.addEventListener("scroll",W,{passive:!0}),document.addEventListener("touchmove",H,{passive:!1});const q=setInterval(k,100);return k(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",W),document.removeEventListener("touchmove",H),clearInterval(q)}},[]),D.useEffect(()=>{const k=H=>{const q=H.target;(q.tagName==="INPUT"||q.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const K=document.querySelector(".league-header-fixed");K&&(K.style.top="0")},100)},W=()=>{const H=document.querySelector(".league-header-fixed");H&&(H.style.top="0")};return document.addEventListener("focusin",k),window.addEventListener("resize",W),window.addEventListener("orientationchange",W),()=>{document.removeEventListener("focusin",k),window.removeEventListener("resize",W),window.removeEventListener("orientationchange",W)}},[]),D.useEffect(()=>{if(typeof window>"u")return;const k=window.visualViewport;if(!k)return;let W=null;const H=()=>{const K=F.current;if(!K)return;const le=k.offsetTop??0;K.style.setProperty("transform",`translate3d(0, ${le}px, 0)`,"important")},q=()=>{W&&cancelAnimationFrame(W),W=window.requestAnimationFrame(H)};return q(),k.addEventListener("resize",q),k.addEventListener("scroll",q),()=>{W&&cancelAnimationFrame(W),k.removeEventListener("resize",q),k.removeEventListener("scroll",q),F.current&&F.current.style.removeProperty("transform")}},[]);const[e,i]=D.useState(null),[c,b]=D.useState(!1),[p,o]=D.useState([]),[l,a]=D.useState(!0),h="chat",[f,S]=D.useState(h),[E,j]=D.useState(null),$=D.useRef(f);D.useEffect(()=>{$.current=f},[f]);const U=D.useRef(!1),M=D.useRef(!1);D.useEffect(()=>{const k=u.get("tab"),W=u.get("leagueCode");if(j(null),k==="chat"||W){if(W&&d!==W){j(`Deep link mismatch: URL has leagueCode=${W} but we're on league ${d}. Current URL: ${window.location.href}`);return}if(k==="chat"){f!=="chat"&&(S("chat"),setTimeout(()=>{$.current!=="chat"&&j(`Failed to open chat tab. Current tab: ${$.current}, Expected: chat. URL: ${window.location.href}`)},300));const H=setTimeout(()=>{r({},{replace:!0})},200);return()=>clearTimeout(H)}}(k==="chat"||W)&&console.log("[Deep Link] URL params:",{urlTab:k,urlLeagueCode:W,currentCode:d,currentTab:f,fullUrl:window.location.href})},[u,r,f,d]);const F=D.useRef(null),[v,z]=D.useState(!1),[m,g]=D.useState(!1),[_,N]=D.useState(!1),[y,R]=D.useState(null),[C,A]=D.useState(null),[x,w]=D.useState(null),[B,P]=D.useState([]),G=D.useRef({}),oe=D.useRef({}),X=D.useRef(new Map),[I,T]=D.useState(new Set),[L,Q]=D.useState(!1),[Z,O]=D.useState(!1),[ee,te]=D.useState(0),[ae,ie]=D.useState(!1),[qe,He]=D.useState(!1),[Ne,Ae]=D.useState(!1),[be,ve]=D.useState(!1),[ye,Ce]=D.useState(null),[Me,Le]=D.useState(!1),[Se,xe]=D.useState(null),[Te,Ve]=D.useState({x:0,y:0}),[Je,Ue]=D.useState(1),[Qe,Fe]=D.useState(null),[De,ze]=D.useState(null),[tt,Ke]=D.useState(!1),[ut,mt]=D.useState(!1),[vt,xt]=D.useState(!1),[pt,Xe]=D.useState(!1),[Ot,et]=D.useState(!1),[ot,at]=D.useState(!1),[it,yt]=D.useState(null),[rt,lt]=D.useState(!1),[Bt,dr]=D.useState(!1),[_t,rn]=D.useState(null),ct=D.useMemo(()=>!!n?.id&&p.some(k=>k.id===n.id),[n?.id,p]),ur=D.useMemo(()=>!!n?.id&&!!_t&&_t.id===n.id,[n?.id,_t]),nn=D.useMemo(()=>_t?.name??"League admin",[_t]),sn=D.useMemo(()=>{const k=new Map;return p.forEach(W=>k.set(W.id,W.name)),k.set(Br,An),k},[p]),fr=D.useCallback(()=>{if(!e?.code||typeof window>"u"||typeof navigator>"u")return;const k=`Join my mini league "${e.name}" on TotL!`,W=`${window.location.origin}/league/${e.code}`,H=navigator;if(typeof H.share=="function"){H.share({title:`Join ${e.name}`,text:k,url:W}).catch(K=>{console.warn("[League] Share cancelled",K)});return}const q=`${k}
${W}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(q).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",e.code)}):window.prompt?.("Share this league code:",e.code)},[e]),on=D.useCallback(async()=>{if(!(!e?.id||!n?.id)){N(!0);try{const{error:k}=await ce.from("league_members").delete().eq("league_id",e.id).eq("user_id",n.id);if(k)throw k;typeof window<"u"&&(window.location.href="/leagues")}catch(k){console.error("[League] Error leaving league:",k),typeof window<"u"&&window.alert?.(k?.message??"Failed to leave league. Please try again.")}finally{N(!1),g(!1)}}},[e?.id,n?.id]),an=D.useCallback(async()=>{if(!(!e?.id||!n?.id)){xt(!0);try{if(p.length>=or){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),mt(!1);return}const{error:k}=await ce.from("league_members").insert({league_id:e.id,user_id:n.id});if(k)throw k;const W=n.user_metadata?.display_name||n.email||"Someone";try{const H=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:e.id,userId:n.id,userName:W})}),q=await H.text();let K;try{K=q?JSON.parse(q):{error:"Empty response body"}}catch(le){console.error("[League] Failed to parse notification response. Status:",H.status,"Text:",q,"Error:",le),K={error:"Invalid JSON response",status:H.status,raw:q.substring(0,200)}}H.ok?console.log("[League] Join notification sent:",JSON.stringify({sent:K.sent,recipients:K.recipients,ok:K.ok,breakdown:K.breakdown},null,2)):console.error("[League] Notification function returned error:",H.status,K)}catch(H){console.error("[League] Error sending join notification:",H)}typeof window<"u"&&window.location.reload()}catch(k){console.error("[League] Error joining league:",k),typeof window<"u"&&window.alert?.(k?.message??"Failed to join league.")}finally{xt(!1)}}},[e?.id,n?.id,p.length]),ln=D.useCallback(async()=>{if(!(!it||!e?.id||!n?.id)){lt(!0);try{const{error:k}=await ce.from("league_members").delete().eq("league_id",e.id).eq("user_id",it.id);if(k)throw k;typeof window<"u"&&window.location.reload()}catch(k){console.error("[League] Error removing member:",k),typeof window<"u"&&window.alert?.(k?.message??"Failed to remove member.")}finally{lt(!1),et(!1),yt(null)}}},[e?.id,it,n?.id]),cn=D.useCallback(async()=>{if(!(!e?.id||!n?.id)){dr(!0);try{const{error:k}=await ce.from("league_members").delete().eq("league_id",e.id);if(k)throw k;const{error:W}=await ce.from("leagues").delete().eq("id",e.id);if(W)throw W;typeof window<"u"&&(window.location.href="/leagues")}catch(k){console.error("[League] Error ending league:",k),typeof window<"u"&&window.alert?.(k?.message??"Failed to end league.")}finally{dr(!1),at(!1)}}},[e?.id,n?.id]),dn=k=>new Promise((W,H)=>{const q=new Image;q.addEventListener("load",()=>W(q)),q.addEventListener("error",K=>H(K)),q.src=k}),hr=async(k,W)=>{const H=await dn(k),q=document.createElement("canvas"),K=q.getContext("2d");if(!K)throw new Error("No 2d context");return q.width=W.width,q.height=W.height,K.drawImage(H,W.x,W.y,W.width,W.height,0,0,W.width,W.height),new Promise((le,re)=>{q.toBlob(pe=>{if(!pe){re(new Error("Canvas is empty"));return}le(pe)},"image/jpeg",.9)})},un=D.useCallback(k=>{if(!e?.id||!ct){Ce("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(k.type)){Ce("Please upload a PNG, JPG, or WebP image.");return}const H=20*1024*1024;if(k.size>H){Ce("Please choose an image smaller than 20MB.");return}if(k.size>5*1024*1024&&console.log(`[League] Processing large image (${(k.size/1024/1024).toFixed(1)}MB) - will be optimized automatically`),Ce(null),Le(!1),k.size>5*1024*1024)Be(k,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(q=>{const K=new FileReader;K.onload=()=>{xe(K.result)},K.readAsDataURL(q)}).catch(q=>{console.error("[League] Error pre-compressing image:",q),Ce("Failed to process image. Please try a smaller file.")});else{const q=new FileReader;q.onload=()=>{xe(q.result)},q.readAsDataURL(k)}},[ct,e?.id]),fn=D.useCallback(async(k,W)=>{if(Fe(W),Se)try{const H=await hr(Se,W),q=URL.createObjectURL(H);ze(q)}catch(H){console.error("[League] Error creating preview:",H)}},[Se]),hn=D.useCallback(async()=>{if(!(!Se||!Qe||!e?.id||!ct)){Ce(null),Le(!1),ve(!0);try{const k=await hr(Se,Qe),W=new File([k],"badge.jpg",{type:"image/jpeg"}),H=await Be(W,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(H.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const q=`${e.id}-${Date.now()}.jpg`,{error:K}=await ce.storage.from("league-avatars").upload(q,H,{cacheControl:"3600",upsert:!0,contentType:H.type});if(K)throw K;const{data:le}=ce.storage.from("league-avatars").getPublicUrl(q),re=le?.publicUrl;if(!re)throw new Error("Unable to get public URL for badge.");const{error:pe}=await ce.from("leagues").update({avatar:re}).eq("id",e.id);if(pe)throw pe;i(Ee=>Ee&&{...Ee,avatar:re}),Le(!0),De&&URL.revokeObjectURL(De),xe(null),ze(null),Ae(!1),n?.id&&(Yt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:re}})))}catch(k){console.error("[League] Error uploading badge:",k),Ce(k?.message??"Failed to upload badge. Please try again.")}finally{ve(!1)}}},[Se,Qe,ct,e?.id,n?.id]),mn=D.useCallback(async()=>{if(!(!e?.id||!ct)){Ce(null),Le(!1),ve(!0);try{const{error:k}=await ce.from("leagues").update({avatar:null}).eq("id",e.id);if(k)throw k;i(W=>W&&{...W,avatar:null}),Le(!0),n?.id&&(Yt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:null}})))}catch(k){console.error("[League] Error removing badge:",k),Ce(k?.message??"Failed to remove badge. Please try again.")}finally{ve(!1)}}},[ct,e?.id]),[mr,pn]=D.useState(new Map);D.useEffect(()=>{(async()=>{const k=new Map,{data:W}=await ce.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:H}=await ce.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),q=new Map;if(W&&W.forEach(K=>{(!q.has(K.gw)||K.kickoff_time&&new Date(K.kickoff_time)<new Date(q.get(K.gw)))&&K.kickoff_time&&q.set(K.gw,K.kickoff_time)}),H&&H.length>0){const K=H.find(le=>le.kickoff_time)?.kickoff_time;if(K){const le=q.get(1);(!le||new Date(K)<new Date(le))&&q.set(1,K)}}q.forEach((K,le)=>{const re=new Date(K),pe=new Date(re.getTime()-4500*1e3);k.set(le,pe)}),pn(k)})()},[]),D.useEffect(()=>{const k=W=>{const H=W.target;L&&!H.closest(".gw-dropdown-container")&&Q(!1)};return L&&document.addEventListener("click",k),()=>document.removeEventListener("click",k)},[L]),D.useEffect(()=>{let k=!0;return(async()=>{const{data:W}=await ce.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!k)return;R(W?.current_gw??null);const{data:H}=await ce.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!k)return;A(H&&H.length?H[0].gw:null);const{data:q}=await ce.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!k)return;const K=q?[...new Set(q.map(re=>re.gw))].sort((re,pe)=>pe-re):[],le=W?.current_gw;le&&!K.includes(le)&&K.unshift(le),P(K),K.length>0&&!x&&w(K[0])})(),()=>{k=!1}},[ee]);const gn=D.useMemo(()=>p.map(k=>k.id).sort().join(","),[p]),ft=D.useMemo(()=>p.map(k=>k.id),[gn]),[Re,pr]=D.useState([]),[jt,Ht]=D.useState([]),[Gt,qt]=D.useState([]),[Lt,Vt]=D.useState([]),St=D.useRef(""),gr=D.useRef(0),xr=D.useMemo(()=>{const k=Re?.length||0;if(k===gr.current&&St.current&&(Re?.map(q=>q.api_match_id).filter(q=>q!=null).sort().join(",")||"")===St.current)return St.current;if(gr.current=k,!Re||Re.length===0)return St.current="","";const W=Re.map(H=>H.api_match_id).filter(H=>H!=null).sort().join(",");return St.current=W,W},[Re]),Rt=D.useMemo(()=>e?.name==="API Test",[e?.name]),[nt,wr]=D.useState(null);D.useEffect(()=>{if(!Rt){wr(null);return}let k=!0;return(async()=>{const{data:W}=await ce.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let H=W?.current_test_gw??1;if(H&&H!==1){const{data:q}=await ce.from("app_fixtures").select("gw").eq("gw",H).limit(1).maybeSingle();if(!q){const{data:K}=await ce.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();K&&(H=1)}}k&&wr(H)})(),()=>{k=!1}},[Rt]);const xn=D.useMemo(()=>Rt&&nt!==null?nt:y||x||void 0,[Rt,nt,y,x]),Kt=D.useRef({key:"",array:void 0}),wn=D.useMemo(()=>{const k=xr||"";if(Kt.current.key===k)return Kt.current.array;const W=k?k.split(",").map(H=>parseInt(H,10)).filter(H=>!isNaN(H)):void 0;return Kt.current={key:k,array:W},W},[xr]),{liveScores:br}=Ln(xn,wn),Ge=D.useMemo(()=>{const k={};if(!Re||Re.length===0)return Object.keys(oe.current).length===0?oe.current:(oe.current=k,k);Re.forEach(le=>{const re=le.api_match_id;if(re){const pe=br.get(re);pe&&(k[le.fixture_index]={homeScore:pe.home_score??0,awayScore:pe.away_score??0,status:pe.status||"SCHEDULED",minute:pe.minute??null})}});const W=oe.current,H=Object.keys(k).map(Number),q=Object.keys(W).map(Number);if(H.length!==q.length)return oe.current=k,k;let K=!1;for(const le of H){const re=k[le],pe=W[le];if(!pe||re.homeScore!==pe.homeScore||re.awayScore!==pe.awayScore||re.status!==pe.status||re.minute!==pe.minute){K=!0;break}}return K?(oe.current=k,k):W},[br,Re]),[vr,kt]=D.useState([]),[bn,Ct]=D.useState(!1);D.useEffect(()=>{let k=!0;return(async()=>{a(!0);const{data:W}=await ce.from("leagues").select("id,name,code,created_at,avatar").eq("code",d).maybeSingle();if(!k)return;if(!W){i(null),o([]),a(!1);return}i(W);const{data:H}=await ce.from("league_members").select("users(id,name),created_at").eq("league_id",W.id).order("created_at",{ascending:!0}),q=H?.map(re=>({id:re.users.id,name:re.users.name??"(no name)"}))??[],K=[...q].sort((re,pe)=>re.name.localeCompare(pe.name));o(K);const le=q[0];rn(le),n?.id&&!q.some(re=>re.id===n.id)&&mt(!0),a(!1)})(),()=>{k=!1}},[d]),D.useEffect(()=>{},[e,f]),D.useEffect(()=>{if(f!=="chat"||!e?.id||!n?.id)return;(async()=>{await ce.from("league_message_reads").upsert({league_id:e.id,user_id:n.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),Yt(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:e.id,userId:n.id}}))})()},[f,e?.id,n?.id]),D.useEffect(()=>{let k=!0;return(async()=>{const W=e?.name==="API Test";let H=nt??1;if(W){const{data:de}=await ce.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(H=de?.current_test_gw??1,H&&H!==1){const{data:fe}=await ce.from("app_fixtures").select("gw").eq("gw",H).limit(1).maybeSingle();if(fe)console.log("[League] Using current_test_gw from meta:",H);else{const{data:we}=await ce.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();we&&(H=1,console.log("[League] No fixtures for current_test_gw, falling back to GW T1"))}}else console.log("[League] Using GW T1 or current_test_gw:",H)}const q=W&&(f==="gw"||f==="gwr");console.log("[League] Data fetch:",{isApiTestLeague:W,tab:f,useTestFixtures:q,leagueName:e?.name,testGwForData:H,willUseTestTables:q,willUseMainTables:!q});let K=f==="gwr"?M.current?x:y||x:y;if(W&&(f==="gw"||f==="gwr")&&(K=H),console.log("[League] gwForData calculation:",{tab:f,manualGwSelected:M.current,selectedGw:x,currentGw:y,gwForData:K,isApiTestLeague:W}),f==="gw"&&!W&&ft.length>0){const{data:de}=await ce.from("app_gw_submissions").select("gw").in("user_id",ft).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(de&&de.length>0){const fe=[...new Set(de.map(we=>we.gw))].sort((we,Y)=>(Y||0)-(we||0));for(const we of fe)if(we){const{data:Y}=await ce.from("app_fixtures").select("gw").eq("gw",we).limit(1);if(Y&&Y.length>0){console.log("[League] Found fixtures for GW",we,"from submissions - using this GW (currentGw was",K,")"),K=we;break}}}!K&&y&&(K=y,console.log("[League] Using currentGw as fallback:",y))}if(console.log("[League] gwForData:",K,"memberIds:",ft),!K&&!q){pr([]),Ht([]),qt([]),Vt([]);return}let le;if(q){const{data:de}=await ce.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",H).order("fixture_index",{ascending:!0});le=de?.map(fe=>({...fe,gw:fe.test_gw}))||null}else{console.log("[League] Fetching from MAIN database table (app_fixtures) for regular league, GW:",K);const{data:de}=await ce.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",K).order("fixture_index",{ascending:!0});le=de||null,console.log("[League] Fetched fixtures from main database:",de?.length||0,"fixtures")}if(!k)return;if(pr(de=>{const fe=le??[];return de.length!==fe.length?fe:de.length===0&&fe.length===0?de:de.some((Y,ne)=>!fe[ne]||Y.id!==fe[ne].id||Y.fixture_index!==fe[ne].fixture_index)||fe.some((Y,ne)=>!de[ne]||Y.id!==de[ne].id||Y.fixture_index!==de[ne].fixture_index)?fe:de}),!ft.length){Ht([]),qt([]),Vt([]);return}let re=null,pe;if(q){const{data:de}=await ce.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",H).in("user_id",ft);re=de?.map(V=>({...V,gw:V.matchday}))||null;const{data:fe,error:we}=await ce.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",H).not("submitted_at","is",null).in("user_id",ft);we&&console.error("Error fetching test_api_submissions:",we);const{data:Y}=await ce.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",H).order("fixture_index",{ascending:!0}),ne=new Set((Y||[]).map(V=>V.fixture_index));console.log("[League] Current fixture indices from test_api_fixtures:",Array.from(ne)),console.log("[League] Current fixtures:",Y?.map(V=>({index:V.fixture_index,home:V.home_team,away:V.away_team})));const J=[];if(fe&&re&&Y){const V=ne.size;console.log("[League] Required fixture count for valid submission:",V);const he=(Y||[]).map(se=>se.kickoff_time?new Date(se.kickoff_time):null).filter(se=>se!==null&&!isNaN(se.getTime())),ue=he.length>0?new Date(Math.min(...he.map(se=>se.getTime()))):null,_e=new Date("2025-11-18T00:00:00Z");console.log("[League] Submission cutoff date (submissions before this are old):",_e.toISOString()),console.log("[League] Earliest kickoff:",ue?.toISOString()),fe.forEach(se=>{const ke=(re||[]).filter(Pe=>Pe.user_id===se.user_id&&Pe.matchday===H),ge=ke.filter(Pe=>ne.has(Pe.fixture_index)),me=ge.length===V&&V>0,je=new Set(ge.map(Pe=>Pe.fixture_index)),Ze=je.size===V,ht=se.submitted_at?new Date(se.submitted_at):null,Ie=ht&&ht>=_e;if(me&&Ze&&Ie)J.push(se),console.log("[League]  VALID submission (has picks for ALL current fixtures AND recent submission):",{user_id:se.user_id,submitted_at:se.submitted_at,submissionDate:ht?.toISOString(),cutoffDate:_e.toISOString(),picksCount:ke.length,picksForCurrentFixtures:ge.length,uniqueIndices:je.size,requiredCount:V});else{const Pe=[];me||Pe.push("missing picks"),Ze||Pe.push("duplicate/extra picks"),Ie||Pe.push(`old submission (${ht?.toISOString()} < ${_e.toISOString()})`),console.log("[League]  INVALID submission:",{user_id:se.user_id,submitted_at:se.submitted_at,submissionDate:ht?.toISOString(),cutoffDate:_e.toISOString(),picksCount:ke.length,picksForCurrentFixtures:ge.length,uniqueIndices:je.size,requiredCount:V,hasAllRequired:me,hasExactMatch:Ze,isRecent:Ie,reason:Pe.join(", ")})}})}pe=J.map(V=>({...V,gw:V.matchday}))||null,console.log("[League] Test API submissions fetched (filtered to only current fixtures):",pe),console.log("[League] Valid submissions count:",J.length,"out of",fe?.length||0,"total")}else{console.log("[League] Fetching from MAIN database tables (picks, gw_submissions) for regular league");const{data:de}=await ce.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",K).in("user_id",ft);re=de,console.log("[League] Fetched picks from main database:",de?.length||0,"picks");const{data:fe}=await ce.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",K).in("user_id",ft);pe=fe,console.log("[League] Fetched submissions from main database:",fe?.length||0,"submissions")}if(!k)return;Ht(de=>{const fe=re??[];if(de.length!==fe.length)return fe;if(de.length===0&&fe.length===0)return de;const we=JSON.stringify(de.sort((ne,J)=>ne.fixture_index-J.fixture_index)),Y=JSON.stringify(fe.sort((ne,J)=>ne.fixture_index-J.fixture_index));return we===Y?de:fe}),qt(de=>{const fe=pe??[];if(de.length!==fe.length)return fe;if(de.length===0&&fe.length===0)return de;const we=JSON.stringify(de),Y=JSON.stringify(fe);return we===Y?de:fe});const{data:Ee}=await ce.from("app_gw_results").select("gw,fixture_index,result").eq("gw",q?1:K||0);k&&Vt(de=>{const fe=Ee??[];if(de.length!==fe.length)return fe;if(de.length===0&&fe.length===0)return de;const we=JSON.stringify(de.sort((ne,J)=>ne.fixture_index-J.fixture_index)),Y=JSON.stringify(fe.sort((ne,J)=>ne.fixture_index-J.fixture_index));return we===Y?de:fe})})(),()=>{k=!1}},[f,y,C,x,ft]),D.useEffect(()=>{G.current=Ge},[Ge]);const We=D.useMemo(()=>{const k=new Map;return console.log("[League] Building submittedMap from subs:",Gt),Gt.forEach(W=>{if(W.submitted_at){const H=`${W.user_id}:${W.gw}`;console.log(`[League] Adding submission key: ${H}`,W),k.set(H,!0)}else console.log("[League] Skipping submission with null submitted_at:",W)}),console.log("[League] Final submittedMap:",Array.from(k.entries())),k},[Gt]),Mt=D.useCallback(k=>k.map(W=>({user_id:W.id,name:W.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);D.useEffect(()=>{const k=ce.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{te(W=>W+1)}).subscribe();return()=>{ce.removeChannel(k)}},[]),D.useEffect(()=>{let k=!0;return(async()=>{if(!p.length){kt([]);return}if(e?.name==="API Test"){kt(Mt(p)),Ct(!1);return}if(y===null)return;Ct(!0);const{data:W}=await ce.from("app_gw_results").select("gw,fixture_index,result"),H=W??[],q=new Map;if(H.forEach(se=>{const ke=ar(se);ke&&q.set(`${se.gw}:${se.fixture_index}`,ke)}),q.size===0){kt(Mt(p)),Ct(!1);return}const K=[...new Set(Array.from(q.keys()).map(se=>parseInt(se.split(":")[0],10)))].sort((se,ke)=>se-ke),le=["Prem Predictions","FC Football","Easy League"],re=["The Bird league"],pe=await Rn(e,y);let Ee=K.filter(se=>se>=pe);if(y!==null&&Ee.includes(y)){const{data:se}=await ce.from("app_fixtures").select("fixture_index").eq("gw",y),ke=se?.length??0,ge=Array.from(q.keys()).filter(me=>parseInt(me.split(":")[0],10)===y).length;ke>0&&ge<ke&&(Ee=Ee.filter(me=>me<y))}else y!==null&&(Ee=Ee.filter(se=>se<y));if(!le.includes(e?.name||"")&&!re.includes(e?.name||"")&&Ee.length===0){kt(Mt(p)),Ct(!1);return}const{data:de}=await ce.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",p.map(se=>se.id)).in("gw",Ee),fe=de??[],we=new Map;Ee.forEach(se=>{const ke=new Map;p.forEach(ge=>ke.set(ge.id,{user_id:ge.id,score:0,unicorns:0})),we.set(se,ke)}),Ee.forEach(se=>{Array.from(q.entries()).filter(([ge])=>parseInt(ge.split(":")[0],10)===se).map(([ge,me])=>({idx:parseInt(ge.split(":")[1],10),out:me})).forEach(({idx:ge,out:me})=>{const je=fe.filter(Ie=>Ie.gw===se&&Ie.fixture_index===ge),Ze=je.filter(Ie=>Ie.pick===me).map(Ie=>Ie.user_id),ht=we.get(se);if(je.forEach(Ie=>{if(Ie.pick===me){const Pe=ht.get(Ie.user_id);Pe.score+=1}}),Ze.length===1&&p.length>=3){const Ie=Ze[0],Pe=ht.get(Ie);Pe.unicorns+=1}})});const Y=new Map,ne=new Map,J=new Map,V=new Map,he=new Map,ue=new Map;p.forEach(se=>{Y.set(se.id,0),ne.set(se.id,0),J.set(se.id,0),V.set(se.id,0),he.set(se.id,0),ue.set(se.id,[])}),Ee.forEach(se=>{const ke=Array.from(we.get(se).values());if(ke.forEach(je=>{ne.set(je.user_id,(ne.get(je.user_id)??0)+je.score),J.set(je.user_id,(J.get(je.user_id)??0)+je.unicorns)}),ke.sort((je,Ze)=>Ze.score-je.score||Ze.unicorns-je.unicorns),!ke.length)return;const ge=ke[0],me=ke.filter(je=>je.score===ge.score&&je.unicorns===ge.unicorns);me.length===1?(Y.set(ge.user_id,(Y.get(ge.user_id)??0)+3),V.set(ge.user_id,(V.get(ge.user_id)??0)+1),ue.get(ge.user_id).push("W"),ke.slice(1).forEach(je=>ue.get(je.user_id).push("L"))):(me.forEach(je=>{Y.set(je.user_id,(Y.get(je.user_id)??0)+1),he.set(je.user_id,(he.get(je.user_id)??0)+1),ue.get(je.user_id).push("D")}),ke.filter(je=>!me.find(Ze=>Ze.user_id===je.user_id)).forEach(je=>ue.get(je.user_id).push("L")))});const _e=p.map(se=>({user_id:se.id,name:se.name,mltPts:Y.get(se.id)??0,ocp:ne.get(se.id)??0,unicorns:J.get(se.id)??0,wins:V.get(se.id)??0,draws:he.get(se.id)??0,form:ue.get(se.id)??[]}));_e.sort((se,ke)=>ke.mltPts-se.mltPts||ke.unicorns-se.unicorns||ke.ocp-se.ocp||se.name.localeCompare(ke.name)),k&&(kt(_e),Ct(!1))})(),()=>{k=!1}},[p,e,y,Mt,ee]);function vn(){const k=D.useMemo(()=>y??null,[y]);Jt(k);const W=["Prem Predictions","FC Football","Easy League"],H=["The Bird league"],q=["gregVjofVcarl","Let Down"],K=!!(e&&!W.includes(e.name)&&!H.includes(e.name)&&!q.includes(e.name)),le=vr.length?vr:p.map(re=>({user_id:re.id,name:re.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]}));return p.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>Ke(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(As,{rows:le,members:p,showForm:v,currentUserId:n?.id,loading:bn,isLateStartingLeague:K}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(Ns,{showForm:v,onToggle:z}),s.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function yn(){const k=D.useMemo(()=>e?.name==="API Test"?nt??1:y??null,[e?.name,nt,y]),{state:W}=Jt(k);if(!k)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!Cr(e,k,mr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",k," predictions are not included in this league."]})]})});const H=new Map;Lt.forEach(J=>{if(J.gw!==k)return;const V=ar(J);V&&H.set(J.fixture_index,V)}),Re.forEach(J=>{if(J.gw!==k)return;const V=Ge[J.fixture_index];V&&(V.status==="IN_PLAY"||V.status==="PAUSED"||V.status==="FINISHED")&&(V.homeScore>V.awayScore?H.set(J.fixture_index,"H"):V.awayScore>V.homeScore?H.set(J.fixture_index,"A"):H.set(J.fixture_index,"D"))});const q=D.useMemo(()=>{const J=ue=>{if(!ue)return"Fixtures";const _e=new Date(ue);return isNaN(_e.getTime())?"Fixtures":_e.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},V=new Map;Re.filter(ue=>ue.gw===k).forEach(ue=>{const _e=J(ue.kickoff_time),se=ue.kickoff_time?new Date(ue.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;V.has(_e)||V.set(_e,{label:_e,key:se,items:[]}),V.get(_e).items.push(ue)});const he=Array.from(V.values());return he.forEach(ue=>ue.items.sort((_e,se)=>_e.fixture_index-se.fixture_index)),he.sort((ue,_e)=>ue.key-_e.key),he},[Re,k]),K=new Set(Re.filter(J=>J.gw===k).map(J=>J.fixture_index)),le=e?.name==="API Test",re=p.length>0&&p.every(J=>We.get(`${J.id}:${k}`));if(le&&k===(nt??1)){console.log("[League] API Test filtering:",{currentFixtureIndices:Array.from(K),totalPicks:jt.length,picksForGw:jt.filter(V=>V.gw===k).length,submittedMapSize:We.size,allSubmitted:re,members:p.map(V=>({id:V.id,name:V.name,submitted:We.get(`${V.id}:${k}`)})),fixturesCount:Re.filter(V=>V.gw===k).length});const J=jt.filter(V=>V.gw===k);console.log(`[League] All picks for GW${k}:`,J.map(V=>({user_id:V.user_id,userName:p.find(he=>he.id===V.user_id)?.name,fixture_index:V.fixture_index,pick:V.pick,hasSubmitted:!!We.get(`${V.user_id}:${k}`),inCurrentFixtures:K.has(V.fixture_index)})))}const pe=new Map;!le||re?jt.forEach(J=>{if(J.gw!==k)return;if(!We.get(`${J.user_id}:${k}`)){le&&k===1&&console.log("[League] API Test: Filtering out unsubmitted pick:",{user_id:J.user_id,fixture_index:J.fixture_index,userName:p.find(ue=>ue.id===J.user_id)?.name});return}if(!K.has(J.fixture_index)){le&&k===1&&console.log("[League] Filtering out old pick (not in current fixtures):",{fixture_index:J.fixture_index,currentIndices:Array.from(K),userName:p.find(ue=>ue.id===J.user_id)?.name});return}const he=pe.get(J.fixture_index)??[];he.push(J),pe.set(J.fixture_index,he)}):console.log("[League] API Test: Not all submitted - skipping ALL picks processing. allSubmitted=",re);const Ee=C!==null&&C>=k,de=p.filter(J=>!We.get(`${J.id}:${k}`)).length,fe=p.filter(J=>!We.get(`${J.id}:${k}`)).map(J=>J.name),we=W!==null&&(W==="DEADLINE_PASSED"||W==="LIVE"||W==="RESULTS_PRE_GW");if(le&&k===1){const J=p.map(ue=>{const _e=`${ue.id}:${k}`,se=We.get(_e);return{id:ue.id,name:ue.name,submitted:!!se,key:_e}});console.log(`[League] ===== API Test GW${k} SUBMISSION CHECK =====`),console.log("[League] All submitted:",re),console.log("[League] Remaining:",de),console.log("[League] Who didn't submit:",fe),console.log("[League] Member submission status:",J),console.log("[League] Submitted map entries:",Array.from(We.entries())),console.log("[League] ================================================");const V=p.find(ue=>ue.name.toLowerCase().includes("steve")||ue.name.toLowerCase().includes("s")),he=p.find(ue=>ue.name.toLowerCase().includes("jof")||ue.name.toLowerCase().includes("j"));if(V){const ue=`${V.id}:${k}`;console.log(`[League] STEVE (${V.name}):`,{id:V.id,submitted:!!We.get(ue),key:ue})}if(he){const ue=`${he.id}:${k}`;console.log(`[League] JOF (${he.name}):`,{id:he.id,submitted:!!We.get(ue),key:ue})}}console.log(`GW${k} deadline check:`,{gameState:W,deadlinePassed:we,allSubmitted:re,willShowPredictions:re||we});const Y=le?!re:!re&&!we;return(le?!re:!re&&!we)?(console.log(`[League] Not all submitted, showing ONLY "Who's submitted" view. Blocking all predictions/fixtures.`,{isApiTestLeague:le,allSubmitted:re,deadlinePassed:we,remaining:de}),s.jsx($r,{members:p,submittedMap:We,picksGw:k,allSubmitted:re,remaining:de,fixtures:Re.filter(J=>J.gw===k),variant:"compact"})):s.jsxs("div",{className:"mt-2 pt-2",children:[Y?s.jsx($r,{members:p,submittedMap:We,picksGw:k,allSubmitted:re,remaining:de,fixtures:Re.filter(J=>J.gw===k),variant:"full"}):null,e?.name==="API Test"&&re&&q.length>0&&!Y&&(()=>{const J=q.flatMap(ge=>ge.items),V=new Set(J.map(ge=>ge.fixture_index)),he={};Object.keys(Ge).forEach(ge=>{const me=parseInt(ge,10);V.has(me)&&(he[me]=Ge[me])});const ue=J.some(ge=>{const me=he[ge.fixture_index];return me&&(me.status==="IN_PLAY"||me.status==="PAUSED")}),_e=J.length>0&&J.every(ge=>{const me=he[ge.fixture_index];return me&&me.status==="FINISHED"}),se=ue||_e||J.some(ge=>he[ge.fixture_index]);let ke=0;return n?.id&&J.forEach(ge=>{const me=he[ge.fixture_index],je=me&&(me.status==="IN_PLAY"||me.status==="PAUSED"),Ze=me&&me.status==="FINISHED";if(me&&(je||Ze)){const Ie=(pe.get(ge.fixture_index)??[]).find(Pe=>Pe.user_id===n.id);if(Ie){let Pe=!1;(Ie.pick==="H"&&me.homeScore>me.awayScore||Ie.pick==="A"&&me.awayScore>me.homeScore||Ie.pick==="D"&&me.homeScore===me.awayScore)&&(Pe=!0),Pe&&ke++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:q.map((ge,me)=>s.jsx(Or,{label:ge.label,fixtures:ge.items,picksByFixture:pe,members:p,outcomes:H,liveScores:he,submittedMap:We,picksGw:k,isApiTestLeague:!0,isFirstSection:me===0,hasLiveGames:ue,allGamesFinished:_e,hasStarted:se,liveFixturesCount:ke},me))})})(),q.length>0&&e?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:q.map((J,V)=>s.jsx(Or,{label:J.label,fixtures:J.items,picksByFixture:pe,members:p,outcomes:H,liveScores:Ge,submittedMap:We,picksGw:k,isApiTestLeague:!1,isFirstSection:V===0,allSubmitted:re,resultsPublished:Ee,deadlinePassed:we,whoDidntSubmit:fe},V))}),!q.length&&!Y&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",k,"."]})]})}function _n(){const k=D.useMemo(()=>e?.name==="API Test"?nt??1:f==="gwr"?M.current?x:y||x:x,[e?.name,nt,f,x,y]);Jt(k);const W=k;if(!W||B.length===0&&e?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!Cr(e,W,mr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",W," results are not included in this league."]})]})});const H=new Map,q=e?.name==="API Test",K=Re.filter(Y=>Y.gw===W),le=K.some(Y=>{const ne=Ge[Y.fixture_index];return ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")});console.log("[League] Live Table calculation:",{resGw:W,currentGw:y,selectedGw:x,hasLiveScores:le,liveScoresCount:Object.keys(Ge).length,isApiTestLeague:q,fixturesCount:Re.length,fixturesForGwCount:K.length,manualGwSelected:M.current}),q&&W===(nt??1)?K.forEach(Y=>{const ne=Ge[Y.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?H.set(Y.fixture_index,"H"):ne.awayScore>ne.homeScore?H.set(Y.fixture_index,"A"):H.set(Y.fixture_index,"D"))}):le&&W===y?(console.log("[League] Using live scores for regular league GW",W),K.forEach(Y=>{const ne=Ge[Y.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?H.set(Y.fixture_index,"H"):ne.awayScore>ne.homeScore?H.set(Y.fixture_index,"A"):H.set(Y.fixture_index,"D"))}),console.log("[League] Outcomes from live scores:",Array.from(H.entries()))):(console.log("[League] Using results table for GW",W,{hasLiveScores:le,resGwEqualsCurrentGw:W===y,resultsCount:Lt.length,resultsForThisGw:Lt.filter(Y=>Y.gw===W).length,manualGwSelected:M.current,selectedGw:x}),Lt.forEach(Y=>{if(Y.gw!==W)return;const ne=ar(Y);ne&&H.set(Y.fixture_index,ne)}),console.log("[League] Outcomes from results:",Array.from(H.entries())));const re=p.filter(Y=>We.get(`${Y.id}:${W}`)).map(Y=>({user_id:Y.id,name:Y.name,score:0,unicorns:0})),pe=new Map;jt.forEach(Y=>{if(Y.gw!==W||!We.get(`${Y.user_id}:${W}`))return;const ne=pe.get(Y.fixture_index)??[];ne.push(Y),pe.set(Y.fixture_index,ne)}),Array.from(H.entries()).forEach(([Y,ne])=>{const V=(pe.get(Y)??[]).filter(he=>he.pick===ne).map(he=>he.user_id);if(V.forEach(he=>{const ue=re.find(_e=>_e.user_id===he);ue.score+=1}),V.length===1&&p.length>=3){const he=re.find(ue=>ue.user_id===V[0]);he.unicorns+=1}}),re.sort((Y,ne)=>ne.score-Y.score||ne.unicorns-Y.unicorns||Y.name.localeCompare(ne.name)),D.useEffect(()=>{if(re.length===0)return;const Y=new Map;re.forEach((J,V)=>{Y.set(J.user_id,V)});const ne=new Set;if(Y.forEach((J,V)=>{const he=X.current.get(V);he!==void 0&&he!==J&&ne.add(V)}),X.current=Y,ne.size>0){T(ne);const J=setTimeout(()=>{T(new Set)},2e3);return()=>clearTimeout(J)}},[re.map(Y=>`${Y.user_id}-${Y.score}-${Y.unicorns}`).join(",")]);let Ee=!1,de=!1,fe=!1,we=!1;if(q&&W===(nt??1)){const Y=Re;if(Y.length>0&&(Ee=Y.every(J=>{const V=Ge[J.fixture_index];return V&&V.status==="FINISHED"}),de=!!Y.find(J=>{const V=Ge[J.fixture_index];return V&&(V.status==="IN_PLAY"||V.status==="PAUSED")}),we=Y.some(J=>{const V=Ge[J.fixture_index];return V&&(V.status==="IN_PLAY"||V.status==="PAUSED"||V.status==="FINISHED")}),!Ee)){const J=new Date;fe=Y.some(V=>{if(!V.kickoff_time)return!1;const ue=new Date(V.kickoff_time).getTime()-J.getTime(),_e=Ge[V.fixture_index];return(!_e||_e.status!=="IN_PLAY"&&_e.status!=="PAUSED"&&_e.status!=="FINISHED")&&ue>0&&ue<=1440*60*1e3})}}else{const Y=Re.filter(ne=>ne.gw===W);if(Y.length>0){const ne=Y.every(V=>H.has(V.fixture_index)),J=Y.some(V=>{const he=Ge[V.fixture_index];return he&&(he.status==="IN_PLAY"||he.status==="PAUSED")});Ee=ne&&!J,console.log(`[League] GW ${W} finished check:`,{allHaveResults:ne,hasActiveGames:J,fixturesCount:Y.length,outcomesCount:Y.filter(V=>H.has(V.fixture_index)).length,allFixturesFinished:Ee})}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),re.length>0&&Ee&&s.jsx(ks,{winnerName:re[0].name,isDraw:re[0].score===re[1]?.score&&re[0].unicorns===re[1]?.unicorns}),s.jsx(Ls,{rows:re,members:p,currentUserId:n?.id,positionChangeKeys:I,isApiTestLeague:q,hasLiveFixtures:de,hasStartingSoonFixtures:fe,hasStartedFixtures:we,allFixturesFinished:Ee,resGw:W}),B.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(Cs,{availableGws:B,selectedGw:W,onChange:Y=>{M.current=!0,w(Y)}}),s.jsxs("button",{onClick:()=>He(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(kr,{isOpen:qe,onClose:()=>He(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return D.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[f]),l?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!e&&!l?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(jr,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):e?s.jsxs("div",{className:`${t?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:F,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(jr,{to:"/leagues",className:"flex items-center text-slate-600 -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{console.log("[League] Badge clicked, opening modal. isMember:",ct),b(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative cursor-pointer",children:e?s.jsx("img",{src:Zt(e),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:k=>{const W=k.target;console.error("[League] Badge image failed to load:",W.src,"League:",e);const q=`/assets/league-avatars/${Sr(e.id)}`;W.src!==q&&(W.src=q)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:e.name}),x&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",x]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>Xe(!pt),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${pt?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[ur&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:nn})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{O(!0),Xe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[ct&&s.jsxs("button",{onClick:()=>{Ae(!0),Xe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{Ke(!0),Xe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{fr(),Xe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{g(!0),Xe(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 active:bg-red-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${pt?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{U.current=!0,S("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(f==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),f==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(B.length>0||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{U.current=!0,S("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(f==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const k=new Date,W=Re[0],H=W?.kickoff_time?new Date(W.kickoff_time):null,q=H&&H<=k,le=Re[Re.length-1]?.fixture_index,pe=(le!==void 0?Ge[le]:null)?.status==="FINISHED",Ee=q&&!pe;return s.jsxs(s.Fragment,{children:[Ee&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),f==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(y||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{U.current=!0,S("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(f==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),f==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{U.current=!0,S("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(f==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",f==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),f==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(Ss,{miniLeagueId:e?.id??null,memberNames:sn,deepLinkError:E})}):s.jsx("div",{className:`league-content-wrapper ${pt?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[f==="mlt"&&s.jsx(vn,{}),f==="gw"&&s.jsx(yn,{}),f==="gwr"&&s.jsx(_n,{})]})}),ur&&Z&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>O(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("button",{onClick:()=>O(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[p.filter(k=>k.id!==n?.id).map(k=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:k.name}),s.jsx("button",{onClick:()=>{yt(k),et(!0),O(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-medium",children:"Remove"})]},k.id)),p.filter(k=>k.id!==n?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{at(!0),O(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),ct&&Ne&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{Ae(!1),De&&URL.revokeObjectURL(De),xe(null),Ce(null),Le(!1),ze(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("button",{onClick:()=>{Ae(!1),De&&URL.revokeObjectURL(De),xe(null),Ce(null),Le(!1),ze(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Se?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(is,{image:Se,crop:Te,zoom:Je,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Ve,onZoomChange:Ue,onCropComplete:fn,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(Je*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:Je,onChange:k=>Ue(Number(k.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:De?s.jsx("img",{src:De,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),ye&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ye}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{De&&URL.revokeObjectURL(De),xe(null),Ve({x:0,y:0}),Ue(1),Fe(null),ze(null)},disabled:be,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:hn,disabled:be||!Qe,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:be?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:e?Zt(e):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:k=>{const W=k.target;W.src="/assets/league-avatars/ML-avatar-1.png"}})}),e?.avatar&&s.jsx("button",{onClick:mn,disabled:be,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:k=>{const W=k.target.files?.[0];W&&un(W)},disabled:be,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),be&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),Me&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),ye&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ye})]})]})]})]})}),s.jsx(kr,{isOpen:ae,onClose:()=>ie(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${e&&(["The Bird league"].includes(e.name)||["gregVjofVcarl","Let Down"].includes(e.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),tt&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",or," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:e.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.code)},className:"px-3 py-1.5 border rounded-md text-sm",children:"Copy"}),s.jsx("button",{onClick:fr,className:"px-3 py-1.5 border rounded-md text-sm",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[p.length,"/",or," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>Ke(!1),className:"px-4 py-2 border border-slate-300 rounded-md",children:"Close"})})]})}),m&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',e?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:_,children:"Cancel"}),s.jsx("button",{onClick:on,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:_,children:_?"Leaving...":"Leave League"})]})]})}),ut&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',e?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>mt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:vt,children:"Cancel"}),s.jsx("button",{onClick:an,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:vt,children:vt?"Joining...":"Join League"})]})]})}),Ot&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',it?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>et(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:rt,children:"Cancel"}),s.jsx("button",{onClick:ln,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:rt,children:rt?"Removing...":"Remove Member"})]})]})}),ot&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',e?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>at(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Bt,children:"Cancel"}),s.jsx("button",{onClick:cn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Bt,children:Bt?"Ending...":"Yes, End League"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),c&&e&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>b(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:Zt(e),alt:"League badge",className:"w-full h-full object-cover",onError:k=>{const W=k.target,q=`/assets/league-avatars/${Sr(e.id)}`;W.src!==q&&(W.src=q)}})}),ct&&s.jsx("button",{type:"button",onClick:k=>{k.stopPropagation(),console.log("[League] Edit icon clicked"),b(!1),Ae(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:e.name})]})})]}):null}export{Fs as default};
