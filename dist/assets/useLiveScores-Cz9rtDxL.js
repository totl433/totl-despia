import{r as a,s as S}from"./index-CM5W4S7F.js";function T(i,s){const[p,g]=a.useState(new Map),[E,l]=a.useState(!0),[b,u]=a.useState(null);return a.useEffect(()=>{let f=null,o=!0;async function w(){try{let t=S.from("live_scores").select("*");i!==void 0&&(t=t.eq("gw",i)),s&&s.length>0&&(t=t.in("api_match_id",s));const{data:y,error:_}=await t;if(_){console.error("[useLiveScores] Error fetching initial scores:",_),o&&(u(_.message),l(!1));return}const d=new Map;(y||[]).forEach(r=>{d.set(r.api_match_id,r)}),o&&(g(d),l(!1));const L=`live_scores_${i||"all"}_${s?.join("-")||"all"}_${Date.now()}`;f=S.channel(L).on("postgres_changes",{event:"*",schema:"public",table:"live_scores"},r=>{if(!o)return;const m=n=>!(!n||i!==void 0&&n.gw!==i||s&&s.length>0&&!s.includes(n.api_match_id));g(n=>{const v=new Map(n);let h=!1;if(r.eventType==="INSERT"||r.eventType==="UPDATE"){const e=r.new;if(m(e)){const c=n.get(e.api_match_id);(!c||c.home_score!==e.home_score||c.away_score!==e.away_score||c.status!==e.status||JSON.stringify(c.goals)!==JSON.stringify(e.goals)||JSON.stringify(c.red_cards)!==JSON.stringify(e.red_cards))&&(v.set(e.api_match_id,e),h=!0)}}else if(r.eventType==="DELETE"){const e=r.old;m(e)&&(v.delete(e.api_match_id),h=!0)}return h?new Map(v):new Map(n)})}).subscribe(r=>{r==="CHANNEL_ERROR"&&(console.error("[useLiveScores] Channel error:",r),o&&u("Failed to subscribe to live scores"))})}catch(t){console.error("[useLiveScores] Error setting up subscription:",t),o&&(u(t?.message||"Failed to set up live scores subscription"),l(!1))}}return w(),()=>{o=!1,f&&S.removeChannel(f)}},[i,s?s.join(","):void 0]),{liveScores:p,loading:E,error:b}}export{T as u};
