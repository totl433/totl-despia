const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pushNotifications-DkD9hvWK.js","assets/index-S46OBmsK.js","assets/index-DxNI4XHo.css","assets/index-34X6sJMy.js"])))=>i.map(i=>d[i]);
import{u as oe,m as ae,r as g,j as e,L as $,_ as R}from"./index-S46OBmsK.js";function le(){const{user:P,session:w}=oe(),U=ae(),_=P?.id==="4542c037-5b38-40d0-b189-847b8f17c222"||P?.id==="36f31625-6d6c-4aa4-815a-1493a812841b",[v,L]=g.useState(null),[y,ie]=g.useState(null),[J,M]=g.useState(!1),[I,N]=g.useState(null),[z,Y]=g.useState(!1),[D,j]=g.useState(null),[G,q]=g.useState(!1),[E,S]=g.useState(null),[W,H]=g.useState(!1),[F,k]=g.useState(null),[C,ne]=g.useState(""),[T,V]=g.useState(""),[K,B]=g.useState(!1),[A,x]=g.useState(null),[Q,X]=g.useState(!1),[O,c]=g.useState(null),[Z,ee]=g.useState(!1),[b,te]=g.useState(null);return g.useEffect(()=>{P&&!_&&U("/profile")},[P,_,U]),g.useEffect(()=>{let t=0;const n=40,a=()=>{const s=[globalThis?.despia,typeof window<"u"?window?.despia:null,globalThis?.Despia,typeof window<"u"?window?.Despia:null,globalThis?.DESPIA,typeof window<"u"?window?.DESPIA:null,globalThis?.OneSignal,typeof window<"u"?window?.OneSignal:null,globalThis?.webkit?.messageHandlers?.despia,typeof window<"u"?window?.webkit?.messageHandlers?.despia:null].find(h=>h!=null)||null;let d=null;try{const h=typeof window<"u"?window:globalThis;for(const u in h)if(u.toLowerCase().includes("despia")||u.toLowerCase().includes("onesignal")){d={key:u,value:h[u]};break}}catch{}const r=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)||globalThis?.oneSignalPlayerId||(typeof window<"u"?window?.oneSignalPlayerId:null);if(s||d||r){console.log("[AdminData] Native API detected:",{despia:!!s,foundInGlobals:d,directPlayerId:r?String(r).slice(0,12)+"‚Ä¶":null,despiaKeys:s?Object.keys(s):[],hasOneSignalRequestPermission:s&&typeof s.oneSignalRequestPermission=="function",hasRequestPermission:s&&typeof s.requestPermission=="function",playerId:s?s.onesignalplayerid||s.oneSignalPlayerId:r}),L(!0);const h=s?s.onesignalplayerid||s.oneSignalPlayerId:r;return h&&ie(String(h)),!0}return t++,t<n?setTimeout(a,500):(console.warn("[AdminData] Native API not detected after",n,"attempts"),L(!1)),!1};a()},[]),P?_?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"Admin Data"}),e.jsx($,{to:"/profile",className:"text-slate-600 hover:text-slate-900 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})]}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Admin tools for managing notifications, devices, and data."})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Carl's Device Diagnostics"}),e.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Carl's device has ",e.jsx("code",{className:"bg-white px-1 rounded",children:"notification_types: null"})," in OneSignal, which means OneSignal SDK hasn't properly initialized. This prevents notifications from being delivered even though OneSignal accepts the request."]}),e.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:[e.jsx("strong",{children:"Issue:"})," Carl's ",e.jsx("code",{className:"bg-white px-1 rounded",children:"last_active"})," date is stuck on Nov 29, suggesting OneSignal SDK isn't communicating with OneSignal servers. This could be due to VPN, network restrictions, or SDK initialization failure."]}),e.jsxs("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded p-2 mb-3",children:[e.jsx("strong",{children:"Solution:"})," Carl needs to re-register his device properly:",e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Delete the app completely"}),e.jsx("li",{children:"Reinstall from App Store"}),e.jsx("li",{children:"Open the app and wait 10-15 seconds"}),e.jsx("li",{children:"Go to Profile ‚Üí Enable Notifications"}),e.jsxs("li",{children:["Check that ",e.jsx("code",{children:"notification_types"})," becomes ",e.jsx("code",{children:"1"})," (not ",e.jsx("code",{children:"null"}),")"]})]})]}),I&&e.jsx("div",{className:`mb-3 rounded border px-3 py-2 text-sm ${I.includes("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":I.includes("‚ö†Ô∏è")?"border-amber-200 bg-amber-50 text-amber-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:I}),e.jsx("button",{onClick:async()=>{M(!0),N(null);try{const a=`${window.location.hostname==="localhost"?"https://totl-staging.netlify.app":""}/.netlify/functions/diagnoseCarlNotifications?update=true`;console.log("[AdminData] Activating Carl devices, calling:",a);const i=await fetch(a,{method:"GET",mode:"cors"});if(!i.ok){const d=await i.text().catch(()=>"Unknown error");N(`‚ùå Server error (${i.status}): ${d||"Failed to activate devices"}`);return}const s=await i.json();if(s.error)N(`‚ùå ${s.error}`);else{const d=s.active_devices||0,r=s.subscribed_devices||0;d>0&&r>0?N(`‚úÖ Activated ${d} device(s) (${r} subscribed). Carl should receive notifications.`):r>0?N(`‚ö†Ô∏è Found ${r} subscribed device(s) but none are active. Check device status.`):N("‚ö†Ô∏è No subscribed devices found. Carl may need to enable notifications in iOS Settings.")}}catch(t){console.error("[AdminData] Error activating Carl devices:",t);let n="Failed to activate devices";t.message?n=t.message:t.name==="TypeError"&&t.message?.includes("fetch")&&(n="Network error: Could not reach server. Check your connection or try again later."),N(`‚ùå Error: ${n}`)}finally{M(!1)}},disabled:J,className:"w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:J?"Activating...":"Activate Carl's Devices"}),e.jsx("button",{onClick:async()=>{Y(!0),j(null);try{const n=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",a=await fetch(`${n}/.netlify/functions/forceCarlSubscription`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const s=await a.text().catch(()=>"Unknown error");j(`‚ùå Server error (${a.status}): ${s}`);return}const i=await a.json();if(i.ok){const s=i.before?.notification_types??"null",d=i.after?.notification_types??"null";j(d===1?`‚úÖ Successfully forced subscription! notification_types changed from ${s} to ${d}`:`‚ö†Ô∏è ${i.note||"Update attempted but notification_types is still "+d}. ${i.message||""}`)}else j(`‚ùå ${i.error||"Failed to force subscription"}`)}catch(t){j(`‚ùå Error: ${t.message||"Failed to force subscription"}`)}finally{Y(!1)}},disabled:z,className:"w-full py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed mt-2",children:z?"Forcing...":"Force Carl's Subscription Status"}),D&&e.jsx("div",{className:`mt-2 rounded border px-3 py-2 text-sm ${D.includes("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":D.includes("‚ö†Ô∏è")?"border-amber-200 bg-amber-50 text-amber-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:D}),e.jsx("button",{onClick:async()=>{q(!0),S(null);try{const n=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",a=`${n}/.netlify/functions/diagnoseCarlNotifications?user=carl`;console.log("[AdminData] Fetching Carl's Player ID from:",a);const i=await fetch(a,{method:"GET",mode:"cors"}).catch(o=>{throw new Error(`Network error fetching Carl's Player ID: ${o.message||"Failed to connect"}`)});if(!i.ok){const o=await i.text().catch(()=>"Unknown error");S(`‚ùå Failed to get Carl's Player ID (${i.status}): ${o}`);return}const s=await i.json().catch(o=>{throw new Error(`Failed to parse response: ${o.message}`)}),d=s.devices?.find(o=>o.is_active);if(!d?.player_id){S(`‚ùå Carl's active Player ID not found. Devices: ${JSON.stringify(s.devices?.map(o=>({is_active:o.is_active,player_id:o.player_id?.slice(0,20)})),null,2)}`);return}const r=d.player_id,h=`${n}/.netlify/functions/checkCarlPlayerId?playerId=${encodeURIComponent(r)}`;console.log("[AdminData] Checking OneSignal API for Player ID:",r.slice(0,20)+"...","URL:",h);const u=await fetch(h,{method:"GET",mode:"cors"}).catch(o=>{throw new Error(`Network error checking OneSignal API: ${o.message||"Failed to connect"}`)});if(!u.ok){const o=await u.text().catch(()=>"Unknown error");S(`‚ùå OneSignal API Error (${u.status}): ${o}`);return}const f=await u.json().catch(o=>{throw new Error(`Failed to parse OneSignal API response: ${o.message}`)});if(f.ok){const o=f.player,p=f.interpretation;let l=`‚úÖ OneSignal API Response:

`;l+=`Player ID: ${f.playerId}
`,l+=`Notification Types: ${o.notification_types??"null"}
`,l+=`Last Active: ${o.last_active_date||"Never"}
`,l+=`Has Token: ${o.identifier==="present"?"Yes":"No"}
`,l+=`Invalid Token: ${o.invalid_identifier?"Yes":"No"}

`,l+=`Interpretation:
`,l+=`- Subscribed: ${p.subscribed?"‚úÖ":"‚ùå"}
`,l+=`- Unsubscribed: ${p.unsubscribed?"Yes":"No"}
`,l+=`- Disabled: ${p.disabled?"Yes":"No"}
`,l+=`- Not Initialized: ${p.not_initialized?"Yes":"No"}
`,l+=`- Has Valid Token: ${p.has_valid_token?"‚úÖ":"‚ùå"}
`,l+=`- Can Receive Notifications: ${p.can_receive_notifications?"‚úÖ":"‚ùå"}

`,l+=`Full API Response:
${JSON.stringify(f.player,null,2)}`,S(l)}else S(`‚ùå ${f.error||"Failed to check OneSignal API"}`)}catch(t){console.error("[AdminData] Error checking OneSignal API:",t);const n=t.message||"Failed to check OneSignal API",i=n.includes("Network error")||n.includes("Failed to fetch")||n.includes("Failed to connect")?`

üí° Tip: Make sure you're connected to the internet and the function is deployed. Check browser console (F12) for more details.`:"";S(`‚ùå Error: ${n}${i}`)}finally{q(!1)}},disabled:G,className:"w-full mt-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:G?"Checking...":"Check OneSignal API (Carl)"}),E&&e.jsx("div",{className:`mt-3 rounded border px-3 py-2 text-sm whitespace-pre-wrap break-words max-h-96 overflow-y-auto font-mono ${E.startsWith("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:E}),e.jsx("button",{onClick:async()=>{H(!0),k(null);try{const n=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",a=`${n}/.netlify/functions/diagnoseCarlNotifications?user=jof`;console.log("[AdminData] Fetching Jof's Player ID from:",a);const i=await fetch(a,{method:"GET",mode:"cors"}).catch(o=>{throw new Error(`Network error fetching Jof's Player ID: ${o.message||"Failed to connect"}`)});if(!i.ok){const o=await i.text().catch(()=>"Unknown error");k(`‚ùå Failed to get Jof's Player ID (${i.status}): ${o}`);return}const s=await i.json().catch(o=>{throw new Error(`Failed to parse response: ${o.message}`)}),d=s.devices?.find(o=>o.is_active);if(!d?.player_id){k(`‚ùå Jof's active Player ID not found. Devices: ${JSON.stringify(s.devices?.map(o=>({is_active:o.is_active,player_id:o.player_id?.slice(0,20)})),null,2)}`);return}const r=d.player_id,h=`${n}/.netlify/functions/checkCarlPlayerId?playerId=${encodeURIComponent(r)}`;console.log("[AdminData] Checking OneSignal API for Player ID:",r.slice(0,20)+"...","URL:",h);const u=await fetch(h,{method:"GET",mode:"cors"}).catch(o=>{throw new Error(`Network error checking OneSignal API: ${o.message||"Failed to connect"}`)});if(!u.ok){const o=await u.text().catch(()=>"Unknown error");k(`‚ùå OneSignal API Error (${u.status}): ${o}`);return}const f=await u.json().catch(o=>{throw new Error(`Failed to parse OneSignal API response: ${o.message}`)});if(f.ok){const o=f.player,p=f.interpretation;let l=`‚úÖ OneSignal API Response:

`;l+=`Player ID: ${f.playerId}
`,l+=`Notification Types: ${o.notification_types??"null"}
`,l+=`Last Active: ${o.last_active_date||"Never"}
`,l+=`Has Token: ${o.identifier==="present"?"Yes":"No"}
`,l+=`Invalid Token: ${o.invalid_identifier?"Yes":"No"}

`,l+=`Interpretation:
`,l+=`- Subscribed: ${p.subscribed?"‚úÖ":"‚ùå"}
`,l+=`- Unsubscribed: ${p.unsubscribed?"Yes":"No"}
`,l+=`- Disabled: ${p.disabled?"Yes":"No"}
`,l+=`- Not Initialized: ${p.not_initialized?"Yes":"No"}
`,l+=`- Has Valid Token: ${p.has_valid_token?"‚úÖ":"‚ùå"}
`,l+=`- Can Receive Notifications: ${p.can_receive_notifications?"‚úÖ":"‚ùå"}

`,l+=`Full API Response:
${JSON.stringify(f.player,null,2)}`,k(l)}else k(`‚ùå ${f.error||"Failed to check OneSignal API"}`)}catch(t){console.error("[AdminData] Error checking OneSignal API for Jof:",t);const n=t.message||"Failed to check OneSignal API",i=n.includes("Network error")||n.includes("Failed to fetch")||n.includes("Failed to connect")?`

üí° Tip: Make sure you're connected to the internet and the function is deployed. Check browser console (F12) for more details.`:"";k(`‚ùå Error: ${n}${i}`)}finally{H(!1)}},disabled:W,className:"w-full mt-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:W?"Checking...":"Check OneSignal API (Jof)"}),F&&e.jsx("div",{className:`mt-3 rounded border px-3 py-2 text-sm whitespace-pre-wrap break-words max-h-96 overflow-y-auto font-mono ${F.startsWith("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:F})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Send Notification to All Users"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Title"}),e.jsx("input",{type:"text",value:C,onChange:t=>ne(t.target.value),placeholder:"Notification title",className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Message"}),e.jsx("textarea",{value:T,onChange:t=>V(t.target.value),placeholder:"Notification message",rows:3,className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),A&&e.jsx("div",{className:`rounded border px-3 py-2 text-sm whitespace-pre-wrap break-words max-h-60 overflow-y-auto ${A.startsWith("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":A.startsWith("‚ö†Ô∏è")?"border-amber-200 bg-amber-50 text-amber-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:A}),e.jsx("button",{onClick:async()=>{if(!C.trim()||!T.trim()){x("‚ùå Please enter both title and message");return}B(!0),x(null);try{const a=`${window.location.hostname==="localhost"?"https://totl-staging.netlify.app":""}/.netlify/functions/sendPushAllV2`;console.log("[AdminData] Sending notification to:",a);const i=await fetch(a,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C.trim(),message:T.trim()})}).catch(r=>{throw console.error("[AdminData] Fetch error:",r),new Error(`Network error: ${r.message||"Failed to connect to server. Make sure you're connected to the internet and the function is deployed."}`)});if(!i.ok){const r=await i.text().catch(()=>"Unknown error");x(`‚ùå Server error (${i.status}): ${r||"Failed to send notification"}`);return}let s;const d=await i.text();if(!d||d.trim()===""){x("‚ùå Empty response from server");return}try{s=JSON.parse(d)}catch(r){x(`‚ùå Invalid response from server: ${r.message||"Failed to parse response"}`);return}if(s.ok)if(s.warning)x(`‚ö†Ô∏è ${s.warning} (checked ${s.checked||0} device(s))`);else{const r=s.sentTo||0,h=s.oneSignalRecipients||0,u=s.expected||r,f=s.userCount||0,o=s.userNames||[],p=s.oneSignalErrors,l=s.hasNotificationId,se=s.notificationId;let m="";l&&!p?(m=`‚úÖ Notification sent to ${u} device(s) (${f} users)`,se&&(m+=`

Notification ID: ${se}`,m+=`

üí° Tip: Check Netlify function logs to see OneSignal's full response, including invalid_player_ids.`)):p&&p.length>0?m=`‚ö†Ô∏è Sent to ${r} device(s) (${f} users, expected ${u}). OneSignal errors: ${p.join(", ")}`:r<u&&h===0?m=`‚úÖ Notification sent to ${u} device(s) (${f} users)`:r<u?m=`‚ö†Ô∏è Sent to ${r} device(s) (${f} users, expected ${u}). Some devices may not be subscribed.`:m=`‚úÖ Notification sent to ${r} device(s) (${f} users)`,o.length>0&&o.length<=5?m+=`

Users: ${o.join(", ")}`:o.length>5&&(m+=`

Users: ${o.slice(0,5).join(", ")} and ${o.length-5} more`),s.carlIncluded!==void 0&&(m+=`

Carl included: ${s.carlIncluded?"‚úÖ Yes":"‚ùå No"}`,s.carlPlayerId&&(m+=` (Player ID: ${s.carlPlayerId})`),s.carlInvalid&&(m+=`
‚ö†Ô∏è Carl's Player ID was marked as INVALID by OneSignal!`),s.invalidPlayerIds&&s.invalidPlayerIds.length>0&&(m+=`

Invalid Player IDs: ${s.invalidPlayerIds.length}`)),x(m),V("")}else x(`‚ùå Failed to send: ${s.error||"Unknown error"}`)}catch(t){console.error("[AdminData] Error sending notification:",t);let n="Failed to send notification";t.message?n=t.message:t.name==="TypeError"&&t.message?.includes("fetch")&&(n="Network error: Could not reach server. Check your connection or try again later."),x(`‚ùå Error: ${n}`)}finally{B(!1)}},disabled:K||!C.trim()||!T.trim(),className:"w-full py-2 bg-[#1C8376] hover:bg-[#1a7569] text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:K?"Sending...":"Send to All Users"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Sends a push notification to all users with active, subscribed devices."})]})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Notification Diagnostics"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Check and fix notification settings to receive chat notifications in mini-leagues."}),e.jsx("div",{className:"mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"OS Permission:"}),e.jsx("div",{className:"font-semibold text-slate-800",children:v===null?"‚è≥ Checking...":v===!1?"‚ùì Unknown (not native app)":globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)||y?'‚úÖ Native app (use "Enable Notifications" to check status)':"‚ùì Unknown (not native app)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"OneSignal Status:"}),e.jsx("div",{className:"font-semibold text-slate-800",children:(()=>{if(v===null)return"‚è≥ Checking...";if(v===!1)return"‚ùå Not initialized";const t=globalThis?.despia||(typeof window<"u"?window?.despia:null),n=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null);return t?.onesignalplayerid||t?.oneSignalPlayerId||n||y?"‚úÖ Player ID found":"‚ùå Not initialized"})()})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"Player ID:"}),e.jsx("div",{className:"font-mono text-xs text-slate-700 break-all",children:(()=>{if(v===null)return"Checking...";const t=globalThis?.despia||(typeof window<"u"?window?.despia:null),n=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null),a=t?.onesignalplayerid||t?.oneSignalPlayerId||n||y;if(!a)return"Not available";const i=String(a);return i.slice(0,8)+"‚Ä¶"+i.slice(-4)})()})]})]})}),e.jsxs("div",{className:"mb-4 p-3 bg-slate-100 rounded-lg border border-slate-300 text-xs",children:[e.jsx("div",{className:"font-semibold text-slate-700 mb-2",children:"üîç Debug Info:"}),e.jsxs("div",{className:"space-y-1 text-slate-600 font-mono break-all",children:[e.jsxs("div",{children:["User Agent: ",typeof navigator<"u"?navigator.userAgent.slice(0,50)+"‚Ä¶":"N/A"]}),e.jsxs("div",{children:["globalThis.despia: ",globalThis?.despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.despia: ",typeof window<"u"&&window?.despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["globalThis.Despia: ",globalThis?.Despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.Despia: ",typeof window<"u"&&window?.Despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["globalThis.OneSignal: ",globalThis?.OneSignal?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.OneSignal: ",typeof window<"u"&&window?.OneSignal?"‚úÖ Found":"‚ùå Not found"]}),(()=>{const n=[globalThis?.despia,typeof window<"u"?window?.despia:null,globalThis?.Despia,typeof window<"u"?window?.Despia:null,globalThis?.DESPIA,typeof window<"u"?window?.DESPIA:null].find(i=>i!=null)||null;let a=[];try{const i=typeof window<"u"?window:globalThis;for(const s in i)(s.toLowerCase().includes("despia")||s.toLowerCase().includes("onesignal"))&&a.push(s)}catch{}return a.length>0?e.jsxs("div",{className:"mt-2 text-green-600",children:["‚úÖ Found global properties: ",a.join(", ")]}):n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 font-semibold",children:"Despia Object Found:"}),e.jsxs("div",{children:["Keys: ",Object.keys(n).slice(0,10).join(", "),Object.keys(n).length>10?"‚Ä¶":""]}),e.jsxs("div",{children:["oneSignalRequestPermission: ",typeof n.oneSignalRequestPermission=="function"?"‚úÖ Function":"‚ùå Not a function"]}),e.jsxs("div",{children:["requestPermission: ",typeof n.requestPermission=="function"?"‚úÖ Function":"‚ùå Not a function"]}),e.jsxs("div",{children:["onesignalplayerid: ",n.onesignalplayerid?"‚úÖ "+String(n.onesignalplayerid).slice(0,12)+"‚Ä¶":"‚ùå"]}),e.jsxs("div",{children:["oneSignalPlayerId: ",n.oneSignalPlayerId?"‚úÖ "+String(n.oneSignalPlayerId).slice(0,12)+"‚Ä¶":"‚ùå"]})]}):e.jsx("div",{className:"mt-2 text-red-600",children:"‚ùå No Despia object found in any location"})})(),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Polling: ",v===null?"‚è≥ Checking...":v?"‚úÖ Detected":"‚ùå Not detected"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:async()=>{if(!w?.access_token){c("Error: Not signed in");return}X(!0),c(null);try{let t=y;if(!t){c("‚è≥ Waiting for OneSignal to initialize... (this may take up to 15 seconds)");const{ensurePushSubscribed:n}=await R(async()=>{const{ensurePushSubscribed:i}=await import("./pushNotifications-DkD9hvWK.js");return{ensurePushSubscribed:i}},__vite__mapDeps([0,1,2])),a=await n(w);if(a.ok){c(`‚úÖ Successfully enabled notifications! Player ID: ${a.playerId?.slice(0,8)}‚Ä¶`),setTimeout(()=>c(null),5e3);return}else if(a.reason==="no-player-id")if(y)console.log("[AdminData] Using Player ID from AdminData page polling:",y.slice(0,8)),t=y;else{const i={"permission-denied":"Permission denied. Please enable notifications in iOS Settings.","no-player-id":a.error||"OneSignal not initialized. Try: 1) Close the app completely, 2) Reopen it, 3) Wait 10 seconds, 4) Try again.","api-not-available":"Not available in browser. Please use the native app.","no-session":"Not signed in. Please sign in and try again.",unknown:a.error||"Unknown error. Please try again or contact support."};c(`‚ö†Ô∏è ${i[a.reason||"unknown"]||"Failed to enable notifications"}`);return}else{const i={"permission-denied":"Permission denied. Please enable notifications in iOS Settings.","no-player-id":a.error||"OneSignal not initialized. Try: 1) Close the app completely, 2) Reopen it, 3) Wait 10 seconds, 4) Try again.","api-not-available":"Not available in browser. Please use the native app.","no-session":"Not signed in. Please sign in and try again.",unknown:a.error||"Unknown error. Please try again or contact support."};c(`‚ö†Ô∏è ${i[a.reason||"unknown"]||"Failed to enable notifications"}`);return}}if(t){c("‚è≥ Registering device...");const a=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",i=await fetch(`${a}/.netlify/functions/registerPlayer`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.access_token}`},body:JSON.stringify({playerId:t,platform:"ios"})});if(!i.ok){let d={};try{const r=await i.text();d=r?JSON.parse(r):{}}catch{d={error:`HTTP ${i.status}: ${i.statusText}`}}c(`‚ùå Registration failed: ${d.error||"Unknown error"}`);return}const s=await i.json();s.ok?(c(`‚úÖ Successfully enabled notifications! Player ID: ${t.slice(0,8)}‚Ä¶`),setTimeout(()=>c(null),5e3)):c(`‚ö†Ô∏è ${s.warning||s.error||"Registration completed with warnings"}`)}}catch(t){console.error("[AdminData] Registration error:",t),c(`‚ùå Error: ${t.message||"Failed to enable notifications"}`)}finally{X(!1)}},disabled:Q||!w?.access_token,className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 disabled:bg-gray-100 disabled:opacity-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:Q?"Enabling...":"Enable Notifications"}),e.jsx("button",{onClick:async()=>{let t=null;try{t=(await R(()=>import("./index-34X6sJMy.js").then(a=>a.i),__vite__mapDeps([3,1,2]))).default}catch{t=globalThis?.despia||(typeof window<"u"?window?.despia:null)}if(t&&typeof t=="function")try{t("settingsapp://")}catch{alert("Please go to iOS Settings ‚Üí TotL ‚Üí Notifications and enable notifications")}else alert("Please go to iOS Settings ‚Üí TotL ‚Üí Notifications and enable notifications")},className:"w-full py-2 bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium rounded-xl transition-colors text-sm hidden",children:"‚öôÔ∏è Open OS Settings"}),e.jsx("button",{onClick:async()=>{if(!w?.access_token){c("Error: Not signed in");return}ee(!0),c(null),te(null);try{const n=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",i=await(await fetch(`${n}/.netlify/functions/checkMySubscription`,{headers:{Authorization:`Bearer ${w.access_token}`}})).json();if(te(i),i.subscribed)c("‚úÖ Device is subscribed! Notifications should work.");else{const s=i.reasons||[],d=i.suggestion||"Enable notifications in iOS Settings";c(`‚ö†Ô∏è Not subscribed: ${s.join("; ")}. ${d}`)}}catch(t){c(`‚ùå Error checking subscription: ${t.message}`)}finally{ee(!1)}},disabled:Z||!w?.access_token,className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 disabled:bg-gray-100 disabled:opacity-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:Z?"Checking...":"Check Subscription Status"}),e.jsx("button",{onClick:async()=>{let t=null;try{const a=(await R(()=>import("./index-34X6sJMy.js").then(i=>i.i),__vite__mapDeps([3,1,2]))).default;t=a?.onesignalplayerid||a?.oneSignalPlayerId||null}catch{t=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)}t=t||y,t?(await navigator.clipboard.writeText(String(t)),c("‚úÖ Player ID copied to clipboard"),setTimeout(()=>c(null),2e3)):c("‚ö†Ô∏è Player ID not available")},className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:"Copy Player ID"})]}),O&&e.jsx("div",{className:`mt-3 p-3 rounded-lg text-sm ${O.includes("‚úÖ")?"bg-green-50 text-green-800 border border-green-200":O.includes("‚ö†Ô∏è")?"bg-amber-50 text-amber-800 border border-amber-200":"bg-red-50 text-red-800 border border-red-200"}`,children:O}),b&&b.details&&e.jsxs("div",{className:"mt-3 p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs",children:[e.jsx("div",{className:"font-semibold text-slate-700 mb-2",children:"üìä OneSignal Status Details:"}),e.jsxs("div",{className:"space-y-1 text-slate-600 font-mono",children:[e.jsxs("div",{children:["Has Token: ",b.details.hasToken?"‚úÖ Yes":"‚ùå No"]}),e.jsxs("div",{children:["Invalid: ",b.details.invalid?"‚ùå Yes":"‚úÖ No"]}),e.jsxs("div",{children:["Notification Types: ",b.details.notificationTypes??"null"]}),e.jsxs("div",{children:["Device Type: ",b.details.deviceType||"N/A"]}),e.jsxs("div",{children:["Last Active: ",b.details.lastActive?new Date(b.details.lastActive).toLocaleString():"Never"]}),b.reasons&&b.reasons.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-300",children:[e.jsx("div",{className:"font-semibold text-red-600",children:"Issues Found:"}),b.reasons.map((t,n)=>e.jsxs("div",{className:"text-red-600",children:["‚Ä¢ ",t]},n))]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Admin Pages"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{to:"/api-admin",className:"block w-full py-3 bg-[#1C8376] hover:bg-[#1C8376]/90 text-white font-semibold rounded-xl transition-colors text-center",children:"API Admin - Premier League"}),e.jsx($,{to:"/test-fixtures",className:"block w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-xl transition-colors text-center",children:"Test Fixtures (Non-PL)"}),e.jsx($,{to:"/admin",className:"block w-full py-3 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-xl transition-colors text-center",children:"Admin Panel (Web)"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-600 mb-4",children:"Access denied. Admin only."}),e.jsx($,{to:"/profile",className:"text-[#1C8376] hover:underline",children:"Go to Profile"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-600 mb-4",children:"Please sign in to view admin data."}),e.jsx($,{to:"/profile",className:"text-[#1C8376] hover:underline",children:"Go to Profile"})]})})}export{le as default};
