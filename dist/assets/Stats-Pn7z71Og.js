import{R as D,j as e,T as Z,r as M,I as K,s as T,w as ee,x as z,y as te,z as Y,k as se,b as q,A as ae,u as ne,B as oe,L as re,P as ie}from"./index-DGt0hYSx.js";import{f as le}from"./userLeagues-BYuL-bBS.js";const I=D.memo(function({label:s,value:h,subcopy:m,loading:p=!1,className:w=""}){if(p)return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${w}`,children:[e.jsx("div",{className:"text-sm text-slate-500 mb-2",children:s}),e.jsx("div",{className:"h-8 bg-slate-200 rounded animate-pulse"})]});const v=typeof h=="object"&&h!==null;return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${w}`,children:[e.jsx("div",{className:"text-sm font-medium text-slate-600 mb-2",children:s}),e.jsx("div",{className:`mb-1 flex items-baseline ${v?"":"text-2xl font-bold text-slate-800"}`,children:h}),m&&e.jsx("div",{className:"text-sm text-slate-500 mt-2",children:m})]})}),ce=D.memo(function({label:s,streakCount:h,gwRange:m,subcopy:p,extraLine:w,loading:v=!1,className:$=""}){return v?e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${$}`,children:[e.jsx("div",{className:"text-sm text-slate-500 mb-2",children:s}),e.jsx("div",{className:"h-8 bg-slate-200 rounded animate-pulse"})]}):e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${$}`,children:[e.jsx("div",{className:"text-sm font-medium text-slate-600 mb-2",children:s}),e.jsxs("div",{className:"text-4xl font-bold text-slate-800 mb-2 flex items-baseline gap-2",children:[e.jsx("span",{children:h}),e.jsxs("span",{className:"text-base font-normal text-slate-600",children:["Top 25% from ",m]})]}),w&&e.jsxs("div",{className:"text-sm text-slate-500 italic mb-2",children:['"',w,'"']}),p&&e.jsxs("div",{className:"text-sm text-slate-500 mt-2 italic",children:['"',p,'"']})]})}),V=D.memo(function({label:s,teamCode:h,teamName:m,percentage:p,isCorrect:w,subcopy:v,loading:$=!1,className:y=""}){if($)return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${y}`,children:[e.jsx("div",{className:"text-sm text-slate-500 mb-2",children:s}),e.jsx("div",{className:"h-8 bg-slate-200 rounded animate-pulse"})]});const N=p%1===0?p.toFixed(0):p.toFixed(2);return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-6 ${y}`,children:[e.jsx("div",{className:"text-sm font-medium text-slate-600 mb-3",children:s}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{code:h,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 truncate",children:m}),e.jsxs("div",{className:`text-base font-semibold ${w?"text-green-600":"text-red-600"}`,children:[N,"% ",w?"correct":"incorrect"]})]})]}),v&&e.jsxs("div",{className:"text-sm text-slate-500 mt-3 italic",children:['"',v,'"']})]})}),de=D.memo(function({weeklyData:s,latestGw:h,showInfo:m=!1}){const p=s.flatMap(i=>[i.userPoints,i.averagePoints]),w=p.length>0?Math.max(...p,10):10,v=0,$=w-v||1,y=120,N=48,C=8,P=12,g=4,n=m?48:16,l=Math.max(340,s.length*N+(s.length-1)*C+P*2+g*2+n);return e.jsx("div",{className:"flex-shrink-0 h-[168px] bg-white relative",style:{width:`${l}px`,minWidth:`${l}px`},children:e.jsxs("div",{className:"pt-3 pb-2 h-full flex flex-col",style:{paddingLeft:"0",paddingRight:"12px"},children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"mb-1 relative",style:{height:"120px"},children:e.jsx("div",{className:"relative h-full",children:e.jsx("div",{className:"flex items-end gap-2 h-full",style:{paddingLeft:"0",paddingRight:"4px"},children:s.map(i=>{const{gw:u,userPoints:x,averagePoints:_}=i,R=u===h,G=x-_,E=G>0,t=G<0,d=(x-v)/$*y,r=(_-v)/$*y,f=Math.max(d,r);return e.jsxs("div",{className:"flex flex-col items-center justify-end relative",style:{minWidth:"48px",width:"48px",height:"100%"},children:[e.jsxs("div",{className:"w-full relative",style:{height:`${f}px`},children:[m&&e.jsx("div",{className:"absolute flex items-center justify-center",style:{bottom:`${f+4}px`,left:"0",right:"0",width:"100%",zIndex:10},children:e.jsx("div",{className:`text-xs font-bold leading-none ${R?"text-[#1C8376]":E?"text-green-600":t?"text-red-600":"text-slate-700"}`,children:x})}),E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bottom-0 w-full bg-slate-300 opacity-60",style:{height:`${r}px`,minHeight:r>0?"2px":"0",borderTopLeftRadius:"2px",borderTopRightRadius:r===f?"2px":"0"},title:`Par: ${_.toFixed(1)}`}),e.jsx("div",{className:"absolute w-full transition-all bg-green-500",style:{bottom:`${r}px`,height:`${d-r}px`,minHeight:d-r>0?"2px":"0",borderTopLeftRadius:"2px",borderTopRightRadius:"2px"},title:`Your score: ${x}`})]}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bottom-0 w-full transition-all bg-red-500",style:{height:`${d}px`,minHeight:d>0?"2px":"0",borderTopLeftRadius:d===f?"2px":"0",borderTopRightRadius:d===f?"2px":"0"},title:`Your score: ${x}`}),e.jsx("div",{className:"absolute w-full bg-slate-300 opacity-60",style:{bottom:`${d}px`,height:`${r-d}px`,minHeight:r-d>0?"2px":"0",borderTopLeftRadius:"2px",borderTopRightRadius:"2px"},title:`Par: ${_.toFixed(1)}`})]}):e.jsx("div",{className:"absolute bottom-0 w-full rounded-t bg-slate-400 transition-all",style:{height:`${d}px`,minHeight:d>0?"4px":"0",borderRadius:"2px 2px 0 0"},title:`Your score: ${x} (Par: ${_.toFixed(1)})`}),f>15&&e.jsx("div",{className:"absolute bottom-1 left-0 right-0 flex items-center justify-center",style:{height:"16px"},children:e.jsx("div",{className:`text-[13px] leading-none ${E?"text-green-600":"text-white"}`,style:{fontWeight:900},children:E?`+${G.toFixed(1)}`:t?`${G.toFixed(1)}`:"Par"})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-start",style:{height:"28px",marginTop:"4px"},children:[e.jsxs("div",{className:`text-[10px] font-medium leading-tight ${R?"text-[#1C8376] font-bold":"text-slate-700"}`,children:["GW",u]}),e.jsxs("div",{className:"text-[9px] font-medium text-slate-400 leading-none",style:{visibility:m?"visible":"hidden",height:"12px"},children:["av. ",_.toFixed(1)]})]})]},u)})})})})]})})}),me=D.memo(function({lastGw:s,form5:h,form10:m,overall:p,loading:w=!1}){const[v,$]=M.useState(!1),y=[{label:"Gameweek",count:s},{label:"5-Week Form",count:h},{label:"10-Week Form",count:m},{label:"Overall",count:p}],N=s+h+m+p;return w?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("div",{className:"text-sm text-slate-500 mb-4",children:"Leaderboard Trophy Cabinet"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[1,2,3,4].map(C=>e.jsx("div",{className:"h-24 bg-slate-200 rounded animate-pulse"},C))})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Leaderboard Trophy Cabinet"}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-400 flex items-center justify-center hover:bg-slate-50 transition-colors cursor-pointer",onClick:()=>$(!0),role:"button","aria-label":"Information about Trophy Cabinet",children:e.jsx("span",{className:"text-[10px] text-slate-500 font-bold",children:"i"})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:y.map((C,P)=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 bg-slate-50 rounded-lg border border-slate-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:`w-10 h-10 text-yellow-500 ${C.count>0?"sparkle-trophy":"opacity-40"}`,children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:"M16 3c1.1046 0 2 0.89543 2 2h2c1.1046 0 2 0.89543 2 2v1c0 2.695 -2.1323 4.89 -4.8018 4.9941 -0.8777 1.5207 -2.4019 2.6195 -4.1982 2.9209V19h3c0.5523 0 1 0.4477 1 1s-0.4477 1 -1 1H8c-0.55228 0 -1 -0.4477 -1 -1s0.44772 -1 1 -1h3v-3.085c-1.7965 -0.3015 -3.32148 -1.4 -4.19922 -2.9209C4.13175 12.8895 2 10.6947 2 8V7c0 -1.10457 0.89543 -2 2 -2h2c0 -1.10457 0.89543 -2 2 -2zm-8 7c0 2.2091 1.79086 4 4 4 2.2091 0 4 -1.7909 4 -4V5H8zM4 8c0 1.32848 0.86419 2.4532 2.06055 2.8477C6.02137 10.5707 6 10.2878 6 10V7H4zm14 2c0 0.2878 -0.0223 0.5706 -0.0615 0.8477C19.1353 10.4535 20 9.32881 20 8V7h-2z",strokeWidth:"1"})})}),C.count>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white",children:C.count})]}),e.jsx("div",{className:"text-xs font-medium text-slate-600 text-center",children:C.label})]},P))}),N>0&&e.jsxs("div",{className:"mt-4 text-sm font-semibold text-slate-600 text-center",children:["You have ",N," ",N===1?"trophy":"trophies"]}),e.jsx(K,{isOpen:v,onClose:()=>$(!1),title:"Leaderboard Trophy Cabinet",description:`Earn trophies by finishing top (or joint top) of any leaderboard after a gameweek completes.

GAMEWEEK
Finish #1 in the weekly leaderboard for any completed gameweek.

5-WEEK FORM
Finish #1 in the 5-week form leaderboard after any gameweek. Requires 5+ completed gameweeks.

10-WEEK FORM
Finish #1 in the 10-week form leaderboard after any gameweek. Requires 10+ completed gameweeks.

OVERALL
Finish #1 in the overall season leaderboard after any gameweek.`})]})});function O(a,s){if(s.length===0)return 50;const m=s.filter(p=>p<=a).length/s.length*100;return Math.round(m*100)/100}async function ue(a){const s={lastCompletedGw:null,lastCompletedGwPercentile:null,overallPercentile:null,correctPredictionRate:null,bestStreak:0,bestStreakGwRange:null,avgPointsPerWeek:null,bestSingleGw:null,lowestSingleGw:null,chaosIndex:null,chaosCorrectCount:null,chaosTotalCount:null,mostCorrectTeam:null,mostIncorrectTeam:null,weeklyParData:null,trophyCabinet:null};try{const{data:h}=await T.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle(),m=h?.gw||null;if(s.lastCompletedGw=m,!m)return s;if(m){const{data:g}=await T.from("app_v_gw_points").select("user_id, points").eq("gw",m);if(g&&g.length>0){const n=g.map(i=>i.points||0),l=g.find(i=>i.user_id===a)?.points||0;s.lastCompletedGwPercentile=O(l,n)}}const{data:p}=await T.from("v_ocp_overall").select("user_id, ocp").order("ocp",{ascending:!1});if(p&&p.length>0){const g=p.map(l=>l.ocp||0),n=p.find(l=>l.user_id===a)?.ocp||0;s.overallPercentile=O(n,g)}const[w,v]=await Promise.all([T.from("app_picks").select("gw, fixture_index, pick").eq("user_id",a),T.from("picks").select("gw, fixture_index, pick").eq("user_id",a)]),$=new Map;v.data&&v.data.forEach(g=>{const n=`${g.gw}:${g.fixture_index}`;$.set(n,g)}),w.data&&w.data.forEach(g=>{const n=`${g.gw}:${g.fixture_index}`;$.set(n,g)});const y=Array.from($.values());console.log("[userStats] Picks from app_picks:",w.data?.length||0),console.log("[userStats] Picks from picks table:",v.data?.length||0),console.log("[userStats] Total unique picks (combined):",y.length),w.error&&console.error("[userStats] Error fetching app_picks:",w.error),v.error&&v.error.code!=="PGRST116"&&console.error("[userStats] Error fetching picks:",v.error);const{data:N,error:C}=await T.from("app_gw_results").select("gw, fixture_index, result");if(console.log("[userStats] Total results fetched:",N?.length||0),C&&console.error("[userStats] Error fetching results:",C),y&&N){const g=new Map;N.forEach(i=>{i.result&&g.set(`${i.gw}:${i.fixture_index}`,i.result)});let n=0,l=0;y.forEach(i=>{const u=g.get(`${i.gw}:${i.fixture_index}`);u&&(l++,i.pick===u&&n++)}),l>0&&(s.correctPredictionRate=n/l*100)}const{data:P}=await T.from("app_v_gw_points").select("gw, points").eq("user_id",a).order("gw",{ascending:!0});if(P&&P.length>0){const g=P.reduce((c,o)=>c+(o.points||0),0);s.avgPointsPerWeek=g/P.length;const n=new Set,{data:l}=await T.from("app_gw_results").select("gw").order("gw",{ascending:!0});l?.forEach(c=>{n.add(c.gw)});const{data:i}=await T.from("app_v_gw_points").select("gw, user_id, points").in("gw",Array.from(n)),u=new Map,x=new Map;i&&i.forEach(c=>{const o=c.gw;x.has(o)||x.set(o,[]),x.get(o).push({user_id:c.user_id,points:c.points||0})});for(const c of Array.from(n).sort((o,S)=>o-S)){const o=x.get(c);if(o&&o.length>0){const S=o.map(W=>W.points),j=o.find(W=>W.user_id===a)?.points||0,L=O(j,S);u.set(c,L)}}let _=0,R=0,G=0,E=0,t=0;const d=Array.from(n).sort((c,o)=>c-o);console.log("[userStats] Calculating best streak. Completed GWs:",d),console.log("[userStats] User percentiles per GW:",Array.from(u.entries()).map(([c,o])=>({gw:c,percentile:o.toFixed(2),inTop25:o>=75})));for(const c of d){const o=u.get(c);o!==void 0&&o>=75?(_===0&&(t=c),_++,_>R&&(R=_,G=t,E=c)):(_>0&&console.log(`[userStats] Streak broken at GW${c} (percentile: ${o?.toFixed(2)||"N/A"}). Previous streak was ${_} games`),_=0)}s.bestStreak=R,R>0?(s.bestStreakGwRange=`GW${G}–GW${E}`,console.log(`[userStats] Best streak: ${R} games from ${s.bestStreakGwRange}`)):console.log("[userStats] No streak found (user never in top 25%)");let r={points:-1,gw:0},f={points:999,gw:0};P.forEach(c=>{const o=c.points||0;o>r.points&&(r={points:o,gw:c.gw}),o<f.points&&(f={points:o,gw:c.gw})}),r.points>=0&&(s.bestSingleGw=r),f.points<999&&(s.lowestSingleGw=f);const k=[],U=new Map;x.forEach((c,o)=>{const S=c.reduce((j,L)=>j+L.points,0)/c.length;U.set(o,S)}),P.forEach(c=>{const o=c.gw,S=c.points||0,j=U.get(o);j!==void 0&&k.push({gw:o,userPoints:S,averagePoints:j})}),k.sort((c,o)=>c.gw-o.gw),s.weeklyParData=k.length>0?k:null;let b={lastGw:0,form5:0,form10:0,overall:0};if(l&&i){console.log("[userStats] Calculating trophy cabinet...");const c=[...new Set(l.map(j=>j.gw))].sort((j,L)=>j-L),{data:o}=await T.from("app_v_gw_points").select("user_id, gw, points").order("gw",{ascending:!0}),{data:S}=await T.from("app_v_ocp_overall").select("user_id, name, ocp");c.forEach(j=>{const L=ee(a,j,o||[]);if(L&&L.rank===1&&b.lastGw++,j>=5){const F=z(a,j-4,j,o||[],S||[]);F&&F.rank===1&&b.form5++}if(j>=10){const F=z(a,j-9,j,o||[],S||[]);F&&F.rank===1&&b.form10++}const W=new Set;(o||[]).forEach(F=>{F.gw<=j&&W.add(F.user_id)});const A=Array.from(W).map(F=>{const J=(o||[]).filter(B=>B.user_id===F&&B.gw<=j).reduce((B,Q)=>B+(Q.points||0),0),X=(S||[]).find(B=>B.user_id===F);return{user_id:F,name:X?.name||null,ocp:J}}),H=te(a,A);H&&H.rank===1&&b.overall++}),console.log("[userStats] Trophy cabinet calculated:",b)}else console.log("[userStats] Skipping trophy calculation - missing data:",{hasCompletedGwResults:!!l,hasAllGwPoints:!!i});s.trophyCabinet=b}else s.trophyCabinet={lastGw:0,form5:0,form10:0,overall:0};if(y&&y.length>0){const g=new Set;if(y.forEach(n=>{g.add(`${n.gw}:${n.fixture_index}`)}),g.size>0){const n=Array.from(g).map(r=>parseInt(r.split(":")[0])),l=new Set(n),[i,u]=await Promise.all([T.from("app_picks").select("gw, fixture_index, pick").in("gw",Array.from(l)),T.from("picks").select("gw, fixture_index, pick").in("gw",Array.from(l))]),x=new Map;u.data&&u.data.forEach(r=>{const f=`${r.gw}:${r.fixture_index}`;if(g.has(f)){x.has(f)||x.set(f,new Map);const k=x.get(f);k.set(r.pick,(k.get(r.pick)||0)+1)}}),i.data&&i.data.forEach(r=>{const f=`${r.gw}:${r.fixture_index}`;if(g.has(f)){x.has(f)||x.set(f,new Map);const k=x.get(f);k.set(r.pick,(k.get(r.pick)||0)+1)}});let _=0;x.forEach(r=>{_+=Array.from(r.values()).reduce((f,k)=>f+k,0)}),console.log(`[userStats] Chaos Index: Checking ${y.length} user picks across ${g.size} fixtures`),console.log(`[userStats] Chaos Index: Found ${_} total picks from all users across all fixtures`);let R=0,G=0,E=0;const t=new Map;N&&N.forEach(r=>{r.result&&t.set(`${r.gw}:${r.fixture_index}`,r.result)});let d=!1;y.forEach(r=>{const f=`${r.gw}:${r.fixture_index}`,k=x.get(f);if(k){const U=Array.from(k.values()).reduce((o,S)=>o+S,0),b=k.get(r.pick)||0,c=U>0?b/U*100:0;if(!d&&U>0){const o=k.get("H")||0,S=k.get("D")||0,j=k.get("A")||0;console.log(`[userStats] Chaos Index sample: GW${r.gw} fixture ${r.fixture_index}, user picked ${r.pick}, totals: H=${o}, D=${S}, A=${j}, total=${U}, userPickPercentage=${c.toFixed(2)}%`),d=!0}if(E++,c<=25){R++;const o=t.get(f);o&&r.pick===o&&G++}}else console.warn(`[userStats] Chaos Index: No pick counts found for ${f}`)}),E>0&&(s.chaosIndex=R/E*100,s.chaosCorrectCount=G,s.chaosTotalCount=R,console.log(`[userStats] Chaos Index: ${s.chaosIndex.toFixed(2)}% (${R} of ${E} picks, ${G} correct)`),console.log(`[userStats] Chaos Index breakdown: ${E} total picks, ${R} chaos picks`))}}if(y&&N){const g=new Map;N.forEach(l=>{l.result&&g.set(`${l.gw}:${l.fixture_index}`,l.result)});const{data:n}=await T.from("app_fixtures").select("gw, fixture_index, home_code, away_code, home_team, away_team, home_name, away_name");if(n){const l=new Map;n.forEach(t=>{l.set(`${t.gw}:${t.fixture_index}`,t)});const i=new Map,u=new Map;y.forEach(t=>{u.set(`${t.gw}:${t.fixture_index}`,t.pick)});const x=[];if(n.forEach(t=>{const d=g.get(`${t.gw}:${t.fixture_index}`),r=u.get(`${t.gw}:${t.fixture_index}`);if(!d||!r)return;const f=t.home_name||t.home_team||"",k=t.away_name||t.away_team||"",U={code:t.home_code,name:t.home_code?Y(t.home_code):f},b={code:t.away_code,name:t.away_code?Y(t.away_code):k},c=r===d;if(U.code){const o=U.code.toUpperCase(),S=i.get(o)||{correct:0,total:0,code:U.code,name:U.name};S.total++,c&&S.correct++,i.set(o,S),(o==="BUR"||U.code.toUpperCase()==="BUR")&&x.push({gw:t.gw,fixture_index:t.fixture_index,home:U.name,away:b.name,pick:r,result:d,isCorrect:c})}if(b.code){const o=b.code.toUpperCase(),S=i.get(o)||{correct:0,total:0,code:b.code,name:b.name};S.total++,c&&S.correct++,i.set(o,S),(o==="BUR"||b.code.toUpperCase()==="BUR")&&x.push({gw:t.gw,fixture_index:t.fixture_index,home:U.name,away:b.name,pick:r,result:d,isCorrect:c})}}),x.length>0){console.log("[userStats] Burnley picks breakdown:",JSON.stringify(x,null,2));const t=i.get("BUR");t&&console.log("[userStats] Burnley final stats:",{correct:t.correct,total:t.total,percentage:(t.correct/t.total*100).toFixed(2)+"%"})}const _=Array.from(i.entries()).map(([t,d])=>({code:t,name:d.name,correct:d.correct,total:d.total,percentage:(d.correct/d.total*100).toFixed(2)}));console.log("[userStats] All team prediction stats:",JSON.stringify(_,null,2)),console.log("[userStats] Teams with >= 3 picks:",JSON.stringify(_.filter(t=>t.total>=3),null,2));let R=0;i.forEach(t=>{R+=t.total}),console.log("[userStats] Total picks processed for team stats:",R),console.log("[userStats] Total picks with fixtures and results:",y.filter(t=>{const d=l.get(`${t.gw}:${t.fixture_index}`),r=g.get(`${t.gw}:${t.fixture_index}`);return d&&r}).length);let G=null,E=null;i.forEach((t,d)=>{if(t.total>=3){const r=t.correct/t.total*100,f=(t.total-t.correct)/t.total*100;(!G||r>G.percentage)&&(G={code:t.code,name:t.name,percentage:r}),(!E||f>E.percentage)&&(E={code:t.code,name:t.name,percentage:f})}}),s.mostCorrectTeam=G,s.mostIncorrectTeam=E}}}catch(h){console.error("Error fetching user stats:",h)}return s}function ge({value:a,onChange:s,labels:h}){const m=h?.off||"ALL",p=h?.on||"LIVE";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-medium transition-colors ${a?"text-slate-400":"text-slate-700"}`,children:m}),e.jsx("button",{onClick:()=>s(!a),className:"relative inline-flex items-center rounded-full transition-colors focus:outline-none",style:{backgroundColor:a?"#dc2626":"#cbd5e1",width:"48px",height:"24px",border:"none"},"aria-label":a?`Show ${m}`:`Show ${p}`,children:e.jsx("span",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-sm transform transition-transform duration-200 ease-in-out ${a?"translate-x-6":"translate-x-0.5"}`})}),e.jsx("span",{className:`text-[10px] font-medium transition-colors ${a?"text-slate-700":"text-slate-400"}`,children:p})]})}async function he(a){if(!a)return[];try{const s=await le(a);if(s.length===0)return[];const h=s.map(t=>t.id),{data:m,error:p}=await T.from("league_members").select("league_id, user_id").in("league_id",h);if(p)throw p;const w=new Map;m?.forEach(t=>{const d=w.get(t.league_id)||[];d.push(t.user_id),w.set(t.league_id,d)});const{data:v,error:$}=await T.from("app_gw_results").select("gw, fixture_index, result").order("gw",{ascending:!1});if($)throw $;const y=new Map;v?.forEach(t=>{t.result&&y.set(`${t.gw}:${t.fixture_index}`,t.result)});const N=Array.from(new Set(m?.map(t=>t.user_id)||[]));if(N.length===0)return[];const{data:C,error:P}=await T.from("app_picks").select("user_id, gw, fixture_index, pick").in("user_id",N);if(P)throw P;const g=Array.from(new Set(v?.map(t=>t.gw)||[]));if(g.length===0)return[];const{data:n}=await T.from("app_meta").select("current_gw").eq("id",1).maybeSingle(),l=n?.current_gw??Math.max(...g,0),{data:i,error:u}=await T.from("app_fixtures").select("gw, fixture_index, home_team, away_team, home_code, away_code, home_name, away_name, kickoff_time, api_match_id").in("gw",g).order("gw",{ascending:!1}).order("fixture_index",{ascending:!0});if(u)throw u;const x=new Map;i?.forEach(t=>{t.api_match_id||x.set(`${t.gw}:${t.fixture_index}`,t)});const _=[];console.log("[Unicorns] Starting calculation for user:",a),console.log("[Unicorns] User leagues:",s.map(t=>({name:t.name,id:t.id,members:w.get(t.id)?.length||0}))),console.log("[Unicorns] Total results available:",y.size),console.log("[Unicorns] Total picks available:",C?.length||0),console.log("[Unicorns] User picks count:",C?.filter(t=>t.user_id===a).length||0),console.log("[Unicorns] Total fixtures available:",x.size),console.log("[Unicorns] Current GW:",l);for(const t of s){if(t.name==="API Test"){console.log(`[Unicorns] Skipping "${t.name}" - test league`);continue}const d=w.get(t.id)||[];if(d.length<3){console.log(`[Unicorns] Skipping "${t.name}" - only ${d.length} members`);continue}const r=await se(t,l);console.log(`[Unicorns] Processing "${t.name}" with ${d.length} members, start GW: ${r}`);const f=C?.filter(b=>d.includes(b.user_id)&&b.gw>=r)||[];console.log(`[Unicorns] "${t.name}" has ${f.length} picks total (filtered from start GW ${r})`);const k=new Map;f.forEach(b=>{const c=`${b.gw}:${b.fixture_index}`,o=k.get(c)||[];o.push({user_id:b.user_id,pick:b.pick}),k.set(c,o)});let U=0;k.forEach((b,c)=>{const[o,S]=c.split(":").map(Number);if(o<r)return;const j=y.get(c);if(!j)return;const L=b.find(A=>A.user_id===a);if(!L)return;const W=b.filter(A=>A.pick===j).map(A=>A.user_id);if(W.length===1&&W[0]===a&&d.length>=3){const A=x.get(c);A&&(U++,_.push({fixture_index:S,gw:o,home_team:A.home_team,away_team:A.away_team,home_code:A.home_code,away_code:A.away_code,home_name:A.home_name,away_name:A.away_name,kickoff_time:A.kickoff_time,pick:L.pick,league_id:t.id,league_name:t.name}))}}),U>0&&console.log(`[Unicorns] "${t.name}" found ${U} unicorns`)}console.log(`[Unicorns] Found ${_.length} total unicorns before grouping`);const R=new Map;_.forEach(t=>{const d=`${t.gw}:${t.fixture_index}`,r=R.get(d);r?r.league_names.includes(t.league_name)||r.league_names.push(t.league_name):R.set(d,{fixture_index:t.fixture_index,gw:t.gw,home_team:t.home_team,away_team:t.away_team,home_code:t.home_code,away_code:t.away_code,home_name:t.home_name,away_name:t.away_name,kickoff_time:t.kickoff_time,pick:t.pick,league_names:[t.league_name]})});const G=Array.from(R.values()),E=G.filter(t=>t.league_names.includes("Prem Predictions"));return console.log("[Unicorns] Prem Predictions unicorns:",E.map(t=>`GW${t.gw} fixture ${t.fixture_index} (leagues: ${t.league_names.join(", ")})`)),console.log(`[Unicorns] Found ${G.length} unique fixtures after grouping`),G.sort((t,d)=>t.gw!==d.gw?t.gw-d.gw:t.fixture_index-d.fixture_index),G}catch(s){return console.error("[Unicorns] Error fetching unicorns:",s),[]}}function fe({fixture:a,leagueNames:s,isActive:h=!1}){const m=a.home_code||a.home_name||a.home_team||"",p=a.away_code||a.away_name||a.away_team||"",w=q(m)||a.home_name||a.home_team||"Home",v=q(p)||a.away_name||a.away_name||"Away",$=a.pick==="H"?"Home Win":a.pick==="A"?"Away Win":"Draw",y={id:`${a.gw}-${a.fixture_index}`,fixture_index:a.fixture_index,home_team:w,away_team:v,home_code:a.home_code,away_code:a.away_code,home_name:w,away_name:v,kickoff_time:a.kickoff_time},N=h?1:.92,C=h?1:.75;return e.jsxs("div",{className:"flex-shrink-0 relative",style:{scrollSnapAlign:"center",transform:`scale(${N})`,opacity:C,width:"280px",willChange:"transform, opacity",transition:"transform 500ms cubic-bezier(0.4, 0, 0.2, 1), opacity 500ms cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("style",{children:`
        .unicorn-card-wrapper {
          position: relative;
        }
        .unicorn-card-wrapper > div:first-child {
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
          position: relative;
        }
        .unicorn-card-wrapper > div:first-child > div:first-child {
          padding-top: 1.5rem !important;
        }
        .unicorn-card-wrapper .flex.items-center.gap-1\\.5.mt-3 {
          display: none !important;
        }
        .unicorn-card-wrapper > div.absolute {
          box-shadow: none !important;
        }
        .unicorn-card-wrapper::before {
          content: '';
          position: absolute;
          inset: 0;
          border-radius: 1.5rem;
          padding: 10px;
          background: linear-gradient(135deg, #fbbf24, #f97316, #ec4899, #9333ea, #fbbf24);
          background-size: 300% 300%;
          -webkit-mask: 
            linear-gradient(#fff 0 0) content-box, 
            linear-gradient(#fff 0 0);
          -webkit-mask-composite: xor;
          mask-composite: exclude;
          animation: gradient-shift 3s ease infinite;
          pointer-events: none;
          z-index: 100;
        }
        @keyframes gradient-shift {
          0%, 100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .shiny-pick-badge {
          background: linear-gradient(135deg, #fbbf24, #f97316, #ec4899, #9333ea, #fbbf24);
          background-size: 300% 300%;
          animation: gradient-shift 3s ease infinite;
          color: white;
          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
      `}),e.jsxs("div",{className:"relative unicorn-card-wrapper",children:[e.jsx(ae,{fixture:y,showSwipeHint:!1}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 pt-6 px-4 pb-8 rounded-b-3xl",style:{background:"linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.65) 25%, rgba(0, 0, 0, 0.45) 45%, rgba(0, 0, 0, 0.25) 65%, rgba(0, 0, 0, 0.1) 80%, transparent 100%)"},children:[e.jsx("div",{className:"text-white text-sm font-semibold text-center mb-2",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full shiny-pick-badge",children:$})}),e.jsx("div",{className:"text-white text-sm font-semibold text-center",children:s.length===1?s[0]:e.jsx("div",{className:"space-y-1",children:e.jsx("div",{children:s.join(", ")})})}),e.jsxs("div",{className:"text-white/80 text-xs text-center mt-1",children:["GW",a.gw]})]})]})]})}function pe({userId:a,loading:s}){const[h,m]=M.useState([]),[p,w]=M.useState(!0),[v,$]=M.useState(0),[y,N]=M.useState(!1),C=M.useRef(null),P=M.useRef([]);M.useEffect(()=>{if(!a){w(!1);return}let n=!0;async function l(){w(!0);try{const i=await he(a);n&&(P.current=[],m(i),$(0))}catch(i){console.error("[UnicornCollection] Error loading unicorns:",i),n&&(m([]),$(0))}finally{n&&w(!1)}}return l(),()=>{n=!1}},[a]),M.useEffect(()=>{if(h.length===0||!C.current)return;const n=C.current;let l=null,i=!1;const u=()=>{if(!C.current)return;const d=C.current.getBoundingClientRect();if(d.width===0){setTimeout(u,50);return}if(!P.current.every((b,c)=>c>=h.length?!0:b!==null)){setTimeout(u,50);return}if(P.current[0]&&P.current[0].getBoundingClientRect().width===0){setTimeout(u,50);return}const f=d.left+d.width/2;let k=0,U=1/0;P.current.forEach((b,c)=>{if(b&&c<h.length){const o=b.getBoundingClientRect(),S=o.left+o.width/2,j=Math.abs(S-f);j<U&&(U=j,k=c)}}),$(k)},x=()=>{i||(l=requestAnimationFrame(()=>{u(),i=!1}),i=!0)};n.addEventListener("scroll",x,{passive:!0});const _=()=>{n.scrollLeft===0&&P.current[0],u()},R=setTimeout(()=>{_()},0),G=setTimeout(()=>{_()},100),E=setTimeout(()=>{_()},300),t=()=>{u()};return window.addEventListener("resize",t,{passive:!0}),()=>{clearTimeout(R),clearTimeout(G),clearTimeout(E),l!==null&&cancelAnimationFrame(l),n.removeEventListener("scroll",x),window.removeEventListener("resize",t)}},[h.length,h]);const g=s||p;return s?null:g?e.jsxs("div",{className:"bg-white rounded-xl p-6 desktop-constrained-unicorn",style:{marginRight:"-100vw",paddingRight:"100vw"},children:[e.jsx("div",{className:"text-sm font-medium text-slate-600 mb-4 flex items-center gap-2",children:e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Your Unicorns"})}),e.jsx("div",{className:"h-8 bg-slate-200 rounded animate-pulse"})]}):h.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-6",children:[e.jsx("div",{className:"text-sm font-medium text-slate-600 mb-2",children:"Your Unicorns"}),e.jsxs("div",{className:"text-slate-500 text-sm",children:["You have ",e.jsx("span",{className:"font-semibold",children:"0 unicorns"})," overall. Keep predicting to earn your first unicorn!"]})]}):e.jsxs("div",{className:"bg-white rounded-xl p-6 desktop-constrained-unicorn",style:{marginRight:"-100vw",paddingRight:"100vw"},children:[e.jsxs("div",{className:"text-sm font-medium text-slate-600 mb-4 flex items-center gap-2",style:{paddingLeft:"1.5rem",marginLeft:"-1.5rem"},children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Your Unicorns"}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-400 flex items-center justify-center hover:bg-slate-50 transition-colors cursor-pointer",onClick:()=>N(!0),role:"button","aria-label":"Information about Unicorns",children:e.jsx("span",{className:"text-[10px] text-slate-500 font-bold",children:"i"})})]}),e.jsxs("div",{ref:C,className:"flex gap-0 overflow-x-auto pb-2 scrollbar-hide unicorn-scroll-container",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",scrollBehavior:"smooth",scrollSnapType:"x mandatory",marginLeft:"-1.5rem",marginRight:"-1.5rem",paddingLeft:"calc(50vw - 140px + 1.5rem)",paddingRight:"calc(50vw - 140px)",width:"calc(100% + 3rem)"},children:[e.jsx("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),h.map((n,l)=>e.jsx("div",{ref:i=>{P.current[l]=i},children:e.jsx(fe,{fixture:n,leagueNames:n.league_names,isActive:l===v})},`${n.gw}-${n.fixture_index}-${l}`))]}),e.jsxs("div",{className:"text-sm font-bold text-slate-800 mt-4 text-center",children:[h.length," ",h.length===1?"unicorn":"unicorns"," overall"]}),e.jsx(K,{isOpen:y,onClose:()=>N(!1),title:"Unicorns",description:`A unicorn is a unique correct prediction in a mini-league.

Only applies to mini-leagues with 3+ players.

Each card shows the fixture you correctly predicted, what you picked, and which mini-leagues you earned the unicorn in.`})]})}function be(){const{user:a}=ne(),[s,h]=M.useState(null),[m,p]=M.useState(!0),[w,v]=M.useState(!1),[$,y]=M.useState(null),N=M.useRef(null);async function C(){if(a){p(!0);try{console.log("[Stats] Fetching user stats for user:",a.id);const n=await ue(a.id);console.log("[Stats] Fetched stats:",n),console.log("[Stats] Trophy cabinet:",n?.trophyCabinet),h(n)}catch(n){console.error("[Stats] Error loading stats:",n)}finally{p(!1)}}}M.useEffect(()=>{let n=!0;const l=async()=>{const{data:u}=await T.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(n&&u){const x=u?.current_gw??null;y(x)}};l();const i=T.channel("stats-app-meta").on("postgres_changes",{event:"*",schema:"public",table:"app_meta"},()=>{l()}).subscribe();return()=>{n=!1,T.removeChannel(i)}},[]);const{state:P}=oe($,a?.id);if(M.useEffect(()=>{a?C():p(!1)},[a]),M.useEffect(()=>{if(!a||!$||P===null)return;let n=!0;return(async()=>{if(P!=="LIVE"&&P==="RESULTS_PRE_GW"){const{data:i}=await T.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle(),u=i?.gw||null;u&&u!==N.current&&(N.current=u,n&&C());return}})(),()=>{n=!1}},[a,$,P]),!a)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl lg:max-w-[1024px] mx-auto px-4 lg:px-6",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Please sign in to view your stats."})})})});const g=s&&(s.lastCompletedGw!==null||s.overallPercentile!==null);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 overflow-x-hidden",children:[e.jsx("style",{children:`
        @keyframes sparkle {
          0%, 100% {
            opacity: 1;
            transform: scale(1) rotate(0deg);
          }
          25% {
            opacity: 0.9;
            transform: scale(1.05) rotate(-3deg);
          }
          50% {
            opacity: 1;
            transform: scale(1.1) rotate(3deg);
          }
          75% {
            opacity: 0.9;
            transform: scale(1.05) rotate(-3deg);
          }
        }
        .sparkle-trophy {
          animation: sparkle 2s ease-in-out infinite;
          filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6));
        }
        @media (min-width: 1024px) {
          .desktop-constrained-section {
            margin-right: 0 !important;
            padding-right: 1.5rem !important;
          }
          .desktop-constrained-unicorn {
            margin-right: 0 !important;
            padding-right: 1.5rem !important;
          }
          .unicorn-scroll-container {
            margin-left: 0 !important;
            margin-right: 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            width: 100% !important;
          }
        }
      `}),e.jsxs("div",{className:"max-w-4xl lg:max-w-[1024px] mx-auto px-4 lg:px-6 py-6",children:[e.jsxs(re,{to:"/profile",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 mb-4 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:"Back to Profile"})]}),e.jsx(ie,{title:"Stats",as:"h1",className:"mb-6"}),!g&&!m?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-8 text-center",children:[e.jsx("p",{className:"text-slate-600 text-lg",children:"Not enough games yet — check back after a few Gameweeks."}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"The numbers will start to tell a story soon."})]}):e.jsxs("div",{className:"space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0",children:[s&&s.lastCompletedGw!==null&&s.lastCompletedGwPercentile!==null&&(()=>{const n=s.lastCompletedGwPercentile,l=Math.round(100-n),i=Math.round(n),u=n>=75;return e.jsx(I,{label:`Gameweek ${s.lastCompletedGw}`,value:u?`You were in the top ${l}% of players.`:`You were in the bottom ${i}% of players.`,loading:m})})(),s&&s.overallPercentile!==null&&(()=>{const n=s.overallPercentile,l=Math.round(100-n),i=Math.round(n),u=n>=75;return e.jsx(I,{label:"Overall",value:u?`You're in the top ${l}% of players.`:`You're in the bottom ${i}% of players.`,loading:m})})(),s&&s.mostCorrectTeam&&e.jsx(V,{label:"Most correctly predicted team",teamCode:s.mostCorrectTeam.code,teamName:s.mostCorrectTeam.name,percentage:s.mostCorrectTeam.percentage,isCorrect:!0,loading:m}),s&&s.mostIncorrectTeam&&e.jsx(V,{label:"Most incorrectly picked team",teamCode:s.mostIncorrectTeam.code,teamName:s.mostIncorrectTeam.name,percentage:s.mostIncorrectTeam.percentage,isCorrect:!1,loading:m}),s&&s.correctPredictionRate!==null&&e.jsx(I,{label:"Correct prediction rate",value:`${s.correctPredictionRate.toFixed(2)}%`,loading:m}),s&&s.trophyCabinet!==null&&e.jsx("div",{className:"lg:col-span-2",children:e.jsx(me,{lastGw:s.trophyCabinet.lastGw,form5:s.trophyCabinet.form5,form10:s.trophyCabinet.form10,overall:s.trophyCabinet.overall,loading:m})}),a&&e.jsx("div",{className:"lg:col-span-2 lg:overflow-hidden lg:rounded-xl",children:e.jsx(pe,{userId:a.id,loading:m})}),s&&s.chaosIndex!==null&&e.jsx(I,{label:"Chaos Index",value:`${s.chaosIndex.toFixed(2)}%`,subcopy:"How often you pick an outcome that 25% or fewer players picked",loading:m}),s&&s.chaosTotalCount!==null&&s.chaosTotalCount>0&&s.chaosCorrectCount!==null&&e.jsx(I,{label:"Chaos Index Success Rate",value:`${(s.chaosCorrectCount/s.chaosTotalCount*100).toFixed(2)}%`,subcopy:"How often you're right when you pick an outcome that 25% or fewer players picked",loading:m}),s&&s.weeklyParData&&s.weeklyParData.length>0&&s.lastCompletedGw&&(()=>{const l=(s.weeklyParData.filter(i=>i.userPoints>i.averagePoints).length/s.weeklyParData.length*100).toFixed(0);return e.jsxs("div",{className:"lg:col-span-2 desktop-constrained-section bg-white rounded-l-xl lg:rounded-xl shadow-md lg:overflow-hidden",style:{marginRight:"-100vw",paddingRight:"100vw",paddingTop:"1.5rem",paddingBottom:"1.5rem",paddingLeft:"1.5rem"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-slate-600",children:"Weekly Performance vs Average"}),e.jsx("div",{className:"pr-2",children:e.jsx(ge,{value:w,onChange:v,labels:{on:"Complex",off:"Simple"}})})]}),e.jsxs("div",{className:"overflow-x-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",overscrollBehaviorY:"auto",touchAction:"pan-x",marginLeft:"-1.5rem",marginRight:"-1.5rem",paddingLeft:"1.5rem",paddingRight:"1.5rem",width:"calc(100% + 3rem)"},children:[e.jsx("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),e.jsx(de,{weeklyData:s.weeklyParData,latestGw:s.lastCompletedGw,showInfo:w})]}),e.jsxs("div",{className:"text-sm font-bold text-slate-700 mt-2",children:["You perform above average ",l,"% of the time."]})]})})(),s&&s.weeklyParData&&s.weeklyParData.length>0&&(()=>{const n=s.weeklyParData.reduce((i,u)=>i+(u.userPoints-u.averagePoints),0),l=n>=0?`+${n.toFixed(1)}`:n.toFixed(1);return l==="0.0"?null:e.jsx(I,{label:"Total Swing",value:l,subcopy:"Your total points difference from the average across all gameweeks",loading:m})})(),s&&s.bestStreak>0&&s.bestStreakGwRange&&e.jsx(ce,{label:"Most consecutive weeks in the top 25%",streakCount:s.bestStreak,gwRange:s.bestStreakGwRange,loading:m}),s&&s.avgPointsPerWeek!==null&&e.jsx(I,{label:"Avg points / week",value:s.avgPointsPerWeek.toFixed(2),loading:m}),s&&s.bestSingleGw&&e.jsx(I,{label:"Best single Gameweek",value:e.jsxs("span",{children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:s.bestSingleGw.points}),e.jsxs("span",{className:"text-sm text-slate-600 ml-2",children:["on GW",s.bestSingleGw.gw]})]}),loading:m}),s&&s.lowestSingleGw&&e.jsx(I,{label:"Lowest single Gameweek",value:e.jsxs("span",{children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800",children:s.lowestSingleGw.points}),e.jsxs("span",{className:"text-sm text-slate-600 ml-2",children:["on GW",s.lowestSingleGw.gw]})]}),loading:m})]})]})]})}export{be as default};
