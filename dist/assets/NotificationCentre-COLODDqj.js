import{u as G,r as l,q as h,s as N,j as e,L,P as C}from"./index-Bu25J0QH.js";import{N as g}from"./NotificationSection-CBi76uZB.js";function T(){const{user:r}=G(),[j,k]=l.useState(!0),[S,x]=l.useState(!1),[a,y]=l.useState(null),[p,d]=l.useState([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:!0}]),[b,c]=l.useState([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:!0},{id:"score-updates",label:"Match Updates",description:"Get notified about match updates including kickoffs, goals, and scorers",enabled:!0},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:!0},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:!0}]),[w]=l.useState([{id:"system-updates",label:"System Updates",description:"Important updates and announcements",enabled:!0,disabled:!0}]);l.useEffect(()=>{r&&(P(),_())},[r]);async function _(){let t=await h(r?.id||null);t.effectiveState==="not_registered"&&t.hasOsPermission&&(await new Promise(s=>setTimeout(s,500)),t=await h(r?.id||null),t.effectiveState==="not_registered"&&t.hasOsPermission&&(await new Promise(s=>setTimeout(s,500)),t=await h(r?.id||null))),y(t)}async function P(){if(r)try{const{data:t,error:s}=await N.from("user_notification_preferences").select("*").eq("user_id",r.id).maybeSingle();if(s&&s.code!=="PGRST116"&&console.error("Error loading preferences:",s),t){const o=t.preferences||{};d([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:o["chat-messages"]!==!1}]),c([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:o["new-gameweek"]!==!1},{id:"score-updates",label:"Match Updates",description:"Get notified about match updates including kickoffs, goals, and scorers",enabled:o["score-updates"]!==!1},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:o["final-whistle"]!==!1},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:o["gw-results"]!==!1}])}}catch(t){console.error("Error loading notification preferences:",t)}finally{k(!1)}}async function f(t,s,o){if(r){x(!0);try{t==="chat"?d(n=>n.map(i=>i.id===s?{...i,enabled:o}:i)):t==="game"&&c(n=>n.map(i=>i.id===s?{...i,enabled:o}:i));const m=[...p,...b,...w],u={};m.forEach(n=>{n.id===s?u[n.id]=o:u[n.id]=n.enabled});const{error:v}=await N.from("user_notification_preferences").upsert({user_id:r.id,preferences:u,updated_at:new Date().toISOString()},{onConflict:"user_id"});v&&(console.error("Error saving preferences:",v),t==="chat"?d(n=>n.map(i=>i.id===s?{...i,enabled:!o}:i)):t==="game"&&c(n=>n.map(i=>i.id===s?{...i,enabled:!o}:i)))}catch(m){console.error("Error toggling notification:",m)}finally{x(!1)}}}return r?j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Loading notification preferences..."})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(L,{to:"/profile",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 mb-4 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:"Back to Profile"})]}),e.jsx(C,{title:"Notification Centre",as:"h1",className:"mb-6"}),a&&e.jsx("div",{className:`rounded-xl p-4 mb-6 ${a.effectiveState==="allowed"?"bg-green-50 border border-green-200":a.effectiveState==="muted_by_os"?"bg-amber-50 border border-amber-200":"bg-slate-50 border border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[a.effectiveState==="allowed"?e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):a.effectiveState==="muted_by_os"?e.jsx("svg",{className:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):e.jsx("svg",{className:"w-6 h-6 text-slate-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${a.effectiveState==="allowed"?"text-green-800":a.effectiveState==="muted_by_os"?"text-amber-800":"text-slate-700"}`,children:a.effectiveState==="allowed"?"Push Notifications Enabled":a.effectiveState==="muted_by_os"?"Push Notifications Blocked":"Push Notifications Unavailable"}),e.jsx("p",{className:`text-sm mt-1 ${a.effectiveState==="allowed"?"text-green-700":a.effectiveState==="muted_by_os"?"text-amber-700":"text-slate-600"}`,children:a.effectiveState==="allowed"?"You will receive push notifications based on your preferences below.":a.effectiveState==="muted_by_os"?"Notifications are blocked at the iOS level. Please enable them in Settings → Notifications → TotL.":"Push notifications require the TotL app. Download it to receive notifications."})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{title:"Chat Notifications",description:"Control when you receive notifications for mini-league messages",options:p,onToggle:(t,s)=>f("chat",t,s)}),e.jsx(g,{title:"Game Notifications",description:"Stay updated on match results and scores",options:b,onToggle:(t,s)=>f("game",t,s)}),e.jsx(g,{title:"System Notifications",description:"Important updates and announcements",options:w,onToggle:(t,s)=>f("system",t,s)})]}),S&&e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Saving preferences..."})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Please sign in to view your notification preferences."})})})})}export{T as default};
