import{R as y,j as e,u as S,a as h,s as v,L as G,P as C}from"./index-DSeN78nc.js";const E=y.memo(function({id:d,label:c,description:f,enabled:m,onChange:i,disabled:o=!1}){return e.jsxs("div",{className:"flex items-start justify-between py-4 border-b border-slate-200 last:border-b-0",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("label",{htmlFor:d,className:"block text-base font-medium text-slate-800 cursor-pointer",children:c}),f&&e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:f})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",id:d,checked:m,onChange:u=>i(u.target.checked),disabled:o,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#1C8376]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#1C8376] peer-disabled:opacity-50 peer-disabled:cursor-not-allowed"})]})]})}),w=y.memo(function({title:d,description:c,options:f,onToggle:m}){return e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-1",children:d}),c&&e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:c}),e.jsx("div",{className:"space-y-0",children:f.map(i=>e.jsx(E,{id:i.id,label:i.label,description:i.description,enabled:i.enabled,onChange:o=>m(i.id,o),disabled:i.disabled},i.id))})]})});function _(){const{user:l}=S(),[d,c]=h.useState(!0),[f,m]=h.useState(!1),[i,o]=h.useState([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:!0}]),[u,p]=h.useState([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:!0},{id:"score-updates",label:"Score Updates",description:"Get notified when match scores are updated",enabled:!0},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:!0},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:!0}]),[N]=h.useState([{id:"system-updates",label:"System Updates",description:"Important updates and announcements",enabled:!0,disabled:!0}]);h.useEffect(()=>{l&&k()},[l]);async function k(){if(l)try{const{data:s,error:t}=await v.from("user_notification_preferences").select("*").eq("user_id",l.id).maybeSingle();if(t&&t.code!=="PGRST116"&&console.error("Error loading preferences:",t),s){const r=s.preferences||{};o([{id:"chat-messages",label:"Chat Messages",description:"Get notified when someone sends a message in your mini-leagues",enabled:r["chat-messages"]!==!1}]),p([{id:"new-gameweek",label:"New Gameweek Published",description:"Get notified when a new gameweek is published and ready for predictions",enabled:r["new-gameweek"]!==!1},{id:"score-updates",label:"Score Updates",description:"Get notified when match scores are updated",enabled:r["score-updates"]!==!1},{id:"final-whistle",label:"Final Whistle",description:"Get notified when matches finish",enabled:r["final-whistle"]!==!1},{id:"gw-results",label:"Gameweek Results",description:"Get notified when a gameweek is finalized",enabled:r["gw-results"]!==!1}])}}catch(s){console.error("Error loading notification preferences:",s)}finally{c(!1)}}async function x(s,t,r){if(l){m(!0);try{s==="chat"?o(n=>n.map(a=>a.id===t?{...a,enabled:r}:a)):s==="game"&&p(n=>n.map(a=>a.id===t?{...a,enabled:r}:a));const g=[...i,...u,...N],b={};g.forEach(n=>{n.id===t?b[n.id]=r:b[n.id]=n.enabled});const{error:j}=await v.from("user_notification_preferences").upsert({user_id:l.id,preferences:b,updated_at:new Date().toISOString()},{onConflict:"user_id"});j&&(console.error("Error saving preferences:",j),s==="chat"?o(n=>n.map(a=>a.id===t?{...a,enabled:!r}:a)):s==="game"&&p(n=>n.map(a=>a.id===t?{...a,enabled:!r}:a)))}catch(g){console.error("Error toggling notification:",g)}finally{m(!1)}}}return l?d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Loading notification preferences..."})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(G,{to:"/profile",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-800 mb-4 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:"Back to Profile"})]}),e.jsx(C,{title:"Notification Centre",as:"h1",className:"mb-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{title:"Chat Notifications",description:"Control when you receive notifications for mini-league messages",options:i,onToggle:(s,t)=>x("chat",s,t)}),e.jsx(w,{title:"Game Notifications",description:"Stay updated on match results and scores",options:u,onToggle:(s,t)=>x("game",s,t)}),e.jsx(w,{title:"System Notifications",description:"Important updates and announcements",options:N,onToggle:(s,t)=>x("system",s,t)})]}),f&&e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Saving preferences..."})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:e.jsx("p",{className:"text-slate-600",children:"Please sign in to view your notification preferences."})})})})}export{_ as default};
