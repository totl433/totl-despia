import{j as e,u as ft,h as xt,r as u,b as pt,s as j,l as Ne,m as gt,C as yt,R as Ce,D as bt,F as wt,T as Ue,n as vt}from"./index-BNBZPCDH.js";import{S as ze}from"./SwipeCard-CfMV60yb.js";function kt({score:d,total:g,topPercent:h,state:G="finished"}){const w=g>0?d/g*100:0;let v=null;return G==="starting-soon"?v=e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):G==="live"&&(v=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-bold text-red-600",children:"Live"})]})),e.jsx("div",{className:"mb-4 rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[v,e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[d,"/",g]}),h!=null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",h,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${w}%`}})})]})})}function _t({success:d,message:g,onClose:h}){return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[d?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${d?"text-emerald-700":"text-amber-600"}`,children:d?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:g}),h&&e.jsx("button",{onClick:h,className:"mt-4 px-6 py-2 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#1C8376]/90 transition-colors",children:"Close"})]})]})})}function jt(d){let g=0;for(let v=0;v<d.length;v++)g=d.charCodeAt(v)+((g<<5)-g);const h=Math.abs(g%360),G=60+Math.abs(g)%20,w=45+Math.abs(g)%15;return`hsl(${h}, ${G}%, ${w}%)`}function ue(d,g){return d&&qe[d]?qe[d].primary:jt(d||g||"default")}const qe={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function Tt(){const{user:d}=ft(),g=xt(),[h,G]=u.useState(null),[w,v]=u.useState(0),W=(()=>{if(typeof window>"u"||!d?.id)return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1};try{const s=Ne("app_meta")?.current_gw||14,i=`predictions:${d.id}:${s}`,r=Ne(i);if(r&&r.fixtures&&Array.isArray(r.fixtures)&&r.fixtures.length>0){const m=new Map;r.picks&&Array.isArray(r.picks)&&r.picks.forEach(x=>{m.set(x.fixture_index,x)});const n=new Map;return r.results&&Array.isArray(r.results)&&r.results.forEach(x=>{n.set(x.fixture_index,x.result)}),{fixtures:r.fixtures,picks:m,submitted:r.submitted||!1,results:n,loading:!1,picksChecked:!0,submissionChecked:!0}}}catch{}return{fixtures:[],picks:new Map,submitted:!1,results:new Map,loading:!0,picksChecked:!1,submissionChecked:!1}})(),[l,re]=u.useState(W.fixtures),[b,H]=u.useState(W.picks),[L,he]=u.useState(W.results),[D,ie]=u.useState(new Map),Ge=async t=>{try{console.log(`[TestApiPredictions] Fetching team forms from database for GW ${t}...`);const{data:s,error:i}=await j.from("app_team_forms").select("team_code, form").eq("gw",t);if(i){console.warn("[TestApiPredictions] Error fetching team forms from database:",i);return}if(s&&s.length>0){const r=new Map;s.forEach(m=>{const n=m.team_code.toUpperCase().trim(),x=m.form.trim().toUpperCase();n&&x&&r.set(n,x)}),console.log(`[TestApiPredictions] ✓ Loaded ${r.size} team forms from database for GW ${t}`),console.log("[TestApiPredictions] Forms map entries:",Array.from(r.entries())),ie(r)}else console.warn(`[TestApiPredictions] ⚠ No team forms found in database for GW ${t}`),ie(new Map)}catch(s){console.warn("[TestApiPredictions] Error fetching team forms:",s),ie(new Map)}};u.useEffect(()=>{h?Ge(h):ie(new Map)},[h]),u.useEffect(()=>{if(D.size>0&&(console.log("[TestApiPredictions] teamForms state updated:",{size:D.size,entries:Array.from(D.entries()),fixtureCodes:l.length>0?Array.from(new Set([...l.map(t=>t.home_code?.toUpperCase().trim()).filter(Boolean),...l.map(t=>t.away_code?.toUpperCase().trim()).filter(Boolean)])):[]}),l.length>0)){const t=[];l.forEach(s=>{const i=s.home_code?.toUpperCase().trim(),r=s.away_code?.toUpperCase().trim();i&&!D.has(i)&&t.push(`Home: ${i}`),r&&!D.has(r)&&t.push(`Away: ${r}`)}),t.length>0?console.warn("[TestApiPredictions] Missing forms for some teams:",t):console.log("[TestApiPredictions] ✓ All fixture teams have form data")}},[D,l]);const Oe=()=>{if(typeof window>"u")return"cards";try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true"&&(d?.id&&s.endsWith(`_${d.id}`)||!d?.id))return"list"}}catch{}return"cards"},[R,q]=u.useState(()=>{const t=Oe();return W.submitted?"list":t}),[S,ae]=u.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[J,Ee]=u.useState(!1),[U,Pe]=u.useState(!1),[fe,O]=u.useState(null),[Ye,Ve]=u.useState(!1),[xe,Q]=u.useState(null),[pe,Ae]=u.useState(!1),[C,Xe]=u.useState({width:0,height:0}),[oe,Y]=u.useState(W.loading),[Me,ne]=u.useState(W.picksChecked),[Z,V]=u.useState(W.submissionChecked),X=()=>{if(typeof window>"u"||!h||!d?.id)return!1;const t=`test_api_submitted_${h}_${d.id}`;return sessionStorage.getItem(t)==="true"},ee=t=>{if(typeof window>"u"||!h||!d?.id)return;const s=`test_api_submitted_${h}_${d?.id}`;t?sessionStorage.setItem(s,"true"):sessionStorage.removeItem(s)},E=u.useRef(X()),[f,I]=u.useState(()=>{if(W.submitted)return E.current=!0,!0;if(typeof window>"u"||!d?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${d.id}`)&&sessionStorage.getItem(s)==="true")return E.current=!0,!0}}catch{}return!1});u.useEffect(()=>{if(h&&d?.id&&typeof window<"u")try{const t=`test_api_submitted_${h}_${d.id}`;sessionStorage.getItem(t)==="true"&&(q("list"),I(!0),E.current=!0)}catch{}},[h,d?.id]),u.useEffect(()=>{f&&R==="cards"&&q("list")},[f,R]),u.useEffect(()=>{!oe&&!f&&l.length>0&&w===0&&q("cards")},[oe,f,l.length,w]);const[Ke,le]=u.useState(null),[Je,Qe]=u.useState(!1),[ce,Ze]=u.useState([]),[Fe,et]=u.useState(new Set),[Te,tt]=u.useState(null),[De,st]=u.useState([]),{liveScores:ge}=pt(h||void 0,De.length>0?De:void 0),B=u.useMemo(()=>{const t={};return l.forEach(s=>{if(s.api_match_id&&ge.has(s.api_match_id)){const i=ge.get(s.api_match_id);t[s.fixture_index]={homeScore:i.home_score??0,awayScore:i.away_score??0,status:i.status||"SCHEDULED",minute:i.minute,goals:i.goals||null,red_cards:i.red_cards||null,home_team:i.home_team||null,away_team:i.away_team||null}}}),t},[ge,l]),rt=()=>{if(typeof window>"u")return!0;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&sessionStorage.getItem(s)==="true")return!1}}catch{}return!0},ye=u.useRef(rt());u.useEffect(()=>{const t=X();(f||t&&E.current)&&(ye.current=!1)},[f]),u.useEffect(()=>{const t=document.documentElement,s=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const r=setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(r),t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),u.useEffect(()=>{const t=()=>{Xe({width:window.innerWidth,height:window.innerHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),u.useEffect(()=>{const t=w>=l.length,s=R==="cards"&&!t&&l.length>0&&!f,i=document.documentElement,r=document.body,m=document.getElementById("root"),n=()=>{i.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),m&&m.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),m&&m.style.removeProperty("overflow")};if(!s){n();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),r.style.setProperty("overflow","hidden","important"),r.style.setProperty("position","fixed","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("height","100%","important"),r.style.setProperty("top","0","important"),m&&m.style.setProperty("overflow","hidden","important");const x=c=>{c.preventDefault()},a=c=>{c.target.closest('[style*="aspectRatio"]')||c.preventDefault()};return window.addEventListener("wheel",x,{passive:!1}),document.addEventListener("touchmove",a,{passive:!1}),()=>{n(),window.removeEventListener("wheel",x),document.removeEventListener("touchmove",a)}},[R,w,l.length,f]);const K=u.useMemo(()=>l.length===0?!1:l.every(t=>b.has(t.fixture_index)),[l,b]),it=u.useRef(null),be=u.useRef({x:0,y:0}),we=u.useRef(!1);u.useEffect(()=>{let t=!0;return(async()=>{try{let s=null;const{data:i}=await j.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(s=i?.current_gw??14,!s){t&&(re([]),Y(!1));return}G(s);const r=`predictions:${d?.id}:${s}`;let m=!1;try{const o=Ne(r);if(o&&o.fixtures&&Array.isArray(o.fixtures)&&o.fixtures.length>0){if(re(o.fixtures),Y(!1),o.picks&&Array.isArray(o.picks)){const y=new Map;o.picks.forEach(k=>{y.set(k.fixture_index,k)}),H(y)}if(o.submitted!==void 0&&(I(o.submitted),E.current=o.submitted,ee(o.submitted),V(!0)),o.results&&Array.isArray(o.results)){const y=new Map;o.results.forEach(k=>{y.set(k.fixture_index,k.result)}),he(y)}ne(!0),m=!0}}catch{}m||(l.length===0&&Y(!0),ne(!1),V(!1));const{data:n,error:x}=await j.from("app_fixtures").select("*").eq("gw",s).order("fixture_index",{ascending:!0});if(x)throw new Error(`Failed to load test fixtures: ${x.message}`);if(!n||n.length===0){t&&(re([]),Y(!1));return}const a=n.map(o=>({id:o.id||String(o.api_match_id||o.fixture_index),gw:s,fixture_index:o.fixture_index,home_team:o.home_team,away_team:o.away_team,home_code:o.home_code,away_code:o.away_code,home_name:o.home_name,away_name:o.away_name,home_crest:null,away_crest:null,kickoff_time:o.kickoff_time,api_match_id:o.api_match_id||null}));if(t&&(re(a),Y(!1),he(new Map)),a.length>0){const o=new Set;a.forEach(y=>{y.home_code&&o.add(y.home_code.toUpperCase().trim()),y.away_code&&o.add(y.away_code.toUpperCase().trim())}),console.log("[TestApiPredictions] Team codes in fixtures:",Array.from(o))}const c=a.map(o=>o.api_match_id).filter(o=>o!=null);t&&c.length>0&&st(c);let p=!1;if(d?.id&&a.length>0){const{data:o}=await j.from("app_gw_submissions").select("submitted_at").eq("gw",s).eq("user_id",d.id).maybeSingle();if(t&&o?.submitted_at)p=!0,I(!0),q("list"),E.current=!0,ee(!0),V(!0);else{I(!1);const y=X();y&&o?.submitted_at?(I(!0),q("list"),p=!0,E.current=!0):(y&&!o?.submitted_at&&ee(!1),E.current=!1),V(!0)}}else t&&(I(!1),V(!0));let N=!1;if(d?.id&&a.length>0&&!p){const{data:o,error:y}=await j.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",d.id);if(!y&&o&&o.length>0){const k=new Set(a.map(P=>P.fixture_index)),_=o.filter(P=>k.has(P.fixture_index)),F=a.every(P=>_.some(z=>z.fixture_index===P.fixture_index)),$=_.length===a.length;if(F&&$&&_.length>0){const P=new Map;_.forEach(z=>{P.set(z.fixture_index,{fixture_index:z.fixture_index,pick:z.pick,matchday:z.gw||s})}),t&&(H(P),N=!0)}else t&&o.length>0&&(await j.from("app_picks").delete().eq("gw",s).eq("user_id",d.id),H(new Map),N=!1)}}else if(p&&d?.id&&a.length>0){const{data:o,error:y}=await j.from("app_picks").select("gw,fixture_index,pick").eq("gw",s).eq("user_id",d.id);if(!y&&o&&o.length>0){const k=new Set(a.map(F=>F.fixture_index)),_=o.filter(F=>k.has(F.fixture_index));if(_.length===a.length){const F=new Map;_.forEach($=>{F.set($.fixture_index,{fixture_index:$.fixture_index,pick:$.pick,matchday:$.gw||s})}),t&&(H(F),N=!0)}}t&&!N&&(I(!1),await j.from("app_gw_submissions").delete().eq("gw",s).eq("user_id",d.id))}if(t&&a.length>0&&d?.id){const{data:o}=await j.from("leagues").select("id").eq("name","API Test").maybeSingle();if(o){t&&tt(o.id);const{data:y}=await j.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",o.id);if(y){const k=y.map(T=>({id:T.user_id,name:T.profiles?.name||"Unknown"}));t&&Ze(k);const _=k.map(T=>T.id),{data:F}=await j.from("app_gw_submissions").select("user_id, submitted_at").eq("gw",s).in("user_id",_).not("submitted_at","is",null),{data:$}=await j.from("app_picks").select("user_id, fixture_index").eq("gw",s).in("user_id",_),je=new Set(a.map(T=>T.fixture_index)),P=je.size,z=new Date("2025-11-18T00:00:00Z"),Se=new Set;F&&$&&P>0&&F.forEach(T=>{const He=($??[]).filter(se=>se.user_id===T.user_id).filter(se=>je.has(se.fixture_index)),mt=He.length===P,ut=new Set(He.map(se=>se.fixture_index)).size===P,Re=T.submitted_at?new Date(T.submitted_at):null,ht=Re&&Re>=z;mt&&ut&&ht&&Se.add(T.user_id)});const dt=_.length>0&&Se.size===_.length;t&&(Qe(dt),et(Se))}}}if(t&&(ne(!0),Z||V(!0)),t&&a.length>0&&(N&&!p?v(a.length):p&&N||(v(0),q("cards"))),t&&a.length>0&&d?.id&&s)try{const o=[];b.forEach((k,_)=>{o.push({fixture_index:_,pick:k.pick,matchday:k.matchday})});const y=[];L.forEach((k,_)=>{y.push({fixture_index:_,result:k})}),gt(r,{fixtures:a,picks:o,submitted:p,results:y},yt.PREDICTIONS)}catch(o){console.warn("[TestApiPredictions] Failed to cache data:",o)}}catch(s){console.error("Error loading test API data:",s),t&&ne(!0)}finally{t&&Y(!1)}})(),()=>{t=!1}},[d?.id]),u.useEffect(()=>{const t=new Map;l.forEach(i=>{const r=B[i.fixture_index];r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")&&(r.homeScore>r.awayScore?t.set(i.fixture_index,"H"):r.awayScore>r.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),he(t)},[B,l]),u.useEffect(()=>{if(!h||!d?.id||L.size===0||l.length===0){le(null);return}let t=0;if(l.forEach(s=>{const i=L.get(s.fixture_index),r=b.get(s.fixture_index);i&&r&&i===r.pick&&t++}),t===0){le(null);return}(async()=>{try{const{data:s}=await j.from("app_picks").select("user_id, fixture_index, pick").eq("gw",h);if(s){const i=new Map;s.forEach(a=>{const c=L.get(a.fixture_index),p=i.get(a.user_id)||0;c&&c===a.pick?i.set(a.user_id,p+1):i.set(a.user_id,p)});const r=Array.from(i.values()).sort((a,c)=>c-a),m=r.filter(a=>a>=t).length,n=r.length,x=n>0?Math.round(m/n*100):null;le(x)}}catch(s){console.error("[TestApiPredictions] Error calculating top percent:",s),le(null)}})()},[L,b,l,h,d?.id]);const A=l[w],de=u.useMemo(()=>{let t=0;return l.forEach(s=>{const i=L.get(s.fixture_index),r=b.get(s.fixture_index);i&&r&&r.pick===i&&(t+=1)}),t},[l,L,b]),Le=(t,s)=>{U||f||(Ee(!0),be.current={x:t,y:s},O(null))},Ie=(t,s)=>{if(!J||U||f)return;const i=t-be.current.x,r=s-be.current.y,m=i*.1;ae({x:i,y:r,rotation:m,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(r)?O(i>0?"away":"home"):r>50&&r>Math.abs(i)?O("draw"):O(null)},ve=()=>{if(!J||U||f)return;Ee(!1);const{x:t,y:s}=S,i=100;let r=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(s)?r=t>0?"A":"H":s>i&&s>Math.abs(t)&&(r="D"),r?$e(r):(ae({x:0,y:0,rotation:0,opacity:1,scale:1}),O(null))},at=t=>{t.touches.length===1&&Le(t.touches[0].clientX,t.touches[0].clientY)},ot=t=>{t.touches.length===1&&J&&(t.preventDefault(),Ie(t.touches[0].clientX,t.touches[0].clientY))},Be=t=>{t.touches.length>0||(t.preventDefault(),ve())},$e=async t=>{Pe(!0),O(null);const s=t==="H"?-1:t==="A"?1:0,i=s*window.innerWidth,r=t==="D"?window.innerHeight:0;ae({x:i,y:r,rotation:s*30,opacity:0,scale:.8}),await me(t),setTimeout(()=>{we.current=!0,Ye?(v(l.length),Ve(!1)):v(w+1),ae({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{we.current=!1,Pe(!1)})},300)},ke=t=>{!U&&!f&&$e(t)},me=t=>{if(!A||!h)return;const s=new Map(b);s.set(A.fixture_index,{fixture_index:A.fixture_index,pick:t,matchday:h}),H(s)},_e=async()=>{if(!K){Q({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>Q(null),2200);return}if(!(!d?.id||!h))try{const{data:t}=await j.from("app_gw_submissions").select("submitted_at").eq("user_id",d.id).eq("gw",h).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen"),I(!0);return}const s=Array.from(b.values()).filter(m=>m.matchday===h).map(m=>({user_id:d.id,gw:h,fixture_index:m.fixture_index,pick:m.pick}));if(s.length!==l.length)throw new Error(`Expected ${l.length} picks but got ${s.length}`);const{error:i}=await j.from("app_picks").upsert(s,{onConflict:"user_id,gw,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:r}=await j.from("app_gw_submissions").upsert({user_id:d.id,gw:h,submitted_at:new Date().toISOString()},{onConflict:"user_id,gw"});if(r)throw console.error("[TestApiPredictions] Error saving submission:",r),r;I(!0),E.current=!0,ee(!0),d?.id&&vt(d.id),Ae(!0),window.dispatchEvent(new Event("predictionsSubmitted")),sessionStorage.setItem("showConfettiOnHome","true"),g("/"),window.scrollTo({top:0,behavior:"instant"}),setTimeout(()=>{Ae(!1)},1e3),Te&&h&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:Te,matchday:h,isTestApi:!0})}).catch(m=>{console.error("[TestApiPredictions] Failed to check final submission:",m)})}catch(t){console.error("Error confirming test picks:",t),Q({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>Q(null),2200)}};if(oe||l.length===0||!Z||!Me)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(oe&&l.length===0)return e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>g("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"✕"}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:h?`Gameweek ${h}`:"Loading..."})]})})}),e.jsx("div",{className:"flex items-center justify-center flex-1",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1C8376]"})})]});if((!Me||!Z)&&l.length>0)return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})});if(l.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>g("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const nt=X();if(f||!Z&&nt){if(!Je&&ce.length>0){const t=ce.filter(s=>!Fe.has(s.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[pe&&C.width>0&&C.height>0&&e.jsx(Ce,{width:C.width,height:C.height,recycle:!1,numberOfPieces:500,gravity:.3}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>g("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:t})," of ",ce.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:ce.slice().sort((s,i)=>s.name.localeCompare(i.name)).map(s=>{const i=Fe.has(s.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx("td",{className:"px-4 py-3",children:i?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},s.id)})})]})})]})})})]})}return l.forEach(t=>{const s=B[t.fixture_index],i=s&&(s.status==="IN_PLAY"||s.status==="PAUSED"),r=s&&s.status==="FINISHED";if(s&&(i||r)){const m=b.get(t.fixture_index);m&&(m.pick==="H"&&s.homeScore>s.awayScore||m.pick==="A"&&s.awayScore>s.homeScore||m.pick==="D"&&(s.homeScore,s.awayScore))}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[pe&&C.width>0&&C.height>0&&e.jsx(Ce,{width:C.width,height:C.height,recycle:!1,numberOfPieces:500,gravity:.3}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>g("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[(()=>{const t=l.length>0&&l.some(a=>{const c=B[a.fixture_index];return c&&(c.status==="IN_PLAY"||c.status==="PAUSED"||c.status==="FINISHED")}),s=l.length>0&&l.some(a=>{const c=B[a.fixture_index];return c&&(c.status==="IN_PLAY"||c.status==="PAUSED")}),i=l.length>0&&l.every(a=>{const c=B[a.fixture_index];return c&&c.status==="FINISHED"}),r=new Date,m=l.length>0&&l.some(a=>{if(!a.kickoff_time)return!1;const c=new Date(a.kickoff_time),p=B[a.fixture_index];return(!p||p.status!=="IN_PLAY"&&p.status!=="PAUSED"&&p.status!=="FINISHED")&&c>r});let n="finished";s?n="live":m&&!t?n="starting-soon":i?n="finished":t&&(n=s?"live":"finished");let x=0;if(t?l.forEach(a=>{const c=B[a.fixture_index],p=b.get(a.fixture_index);if(c&&p){let N=!1;(p.pick==="H"&&c.homeScore>c.awayScore||p.pick==="A"&&c.awayScore>c.homeScore||p.pick==="D"&&c.homeScore===c.awayScore)&&(N=!0),N&&x++}}):f&&l.forEach(a=>{const c=L.get(a.fixture_index),p=b.get(a.fixture_index);c&&p&&c===p.pick&&x++}),t||f&&l.length>0||m){const a=t?x:f?de:0;return e.jsx(kt,{score:a,total:l.length,topPercent:Ke,state:n})}return null})(),e.jsx("div",{className:"space-y-6 [&>div:first-child]:mt-0",children:(()=>{const t=[];let s="",i=[];return l.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{className:m>0?"mt-6":"",children:[e.jsx(bt,{date:r.label}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:r.items.map((n,x)=>{const a=b.get(n.fixture_index),c=B[n.fixture_index],p={id:n.id,gw:n.gw,fixture_index:n.fixture_index,home_code:n.home_code,away_code:n.away_code,home_team:n.home_team,away_team:n.away_team,home_name:n.home_name,away_name:n.away_name,kickoff_time:n.kickoff_time,api_match_id:n.api_match_id},N=c?{status:c.status,minute:c.minute??null,homeScore:c.homeScore,awayScore:c.awayScore,home_team:c.home_team,away_team:c.away_team,goals:c.goals??void 0,red_cards:c.red_cards??void 0}:null;return e.jsx("li",{className:x>0?"border-t":"",children:e.jsx(wt,{fixture:p,pick:a?.pick,liveScore:N,isTestApi:!0,showPickButtons:!0})},n.id)})})})]},m))})()})]})})]})}const We=X();if(!f&&We&&Z&&(ee(!1),E.current=!1),console.log("[TestApiPredictions] Review mode check - submitted:",f,"ref:",E.current,"sessionStorage:",We),console.log("[TestApiPredictions] Review mode check - currentIndex:",w,"fixtures.length:",l.length,"submitted:",f),w>=l.length)return console.log("[TestApiPredictions] ✅ Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[pe&&C.width>0&&C.height>0&&e.jsx(Ce,{width:C.width,height:C.height,recycle:!1,numberOfPieces:500,gravity:.3}),xe&&e.jsx(_t,{success:xe.success,message:xe.message,onClose:()=>Q(null)}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),K&&!f?e.jsx("button",{onClick:_e,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):f?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"✓ Submitted"}):b.size>0?e.jsx("button",{onClick:_e,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>v(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:f?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let s="",i=[];return l.forEach(r=>{const m=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";m!==s?(i.length>0&&t.push({label:s,items:i}),s=m,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,m)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:r.label}),e.jsx("div",{className:"space-y-4",children:r.items.map(n=>{const x=b.get(n.fixture_index),a=L.get(n.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:n.home_team||n.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Ue,{code:n.home_code,crest:n.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:n.kickoff_time?new Date(n.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(Ue,{code:n.away_code,crest:n.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:n.away_team||n.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(f)return;const c=new Map(b);c.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"H",matchday:h}),H(c),me("H")},disabled:f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${x?.pick==="H"?a&&a==="H"&&x.pick===a?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":a&&(a==="D"||a==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":a==="H"?"bg-gray-300 text-slate-700 border-gray-400":f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(f)return;const c=new Map(b);c.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"D",matchday:h}),H(c),me("D")},disabled:f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${x?.pick==="D"?a&&a==="D"&&x.pick===a?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":a&&(a==="H"||a==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":a==="D"?"bg-gray-300 text-slate-700 border-gray-400":f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(f)return;const c=new Map(b);c.set(n.fixture_index,{fixture_index:n.fixture_index,pick:"A",matchday:h}),H(c),me("A")},disabled:f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${x?.pick==="A"?a&&a==="A"&&x.pick===a?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":a&&(a==="H"||a==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":a==="A"?"bg-gray-300 text-slate-700 border-gray-400":f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},n.id)})})]},m))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:f?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",h," have been confirmed."]}),de>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[de,"/",l.length]})]}):e.jsxs(e.Fragment,{children:[!K&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{onClick:_e,disabled:!K,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:K?"SUBMIT YOUR PREDICTIONS":"Complete All Predictions First"}),!K&&e.jsx("button",{onClick:()=>g("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})})})]});const lt=X(),ct=(()=>{if(typeof window>"u"||!d?.id)return!1;try{for(let t=0;t<sessionStorage.length;t++){const s=sessionStorage.key(t);if(s&&s.startsWith("test_api_submitted_")&&s.endsWith(`_${d.id}`)&&sessionStorage.getItem(s)==="true")return!0}}catch{}return!1})(),M=f||lt&&E.current||ct,te=M?"list":R;return M&&R==="cards"?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})}):!A&&l.length>0?(v(0),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):l.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"No fixtures available"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Check back later for Test GW ",h," fixtures."]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media (max-height: 700px) {
          .swipe-cards-container {
            padding-top: 0 !important;
          }
        }
        @media (min-height: 701px) {
          .swipe-cards-container {
            padding-top: 1.5rem;
          }
        }
      `}),e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[ye.current&&!M&&!f&&te==="cards"&&R==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",style:{display:M?"none":"block"},children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>g("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"✕"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Gameweek ",h]}),!M&&te==="cards"&&e.jsxs("button",{onClick:()=>v(l.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),!M&&te==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-0",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:l.map((t,s)=>{const i=s<w,r=s===w,m=b.has(t.fixture_index),n=m&&!r,x=r?"bg-[#178f72]":m||i?"bg-[#116f59]":"bg-white";return e.jsx("div",{className:`flex items-center justify-center transition-all ${r?"h-2 w-6 rounded-full":"h-3 w-3 rounded-full"} ${x}`,children:n&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})},s)})})})]})}),(M||te==="list")&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>g("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",h," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:de})]})})}),!M&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{q("cards"),v(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}),ye.current&&!M&&!f&&te==="cards"&&R==="cards"&&e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1",style:{height:"100%",paddingBottom:"0"},children:[e.jsxs("div",{className:"swipe-cards-container flex items-start justify-center px-4 relative overflow-hidden flex-1",style:{minHeight:0,width:"100%"},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"←"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"→"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${fe==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"↓"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75",display:M?"none":"block"},children:[w<l.length-1&&(()=>{const t=l[w+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:J||U?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsx(ze,{fixture:t,homeColor:ue(t.home_code,t.home_name),awayColor:ue(t.away_code,t.away_name),showSwipeHint:!1,homeForm:D.get((t.home_code||"").toUpperCase().trim())||null,awayForm:D.get((t.away_code||"").toUpperCase().trim())||null})},w+1)})(),e.jsx("div",{className:"absolute inset-0 z-10",style:{transform:`translate(${S.x}px, ${S.y}px) rotate(${S.rotation}deg) scale(${S.scale})`,opacity:S.opacity,transition:J||we.current?"none":"all 0.3s ease-out",pointerEvents:"none",display:M?"none":"block"},children:e.jsx(ze,{fixture:A,homeColor:ue(A.home_code,A.home_name),awayColor:ue(A.away_code,A.away_name),showSwipeHint:!0,homeForm:D.get((A.home_code||"").toUpperCase().trim())||null,awayForm:D.get((A.away_code||"").toUpperCase().trim())||null})}),e.jsx("div",{ref:it,className:"absolute inset-0 z-50 cursor-grab active:cursor-grabbing",style:{touchAction:"none",WebkitTouchCallout:"none",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"auto",backgroundColor:"transparent",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",margin:0,padding:0},onMouseDown:t=>{t.preventDefault(),!f&&Le(t.clientX,t.clientY)},onMouseMove:t=>{t.preventDefault(),!f&&Ie(t.clientX,t.clientY)},onMouseUp:t=>{t.preventDefault(),ve()},onMouseLeave:t=>{t.preventDefault(),ve()},onTouchStart:at,onTouchMove:ot,onTouchEnd:Be,onTouchCancel:Be})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-4 bg-[#eef4f3] z-[10000] safe-area-inset-bottom",style:{paddingBottom:"calc(2rem + env(safe-area-inset-bottom, 0px))",paddingTop:"1.5rem"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>ke("H"),disabled:U||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:S.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(S.x)/150)})`:void 0,color:S.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>ke("D"),disabled:U||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:S.y>30?`rgba(59, 130, 246, ${Math.min(.8,S.y/150)})`:void 0,color:S.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>ke("A"),disabled:U||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:S.x>30?`rgba(34, 197, 94, ${Math.min(.8,S.x/150)})`:void 0,color:S.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]})]})}export{Tt as default};
