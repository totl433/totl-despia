import{j as e,u as Ze,d as et,r as p,s as T}from"./index-ByaaQl1E.js";function tt({code:u,size:b=22,className:g="",rounded:$=!1}){const x=`/assets/badges/${u}.png`,L=`${u} badge`;return e.jsx("img",{src:x,alt:L,width:b,height:b,className:`${$?"rounded-full":"rounded"} object-contain inline-block align-middle select-none ${g}`,loading:"lazy",onError:A=>{A.currentTarget.style.opacity="0.35"}})}function st(u){let b=0;for(let L=0;L<u.length;L++)b=u.charCodeAt(L)+((b<<5)-b);const g=Math.abs(b%360),$=60+Math.abs(b)%20,x=45+Math.abs(b)%15;return`hsl(${g}, ${$}%, ${x}%)`}function ce(u,b){return u&&Me[u]?Me[u].primary:st(u||b||"default")}function it(u,b){if(u==="FINISHED")return"FT";if(u==="PAUSED")return"HT";if(u==="IN_PLAY"){if(b==null)return"LIVE";if(b>=1&&b<=45)return"First Half";if(b>45&&b<=50)return"45+";if(b>50)return"Second Half"}return"LIVE"}function Q({code:u,crest:b,size:g=22,className:$=""}){const[x,L]=p.useState(!1);return b&&!x?e.jsx("img",{src:b,alt:`${u||"Team"} badge`,width:g,height:g,className:`rounded object-contain inline-block align-middle select-none ${$}`,loading:"lazy",onError:()=>{L(!0)}}):u?e.jsx(tt,{code:u,size:g,className:$}):e.jsx("div",{className:`rounded bg-slate-200 ${$}`,style:{width:g,height:g}})}const Me={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function at(){const{user:u}=Ze(),b=et(),[g,$]=p.useState(null),[x,L]=p.useState([]),[A,H]=p.useState(new Map),[ie,we]=p.useState(new Map),[F,B]=p.useState(0),[X,$e]=p.useState("cards"),[C,re]=p.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[Z,je]=p.useState(!1),[R,Ne]=p.useState(!1),[de,K]=p.useState(null),[Be,He]=p.useState(!1),[ee,J]=p.useState(null),[_e,me]=p.useState(!0),[ke,ue]=p.useState(!1),[xe,te]=p.useState(!1),[f,W]=p.useState(!1),[_,Re]=p.useState(!1),[We,Ge]=p.useState(!1),[ae,qe]=p.useState([]),[Se,Ye]=p.useState(new Set),[Pe,Ue]=p.useState(null),[G,Te]=p.useState({}),Ae=p.useRef({}),q=()=>{if(typeof window>"u")return!1;const t=`test_api_submitted_${g}_${u?.id}`;return sessionStorage.getItem(t)==="true"},he=t=>{if(typeof window>"u"||!g||!u?.id)return;const r=`test_api_submitted_${g}_${u?.id}`;t?sessionStorage.setItem(r,"true"):sessionStorage.removeItem(r)},Y=p.useRef(q());p.useEffect(()=>{const t=document.documentElement,r=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const s=setTimeout(()=>{t.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(s),t.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),p.useEffect(()=>{const t=F>=x.length,r=X==="cards"&&!t&&x.length>0&&!f,i=document.documentElement,s=document.body,l=document.getElementById("root"),o=()=>{i.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),l&&l.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),l&&l.style.removeProperty("overflow")};if(!r){o();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),s.style.setProperty("overflow","hidden","important"),s.style.setProperty("position","fixed","important"),s.style.setProperty("width","100%","important"),s.style.setProperty("height","100%","important"),s.style.setProperty("top","0","important"),l&&l.style.setProperty("overflow","hidden","important");const n=a=>{a.preventDefault()},c=a=>{a.target.closest('[style*="aspectRatio"]')||a.preventDefault()};return window.addEventListener("wheel",n,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),()=>{o(),window.removeEventListener("wheel",n),document.removeEventListener("touchmove",c)}},[X,F,x.length,f]);const se=p.useMemo(()=>x.length===0?!1:x.every(t=>A.has(t.fixture_index)),[x,A]),ze=p.useRef(null),fe=p.useRef({x:0,y:0}),pe=p.useRef(!1);p.useEffect(()=>{let t=!0;return(async()=>{try{me(!0),ue(!1),te(!1);const{data:r}=await T.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle(),i=r?.current_test_gw??1;$(i);const{data:s,error:l}=await T.from("test_api_fixtures").select("*").eq("test_gw",i).order("fixture_index",{ascending:!0});if(l)throw new Error(`Failed to load test fixtures: ${l.message}`);if(!s||s.length===0){t&&(L([]),me(!1));return}const o=s.map(a=>({id:String(a.api_match_id),gw:i,fixture_index:a.fixture_index,home_team:a.home_team,away_team:a.away_team,home_code:a.home_code,away_code:a.away_code,home_name:a.home_name,away_name:a.away_name,home_crest:a.home_crest||null,away_crest:a.away_crest||null,kickoff_time:a.kickoff_time,api_match_id:a.api_match_id||null}));if(t){if(L(o),o.length>0&&o[0].kickoff_time){const a=o.reduce((h,v)=>{if(!v.kickoff_time)return h;const d=new Date(v.kickoff_time);return!h||d<h?d:h},null);if(a){const h=new Date(a.getTime()-45e5);Re(new Date().getTime()>h.getTime())}}we(new Map)}let n=!1;if(u?.id&&o.length>0){const{data:a}=await T.from("test_api_submissions").select("submitted_at").eq("matchday",i).eq("user_id",u.id).maybeSingle();t&&a?.submitted_at?(n=!0,W(!0),Y.current=!0,he(!0),te(!0)):(W(!1),Y.current&&(W(!0),n=!0),te(!0))}else t&&(W(!1),te(!0));let c=!1;if(u?.id&&o.length>0&&!n){const{data:a,error:h}=await T.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",i).eq("user_id",u.id);if(!h&&a&&a.length>0){const v=new Set(o.map(S=>S.fixture_index)),d=a.filter(S=>v.has(S.fixture_index)),m=o.every(S=>d.some(I=>I.fixture_index===S.fixture_index)),k=d.length===o.length;if(m&&k&&d.length>0){const S=new Map;d.forEach(I=>{S.set(I.fixture_index,{fixture_index:I.fixture_index,pick:I.pick,matchday:I.matchday})}),t&&(H(S),c=!0)}else t&&a.length>0&&(console.log("[TestApiPredictions] Picks found but don't match current fixtures - clearing old picks"),await T.from("test_api_picks").delete().eq("matchday",i).eq("user_id",u.id),H(new Map),c=!1)}}else if(n&&u?.id&&o.length>0){const{data:a,error:h}=await T.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",i).eq("user_id",u.id);if(!h&&a&&a.length>0){const v=new Set(o.map(m=>m.fixture_index)),d=a.filter(m=>v.has(m.fixture_index));if(d.length===o.length){const m=new Map;d.forEach(k=>{m.set(k.fixture_index,{fixture_index:k.fixture_index,pick:k.pick,matchday:k.matchday})}),t&&(H(m),c=!0)}}t&&!c&&(W(!1),await T.from("test_api_submissions").delete().eq("matchday",i).eq("user_id",u.id))}if(t&&o.length>0&&u?.id){const{data:a}=await T.from("leagues").select("id").eq("name","API Test").maybeSingle();if(a){t&&Ue(a.id);const{data:h}=await T.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",a.id);if(h){const v=h.map(w=>({id:w.user_id,name:w.profiles?.name||"Unknown"}));t&&qe(v);const d=v.map(w=>w.id),{data:m}=await T.from("test_api_submissions").select("user_id, submitted_at").eq("matchday",i).in("user_id",d).not("submitted_at","is",null),{data:k}=await T.from("test_api_picks").select("user_id, fixture_index").eq("matchday",i).in("user_id",d),M=new Set(o.map(w=>w.fixture_index)),S=M.size,I=new Date("2025-11-18T00:00:00Z"),P=new Set;m&&k&&S>0&&m.forEach(w=>{const z=(k??[]).filter(V=>V.user_id===w.user_id).filter(V=>M.has(V.fixture_index)),O=z.length===S,y=new Set(z.map(V=>V.fixture_index)).size===S,D=w.submitted_at?new Date(w.submitted_at):null,oe=D&&D>=I;O&&y&&oe&&P.add(w.user_id)});const U=d.length>0&&P.size===d.length;t&&(Ge(U),Ye(P))}}}t&&(ue(!0),xe||te(!0)),t&&o.length>0&&(c&&!n?B(o.length):n&&c||B(0))}catch(r){console.error("Error loading test API data:",r),t&&ue(!0)}finally{t&&me(!1)}})(),()=>{t=!1}},[u?.id]);const Ce=async(t,r)=>{try{console.log("[TestApiPredictions] fetchLiveScore called for matchId:",t,"kickoffTime:",r);const{data:i,error:s}=await T.from("live_scores").select("*").eq("api_match_id",t).single();if(s)return s.code==="PGRST116"?(console.log("[TestApiPredictions] No live score found in Supabase for match",t,"- scheduled function may not have run yet"),null):(console.error("[TestApiPredictions] Error fetching live score from Supabase:",s),null);if(!i)return console.warn("[TestApiPredictions] No live score data in Supabase"),null;console.log("[TestApiPredictions] Live score from Supabase:",i);const l=i.home_score??0,o=i.away_score??0,n=i.status||"SCHEDULED";let c=i.minute;if(c==null&&(n==="IN_PLAY"||n==="PAUSED")&&r)try{const h=new Date(r),d=Math.floor((new Date().getTime()-h.getTime())/(1e3*60));d>0&&d<120&&(n==="PAUSED"?c=null:n==="IN_PLAY"&&(d<=50?c=d:c=46+Math.max(0,d-50)))}catch(h){console.warn("[TestApiPredictions] Error calculating minute from kickoff time:",h)}const a={homeScore:l,awayScore:o,status:n,minute:c,retryAfter:null};return console.log("[TestApiPredictions] Returning score data from Supabase:",a),a}catch(i){return console.error("[TestApiPredictions] Error fetching live score from Supabase:",i?.message||i,i?.stack),null}};p.useEffect(()=>{if(!x.length)return;const t=x.slice(0,3).filter(s=>s.api_match_id&&s.kickoff_time);if(t.length===0)return;const r=new Map,i=[];return t.forEach(s=>{if(!s.api_match_id||!s.kickoff_time)return;const l=new Date(s.kickoff_time),o=new Date,n=s.fixture_index,c=()=>{const a=G[n];if(a&&a.status==="FINISHED")return;const h=new Map,v=async()=>{const m=await Ce(s.api_match_id,s.kickoff_time);if(m){const k=m.status==="IN_PLAY"||m.status==="PAUSED",M=m.status==="HALF_TIME"||m.status==="HT",S=m.status==="FINISHED";console.log("[TestApiPredictions] Poll result for fixture",n,":",{status:m.status,isLive:k,isHalfTime:M,isFinished:S,homeScore:m.homeScore,awayScore:m.awayScore,minute:m.minute,apiMatchId:s.api_match_id}),!k&&!S&&!M&&console.warn("[TestApiPredictions] Game",n,"has status",m.status,"but is not detected as live"),G[n]?.status==="PAUSED"&&m.status==="IN_PLAY"&&(Ae.current[s.api_match_id]=new Date,console.log("[TestApiPredictions] Halftime ended for fixture",n,"match",s.api_match_id));let P=m.minute;const U=Ae.current[s.api_match_id];if(m.status==="IN_PLAY"&&U){const E=Math.floor((new Date().getTime()-U.getTime())/(1e3*60));P=46+E,console.log("[TestApiPredictions] Recalculated minute from halftime end:",{fixtureIndex:n,apiMatchId:s.api_match_id,originalMinute:m.minute,finalMinute:P,minutesSinceHalftimeEnd:E})}if(Te(w=>({...w,[n]:{homeScore:m.homeScore,awayScore:m.awayScore,status:m.status,minute:P??null}})),S){console.log("[TestApiPredictions] Game",n,"finished, stopping polling");const w=r.get(n);w&&(clearInterval(w),r.delete(n));const E=h.get(n);E&&(clearTimeout(E),h.delete(n))}else if(M){console.log("[TestApiPredictions] Game",n,"at half-time, stopping polling, will resume in 15 minutes");const w=r.get(n);w&&(clearInterval(w),r.delete(n));const E=h.get(n);E&&clearTimeout(E);const z=setTimeout(()=>{console.log("[TestApiPredictions] Resuming polling for fixture",n,"after half-time");const O=async()=>{const y=await Ce(s.api_match_id);if(y){const D=y.status==="FINISHED",oe=y.status==="IN_PLAY"||y.status==="PAUSED",V=y.status==="HALF_TIME"||y.status==="HT";if(Te(le=>({...le,[n]:{homeScore:y.homeScore,awayScore:y.awayScore,status:y.status,minute:y.minute??null}})),D){console.log("[TestApiPredictions] Game",n,"finished, stopping polling");const le=r.get(n);le&&(clearInterval(le),r.delete(n)),h.delete(n)}else oe?console.log("[TestApiPredictions] Game",n,"second half started - status:",y.status,"minute:",y.minute):V&&console.log("[TestApiPredictions] Game",n,"still at half-time, continuing to poll...")}};O();const N=setInterval(O,60*1e3);r.set(n,N),h.delete(n)},900*1e3);h.set(n,z)}else k&&console.log("[TestApiPredictions] Game",n,"is LIVE - status:",m.status,"minute:",m.minute)}};v();const d=setInterval(v,60*1e3);r.set(n,d)};if(l>o){const a=l.getTime()-o.getTime(),h=setTimeout(c,a);i.push(h)}else c()}),()=>{console.log("[TestApiPredictions] Cleaning up polling intervals and timeouts"),r.forEach(clearInterval),i.forEach(clearTimeout)}},[x.map(t=>t.api_match_id).join(",")]),p.useEffect(()=>{const t=new Map;x.slice(0,3).forEach(i=>{const s=G[i.fixture_index];s&&(s.status==="IN_PLAY"||s.status==="PAUSED"||s.status==="FINISHED")&&(s.homeScore>s.awayScore?t.set(i.fixture_index,"H"):s.awayScore>s.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),we(t)},[G,x]);const j=x[F],ge=p.useMemo(()=>{let t=0;return x.forEach(r=>{const i=ie.get(r.fixture_index),s=A.get(r.fixture_index);i&&s&&s.pick===i&&(t+=1)}),t},[x,ie,A]),Ee=(t,r)=>{R||_||f||(je(!0),fe.current={x:t,y:r},K(null))},De=(t,r)=>{if(!Z||R||_||f)return;const i=t-fe.current.x,s=r-fe.current.y,l=i*.1;re({x:i,y:s,rotation:l,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(s)?K(i>0?"away":"home"):s>50&&s>Math.abs(i)?K("draw"):K(null)},be=()=>{if(!Z||R||_||f)return;je(!1);const{x:t,y:r}=C,i=100;let s=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(r)?s=t>0?"A":"H":r>i&&r>Math.abs(t)&&(s="D"),s?Fe(s):(re({x:0,y:0,rotation:0,opacity:1,scale:1}),K(null))},Oe=t=>{t.touches.length===1&&Ee(t.touches[0].clientX,t.touches[0].clientY)},Ve=t=>{t.touches.length===1&&Z&&(t.preventDefault(),De(t.touches[0].clientX,t.touches[0].clientY))},Xe=t=>{t.touches.length>0||(t.preventDefault(),be())},Fe=async t=>{Ne(!0),K(null);const r=t==="H"?-1:t==="A"?1:0,i=r*window.innerWidth,s=t==="D"?window.innerHeight:0;re({x:i,y:s,rotation:r*30,opacity:0,scale:.8}),await ne(t),setTimeout(()=>{pe.current=!0,Be?(B(x.length),He(!1)):B(F+1),re({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{pe.current=!1,Ne(!1)})},300)},ye=t=>{!R&&!_&&!f&&Fe(t)},ne=async t=>{if(!j||!u?.id||!g)return;const r=new Map(A);r.set(j.fixture_index,{fixture_index:j.fixture_index,pick:t,matchday:g}),H(r);try{const{error:i}=await T.from("test_api_picks").upsert({user_id:u.id,matchday:g,fixture_index:j.fixture_index,pick:t},{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});i&&console.error("Error saving test pick:",i)}catch(i){console.error("Error saving test pick:",i)}},Ke=async()=>{if(!(!u?.id||!g)){H(new Map),B(0),W(!1),Y.current=!1,he(!1);try{const{error:t}=await T.from("test_api_submissions").delete().eq("user_id",u.id).eq("matchday",g);t?console.error("Error deleting test_api_submission:",t):console.log("[TestApiPredictions] Successfully deleted submission on Start Over");const{error:r}=await T.from("test_api_picks").delete().eq("user_id",u.id).eq("matchday",g);r?console.error("Error deleting test_api_picks:",r):console.log("[TestApiPredictions] Successfully deleted picks on Start Over")}catch(t){console.error("Error resetting picks:",t)}}},ve=async()=>{if(!se){J({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>J(null),2200);return}if(!(!u?.id||!g))try{const{data:t}=await T.from("test_api_submissions").select("submitted_at").eq("user_id",u.id).eq("matchday",g).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen if Start Over worked"),W(!0);return}const r=Array.from(A.values()).filter(l=>l.matchday===g).map(l=>({user_id:u.id,matchday:l.matchday,fixture_index:l.fixture_index,pick:l.pick}));if(r.length!==x.length)throw new Error(`Expected ${x.length} picks but got ${r.length}`);const{error:i}=await T.from("test_api_picks").upsert(r,{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:s}=await T.from("test_api_submissions").upsert({user_id:u.id,matchday:g,submitted_at:new Date().toISOString()},{onConflict:"user_id,matchday"});if(s)throw console.error("[TestApiPredictions] Error saving submission:",s),s;console.log("[TestApiPredictions] Successfully confirmed test picks and submission"),W(!0),Y.current=!0,he(!0),J({success:!0,message:"Your test predictions are locked in. Good luck!"}),setTimeout(()=>{J(null)},2500),Pe&&g&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:Pe,matchday:g,isTestApi:!0})}).catch(l=>{console.error("[TestApiPredictions] Failed to check final submission:",l)})}catch(t){console.error("Error confirming test picks:",t),J({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>J(null),2200)}},Je={loading:_e,currentTestGw:!!g,picksChecked:ke,submissionChecked:xe,submitted:f,sessionStorageSubmitted:q()};if(console.log("[TestApiPredictions] Render check - loading state:",Je),_e||!g||!ke||!xe)return console.log("[TestApiPredictions] Showing skeleton loader"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>b("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Test API Predictions"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"h-4 bg-slate-200 rounded w-24"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 bg-slate-200 rounded-full"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-16"}),e.jsx("div",{className:"h-6 w-6 bg-slate-200 rounded-full"})]}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-24"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"}),e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"}),e.jsx("div",{className:"h-16 bg-slate-100 rounded-xl"})]})]},t))})})})]});if(x.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>b("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const Ie=f||q();if(console.log("[TestApiPredictions] Checking if submitted - state:",f,"sessionStorage:",q(),"isUserSubmitted:",Ie),Ie){if(console.log("[TestApiPredictions] ‚úÖ Showing submitted view"),!We&&ae.length>0){const s=ae.filter(l=>!Se.has(l.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>b("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Confirmed Predictions"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:s})," of ",ae.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:ae.slice().sort((l,o)=>l.name.localeCompare(o.name)).map(l=>{const o=Se.has(l.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:l.name}),e.jsx("td",{className:"px-4 py-3",children:o?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},l.id)})})]})})]})})})]})}let t=0,r=0;const i=x.slice(0,3);return i.forEach(s=>{const l=G[s.fixture_index],o=l&&(l.status==="IN_PLAY"||l.status==="PAUSED"),n=l&&l.status==="FINISHED";if(o&&r++,l&&(o||n)){const c=A.get(s.fixture_index);if(c){let a=!1;(c.pick==="H"&&l.homeScore>l.awayScore||c.pick==="A"&&l.awayScore>l.homeScore||c.pick==="D"&&l.homeScore===l.awayScore)&&(a=!0),a&&t++}}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>b("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Confirmed Predictions"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6 [&>div:first-child]:mt-0",children:(()=>{const s=[];let l="",o=[];return x.forEach(n=>{const c=n.kickoff_time?new Date(n.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";c!==l?(o.length>0&&s.push({label:l,items:o}),l=c,o=[n]):o.push(n)}),o.length>0&&s.push({label:l,items:o}),s.map((n,c)=>e.jsxs("div",{className:c>0?"mt-6":"",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3 px-1 flex items-center justify-between",children:[e.jsx("span",{children:n.label}),c===0&&(()=>{if(i.length>0&&i.some(h=>{const v=G[h.fixture_index];return v&&(v.status==="IN_PLAY"||v.status==="PAUSED"||v.status==="FINISHED")})){const h=i.every(v=>{const d=G[v.fixture_index];return d&&d.status==="FINISHED"});return e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-white shadow-lg ${h?"bg-slate-600 shadow-slate-500/30":"bg-red-600 shadow-red-500/30"}`,children:[!h&&r>0&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),h&&e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:h?"Score":"Live"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-lg sm:text-xl font-extrabold",children:t}),e.jsx("span",{className:"text-sm sm:text-base font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-base sm:text-lg font-semibold opacity-80",children:i.length})]})]})}return f&&x.length>0?e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-amber-500 text-white shadow-lg shadow-amber-500/30",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Score"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-lg sm:text-xl font-extrabold",children:"--"}),e.jsx("span",{className:"text-sm sm:text-base font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-base sm:text-lg font-semibold opacity-80",children:x.length})]})]}):null})()]}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:n.items.map((a,h)=>{const v=A.get(a.fixture_index),d=G[a.fixture_index],m=d&&d.status==="IN_PLAY",k=d&&(d.status==="PAUSED"||d.status==="HALF_TIME"||d.status==="HT"),M=a.home_team||a.home_name||"",S=a.away_team||a.away_name||"",I=a.kickoff_time?(()=>{const N=new Date(a.kickoff_time),y=String(N.getUTCHours()).padStart(2,"0"),D=String(N.getUTCMinutes()).padStart(2,"0");return`${y}:${D}`})():"‚Äî",P=d&&d.status==="FINISHED",U=N=>{const y=v?.pick===N;let D=!1;return d&&(N==="H"&&d.homeScore>d.awayScore||N==="A"&&d.awayScore>d.homeScore||N==="D"&&d.homeScore===d.awayScore)&&(D=!0),{isPicked:y,isCorrectResult:D,isCorrect:y&&D,isWrong:y&&(m||P)&&!D}},w=U("H"),E=U("D"),z=U("A"),O=N=>{const y="h-16 rounded-xl border text-sm font-medium transition-all flex items-center justify-center select-none";return N.isCorrect&&P?`${y} bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-4 border-emerald-600 shadow-2xl shadow-yellow-400/40 transform scale-110 rotate-1 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]`:N.isCorrect&&m?`${y} bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50`:N.isCorrectResult&&P?`${y} bg-slate-50 text-slate-600 border-4 border-emerald-600`:N.isWrong&&P?`${y} bg-slate-50 text-slate-600 border-4 animate-[flash-border_1s_ease-in-out_infinite]`:N.isWrong&&m?`${y} bg-slate-50 text-slate-600 border-4 animate-[flash-border_1s_ease-in-out_infinite]`:N.isPicked?`${y} bg-[#1C8376] text-white border-[#1C8376]`:`${y} bg-slate-50 text-slate-600 border-slate-200`};return e.jsx("li",{className:h>0?"border-t":"",children:e.jsxs("div",{className:"p-4 bg-white relative",children:[(m||k)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),P&&!m&&!k&&e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),e.jsxs("div",{className:`grid grid-cols-3 items-center ${m||k?"pt-4":""}`,children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:M})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.home_code&&e.jsx("img",{src:`/assets/badges/${a.home_code.toUpperCase()}.png`,alt:`${M} badge`,className:"h-6 w-6 object-contain",onError:N=>{N.currentTarget.style.opacity="0.35"}}),e.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:d&&(m||k||P)?e.jsxs("span",{className:"font-bold text-base text-slate-900",children:[d.homeScore," - ",d.awayScore]}):e.jsx("span",{children:I})}),a.away_code&&e.jsx("img",{src:`/assets/badges/${a.away_code.toUpperCase()}.png`,alt:`${S} badge`,className:"h-6 w-6 object-contain",onError:N=>{N.currentTarget.style.opacity="0.35"}})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:S})})]}),d&&(m||k||P)&&e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx("span",{className:`text-[10px] font-semibold ${m||k?"text-red-600":"text-slate-500"}`,children:it(d.status,d.minute)})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 relative mt-4",children:[e.jsx("div",{className:`${O(w)} flex items-center justify-center`,children:e.jsx("span",{className:`${w.isCorrect?"font-bold":""} ${w.isWrong&&P?"line-through decoration-2 decoration-black":""}`,children:"Home Win"})}),e.jsx("div",{className:`${O(E)} flex items-center justify-center`,children:e.jsx("span",{className:`${E.isCorrect?"font-bold":""} ${E.isWrong&&P?"line-through decoration-2 decoration-black":""}`,children:"Draw"})}),e.jsx("div",{className:`${O(z)} flex items-center justify-center`,children:e.jsx("span",{className:`${z.isCorrect?"font-bold":""} ${z.isWrong&&P?"line-through decoration-2 decoration-black":""}`,children:"Away Win"})})]})]})},a.id)})})})]},c))})()})})]})}const Qe=f||Y.current||q();if(console.log("[TestApiPredictions] Review mode check - submitted:",f,"ref:",Y.current,"sessionStorage:",q()),Qe&&!f)return console.log("[TestApiPredictions] ‚ö†Ô∏è sessionStorage/ref says submitted but state says no - showing loading"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading..."})});if(console.log("[TestApiPredictions] Review mode check - currentIndex:",F,"fixtures.length:",x.length,"submitted:",f),F>=x.length)return console.log("[TestApiPredictions] ‚úÖ Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ee&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[ee.success?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${ee.success?"text-emerald-700":"text-amber-600"}`,children:ee.success?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:ee.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>B(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),se&&!f?e.jsx("button",{onClick:ve,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):f?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"‚úì Submitted"}):A.size>0?e.jsx("button",{onClick:ve,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>B(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:f?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let r="",i=[];return x.forEach(s=>{const l=s.kickoff_time?new Date(s.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";l!==r?(i.length>0&&t.push({label:r,items:i}),r=l,i=[s]):i.push(s)}),i.length>0&&t.push({label:r,items:i}),t.map((s,l)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:s.label}),e.jsx("div",{className:"space-y-4",children:s.items.map(o=>{const n=A.get(o.fixture_index),c=ie.get(o.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:o.home_team||o.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Q,{code:o.home_code,crest:o.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:o.kickoff_time?new Date(o.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(Q,{code:o.away_code,crest:o.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:o.away_team||o.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(_||f)return;const a=new Map(A);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"H",matchday:g}),H(a),ne("H")},disabled:_||f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="H"?c&&c==="H"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="D"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="H"?"bg-gray-300 text-slate-700 border-gray-400":_||f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(_||f)return;const a=new Map(A);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"D",matchday:g}),H(a),ne("D")},disabled:_||f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="D"?c&&c==="D"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="D"?"bg-gray-300 text-slate-700 border-gray-400":_||f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(_||f)return;const a=new Map(A);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"A",matchday:g}),H(a),ne("A")},disabled:_||f,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="A"?c&&c==="A"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="A"?"bg-gray-300 text-slate-700 border-gray-400":_||f?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},o.id)})})]},l))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[x.length>0&&x[0].kickoff_time&&e.jsxs("div",{className:"rounded-2xl border border-emerald-200 bg-white px-4 py-3 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx("span",{className:"text-lg",children:"‚è±Ô∏è"}),e.jsx("span",{className:"text-sm font-semibold",children:"Deadline"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-base font-bold text-emerald-900",children:new Date(new Date(x[0].kickoff_time).getTime()-4500*1e3).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-[11px] font-medium text-emerald-600",children:"75 mins before first kickoff"})]})]}),f?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",g," have been confirmed."]}),ge>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[ge,"/",x.length]})]}):_?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-red-600 mb-2",children:"Deadline Passed"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Predictions are now closed."})]}):e.jsxs(e.Fragment,{children:[!se&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{onClick:Ke,disabled:f||_,className:"w-full py-3 bg-slate-200 text-slate-700 rounded-2xl font-semibold hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Over"}),e.jsx("button",{onClick:ve,disabled:!se,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:se?"Confirm Predictions (TEST)":"Complete All Predictions First"}),e.jsx("button",{onClick:()=>b("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})]})})]});const Le=f||Y.current||q();return console.log("[TestApiPredictions] üî¥ SWIPE VIEW CHECK - submitted:",f,"ref:",Y.current,"sessionStorage:",q(),"checkSubmittedBeforeSwipe:",Le),Le?(console.log("[TestApiPredictions] üö´ BLOCKING swipe view - user has submitted"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading..."})})):(console.log("[TestApiPredictions] ‚úÖ Showing swipe view - user has NOT submitted"),e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[X==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>b("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"‚úï"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Test GW ",g]}),X==="cards"&&e.jsxs("button",{onClick:()=>B(x.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),X==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-2",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:x.map((t,r)=>{const i=r<F,s=r===F;return e.jsx("div",{className:`flex items-center justify-center transition-all ${s?"h-2 w-6 rounded-full bg-[#178f72]":"h-3 w-3 rounded-full"} ${i&&!s?"bg-[#116f59]":s?"":"bg-white"}`},r)})})})]})}),X==="list"?e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>b("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",g," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:ge})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{$e("cards"),B(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}):e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1 pb-[90px]",style:{height:"100%"},children:[e.jsxs("div",{className:"flex items-center justify-center px-4 relative overflow-hidden pt-2",style:{minHeight:0},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${de==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üê"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${de==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üí"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${de==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üì"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75"},children:[F<x.length-1&&(()=>{const t=x[F+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:Z||R?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8",children:[t.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(t.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Q,{code:t.home_code,crest:t.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.home_team||t.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:t.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(t.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Q,{code:t.away_code,crest:t.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.away_team||t.away_name})]})]})]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{style:{position:"absolute",inset:0,background:ce(t.home_code,t.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:ce(t.away_code,t.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})},F+1)})(),e.jsx("div",{ref:ze,className:"absolute inset-0 z-10 cursor-grab active:cursor-grabbing",style:{transform:`translate(${C.x}px, ${C.y}px) rotate(${C.rotation}deg) scale(${C.scale})`,opacity:C.opacity,transition:Z||pe.current?"none":"all 0.3s ease-out",touchAction:"none"},onMouseDown:t=>!_&&!f&&Ee(t.clientX,t.clientY),onMouseMove:t=>!_&&!f&&De(t.clientX,t.clientY),onMouseUp:be,onMouseLeave:be,onTouchStart:Oe,onTouchMove:Ve,onTouchEnd:Xe,children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8 relative pointer-events-none",children:[e.jsx("div",{className:"absolute top-2 right-4 flex items-center gap-2 text-slate-400 text-xs font-semibold",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/4603/4603384.png",alt:"Swipe gesture icon",className:"w-6 h-6 opacity-80"})}),j.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(j.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Q,{code:j.home_code,crest:j.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:j.home_team||j.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:j.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(j.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Q,{code:j.away_code,crest:j.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:j.away_team||j.away_name})]})]}),(()=>{const t=ie.get(j.fixture_index),r=A.get(j.fixture_index);if(t&&r){const i=r.pick===t;return e.jsxs("div",{className:"text-center mb-4 space-y-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-semibold",children:[e.jsx("span",{children:"üéØ"}),e.jsxs("span",{children:["Result: ",t==="H"?"Home Win":t==="A"?"Away Win":"Draw"]})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold ${i?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx("span",{children:i?"‚úì":"‚úó"}),e.jsx("span",{children:i?"Correct!":"Incorrect"})]})]})}return null})()]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",style:{background:ce(j.home_code,j.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{className:"absolute inset-0",style:{background:ce(j.away_code,j.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 pt-2 px-4 bg-[#eef4f3] z-[10000]",style:{paddingBottom:"calc(5rem + env(safe-area-inset-bottom, 0px))"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>ye("H"),disabled:R||_||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:C.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(C.x)/150)})`:void 0,color:C.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>ye("D"),disabled:R||_||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:C.y>30?`rgba(59, 130, 246, ${Math.min(.8,C.y/150)})`:void 0,color:C.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>ye("A"),disabled:R||_||f,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:C.x>30?`rgba(34, 197, 94, ${Math.min(.8,C.x/150)})`:void 0,color:C.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]}))}export{at as default};
