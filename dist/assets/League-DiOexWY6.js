import{g as jn,r as U,s as ae,j as s,V as Br,a as ir,u as Hr,i as kn,b as vr,T as yr,D as Cn,c as Sn,d as Nn,e as En,f as Tt,h as An,k as Rn,L as _r,l as Jt,m as jr,I as kr,n as Ln,o as Cr}from"./index-CCDaE4_f.js";function Mn(u,f){return f.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(n){if(n!=="default"&&!(n in u)){var t=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(u,n,t.get?t:{enumerable:!0,get:function(){return r[n]}})}}))})),Object.freeze(u)}function Wr(u,f){return new Promise((function(r,n){let t;return Tn(u).then((function(e){try{return t=e,r(new Blob([f.slice(0,2),t,f.slice(2)],{type:"image/jpeg"}))}catch(i){return n(i)}}),n)}))}const Tn=u=>new Promise(((f,r)=>{const n=new FileReader;n.addEventListener("load",(({target:{result:t}})=>{const e=new DataView(t);let i=0;if(e.getUint16(i)!==65496)return r("not a valid JPEG");for(i+=2;;){const c=e.getUint16(i);if(c===65498)break;const w=e.getUint16(i+2);if(c===65505&&e.getUint32(i+4)===1165519206){const g=i+10;let o;switch(e.getUint16(g)){case 18761:o=!0;break;case 19789:o=!1;break;default:return r("TIFF header contains invalid endian")}if(e.getUint16(g+2,o)!==42)return r("TIFF header contains invalid version");const l=e.getUint32(g+4,o),a=g+l+2+12*e.getUint16(g+l,o);for(let h=g+l+2;h<a;h+=12)if(e.getUint16(h,o)==274){if(e.getUint16(h+2,o)!==3)return r("Orientation data type is invalid");if(e.getUint32(h+4,o)!==1)return r("Orientation data count is invalid");e.setUint16(h+8,1,o);break}return f(t.slice(i,i+2+w))}i+=2+w}return f(new Blob)})),n.readAsArrayBuffer(u)}));var Ft={},Dn={get exports(){return Ft},set exports(u){Ft=u}};(function(u){var f,r,n={};Dn.exports=n,n.parse=function(t,e){for(var i=n.bin.readUshort,c=n.bin.readUint,w=0,g={},o=new Uint8Array(t),l=o.length-4;c(o,l)!=101010256;)l--;w=l,w+=4;var a=i(o,w+=4);i(o,w+=2);var h=c(o,w+=2),m=c(o,w+=4);w+=4,w=m;for(var N=0;N<a;N++){c(o,w),w+=4,w+=4,w+=4,c(o,w+=4),h=c(o,w+=4);var R=c(o,w+=4),S=i(o,w+=4),I=i(o,w+2),F=i(o,w+4);w+=6;var D=c(o,w+=8);w+=4,w+=S+I+F,n._readLocal(o,D,g,h,R,e)}return g},n._readLocal=function(t,e,i,c,w,g){var o=n.bin.readUshort,l=n.bin.readUint;l(t,e),o(t,e+=4),o(t,e+=2);var a=o(t,e+=2);l(t,e+=2),l(t,e+=4),e+=4;var h=o(t,e+=8),m=o(t,e+=2);e+=2;var N=n.bin.readUTF8(t,e,h);if(e+=h,e+=m,g)i[N]={size:w,csize:c};else{var R=new Uint8Array(t.buffer,e);if(a==0)i[N]=new Uint8Array(R.buffer.slice(e,e+c));else{if(a!=8)throw"unknown compression method: "+a;var S=new Uint8Array(w);n.inflateRaw(R,S),i[N]=S}}},n.inflateRaw=function(t,e){return n.F.inflate(t,e)},n.inflate=function(t,e){return t[0],t[1],n.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),e)},n.deflate=function(t,e){e==null&&(e={level:6});var i=0,c=new Uint8Array(50+Math.floor(1.1*t.length));c[i]=120,c[i+1]=156,i+=2,i=n.F.deflateRaw(t,c,i,e.level);var w=n.adler(t,0,t.length);return c[i+0]=w>>>24&255,c[i+1]=w>>>16&255,c[i+2]=w>>>8&255,c[i+3]=w>>>0&255,new Uint8Array(c.buffer,0,i+4)},n.deflateRaw=function(t,e){e==null&&(e={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),c=n.F.deflateRaw(t,i,c,e.level);return new Uint8Array(i.buffer,0,c)},n.encode=function(t,e){e==null&&(e=!1);var i=0,c=n.bin.writeUint,w=n.bin.writeUshort,g={};for(var o in t){var l=!n._noNeed(o)&&!e,a=t[o],h=n.crc.crc(a,0,a.length);g[o]={cpr:l,usize:a.length,crc:h,file:l?n.deflateRaw(a):a}}for(var o in g)i+=g[o].file.length+30+46+2*n.bin.sizeUTF8(o);i+=22;var m=new Uint8Array(i),N=0,R=[];for(var o in g){var S=g[o];R.push(N),N=n._writeHeader(m,N,o,S,0)}var I=0,F=N;for(var o in g)S=g[o],R.push(N),N=n._writeHeader(m,N,o,S,1,R[I++]);var D=N-F;return c(m,N,101010256),N+=4,w(m,N+=4,I),w(m,N+=2,I),c(m,N+=2,D),c(m,N+=4,F),N+=4,N+=2,m.buffer},n._noNeed=function(t){var e=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(e)!=-1},n._writeHeader=function(t,e,i,c,w,g){var o=n.bin.writeUint,l=n.bin.writeUshort,a=c.file;return o(t,e,w==0?67324752:33639248),e+=4,w==1&&(e+=2),l(t,e,20),l(t,e+=2,0),l(t,e+=2,c.cpr?8:0),o(t,e+=2,0),o(t,e+=4,c.crc),o(t,e+=4,a.length),o(t,e+=4,c.usize),l(t,e+=4,n.bin.sizeUTF8(i)),l(t,e+=2,0),e+=2,w==1&&(e+=2,e+=2,o(t,e+=6,g),e+=4),e+=n.bin.writeUTF8(t,e,i),w==0&&(t.set(a,e),e+=a.length),e},n.crc={table:(function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var i=e,c=0;c<8;c++)1&i?i=3988292384^i>>>1:i>>>=1;t[e]=i}return t})(),update:function(t,e,i,c){for(var w=0;w<c;w++)t=n.crc.table[255&(t^e[i+w])]^t>>>8;return t},crc:function(t,e,i){return 4294967295^n.crc.update(4294967295,t,e,i)}},n.adler=function(t,e,i){for(var c=1,w=0,g=e,o=e+i;g<o;){for(var l=Math.min(g+5552,o);g<l;)w+=c+=t[g++];c%=65521,w%=65521}return w<<16|c},n.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255,t[e+2]=i>>16&255,t[e+3]=i>>24&255},readASCII:function(t,e,i){for(var c="",w=0;w<i;w++)c+=String.fromCharCode(t[e+w]);return c},writeASCII:function(t,e,i){for(var c=0;c<i.length;c++)t[e+c]=i.charCodeAt(c)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,e,i){for(var c,w="",g=0;g<i;g++)w+="%"+n.bin.pad(t[e+g].toString(16));try{c=decodeURIComponent(w)}catch{return n.bin.readASCII(t,e,i)}return c},writeUTF8:function(t,e,i){for(var c=i.length,w=0,g=0;g<c;g++){var o=i.charCodeAt(g);if((4294967168&o)==0)t[e+w]=o,w++;else if((4294965248&o)==0)t[e+w]=192|o>>6,t[e+w+1]=128|o>>0&63,w+=2;else if((4294901760&o)==0)t[e+w]=224|o>>12,t[e+w+1]=128|o>>6&63,t[e+w+2]=128|o>>0&63,w+=3;else{if((4292870144&o)!=0)throw"e";t[e+w]=240|o>>18,t[e+w+1]=128|o>>12&63,t[e+w+2]=128|o>>6&63,t[e+w+3]=128|o>>0&63,w+=4}}return w},sizeUTF8:function(t){for(var e=t.length,i=0,c=0;c<e;c++){var w=t.charCodeAt(c);if((4294967168&w)==0)i++;else if((4294965248&w)==0)i+=2;else if((4294901760&w)==0)i+=3;else{if((4292870144&w)!=0)throw"e";i+=4}}return i}},n.F={},n.F.deflateRaw=function(t,e,i,c){var w=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],g=n.F.U,o=n.F._goodIndex;n.F._hash;var l=n.F._putsE,a=0,h=i<<3,m=0,N=t.length;if(c==0){for(;a<N;)l(e,h,a+(j=Math.min(65535,N-a))==N?1:0),h=n.F._copyExact(t,a,j,e,h+8),a+=j;return h>>>3}var R=g.lits,S=g.strt,I=g.prev,F=0,D=0,M=0,y=0,P=0,b=0;for(N>2&&(S[b=n.F._hash(t,0)]=0),a=0;a<N;a++){if(P=b,a+1<N-2){b=n.F._hash(t,a+1);var d=a+1&32767;I[d]=S[b],S[b]=d}if(m<=a){(F>14e3||D>26697)&&N-a>100&&(m<a&&(R[F]=a-m,F+=2,m=a),h=n.F._writeBlock(a==N-1||m==N?1:0,R,F,y,t,M,a-M,e,h),F=D=y=0,M=a);var v=0;a<N-2&&(v=n.F._bestMatch(t,a,I,P,Math.min(w[2],N-a),w[3]));var j=v>>>16,k=65535&v;if(v!=0){k=65535&v;var E=o(j=v>>>16,g.of0);g.lhst[257+E]++;var _=o(k,g.df0);g.dhst[_]++,y+=g.exb[E]+g.dxb[_],R[F]=j<<23|a-m,R[F+1]=k<<16|E<<8|_,F+=2,m=a+j}else g.lhst[t[a]]++;D++}}for(M==a&&t.length!=0||(m<a&&(R[F]=a-m,F+=2,m=a),h=n.F._writeBlock(1,R,F,y,t,M,a-M,e,h),F=0,D=0,F=D=y=0,M=a);(7&h)!=0;)h++;return h>>>3},n.F._bestMatch=function(t,e,i,c,w,g){var o=32767&e,l=i[o],a=o-l+32768&32767;if(l==o||c!=n.F._hash(t,e-a))return 0;for(var h=0,m=0,N=Math.min(32767,e);a<=N&&--g!=0&&l!=o;){if(h==0||t[e+h]==t[e+h-a]){var R=n.F._howLong(t,e,a);if(R>h){if(m=a,(h=R)>=w)break;a+2<R&&(R=a+2);for(var S=0,I=0;I<R-2;I++){var F=e-a+I+32768&32767,D=F-i[F]+32768&32767;D>S&&(S=D,l=F)}}}a+=(o=l)-(l=i[o])+32768&32767}return h<<16|m},n.F._howLong=function(t,e,i){if(t[e]!=t[e-i]||t[e+1]!=t[e+1-i]||t[e+2]!=t[e+2-i])return 0;var c=e,w=Math.min(t.length,e+258);for(e+=3;e<w&&t[e]==t[e-i];)e++;return e-c},n.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(t,e,i,c,w,g,o,l,a){var h,m,N,R,S,I,F,D,M,y=n.F.U,P=n.F._putsF,b=n.F._putsE;y.lhst[256]++,m=(h=n.F.getTrees())[0],N=h[1],R=h[2],S=h[3],I=h[4],F=h[5],D=h[6],M=h[7];var d=32+((a+3&7)==0?0:8-(a+3&7))+(o<<3),v=c+n.F.contSize(y.fltree,y.lhst)+n.F.contSize(y.fdtree,y.dhst),j=c+n.F.contSize(y.ltree,y.lhst)+n.F.contSize(y.dtree,y.dhst);j+=14+3*F+n.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var k=0;k<286;k++)y.lhst[k]=0;for(k=0;k<30;k++)y.dhst[k]=0;for(k=0;k<19;k++)y.ihst[k]=0;var E=d<v&&d<j?0:v<j?1:2;if(P(l,a,t),P(l,a+1,E),a+=3,E==0){for(;(7&a)!=0;)a++;a=n.F._copyExact(w,g,o,l,a)}else{var _,A;if(E==1&&(_=y.fltree,A=y.fdtree),E==2){n.F.makeCodes(y.ltree,m),n.F.revCodes(y.ltree,m),n.F.makeCodes(y.dtree,N),n.F.revCodes(y.dtree,N),n.F.makeCodes(y.itree,R),n.F.revCodes(y.itree,R),_=y.ltree,A=y.dtree,b(l,a,S-257),b(l,a+=5,I-1),b(l,a+=5,F-4),a+=4;for(var p=0;p<F;p++)b(l,a+3*p,y.itree[1+(y.ordr[p]<<1)]);a+=3*F,a=n.F._codeTiny(D,y.itree,l,a),a=n.F._codeTiny(M,y.itree,l,a)}for(var x=g,W=0;W<i;W+=2){for(var z=e[W],L=z>>>23,H=x+(8388607&z);x<H;)a=n.F._writeLit(w[x++],_,l,a);if(L!=0){var O=e[W+1],q=O>>16,$=O>>8&255,T=255&O;b(l,a=n.F._writeLit(257+$,_,l,a),L-y.of0[$]),a+=y.exb[$],P(l,a=n.F._writeLit(T,A,l,a),q-y.df0[T]),a+=y.dxb[T],x+=L}}a=n.F._writeLit(256,_,l,a)}return a},n.F._copyExact=function(t,e,i,c,w){var g=w>>>3;return c[g]=i,c[g+1]=i>>>8,c[g+2]=255-c[g],c[g+3]=255-c[g+1],g+=4,c.set(new Uint8Array(t.buffer,e,i),g),w+(i+4<<3)},n.F.getTrees=function(){for(var t=n.F.U,e=n.F._hufTree(t.lhst,t.ltree,15),i=n.F._hufTree(t.dhst,t.dtree,15),c=[],w=n.F._lenCodes(t.ltree,c),g=[],o=n.F._lenCodes(t.dtree,g),l=0;l<c.length;l+=2)t.ihst[c[l]]++;for(l=0;l<g.length;l+=2)t.ihst[g[l]]++;for(var a=n.F._hufTree(t.ihst,t.itree,7),h=19;h>4&&t.itree[1+(t.ordr[h-1]<<1)]==0;)h--;return[e,i,a,w,o,h,c,g]},n.F.getSecond=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(t[i+1]);return e},n.F.nonZero=function(t){for(var e="",i=0;i<t.length;i+=2)t[i+1]!=0&&(e+=(i>>1)+",");return e},n.F.contSize=function(t,e){for(var i=0,c=0;c<e.length;c++)i+=e[c]*t[1+(c<<1)];return i},n.F._codeTiny=function(t,e,i,c){for(var w=0;w<t.length;w+=2){var g=t[w],o=t[w+1];c=n.F._writeLit(g,e,i,c);var l=g==16?2:g==17?3:7;g>15&&(n.F._putsE(i,c,o,l),c+=l)}return c},n.F._lenCodes=function(t,e){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var c=0;c<i;c+=2){var w=t[c+1],g=c+3<i?t[c+3]:-1,o=c+5<i?t[c+5]:-1,l=c==0?-1:t[c-1];if(w==0&&g==w&&o==w){for(var a=c+5;a+2<i&&t[a+2]==w;)a+=2;(h=Math.min(a+1-c>>>1,138))<11?e.push(17,h-3):e.push(18,h-11),c+=2*h-2}else if(w==l&&g==w&&o==w){for(a=c+5;a+2<i&&t[a+2]==w;)a+=2;var h=Math.min(a+1-c>>>1,6);e.push(16,h-3),c+=2*h-2}else e.push(w,0)}return i>>>1},n.F._hufTree=function(t,e,i){var c=[],w=t.length,g=e.length,o=0;for(o=0;o<g;o+=2)e[o]=0,e[o+1]=0;for(o=0;o<w;o++)t[o]!=0&&c.push({lit:o,f:t[o]});var l=c.length,a=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return a=h==0?1:0,e[1+(h<<1)]=1,e[1+(a<<1)]=1,1}c.sort((function(D,M){return D.f-M.f}));var m=c[0],N=c[1],R=0,S=1,I=2;for(c[0]={lit:-1,f:m.f+N.f,l:m,r:N,d:0};S!=l-1;)m=R!=S&&(I==l||c[R].f<c[I].f)?c[R++]:c[I++],N=R!=S&&(I==l||c[R].f<c[I].f)?c[R++]:c[I++],c[S++]={lit:-1,f:m.f+N.f,l:m,r:N};var F=n.F.setDepth(c[S-1],0);for(F>i&&(n.F.restrictDepth(a,i,F),F=i),o=0;o<l;o++)e[1+(a[o].lit<<1)]=a[o].d;return F},n.F.setDepth=function(t,e){return t.lit!=-1?(t.d=e,e):Math.max(n.F.setDepth(t.l,e+1),n.F.setDepth(t.r,e+1))},n.F.restrictDepth=function(t,e,i){var c=0,w=1<<i-e,g=0;for(t.sort((function(l,a){return a.d==l.d?l.f-a.f:a.d-l.d})),c=0;c<t.length&&t[c].d>e;c++){var o=t[c].d;t[c].d=e,g+=w-(1<<i-o)}for(g>>>=i-e;g>0;)(o=t[c].d)<e?(t[c].d++,g-=1<<e-o-1):c++;for(;c>=0;c--)t[c].d==e&&g<0&&(t[c].d--,g++);g!=0&&console.log("debt left")},n.F._goodIndex=function(t,e){var i=0;return e[16|i]<=t&&(i|=16),e[8|i]<=t&&(i|=8),e[4|i]<=t&&(i|=4),e[2|i]<=t&&(i|=2),e[1|i]<=t&&(i|=1),i},n.F._writeLit=function(t,e,i,c){return n.F._putsF(i,c,e[t<<1]),c+e[1+(t<<1)]},n.F.inflate=function(t,e){var i=Uint8Array;if(t[0]==3&&t[1]==0)return e||new i(0);var c=n.F,w=c._bitsF,g=c._bitsE,o=c._decodeTiny,l=c.makeCodes,a=c.codes2map,h=c._get17,m=c.U,N=e==null;N&&(e=new i(t.length>>>2<<3));for(var R,S,I=0,F=0,D=0,M=0,y=0,P=0,b=0,d=0,v=0;I==0;)if(I=w(t,v,1),F=w(t,v+1,2),v+=3,F!=0){if(N&&(e=n.F._check(e,d+(1<<17))),F==1&&(R=m.flmap,S=m.fdmap,P=511,b=31),F==2){D=g(t,v,5)+257,M=g(t,v+5,5)+1,y=g(t,v+10,4)+4,v+=14;for(var j=0;j<38;j+=2)m.itree[j]=0,m.itree[j+1]=0;var k=1;for(j=0;j<y;j++){var E=g(t,v+3*j,3);m.itree[1+(m.ordr[j]<<1)]=E,E>k&&(k=E)}v+=3*y,l(m.itree,k),a(m.itree,k,m.imap),R=m.lmap,S=m.dmap,v=o(m.imap,(1<<k)-1,D+M,t,v,m.ttree);var _=c._copyOut(m.ttree,0,D,m.ltree);P=(1<<_)-1;var A=c._copyOut(m.ttree,D,M,m.dtree);b=(1<<A)-1,l(m.ltree,_),a(m.ltree,_,R),l(m.dtree,A),a(m.dtree,A,S)}for(;;){var p=R[h(t,v)&P];v+=15&p;var x=p>>>4;if(!(x>>>8))e[d++]=x;else{if(x==256)break;var W=d+x-254;if(x>264){var z=m.ldef[x-257];W=d+(z>>>3)+g(t,v,7&z),v+=7&z}var L=S[h(t,v)&b];v+=15&L;var H=L>>>4,O=m.ddef[H],q=(O>>>4)+w(t,v,15&O);for(v+=15&O,N&&(e=n.F._check(e,d+(1<<17)));d<W;)e[d]=e[d++-q],e[d]=e[d++-q],e[d]=e[d++-q],e[d]=e[d++-q];d=W}}}else{(7&v)!=0&&(v+=8-(7&v));var $=4+(v>>>3),T=t[$-4]|t[$-3]<<8;N&&(e=n.F._check(e,d+T)),e.set(new i(t.buffer,t.byteOffset+$,T),d),v=$+T<<3,d+=T}return e.length==d?e:e.slice(0,d)},n.F._check=function(t,e){var i=t.length;if(e<=i)return t;var c=new Uint8Array(Math.max(i<<1,e));return c.set(t,0),c},n.F._decodeTiny=function(t,e,i,c,w,g){for(var o=n.F._bitsE,l=n.F._get17,a=0;a<i;){var h=t[l(c,w)&e];w+=15&h;var m=h>>>4;if(m<=15)g[a]=m,a++;else{var N=0,R=0;m==16?(R=3+o(c,w,2),w+=2,N=g[a-1]):m==17?(R=3+o(c,w,3),w+=3):m==18&&(R=11+o(c,w,7),w+=7);for(var S=a+R;a<S;)g[a]=N,a++}}return w},n.F._copyOut=function(t,e,i,c){for(var w=0,g=0,o=c.length>>>1;g<i;){var l=t[g+e];c[g<<1]=0,c[1+(g<<1)]=l,l>w&&(w=l),g++}for(;g<o;)c[g<<1]=0,c[1+(g<<1)]=0,g++;return w},n.F.makeCodes=function(t,e){for(var i,c,w,g,o=n.F.U,l=t.length,a=o.bl_count,h=0;h<=e;h++)a[h]=0;for(h=1;h<l;h+=2)a[t[h]]++;var m=o.next_code;for(i=0,a[0]=0,c=1;c<=e;c++)i=i+a[c-1]<<1,m[c]=i;for(w=0;w<l;w+=2)(g=t[w+1])!=0&&(t[w]=m[g],m[g]++)},n.F.codes2map=function(t,e,i){for(var c=t.length,w=n.F.U.rev15,g=0;g<c;g+=2)if(t[g+1]!=0)for(var o=g>>1,l=t[g+1],a=o<<4|l,h=e-l,m=t[g]<<h,N=m+(1<<h);m!=N;)i[w[m]>>>15-e]=a,m++},n.F.revCodes=function(t,e){for(var i=n.F.U.rev15,c=15-e,w=0;w<t.length;w+=2){var g=t[w]<<e-t[w+1];t[w]=i[g]>>>c}},n.F._putsE=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8},n.F._putsF=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8,t[c+2]|=i>>>16},n.F._bitsE=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<i)-1},n.F._bitsF=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<i)-1},n.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},n.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},n.F.U=(f=Uint16Array,r=Uint32Array,{next_code:new f(16),bl_count:new f(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new f(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new f(512),fltree:[],fdmap:new f(32),fdtree:[],lmap:new f(32768),ltree:[],ttree:[],dmap:new f(32768),dtree:[],imap:new f(512),itree:[],rev15:new f(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new f(65536),prev:new f(32768)}),(function(){for(var t=n.F.U,e=0;e<32768;e++){var i=e;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[e]=(i>>>16|i<<16)>>>17}function c(w,g,o){for(;g--!=0;)w.push(0,o)}for(e=0;e<32;e++)t.ldef[e]=t.of0[e]<<3|t.exb[e],t.ddef[e]=t.df0[e]<<4|t.dxb[e];c(t.fltree,144,8),c(t.fltree,112,9),c(t.fltree,24,7),c(t.fltree,8,8),n.F.makeCodes(t.fltree,9),n.F.codes2map(t.fltree,9,t.flmap),n.F.revCodes(t.fltree,9),c(t.fdtree,32,5),n.F.makeCodes(t.fdtree,5),n.F.codes2map(t.fdtree,5,t.fdmap),n.F.revCodes(t.fdtree,5),c(t.itree,19,0),c(t.ltree,286,0),c(t.dtree,30,0),c(t.ttree,320,0)})()})();var Un=Mn({__proto__:null,default:Ft},[Ft]);const ot=(function(){var u={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,a){o[l]=a>>8&255,o[l+1]=255&a},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,a){o[l]=a>>24&255,o[l+1]=a>>16&255,o[l+2]=a>>8&255,o[l+3]=255&a},readASCII(o,l,a){let h="";for(let m=0;m<a;m++)h+=String.fromCharCode(o[l+m]);return h},writeASCII(o,l,a){for(let h=0;h<a.length;h++)o[l+h]=a.charCodeAt(h)},readBytes(o,l,a){const h=[];for(let m=0;m<a;m++)h.push(o[l+m]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,a){let h,m="";for(let N=0;N<a;N++)m+=`%${u.pad(o[l+N].toString(16))}`;try{h=decodeURIComponent(m)}catch{return u.readASCII(o,l,a)}return h}};function f(o,l,a,h){const m=l*a,N=e(h),R=Math.ceil(l*N/8),S=new Uint8Array(4*m),I=new Uint32Array(S.buffer),{ctype:F}=h,{depth:D}=h,M=u.readUshort;if(F==6){const z=m<<2;if(D==8)for(var y=0;y<z;y+=4)S[y]=o[y],S[y+1]=o[y+1],S[y+2]=o[y+2],S[y+3]=o[y+3];if(D==16)for(y=0;y<z;y++)S[y]=o[y<<1]}else if(F==2){const z=h.tabs.tRNS;if(z==null){if(D==8)for(y=0;y<m;y++){var P=3*y;I[y]=255<<24|o[P+2]<<16|o[P+1]<<8|o[P]}if(D==16)for(y=0;y<m;y++)P=6*y,I[y]=255<<24|o[P+4]<<16|o[P+2]<<8|o[P]}else{var b=z[0];const L=z[1],H=z[2];if(D==8)for(y=0;y<m;y++){var d=y<<2;P=3*y,I[y]=255<<24|o[P+2]<<16|o[P+1]<<8|o[P],o[P]==b&&o[P+1]==L&&o[P+2]==H&&(S[d+3]=0)}if(D==16)for(y=0;y<m;y++)d=y<<2,P=6*y,I[y]=255<<24|o[P+4]<<16|o[P+2]<<8|o[P],M(o,P)==b&&M(o,P+2)==L&&M(o,P+4)==H&&(S[d+3]=0)}}else if(F==3){const z=h.tabs.PLTE,L=h.tabs.tRNS,H=L?L.length:0;if(D==1)for(var v=0;v<a;v++){var j=v*R,k=v*l;for(y=0;y<l;y++){d=k+y<<2;var E=3*(_=o[j+(y>>3)]>>7-((7&y)<<0)&1);S[d]=z[E],S[d+1]=z[E+1],S[d+2]=z[E+2],S[d+3]=_<H?L[_]:255}}if(D==2)for(v=0;v<a;v++)for(j=v*R,k=v*l,y=0;y<l;y++)d=k+y<<2,E=3*(_=o[j+(y>>2)]>>6-((3&y)<<1)&3),S[d]=z[E],S[d+1]=z[E+1],S[d+2]=z[E+2],S[d+3]=_<H?L[_]:255;if(D==4)for(v=0;v<a;v++)for(j=v*R,k=v*l,y=0;y<l;y++)d=k+y<<2,E=3*(_=o[j+(y>>1)]>>4-((1&y)<<2)&15),S[d]=z[E],S[d+1]=z[E+1],S[d+2]=z[E+2],S[d+3]=_<H?L[_]:255;if(D==8)for(y=0;y<m;y++){var _;d=y<<2,E=3*(_=o[y]),S[d]=z[E],S[d+1]=z[E+1],S[d+2]=z[E+2],S[d+3]=_<H?L[_]:255}}else if(F==4){if(D==8)for(y=0;y<m;y++){d=y<<2;var A=o[p=y<<1];S[d]=A,S[d+1]=A,S[d+2]=A,S[d+3]=o[p+1]}if(D==16)for(y=0;y<m;y++){var p;d=y<<2,A=o[p=y<<2],S[d]=A,S[d+1]=A,S[d+2]=A,S[d+3]=o[p+2]}}else if(F==0)for(b=h.tabs.tRNS?h.tabs.tRNS:-1,v=0;v<a;v++){const z=v*R,L=v*l;if(D==1)for(var x=0;x<l;x++){var W=(A=255*(o[z+(x>>>3)]>>>7-(7&x)&1))==255*b?0:255;I[L+x]=W<<24|A<<16|A<<8|A}else if(D==2)for(x=0;x<l;x++)W=(A=85*(o[z+(x>>>2)]>>>6-((3&x)<<1)&3))==85*b?0:255,I[L+x]=W<<24|A<<16|A<<8|A;else if(D==4)for(x=0;x<l;x++)W=(A=17*(o[z+(x>>>1)]>>>4-((1&x)<<2)&15))==17*b?0:255,I[L+x]=W<<24|A<<16|A<<8|A;else if(D==8)for(x=0;x<l;x++)W=(A=o[z+x])==b?0:255,I[L+x]=W<<24|A<<16|A<<8|A;else if(D==16)for(x=0;x<l;x++)A=o[z+(x<<1)],W=M(o,z+(x<<1))==b?0:255,I[L+x]=W<<24|A<<16|A<<8|A}return S}function r(o,l,a,h){const m=e(o),N=Math.ceil(a*m/8),R=new Uint8Array((N+1+o.interlace)*h);return l=o.tabs.CgBI?t(l,R):n(l,R),o.interlace==0?l=i(l,o,0,a,h):o.interlace==1&&(l=(function(I,F){const D=F.width,M=F.height,y=e(F),P=y>>3,b=Math.ceil(D*y/8),d=new Uint8Array(M*b);let v=0;const j=[0,0,4,0,2,0,1],k=[0,4,0,2,0,1,0],E=[8,8,8,4,4,2,2],_=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const x=E[A],W=_[A];let z=0,L=0,H=j[A];for(;H<M;)H+=x,L++;let O=k[A];for(;O<D;)O+=W,z++;const q=Math.ceil(z*y/8);i(I,F,v,z,L);let $=0,T=j[A];for(;T<M;){let V=k[A],G=v+$*q<<3;for(;V<D;){var p;if(y==1&&(p=(p=I[G>>3])>>7-(7&G)&1,d[T*b+(V>>3)]|=p<<7-((7&V)<<0)),y==2&&(p=(p=I[G>>3])>>6-(7&G)&3,d[T*b+(V>>2)]|=p<<6-((3&V)<<1)),y==4&&(p=(p=I[G>>3])>>4-(7&G)&15,d[T*b+(V>>1)]|=p<<4-((1&V)<<2)),y>=8){const te=T*b+V*P;for(let oe=0;oe<P;oe++)d[te+oe]=I[(G>>3)+oe]}G+=y,V+=W}$++,T+=x}z*L!=0&&(v+=L*(1+q)),A+=1}return d})(l,o)),l}function n(o,l){return t(new Uint8Array(o.buffer,2,o.length-6),l)}var t=(function(){const o={H:{}};return o.H.N=function(l,a){const h=Uint8Array;let m,N,R=0,S=0,I=0,F=0,D=0,M=0,y=0,P=0,b=0;if(l[0]==3&&l[1]==0)return a||new h(0);const d=o.H,v=d.b,j=d.e,k=d.R,E=d.n,_=d.A,A=d.Z,p=d.m,x=a==null;for(x&&(a=new h(l.length>>>2<<5));R==0;)if(R=v(l,b,1),S=v(l,b+1,2),b+=3,S!=0){if(x&&(a=o.H.W(a,P+(1<<17))),S==1&&(m=p.J,N=p.h,M=511,y=31),S==2){I=j(l,b,5)+257,F=j(l,b+5,5)+1,D=j(l,b+10,4)+4,b+=14;let z=1;for(var W=0;W<38;W+=2)p.Q[W]=0,p.Q[W+1]=0;for(W=0;W<D;W++){const O=j(l,b+3*W,3);p.Q[1+(p.X[W]<<1)]=O,O>z&&(z=O)}b+=3*D,E(p.Q,z),_(p.Q,z,p.u),m=p.w,N=p.d,b=k(p.u,(1<<z)-1,I+F,l,b,p.v);const L=d.V(p.v,0,I,p.C);M=(1<<L)-1;const H=d.V(p.v,I,F,p.D);y=(1<<H)-1,E(p.C,L),_(p.C,L,m),E(p.D,H),_(p.D,H,N)}for(;;){const z=m[A(l,b)&M];b+=15&z;const L=z>>>4;if(!(L>>>8))a[P++]=L;else{if(L==256)break;{let H=P+L-254;if(L>264){const V=p.q[L-257];H=P+(V>>>3)+j(l,b,7&V),b+=7&V}const O=N[A(l,b)&y];b+=15&O;const q=O>>>4,$=p.c[q],T=($>>>4)+v(l,b,15&$);for(b+=15&$;P<H;)a[P]=a[P++-T],a[P]=a[P++-T],a[P]=a[P++-T],a[P]=a[P++-T];P=H}}}}else{(7&b)!=0&&(b+=8-(7&b));const z=4+(b>>>3),L=l[z-4]|l[z-3]<<8;x&&(a=o.H.W(a,P+L)),a.set(new h(l.buffer,l.byteOffset+z,L),P),b=z+L<<3,P+=L}return a.length==P?a:a.slice(0,P)},o.H.W=function(l,a){const h=l.length;if(a<=h)return l;const m=new Uint8Array(h<<1);return m.set(l,0),m},o.H.R=function(l,a,h,m,N,R){const S=o.H.e,I=o.H.Z;let F=0;for(;F<h;){const D=l[I(m,N)&a];N+=15&D;const M=D>>>4;if(M<=15)R[F]=M,F++;else{let y=0,P=0;M==16?(P=3+S(m,N,2),N+=2,y=R[F-1]):M==17?(P=3+S(m,N,3),N+=3):M==18&&(P=11+S(m,N,7),N+=7);const b=F+P;for(;F<b;)R[F]=y,F++}}return N},o.H.V=function(l,a,h,m){let N=0,R=0;const S=m.length>>>1;for(;R<h;){const I=l[R+a];m[R<<1]=0,m[1+(R<<1)]=I,I>N&&(N=I),R++}for(;R<S;)m[R<<1]=0,m[1+(R<<1)]=0,R++;return N},o.H.n=function(l,a){const h=o.H.m,m=l.length;let N,R,S,I;const F=h.j;for(var D=0;D<=a;D++)F[D]=0;for(D=1;D<m;D+=2)F[l[D]]++;const M=h.K;for(N=0,F[0]=0,R=1;R<=a;R++)N=N+F[R-1]<<1,M[R]=N;for(S=0;S<m;S+=2)I=l[S+1],I!=0&&(l[S]=M[I],M[I]++)},o.H.A=function(l,a,h){const m=l.length,N=o.H.m.r;for(let R=0;R<m;R+=2)if(l[R+1]!=0){const S=R>>1,I=l[R+1],F=S<<4|I,D=a-I;let M=l[R]<<D;const y=M+(1<<D);for(;M!=y;)h[N[M]>>>15-a]=F,M++}},o.H.l=function(l,a){const h=o.H.m.r,m=15-a;for(let N=0;N<l.length;N+=2){const R=l[N]<<a-l[N+1];l[N]=h[R]>>>m}},o.H.M=function(l,a,h){h<<=7&a;const m=a>>>3;l[m]|=h,l[m+1]|=h>>>8},o.H.I=function(l,a,h){h<<=7&a;const m=a>>>3;l[m]|=h,l[m+1]|=h>>>8,l[m+2]|=h>>>16},o.H.e=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8)>>>(7&a)&(1<<h)-1},o.H.b=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)&(1<<h)-1},o.H.Z=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)},o.H.i=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16|l[3+(a>>>3)]<<24)>>>(7&a)},o.H.m=(function(){const l=Uint16Array,a=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new a(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new a(286),Y:new a(30),a:new a(19),t:new a(15e3),k:new l(65536),g:new l(32768)}})(),(function(){const l=o.H.m;for(var a=0;a<32768;a++){let m=a;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,l.r[a]=(m>>>16|m<<16)>>>17}function h(m,N,R){for(;N--!=0;)m.push(0,R)}for(a=0;a<32;a++)l.q[a]=l.S[a]<<3|l.T[a],l.c[a]=l.p[a]<<4|l.z[a];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)})(),o.H.N})();function e(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function i(o,l,a,h,m){let N=e(l);const R=Math.ceil(h*N/8);let S,I;N=Math.ceil(N/8);let F=o[a],D=0;if(F>1&&(o[a]=[0,0,1][F-2]),F==3)for(D=N;D<R;D++)o[D+1]=o[D+1]+(o[D+1-N]>>>1)&255;for(let M=0;M<m;M++)if(S=a+M*R,I=S+M+1,F=o[I-1],D=0,F==0)for(;D<R;D++)o[S+D]=o[I+D];else if(F==1){for(;D<N;D++)o[S+D]=o[I+D];for(;D<R;D++)o[S+D]=o[I+D]+o[S+D-N]}else if(F==2)for(;D<R;D++)o[S+D]=o[I+D]+o[S+D-R];else if(F==3){for(;D<N;D++)o[S+D]=o[I+D]+(o[S+D-R]>>>1);for(;D<R;D++)o[S+D]=o[I+D]+(o[S+D-R]+o[S+D-N]>>>1)}else{for(;D<N;D++)o[S+D]=o[I+D]+c(0,o[S+D-R],0);for(;D<R;D++)o[S+D]=o[I+D]+c(o[S+D-N],o[S+D-R],o[S+D-N-R])}return o}function c(o,l,a){const h=o+l-a,m=h-o,N=h-l,R=h-a;return m*m<=N*N&&m*m<=R*R?o:N*N<=R*R?l:a}function w(o,l,a){a.width=u.readUint(o,l),l+=4,a.height=u.readUint(o,l),l+=4,a.depth=o[l],l++,a.ctype=o[l],l++,a.compress=o[l],l++,a.filter=o[l],l++,a.interlace=o[l],l++}function g(o,l,a,h,m,N,R,S,I){const F=Math.min(l,m),D=Math.min(a,N);let M=0,y=0;for(let A=0;A<D;A++)for(let p=0;p<F;p++)if(R>=0&&S>=0?(M=A*l+p<<2,y=(S+A)*m+R+p<<2):(M=(-S+A)*l-R+p<<2,y=A*m+p<<2),I==0)h[y]=o[M],h[y+1]=o[M+1],h[y+2]=o[M+2],h[y+3]=o[M+3];else if(I==1){var P=o[M+3]*.00392156862745098,b=o[M]*P,d=o[M+1]*P,v=o[M+2]*P,j=h[y+3]*(1/255),k=h[y]*j,E=h[y+1]*j,_=h[y+2]*j;const x=1-P,W=P+j*x,z=W==0?0:1/W;h[y+3]=255*W,h[y+0]=(b+k*x)*z,h[y+1]=(d+E*x)*z,h[y+2]=(v+_*x)*z}else if(I==2)P=o[M+3],b=o[M],d=o[M+1],v=o[M+2],j=h[y+3],k=h[y],E=h[y+1],_=h[y+2],P==j&&b==k&&d==E&&v==_?(h[y]=0,h[y+1]=0,h[y+2]=0,h[y+3]=0):(h[y]=b,h[y+1]=d,h[y+2]=v,h[y+3]=P);else if(I==3){if(P=o[M+3],b=o[M],d=o[M+1],v=o[M+2],j=h[y+3],k=h[y],E=h[y+1],_=h[y+2],P==j&&b==k&&d==E&&v==_)continue;if(P<220&&j>20)return!1}return!0}return{decode:function(l){const a=new Uint8Array(l);let h=8;const m=u,N=m.readUshort,R=m.readUint,S={tabs:{},frames:[]},I=new Uint8Array(a.length);let F,D=0,M=0;const y=[137,80,78,71,13,10,26,10];for(var P=0;P<8;P++)if(a[P]!=y[P])throw"The input is not a PNG file!";for(;h<a.length;){const A=m.readUint(a,h);h+=4;const p=m.readASCII(a,h,4);if(h+=4,p=="IHDR")w(a,h,S);else if(p=="iCCP"){for(var b=h;a[b]!=0;)b++;m.readASCII(a,h,b-h),a[b+1];const x=a.slice(b+2,h+A);let W=null;try{W=n(x)}catch{W=t(x)}S.tabs[p]=W}else if(p=="CgBI")S.tabs[p]=a.slice(h,h+4);else if(p=="IDAT"){for(P=0;P<A;P++)I[D+P]=a[h+P];D+=A}else if(p=="acTL")S.tabs[p]={num_frames:R(a,h),num_plays:R(a,h+4)},F=new Uint8Array(a.length);else if(p=="fcTL"){M!=0&&((_=S.frames[S.frames.length-1]).data=r(S,F.slice(0,M),_.rect.width,_.rect.height),M=0);const x={x:R(a,h+12),y:R(a,h+16),width:R(a,h+4),height:R(a,h+8)};let W=N(a,h+22);W=N(a,h+20)/(W==0?100:W);const z={rect:x,delay:Math.round(1e3*W),dispose:a[h+24],blend:a[h+25]};S.frames.push(z)}else if(p=="fdAT"){for(P=0;P<A-4;P++)F[M+P]=a[h+P+4];M+=A-4}else if(p=="pHYs")S.tabs[p]=[m.readUint(a,h),m.readUint(a,h+4),a[h+8]];else if(p=="cHRM")for(S.tabs[p]=[],P=0;P<8;P++)S.tabs[p].push(m.readUint(a,h+4*P));else if(p=="tEXt"||p=="zTXt"){S.tabs[p]==null&&(S.tabs[p]={});var d=m.nextZero(a,h),v=m.readASCII(a,h,d-h),j=h+A-d-1;if(p=="tEXt")E=m.readASCII(a,d+1,j);else{var k=n(a.slice(d+2,d+2+j));E=m.readUTF8(k,0,k.length)}S.tabs[p][v]=E}else if(p=="iTXt"){S.tabs[p]==null&&(S.tabs[p]={}),d=0,b=h,d=m.nextZero(a,b),v=m.readASCII(a,b,d-b);const x=a[b=d+1];var E;a[b+1],b+=2,d=m.nextZero(a,b),m.readASCII(a,b,d-b),b=d+1,d=m.nextZero(a,b),m.readUTF8(a,b,d-b),j=A-((b=d+1)-h),x==0?E=m.readUTF8(a,b,j):(k=n(a.slice(b,b+j)),E=m.readUTF8(k,0,k.length)),S.tabs[p][v]=E}else if(p=="PLTE")S.tabs[p]=m.readBytes(a,h,A);else if(p=="hIST"){const x=S.tabs.PLTE.length/3;for(S.tabs[p]=[],P=0;P<x;P++)S.tabs[p].push(N(a,h+2*P))}else if(p=="tRNS")S.ctype==3?S.tabs[p]=m.readBytes(a,h,A):S.ctype==0?S.tabs[p]=N(a,h):S.ctype==2&&(S.tabs[p]=[N(a,h),N(a,h+2),N(a,h+4)]);else if(p=="gAMA")S.tabs[p]=m.readUint(a,h)/1e5;else if(p=="sRGB")S.tabs[p]=a[h];else if(p=="bKGD")S.ctype==0||S.ctype==4?S.tabs[p]=[N(a,h)]:S.ctype==2||S.ctype==6?S.tabs[p]=[N(a,h),N(a,h+2),N(a,h+4)]:S.ctype==3&&(S.tabs[p]=a[h]);else if(p=="IEND")break;h+=A,m.readUint(a,h),h+=4}var _;return M!=0&&((_=S.frames[S.frames.length-1]).data=r(S,F.slice(0,M),_.rect.width,_.rect.height)),S.data=r(S,I,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(l){const a=l.width,h=l.height;if(l.tabs.acTL==null)return[f(l.data,a,h,l).buffer];const m=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const N=a*h*4,R=new Uint8Array(N),S=new Uint8Array(N),I=new Uint8Array(N);for(let D=0;D<l.frames.length;D++){const M=l.frames[D],y=M.rect.x,P=M.rect.y,b=M.rect.width,d=M.rect.height,v=f(M.data,b,d,l);if(D!=0)for(var F=0;F<N;F++)I[F]=R[F];if(M.blend==0?g(v,b,d,R,a,h,y,P,0):M.blend==1&&g(v,b,d,R,a,h,y,P,1),m.push(R.buffer.slice(0)),M.dispose!=0){if(M.dispose==1)g(S,b,d,R,a,h,y,P,0);else if(M.dispose==2)for(F=0;F<N;F++)R[F]=I[F]}}return m},_paeth:c,_copyTile:g,_bin:u}})();(function(){const{_copyTile:u}=ot,{_bin:f}=ot,r=ot._paeth;var n={table:(function(){const b=new Uint32Array(256);for(let d=0;d<256;d++){let v=d;for(let j=0;j<8;j++)1&v?v=3988292384^v>>>1:v>>>=1;b[d]=v}return b})(),update(b,d,v,j){for(let k=0;k<j;k++)b=n.table[255&(b^d[v+k])]^b>>>8;return b},crc:(b,d,v)=>4294967295^n.update(4294967295,b,d,v)};function t(b,d,v,j){d[v]+=b[0]*j>>4,d[v+1]+=b[1]*j>>4,d[v+2]+=b[2]*j>>4,d[v+3]+=b[3]*j>>4}function e(b){return Math.max(0,Math.min(255,b))}function i(b,d){const v=b[0]-d[0],j=b[1]-d[1],k=b[2]-d[2],E=b[3]-d[3];return v*v+j*j+k*k+E*E}function c(b,d,v,j,k,E,_){_==null&&(_=1);const A=j.length,p=[];for(var x=0;x<A;x++){const T=j[x];p.push([T>>>0&255,T>>>8&255,T>>>16&255,T>>>24&255])}for(x=0;x<A;x++){let T=4294967295;for(var W=0,z=0;z<A;z++){var L=i(p[x],p[z]);z!=x&&L<T&&(T=L,W=z)}}const H=new Uint32Array(k.buffer),O=new Int16Array(d*v*4),q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(x=0;x<q.length;x++)q[x]=255*((q[x]+.5)/16-.5);for(let T=0;T<v;T++)for(let V=0;V<d;V++){var $;x=4*(T*d+V),_!=2?$=[e(b[x]+O[x]),e(b[x+1]+O[x+1]),e(b[x+2]+O[x+2]),e(b[x+3]+O[x+3])]:(L=q[4*(3&T)+(3&V)],$=[e(b[x]+L),e(b[x+1]+L),e(b[x+2]+L),e(b[x+3]+L)]),W=0;let G=16777215;for(z=0;z<A;z++){const ce=i($,p[z]);ce<G&&(G=ce,W=z)}const te=p[W],oe=[$[0]-te[0],$[1]-te[1],$[2]-te[2],$[3]-te[3]];_==1&&(V!=d-1&&t(oe,O,x+4,7),T!=v-1&&(V!=0&&t(oe,O,x+4*d-4,3),t(oe,O,x+4*d,5),V!=d-1&&t(oe,O,x+4*d+4,1))),E[x>>2]=W,H[x>>2]=j[W]}}function w(b,d,v,j,k){k==null&&(k={});const{crc:E}=n,_=f.writeUint,A=f.writeUshort,p=f.writeASCII;let x=8;const W=b.frames.length>1;let z,L=!1,H=33+(W?20:0);if(k.sRGB!=null&&(H+=13),k.pHYs!=null&&(H+=21),k.iCCP!=null&&(z=pako.deflate(k.iCCP),H+=21+z.length+4),b.ctype==3){for(var O=b.plte.length,q=0;q<O;q++)b.plte[q]>>>24!=255&&(L=!0);H+=8+3*O+4+(L?8+1*O+4:0)}for(var $=0;$<b.frames.length;$++)W&&(H+=38),H+=(te=b.frames[$]).cimg.length+12,$!=0&&(H+=4);H+=12;const T=new Uint8Array(H),V=[137,80,78,71,13,10,26,10];for(q=0;q<8;q++)T[q]=V[q];if(_(T,x,13),x+=4,p(T,x,"IHDR"),x+=4,_(T,x,d),x+=4,_(T,x,v),x+=4,T[x]=b.depth,x++,T[x]=b.ctype,x++,T[x]=0,x++,T[x]=0,x++,T[x]=0,x++,_(T,x,E(T,x-17,17)),x+=4,k.sRGB!=null&&(_(T,x,1),x+=4,p(T,x,"sRGB"),x+=4,T[x]=k.sRGB,x++,_(T,x,E(T,x-5,5)),x+=4),k.iCCP!=null){const oe=13+z.length;_(T,x,oe),x+=4,p(T,x,"iCCP"),x+=4,p(T,x,"ICC profile"),x+=11,x+=2,T.set(z,x),x+=z.length,_(T,x,E(T,x-(oe+4),oe+4)),x+=4}if(k.pHYs!=null&&(_(T,x,9),x+=4,p(T,x,"pHYs"),x+=4,_(T,x,k.pHYs[0]),x+=4,_(T,x,k.pHYs[1]),x+=4,T[x]=k.pHYs[2],x++,_(T,x,E(T,x-13,13)),x+=4),W&&(_(T,x,8),x+=4,p(T,x,"acTL"),x+=4,_(T,x,b.frames.length),x+=4,_(T,x,k.loop!=null?k.loop:0),x+=4,_(T,x,E(T,x-12,12)),x+=4),b.ctype==3){for(_(T,x,3*(O=b.plte.length)),x+=4,p(T,x,"PLTE"),x+=4,q=0;q<O;q++){const oe=3*q,ce=b.plte[q],de=255&ce,me=ce>>>8&255,Ge=ce>>>16&255;T[x+oe+0]=de,T[x+oe+1]=me,T[x+oe+2]=Ge}if(x+=3*O,_(T,x,E(T,x-3*O-4,3*O+4)),x+=4,L){for(_(T,x,O),x+=4,p(T,x,"tRNS"),x+=4,q=0;q<O;q++)T[x+q]=b.plte[q]>>>24&255;x+=O,_(T,x,E(T,x-O-4,O+4)),x+=4}}let G=0;for($=0;$<b.frames.length;$++){var te=b.frames[$];W&&(_(T,x,26),x+=4,p(T,x,"fcTL"),x+=4,_(T,x,G++),x+=4,_(T,x,te.rect.width),x+=4,_(T,x,te.rect.height),x+=4,_(T,x,te.rect.x),x+=4,_(T,x,te.rect.y),x+=4,A(T,x,j[$]),x+=2,A(T,x,1e3),x+=2,T[x]=te.dispose,x++,T[x]=te.blend,x++,_(T,x,E(T,x-30,30)),x+=4);const oe=te.cimg;_(T,x,(O=oe.length)+($==0?0:4)),x+=4;const ce=x;p(T,x,$==0?"IDAT":"fdAT"),x+=4,$!=0&&(_(T,x,G++),x+=4),T.set(oe,x),x+=O,_(T,x,E(T,ce,x-ce)),x+=4}return _(T,x,0),x+=4,p(T,x,"IEND"),x+=4,_(T,x,E(T,x-4,4)),x+=4,T.buffer}function g(b,d,v){for(let j=0;j<b.frames.length;j++){const k=b.frames[j];k.rect.width;const E=k.rect.height,_=new Uint8Array(E*k.bpl+E);k.cimg=h(k.img,E,k.bpp,k.bpl,_,d,v)}}function o(b,d,v,j,k){const E=k[0],_=k[1],A=k[2],p=k[3],x=k[4],W=k[5];let z=6,L=8,H=255;for(var O=0;O<b.length;O++){const ye=new Uint8Array(b[O]);for(var q=ye.length,$=0;$<q;$+=4)H&=ye[$+3]}const T=H!=255,V=(function(je,ue,Ce,Re,be,Le){const Se=[];for(var pe=0;pe<je.length;pe++){const Ie=new Uint8Array(je[pe]),Ye=new Uint32Array(Ie.buffer);var Ue;let He=0,Ze=0,Je=ue,et=Ce,at=Re?1:0;if(pe!=0){const Wt=Le||Re||pe==1||Se[pe-2].dispose!=0?1:2;let gt=0,Et=1e9;for(let ct=0;ct<Wt;ct++){var qe=new Uint8Array(je[pe-1-ct]);const wt=new Uint32Array(je[pe-1-ct]);let rt=ue,tt=Ce,dt=-1,ut=-1;for(let Qe=0;Qe<Ce;Qe++)for(let ft=0;ft<ue;ft++)Ye[Me=Qe*ue+ft]!=wt[Me]&&(ft<rt&&(rt=ft),ft>dt&&(dt=ft),Qe<tt&&(tt=Qe),Qe>ut&&(ut=Qe));dt==-1&&(rt=tt=dt=ut=0),be&&((1&rt)==1&&rt--,(1&tt)==1&&tt--);const _t=(dt-rt+1)*(ut-tt+1);_t<Et&&(Et=_t,gt=ct,He=rt,Ze=tt,Je=dt-rt+1,et=ut-tt+1)}qe=new Uint8Array(je[pe-1-gt]),gt==1&&(Se[pe-1].dispose=2),Ue=new Uint8Array(Je*et*4),u(qe,ue,Ce,Ue,Je,et,-He,-Ze,0),at=u(Ie,ue,Ce,Ue,Je,et,-He,-Ze,3)?1:0,at==1?a(Ie,ue,Ce,Ue,{x:He,y:Ze,width:Je,height:et}):u(Ie,ue,Ce,Ue,Je,et,-He,-Ze,0)}else Ue=Ie.slice(0);Se.push({rect:{x:He,y:Ze,width:Je,height:et},img:Ue,blend:at,dispose:0})}if(Re)for(pe=0;pe<Se.length;pe++){if((lt=Se[pe]).blend==1)continue;const Ie=lt.rect,Ye=Se[pe-1].rect,He=Math.min(Ie.x,Ye.x),Ze=Math.min(Ie.y,Ye.y),Je={x:He,y:Ze,width:Math.max(Ie.x+Ie.width,Ye.x+Ye.width)-He,height:Math.max(Ie.y+Ie.height,Ye.y+Ye.height)-Ze};Se[pe-1].dispose=1,pe-1!=0&&l(je,ue,Ce,Se,pe-1,Je,be),l(je,ue,Ce,Se,pe,Je,be)}let Ve=0;if(je.length!=1)for(var Me=0;Me<Se.length;Me++){var lt;Ve+=(lt=Se[Me]).rect.width*lt.rect.height}return Se})(b,d,v,E,_,A),G={},te=[],oe=[];if(j!=0){const ye=[];for($=0;$<V.length;$++)ye.push(V[$].img.buffer);const je=(function(be){let Le=0;for(var Se=0;Se<be.length;Se++)Le+=be[Se].byteLength;const pe=new Uint8Array(Le);let Ue=0;for(Se=0;Se<be.length;Se++){const qe=new Uint8Array(be[Se]),Ve=qe.length;for(let Me=0;Me<Ve;Me+=4){let lt=qe[Me],Ie=qe[Me+1],Ye=qe[Me+2];const He=qe[Me+3];He==0&&(lt=Ie=Ye=0),pe[Ue+Me]=lt,pe[Ue+Me+1]=Ie,pe[Ue+Me+2]=Ye,pe[Ue+Me+3]=He}Ue+=Ve}return pe.buffer})(ye),ue=N(je,j);for($=0;$<ue.plte.length;$++)te.push(ue.plte[$].est.rgba);let Ce=0;for($=0;$<V.length;$++){const Re=(de=V[$]).img.length;var ce=new Uint8Array(ue.inds.buffer,Ce>>2,Re>>2);oe.push(ce);const be=new Uint8Array(ue.abuf,Ce,Re);W&&c(de.img,de.rect.width,de.rect.height,te,be,ce),de.img.set(be),Ce+=Re}}else for(O=0;O<V.length;O++){var de=V[O];const ye=new Uint32Array(de.img.buffer);var me=de.rect.width;for(q=ye.length,ce=new Uint8Array(q),oe.push(ce),$=0;$<q;$++){const je=ye[$];if($!=0&&je==ye[$-1])ce[$]=ce[$-1];else if($>me&&je==ye[$-me])ce[$]=ce[$-me];else{let ue=G[je];if(ue==null&&(G[je]=ue=te.length,te.push(je),te.length>=300))break;ce[$]=ue}}}const Ge=te.length;for(Ge<=256&&x==0&&(L=Ge<=2?1:Ge<=4?2:Ge<=16?4:8,L=Math.max(L,p)),O=0;O<V.length;O++){(de=V[O]).rect.x,de.rect.y,me=de.rect.width;const ye=de.rect.height;let je=de.img;new Uint32Array(je.buffer);let ue=4*me,Ce=4;if(Ge<=256&&x==0){ue=Math.ceil(L*me/8);var Fe=new Uint8Array(ue*ye);const Re=oe[O];for(let be=0;be<ye;be++){$=be*ue;const Le=be*me;if(L==8)for(var ve=0;ve<me;ve++)Fe[$+ve]=Re[Le+ve];else if(L==4)for(ve=0;ve<me;ve++)Fe[$+(ve>>1)]|=Re[Le+ve]<<4-4*(1&ve);else if(L==2)for(ve=0;ve<me;ve++)Fe[$+(ve>>2)]|=Re[Le+ve]<<6-2*(3&ve);else if(L==1)for(ve=0;ve<me;ve++)Fe[$+(ve>>3)]|=Re[Le+ve]<<7-1*(7&ve)}je=Fe,z=3,Ce=1}else if(T==0&&V.length==1){Fe=new Uint8Array(me*ye*3);const Re=me*ye;for($=0;$<Re;$++){const be=3*$,Le=4*$;Fe[be]=je[Le],Fe[be+1]=je[Le+1],Fe[be+2]=je[Le+2]}je=Fe,z=2,Ce=3,ue=3*me}de.img=je,de.bpl=ue,de.bpp=Ce}return{ctype:z,depth:L,plte:te,frames:V}}function l(b,d,v,j,k,E,_){const A=Uint8Array,p=Uint32Array,x=new A(b[k-1]),W=new p(b[k-1]),z=k+1<b.length?new A(b[k+1]):null,L=new A(b[k]),H=new p(L.buffer);let O=d,q=v,$=-1,T=-1;for(let G=0;G<E.height;G++)for(let te=0;te<E.width;te++){const oe=E.x+te,ce=E.y+G,de=ce*d+oe,me=H[de];me==0||j[k-1].dispose==0&&W[de]==me&&(z==null||z[4*de+3]!=0)||(oe<O&&(O=oe),oe>$&&($=oe),ce<q&&(q=ce),ce>T&&(T=ce))}$==-1&&(O=q=$=T=0),_&&((1&O)==1&&O--,(1&q)==1&&q--),E={x:O,y:q,width:$-O+1,height:T-q+1};const V=j[k];V.rect=E,V.blend=1,V.img=new Uint8Array(E.width*E.height*4),j[k-1].dispose==0?(u(x,d,v,V.img,E.width,E.height,-E.x,-E.y,0),a(L,d,v,V.img,E)):u(L,d,v,V.img,E.width,E.height,-E.x,-E.y,0)}function a(b,d,v,j,k){u(b,d,v,j,k.width,k.height,-k.x,-k.y,2)}function h(b,d,v,j,k,E,_){const A=[];let p,x=[0,1,2,3,4];E!=-1?x=[E]:(d*j>5e5||v==1)&&(x=[0]),_&&(p={level:0});const W=Un;for(var z=0;z<x.length;z++){for(let O=0;O<d;O++)m(k,b,O,j,v,x[z]);A.push(W.deflate(k,p))}let L,H=1e9;for(z=0;z<A.length;z++)A[z].length<H&&(L=z,H=A[z].length);return A[L]}function m(b,d,v,j,k,E){const _=v*j;let A=_+v;if(b[A]=E,A++,E==0)if(j<500)for(var p=0;p<j;p++)b[A+p]=d[_+p];else b.set(new Uint8Array(d.buffer,_,j),A);else if(E==1){for(p=0;p<k;p++)b[A+p]=d[_+p];for(p=k;p<j;p++)b[A+p]=d[_+p]-d[_+p-k]+256&255}else if(v==0){for(p=0;p<k;p++)b[A+p]=d[_+p];if(E==2)for(p=k;p<j;p++)b[A+p]=d[_+p];if(E==3)for(p=k;p<j;p++)b[A+p]=d[_+p]-(d[_+p-k]>>1)+256&255;if(E==4)for(p=k;p<j;p++)b[A+p]=d[_+p]-r(d[_+p-k],0,0)+256&255}else{if(E==2)for(p=0;p<j;p++)b[A+p]=d[_+p]+256-d[_+p-j]&255;if(E==3){for(p=0;p<k;p++)b[A+p]=d[_+p]+256-(d[_+p-j]>>1)&255;for(p=k;p<j;p++)b[A+p]=d[_+p]+256-(d[_+p-j]+d[_+p-k]>>1)&255}if(E==4){for(p=0;p<k;p++)b[A+p]=d[_+p]+256-r(0,d[_+p-j],0)&255;for(p=k;p<j;p++)b[A+p]=d[_+p]+256-r(d[_+p-k],d[_+p-j],d[_+p-k-j])&255}}}function N(b,d){const v=new Uint8Array(b),j=v.slice(0),k=new Uint32Array(j.buffer),E=R(j,d),_=E[0],A=E[1],p=v.length,x=new Uint8Array(p>>2);let W;if(v.length<2e7)for(var z=0;z<p;z+=4)W=S(_,L=v[z]*(1/255),H=v[z+1]*(1/255),O=v[z+2]*(1/255),q=v[z+3]*(1/255)),x[z>>2]=W.ind,k[z>>2]=W.est.rgba;else for(z=0;z<p;z+=4){var L=v[z]*.00392156862745098,H=v[z+1]*(1/255),O=v[z+2]*(1/255),q=v[z+3]*(1/255);for(W=_;W.left;)W=I(W.est,L,H,O,q)<=0?W.left:W.right;x[z>>2]=W.ind,k[z>>2]=W.est.rgba}return{abuf:j.buffer,inds:x,plte:A}}function R(b,d,v){v==null&&(v=1e-4);const j=new Uint32Array(b.buffer),k={i0:0,i1:b.length,bst:null,est:null,tdst:0,left:null,right:null};k.bst=M(b,k.i0,k.i1),k.est=y(k.bst);const E=[k];for(;E.length<d;){let A=0,p=0;for(var _=0;_<E.length;_++)E[_].est.L>A&&(A=E[_].est.L,p=_);if(A<v)break;const x=E[p],W=F(b,j,x.i0,x.i1,x.est.e,x.est.eMq255);if(x.i0>=W||x.i1<=W){x.est.L=0;continue}const z={i0:x.i0,i1:W,bst:null,est:null,tdst:0,left:null,right:null};z.bst=M(b,z.i0,z.i1),z.est=y(z.bst);const L={i0:W,i1:x.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:x.bst.N-z.bst.N},_=0;_<16;_++)L.bst.R[_]=x.bst.R[_]-z.bst.R[_];for(_=0;_<4;_++)L.bst.m[_]=x.bst.m[_]-z.bst.m[_];L.est=y(L.bst),x.left=z,x.right=L,E[p]=z,E.push(L)}for(E.sort(((A,p)=>p.bst.N-A.bst.N)),_=0;_<E.length;_++)E[_].ind=_;return[k,E]}function S(b,d,v,j,k){if(b.left==null)return b.tdst=(function(z,L,H,O,q){const $=L-z[0],T=H-z[1],V=O-z[2],G=q-z[3];return $*$+T*T+V*V+G*G})(b.est.q,d,v,j,k),b;const E=I(b.est,d,v,j,k);let _=b.left,A=b.right;E>0&&(_=b.right,A=b.left);const p=S(_,d,v,j,k);if(p.tdst<=E*E)return p;const x=S(A,d,v,j,k);return x.tdst<p.tdst?x:p}function I(b,d,v,j,k){const{e:E}=b;return E[0]*d+E[1]*v+E[2]*j+E[3]*k-b.eMq}function F(b,d,v,j,k,E){for(j-=4;v<j;){for(;D(b,v,k)<=E;)v+=4;for(;D(b,j,k)>E;)j-=4;if(v>=j)break;const _=d[v>>2];d[v>>2]=d[j>>2],d[j>>2]=_,v+=4,j-=4}for(;D(b,v,k)>E;)v-=4;return v+4}function D(b,d,v){return b[d]*v[0]+b[d+1]*v[1]+b[d+2]*v[2]+b[d+3]*v[3]}function M(b,d,v){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=[0,0,0,0],E=v-d>>2;for(let _=d;_<v;_+=4){const A=b[_]*.00392156862745098,p=b[_+1]*(1/255),x=b[_+2]*(1/255),W=b[_+3]*(1/255);k[0]+=A,k[1]+=p,k[2]+=x,k[3]+=W,j[0]+=A*A,j[1]+=A*p,j[2]+=A*x,j[3]+=A*W,j[5]+=p*p,j[6]+=p*x,j[7]+=p*W,j[10]+=x*x,j[11]+=x*W,j[15]+=W*W}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:k,N:E}}function y(b){const{R:d}=b,{m:v}=b,{N:j}=b,k=v[0],E=v[1],_=v[2],A=v[3],p=j==0?0:1/j,x=[d[0]-k*k*p,d[1]-k*E*p,d[2]-k*_*p,d[3]-k*A*p,d[4]-E*k*p,d[5]-E*E*p,d[6]-E*_*p,d[7]-E*A*p,d[8]-_*k*p,d[9]-_*E*p,d[10]-_*_*p,d[11]-_*A*p,d[12]-A*k*p,d[13]-A*E*p,d[14]-A*_*p,d[15]-A*A*p],W=x,z=P;let L=[Math.random(),Math.random(),Math.random(),Math.random()],H=0,O=0;if(j!=0)for(let $=0;$<16&&(L=z.multVec(W,L),O=Math.sqrt(z.dot(L,L)),L=z.sml(1/O,L),!($!=0&&Math.abs(O-H)<1e-9));$++)H=O;const q=[k*p,E*p,_*p,A*p];return{Cov:x,q,e:L,L:H,eMq255:z.dot(z.sml(255,q),L),eMq:z.dot(L,q),rgba:(Math.round(255*q[3])<<24|Math.round(255*q[2])<<16|Math.round(255*q[1])<<8|Math.round(255*q[0])<<0)>>>0}}var P={multVec:(b,d)=>[b[0]*d[0]+b[1]*d[1]+b[2]*d[2]+b[3]*d[3],b[4]*d[0]+b[5]*d[1]+b[6]*d[2]+b[7]*d[3],b[8]*d[0]+b[9]*d[1]+b[10]*d[2]+b[11]*d[3],b[12]*d[0]+b[13]*d[1]+b[14]*d[2]+b[15]*d[3]],dot:(b,d)=>b[0]*d[0]+b[1]*d[1]+b[2]*d[2]+b[3]*d[3],sml:(b,d)=>[b*d[0],b*d[1],b*d[2],b*d[3]]};ot.encode=function(d,v,j,k,E,_,A){k==null&&(k=0),A==null&&(A=!1);const p=o(d,v,j,k,[!1,!1,!1,0,A,!1]);return g(p,-1),w(p,v,j,E,_)},ot.encodeLL=function(d,v,j,k,E,_,A,p){const x={ctype:0+(k==1?0:2)+(E==0?0:4),depth:_,frames:[]},W=(k+E)*_,z=W*v;for(let L=0;L<d.length;L++)x.frames.push({rect:{x:0,y:0,width:v,height:j},img:new Uint8Array(d[L]),blend:0,dispose:1,bpp:Math.ceil(W/8),bpl:Math.ceil(z/8)});return g(x,0,!0),w(x,v,j,A,p)},ot.encode.compress=o,ot.encode.dither=c,ot.quantize=N,ot.quantize.getKDtree=R,ot.quantize.getNearest=S})();const Gr={toArrayBuffer(u,f){const r=u.width,n=u.height,t=r<<2,e=u.getContext("2d").getImageData(0,0,r,n),i=new Uint32Array(e.data.buffer),c=(32*r+31)/32<<2,w=c*n,g=122+w,o=new ArrayBuffer(g),l=new DataView(o),a=1<<20;let h,m,N,R,S=a,I=0,F=0,D=0;function M(b){l.setUint16(F,b,!0),F+=2}function y(b){l.setUint32(F,b,!0),F+=4}function P(b){F+=b}M(19778),y(g),P(4),y(122),y(108),y(r),y(-n>>>0),M(1),M(32),y(3),y(w),y(2835),y(2835),P(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),(function b(){for(;I<n&&S>0;){for(R=122+I*c,h=0;h<t;)S--,m=i[D++],N=m>>>24,l.setUint32(R+h,m<<8|N),h+=4;I++}D<i.length?(S=a,setTimeout(b,Gr._dly)):f(o)})()},toBlob(u,f){this.toArrayBuffer(u,(r=>{f(new Blob([r],{type:"image/bmp"}))}))},_dly:9};var Ke={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Pn={[Ke.CHROME]:16384,[Ke.FIREFOX]:11180,[Ke.DESKTOP_SAFARI]:16384,[Ke.IE]:8192,[Ke.IOS]:4096,[Ke.ETC]:8192};const lr=typeof window<"u",qr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,zt=lr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),In=(lr||qr)&&(zt&&zt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Vr=(lr||qr)&&(zt&&zt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function cr(u,f,r=Date.now()){return new Promise((n=>{const t=u.split(","),e=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]);let c=i.length;const w=new Uint8Array(c);for(;c--;)w[c]=i.charCodeAt(c);const g=new Blob([w],{type:e});g.name=f,g.lastModified=r,n(g)}))}function Kr(u){return new Promise(((f,r)=>{const n=new Vr;n.onload=()=>f(n.result),n.onerror=t=>r(t),n.readAsDataURL(u)}))}function Yr(u){return new Promise(((f,r)=>{const n=new Image;n.onload=()=>f(n),n.onerror=t=>r(t),n.src=u}))}function xt(){if(xt.cachedResult!==void 0)return xt.cachedResult;let u=Ke.ETC;const{userAgent:f}=navigator;return/Chrom(e|ium)/i.test(f)?u=Ke.CHROME:/iP(ad|od|hone)/i.test(f)&&/WebKit/i.test(f)?u=Ke.IOS:/Safari/i.test(f)?u=Ke.DESKTOP_SAFARI:/Firefox/i.test(f)?u=Ke.FIREFOX:(/MSIE/i.test(f)||document.documentMode)&&(u=Ke.IE),xt.cachedResult=u,xt.cachedResult}function Zr(u,f){const r=xt(),n=Pn[r];let t=u,e=f,i=t*e;const c=t>e?e/t:t/e;for(;i>n*n;){const w=(n+t)/2,g=(n+e)/2;w<g?(e=g,t=g*c):(e=w*c,t=w),i=t*e}return{width:t,height:e}}function Bt(u,f){let r,n;try{if(r=new OffscreenCanvas(u,f),n=r.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),n=r.getContext("2d")}return r.width=u,r.height=f,[r,n]}function Jr(u,f){const{width:r,height:n}=Zr(u.width,u.height),[t,e]=Bt(r,n);return f&&/jpe?g/.test(f)&&(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)),e.drawImage(u,0,0,t.width,t.height),t}function It(){return It.cachedResult!==void 0||(It.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),It.cachedResult}function $t(u,f={}){return new Promise((function(r,n){let t,e;var i=function(){try{return e=Jr(t,f.fileType||u.type),r([t,e])}catch(w){return n(w)}},c=function(w){try{var g=function(o){try{throw o}catch(l){return n(l)}};try{let o;return Kr(u).then((function(l){try{return o=l,Yr(o).then((function(a){try{return t=a,(function(){try{return i()}catch(h){return n(h)}})()}catch(h){return g(h)}}),g)}catch(a){return g(a)}}),g)}catch(o){g(o)}}catch(o){return n(o)}};try{if(It()||[Ke.DESKTOP_SAFARI,Ke.MOBILE_SAFARI].includes(xt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(u).then((function(w){try{return t=w,i()}catch{return c()}}),c)}catch{c()}}))}function Ot(u,f,r,n,t=1){return new Promise((function(e,i){let c;if(f==="image/png"){let g,o,l;return g=u.getContext("2d"),{data:o}=g.getImageData(0,0,u.width,u.height),l=ot.encode([o.buffer],u.width,u.height,4096*t),c=new Blob([l],{type:f}),c.name=r,c.lastModified=n,w.call(this)}{let g=function(){return w.call(this)};if(f==="image/bmp")return new Promise((o=>Gr.toBlob(u,o))).then((function(o){try{return c=o,c.name=r,c.lastModified=n,g.call(this)}catch(l){return i(l)}}).bind(this),i);{let o=function(){return g.call(this)};if(typeof OffscreenCanvas=="function"&&u instanceof OffscreenCanvas)return u.convertToBlob({type:f,quality:t}).then((function(l){try{return c=l,c.name=r,c.lastModified=n,o.call(this)}catch(a){return i(a)}}).bind(this),i);{let l;return l=u.toDataURL(f,t),cr(l,r,n).then((function(a){try{return c=a,o.call(this)}catch(h){return i(h)}}).bind(this),i)}}}function w(){return e(c)}}))}function it(u){u.width=0,u.height=0}function vt(){return new Promise((function(u,f){let r,n,t,e;return vt.cachedResult!==void 0?u(vt.cachedResult):cr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(i){try{return r=i,$t(r).then((function(c){try{return n=c[1],Ot(n,r.type,r.name,r.lastModified).then((function(w){try{return t=w,it(n),$t(t).then((function(g){try{return e=g[0],vt.cachedResult=e.width===1&&e.height===2,u(vt.cachedResult)}catch(o){return f(o)}}),f)}catch(g){return f(g)}}),f)}catch(w){return f(w)}}),f)}catch(c){return f(c)}}),f)}))}function Qr(u){return new Promise(((f,r)=>{const n=new Vr;n.onload=t=>{const e=new DataView(t.target.result);if(e.getUint16(0,!1)!=65496)return f(-2);const i=e.byteLength;let c=2;for(;c<i;){if(e.getUint16(c+2,!1)<=8)return f(-1);const w=e.getUint16(c,!1);if(c+=2,w==65505){if(e.getUint32(c+=2,!1)!=1165519206)return f(-1);const g=e.getUint16(c+=6,!1)==18761;c+=e.getUint32(c+4,g);const o=e.getUint16(c,g);c+=2;for(let l=0;l<o;l++)if(e.getUint16(c+12*l,g)==274)return f(e.getUint16(c+12*l+8,g))}else{if((65280&w)!=65280)break;c+=e.getUint16(c,!1)}}return f(-1)},n.onerror=t=>r(t),n.readAsArrayBuffer(u)}))}function Xr(u,f){const{width:r}=u,{height:n}=u,{maxWidthOrHeight:t}=f;let e,i=u;return isFinite(t)&&(r>t||n>t)&&([i,e]=Bt(r,n),r>n?(i.width=t,i.height=n/r*t):(i.width=r/n*t,i.height=t),e.drawImage(u,0,0,i.width,i.height),it(u)),i}function en(u,f){const{width:r}=u,{height:n}=u,[t,e]=Bt(r,n);switch(f>4&&f<9?(t.width=n,t.height=r):(t.width=r,t.height=n),f){case 2:e.transform(-1,0,0,1,r,0);break;case 3:e.transform(-1,0,0,-1,r,n);break;case 4:e.transform(1,0,0,-1,0,n);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,n,0);break;case 7:e.transform(0,-1,-1,0,n,r);break;case 8:e.transform(0,-1,1,0,0,r)}return e.drawImage(u,0,0,r,n),it(u),t}function Sr(u,f,r=0){return new Promise((function(n,t){let e,i,c,w,g,o,l,a,h,m,N,R,S,I,F,D,M,y,P,b;function d(j=5){if(f.signal&&f.signal.aborted)throw f.signal.reason;e+=j,f.onProgress(Math.min(e,100))}function v(j){if(f.signal&&f.signal.aborted)throw f.signal.reason;e=Math.min(Math.max(j,e),100),f.onProgress(e)}return e=r,i=f.maxIteration||10,c=1024*f.maxSizeMB*1024,d(),$t(u,f).then((function(j){try{return[,w]=j,d(),g=Xr(w,f),d(),new Promise((function(k,E){var _;if(!(_=f.exifOrientation))return Qr(u).then((function(p){try{return _=p,A.call(this)}catch(x){return E(x)}}).bind(this),E);function A(){return k(_)}return A.call(this)})).then((function(k){try{return o=k,d(),vt().then((function(E){try{return l=E?g:en(g,o),d(),a=f.initialQuality||1,h=f.fileType||u.type,Ot(l,h,u.name,u.lastModified,a).then((function(_){try{{let p=function(){if(i--&&(F>c||F>S)){let W,z;return W=b?.95*P.width:P.width,z=b?.95*P.height:P.height,[M,y]=Bt(W,z),y.drawImage(P,0,0,W,z),a*=h==="image/png"?.85:.95,Ot(M,h,u.name,u.lastModified,a).then((function(L){try{return D=L,it(P),P=M,F=D.size,v(Math.min(99,Math.floor((I-F)/(I-c)*100))),p}catch(H){return t(H)}}),t)}return[1]},x=function(){return it(P),it(M),it(g),it(l),it(w),v(100),n(D)};if(m=_,d(),N=m.size>c,R=m.size>u.size,!N&&!R)return v(100),n(m);var A;return S=u.size,I=m.size,F=I,P=l,b=!f.alwaysKeepResolution&&N,(A=(function(W){for(;W;){if(W.then)return void W.then(A,t);try{if(W.pop){if(W.length)return W.pop()?x.call(this):W;W=p}else W=W.call(this)}catch(z){return t(z)}}}).bind(this))(p)}}catch(p){return t(p)}}).bind(this),t)}catch(_){return t(_)}}).bind(this),t)}catch(E){return t(E)}}).bind(this),t)}catch(k){return t(k)}}).bind(this),t)}))}const Fn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Qt;function zn(u,f){return new Promise(((r,n)=>{Qt||(Qt=(function(i){const c=[];return c.push(i),URL.createObjectURL(new Blob(c))})(Fn));const t=new Worker(Qt);t.addEventListener("message",(function(i){if(f.signal&&f.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return n(new Error(i.data.error)),void t.terminate();r(i.data.file),t.terminate()}else f.onProgress(i.data.progress)})),t.addEventListener("error",n),f.signal&&f.signal.addEventListener("abort",(()=>{n(f.signal.reason),t.terminate()})),t.postMessage({file:u,imageCompressionLibUrl:f.libURL,options:{...f,onProgress:void 0,signal:void 0}})}))}function Be(u,f){return new Promise((function(r,n){let t,e,i,c,w,g;if(t={...f},i=0,{onProgress:c}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,w=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=h=>{i=h,typeof c=="function"&&c(i)},!(u instanceof Blob||u instanceof In))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(u.type))return n(new Error("The file given is not an image"));if(g=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!w||typeof Worker!="function"||g)return Sr(u,t).then((function(h){try{return e=h,a.call(this)}catch(m){return n(m)}}).bind(this),n);var o=(function(){try{return a.call(this)}catch(h){return n(h)}}).bind(this),l=function(h){try{return Sr(u,t).then((function(m){try{return e=m,o()}catch(N){return n(N)}}),n)}catch(m){return n(m)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",zn(u,t).then((function(h){try{return e=h,o()}catch{return l()}}),l)}catch{l()}function a(){try{e.name=u.name,e.lastModified=u.lastModified}catch{}try{t.preserveExif&&u.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===u.type)&&(e=Wr(u,e))}catch{}return r(e)}}))}Be.getDataUrlFromFile=Kr,Be.getFilefromDataUrl=cr,Be.loadImage=Yr,Be.drawImageInCanvas=Jr,Be.drawFileInCanvas=$t,Be.canvasToFile=Ot,Be.getExifOrientation=Qr,Be.handleMaxWidthOrHeight=Xr,Be.followExifOrientation=en,Be.cleanupCanvasMemory=it,Be.isAutoOrientationInBrowser=vt,Be.approximateBelowMaximumCanvasSizeOfBrowser=Zr,Be.copyExifWithoutOrientation=Wr,Be.getBrowserName=xt,Be.version="2.0.2";var ar=function(u,f){return ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])},ar(u,f)};function $n(u,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");ar(u,f);function r(){this.constructor=u}u.prototype=f===null?Object.create(f):(r.prototype=f.prototype,new r)}var ze=function(){return ze=Object.assign||function(f){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(f[e]=r[e])}return f},ze.apply(this,arguments)};var Xt,Nr;function On(){if(Nr)return Xt;Nr=1;var u=!1,f,r,n,t,e,i,c,w,g,o,l,a,h,m,N;function R(){if(!u){u=!0;var I=navigator.userAgent,F=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(I),D=/(Mac OS X)|(Windows)|(Linux)/.exec(I);if(a=/\b(iPhone|iP[ao]d)/.exec(I),h=/\b(iP[ao]d)/.exec(I),o=/Android/i.exec(I),m=/FBAN\/\w+;/i.exec(I),N=/Mobile/i.exec(I),l=!!/Win64/.exec(I),F){f=F[1]?parseFloat(F[1]):F[5]?parseFloat(F[5]):NaN,f&&document&&document.documentMode&&(f=document.documentMode);var M=/(?:Trident\/(\d+.\d+))/.exec(I);i=M?parseFloat(M[1])+4:f,r=F[2]?parseFloat(F[2]):NaN,n=F[3]?parseFloat(F[3]):NaN,t=F[4]?parseFloat(F[4]):NaN,t?(F=/(?:Chrome\/(\d+\.\d+))/.exec(I),e=F&&F[1]?parseFloat(F[1]):NaN):e=NaN}else f=r=n=e=t=NaN;if(D){if(D[1]){var y=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(I);c=y?parseFloat(y[1].replace("_",".")):!0}else c=!1;w=!!D[2],g=!!D[3]}else c=w=g=!1}}var S={ie:function(){return R()||f},ieCompatibilityMode:function(){return R()||i>f},ie64:function(){return S.ie()&&l},firefox:function(){return R()||r},opera:function(){return R()||n},webkit:function(){return R()||t},safari:function(){return S.webkit()},chrome:function(){return R()||e},windows:function(){return R()||w},osx:function(){return R()||c},linux:function(){return R()||g},iphone:function(){return R()||a},mobile:function(){return R()||a||h||o||N},nativeApp:function(){return R()||m},android:function(){return R()||o},ipad:function(){return R()||h}};return Xt=S,Xt}var er,Er;function Bn(){if(Er)return er;Er=1;var u=!!(typeof window<"u"&&window.document&&window.document.createElement),f={canUseDOM:u,canUseWorkers:typeof Worker<"u",canUseEventListeners:u&&!!(window.addEventListener||window.attachEvent),canUseViewport:u&&!!window.screen,isInWorker:!u};return er=f,er}var tr,Ar;function Hn(){if(Ar)return tr;Ar=1;var u=Bn(),f;u.canUseDOM&&(f=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function r(n,t){if(!u.canUseDOM||t&&!("addEventListener"in document))return!1;var e="on"+n,i=e in document;if(!i){var c=document.createElement("div");c.setAttribute(e,"return;"),i=typeof c[e]=="function"}return!i&&f&&n==="wheel"&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i}return tr=r,tr}var rr,Rr;function Wn(){if(Rr)return rr;Rr=1;var u=On(),f=Hn(),r=10,n=40,t=800;function e(i){var c=0,w=0,g=0,o=0;return"detail"in i&&(w=i.detail),"wheelDelta"in i&&(w=-i.wheelDelta/120),"wheelDeltaY"in i&&(w=-i.wheelDeltaY/120),"wheelDeltaX"in i&&(c=-i.wheelDeltaX/120),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(c=w,w=0),g=c*r,o=w*r,"deltaY"in i&&(o=i.deltaY),"deltaX"in i&&(g=i.deltaX),(g||o)&&i.deltaMode&&(i.deltaMode==1?(g*=n,o*=n):(g*=t,o*=t)),g&&!c&&(c=g<1?-1:1),o&&!w&&(w=o<1?-1:1),{spinX:c,spinY:w,pixelX:g,pixelY:o}}return e.getEventType=function(){return u.firefox()?"DOMMouseScroll":f("wheel")?"wheel":"mousewheel"},rr=e,rr}var nr,Lr;function Gn(){return Lr||(Lr=1,nr=Wn()),nr}var qn=Gn();const Vn=jn(qn);function Kn(u,f,r,n,t,e){e===void 0&&(e=0);var i=yt(u,f,e),c=i.width,w=i.height,g=Math.min(c,r),o=Math.min(w,n);return g>o*t?{width:o*t,height:o}:{width:g,height:g/t}}function Yn(u){return u.width>u.height?u.width/u.naturalWidth:u.height/u.naturalHeight}function St(u,f,r,n,t){t===void 0&&(t=0);var e=yt(f.width,f.height,t),i=e.width,c=e.height;return{x:Mr(u.x,i,r.width,n),y:Mr(u.y,c,r.height,n)}}function Mr(u,f,r,n){var t=f*n/2-r/2;return Ht(u,-t,t)}function Tr(u,f){return Math.sqrt(Math.pow(u.y-f.y,2)+Math.pow(u.x-f.x,2))}function Dr(u,f){return Math.atan2(f.y-u.y,f.x-u.x)*180/Math.PI}function Zn(u,f,r,n,t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);var c=i?Jn:Qn,w=yt(f.width,f.height,e),g=yt(f.naturalWidth,f.naturalHeight,e),o={x:c(100,((w.width-r.width/t)/2-u.x/t)/w.width*100),y:c(100,((w.height-r.height/t)/2-u.y/t)/w.height*100),width:c(100,r.width/w.width*100/t),height:c(100,r.height/w.height*100/t)},l=Math.round(c(g.width,o.width*g.width/100)),a=Math.round(c(g.height,o.height*g.height/100)),h=g.width>=g.height*n,m=h?{width:Math.round(a*n),height:a}:{width:l,height:Math.round(l/n)},N=ze(ze({},m),{x:Math.round(c(g.width-m.width,o.x*g.width/100)),y:Math.round(c(g.height-m.height,o.y*g.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:N}}function Jn(u,f){return Math.min(u,Math.max(0,f))}function Qn(u,f){return f}function Xn(u,f,r,n,t,e){var i=yt(f.width,f.height,r),c=Ht(n.width/i.width*(100/u.width),t,e),w={x:c*i.width/2-n.width/2-i.width*c*(u.x/100),y:c*i.height/2-n.height/2-i.height*c*(u.y/100)};return{crop:w,zoom:c}}function es(u,f,r){var n=Yn(f);return r.height>r.width?r.height/(u.height*n):r.width/(u.width*n)}function ts(u,f,r,n,t,e){r===void 0&&(r=0);var i=yt(f.naturalWidth,f.naturalHeight,r),c=Ht(es(u,f,n),t,e),w=n.height>n.width?n.height/u.height:n.width/u.width,g={x:((i.width-u.width)/2-u.x)*w,y:((i.height-u.height)/2-u.y)*w};return{crop:g,zoom:c}}function Ur(u,f){return{x:(f.x+u.x)/2,y:(f.y+u.y)/2}}function rs(u){return u*Math.PI/180}function yt(u,f,r){var n=rs(r);return{width:Math.abs(Math.cos(n)*u)+Math.abs(Math.sin(n)*f),height:Math.abs(Math.sin(n)*u)+Math.abs(Math.cos(n)*f)}}function Ht(u,f,r){return Math.min(Math.max(u,f),r)}function Dt(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];return u.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var ns=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,ss=1,os=3,as=1,is=(function(u){$n(f,u);function f(){var r=u!==null&&u.apply(this,arguments)||this;return r.cropperRef=U.createRef(),r.imageRef=U.createRef(),r.videoRef=U.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var n=!0;r.resizeObserver=new window.ResizeObserver(function(t){if(n){n=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(n){return n.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var n=r.computeSizes();n&&(r.previousCropSize=n,r.emitCropData(),r.setInitialCrop(n),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(n){if(r.props.initialCroppedAreaPercentages){var t=Xn(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=t.crop,i=t.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}else if(r.props.initialCroppedAreaPixels){var c=ts(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=c.crop,i=c.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}},r.computeSizes=function(){var n,t,e,i,c,w,g=r.imageRef.current||r.videoRef.current;if(g&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var o=r.containerRect.width/r.containerRect.height,l=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((t=r.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,a=((e=r.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((i=r.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,h=g.offsetWidth<l||g.offsetHeight<a,m=l/a,N=void 0;if(h)switch(r.state.mediaObjectFit){default:case"contain":N=o>m?{width:r.containerRect.height*m,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/m};break;case"horizontal-cover":N={width:r.containerRect.width,height:r.containerRect.width/m};break;case"vertical-cover":N={width:r.containerRect.height*m,height:r.containerRect.height};break}else N={width:g.offsetWidth,height:g.offsetHeight};r.mediaSize=ze(ze({},N),{naturalWidth:l,naturalHeight:a}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var R=r.props.cropSize?r.props.cropSize:Kn(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((c=r.state.cropSize)===null||c===void 0?void 0:c.height)!==R.height||((w=r.state.cropSize)===null||w===void 0?void 0:w.width)!==R.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(R),r.setState({cropSize:R},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(R),R}},r.saveContainerPosition=function(){if(r.containerRef){var n=r.containerRef.getBoundingClientRect();r.containerPosition={x:n.left,y:n.top}}},r.onMouseDown=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(f.getMousePoint(n)))},r.onMouseMove=function(n){return r.onDrag(f.getMousePoint(n))},r.onScroll=function(n){r.currentDoc&&(n.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(n){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(n))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),n.touches.length===2?r.onPinchStart(n):n.touches.length===1&&r.onDragStart(f.getTouchPoint(n.touches[0]))))},r.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?r.onPinchMove(n):n.touches.length===1&&r.onDrag(f.getTouchPoint(n.touches[0]))},r.onGestureStart=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(n){if(n.preventDefault(),!r.isTouching){var t=f.getMousePoint(n),e=r.gestureZoomStart-1+n.scale;if(r.setNewZoom(e,t,{shouldUpdatePosition:!0}),r.props.onRotationChange){var i=r.gestureRotationStart+n.rotation;r.props.onRotationChange(i)}}},r.onGestureEnd=function(n){r.cleanEvents()},r.onDragStart=function(n){var t,e,i=n.x,c=n.y;r.dragStartPosition={x:i,y:c},r.dragStartCrop=ze({},r.props.crop),(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t)},r.onDrag=function(n){var t=n.x,e=n.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(t===void 0||e===void 0)){var i=t-r.dragStartPosition.x,c=e-r.dragStartPosition.y,w={x:r.dragStartCrop.x+i,y:r.dragStartCrop.y+c},g=r.props.restrictPosition?St(w,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):w;r.props.onCropChange(g)}}))},r.onDragStopped=function(){var n,t;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(t=(n=r.props).onInteractionEnd)===null||t===void 0||t.call(n)},r.onWheel=function(n){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(n))){n.preventDefault();var t=f.getMousePoint(n),e=Vn(n).pixelY,i=r.props.zoom-e*r.props.zoomSpeed/200;r.setNewZoom(i,t,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var c,w;return(w=(c=r.props).onInteractionStart)===null||w===void 0?void 0:w.call(c)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var c,w;return(w=(c=r.props).onInteractionEnd)===null||w===void 0?void 0:w.call(c)})},250)}},r.getPointOnContainer=function(n,t){var e=n.x,i=n.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(e-t.x),y:r.containerRect.height/2-(i-t.y)}},r.getPointOnMedia=function(n){var t=n.x,e=n.y,i=r.props,c=i.crop,w=i.zoom;return{x:(t+c.x)/w,y:(e+c.y)/w}},r.setNewZoom=function(n,t,e){var i=e===void 0?{}:e,c=i.shouldUpdatePosition,w=c===void 0?!0:c;if(!(!r.state.cropSize||!r.props.onZoomChange)){var g=Ht(n,r.props.minZoom,r.props.maxZoom);if(w){var o=r.getPointOnContainer(t,r.containerPosition),l=r.getPointOnMedia(o),a={x:l.x*g-o.x,y:l.y*g-o.y},h=r.props.restrictPosition?St(a,r.mediaSize,r.state.cropSize,g,r.props.rotation):a;r.props.onCropChange(h)}r.props.onZoomChange(g)}},r.getCropData=function(){if(!r.state.cropSize)return null;var n=r.props.restrictPosition?St(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return Zn(n,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,e),r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.emitCropAreaChange=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.recomputeCropPosition=function(){var n,t;if(r.state.cropSize){var e=r.props.crop;if(r.isInitialized&&(!((n=r.previousCropSize)===null||n===void 0)&&n.width)&&(!((t=r.previousCropSize)===null||t===void 0)&&t.height)){var i=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(i){var c=r.state.cropSize.width/r.previousCropSize.width,w=r.state.cropSize.height/r.previousCropSize.height;e={x:r.props.crop.x*c,y:r.props.crop.y*w}}}var g=r.props.restrictPosition?St(e,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):e;r.previousCropSize=r.state.cropSize,r.props.onCropChange(g),r.emitCropData()}},r.onKeyDown=function(n){var t,e,i=r.props,c=i.crop,w=i.onCropChange,g=i.keyboardStep,o=i.zoom,l=i.rotation,a=g;if(r.state.cropSize){n.shiftKey&&(a*=.2);var h=ze({},c);switch(n.key){case"ArrowUp":h.y-=a,n.preventDefault();break;case"ArrowDown":h.y+=a,n.preventDefault();break;case"ArrowLeft":h.x-=a,n.preventDefault();break;case"ArrowRight":h.x+=a,n.preventDefault();break;default:return}r.props.restrictPosition&&(h=St(h,r.mediaSize,r.state.cropSize,o,l)),n.repeat||(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t),w(h)}},r.onKeyUp=function(n){var t,e;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}r.emitCropData(),(e=(t=r.props).onInteractionEnd)===null||e===void 0||e.call(t)},r}return f.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=ns,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},f.prototype.componentWillUnmount=function(){var r,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},f.prototype.componentDidUpdate=function(r){var n,t,e,i,c,w,g,o,l;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((n=r.cropSize)===null||n===void 0?void 0:n.height)!==((t=this.props.cropSize)===null||t===void 0?void 0:t.height)||((e=r.cropSize)===null||e===void 0?void 0:e.width)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.width)?this.computeSizes():(((c=r.crop)===null||c===void 0?void 0:c.x)!==((w=this.props.crop)===null||w===void 0?void 0:w.x)||((g=r.crop)===null||g===void 0?void 0:g.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((l=this.videoRef.current)===null||l===void 0||l.load());var a=this.getObjectFit();a!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:a},this.computeSizes)},f.prototype.getAspect=function(){var r=this.props,n=r.cropSize,t=r.aspect;return n?n.width/n.height:t},f.prototype.getObjectFit=function(){var r,n,t,e;if(this.props.objectFit==="cover"){var i=this.imageRef.current||this.videoRef.current;if(i&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,w=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,g=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalHeight)||((e=this.videoRef.current)===null||e===void 0?void 0:e.videoHeight)||0,o=w/g;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},f.prototype.onPinchStart=function(r){var n=f.getTouchPoint(r.touches[0]),t=f.getTouchPoint(r.touches[1]);this.lastPinchDistance=Tr(n,t),this.lastPinchRotation=Dr(n,t),this.onDragStart(Ur(n,t))},f.prototype.onPinchMove=function(r){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var t=f.getTouchPoint(r.touches[0]),e=f.getTouchPoint(r.touches[1]),i=Ur(t,e);this.onDrag(i),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=Tr(t,e),w=n.props.zoom*(c/n.lastPinchDistance);n.setNewZoom(w,i,{shouldUpdatePosition:!1}),n.lastPinchDistance=c;var g=Dr(t,e),o=n.props.rotation+(g-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(o),n.lastPinchRotation=g})}},f.prototype.render=function(){var r=this,n,t=this.props,e=t.image,i=t.video,c=t.mediaProps,w=t.cropperProps,g=t.transform,o=t.crop,l=o.x,a=o.y,h=t.rotation,m=t.zoom,N=t.cropShape,R=t.showGrid,S=t.roundCropAreaPixels,I=t.style,F=I.containerStyle,D=I.cropAreaStyle,M=I.mediaStyle,y=t.classes,P=y.containerClassName,b=y.cropAreaClassName,d=y.mediaClassName,v=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return U.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(k){return r.containerRef=k},"data-testid":"container",style:F,className:Dt("reactEasyCrop_Container",P)},e?U.createElement("img",ze({alt:"",className:Dt("reactEasyCrop_Image",v==="contain"&&"reactEasyCrop_Contain",v==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",v==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",d)},c,{src:e,ref:this.imageRef,style:ze(ze({},M),{transform:g||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(m,")")}),onLoad:this.onMediaLoad})):i&&U.createElement("video",ze({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Dt("reactEasyCrop_Video",v==="contain"&&"reactEasyCrop_Contain",v==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",v==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",d)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:ze(ze({},M),{transform:g||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(m,")")}),controls:!1}),(Array.isArray(i)?i:[{src:i}]).map(function(j){return U.createElement("source",ze({key:j.src},j))})),this.state.cropSize&&U.createElement("div",ze({ref:this.cropperRef,style:ze(ze({},D),{width:S?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:S?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Dt("reactEasyCrop_CropArea",N==="round"&&"reactEasyCrop_CropAreaRound",R&&"reactEasyCrop_CropAreaGrid",b)},w)))},f.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:os,minZoom:ss,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:as},f.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},f.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},f})(U.Component);const Oe=[];for(let u=0;u<256;++u)Oe.push((u+256).toString(16).slice(1));function ls(u,f=0){return(Oe[u[f+0]]+Oe[u[f+1]]+Oe[u[f+2]]+Oe[u[f+3]]+"-"+Oe[u[f+4]]+Oe[u[f+5]]+"-"+Oe[u[f+6]]+Oe[u[f+7]]+"-"+Oe[u[f+8]]+Oe[u[f+9]]+"-"+Oe[u[f+10]]+Oe[u[f+11]]+Oe[u[f+12]]+Oe[u[f+13]]+Oe[u[f+14]]+Oe[u[f+15]]).toLowerCase()}let sr;const cs=new Uint8Array(16);function ds(){if(!sr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");sr=crypto.getRandomValues.bind(crypto)}return sr(cs)}const us=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pr={randomUUID:us};function fs(u,f,r){u=u||{};const n=u.random??u.rng?.()??ds();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ls(n)}function hs(u,f,r){return Pr.randomUUID&&!u?Pr.randomUUID():fs(u)}const Ir=50,Ut=u=>{let f=null;if(u.reply_to){const r=Array.isArray(u.reply_to)?u.reply_to[0]:u.reply_to;u.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",u.reply_to_message_id,"reply_to:",u.reply_to,"replyToData:",r),r&&console.log("[normalizeMessage] replyToData.id:",r.id,"replyToData.user_id:",r.user_id,"replyToData.content:",r.content)),r&&r.id&&r.user_id?f={id:r.id,content:r.content||"",user_id:r.user_id,author_name:r.author_name}:u.reply_to_message_id&&r&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",r,"has id:",!!r?.id,"has user_id:",!!r?.user_id)}return{id:u.id,league_id:u.league_id,user_id:u.user_id,content:u.content,created_at:u.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:u.reply_to_message_id??null,reply_to:f}},Nt=u=>{const f=new Map;for(const r of u)f.set(r.id,r);return Array.from(f.values()).sort((r,n)=>new Date(r.created_at).getTime()-new Date(n.created_at).getTime())};function ms(u,f={}){const{userId:r,enabled:n=!0,autoSubscribe:t=!0}=f,[e,i]=U.useState([]),[c,w]=U.useState(!1),[g,o]=U.useState(!1),[l,a]=U.useState(!0),[h,m]=U.useState(null),N=U.useRef(null),R=U.useCallback(y=>{i(P=>{const b=y(P);return N.current=b.length?b[0].created_at:null,b})},[]),S=U.useCallback(async({before:y,append:P})=>{if(!u||!n)return;console.log("[fetchPage] Starting fetch for league:",u,"append:",P,"before:",y);const b=ae.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",u).order("created_at",{ascending:!1}).limit(Ir);y&&b.lt("created_at",y);const{data:d,error:v}=await b;if(v)throw v;console.log("[fetchPage] Fetched",d?.length||0,"messages from database");const j=(d??[]).filter(A=>A.reply_to_message_id),k=[...new Set(j.map(A=>A.reply_to_message_id))];console.log("[fetchPage] Found",j.length,"messages with reply_to_message_id, unique reply IDs:",k.length);let E=new Map;if(k.length>0){const{data:A,error:p}=await ae.from("league_messages").select("id, content, user_id").in("id",k);!p&&A&&A.forEach(x=>{E.set(x.id,x)})}if(d&&d.length>0){const A=d.filter(p=>p.reply_to_message_id);A.length>0&&(console.log("[fetchPage] Found",A.length,"messages with reply_to_message_id"),A.slice(0,3).forEach(p=>{const x=E.get(p.reply_to_message_id);console.log("[fetchPage] Message",p.id,"reply_to_message_id:",p.reply_to_message_id,"replyData:",x)}))}const _=(d??[]).map(A=>{if(A.reply_to_message_id){const p=E.get(A.reply_to_message_id);p?A.reply_to=p:A.reply_to=null}else A.reply_to=null;return Ut(A)}).reverse();R(A=>Nt(P?[..._,...A]:_)),(d??[]).length<Ir?a(!1):P||a(!0)},[u,n,R]),I=U.useCallback(async()=>{if(!u||!n){i([]),a(!0);return}w(!0),m(null),N.current=null;try{await S({append:!1})}catch(y){m(y?.message??"Failed to load chat")}finally{w(!1)}},[u,n,S]);U.useEffect(()=>{if(!u||!n){i([]),a(!0);return}let y=!0;if(I(),!t)return()=>{y=!1};const P=ae.channel(`league-messages:${u}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${u}`},async b=>{if(!y)return;const{data:d}=await ae.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",b.new.id).single();if(d){if(d.reply_to_message_id){const{data:j}=await ae.from("league_messages").select("id, content, user_id").eq("id",d.reply_to_message_id).single();j&&(d.reply_to=j)}const v=Ut(d);R(j=>j.some(k=>k.id===v.id)?j:Nt([...j,v]))}else{const v=Ut(b.new);R(j=>j.some(k=>k.id===v.id)?j:Nt([...j,v]))}}).subscribe();return()=>{y=!1,ae.removeChannel(P)}},[u,n,t,I,R]);const F=U.useCallback(async()=>{if(!u||!n||!l||g)return;const y=N.current??e[0]?.created_at;if(y){o(!0);try{await S({before:y,append:!0})}catch(P){m(P?.message??"Failed to load more messages")}finally{o(!1)}}},[u,n,l,g,S,e]),D=U.useCallback(async(y,P)=>{if(!u||!r)throw new Error("Missing league or user");const b=y.trim();if(!b)return;const d=hs(),v=`optimistic-${d}`,j={id:v,client_msg_id:d,league_id:u,user_id:r,content:b,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:P??null};R(_=>Nt([..._,j]));const{data:k,error:E}=await ae.from("league_messages").insert({league_id:u,user_id:r,content:b,reply_to_message_id:P??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(k&&k.reply_to_message_id){const{data:_}=await ae.from("league_messages").select("id, content, user_id").eq("id",k.reply_to_message_id).single();_&&(k.reply_to=_)}if(E)throw R(_=>_.map(A=>A.id===v?{...A,status:"error"}:A)),E;if(k){const _=Ut(k);_.client_msg_id=d,R(A=>A.map(p=>p.id===v?{..._,status:"sent",client_msg_id:d}:p))}},[u,r,R]),M=U.useMemo(()=>e.slice(-5),[e]);return{messages:e,previewMessages:M,loading:c,loadingMore:g,hasMore:l,error:h,refresh:I,loadMore:F,sendMessage:D}}const ps={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},gs={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},xs=["","",""],ws=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function tn({author:u,text:f,time:r,isOwnMessage:n,shape:t="single",messageId:e,reactions:i=[],onReactionClick:c,replyTo:w,onMessageClick:g}){const o=n?"text-right":"text-left",l=n?"bg-[#1C8376] text-white":"bg-white text-slate-900",a=n?gs:ps,h="max-w-[80%]",[m,N]=U.useState(!1),[R,S]=U.useState(!1),I=U.useRef(null);U.useEffect(()=>{if(!m)return;const M=P=>{I.current&&!I.current.contains(P.target)&&N(!1)},y=setTimeout(()=>{document.addEventListener("mousedown",M)},100);return()=>{clearTimeout(y),document.removeEventListener("mousedown",M)}},[m]);const F=M=>{e&&c&&c(e,M),N(!1),S(!1)},D=M=>{const y=M.target;y.closest("button")||y.closest("[data-reaction]")||g&&g()};return s.jsxs("div",{className:`inline-block w-fit ${h} min-w-0 relative`,children:[s.jsxs("div",{className:`px-3 py-2 text-sm leading-snug shadow-sm whitespace-normal break-words ${o} ${l} ${a[t]} ${g?"cursor-pointer hover:opacity-90 transition-opacity":""}`,onClick:D,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[u&&!n&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:u}),w&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${n?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-sm`,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[s.jsx("div",{className:"font-medium text-xs mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:w.authorName||"Unknown"}),s.jsx("div",{className:"text-xs line-clamp-2 truncate break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:w.content})]}),s.jsx("div",{style:{wordBreak:"break-word",overflowWrap:"break-word"},children:f}),s.jsx("div",{className:"text-[11px] text-[#DCDCDD] mt-1",children:r})]}),e&&!n&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[m&&s.jsxs("div",{ref:I,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[xs.map(M=>s.jsx("button",{onClick:()=>F(M),className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-base",title:`React with ${M}`,children:M},M)),g&&s.jsx("button",{onClick:()=>{N(!1),g()},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{N(!1),S(!0)},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>N(!m),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200 transition-colors flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),R&&e&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>S(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>S(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:ws.map(M=>s.jsx("button",{onClick:()=>{e&&c&&c(e,M),S(!1)},className:"w-10 h-10 rounded-lg hover:bg-slate-100 active:bg-slate-200 transition-colors flex items-center justify-center text-2xl",title:M,children:M},M))})]})})]}),i.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${n?"justify-end":"justify-start"}`,children:i.map(M=>s.jsxs("button",{onClick:()=>F(M.emoji),className:`px-2 py-0.5 rounded-full text-xs flex items-center gap-1 transition-colors ${M.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:[s.jsx("span",{children:M.emoji}),s.jsx("span",{children:M.count})]},M.emoji))})]})}function bs({author:u,messages:f,isOwnMessage:r,avatarInitials:n,userId:t,reactions:e,onReactionClick:i,onMessageClick:c}){u==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",r,"messages:",f.length);const w=r?"justify-end":"justify-start",g=t===ir;return s.jsxs("div",{className:`flex items-end gap-3 w-full ${w}`,children:[r?s.jsx("div",{className:"w-10 flex-shrink-0"}):g?s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:Br,alt:"Volley",className:"w-10 h-10 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-sm font-semibold text-slate-500 flex-shrink-0",children:(n||u.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:f.map((o,l)=>{const a=f.length===1?"single":l===0?"top":l===f.length-1?"bottom":"middle",h=o.messageId||o.id;let m="";if(typeof o.text=="string")m=o.text;else if(typeof o.text=="object"&&o.text!==null){const N=o.text?.props?.children||String(o.text);m=typeof N=="string"?N:String(N)}else m=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${r?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${r?"justify-end":"justify-start"}`,children:[s.jsx(tn,{author:!r&&l===0?u:void 0,text:o.text,time:o.time,isOwnMessage:r,shape:a,messageId:h,reactions:e?.[h]||[],onReactionClick:i,replyTo:o.replyTo,onMessageClick:c?()=>c(h,m,!r&&l===0?u:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function vs({groups:u,reactions:f,onReactionClick:r,onMessageClick:n}){const t=u.filter(e=>e.author==="Unknown");return t.length>0&&(console.error("[ChatThread] RENDERING with",t.length,'groups with "Unknown" author!'),t.forEach((e,i)=>{console.error(`[ChatThread] Group ${i}: id="${e.id}", author="${e.author}", messages=${e.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:u.map((e,i)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[e.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:e.dayLabel}),s.jsx(bs,{author:e.author,avatarInitials:e.avatarInitials,isOwnMessage:e.isOwnMessage,userId:e.userId,messages:e.messages,reactions:f,onReactionClick:r,onMessageClick:n},`${e.id}-${e.author}-${i}`)]},`${e.id}-${e.author}-${i}`))})}const ys=u=>new Date(u).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),_s=u=>new Date(u).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Fr=u=>{if(!u)return"?";const f=u.trim().split(/\s+/);return f.length===1?f[0][0]?.toUpperCase()??"?":`${f[0][0]?.toUpperCase()??""}${f[f.length-1][0]?.toUpperCase()??""}`},bt=(u,f)=>f?f instanceof Map?f.get(u)??"":f[u]??"":"";function js({miniLeagueId:u,memberNames:f}){const{user:r}=Hr(),{messages:n,loading:t,loadingMore:e,hasMore:i,error:c,loadMore:w,sendMessage:g}=ms(u,{userId:r?.id,enabled:!!u}),[o,l]=U.useState(""),[a,h]=U.useState(!1),[m,N]=U.useState({}),[R,S]=U.useState(null),[I,F]=U.useState(0),D=U.useRef(null),M=U.useRef(null),y=U.useRef(null),[P,b]=U.useState(0),d=U.useCallback(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[]),v=U.useCallback((L=[0,100,300,500,700])=>{requestAnimationFrame(()=>{L.forEach(H=>{setTimeout(()=>d(),H)})})},[d]);U.useEffect(()=>{if(n.length===0||!r?.id)return;const L=n.map(O=>O.id);if(L.length===0)return;(async()=>{try{const{data:O,error:q}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",L);if(q){console.error("[MiniLeagueChatBeta] Error loading reactions:",q);return}const $={};(O||[]).forEach(V=>{$[V.message_id]||($[V.message_id]={}),$[V.message_id][V.emoji]||($[V.message_id][V.emoji]={count:0,hasUserReacted:!1}),$[V.message_id][V.emoji].count++,V.user_id===r.id&&($[V.message_id][V.emoji].hasUserReacted=!0)});const T={};Object.keys($).forEach(V=>{T[V]=Object.entries($[V]).map(([G,te])=>({emoji:G,count:te.count,hasUserReacted:te.hasUserReacted}))}),N(T)}catch(O){console.error("[MiniLeagueChatBeta] Error in loadReactions:",O)}})()},[n,r?.id]),U.useEffect(()=>{if(n.length===0||!r?.id)return;const L=n.map(O=>O.id);if(L.length===0)return;const H=ae.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:q,error:$}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",L);if($)return;const T={};(q||[]).forEach(G=>{T[G.message_id]||(T[G.message_id]={}),T[G.message_id][G.emoji]||(T[G.message_id][G.emoji]={count:0,hasUserReacted:!1}),T[G.message_id][G.emoji].count++,G.user_id===r.id&&(T[G.message_id][G.emoji].hasUserReacted=!0)});const V={};Object.keys(T).forEach(G=>{V[G]=Object.entries(T[G]).map(([te,oe])=>({emoji:te,count:oe.count,hasUserReacted:oe.hasUserReacted}))}),N(V)}catch(q){console.error("[MiniLeagueChatBeta] Error reloading reactions:",q)}})()}).subscribe();return()=>{ae.removeChannel(H)}},[n,r?.id]);const j=U.useCallback(async(L,H)=>{if(!r?.id)return;const q=(m[L]||[]).find($=>$.emoji===H&&$.hasUserReacted);if(N($=>{const T={...$},V=T[L]||[];if(q){const G=V.map(te=>te.emoji===H?{...te,count:Math.max(0,te.count-1),hasUserReacted:!1}:te).filter(te=>te.count>0||te.emoji!==H);G.length===0?delete T[L]:T[L]=G}else V.find(te=>te.emoji===H)?T[L]=V.map(te=>te.emoji===H?{...te,count:te.count+1,hasUserReacted:!0}:te):T[L]=[...V,{emoji:H,count:1,hasUserReacted:!0}];return T}),q){const{error:$}=await ae.from("league_message_reactions").delete().eq("message_id",L).eq("user_id",r.id).eq("emoji",H);$&&(console.error("[MiniLeagueChatBeta] Error removing reaction:",$),N(T=>{const V={...T},G=V[L]||[];return G.find(oe=>oe.emoji===H)?V[L]=G.map(oe=>oe.emoji===H?{...oe,count:oe.count+1,hasUserReacted:!0}:oe):V[L]=[...G,{emoji:H,count:1,hasUserReacted:!0}],V}))}else{const{error:$}=await ae.from("league_message_reactions").upsert({message_id:L,user_id:r.id,emoji:H});$&&(console.error("[MiniLeagueChatBeta] Error adding reaction:",$),N(T=>{const V={...T},te=(V[L]||[]).map(oe=>oe.emoji===H?{...oe,count:Math.max(0,oe.count-1),hasUserReacted:!1}:oe).filter(oe=>oe.count>0||oe.emoji!==H);return te.length===0?delete V[L]:V[L]=te,V}))}},[r?.id,m]);U.useEffect(()=>{n.length>0&&v([0,150,300])},[n.length,v]),U.useEffect(()=>{!o&&M.current&&(M.current.style.height="auto",M.current.style.height="42px")},[o]);const k=U.useCallback((L,H=[0,100,300,500,700])=>{const O=y.current?.offsetHeight||72;if(L>0){const q=L+O;b(L),D.current&&(D.current.style.paddingBottom=`${q+8}px`)}else b(0),D.current&&(D.current.style.paddingBottom=`${O+8}px`);v(H)},[v]);U.useEffect(()=>{const L=window.visualViewport;let H=null,O=0,q=!1;const $=()=>{if(L){const oe=window.innerHeight,ce=L.height,de=L.offsetTop+ce;return Math.max(0,oe-de)}else return 0},T=()=>{H&&(clearTimeout(H),H=null),H=setTimeout(()=>{const oe=$();Math.abs(oe-O)<10&&oe>0&&!q||(O=oe,k(oe))},50)};L&&(L.addEventListener("resize",T),L.addEventListener("scroll",T)),window.addEventListener("resize",T);const V=()=>{q=!0,setTimeout(T,50),setTimeout(T,150),setTimeout(T,300),setTimeout(T,500)},G=()=>{q=!1,setTimeout(T,100)},te=setTimeout(()=>{M.current&&(M.current.addEventListener("focus",V),M.current.addEventListener("blur",G))},100);return T(),()=>{H&&clearTimeout(H),clearTimeout(te),L&&(L.removeEventListener("resize",T),L.removeEventListener("scroll",T)),window.removeEventListener("resize",T),M.current&&(M.current.removeEventListener("focus",V),M.current.removeEventListener("blur",G))}},[k]),U.useEffect(()=>{if(typeof window>"u")return;const L=()=>{const H=window.visualViewport;let O=0;if(H){const q=window.innerHeight,$=H.height,T=H.offsetTop+$;O=Math.max(0,q-T)}k(O)};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[k]),U.useEffect(()=>{if(D.current&&y.current){const L=y.current.offsetHeight||72;D.current.style.paddingBottom=`${L+8}px`}},[]);const E=()=>{M.current&&M.current.removeAttribute("readonly");const L=()=>{const H=window.visualViewport;let O=0;if(H){const q=window.innerHeight,$=H.height,T=H.offsetTop+$;O=Math.max(0,q-T)}k(O,[0,100,200,400,600,800])};setTimeout(L,50),setTimeout(L,150),setTimeout(L,300),setTimeout(L,500),v([100,200,400,600])},_=L=>{const H=L.target;!(H.tagName==="A"||H.tagName==="BUTTON"||H.closest("a, button"))&&M.current&&document.activeElement===M.current&&M.current.blur()},A=U.useMemo(()=>{if(!r)return"";const L=r.user_metadata??{};return L.display_name||L.full_name||r.email||""},[r]),p=U.useMemo(()=>{if(!n.length)return[];if(!(f instanceof Map?f.size>0:f?Object.keys(f).length>0:!1))return console.warn('[chatGroups] memberNames not available yet, returning empty array to prevent "Unknown" authors'),[];if(console.log("[chatGroups] Computing with memberNames:",f instanceof Map?`Map(${f.size})`:f?`Record(${Object.keys(f).length})`:"null/undefined"),f instanceof Map){const V=Array.from(f.keys());console.log("[chatGroups] memberNames keys:",V),V.forEach(G=>{const te=f.get(G);console.log(`[chatGroups] memberNames[${G}] = "${te}"`)})}let H=null;const O=n.reduce((V,G)=>{const te=G.user_id===r?.id,oe=bt(G.user_id,f),ce=oe||(te?A:""),de=ce||(te?"You":"Unknown");if(n.indexOf(G)<5){const be=f instanceof Map?f.has(G.user_id):f?G.user_id in f:!1,Le=f instanceof Map?f.get(G.user_id):f?f[G.user_id]:void 0;console.log(`[chatGroups] Message ${n.indexOf(G)}: user_id=${G.user_id}, hasKey=${be}, mapValue="${Le}", resolvedName="${oe}", fallbackName="${de}"`)}if(!oe&&!te&&f){const be=f instanceof Map?f.has(G.user_id):G.user_id in f;console.warn("[chatGroups] Could not resolve name for user_id:",G.user_id,"memberNames has this key?",be,"resolvedName:",oe,"authorName:",ce,"fallbackName:",de)}const me=te?void 0:Fr(de),Fe=new Date(G.created_at).toDateString(),ve=Fe!==H;ve&&(H=Fe),G.reply_to&&console.log("[chatGroups] Message",G.id,"has reply_to:",{id:G.reply_to.id,content:G.reply_to.content,user_id:G.reply_to.user_id,author_name:G.reply_to.author_name,full_reply_to:G.reply_to});const ye=G.reply_to?bt(G.reply_to.user_id,f)||"Unknown":null;if(G.reply_to&&ye==="Unknown"){const be=f instanceof Map?f.size>0:f?Object.keys(f).length>0:!1,Le=f instanceof Map?f.has(G.reply_to.user_id):f?G.reply_to.user_id in f:!1;if(console.warn('[chatGroups] Reply author is "Unknown" for message',G.id,"reply_to.user_id:",G.reply_to.user_id,"hasMemberNames:",be,"hasKey:",Le,"reply_to object:",G.reply_to),Le&&f){const Se=bt(G.reply_to.user_id,f);console.warn("[chatGroups] Resolved name should be:",Se,'but got "Unknown"')}}const je={id:G.id,text:G.content,time:ys(G.created_at),status:G.status&&G.status!=="sent"?G.status:void 0,messageId:G.id,replyTo:G.reply_to?{id:G.reply_to.id,content:G.reply_to.content,authorName:ye||void 0}:null},ue=V[V.length-1],Ce=ue?.messages.length>0&&ue.messages[0].messageId?n.find(be=>be.id===ue.messages[0].messageId)?.user_id:null;if(ue&&!ve&&ue.isOwnMessage===te&&Ce===G.user_id){const be=ue.id.includes("-")?ue.id.split("-")[0]:ue.id,Le=ue.messages.map(pe=>{const Ue=pe.messageId?n.find(qe=>qe.id===pe.messageId):null;if(Ue?.reply_to){const qe=bt(Ue.reply_to.user_id,f)||"Unknown";return{...pe,replyTo:pe.replyTo?{...pe.replyTo,authorName:qe}:null}}return pe}),Se={...ue,id:`${be}-${de}`,author:de,avatarInitials:me,userId:G.user_id,messages:[...Le,je]};return[...V.slice(0,-1),Se]}else return[...V,{id:`${G.id}-${de}`,author:de,avatarInitials:me,isOwnMessage:te,userId:G.user_id,dayLabel:ve?_s(G.created_at):void 0,messages:[je]}]},[]),q=O.map((V,G)=>{const te={...V},oe=te.messages.map(ce=>{const de=ce.messageId?n.find(me=>me.id===ce.messageId):null;if(de?.reply_to&&ce.replyTo){const me=bt(de.reply_to.user_id,f)||"Unknown";if(me!==ce.replyTo.authorName)return console.log("[chatGroups] POST-PROCESSING: Updating replyTo.authorName for message",ce.messageId,"from",ce.replyTo.authorName,"to",me),{...ce,replyTo:{...ce.replyTo,authorName:me}}}return ce});if(te.author==="Unknown"&&te.messages.length>0&&te.messages[0].messageId){const ce=n.find(de=>de.id===te.messages[0].messageId);if(ce){const de=bt(ce.user_id,f);if(de&&de!=="Unknown"){console.log('[chatGroups] POST-PROCESSING: Resolving "Unknown" to:',de,"for user_id:",ce.user_id,"group.id:",te.id,"group index:",G);const me=te.id.includes("-")?te.id.split("-")[0]:te.id;return{...te,id:`${me}-${de}`,author:de,avatarInitials:Fr(de),userId:ce.user_id,messages:oe}}else console.log('[chatGroups] POST-PROCESSING: Could not resolve "Unknown" for group',G,"user_id:",ce.user_id,"resolvedName:",de)}else console.log("[chatGroups] POST-PROCESSING: Could not find first message for group",G,"messageId:",te.messages[0]?.messageId)}else te.author==="Unknown"&&console.log("[chatGroups] POST-PROCESSING: Group",G,'has "Unknown" author but no messages');return{...te,messages:oe}}),$=q.filter(V=>V.author!=="Unknown"&&O.find(G=>{const te=G.id.includes("-")?G.id.split("-")[0]:G.id,oe=V.id.includes("-")?V.id.split("-")[0]:V.id;return te===oe&&G.author==="Unknown"})).length;$>0&&console.log("[chatGroups] Resolved",$,'groups from "Unknown" to actual names');const T=q.filter(V=>V.author==="Unknown").length;return T>0?(console.warn("[chatGroups] FINAL GROUPS: Found",T,'groups with "Unknown" author out of',q.length,"total groups"),q.forEach((V,G)=>{V.author==="Unknown"&&console.warn(`[chatGroups] Group ${G}: id="${V.id}", author="${V.author}", messages=${V.messages.length}, firstMessageId=${V.messages[0]?.messageId}`)})):console.log("[chatGroups] FINAL GROUPS: All",q.length,"groups have resolved author names"),q},[A,f,n,r?.id,I]);U.useEffect(()=>{(f instanceof Map?f.size>0:f?Object.keys(f).length>0:!1)&&I===0&&(console.log("[MiniLeagueChatBeta] memberNames loaded, incrementing version to force re-render"),F(1))},[f,I]),U.useEffect(()=>{const L=f instanceof Map?f.size>0:f?Object.keys(f).length>0:!1,H=p.some(O=>O.author==="Unknown");L&&H&&p.length>0&&(console.warn('[MiniLeagueChatBeta] DETECTED: memberNames available but groups have "Unknown" authors - forcing re-render'),setTimeout(()=>{F(O=>{const q=O+1;return console.warn("[MiniLeagueChatBeta] Incrementing memberNamesVersion to",q),q})},50),setTimeout(()=>{F(O=>{const q=O+1;return console.warn("[MiniLeagueChatBeta] Second increment of memberNamesVersion to",q),q})},200))},[p,f]),U.useEffect(()=>{const L=p.filter(H=>H.author==="Unknown");L.length>0?(console.error("[MiniLeagueChatBeta] chatGroups changed:",L.length,'groups with "Unknown" author out of',p.length,"total groups"),L.forEach((O,q)=>{console.error(`[MiniLeagueChatBeta] Group ${q}: id="${O.id}", author="${O.author}", messages=${O.messages.length}, firstMessageId=${O.messages[0]?.id}`)}),(f instanceof Map?f.size>0:f&&Object.keys(f).length>0)&&console.error('[MiniLeagueChatBeta] ERROR: memberNames is available but groups still have "Unknown" authors! This should not happen!')):console.log("[MiniLeagueChatBeta] chatGroups changed: All",p.length,"groups have resolved author names"),p.slice(0,5).forEach((H,O)=>{console.log(`[MiniLeagueChatBeta] Group ${O}: id="${H.id}", author="${H.author}", messages=${H.messages.length}`)})},[p,f]);const x=U.useMemo(()=>{const L=p.map(O=>O.author).join(","),H=p.some(O=>O.author==="Unknown");return`chat-${p.length}-${H?"unknown":"resolved"}-${I}-${L.slice(0,50)}`},[p,I]),W=U.useCallback(async L=>{if(!u||!r?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const O=r.user_metadata?.display_name||r.user_metadata?.full_name||r.email||"User";try{await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:u,senderId:r.id,senderName:O,content:L})})}catch(q){console.error("[MiniLeagueChatBeta] notifyLeagueMessageV2 failed:",q)}},[u,r?.id]),z=U.useCallback(async()=>{const L=o.trim();if(!(!u||!L||a))try{h(!0),l(""),M.current&&(M.current.style.height="auto",M.current.style.height="42px"),await g(L,R?.id||null),await W(L),S(null),v([0,150,300])}catch(H){console.error("[MiniLeagueChatBeta] Failed to send message",H),l(L)}finally{h(!1)}},[o,u,W,v,g,a,R]);return s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[s.jsxs("div",{ref:D,className:"flex-1 overflow-y-auto px-4 py-5",onClick:_,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%"},children:[i&&u&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:w,disabled:e,children:e?"Loading earlier":"Load earlier messages"}),p.length===0&&!t?s.jsx("div",{className:"text-center text-sm text-slate-500 mt-8",children:"Say hi to kick off this chat!"}):s.jsx(vs,{groups:p,reactions:m,onReactionClick:j,onMessageClick:(L,H,O)=>{const q=n.find($=>$.id===L);if(q){let $="";if(typeof H=="string")$=H;else if(typeof H=="object"&&H!==null){const T=H?.props?.children||String(H);$=typeof T=="string"?T:String(T)}else $=String(H);S({id:L,content:$||q.content,authorName:O}),setTimeout(()=>{M.current?.focus()},100)}}},x)]}),s.jsxs("div",{ref:y,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:P>0?"fixed":"relative",bottom:P>0?`${P}px`:"0",left:P>0?0:"auto",right:P>0?0:"auto",width:"100%",maxWidth:P>0?"440px":"100%",marginLeft:P>0?"auto":void 0,marginRight:P>0?"auto":void 0,zIndex:P>0?100:"auto",boxShadow:P>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[R&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",R.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:R.content})]}),s.jsx("button",{onClick:()=>S(null),className:"flex-shrink-0 w-5 h-5 rounded-full hover:bg-slate-200 flex items-center justify-center text-slate-500 transition-colors",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:M,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:o,disabled:!u||a,placeholder:u?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",onKeyDown:L=>{if(L.key==="Escape"&&R){S(null),L.preventDefault();return}L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),z())},onChange:L=>{l(L.target.value),M.current&&(M.current.style.height="auto",M.current.style.height=`${Math.min(M.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const H=window.visualViewport;if(H){const O=window.innerHeight,q=H.height,$=H.offsetTop+q,T=O-$;k(T,[0,100])}})},onFocus:E,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:z,disabled:!u||a||!o.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),c&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[c,"  try again or switch to the classic chat tab."]})]})]})}function ks({winnerName:u,isDraw:f}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:f?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[u," Wins!"]})})})}function Cs({availableGws:u,selectedGw:f,onChange:r,className:n=""}){return u.length<=1?null:s.jsx("div",{className:`flex-1 ${n}`,children:s.jsx("select",{value:f||void 0,onChange:t=>{const e=parseInt(t.target.value,10);r(e)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:u.map(t=>s.jsxs("option",{value:t,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",t]},t))})})}function Ss({showForm:u,onToggle:f}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>f(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${u?"text-slate-600 hover:text-slate-900 hover:bg-white/50":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>f(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${u?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"Form"})]})}function Ns({form:u}){const f=u.slice(-5),r=5-f.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:r}).map((n,t)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${t}`)),f.map((n,t)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${n==="W"?"bg-green-100 text-green-700":n==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n},t))]})}function Es({rows:u,members:f,showForm:r,currentUserId:n,loading:t,isLateStartingLeague:e}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),r?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:e?"CP":"OCP"}),f.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[u.map((i,c)=>{const w=i.user_id===n,g=c===u.length-1;return s.jsxs("tr",{className:w?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...g?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:i.name}),r?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(Ns,{form:i.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.ocp}),f.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:i.mltPts})]})]},i.user_id)}),t&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:f.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!t&&!u.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:f.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function As({rows:u,members:f,currentUserId:r,positionChangeKeys:n,isApiTestLeague:t,hasLiveFixtures:e,hasStartingSoonFixtures:i,hasStartedFixtures:c,allFixturesFinished:w,resGw:g}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",t&&e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),t&&!w&&i&&!e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),f.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[u.map((o,l)=>{const a=o.user_id===r,h=l===u.length-1,m=n.has(o.user_id);return s.jsxs("tr",{className:`${a?"flash-user-row":""} ${m?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...h?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:l+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[t&&e&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),t&&!e&&i&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold ${t&&e?"pulse-live-score":""}`,style:{width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:o.score}),f.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums ${t&&e?"pulse-live-score":""}`,style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:o.unicorns})]},o.user_id)}),!u.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:f.length>=3?4:3,style:{backgroundColor:"#f8fafc"},children:["No results recorded for GW ",g," yet."]})})]})]})})]})}function Rs(u){const f=kn(),r=encodeURIComponent(u);if(f){const n=`whatsapp://send?text=${r}`;let t=!1,e=!1;try{const i=document.createElement("a");i.href=n,i.style.display="none",document.body.appendChild(i),i.click(),t=!0,setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},100)}catch{}if(!t)try{window.open(n),e=!0}catch{}if(!t&&!e)try{window.location.href=n}catch{window.open(`https://wa.me/?text=${r}`,"_blank")}}else{const n=`https://wa.me/?text=${r}`;try{window.open(n,"_blank")}catch{navigator.clipboard.writeText(u).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+u)})}}}function Ls(u,f){const r=new Date(f.find(l=>l.gw===u)?.kickoff_time||""),n=new Date(r.getTime()-4500*1e3),t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],e=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],i=t[n.getUTCDay()],c=n.getUTCDate(),w=e[n.getUTCMonth()],g=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${u} Predictions Reminder!

DEADLINE: THIS ${i} ${c} ${w}, ${g}:${o} BST

Don't forget!
playtotl.com`}function Ms(u,f){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",u);try{const r=Ls(u,f);console.log("[SubmissionStatusTable] Generated message:",r),Rs(r)}catch(r){console.error("[SubmissionStatusTable] Error in handleShareReminder:",r),alert("Error sharing reminder. Please try again.")}}function zr({members:u,submittedMap:f,picksGw:r,allSubmitted:n,remaining:t,fixtures:e,onShareReminder:i,variant:c="full"}){const w=i||(()=>Ms(r,e)),g=e.map(m=>m.kickoff_time).filter(m=>!!m).map(m=>new Date(m)).filter(m=>!isNaN(m.getTime())),o=g.length>0?new Date(Math.min(...g.map(m=>m.getTime()))):null,l=o?new Date(o.getTime()-4500*1e3):null,a=l?new Date>=l:!1;let h="";if(l){const m=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],R=m[l.getUTCDay()],S=l.getUTCDate(),I=N[l.getUTCMonth()],F=l.getUTCHours().toString().padStart(2,"0"),D=l.getUTCMinutes().toString().padStart(2,"0");h=`${R} ${S} ${I}, ${F}:${D} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",u.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),w()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${a?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),a?"Deadline Passed: ":"Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:u.slice().sort((m,N)=>m.name.localeCompare(N.name)).map(m=>{const N=`${m.id}:${r}`,R=!!f.get(N);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:m.name}),s.jsx("td",{className:"px-4 py-3",children:R?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},m.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:n?s.jsxs(s.Fragment,{children:["All ",u.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",u.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),w()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-sm ${a?"text-orange-600 font-semibold":"text-slate-600"}`,children:[a?" Deadline Passed: ":" Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:u.slice().sort((m,N)=>m.name.localeCompare(N.name)).map(m=>{const N=`${m.id}:${r}`,R=!!f.get(N);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:m.name}),s.jsx("td",{className:"px-4 py-3",children:R?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},m.id)})})]})})]})}function $r({letter:u,correct:f,unicorn:r,hasSubmitted:n,isLive:t,isOngoing:e,isFinished:i}){let c;return f===!0?t||e?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":i?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":n?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:r?"Correct!":void 0,children:u})}function Ts(u,f){return u==="FINISHED"?"FT":u==="PAUSED"?"HT":u==="IN_PLAY"?f==null?"LIVE":`${f}'`:"LIVE"}function Ds(u){const f=(u||"?").trim().split(/\s+/);return f.length?f.length===1?f[0].slice(0,1).toUpperCase():(f[0][0]+f[f.length-1][0]).toUpperCase():"?"}function Us({fixture:u,picks:f,members:r,outcome:n,liveScore:t,submittedMap:e,picksGw:i,isApiTestLeague:c=!1}){const w=u.home_code||u.home_team||u.home_name||"",g=u.away_code||u.away_team||u.away_name||"",o=vr(w)||u.home_name||u.home_team||"Home",l=vr(g)||u.away_name||u.away_team||"Away",h=(D=>{if(!D)return"";const M=new Date(D);if(isNaN(M.getTime()))return"";const y=String(M.getUTCHours()).padStart(2,"0"),P=String(M.getUTCMinutes()).padStart(2,"0");return`${y}:${P}`})(u.kickoff_time),m=!!(t&&t.status==="IN_PLAY"),N=!!(t&&(t.status==="PAUSED"||t.status==="HALF_TIME"||t.status==="HT")),R=!!(t&&t.status==="FINISHED"),S=m||N;let I=null;c&&t?t.homeScore>t.awayScore?I="H":t.awayScore>t.homeScore?I="A":t.homeScore===t.awayScore&&(I="D"):I=n;const F=D=>{const M=f.filter(d=>d.pick===D),y=f.length===r.length&&M.length===r.length,P=4,b=[];for(let d=0;d<M.length;d+=P){const v=M.slice(d,d+P);b.push(v)}return s.jsx("div",{className:"flex flex-col gap-1",children:b.map((d,v)=>s.jsx("div",{className:"flex items-center justify-center",children:d.map((j,k)=>{const E=r.find(x=>x.id===j.user_id),_=Ds(E?.name??"?"),A=e.has(`${j.user_id}:${i}`),p=I&&I===D?!0:null;return y?s.jsx("span",{className:"inline-block",style:{marginLeft:k>0?"-8px":"0",position:"relative",zIndex:k},children:s.jsx($r,{letter:_,correct:p,unicorn:p===!0,hasSubmitted:A,isLive:m,isOngoing:S,isFinished:R})},j.user_id):s.jsx($r,{letter:_,correct:p,unicorn:p===!0,hasSubmitted:A,isLive:m,isOngoing:S,isFinished:R},j.user_id)})},v))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(m||N)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),R&&!m&&!N&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${S?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(yr,{code:u.home_code||void 0,crest:u.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:t&&(m||N||R)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[t.homeScore," - ",t.awayScore]}):s.jsx("span",{children:h})}),s.jsx(yr,{code:u.away_code||void 0,crest:u.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:l})})]}),t&&(S||R)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${S?"text-red-600":"text-slate-500"}`,children:Ts(t.status,t.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("A")})})]})]})})}function Or({label:u,fixtures:f,picksByFixture:r,members:n,outcomes:t,liveScores:e,submittedMap:i,picksGw:c,isApiTestLeague:w=!1,isFirstSection:g=!1,hasLiveGames:o=!1,allGamesFinished:l=!1,allSubmitted:a=!1,resultsPublished:h=!1,deadlinePassed:m=!1,whoDidntSubmit:N=[],liveFixturesCount:R,hasStarted:S=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(Cn,{date:u,className:"text-lg font-normal"}),g&&s.jsxs(s.Fragment,{children:[w&&o&&R!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:R}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:f.length})]})]}),w&&l&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),w&&!S&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&a&&h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!w&&a&&!h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&m&&!a&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",N.length>0&&`(${N.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[f.map(I=>{try{const F=r.get(I.fixture_index)??[],D=t.get(I.fixture_index)||null,M=e[I.fixture_index]||null;return s.jsx(Us,{fixture:I,picks:F,members:n,outcome:D,liveScore:M,submittedMap:i,picksGw:c,isApiTestLeague:w},`${I.gw}-${I.fixture_index}`)}catch(F){return console.error("Error rendering fixture:",F,I),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",I.fixture_index]},`${I.gw}-${I.fixture_index}`)}}),!f.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const Pt=8;function or(u){return u.result==="H"||u.result==="D"||u.result==="A"?u.result:typeof u.home_goals=="number"&&typeof u.away_goals=="number"?u.home_goals>u.away_goals?"H":u.home_goals<u.away_goals?"A":"D":null}function Ps({chat:u,userId:f,nameById:r,isMember:n,newMsg:t,setNewMsg:e,onSend:i,leagueCode:c,memberCount:w,maxMembers:g,notificationStatus:o}){const l=U.useRef(null),a=U.useRef(null),h=U.useRef(null),m=U.useRef(null),[N,R]=U.useState(0),[S,I]=U.useState({}),F=()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},D=U.useCallback((d=[0,100,300,500,700])=>{requestAnimationFrame(()=>{d.forEach(v=>{setTimeout(()=>F(),v)})})},[]),M=U.useCallback((d,v=[0,100,300,500,700])=>{const j=m.current?.offsetHeight||72;if(d>0){const k=d+j;R(d),l.current&&(l.current.style.paddingBottom=`${k+8}px`)}else R(0),l.current&&(l.current.style.paddingBottom=`${j+8}px`);D(v)},[D]);U.useEffect(()=>{if(u.length===0||!f)return;const d=u.map(j=>j.id);if(d.length===0)return;(async()=>{try{const{data:j,error:k}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",d);if(k){console.error("[ChatTab] Error loading reactions:",k);return}const E={};(j||[]).forEach(A=>{E[A.message_id]||(E[A.message_id]={}),E[A.message_id][A.emoji]||(E[A.message_id][A.emoji]={count:0,hasUserReacted:!1}),E[A.message_id][A.emoji].count++,A.user_id===f&&(E[A.message_id][A.emoji].hasUserReacted=!0)});const _={};Object.keys(E).forEach(A=>{_[A]=Object.entries(E[A]).map(([p,x])=>({emoji:p,count:x.count,hasUserReacted:x.hasUserReacted}))}),I(_)}catch(j){console.error("[ChatTab] Error in loadReactions:",j)}})()},[u,f]),U.useEffect(()=>{if(u.length===0||!f)return;const d=u.map(j=>j.id);if(d.length===0)return;const v=ae.channel("message-reactions").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:k,error:E}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",d);if(E)return;const _={};(k||[]).forEach(p=>{_[p.message_id]||(_[p.message_id]={}),_[p.message_id][p.emoji]||(_[p.message_id][p.emoji]={count:0,hasUserReacted:!1}),_[p.message_id][p.emoji].count++,p.user_id===f&&(_[p.message_id][p.emoji].hasUserReacted=!0)});const A={};Object.keys(_).forEach(p=>{A[p]=Object.entries(_[p]).map(([x,W])=>({emoji:x,count:W.count,hasUserReacted:W.hasUserReacted}))}),I(A)}catch(k){console.error("[ChatTab] Error reloading reactions:",k)}})()}).subscribe();return()=>{ae.removeChannel(v)}},[u,f]);const y=U.useCallback(async(d,v)=>{if(!f)return;if((S[d]||[]).find(E=>E.emoji===v&&E.hasUserReacted)){const{error:E}=await ae.from("league_message_reactions").delete().eq("message_id",d).eq("user_id",f).eq("emoji",v);E&&console.error("[ChatTab] Error removing reaction:",E)}else{const{error:E}=await ae.from("league_message_reactions").upsert({message_id:d,user_id:f,emoji:v});E&&console.error("[ChatTab] Error adding reaction:",E)}},[f,S]);U.useEffect(()=>{u.length>0&&setTimeout(()=>F(),100)},[u.length]),U.useEffect(()=>{!t&&h.current&&(h.current.style.height="auto",h.current.style.height="42px")},[t]),U.useEffect(()=>{if(l.current&&m.current){const d=m.current.offsetHeight||72;l.current.style.paddingBottom=`${d+8}px`}},[]),U.useEffect(()=>{const d=window.visualViewport;let v=null,j=0,k=!1;const E=()=>{if(d){const W=window.innerHeight,z=d.height,L=d.offsetTop+z;return Math.max(0,W-L)}else return 0},_=()=>{v&&(clearTimeout(v),v=null),v=setTimeout(()=>{const W=E();Math.abs(W-j)<10&&W>0&&!k||(j=W,M(W))},50)};d&&(d.addEventListener("resize",_),d.addEventListener("scroll",_)),window.addEventListener("resize",_);const A=()=>{k=!0,setTimeout(_,50),setTimeout(_,150),setTimeout(_,300),setTimeout(_,500)},p=()=>{k=!1,setTimeout(_,100)},x=setTimeout(()=>{h.current&&(h.current.addEventListener("focus",A),h.current.addEventListener("blur",p))},100);return _(),()=>{v&&clearTimeout(v),clearTimeout(x),d&&(d.removeEventListener("resize",_),d.removeEventListener("scroll",_)),window.removeEventListener("resize",_),h.current&&(h.current.removeEventListener("focus",A),h.current.removeEventListener("blur",p))}},[M]);const P=()=>{h.current&&h.current.removeAttribute("readonly");const d=()=>{const v=window.visualViewport;let j=0;if(v){const k=window.innerHeight,E=v.height,_=v.offsetTop+E;j=Math.max(0,k-_)}M(j,[0,100,200,400,600,800])};setTimeout(d,50),setTimeout(d,150),setTimeout(d,300),setTimeout(d,500),D([100,200,400,600])};U.useEffect(()=>{if(typeof window>"u")return;const d=()=>{const v=window.visualViewport;let j=0;if(v){const k=window.innerHeight,E=v.height,_=v.offsetTop+E;j=Math.max(0,k-_)}M(j)};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[M]);const b=d=>{const v=d.target;!(v.tagName==="A"||v.tagName==="BUTTON"||v.closest("a, button"))&&h.current&&document.activeElement===h.current&&h.current.blur()};return s.jsxs("div",{className:"flex flex-col chat-container",style:{height:"100%",position:"relative"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:"url(/assets/Volley/volley-chat-backgroud.png)",backgroundRepeat:"repeat",backgroundSize:"110%",backgroundPosition:"top left",opacity:.1,pointerEvents:"none",zIndex:0}}),s.jsxs("div",{style:{position:"relative",zIndex:1,flex:1,display:"flex",flexDirection:"column",height:"100%",overflowX:"hidden"},children:[s.jsxs("div",{ref:l,className:"flex-1 overflow-y-auto px-3 pt-3 min-h-0 messages-container",onClick:b,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",cursor:"pointer",backgroundColor:"transparent",overflowX:"hidden",maxWidth:"100%"},children:[u.map((d,v)=>{const j=d.user_id===f,k=r.get(d.user_id)??"Unknown",E=new Date(d.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),_=u[v-1],A=u[v+1],p=_?.user_id===d.user_id,x=A?.user_id===d.user_id,W=!p,z=!x,L=!p&&!x,H=W&&x,O=p&&z,q=!j&&(L||O),$=k.split(/\s+/).map(G=>G[0]).join("").toUpperCase(),T=j?"flex justify-end":"flex items-end gap-2",V=L?"single":H?"top":O?"bottom":"middle";return s.jsxs("div",{className:T,style:{marginTop:W?24:4},children:[!j&&s.jsx("div",{className:"flex-shrink-0 w-10 h-10 flex justify-center self-end",children:q?d.user_id===ir?s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center overflow-hidden",children:s.jsx("img",{src:Br,alt:"Volley",className:"w-10 h-10 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-sm font-semibold text-slate-500",children:$}):s.jsx("div",{className:"w-10 h-10"})}),s.jsx("div",{className:`flex flex-col gap-1 ${j?"items-end":"items-start"}`,children:s.jsx(tn,{author:!j&&W?k:void 0,text:d.content,time:E,isOwnMessage:j,shape:V,messageId:d.id,reactions:S[d.id]||[],onReactionClick:y})})]},d.id)}),s.jsx("div",{ref:a,style:{height:"1px",width:"100%"}})]}),s.jsxs("div",{ref:m,className:"flex-shrink-0 bg-white border-t border-slate-200 px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:N>0?"fixed":"relative",bottom:N>0?`${N}px`:"0",left:N>0?"0":"auto",right:N>0?"0":"auto",width:"100%",zIndex:N>0?100:"auto",boxShadow:N>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",pointerEvents:"auto"},children:[n?s.jsx(s.Fragment,{children:s.jsxs("form",{onSubmit:d=>{d.preventDefault(),i()},className:"flex items-center gap-2 relative",children:[s.jsx("textarea",{ref:h,value:t,onChange:d=>{e(d.target.value),h.current&&(h.current.style.height="auto",h.current.style.height=`${Math.min(h.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const v=window.visualViewport;if(v){const j=window.innerHeight,k=v.height,E=v.offsetTop+k,_=j-E;M(_,[0,100])}})},onFocus:P,onKeyDown:d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),t.trim()&&i())},placeholder:"Start typing...",maxLength:2e3,rows:1,autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",className:"flex-1 rounded-xl border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-transparent resize-none overflow-hidden",style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"submit",className:"flex-shrink-0 w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",disabled:!t.trim(),style:{backgroundColor:t.trim()?"#1C8376":"#94a3b8"},children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})})})]})}):s.jsx("div",{className:"rounded-md border border-amber-200 bg-amber-50 text-amber-800 p-3 text-sm",children:"Join this league to chat with other members."}),o&&s.jsx("div",{className:`w-full rounded px-2 py-1 text-xs mt-2 ${o.type==="success"?"bg-green-50 text-green-700 border border-green-200":o.type==="warning"?"bg-amber-50 text-amber-700 border border-amber-200":"bg-red-50 text-red-700 border border-red-200"}`,children:o.message})]})]})]})}function Fs(){const{code:u=""}=Sn(),[f,r]=Nn(),{user:n}=Hr(),[t]=U.useState(()=>{const C=localStorage.getItem("oldSchoolMode");return C?JSON.parse(C):!1});U.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(t))},[t]),U.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const C=()=>{const Z=document.querySelector(".league-header-fixed");if(Z){const re=Z.style.top||window.getComputedStyle(Z).top;re!=="0px"&&re!=="0"&&(Z.style.top="0",Z.style.transform="translate3d(0, 0, 0)")}},B=()=>{C(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},Y=Z=>{const re=Z.target;re.closest(".league-content-wrapper")||re.closest(".league-header-fixed")||re.closest(".chat-tab-wrapper")||Z.preventDefault()};window.addEventListener("scroll",B,{passive:!0}),document.addEventListener("touchmove",Y,{passive:!1});const K=setInterval(C,100);return C(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",B),document.removeEventListener("touchmove",Y),clearInterval(K)}},[]),U.useEffect(()=>{const C=Y=>{const K=Y.target;(K.tagName==="INPUT"||K.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const Z=document.querySelector(".league-header-fixed");Z&&(Z.style.top="0")},100)},B=()=>{const Y=document.querySelector(".league-header-fixed");Y&&(Y.style.top="0")};return document.addEventListener("focusin",C),window.addEventListener("resize",B),window.addEventListener("orientationchange",B),()=>{document.removeEventListener("focusin",C),window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B)}},[]),U.useEffect(()=>{if(typeof window>"u")return;const C=window.visualViewport;if(!C)return;let B=null;const Y=()=>{const Z=I.current;if(!Z)return;const re=C.offsetTop??0;Z.style.setProperty("transform",`translate3d(0, ${re}px, 0)`,"important")},K=()=>{B&&cancelAnimationFrame(B),B=window.requestAnimationFrame(Y)};return K(),C.addEventListener("resize",K),C.addEventListener("scroll",K),()=>{B&&cancelAnimationFrame(B),C.removeEventListener("resize",K),C.removeEventListener("scroll",K),I.current&&I.current.style.removeProperty("transform")}},[]);const[e,i]=U.useState(null),[c,w]=U.useState(!1),[g,o]=U.useState([]),[l,a]=U.useState(!0),h="chat-beta",[m,N]=U.useState(h),R=U.useRef(!1),S=U.useRef(!1);U.useEffect(()=>{f.get("tab")==="chat"&&(m!=="chat-beta"&&(console.log("[League] Opening chat tab from deep link (tab=chat)"),N("chat-beta")),r({},{replace:!0}))},[f,r,m]);const I=U.useRef(null),[F,D]=U.useState(!1),[M,y]=U.useState(!1),[P,b]=U.useState(!1),[d,v]=U.useState(null),[j,k]=U.useState(null),[E,_]=U.useState(null),[A,p]=U.useState([]),x=U.useRef({}),W=U.useRef(new Map),[z,L]=U.useState(new Set),[H,O]=U.useState(!1),[q,$]=U.useState(!1),[T,V]=U.useState(0),[G,te]=U.useState(!1),[oe,ce]=U.useState(!1),[de,me]=U.useState(!1),[Ge,Fe]=U.useState(!1),[ve,ye]=U.useState(null),[je,ue]=U.useState(!1),[Ce,Re]=U.useState(null),[be,Le]=U.useState({x:0,y:0}),[Se,pe]=U.useState(1),[Ue,qe]=U.useState(null),[Ve,Me]=U.useState(null),[lt,Ie]=U.useState(!1),[Ye,He]=U.useState(!1),[Ze,Je]=U.useState(!1),[et,at]=U.useState(!1),[Wt,gt]=U.useState(!1),[Et,ct]=U.useState(!1),[wt,rt]=U.useState(null),[tt,dt]=U.useState(!1),[ut,_t]=U.useState(!1),[Qe,ft]=U.useState(null),[rn,At]=U.useState([]),[Gt,qt]=U.useState(""),[nn,nt]=U.useState(null),st=U.useMemo(()=>!!n?.id&&g.some(C=>C.id===n.id),[n?.id,g]),dr=U.useMemo(()=>!!n?.id&&!!Qe&&Qe.id===n.id,[n?.id,Qe]),sn=U.useMemo(()=>Qe?.name??"League admin",[Qe]),ur=U.useMemo(()=>{const C=new Map;return g.forEach(B=>C.set(B.id,B.name)),C.set(ir,En),C},[g]),fr=U.useCallback(()=>{if(!e?.code||typeof window>"u"||typeof navigator>"u")return;const C=`Join my mini league "${e.name}" on TotL!`,B=`${window.location.origin}/league/${e.code}`,Y=navigator;if(typeof Y.share=="function"){Y.share({title:`Join ${e.name}`,text:C,url:B}).catch(Z=>{console.warn("[League] Share cancelled",Z)});return}const K=`${C}
${B}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(K).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",e.code)}):window.prompt?.("Share this league code:",e.code)},[e]),on=U.useCallback(async()=>{if(!(!e?.id||!n?.id)){b(!0);try{const{error:C}=await ae.from("league_members").delete().eq("league_id",e.id).eq("user_id",n.id);if(C)throw C;typeof window<"u"&&(window.location.href="/leagues")}catch(C){console.error("[League] Error leaving league:",C),typeof window<"u"&&window.alert?.(C?.message??"Failed to leave league. Please try again.")}finally{b(!1),y(!1)}}},[e?.id,n?.id]),an=U.useCallback(async()=>{if(!(!e?.id||!n?.id)){Je(!0);try{if(g.length>=Pt){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),He(!1);return}const{error:C}=await ae.from("league_members").insert({league_id:e.id,user_id:n.id});if(C)throw C;const B=n.user_metadata?.display_name||n.email||"Someone";try{const Y=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:e.id,userId:n.id,userName:B})}),K=await Y.text();let Z;try{Z=K?JSON.parse(K):{error:"Empty response body"}}catch(re){console.error("[League] Failed to parse notification response. Status:",Y.status,"Text:",K,"Error:",re),Z={error:"Invalid JSON response",status:Y.status,raw:K.substring(0,200)}}Y.ok?console.log("[League] Join notification sent:",JSON.stringify({sent:Z.sent,recipients:Z.recipients,ok:Z.ok,breakdown:Z.breakdown},null,2)):console.error("[League] Notification function returned error:",Y.status,Z)}catch(Y){console.error("[League] Error sending join notification:",Y)}typeof window<"u"&&window.location.reload()}catch(C){console.error("[League] Error joining league:",C),typeof window<"u"&&window.alert?.(C?.message??"Failed to join league.")}finally{Je(!1)}}},[e?.id,n?.id,g.length]),ln=U.useCallback(async()=>{if(!(!wt||!e?.id||!n?.id)){dt(!0);try{const{error:C}=await ae.from("league_members").delete().eq("league_id",e.id).eq("user_id",wt.id);if(C)throw C;typeof window<"u"&&window.location.reload()}catch(C){console.error("[League] Error removing member:",C),typeof window<"u"&&window.alert?.(C?.message??"Failed to remove member.")}finally{dt(!1),gt(!1),rt(null)}}},[e?.id,wt,n?.id]),cn=U.useCallback(async()=>{if(!(!e?.id||!n?.id)){_t(!0);try{const{error:C}=await ae.from("league_members").delete().eq("league_id",e.id);if(C)throw C;const{error:B}=await ae.from("leagues").delete().eq("id",e.id);if(B)throw B;typeof window<"u"&&(window.location.href="/leagues")}catch(C){console.error("[League] Error ending league:",C),typeof window<"u"&&window.alert?.(C?.message??"Failed to end league.")}finally{_t(!1),ct(!1)}}},[e?.id,n?.id]),dn=C=>new Promise((B,Y)=>{const K=new Image;K.addEventListener("load",()=>B(K)),K.addEventListener("error",Z=>Y(Z)),K.src=C}),hr=async(C,B)=>{const Y=await dn(C),K=document.createElement("canvas"),Z=K.getContext("2d");if(!Z)throw new Error("No 2d context");return K.width=B.width,K.height=B.height,Z.drawImage(Y,B.x,B.y,B.width,B.height,0,0,B.width,B.height),new Promise((re,J)=>{K.toBlob(ie=>{if(!ie){J(new Error("Canvas is empty"));return}re(ie)},"image/jpeg",.9)})},un=U.useCallback(C=>{if(!e?.id||!st){ye("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(C.type)){ye("Please upload a PNG, JPG, or WebP image.");return}const Y=20*1024*1024;if(C.size>Y){ye("Please choose an image smaller than 20MB.");return}if(C.size>5*1024*1024&&console.log(`[League] Processing large image (${(C.size/1024/1024).toFixed(1)}MB) - will be optimized automatically`),ye(null),ue(!1),C.size>5*1024*1024)Be(C,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(K=>{const Z=new FileReader;Z.onload=()=>{Re(Z.result)},Z.readAsDataURL(K)}).catch(K=>{console.error("[League] Error pre-compressing image:",K),ye("Failed to process image. Please try a smaller file.")});else{const K=new FileReader;K.onload=()=>{Re(K.result)},K.readAsDataURL(C)}},[st,e?.id]),fn=U.useCallback(async(C,B)=>{if(qe(B),Ce)try{const Y=await hr(Ce,B),K=URL.createObjectURL(Y);Me(K)}catch(Y){console.error("[League] Error creating preview:",Y)}},[Ce]),hn=U.useCallback(async()=>{if(!(!Ce||!Ue||!e?.id||!st)){ye(null),ue(!1),Fe(!0);try{const C=await hr(Ce,Ue),B=new File([C],"badge.jpg",{type:"image/jpeg"}),Y=await Be(B,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(Y.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const K=`${e.id}-${Date.now()}.jpg`,{error:Z}=await ae.storage.from("league-avatars").upload(K,Y,{cacheControl:"3600",upsert:!0,contentType:Y.type});if(Z)throw Z;const{data:re}=ae.storage.from("league-avatars").getPublicUrl(K),J=re?.publicUrl;if(!J)throw new Error("Unable to get public URL for badge.");const{error:ie}=await ae.from("leagues").update({avatar:J}).eq("id",e.id);if(ie)throw ie;i(ge=>ge&&{...ge,avatar:J}),ue(!0),Ve&&URL.revokeObjectURL(Ve),Re(null),Me(null),me(!1),n?.id&&(Tt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:J}})))}catch(C){console.error("[League] Error uploading badge:",C),ye(C?.message??"Failed to upload badge. Please try again.")}finally{Fe(!1)}}},[Ce,Ue,st,e?.id,n?.id]),mn=U.useCallback(async()=>{if(!(!e?.id||!st)){ye(null),ue(!1),Fe(!0);try{const{error:C}=await ae.from("leagues").update({avatar:null}).eq("id",e.id);if(C)throw C;i(B=>B&&{...B,avatar:null}),ue(!0),n?.id&&(Tt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:null}})))}catch(C){console.error("[League] Error removing badge:",C),ye(C?.message??"Failed to remove badge. Please try again.")}finally{Fe(!1)}}},[st,e?.id]),[mr,pn]=U.useState(new Map);U.useEffect(()=>{(async()=>{const C=new Map,{data:B}=await ae.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:Y}=await ae.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),K=new Map;if(B&&B.forEach(Z=>{(!K.has(Z.gw)||Z.kickoff_time&&new Date(Z.kickoff_time)<new Date(K.get(Z.gw)))&&Z.kickoff_time&&K.set(Z.gw,Z.kickoff_time)}),Y&&Y.length>0){const Z=Y.find(re=>re.kickoff_time)?.kickoff_time;if(Z){const re=K.get(1);(!re||new Date(Z)<new Date(re))&&K.set(1,Z)}}K.forEach((Z,re)=>{const J=new Date(Z),ie=new Date(J.getTime()-4500*1e3);C.set(re,ie)}),pn(C)})()},[]),U.useEffect(()=>{const C=B=>{const Y=B.target;H&&!Y.closest(".gw-dropdown-container")&&O(!1)};return H&&document.addEventListener("click",C),()=>document.removeEventListener("click",C)},[H]),U.useEffect(()=>{let C=!0;return(async()=>{const{data:B}=await ae.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!C)return;v(B?.current_gw??null);const{data:Y}=await ae.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!C)return;k(Y&&Y.length?Y[0].gw:null);const{data:K}=await ae.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!C)return;const Z=K?[...new Set(K.map(J=>J.gw))].sort((J,ie)=>ie-J):[],re=B?.current_gw;re&&!Z.includes(re)&&Z.unshift(re),p(Z),Z.length>0&&!E&&_(Z[0])})(),()=>{C=!1}},[T]);const ht=U.useMemo(()=>g.map(C=>C.id),[g]),[Te,pr]=U.useState([]),[jt,Vt]=U.useState([]),[Kt,Yt]=U.useState([]),[Rt,Zt]=U.useState([]),gr=U.useMemo(()=>!Te||Te.length===0?[]:Te.map(C=>C.api_match_id).filter(C=>C!=null),[Te]),Lt=U.useMemo(()=>e?.name==="API Test",[e?.name]),[mt,xr]=U.useState(null);U.useEffect(()=>{if(!Lt){xr(null);return}let C=!0;return(async()=>{const{data:B}=await ae.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let Y=B?.current_test_gw??1;if(Y&&Y!==1){const{data:K}=await ae.from("app_fixtures").select("gw").eq("gw",Y).limit(1).maybeSingle();if(!K){const{data:Z}=await ae.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Z&&(Y=1)}}C&&xr(Y)})(),()=>{C=!1}},[Lt]);const gn=U.useMemo(()=>Lt&&mt!==null?mt:d||E||void 0,[Lt,mt,d,E]),{liveScores:wr}=An(gn,gr.length>0?gr:void 0),We=U.useMemo(()=>{const C={};return!Te||Te.length===0||Te.forEach(B=>{const Y=B.api_match_id;if(Y){const K=wr.get(Y);K&&(C[B.fixture_index]={homeScore:K.home_score??0,awayScore:K.away_score??0,status:K.status||"SCHEDULED",minute:K.minute??null})}}),C},[wr,Te]),[br,kt]=U.useState([]),[xn,Ct]=U.useState(!1);U.useEffect(()=>{let C=!0;return(async()=>{a(!0);const{data:B}=await ae.from("leagues").select("id,name,code,created_at,avatar").eq("code",u).maybeSingle();if(!C)return;if(!B){i(null),o([]),a(!1);return}i(B);const{data:Y}=await ae.from("league_members").select("users(id,name),created_at").eq("league_id",B.id).order("created_at",{ascending:!0}),K=Y?.map(J=>({id:J.users.id,name:J.users.name??"(no name)"}))??[],Z=[...K].sort((J,ie)=>J.name.localeCompare(ie.name));o(Z);const re=K[0];ft(re),n?.id&&!K.some(J=>J.id===n.id)&&He(!0),a(!1)})(),()=>{C=!1}},[u]),U.useEffect(()=>{},[e,m]),U.useEffect(()=>{if(m!=="chat"&&m!=="chat-beta"||!e?.id||!n?.id)return;(async()=>{await ae.from("league_message_reads").upsert({league_id:e.id,user_id:n.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),Tt(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:e.id,userId:n.id}}))})()},[m,e?.id,n?.id]);const wn=U.useCallback(async(C,B=!1)=>{const{data:Y,error:K}=await ae.from("league_messages").select("id, league_id, user_id, content, created_at").eq("league_id",C).order("created_at",{ascending:!1}).limit(500);if(!K&&Y){const re=(Y??[]).reverse();B&&console.log("[Chat] Loaded messages:",re.length,"from database (most recent)"),At(J=>{const ie=new Set(J.map(ne=>ne.id)),ge=re.filter(ne=>!ie.has(ne.id));if(J.length===0)return B&&console.log("[Chat] Initial load, setting",re.length,"messages"),re;const Ae=[...J,...ge].sort((ne,ke)=>new Date(ne.created_at).getTime()-new Date(ke.created_at).getTime()),X=Ae.length>500?Ae.slice(-500):Ae;return B&&console.log("[Chat] Merged messages. Previous:",J.length,"New from DB:",ge.length,"Total:",Ae.length,"After limit:",X.length),X})}else K&&console.error("[Chat] Error loading messages:",K)},[]);U.useEffect(()=>{if(!e?.id)return;let C=!0;const B=async()=>{C&&await wn(e.id,!0)};B();const Y=ae.channel(`league-messages:${e.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${e.id}`},re=>{const J=re.new;console.log("[Chat] Realtime message received:",J.id,J.content.substring(0,50)),At(ie=>{if(ie.some(Ne=>Ne.id===J.id))return console.log("[Chat] Message already exists, skipping"),ie;const ge=[...ie,J];return console.log("[Chat] Added realtime message. Total messages:",ge.length),ge})}).subscribe(),K=()=>{!document.hidden&&e?.id&&C&&(console.log("[Chat] App became visible, refetching messages..."),B())},Z=()=>{e?.id&&C&&(console.log("[Chat] Window gained focus, refetching messages..."),B())};return document.addEventListener("visibilitychange",K),window.addEventListener("focus",Z),()=>{C=!1,ae.removeChannel(Y),document.removeEventListener("visibilitychange",K),window.removeEventListener("focus",Z)}},[e?.id]);const bn=U.useCallback(async()=>{if(!e||!n?.id)return;const C=Gt.trim();if(!C)return;qt("");const{data:B,error:Y}=await ae.from("league_messages").insert({league_id:e.id,user_id:n.id,content:C}).select("id, league_id, user_id, content, created_at").single();if(Y)console.error(Y),alert("Failed to send message.");else if(B){At(J=>[...J,B]);const Z=B.created_at?new Date(B.created_at):new Date,re=new Date(Z.getTime()+1);await ae.from("league_message_reads").upsert({league_id:e.id,user_id:n.id,last_read_at:re.toISOString()},{onConflict:"league_id,user_id"}),Tt(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:e.id,userId:n.id}}))}window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||setTimeout(async()=>{try{const Z=n.user_metadata?.display_name||n.email||"User",re=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:e.id,senderId:n.id,senderName:Z,content:C})}),J=await re.json().catch(()=>({}));console.log("[Chat] Notification response:",J),J.debug&&console.log("[Chat] Notification debug info:",J.debug);try{const ie=JSON.parse(localStorage.getItem("notification_logs")||"[]");ie.push({timestamp:new Date().toISOString(),ok:J.ok,sent:J.sent||0,message:J.message,error:J.error,debug:J.debug,oneSignalErrors:J.oneSignalErrors,fullResponse:J.fullResponse||J.result});const ge=ie.slice(-50);localStorage.setItem("notification_logs",JSON.stringify(ge))}catch{}if(J.ok===!0)if(J.sent&&J.sent>0)nt({message:` Sent to ${J.sent} device${J.sent===1?"":"s"}`,type:"success"});else if(J.message==="No subscribed devices"){const ie=J.debug||{};nt({message:` No subscribed devices (${ie.eligibleRecipients||J.eligibleRecipients||0} eligible, ${ie.playerIdsSent||0} player IDs sent)`,type:"warning"})}else if(J.message==="No devices"){const ie=J.debug||{};nt({message:` No devices (${ie.eligibleRecipients||J.eligibleRecipients||0} eligible, ${ie.subscriptionsInDb||0} in DB)`,type:"warning"})}else if(J.message==="No eligible recipients")nt({message:" All members are currently active",type:"success"});else{const ie=J.debug||{},ge=ie.oneSignalRecipients!==void 0?` (${ie.playerIdsSent||0} player IDs  ${ie.oneSignalRecipients||0} delivered)`:"";nt({message:` ${J.message||"Notification sent"}${ge}`,type:"success"})}else if(J.ok===!1||J.error){const ie=J.oneSignalErrors?` OneSignal: ${JSON.stringify(J.oneSignalErrors)}`:"",ge=J.debug?` (Debug: ${JSON.stringify(J.debug).slice(0,100)}...)`:"";nt({message:` Failed: ${J.error||"Unknown error"}${ie}${ge}`,type:"error"})}else re.ok||nt({message:` Notification error (HTTP ${re.status})`,type:"error"});setTimeout(()=>nt(null),5e3)}catch(Z){console.error("[Chat] Notification exception:",Z),nt({message:" Failed to send notification",type:"error"}),setTimeout(()=>nt(null),5e3)}},100)},[e,n,Gt,qt,At,nt]);U.useEffect(()=>{let C=!0;return(async()=>{const B=e?.name==="API Test";let Y=mt??1;if(B){const{data:Ne}=await ae.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(Y=Ne?.current_test_gw??1,Y&&Y!==1){const{data:Ae}=await ae.from("app_fixtures").select("gw").eq("gw",Y).limit(1).maybeSingle();if(Ae)console.log("[League] Using current_test_gw from meta:",Y);else{const{data:X}=await ae.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();X&&(Y=1,console.log("[League] No fixtures for current_test_gw, falling back to GW T1"))}}else console.log("[League] Using GW T1 or current_test_gw:",Y)}const K=B&&(m==="gw"||m==="gwr");console.log("[League] Data fetch:",{isApiTestLeague:B,tab:m,useTestFixtures:K,leagueName:e?.name,testGwForData:Y,willUseTestTables:K,willUseMainTables:!K});let Z=m==="gwr"?S.current?E:d||E:d;if(B&&(m==="gw"||m==="gwr")&&(Z=Y),console.log("[League] gwForData calculation:",{tab:m,manualGwSelected:S.current,selectedGw:E,currentGw:d,gwForData:Z,isApiTestLeague:B}),m==="gw"&&!B&&ht.length>0){const{data:Ne}=await ae.from("app_gw_submissions").select("gw").in("user_id",ht).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(Ne&&Ne.length>0){const Ae=[...new Set(Ne.map(X=>X.gw))].sort((X,ne)=>(ne||0)-(X||0));for(const X of Ae)if(X){const{data:ne}=await ae.from("app_fixtures").select("gw").eq("gw",X).limit(1);if(ne&&ne.length>0){console.log("[League] Found fixtures for GW",X,"from submissions - using this GW (currentGw was",Z,")"),Z=X;break}}}!Z&&d&&(Z=d,console.log("[League] Using currentGw as fallback:",d))}if(console.log("[League] gwForData:",Z,"memberIds:",ht),!Z&&!K){pr([]),Vt([]),Yt([]),Zt([]);return}let re;if(K){const{data:Ne}=await ae.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",Y).order("fixture_index",{ascending:!0});re=Ne?.map(Ae=>({...Ae,gw:Ae.test_gw}))||null}else{console.log("[League] Fetching from MAIN database table (app_fixtures) for regular league, GW:",Z);const{data:Ne}=await ae.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",Z).order("fixture_index",{ascending:!0});re=Ne||null,console.log("[League] Fetched fixtures from main database:",Ne?.length||0,"fixtures")}if(!C)return;if(pr(re??[]),!ht.length){Vt([]),Yt([]),Zt([]);return}let J=null,ie;if(K){const{data:Ne}=await ae.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",Y).in("user_id",ht);J=Ne?.map(ee=>({...ee,gw:ee.matchday}))||null;const{data:Ae,error:X}=await ae.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",Y).not("submitted_at","is",null).in("user_id",ht);X&&console.error("Error fetching test_api_submissions:",X);const{data:ne}=await ae.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",Y).order("fixture_index",{ascending:!0}),ke=new Set((ne||[]).map(ee=>ee.fixture_index));console.log("[League] Current fixture indices from test_api_fixtures:",Array.from(ke)),console.log("[League] Current fixtures:",ne?.map(ee=>({index:ee.fixture_index,home:ee.home_team,away:ee.away_team})));const Q=[];if(Ae&&J&&ne){const ee=ke.size;console.log("[League] Required fixture count for valid submission:",ee);const xe=(ne||[]).map(se=>se.kickoff_time?new Date(se.kickoff_time):null).filter(se=>se!==null&&!isNaN(se.getTime())),le=xe.length>0?new Date(Math.min(...xe.map(se=>se.getTime()))):null,Ee=new Date("2025-11-18T00:00:00Z");console.log("[League] Submission cutoff date (submissions before this are old):",Ee.toISOString()),console.log("[League] Earliest kickoff:",le?.toISOString()),Ae.forEach(se=>{const _e=(J||[]).filter(De=>De.user_id===se.user_id&&De.matchday===Y),he=_e.filter(De=>ke.has(De.fixture_index)),fe=he.length===ee&&ee>0,we=new Set(he.map(De=>De.fixture_index)),Xe=we.size===ee,pt=se.submitted_at?new Date(se.submitted_at):null,Pe=pt&&pt>=Ee;if(fe&&Xe&&Pe)Q.push(se),console.log("[League]  VALID submission (has picks for ALL current fixtures AND recent submission):",{user_id:se.user_id,submitted_at:se.submitted_at,submissionDate:pt?.toISOString(),cutoffDate:Ee.toISOString(),picksCount:_e.length,picksForCurrentFixtures:he.length,uniqueIndices:we.size,requiredCount:ee});else{const De=[];fe||De.push("missing picks"),Xe||De.push("duplicate/extra picks"),Pe||De.push(`old submission (${pt?.toISOString()} < ${Ee.toISOString()})`),console.log("[League]  INVALID submission:",{user_id:se.user_id,submitted_at:se.submitted_at,submissionDate:pt?.toISOString(),cutoffDate:Ee.toISOString(),picksCount:_e.length,picksForCurrentFixtures:he.length,uniqueIndices:we.size,requiredCount:ee,hasAllRequired:fe,hasExactMatch:Xe,isRecent:Pe,reason:De.join(", ")})}})}ie=Q.map(ee=>({...ee,gw:ee.matchday}))||null,console.log("[League] Test API submissions fetched (filtered to only current fixtures):",ie),console.log("[League] Valid submissions count:",Q.length,"out of",Ae?.length||0,"total")}else{console.log("[League] Fetching from MAIN database tables (picks, gw_submissions) for regular league");const{data:Ne}=await ae.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",Z).in("user_id",ht);J=Ne,console.log("[League] Fetched picks from main database:",Ne?.length||0,"picks");const{data:Ae}=await ae.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",Z).in("user_id",ht);ie=Ae,console.log("[League] Fetched submissions from main database:",Ae?.length||0,"submissions")}if(!C)return;Vt(J??[]),Yt(ie??[]);const{data:ge}=await ae.from("app_gw_results").select("gw,fixture_index,result").eq("gw",K?1:Z||0);C&&Zt(ge??[])})(),()=>{C=!1}},[m,d,j,E,ht]),U.useEffect(()=>{x.current=We},[We]);const $e=U.useMemo(()=>{const C=new Map;return console.log("[League] Building submittedMap from subs:",Kt),Kt.forEach(B=>{if(B.submitted_at){const Y=`${B.user_id}:${B.gw}`;console.log(`[League] Adding submission key: ${Y}`,B),C.set(Y,!0)}else console.log("[League] Skipping submission with null submitted_at:",B)}),console.log("[League] Final submittedMap:",Array.from(C.entries())),C},[Kt]),Mt=U.useCallback(C=>C.map(B=>({user_id:B.id,name:B.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);U.useEffect(()=>{const C=ae.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{V(B=>B+1)}).subscribe();return()=>{ae.removeChannel(C)}},[]),U.useEffect(()=>{let C=!0;return(async()=>{if(!g.length){kt([]);return}if(e?.name==="API Test"){kt(Mt(g)),Ct(!1);return}if(d===null)return;Ct(!0);const{data:B}=await ae.from("app_gw_results").select("gw,fixture_index,result"),Y=B??[],K=new Map;if(Y.forEach(se=>{const _e=or(se);_e&&K.set(`${se.gw}:${se.fixture_index}`,_e)}),K.size===0){kt(Mt(g)),Ct(!1);return}const Z=[...new Set(Array.from(K.keys()).map(se=>parseInt(se.split(":")[0],10)))].sort((se,_e)=>se-_e),re=["Prem Predictions","FC Football","Easy League"],J=["The Bird league"],ie=await Rn(e,d);let ge=Z.filter(se=>se>=ie);if(d!==null&&ge.includes(d)){const{data:se}=await ae.from("app_fixtures").select("fixture_index").eq("gw",d),_e=se?.length??0,he=Array.from(K.keys()).filter(fe=>parseInt(fe.split(":")[0],10)===d).length;_e>0&&he<_e&&(ge=ge.filter(fe=>fe<d))}else d!==null&&(ge=ge.filter(se=>se<d));if(!re.includes(e?.name||"")&&!J.includes(e?.name||"")&&ge.length===0){kt(Mt(g)),Ct(!1);return}const{data:Ne}=await ae.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",g.map(se=>se.id)).in("gw",ge),Ae=Ne??[],X=new Map;ge.forEach(se=>{const _e=new Map;g.forEach(he=>_e.set(he.id,{user_id:he.id,score:0,unicorns:0})),X.set(se,_e)}),ge.forEach(se=>{Array.from(K.entries()).filter(([he])=>parseInt(he.split(":")[0],10)===se).map(([he,fe])=>({idx:parseInt(he.split(":")[1],10),out:fe})).forEach(({idx:he,out:fe})=>{const we=Ae.filter(Pe=>Pe.gw===se&&Pe.fixture_index===he),Xe=we.filter(Pe=>Pe.pick===fe).map(Pe=>Pe.user_id),pt=X.get(se);if(we.forEach(Pe=>{if(Pe.pick===fe){const De=pt.get(Pe.user_id);De.score+=1}}),Xe.length===1&&g.length>=3){const Pe=Xe[0],De=pt.get(Pe);De.unicorns+=1}})});const ne=new Map,ke=new Map,Q=new Map,ee=new Map,xe=new Map,le=new Map;g.forEach(se=>{ne.set(se.id,0),ke.set(se.id,0),Q.set(se.id,0),ee.set(se.id,0),xe.set(se.id,0),le.set(se.id,[])}),ge.forEach(se=>{const _e=Array.from(X.get(se).values());if(_e.forEach(we=>{ke.set(we.user_id,(ke.get(we.user_id)??0)+we.score),Q.set(we.user_id,(Q.get(we.user_id)??0)+we.unicorns)}),_e.sort((we,Xe)=>Xe.score-we.score||Xe.unicorns-we.unicorns),!_e.length)return;const he=_e[0],fe=_e.filter(we=>we.score===he.score&&we.unicorns===he.unicorns);fe.length===1?(ne.set(he.user_id,(ne.get(he.user_id)??0)+3),ee.set(he.user_id,(ee.get(he.user_id)??0)+1),le.get(he.user_id).push("W"),_e.slice(1).forEach(we=>le.get(we.user_id).push("L"))):(fe.forEach(we=>{ne.set(we.user_id,(ne.get(we.user_id)??0)+1),xe.set(we.user_id,(xe.get(we.user_id)??0)+1),le.get(we.user_id).push("D")}),_e.filter(we=>!fe.find(Xe=>Xe.user_id===we.user_id)).forEach(we=>le.get(we.user_id).push("L")))});const Ee=g.map(se=>({user_id:se.id,name:se.name,mltPts:ne.get(se.id)??0,ocp:ke.get(se.id)??0,unicorns:Q.get(se.id)??0,wins:ee.get(se.id)??0,draws:xe.get(se.id)??0,form:le.get(se.id)??[]}));Ee.sort((se,_e)=>_e.mltPts-se.mltPts||_e.unicorns-se.unicorns||_e.ocp-se.ocp||se.name.localeCompare(_e.name)),C&&(kt(Ee),Ct(!1))})(),()=>{C=!1}},[g,e,d,Mt,T]);function vn(){const C=["Prem Predictions","FC Football","Easy League"],B=["The Bird league"],Y=["gregVjofVcarl","Let Down"],K=!!(e&&!C.includes(e.name)&&!B.includes(e.name)&&!Y.includes(e.name)),Z=br.length?br:g.map(re=>({user_id:re.id,name:re.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]}));return g.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>Ie(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg hover:bg-emerald-700 transition-colors",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(Es,{rows:Z,members:g,showForm:F,currentUserId:n?.id,loading:xn,isLateStartingLeague:K}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(Ss,{showForm:F,onToggle:D}),s.jsxs("button",{onClick:()=>te(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function yn(){const C=e?.name==="API Test"?mt??1:d,{state:B}=Ln(C);if(!C)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!Cr(e,C,mr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",C," predictions are not included in this league."]})]})});const Y=new Map;Rt.forEach(Q=>{if(Q.gw!==C)return;const ee=or(Q);ee&&Y.set(Q.fixture_index,ee)}),Te.forEach(Q=>{if(Q.gw!==C)return;const ee=We[Q.fixture_index];ee&&(ee.status==="IN_PLAY"||ee.status==="PAUSED"||ee.status==="FINISHED")&&(ee.homeScore>ee.awayScore?Y.set(Q.fixture_index,"H"):ee.awayScore>ee.homeScore?Y.set(Q.fixture_index,"A"):Y.set(Q.fixture_index,"D"))});const K=U.useMemo(()=>{const Q=le=>{if(!le)return"Fixtures";const Ee=new Date(le);return isNaN(Ee.getTime())?"Fixtures":Ee.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},ee=new Map;Te.filter(le=>le.gw===C).forEach(le=>{const Ee=Q(le.kickoff_time),se=le.kickoff_time?new Date(le.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;ee.has(Ee)||ee.set(Ee,{label:Ee,key:se,items:[]}),ee.get(Ee).items.push(le)});const xe=Array.from(ee.values());return xe.forEach(le=>le.items.sort((Ee,se)=>Ee.fixture_index-se.fixture_index)),xe.sort((le,Ee)=>le.key-Ee.key),xe},[Te,C]),Z=new Set(Te.filter(Q=>Q.gw===C).map(Q=>Q.fixture_index)),re=e?.name==="API Test",J=g.length>0&&g.every(Q=>$e.get(`${Q.id}:${C}`));if(re&&C===(mt??1)){console.log("[League] API Test filtering:",{currentFixtureIndices:Array.from(Z),totalPicks:jt.length,picksForGw:jt.filter(ee=>ee.gw===C).length,submittedMapSize:$e.size,allSubmitted:J,members:g.map(ee=>({id:ee.id,name:ee.name,submitted:$e.get(`${ee.id}:${C}`)})),fixturesCount:Te.filter(ee=>ee.gw===C).length});const Q=jt.filter(ee=>ee.gw===C);console.log(`[League] All picks for GW${C}:`,Q.map(ee=>({user_id:ee.user_id,userName:g.find(xe=>xe.id===ee.user_id)?.name,fixture_index:ee.fixture_index,pick:ee.pick,hasSubmitted:!!$e.get(`${ee.user_id}:${C}`),inCurrentFixtures:Z.has(ee.fixture_index)})))}const ie=new Map;!re||J?jt.forEach(Q=>{if(Q.gw!==C)return;if(!$e.get(`${Q.user_id}:${C}`)){re&&C===1&&console.log("[League] API Test: Filtering out unsubmitted pick:",{user_id:Q.user_id,fixture_index:Q.fixture_index,userName:g.find(le=>le.id===Q.user_id)?.name});return}if(!Z.has(Q.fixture_index)){re&&C===1&&console.log("[League] Filtering out old pick (not in current fixtures):",{fixture_index:Q.fixture_index,currentIndices:Array.from(Z),userName:g.find(le=>le.id===Q.user_id)?.name});return}const xe=ie.get(Q.fixture_index)??[];xe.push(Q),ie.set(Q.fixture_index,xe)}):console.log("[League] API Test: Not all submitted - skipping ALL picks processing. allSubmitted=",J);const ge=j!==null&&j>=C,Ne=g.filter(Q=>!$e.get(`${Q.id}:${C}`)).length,Ae=g.filter(Q=>!$e.get(`${Q.id}:${C}`)).map(Q=>Q.name),X=B!==null&&(B==="DEADLINE_PASSED"||B==="LIVE"||B==="RESULTS_PRE_GW");if(re&&C===1){const Q=g.map(le=>{const Ee=`${le.id}:${C}`,se=$e.get(Ee);return{id:le.id,name:le.name,submitted:!!se,key:Ee}});console.log(`[League] ===== API Test GW${C} SUBMISSION CHECK =====`),console.log("[League] All submitted:",J),console.log("[League] Remaining:",Ne),console.log("[League] Who didn't submit:",Ae),console.log("[League] Member submission status:",Q),console.log("[League] Submitted map entries:",Array.from($e.entries())),console.log("[League] ================================================");const ee=g.find(le=>le.name.toLowerCase().includes("steve")||le.name.toLowerCase().includes("s")),xe=g.find(le=>le.name.toLowerCase().includes("jof")||le.name.toLowerCase().includes("j"));if(ee){const le=`${ee.id}:${C}`;console.log(`[League] STEVE (${ee.name}):`,{id:ee.id,submitted:!!$e.get(le),key:le})}if(xe){const le=`${xe.id}:${C}`;console.log(`[League] JOF (${xe.name}):`,{id:xe.id,submitted:!!$e.get(le),key:le})}}console.log(`GW${C} deadline check:`,{gameState:B,deadlinePassed:X,allSubmitted:J,willShowPredictions:J||X});const ne=re?!J:!J&&!X;return(re?!J:!J&&!X)?(console.log(`[League] Not all submitted, showing ONLY "Who's submitted" view. Blocking all predictions/fixtures.`,{isApiTestLeague:re,allSubmitted:J,deadlinePassed:X,remaining:Ne}),s.jsx(zr,{members:g,submittedMap:$e,picksGw:C,allSubmitted:J,remaining:Ne,fixtures:Te.filter(Q=>Q.gw===C),variant:"compact"})):s.jsxs("div",{className:"mt-2 pt-2",children:[ne?s.jsx(zr,{members:g,submittedMap:$e,picksGw:C,allSubmitted:J,remaining:Ne,fixtures:Te.filter(Q=>Q.gw===C),variant:"full"}):null,e?.name==="API Test"&&J&&K.length>0&&!ne&&(()=>{const Q=K.flatMap(he=>he.items),ee=new Set(Q.map(he=>he.fixture_index)),xe={};Object.keys(We).forEach(he=>{const fe=parseInt(he,10);ee.has(fe)&&(xe[fe]=We[fe])});const le=Q.some(he=>{const fe=xe[he.fixture_index];return fe&&(fe.status==="IN_PLAY"||fe.status==="PAUSED")}),Ee=Q.length>0&&Q.every(he=>{const fe=xe[he.fixture_index];return fe&&fe.status==="FINISHED"}),se=le||Ee||Q.some(he=>xe[he.fixture_index]);let _e=0;return n?.id&&Q.forEach(he=>{const fe=xe[he.fixture_index],we=fe&&(fe.status==="IN_PLAY"||fe.status==="PAUSED"),Xe=fe&&fe.status==="FINISHED";if(fe&&(we||Xe)){const Pe=(ie.get(he.fixture_index)??[]).find(De=>De.user_id===n.id);if(Pe){let De=!1;(Pe.pick==="H"&&fe.homeScore>fe.awayScore||Pe.pick==="A"&&fe.awayScore>fe.homeScore||Pe.pick==="D"&&fe.homeScore===fe.awayScore)&&(De=!0),De&&_e++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:K.map((he,fe)=>s.jsx(Or,{label:he.label,fixtures:he.items,picksByFixture:ie,members:g,outcomes:Y,liveScores:xe,submittedMap:$e,picksGw:C,isApiTestLeague:!0,isFirstSection:fe===0,hasLiveGames:le,allGamesFinished:Ee,hasStarted:se,liveFixturesCount:_e},fe))})})(),K.length>0&&e?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:K.map((Q,ee)=>s.jsx(Or,{label:Q.label,fixtures:Q.items,picksByFixture:ie,members:g,outcomes:Y,liveScores:We,submittedMap:$e,picksGw:C,isApiTestLeague:!1,isFirstSection:ee===0,allSubmitted:J,resultsPublished:ge,deadlinePassed:X,whoDidntSubmit:Ae},ee))}),!K.length&&!ne&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",C,"."]})]})}function _n(){const C=e?.name==="API Test"?mt??1:m==="gwr"?S.current?E:d||E:E;if(!C||A.length===0&&e?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!Cr(e,C,mr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",C," results are not included in this league."]})]})});const B=new Map,Y=e?.name==="API Test",K=Te.filter(X=>X.gw===C),Z=K.some(X=>{const ne=We[X.fixture_index];return ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")});console.log("[League] Live Table calculation:",{resGw:C,currentGw:d,selectedGw:E,hasLiveScores:Z,liveScoresCount:Object.keys(We).length,isApiTestLeague:Y,fixturesCount:Te.length,fixturesForGwCount:K.length,manualGwSelected:S.current}),Y&&C===(mt??1)?K.forEach(X=>{const ne=We[X.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?B.set(X.fixture_index,"H"):ne.awayScore>ne.homeScore?B.set(X.fixture_index,"A"):B.set(X.fixture_index,"D"))}):Z&&C===d?(console.log("[League] Using live scores for regular league GW",C),K.forEach(X=>{const ne=We[X.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?B.set(X.fixture_index,"H"):ne.awayScore>ne.homeScore?B.set(X.fixture_index,"A"):B.set(X.fixture_index,"D"))}),console.log("[League] Outcomes from live scores:",Array.from(B.entries()))):(console.log("[League] Using results table for GW",C,{hasLiveScores:Z,resGwEqualsCurrentGw:C===d,resultsCount:Rt.length,resultsForThisGw:Rt.filter(X=>X.gw===C).length,manualGwSelected:S.current,selectedGw:E}),Rt.forEach(X=>{if(X.gw!==C)return;const ne=or(X);ne&&B.set(X.fixture_index,ne)}),console.log("[League] Outcomes from results:",Array.from(B.entries())));const re=g.filter(X=>$e.get(`${X.id}:${C}`)).map(X=>({user_id:X.id,name:X.name,score:0,unicorns:0})),J=new Map;jt.forEach(X=>{if(X.gw!==C||!$e.get(`${X.user_id}:${C}`))return;const ne=J.get(X.fixture_index)??[];ne.push(X),J.set(X.fixture_index,ne)}),Array.from(B.entries()).forEach(([X,ne])=>{const Q=(J.get(X)??[]).filter(ee=>ee.pick===ne).map(ee=>ee.user_id);if(Q.forEach(ee=>{const xe=re.find(le=>le.user_id===ee);xe.score+=1}),Q.length===1&&g.length>=3){const ee=re.find(xe=>xe.user_id===Q[0]);ee.unicorns+=1}}),re.sort((X,ne)=>ne.score-X.score||ne.unicorns-X.unicorns||X.name.localeCompare(ne.name)),U.useEffect(()=>{if(re.length===0)return;const X=new Map;re.forEach((ke,Q)=>{X.set(ke.user_id,Q)});const ne=new Set;if(X.forEach((ke,Q)=>{const ee=W.current.get(Q);ee!==void 0&&ee!==ke&&ne.add(Q)}),W.current=X,ne.size>0){L(ne);const ke=setTimeout(()=>{L(new Set)},2e3);return()=>clearTimeout(ke)}},[re.map(X=>`${X.user_id}-${X.score}-${X.unicorns}`).join(",")]);let ie=!1,ge=!1,Ne=!1,Ae=!1;if(Y&&C===(mt??1)){const X=Te;if(X.length>0&&(ie=X.every(ke=>{const Q=We[ke.fixture_index];return Q&&Q.status==="FINISHED"}),ge=!!X.find(ke=>{const Q=We[ke.fixture_index];return Q&&(Q.status==="IN_PLAY"||Q.status==="PAUSED")}),Ae=X.some(ke=>{const Q=We[ke.fixture_index];return Q&&(Q.status==="IN_PLAY"||Q.status==="PAUSED"||Q.status==="FINISHED")}),!ie)){const ke=new Date;Ne=X.some(Q=>{if(!Q.kickoff_time)return!1;const xe=new Date(Q.kickoff_time).getTime()-ke.getTime(),le=We[Q.fixture_index];return(!le||le.status!=="IN_PLAY"&&le.status!=="PAUSED"&&le.status!=="FINISHED")&&xe>0&&xe<=1440*60*1e3})}}else{const X=Te.filter(ne=>ne.gw===C);if(X.length>0){const ne=X.every(Q=>B.has(Q.fixture_index)),ke=X.some(Q=>{const ee=We[Q.fixture_index];return ee&&(ee.status==="IN_PLAY"||ee.status==="PAUSED")});ie=ne&&!ke,console.log(`[League] GW ${C} finished check:`,{allHaveResults:ne,hasActiveGames:ke,fixturesCount:X.length,outcomesCount:X.filter(Q=>B.has(Q.fixture_index)).length,allFixturesFinished:ie})}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),re.length>0&&ie&&s.jsx(ks,{winnerName:re[0].name,isDraw:re[0].score===re[1]?.score&&re[0].unicorns===re[1]?.unicorns}),s.jsx(As,{rows:re,members:g,currentUserId:n?.id,positionChangeKeys:z,isApiTestLeague:Y,hasLiveFixtures:ge,hasStartingSoonFixtures:Ne,hasStartedFixtures:Ae,allFixturesFinished:ie,resGw:C}),A.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(Cs,{availableGws:A,selectedGw:C,onChange:X=>{S.current=!0,_(X)}}),s.jsxs("button",{onClick:()=>ce(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(kr,{isOpen:oe,onClose:()=>ce(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return U.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[m]),l?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!e&&!l?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(_r,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):e?s.jsxs("div",{className:`${t?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:I,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(_r,{to:"/leagues",className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{console.log("[League] Badge clicked, opening modal. isMember:",st),w(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative hover:opacity-80 transition-opacity cursor-pointer",children:e?s.jsx("img",{src:Jt(e),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:C=>{const B=C.target;console.error("[League] Badge image failed to load:",B.src,"League:",e);const K=`/assets/league-avatars/${jr(e.id)}`;B.src!==K&&(B.src=K)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:e.name}),E&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",E]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>at(!et),className:"flex items-center justify-center w-8 h-8 rounded-full hover:bg-slate-100 transition-colors -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${et?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[dr&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:sn})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{$(!0),at(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[st&&s.jsxs("button",{onClick:()=>{me(!0),at(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{Ie(!0),at(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{fr(),at(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{y(!0),at(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 hover:bg-red-50 active:bg-red-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${et?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{R.current=!0,N("chat-beta")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="chat-beta"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),m==="chat-beta"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(A.length>0||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{R.current=!0,N("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight flex items-center justify-center gap-1.5 "+(m==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const C=new Date,B=Te[0],Y=B?.kickoff_time?new Date(B.kickoff_time):null,K=Y&&Y<=C,re=Te[Te.length-1]?.fixture_index,ie=(re!==void 0?We[re]:null)?.status==="FINISHED",ge=K&&!ie;return s.jsxs(s.Fragment,{children:[ge&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),m==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(d||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{R.current=!0,N("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),m==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{R.current=!0,N("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",m==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),m==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(Ps,{chat:rn,userId:n?.id,nameById:ur,isMember:st,newMsg:Gt,setNewMsg:qt,onSend:bn,leagueCode:e?.code,memberCount:g.length,maxMembers:Pt,notificationStatus:nn})}):m==="chat-beta"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(js,{miniLeagueId:e?.id??null,memberNames:ur})}):s.jsx("div",{className:`league-content-wrapper ${et?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[m==="mlt"&&s.jsx(vn,{}),m==="gw"&&s.jsx(yn,{}),m==="gwr"&&s.jsx(_n,{})]})}),dr&&q&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>$(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:C=>C.stopPropagation(),children:[s.jsx("button",{onClick:()=>$(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[g.filter(C=>C.id!==n?.id).map(C=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:C.name}),s.jsx("button",{onClick:()=>{rt(C),gt(!0),$(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 hover:bg-red-200 rounded-md transition-colors font-medium",children:"Remove"})]},C.id)),g.filter(C=>C.id!==n?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{ct(!0),$(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),st&&de&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{me(!1),Ve&&URL.revokeObjectURL(Ve),Re(null),ye(null),ue(!1),Me(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:C=>C.stopPropagation(),children:[s.jsx("button",{onClick:()=>{me(!1),Ve&&URL.revokeObjectURL(Ve),Re(null),ye(null),ue(!1),Me(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Ce?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(is,{image:Ce,crop:be,zoom:Se,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Le,onZoomChange:pe,onCropComplete:fn,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(Se*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:Se,onChange:C=>pe(Number(C.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Ve?s.jsx("img",{src:Ve,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),ve&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ve}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{Ve&&URL.revokeObjectURL(Ve),Re(null),Le({x:0,y:0}),pe(1),qe(null),Me(null)},disabled:Ge,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:hn,disabled:Ge||!Ue,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:Ge?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:e?Jt(e):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:C=>{const B=C.target;B.src="/assets/league-avatars/ML-avatar-1.png"}})}),e?.avatar&&s.jsx("button",{onClick:mn,disabled:Ge,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:C=>{const B=C.target.files?.[0];B&&un(B)},disabled:Ge,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] transition-colors touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),Ge&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),je&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),ve&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ve})]})]})]})]})}),s.jsx(kr,{isOpen:G,onClose:()=>te(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${e&&(["The Bird league"].includes(e.name)||["gregVjofVcarl","Let Down"].includes(e.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),lt&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",Pt," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:e.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.code)},className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Copy"}),s.jsx("button",{onClick:fr,className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[g.length,"/",Pt," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>Ie(!1),className:"px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50",children:"Close"})})]})}),M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',e?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>y(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:P,children:"Cancel"}),s.jsx("button",{onClick:on,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:P,children:P?"Leaving...":"Leave League"})]})]})}),Ye&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',e?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>He(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:Ze,children:"Cancel"}),s.jsx("button",{onClick:an,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md hover:bg-emerald-700 transition-colors disabled:opacity-50",disabled:Ze,children:Ze?"Joining...":"Join League"})]})]})}),Wt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',wt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>gt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:tt,children:"Cancel"}),s.jsx("button",{onClick:ln,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:tt,children:tt?"Removing...":"Remove Member"})]})]})}),Et&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',e?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>ct(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:ut,children:"Cancel"}),s.jsx("button",{onClick:cn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:ut,children:ut?"Ending...":"Yes, End League"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),c&&e&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>w(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:C=>C.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:Jt(e),alt:"League badge",className:"w-full h-full object-cover",onError:C=>{const B=C.target,K=`/assets/league-avatars/${jr(e.id)}`;B.src!==K&&(B.src=K)}})}),st&&s.jsx("button",{type:"button",onClick:C=>{C.stopPropagation(),console.log("[League] Edit icon clicked"),w(!1),me(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white hover:bg-slate-50 shadow-2xl flex items-center justify-center transition-all z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:e.name})]})})]}):null}export{Fs as default};
