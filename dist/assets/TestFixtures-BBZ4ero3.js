import{u as z,a as l,s as u,j as t}from"./index-E0RyNq15.js";const O=()=>{const x=typeof window<"u"?window.location.hostname:"",g=typeof window<"u"?window.location.origin:"";return x.includes("netlify.app")||x.includes("netlify.com")?`${g}/.netlify/functions/fetchFootballData`:x==="localhost"||x==="127.0.0.1"?"https://totl-staging.netlify.app/.netlify/functions/fetchFootballData":"/.netlify/functions/fetchFootballData"};function B(){const{user:x}=z(),g=x?.id==="4542c037-5b38-40d0-b189-847b8f17c222"||x?.id==="36f31625-6d6c-4aa4-815a-1493a812841b",[r,L]=l.useState(1),[w,j]=l.useState([]),[m,b]=l.useState(new Map),[N,k]=l.useState(!1),[y,S]=l.useState(!1),[T,h]=l.useState(""),[A,f]=l.useState(""),[C,P]=l.useState("BSA"),[D,c]=l.useState(null),[M,F]=l.useState(!1),G=async(e,s)=>{try{const a=new Date,i=new Date(a);i.setDate(a.getDate()+7);const d=a.toISOString().split("T")[0],n=i.toISOString().split("T")[0],o=new URLSearchParams({competition:e,dateFrom:d,dateTo:n}),_=`${O()}?${o.toString()}`,p=await fetch(_,{signal:s});if(!p.ok)return p.status===429?(c("Rate limit reached. Please wait a moment."),null):(c(`Server error (${p.status})`),null);const v=await p.json();return!v.success||!v.data?(c("Invalid API response format."),null):(c(null),v.data.matches||[])}catch(a){return a instanceof Error&&a.name==="AbortError"||(console.error("Error fetching matches:",a),c("Failed to fetch matches.")),null}};if(l.useEffect(()=>{if(!g)return;let e=!0;return(async()=>{try{const{data:s}=await u.from("test_api_fixtures").select("*").eq("test_gw",r).order("fixture_index",{ascending:!0});if(e&&s&&s.length>0){const a=new Map;s.forEach(i=>{a.set(i.fixture_index,{...i,selected:!0})}),b(a)}}catch{}})(),()=>{e=!1}},[g,r]),!g)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:t.jsx("div",{className:"text-red-600",children:"Access denied. Admin only."})});const E=e=>{const s=new Map(m),a=Array.from(s.values()).find(i=>i.api_match_id===e.id);if(a){s.delete(a.fixture_index);const i=Array.from(s.values()).sort((n,o)=>n.fixture_index-o.fixture_index),d=new Map;i.forEach((n,o)=>{d.set(o,{...n,fixture_index:o})}),b(d)}else{const d=(s.size>0?Math.max(...Array.from(s.keys())):-1)+1,n={test_gw:r,fixture_index:d,api_match_id:e.id,home_team:e.homeTeam.shortName,away_team:e.awayTeam.shortName,home_code:e.homeTeam.tla,away_code:e.awayTeam.tla,home_name:e.homeTeam.name,away_name:e.awayTeam.name,home_crest:e.homeTeam.crest||null,away_crest:e.awayTeam.crest||null,kickoff_time:e.utcDate,selected:!0};s.set(d,n),b(s)}},I=async()=>{if(confirm(`Clear all picks and submissions for Test GW ${r}?`)){F(!0),h(""),f("");try{await u.from("test_api_picks").delete().eq("matchday",r),await u.from("test_api_submissions").delete().eq("matchday",r),f(`All picks and submissions cleared for Test GW ${r}!`)}catch(e){h(e.message??"Failed to clear picks.")}finally{F(!1)}}},U=async()=>{if(m.size===0){h("Please select at least one fixture");return}k(!0),h(""),f("");try{await u.from("test_api_fixtures").delete().eq("test_gw",r),await u.from("test_api_picks").delete().eq("matchday",r),await u.from("test_api_submissions").delete().eq("matchday",r);const e=Array.from(m.values()).map(a=>({test_gw:a.test_gw,fixture_index:a.fixture_index,api_match_id:a.api_match_id,home_team:a.home_team,away_team:a.away_team,home_code:a.home_code,away_code:a.away_code,home_name:a.home_name,away_name:a.away_name,home_crest:a.home_crest,away_crest:a.away_crest,kickoff_time:a.kickoff_time})),{error:s}=await u.from("test_api_fixtures").insert(e);if(s)throw s;await u.from("test_api_meta").upsert({id:1,current_test_gw:r},{onConflict:"id"}),f(`Test Gameweek ${r} saved with ${m.size} fixtures!`)}catch(e){h(e.message??"Failed to save test gameweek.")}finally{k(!1)}};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight text-slate-900 mb-2",children:"Test Fixtures (Non-Premier League)"}),t.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Select fixtures from other competitions for testing. This is separate from the main Premier League game."}),T&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:T}),A&&t.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm",children:A}),D&&t.jsxs("div",{className:"mb-4 p-4 bg-amber-50 border-2 border-amber-400 rounded-lg text-amber-800 text-sm font-medium shadow-md",children:["⚠️ ",D]}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("label",{className:"font-medium text-slate-700",children:"Test Gameweek:"}),t.jsx("select",{value:r,onChange:e=>{const s=parseInt(e.target.value,10);L(s),b(new Map),f(""),h("")},className:"border rounded px-3 py-1 text-lg font-semibold",children:Array.from({length:10},(e,s)=>s+1).map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsx("button",{onClick:I,disabled:M,className:"px-3 py-1.5 text-sm bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors disabled:opacity-50",children:M?"Clearing...":"Clear All Picks"})]})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Upcoming Matches (Next 7 Days)"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Competition:"}),t.jsxs("select",{value:C,onChange:e=>{P(e.target.value),j([]),c(null)},className:"w-full border rounded px-3 py-2",children:[t.jsx("option",{value:"BSA",children:"Brazilian Serie A"}),t.jsx("option",{value:"BL1",children:"Bundesliga"}),t.jsx("option",{value:"SA",children:"Serie A"}),t.jsx("option",{value:"FL1",children:"Ligue 1"}),t.jsx("option",{value:"PD",children:"La Liga"}),t.jsx("option",{value:"CL",children:"Champions League"})]})]}),t.jsx("button",{onClick:()=>{if(y)return;const e=new AbortController;S(!0),c(null),G(C,e.signal).then(s=>{s&&s.length>0?(j(s),c(null)):s&&s.length===0&&c("No upcoming matches found in the next week for this competition.")}).catch(s=>{s instanceof Error&&s.name!=="AbortError"&&c("Failed to fetch matches. Please try again.")}).finally(()=>{S(!1)})},disabled:y,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",children:y?"Loading...":"Load Matches"})]}),w.length>0&&t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:["Available Matches (",w.length,")"]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:w.map(e=>{const s=Array.from(m.values()).some(p=>p.api_match_id===e.id),a=new Date(e.utcDate),i=new Date;i.setHours(0,0,0,0);const d=new Date(i);d.setDate(i.getDate()+1);const n=new Date(a);n.setHours(0,0,0,0);let o="";n.getTime()===i.getTime()?o="TODAY":n.getTime()===d.getTime()?o="TOMORROW":o=a.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"});const $=`${String(a.getUTCHours()).padStart(2,"0")}:${String(a.getUTCMinutes()).padStart(2,"0")} UTC`,_=`${o} ${$}`;return t.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${s?"bg-purple-50 border-purple-300":"bg-slate-50 border-slate-200 hover:bg-slate-100"}`,onClick:()=>E(e),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:s,onChange:()=>E(e),className:"w-5 h-5"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"font-medium text-slate-800",children:[e.homeTeam.shortName," vs ",e.awayTeam.shortName]}),t.jsxs("div",{className:"text-xs text-slate-500",children:[_," • ",e.status," • Matchday ",e.matchday]})]})]})},e.id)})})]}),m.size>0&&t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-800",children:["Selected Fixtures for Test GW ",r," (",m.size,")"]}),t.jsx("button",{onClick:()=>{confirm("Clear all selected fixtures?")&&(b(new Map),f(""),h(""))},className:"px-3 py-1.5 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:"Clear All"})]}),t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Array.from(m.values()).sort((e,s)=>e.fixture_index-s.fixture_index).map(e=>t.jsxs("div",{className:"p-2 bg-purple-50 border border-purple-200 rounded text-sm",children:[e.fixture_index+1,". ",e.home_team," vs ",e.away_team]},e.fixture_index))}),t.jsx("button",{onClick:U,disabled:N,className:"mt-4 w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 font-semibold",children:N?"Saving...":`Save Test Gameweek ${r} (${m.size} fixtures)`})]})]})})}export{B as default};
