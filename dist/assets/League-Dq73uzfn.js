import{r as a,s as Ke,C as lt,a as B,l as Ct,g as le,_ as es,i as Dt,V as ct,b as gs,j as e,c as Xs,U as He,u as xs,d as Zs,e as ts,T as ss,D as Qs,f as ea,h as ta,k as sa,m as aa,n as Et,o as as,p as Oe,q as ra,t as na,L as rs,v as Lt,w as ns,I as os,x as is,y as ls}from"./index-obwd5zJk.js";import{C as oa}from"./index.module-BmF4oJ0n.js";const ge=[];for(let t=0;t<256;++t)ge.push((t+256).toString(16).slice(1));function ia(t,o=0){return(ge[t[o+0]]+ge[t[o+1]]+ge[t[o+2]]+ge[t[o+3]]+"-"+ge[t[o+4]]+ge[t[o+5]]+"-"+ge[t[o+6]]+ge[t[o+7]]+"-"+ge[t[o+8]]+ge[t[o+9]]+"-"+ge[t[o+10]]+ge[t[o+11]]+ge[t[o+12]]+ge[t[o+13]]+ge[t[o+14]]+ge[t[o+15]]).toLowerCase()}let Mt;const la=new Uint8Array(16);function ca(){if(!Mt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Mt=crypto.getRandomValues.bind(crypto)}return Mt(la)}const da=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cs={randomUUID:da};function ua(t,o,i){t=t||{};const l=t.random??t.rng?.()??ca();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,ia(l)}function ma(t,o,i){return cs.randomUUID&&!t?cs.randomUUID():ua(t)}const Rt=50,it=t=>{let o=null;if(t.reply_to){const i=Array.isArray(t.reply_to)?t.reply_to[0]:t.reply_to;i&&i.id&&i.user_id&&(o={id:i.id,content:i.content||"",user_id:i.user_id,author_name:i.author_name})}return{id:t.id,league_id:t.league_id,user_id:t.user_id,content:t.content,created_at:t.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:t.reply_to_message_id??null,reply_to:o}},Ie=t=>{const o=new Set,i=[];for(const l of t)o.has(l.id)||(o.add(l.id),i.push(l));return i.sort((l,n)=>new Date(l.created_at).getTime()-new Date(n.created_at).getTime())};function fa(t,o={}){const{userId:i,enabled:l=!0,autoSubscribe:n=!0}=o,m=()=>!t||!l?[]:le(`chat:messages:${t}`)||[],[x,s]=a.useState(m),[c,p]=a.useState(!1),[g,j]=a.useState(!1),[b,f]=a.useState(!0),[h,M]=a.useState(null),v=a.useRef(null),U=a.useRef(null),L=a.useRef(x),W=a.useRef("idle"),G=a.useRef(i);a.useEffect(()=>{G.current=i},[i]);const C=a.useCallback(N=>{s(Z=>{const E=N(Z);if(L.current=E,v.current=E.length?E[0].created_at:null,U.current=E.length?E[E.length-1].created_at:null,t&&E.length>0){const se=E.filter(q=>!q.id.startsWith("optimistic-"));if(se.length>0){const q=`chat:messages:${t}`;Ke(q,se,lt.HOME)}}return E})},[t]),ee=a.useRef(null),ue=a.useRef(!1),me=a.useRef(null);a.useEffect(()=>{L.current=x},[x]);const he=a.useCallback(async({before:N,append:Z})=>{if(!t||!l)return;const E=B.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).eq("league_id",t).order("created_at",{ascending:!1}).limit(Rt);N&&E.lt("created_at",N);const{data:se,error:q}=await E;if(Ct("useMiniLeagueChat","Fetch messages page","league_messages",{data:se,error:q},{leagueId:t,before:N,pageSize:Rt}),q)throw console.error("[useMiniLeagueChat] Error fetching messages:",q),q;const ce=(se??[]).filter(R=>R.reply_to_message_id),re=[...new Set(ce.map(R=>R.reply_to_message_id))];let z=new Map;if(!ce.some(R=>R.reply_to&&!Array.isArray(R.reply_to))&&re.length>0){const{data:R,error:K}=await B.from("league_messages").select("id, content, user_id").in("id",re);Ct("useMiniLeagueChat","Fetch reply messages","league_messages",{data:R,error:K},{leagueId:t,replyMessageIds:re.length}),K?console.error("[useMiniLeagueChat] Error fetching reply messages:",K):R&&R.forEach(xe=>{z.set(xe.id,xe)})}const D=(se??[]).map(R=>{if(R.reply_to_message_id)if(R.reply_to&&!Array.isArray(R.reply_to))R.reply_to=R.reply_to;else{const K=z.get(R.reply_to_message_id);R.reply_to=K||null}else R.reply_to=null;return it(R)}).reverse();C(R=>Ie(Z?[...D,...R]:[...R,...D])),(se??[]).length<Rt?f(!1):Z||f(!0)},[t,l,C]),ve=a.useCallback(async(N=!1)=>{if(!t||!l){s([]),f(!0);return}const Z=L.current.length>0;Z||p(!0),M(null);try{if(!Z&&!N){const E=le(`chat:messages:${t}`);E&&E.length>0&&(C(()=>E),E.length>0&&(v.current=E[0].created_at,U.current=E[E.length-1].created_at),f(E.length>=50),p(!1))}await he({append:!1})}catch(E){const{getUserFriendlyMessage:se}=await es(async()=>{const{getUserFriendlyMessage:q}=await import("./chatErrors-CWrmdYXz.js");return{getUserFriendlyMessage:q}},[]);console.error("[useMiniLeagueChat] Error in refresh:",E),M(se(E,"refresh"))}finally{Z||p(!1)}},[t,l,he,C]);a.useEffect(()=>{ee.current=ve,me.current=C},[ve,C]);const we=a.useRef(null);a.useEffect(()=>{const N=Date.now(),Z={miniLeagueId:t,enabled:l,autoSubscribe:n,userId:G.current},E=we.current;let se=[];E?(E.miniLeagueId!==t&&se.push(`miniLeagueId: "${E.miniLeagueId}" â†’ "${t}"`),E.enabled!==l&&se.push(`enabled: ${E.enabled} â†’ ${l}`),E.autoSubscribe!==n&&se.push(`autoSubscribe: ${E.autoSubscribe} â†’ ${n}`)):se.push("initial mount"),we.current={miniLeagueId:t,enabled:l,autoSubscribe:n};try{const z=localStorage.getItem("message_subscription_logs"),k=z?JSON.parse(z):[];k.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_MOUNT",channel:`league-messages:${t}`,dependencies:Z,effectId:N,changedFields:se,reason:se.length>0?`Subscription effect mounted - changed: ${se.join(", ")}`:"Subscription effect mounted"});const D=k.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(D))}catch(z){console.error("[useMiniLeagueChat] Failed to log effect mount:",z)}if(!t||!l||!n){try{const z=localStorage.getItem("message_subscription_logs"),k=z?JSON.parse(z):[];k.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_SKIP",channel:`league-messages:${t}`,dependencies:Z,effectId:N,reason:`Skipped: miniLeagueId=${!!t}, enabled=${l}, autoSubscribe=${n}`});const D=k.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(D))}catch{}return}let q=!0,ce=null,re=null;return W.current="subscribing",re=B.channel(`league-messages:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${t}`},async z=>{if(q&&z.new.user_id!==G.current)try{const k=z.new;if(k.reply_to_message_id){const{data:R}=await B.from("league_messages").select("id, content, user_id").eq("id",k.reply_to_message_id).single();R?k.reply_to=R:k.reply_to=null}else k.reply_to=null;const D=it(k);me.current?.(R=>R.some(K=>K.id===D.id)?R:Ie([...R,D]))}catch(k){console.error("[useMiniLeagueChat] Error processing real-time message:",k);try{const D=it(z.new);me.current?.(R=>R.some(K=>K.id===D.id)?R:Ie([...R,D]))}catch(D){console.error("[useMiniLeagueChat] Fallback also failed:",D)}}}).subscribe(z=>{W.current=z==="SUBSCRIBED"?"subscribed":z==="CHANNEL_ERROR"||z==="TIMED_OUT"?"failed":"idle";try{const k=localStorage.getItem("message_subscription_logs"),D=k?JSON.parse(k):[];D.push({timestamp:Date.now(),leagueId:t,status:z,channel:`league-messages:${t}`});const R=D.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(R))}catch(k){console.error("[useMiniLeagueChat] Failed to log subscription status:",k)}z==="SUBSCRIBED"?ce&&(clearTimeout(ce),ce=null):(z==="CHANNEL_ERROR"||z==="TIMED_OUT")&&(ce&&clearTimeout(ce),ce=setTimeout(()=>{q&&W.current!=="subscribed"&&(console.warn("[useMiniLeagueChat] Subscription failed, triggering safety refresh"),ee.current?.(!1).catch(()=>{}))},2e3))}),()=>{try{const z=localStorage.getItem("message_subscription_logs"),k=z?JSON.parse(z):[];k.push({timestamp:Date.now(),leagueId:t,status:"EFFECT_UNMOUNT",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:l,autoSubscribe:n,userId:G.current},effectId:N,reason:"Subscription effect unmounting (cleanup)"});const D=k.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(D))}catch(z){console.error("[useMiniLeagueChat] Failed to log effect unmount:",z)}if(q=!1,ce&&clearTimeout(ce),re){B.removeChannel(re);try{const z=localStorage.getItem("message_subscription_logs"),k=z?JSON.parse(z):[];k.push({timestamp:Date.now(),leagueId:t,status:"CLOSED",channel:`league-messages:${t}`,dependencies:{miniLeagueId:t,enabled:l,autoSubscribe:n,userId:G.current},effectId:N,reason:"Channel removed in cleanup"});const D=k.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(D))}catch{}}}},[t,l,n]),a.useEffect(()=>{if(!t||!l){s([]),f(!0);return}if(typeof window<"u"&&new URLSearchParams(window.location.search).get("tab")==="chat"&&!ue.current){ee.current?.(!0).catch(()=>{}),ue.current=!0;return}const Z=L.current,E=le(`chat:messages:${t}`);Z.length>0?(Z.length>0&&(v.current=Z[0].created_at,U.current=Z[Z.length-1].created_at,f(Z.length>=50)),ee.current?.(!1).catch(()=>{})):E&&E.length>0?(C(()=>E),E.length>0&&(v.current=E[0].created_at,U.current=E[E.length-1].created_at),f(E.length>=50),ee.current?.(!1).catch(()=>{})):ee.current?.(!1).catch(()=>{})},[t,l]);const Se=a.useCallback(async()=>{if(!t||!l||!b||g)return;const N=v.current??x[0]?.created_at;if(N){j(!0);try{await he({before:N,append:!0})}catch(Z){console.error("[useMiniLeagueChat] Error loading more messages:",Z),M(Z?.message??"Failed to load more messages")}finally{j(!1)}}},[t,l,b,g,he,x]),Ee=a.useCallback(async(N,Z)=>{if(!t||!i)throw new Error("Missing league or user");const E=N.trim();if(!E)return;const se=ma(),q=`optimistic-${se}`,ce={id:q,client_msg_id:se,league_id:t,user_id:i,content:E,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:Z??null};C(k=>Ie([...k,ce]));const{data:re,error:z}=await B.from("league_messages").insert({league_id:t,user_id:i,content:E,reply_to_message_id:Z??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id,
          reply_to:league_messages!reply_to_message_id(id, content, user_id)
        `).single();if(Ct("useMiniLeagueChat","Insert message","league_messages",{data:re,error:z},{leagueId:t,userId:i,hasReplyTo:!!Z}),z){const{handleChatError:k}=await es(async()=>{const{handleChatError:R}=await import("./chatErrors-CWrmdYXz.js");return{handleChatError:R}},[]),D=k(z,"sendMessage");throw console.error("[useMiniLeagueChat] Error sending message:",z),C(R=>R.map(K=>K.id===q?{...K,status:"error"}:K)),new Error(D.message)}if(re){if(re.reply_to_message_id&&(!re.reply_to||Array.isArray(re.reply_to))){const{data:D}=await B.from("league_messages").select("id, content, user_id").eq("id",re.reply_to_message_id).single();D?re.reply_to=D:re.reply_to=null}const k=it(re);k.client_msg_id=se,k.status="sent",C(D=>{const R=D.findIndex(K=>K.id===q||K.client_msg_id===se&&K.id.startsWith("optimistic-"));if(R>=0){const K=[...D];return K[R]=k,Ie(K)}else return D.some(K=>K.id===k.id)?D:Ie([...D,k])})}},[t,i,C]),Me=a.useMemo(()=>x.slice(-5),[x]);return{messages:x,previewMessages:Me,loading:c,loadingMore:g,hasMore:b,error:h,refresh:ve,loadMore:Se,sendMessage:Ee}}function ha({leagueId:t,userId:o,enabled:i=!0,containerRef:l}){const n=a.useRef(0),m=a.useRef(null),x=2e3,s=a.useCallback(async()=>{if(!t||!o||!i)return;const c=Date.now();if(c-n.current<x){m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{s()},x-(c-n.current));return}n.current=c;try{const p=new Date().toISOString(),{error:g}=await B.from("league_message_reads").upsert({league_id:t,user_id:o,last_read_at:p},{onConflict:"league_id,user_id"});if(g){console.error("[useMarkMessagesRead] Error upserting last_read_at:",g);return}console.debug("[useMarkMessagesRead] Invalidating cache before marking as read",{leagueId:t,userId:o.slice(0,8),lastReadAt:p});let j=null;try{j=le(`leagues:unread:${o}`)}catch{}Dt(o),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:t,userId:o}})),console.debug("[useMarkMessagesRead] Marked messages as read and invalidated cache",{leagueId:t,userId:o.slice(0,8),lastReadAt:p,cachedUnreadBefore:j,eventDispatched:!0})}catch(p){console.error("[useMarkMessagesRead] Error marking messages as read:",p)}},[t,o,i]);return a.useEffect(()=>{if(!i||!t||!o||!l.current)return;const c=l.current,p=new IntersectionObserver(j=>{j[0]?.isIntersecting&&c.querySelectorAll("[data-message-id]").length>0&&s()},{root:null,rootMargin:"0px",threshold:.1});p.observe(c);const g=()=>{c.scrollTop>0&&s()};return c.addEventListener("scroll",g,{passive:!0}),()=>{p.disconnect(),c.removeEventListener("scroll",g),m.current&&clearTimeout(m.current)}},[i,t,o,l,s]),{markAsRead:s}}function ga({leagueId:t,userId:o,enabled:i,heartbeatMs:l=1e4}){a.useEffect(()=>{if(!i||!t||!o)return;let n=!0;const m=t,x=o,s=async()=>{if(n)try{const{error:j}=await B.from("chat_presence").upsert({league_id:m,user_id:x,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});j&&console.warn("[useChatPresence] Failed to update presence:",j)}catch(j){console.warn("[useChatPresence] Error updating presence:",j)}},c=async()=>{try{await B.from("chat_presence").delete().eq("league_id",m).eq("user_id",x)}catch(j){console.warn("[useChatPresence] Error clearing presence:",j)}};s();const p=setInterval(()=>{n&&s()},l),g=()=>{document.visibilityState==="hidden"?c():document.visibilityState==="visible"&&n&&s()};return document.addEventListener("visibilitychange",g),()=>{n=!1,clearInterval(p),document.removeEventListener("visibilitychange",g),c()}},[i,t,o,l])}const xa=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),pa=t=>new Date(t).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),ba=t=>{const o=t.trim().split(/\s+/);return o.length===1?o[0][0]?.toUpperCase()??"?":`${o[0][0]?.toUpperCase()??""}${o[o.length-1][0]?.toUpperCase()??""}`};function wa({messages:t,currentUserId:o,currentUserDisplayName:i,hasAnyNames:l,getName:n}){const m=a.useMemo(()=>{if(!t.length)return[];if(!l)return[];let s=null;const c=[];for(const p of t){const g=!!(o&&p.user_id===o),f=n(p.user_id)||(g?i:"")||(g?"You":"Unknown"),h=g?void 0:ba(f),v=new Date(p.created_at).toDateString(),U=v!==s;U&&(s=v);const L=p.reply_to?.user_id?n(p.reply_to.user_id)||"Unknown":void 0,W={id:p.id,text:p.content,time:xa(p.created_at),status:p.status&&p.status!=="sent"?p.status:void 0,messageId:p.id,replyTo:p.reply_to?{id:p.reply_to.id,content:p.reply_to.content,authorName:L}:null},G=c[c.length-1];if(G&&!U&&!!G.isOwnMessage===g&&G.userId===p.user_id){const ee=G.id.includes("-")?G.id.split("-")[0]:G.id;c[c.length-1]={...G,id:`${ee}-${f}`,author:f,avatarInitials:h,userId:p.user_id,messages:[...G.messages,W]}}else c.push({id:`${p.id}-${f}`,author:f,avatarInitials:h,isOwnMessage:g,userId:p.user_id,dayLabel:U?pa(p.created_at):void 0,messages:[W]})}return c},[t,o,i,l,n]),x=a.useMemo(()=>{const s=m.map(p=>p.author).join(","),c=m.some(p=>p.author==="Unknown");return`chat-${m.length}-${c?"unknown":"resolved"}-${s.slice(0,50)}`},[m]);return{groups:m,key:x}}function ya(t,o){const i={};for(const n of t)i[n.message_id]||(i[n.message_id]={}),i[n.message_id][n.emoji]||(i[n.message_id][n.emoji]={count:0,hasUserReacted:!1}),i[n.message_id][n.emoji].count++,n.user_id===o&&(i[n.message_id][n.emoji].hasUserReacted=!0);const l={};for(const n of Object.keys(i))l[n]=Object.entries(i[n]).map(([m,x])=>({emoji:m,count:x.count,hasUserReacted:x.hasUserReacted}));return l}function ds(t,o,i){const l={...t},n=l[o.message_id]?[...l[o.message_id]]:[],m=n.findIndex(x=>x.emoji===o.emoji);if(m>=0){const x=n[m];n[m]={...x,count:x.count+1,hasUserReacted:x.hasUserReacted||o.user_id===i}}else n.push({emoji:o.emoji,count:1,hasUserReacted:o.user_id===i});return l[o.message_id]=n,l}function us(t,o,i){const l=t[o.message_id];if(!l)return t;const n={...t},m=[...l],x=m.findIndex(p=>p.emoji===o.emoji);if(x<0)return t;const s=m[x],c=Math.max(0,s.count-1);return c===0?m.splice(x,1):m[x]={...s,count:c,hasUserReacted:o.user_id===i?!1:s.hasUserReacted},m.length===0?delete n[o.message_id]:n[o.message_id]=m,n}function va({leagueId:t,messageIds:o,userId:i,onError:l}){const n=a.useMemo(()=>!t||!i?null:`chat:reactions:${t}:${i}`,[t,i]),[m,x]=a.useState(()=>n?le(n)??{}:{}),s=a.useRef(i);a.useEffect(()=>{s.current=i},[i]);const c=a.useMemo(()=>Array.from(new Set(o)).sort(),[o]),p=c.join(","),g=a.useMemo(()=>new Set(c),[p]);a.useEffect(()=>{if(!n||c.length===0)return;const b=le(n);if(!b)return;const f={};Object.entries(b).forEach(([h,M])=>{g.has(h)&&(f[h]=M)}),x(h=>Object.keys(h).length?h:f)},[n,g,p,c.length]),a.useEffect(()=>{if(!i||c.length===0)return;let b=!1;return(async()=>{try{const{data:f,error:h}=await B.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",c);if(b)return;if(h){l?.(`Failed to load reactions: ${h.message}`);return}const M=ya(f||[],i);if(x(M),n){const v={};Object.entries(M).forEach(([U,L])=>{g.has(U)&&(v[U]=L)}),Ke(n,v,lt.HOME)}}catch(f){if(b)return;l?.(`Error loading reactions: ${f?.message||String(f)}`)}})(),()=>{b=!0}},[p,i]),a.useEffect(()=>{if(!t||!i||c.length===0)return;const b=B.channel(`message-reactions:${t}`).on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},f=>{const h=s.current;if(!h)return;const M=f.eventType,v=f.new,U=f.old,L=M==="DELETE"?U:v;!L?.message_id||!L.emoji||!L.user_id||c.includes(L.message_id)&&x(W=>M==="DELETE"?us(W,L,h):M==="INSERT"?ds(W,L,h):W)}).subscribe();return()=>{B.removeChannel(b)}},[t,c,i]);const j=a.useCallback(async(b,f)=>{const h=s.current;if(!h)return;const v=(m[b]||[]).find(U=>U.emoji===f&&U.hasUserReacted);if(x(U=>{const L={...U},W=L[b]?[...L[b]]:[],G=W.findIndex(C=>C.emoji===f);if(v){if(G>=0){const C=W[G],ee=Math.max(0,C.count-1);ee===0?W.splice(G,1):W[G]={...C,count:ee,hasUserReacted:!1}}}else if(G>=0){const C=W[G];W[G]={...C,count:C.count+1,hasUserReacted:!0}}else W.push({emoji:f,count:1,hasUserReacted:!0});return W.length===0?delete L[b]:L[b]=W,L}),v){const{error:U}=await B.from("league_message_reactions").delete().eq("message_id",b).eq("user_id",h).eq("emoji",f);U&&x(L=>ds(L,{message_id:b,emoji:f,user_id:h},h))}else{const{error:U}=await B.from("league_message_reactions").upsert({message_id:b,user_id:h,emoji:f});U&&x(L=>us(L,{message_id:b,emoji:f,user_id:h},h))}},[m]);return a.useEffect(()=>{if(!n)return;const b={};Object.entries(m).forEach(([f,h])=>{g.has(f)&&(b[f]=h)}),Ke(n,b,lt.HOME)},[n,m,g]),{reactions:m,onReactionClick:j}}const ms=(t,o,i)=>{if(t===ct)return gs;if(o)if(o instanceof Map){const l=o.get(t);if(l)return l}else{const l=o[t];if(l)return l}if(i){const l=i.get(t);if(l)return l}return""};function ka({messages:t,memberNames:o,currentUserId:i}){const[l,n]=a.useState(new Map),m=a.useRef(new Set);a.useEffect(()=>{if(t.length===0)return;const c=[],p=j=>{!j||j===ct||i&&j===i||m.current.has(j)||ms(j,o,l)||c.push(j)};for(const j of t)p(j.user_id),j.reply_to?.user_id&&p(j.reply_to.user_id);const g=Array.from(new Set(c));g.length!==0&&(g.forEach(j=>m.current.add(j)),(async()=>{try{const{data:j,error:b}=await B.from("users").select("id, name").in("id",g);if(b){console.error("[useChatAuthorNames] Error fetching user names:",b);return}j&&j.length>0&&n(f=>{const h=new Map(f);for(const M of j)M.id&&M.name&&h.set(M.id,M.name);return h})}catch(j){console.error("[useChatAuthorNames] Error fetching user names:",j)}})())},[t,o,l,i]);const x=a.useMemo(()=>(o instanceof Map?o.size>0:o?Object.keys(o).length>0:!1)||l.size>0,[o,l]),s=a.useCallback(c=>ms(c,o,l),[o,l]);return{additionalNames:l,hasAnyNames:x,getName:s}}function ja({inputAreaRef:t,listRef:o,scrollToBottom:i}){const[l,n]=a.useState(0),m=a.useCallback(s=>{const c=t.current?.offsetHeight||72;if(s>0){const p=s+c;n(s),o.current&&(o.current.style.paddingBottom=`${p+8}px`)}else n(0),o.current&&(o.current.style.paddingBottom=`${c+8}px`);requestAnimationFrame(()=>i())},[t,o,i]);a.useEffect(()=>{const s=window.visualViewport;if(!s)return;let c=null,p=0,g=!1;const j=setTimeout(()=>{g=!0},500),b=()=>{const h=window.innerHeight,M=s.height,v=s.offsetTop+M;return Math.max(0,h-v)},f=()=>{c&&clearTimeout(c),c=setTimeout(()=>{const h=b();g&&Math.abs(h-p)>10&&(p=h,m(h))},50)};return s.addEventListener("resize",f),s.addEventListener("scroll",f),window.addEventListener("resize",f),f(),()=>{clearTimeout(j),c&&clearTimeout(c),s.removeEventListener("resize",f),s.removeEventListener("scroll",f),window.removeEventListener("resize",f)}},[m]),a.useEffect(()=>{if(o.current&&t.current){const s=t.current.offsetHeight||72;o.current.style.paddingBottom=`${s+8}px`}},[t,o]);const x=a.useCallback(s=>{s.current&&s.current.removeAttribute("readonly");const c=()=>{const p=window.visualViewport;if(p){const g=window.innerHeight,j=p.height,b=p.offsetTop+j,f=Math.max(0,g-b);m(f)}};setTimeout(c,50),setTimeout(c,150),i()},[m,i]);return{inputBottom:l,applyKeyboardLayout:m,handleInputFocus:x}}const _a={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},Na={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},Sa=["ðŸ‘","â¤ï¸","ðŸ˜‚"],Ca=["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ¤¡","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸŽƒ","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾"];function Ea({author:t,text:o,time:i,isOwnMessage:l,shape:n="single",messageId:m,reactions:x=[],onReactionClick:s,replyTo:c,onMessageClick:p}){const g="text-left",j=l?"bg-[#1C8376] text-white":"bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",b=l?Na:_a,f="max-w-[85%]",[h,M]=a.useState(!1),[v,U]=a.useState(!1),L=a.useRef(null);a.useEffect(()=>{if(!h)return;const C=ue=>{L.current&&!L.current.contains(ue.target)&&M(!1)},ee=setTimeout(()=>{document.addEventListener("mousedown",C)},100);return()=>{clearTimeout(ee),document.removeEventListener("mousedown",C)}},[h]);const W=C=>{m&&s&&s(m,C),M(!1),U(!1)},G=C=>{const ee=C.target;ee.closest("button")||ee.closest("[data-reaction]")||p&&p()};return e.jsxs("div",{className:`inline-block ${f} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},"data-message-id":m,children:[e.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${g} ${j} ${b[n]} ${p?"cursor-pointer":""}`,onClick:G,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[t&&!l&&e.jsx("div",{className:"text-xs font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:t}),c&&e.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${l?"border-white/30 text-white/90":"border-[#1C8376] dark:border-emerald-400 text-slate-600 dark:text-slate-300"} pl-2 text-xs dark:text-slate-300`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[e.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.authorName||"Unknown"}),e.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:c.content})]}),e.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[e.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:o}),e.jsx("span",{className:`text-xs relative top-1 ${l?"text-[#DCDCDD]":"text-slate-400 dark:text-slate-500"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:i})]})]}),m&&!l&&e.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[h&&e.jsxs("div",{ref:L,className:"flex items-center gap-1 bg-white dark:bg-slate-800 rounded-full px-1 py-1 shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[Sa.map(C=>e.jsx("button",{onClick:()=>W(C),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${C}`,children:C},C)),p&&e.jsx("button",{onClick:()=>{M(!1),p()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),e.jsx("button",{onClick:()=>{M(!1),U(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:e.jsx("span",{className:"text-sm",children:"+"})})]}),e.jsx("button",{onClick:()=>M(!h),className:"w-7 h-7 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 flex items-center justify-center shadow-sm",title:"Add reaction",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),v&&m&&!l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>U(!1)}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-800 rounded-t-2xl shadow-2xl border-t border-slate-200 dark:border-slate-700 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:e.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"}),e.jsx("button",{onClick:()=>U(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 rounded-lg",children:"Close"}),e.jsx("div",{className:"w-12"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:Ca.map(C=>e.jsx("button",{onClick:()=>{m&&s&&s(m,C),U(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 dark:active:bg-slate-700 flex items-center justify-center text-2xl",title:C,children:C},C))})]})})]}),x.length>0&&e.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${l?"justify-end":"justify-start"}`,children:x.map(C=>e.jsxs("button",{onClick:()=>W(C.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${C.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200"}`,children:[e.jsx("span",{className:"text-base",children:C.emoji}),e.jsx("span",{children:C.count})]},C.emoji))})]})}function La({author:t,messages:o,isOwnMessage:i,avatarInitials:l,userId:n,reactions:m,onReactionClick:x,onMessageClick:s}){const c=i?"justify-end":"justify-start",p=n===ct;return e.jsxs("div",{className:`flex items-end gap-2 w-full ${c}`,children:[i?e.jsx("div",{className:"w-8 flex-shrink-0"}):p?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 dark:border-slate-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:Xs,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):n?e.jsx("div",{className:"flex-shrink-0",children:e.jsx(He,{userId:n,name:t,size:32,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-xs font-semibold text-slate-500 dark:text-slate-400 flex-shrink-0",children:(l||t.charAt(0)).toUpperCase()}),e.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:o.map((g,j)=>{const b=o.length===1?"single":j===0?"top":j===o.length-1?"bottom":"middle",f=g.messageId||g.id;let h="";if(typeof g.text=="string")h=g.text;else if(typeof g.text=="object"&&g.text!==null){const M=g.text?.props?.children||String(g.text);h=typeof M=="string"?M:String(M)}else h=String(g.text);return e.jsx("div",{className:`flex flex-col w-full min-w-0 ${i?"items-end":"items-start"}`,children:e.jsxs("div",{className:`flex w-full min-w-0 ${i?"justify-end":"justify-start"}`,children:[e.jsx(Ea,{author:!i&&j===0?t:void 0,text:g.text,time:g.time,isOwnMessage:i,shape:b,messageId:f,reactions:m?.[f]||[],onReactionClick:x,replyTo:g.replyTo,onMessageClick:s?()=>s(f,h,!i&&j===0?t:void 0):void 0}),g.status&&e.jsx("div",{className:`text-xs ml-2 ${g.status==="error"?"text-red-500":"text-slate-400 dark:text-slate-500"}`,children:g.status==="error"?"Failed":"Sendingâ€¦"})]})},g.id)})})]})}function Ma({groups:t,reactions:o,onReactionClick:i,onMessageClick:l}){return e.jsx("div",{className:"flex flex-col gap-5 w-full max-w-full",children:t.map((n,m)=>e.jsxs("div",{className:"flex flex-col gap-3",children:[n.dayLabel&&e.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:n.dayLabel}),e.jsx(La,{author:n.author,avatarInitials:n.avatarInitials,isOwnMessage:n.isOwnMessage,userId:n.userId,messages:n.messages,reactions:o,onReactionClick:i,onMessageClick:l},`${n.id}-${n.author}-${m}`)]},`${n.id}-${n.author}-${m}`))})}function Ra({miniLeagueId:t,memberNames:o,deepLinkError:i,isChatActive:l=!0}){const{user:n}=xs(),{messages:m,error:x,sendMessage:s}=fa(t,{userId:n?.id,enabled:!!t}),[c,p]=a.useState(""),[g,j]=a.useState(!1),[b,f]=a.useState(null),[h,M]=a.useState([]),{hasAnyNames:v,getName:U}=ka({messages:m,memberNames:o,currentUserId:n?.id??null}),L=a.useRef(null),W=a.useCallback(()=>{if(L.current){const k=L.current.scrollHeight-L.current.clientHeight;L.current.scrollTop=k}},[]),{markAsRead:G}=ha({leagueId:t??null,userId:n?.id??null,enabled:!!(t&&n?.id),containerRef:L});a.useEffect(()=>{t&&n?.id&&m.length>0&&G()},[t,n?.id,m.length,G]);const C=a.useRef(null),ee=a.useRef(null),ue=a.useRef(!1),{inputBottom:me,applyKeyboardLayout:he,handleInputFocus:ve}=ja({inputAreaRef:ee,listRef:L,scrollToBottom:W});ga({leagueId:t??null,userId:n?.id??null,enabled:!!(l&&t&&n?.id)}),a.useEffect(()=>{ue.current=!1},[t]);const we=a.useMemo(()=>m.map(k=>k.id).filter(k=>!k.startsWith("optimistic-")),[m]),{reactions:Se,onReactionClick:Ee}=va({leagueId:t??null,messageIds:we,userId:n?.id??null,onError:k=>{M(D=>[...D,{id:`reactions-${Date.now()}`,message:k,timestamp:Date.now()}])}});a.useEffect(()=>{!c&&C.current&&(C.current.style.height="auto",C.current.style.height="42px")},[c]);const Me=a.useCallback(()=>ve(C),[ve]),N=k=>{const D=k.target;!(D.tagName==="A"||D.tagName==="BUTTON"||D.closest("a, button"))&&C.current&&document.activeElement===C.current&&C.current.blur()},Z=a.useMemo(()=>{if(!n)return"";const k=n.user_metadata??{};return k.display_name||k.full_name||n.email||""},[n]),{groups:E,key:se}=wa({messages:m,currentUserId:n?.id??null,currentUserDisplayName:Z,hasAnyNames:v,getName:U}),q=a.useCallback(k=>{if(L.current=k,k){if(ee.current){const R=`${(ee.current.offsetHeight||72)+8}px`;k.style.paddingBottom=R}else k.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{k&&m.length>0&&E.length>0})})}},[m.length,E.length]);a.useEffect(()=>{ue.current=!1},[t]),a.useEffect(()=>{m.length>0&&L.current&&(ue.current||(ue.current=!0),requestAnimationFrame(()=>{if(L.current){const k=L.current.scrollHeight,D=L.current.clientHeight,R=k-D;k>D&&(L.current.scrollTop=R)}}))},[m.length,m]);const ce=a.useCallback(async k=>{if(!t||!n?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const R=n.user_metadata?.display_name||n.user_metadata?.full_name||n.email||"User";try{const K=new AbortController,xe=window.setTimeout(()=>K.abort(),3e3);try{await fetch("/.netlify/functions/notifyLeagueMessageV2",{method:"POST",headers:{"Content-Type":"application/json"},signal:K.signal,body:JSON.stringify({leagueId:t,senderId:n.id,senderName:R,content:k,activeUserIds:[n.id]})})}finally{clearTimeout(xe)}}catch{}},[t,n?.id]),re=a.useCallback(async()=>{const k=c.trim();if(!(!t||!k||g))try{j(!0),p(""),C.current&&(C.current.style.height="auto",C.current.style.height="42px"),await s(k,b?.id||null),ce(k).catch(()=>{}),f(null),W()}catch(D){M(R=>[...R,{id:`send-${Date.now()}`,message:`Failed to send message: ${D?.message||String(D)}`,timestamp:Date.now()}]),p(k)}finally{j(!1)}},[c,t,ce,W,s,g,b]);a.useEffect(()=>{i&&M(k=>k.some(D=>D.message.includes("Deep Link"))?k:[...k,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${i}`,timestamp:Date.now()}])},[i]),a.useEffect(()=>{if(h.length===0)return;const k=setTimeout(()=>{M(D=>D.filter(R=>Date.now()-R.timestamp<5e3))},5e3);return()=>clearTimeout(k)},[h]);const z=m.length>0&&E.length>0;return e.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[h.length>0&&e.jsx("div",{className:"px-4 pt-2 space-y-2",children:h.map(k=>e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[e.jsx("span",{className:"flex-1",children:k.message}),e.jsx("button",{onClick:()=>M(D=>D.filter(R=>R.id!==k.id)),className:"text-red-600 flex-shrink-0",children:"Ã—"})]},k.id))}),e.jsx("div",{ref:q,className:"flex-1 overflow-y-auto px-4 py-5",onClick:N,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",paddingBottom:"91px"},children:z?e.jsx(e.Fragment,{children:e.jsx(Ma,{groups:E,reactions:Se,onReactionClick:Ee,onMessageClick:(k,D,R)=>{const K=m.find(xe=>xe.id===k);if(K){let xe="";if(typeof D=="string")xe=D;else if(typeof D=="object"&&D!==null){const De=D?.props?.children||String(D);xe=typeof De=="string"?De:String(De)}else xe=String(D);f({id:k,content:xe||K.content,authorName:R}),setTimeout(()=>{C.current?.focus()},100)}}},se)}):null}),e.jsxs("div",{ref:ee,className:"flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:me>0?"fixed":"relative",bottom:me>0?`${me}px`:"0",left:me>0?0:"auto",right:me>0?0:"auto",width:"100%",maxWidth:me>0?"440px":"100%",marginLeft:me>0?"auto":void 0,marginRight:me>0?"auto":void 0,zIndex:me>0?100:"auto",boxShadow:me>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[b&&e.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",b.authorName||"Unknown"]}),e.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:b.content})]}),e.jsx("button",{onClick:()=>f(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 dark:bg-slate-700 rounded-2xl px-3 py-2 relative",children:[e.jsx("textarea",{ref:C,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 dark:text-slate-200 placeholder:text-slate-400 dark:placeholder:text-slate-500",rows:1,value:c,disabled:!t||g,placeholder:t?"Start typing a messageâ€¦":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:k=>{if(k.key==="Escape"&&b){f(null),k.preventDefault();return}k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),re())},onChange:k=>{p(k.target.value),C.current&&(C.current.style.height="auto",C.current.style.height=`${Math.min(C.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const D=window.visualViewport;if(D){const R=window.innerHeight,K=D.height,xe=D.offsetTop+K,De=R-xe;he(De)}})},onFocus:Me,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),e.jsx("button",{type:"button",onClick:re,disabled:!t||g||!c.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),x&&e.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[x," â€” try again or switch to the classic chat tab."]})]})]})}function Ta({winnerName:t,isDraw:o}){return e.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:e.jsx("div",{className:"text-center relative z-10",children:o?e.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):e.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[t," Wins!"]})})})}function Aa({availableGws:t,selectedGw:o,onChange:i,className:l=""}){return t.length<=1?null:e.jsxs("div",{className:`flex-1 ${l}`,children:[e.jsx("style",{children:`
        .gw-selector option {
          background-color: white;
          color: #64748b;
        }
        .dark .gw-selector option {
          background-color: #1e293b;
          color: #ffffff;
        }
        .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
        .dark .gw-selector {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }
      `}),e.jsx("select",{value:o||void 0,onChange:n=>{const m=parseInt(n.target.value,10);i(m)},className:"gw-selector w-full bg-white dark:bg-slate-800 rounded-full border-2 border-slate-300 dark:border-slate-600 px-3 py-2 text-xs font-normal text-slate-600 dark:text-white text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 dark:active:bg-slate-700 transition-colors",style:{minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:t.map(n=>e.jsxs("option",{value:n,className:"text-xs",children:["Gameweek ",n]},n))})]})}function Da({showForm:t,onToggle:o}){return e.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 dark:bg-slate-800 p-0.5 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>o(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"text-slate-600 dark:text-slate-400":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),e.jsx("button",{onClick:()=>o(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${t?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 dark:text-slate-400"}`,children:"Form"})]})}function Pa({form:t}){const o=t.slice(-5),i=5-o.length;return e.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:i}).map((l,n)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${n}`)),o.map((l,n)=>e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${l==="W"?"bg-emerald-100 text-emerald-700":l==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:l},n))]})}function Ia({rows:t,members:o,showForm:i,currentUserId:l,loading:n,isLateStartingLeague:m}){return e.jsxs("div",{className:"pt-4",children:[e.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),e.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",borderBottom:"none",boxShadow:"none"},children:e.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",border:"none",borderBottom:"none"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:"Player"}),i?e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Form"}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"W"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"D"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:m?"CP":"OCP"}),o.length>=3&&e.jsx("th",{className:"py-3 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"}),e.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"PTS"})]})]})}),e.jsxs("tbody",{children:[t.map((x,s)=>{const c=x.user_id===l,p=s===t.length-1;return e.jsxs("tr",{className:c?"flash-user-row":"",style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...p?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:s+1}),e.jsx("td",{className:"py-4 bg-slate-50 dark:bg-slate-900 pl-0 pr-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(He,{userId:x.user_id,name:x.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:x.name})]})}),i?e.jsx("td",{className:"px-4 py-4 bg-slate-50 dark:bg-slate-900",children:e.jsx(Pa,{form:x.form})}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:x.wins}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:x.draws}),e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-10 pl-1 pr-1",children:x.ocp}),o.length>=3&&e.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1",children:x.unicorns}),e.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-10 pl-1 pr-1",children:x.mltPts})]})]},x.user_id)}),n&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:i?3:o.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"Calculatingâ€¦"})}),!n&&!t.length&&e.jsx("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsx("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center",colSpan:i?3:o.length>=3?7:6,style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:"No gameweeks completed yet â€” this will populate after the first results are saved."})})]})]})})]})}function $a({rows:t,members:o,currentUserId:i,positionChangeKeys:l,isApiTestLeague:n,hasLiveFixtures:m,hasStartingSoonFixtures:x,hasStartedFixtures:s,allFixturesFinished:c,resGw:p}){return e.jsxs("div",{children:[e.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
        .dark .full-width-header-border::after {
          background-color: #475569;
        }
      `}),e.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 shadow-sm",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",borderBottom:"none"},children:[e.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.5rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"#"}),e.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem",width:"auto"},children:e.jsxs("div",{className:"flex items-center gap-2",children:["Player",n&&m&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),n&&!c&&x&&!m&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-[10px] font-medium",children:s?"Next Game Starting Soon":"Starting soon"})]})]})}),e.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"Score"}),o.length>=3&&e.jsx("th",{className:"py-4 text-center font-normal text-base",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#1e293b":"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:document.documentElement.classList.contains("dark")?"#cbd5e1":"#94a3b8"},children:"ðŸ¦„"})]})}),e.jsxs("tbody",{children:[t.map((g,j)=>{const b=g.user_id===i,f=j===t.length-1,h=l.has(g.user_id);return e.jsxs("tr",{className:`${b?"flash-user-row":""} ${h?"position-changed":""}`,style:{position:"relative",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",...f?{}:{borderBottom:document.documentElement.classList.contains("dark")?"1px solid #334155":"1px solid #e2e8f0"}},children:[e.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative text-slate-900 dark:text-slate-100",style:{paddingLeft:"0.5rem",paddingRight:"0.25rem",backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",width:"35px"},children:j+1}),e.jsx("td",{className:"py-4",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[n&&m&&e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),n&&!m&&x&&e.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(He,{userId:g.user_id,name:g.name,size:24,className:"border border-slate-200 dark:border-slate-700",fallbackToInitials:!0})}),e.jsx("span",{className:"text-xs truncate min-w-0 whitespace-nowrap font-normal text-slate-900 dark:text-slate-100",style:{overflow:"hidden",textOverflow:"ellipsis"},children:g.name})]})}),e.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 dark:bg-slate-900 w-[50px] pl-1 pr-1 ${n&&m?"pulse-live-score":""}`,children:g.score}),o.length>=3&&e.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 w-[35px] pl-1 pr-1 ${n&&m?"pulse-live-score":""}`,children:g.unicorns})]},g.user_id)}),!t.length&&e.jsx("tr",{className:"bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},children:e.jsxs("td",{className:"px-4 py-6 text-slate-500 dark:text-slate-400 text-center bg-slate-50 dark:bg-slate-900",style:{backgroundColor:document.documentElement.classList.contains("dark")?"#0f172a":"#f8fafc"},colSpan:o.length>=3?4:3,children:["No results recorded for GW ",p," yet."]})})]})]})})]})}function Ua(t){const o=Zs(),i=encodeURIComponent(t);if(o){const l=`whatsapp://send?text=${i}`;let n=!1,m=!1;try{const x=document.createElement("a");x.href=l,x.style.display="none",document.body.appendChild(x),x.click(),n=!0,setTimeout(()=>{document.body.contains(x)&&document.body.removeChild(x)},100)}catch{}if(!n)try{window.open(l),m=!0}catch{}if(!n&&!m)try{window.location.href=l}catch{window.open(`https://wa.me/?text=${i}`,"_blank")}}else{const l=`https://wa.me/?text=${i}`;try{window.open(l,"_blank")}catch{navigator.clipboard.writeText(t).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+t)})}}}function Fa(t,o){const i=new Date(o.find(j=>j.gw===t)?.kickoff_time||""),l=new Date(i.getTime()-4500*1e3),n=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],m=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],x=n[l.getUTCDay()],s=l.getUTCDate(),c=m[l.getUTCMonth()],p=l.getUTCHours().toString().padStart(2,"0"),g=l.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${t} Predictions Reminder!

DEADLINE: THIS ${x} ${s} ${c}, ${p}:${g} BST

Don't forget!
playtotl.com`}function Ba(t,o){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",t);try{const i=Fa(t,o);console.log("[SubmissionStatusTable] Generated message:",i),Ua(i)}catch(i){console.error("[SubmissionStatusTable] Error in handleShareReminder:",i),alert("Error sharing reminder. Please try again.")}}function fs({members:t,submittedMap:o,picksGw:i,allSubmitted:l,remaining:n,fixtures:m,onShareReminder:x,variant:s="full"}){const c=x||(()=>Ba(i,m)),p=m.map(h=>h.kickoff_time).filter(h=>!!h).map(h=>new Date(h)).filter(h=>!isNaN(h.getTime())),g=p.length>0?new Date(Math.min(...p.map(h=>h.getTime()))):null,j=g?new Date(g.getTime()-4500*1e3):null,b=j?new Date>=j:!1;let f="";if(j){const h=s==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],v=h[j.getUTCDay()],U=j.getUTCDate(),L=M[j.getUTCMonth()],W=j.getUTCHours().toString().padStart(2,"0"),G=j.getUTCMinutes().toString().padStart(2,"0");f=`${v} ${U} ${L}, ${W}:${G} BST`}return s==="compact"?e.jsxs("div",{className:"mt-2 pt-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:n})," of ",t.length," to submit."]})}),!l&&e.jsxs("button",{type:"button",onClick:h=>{h.preventDefault(),h.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),c()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&e.jsxs("div",{className:`mb-3 text-xs font-medium ${b?"text-orange-600 dark:text-orange-400":"text-slate-600 dark:text-slate-400"} flex items-center gap-1.5`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),b?"Deadline Passed:":"Deadline:",f]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((h,M)=>h.name.localeCompare(M.name)).map(h=>{const M=`${h.id}:${i}`,v=!!o.get(M);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{userId:h.id,name:h.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:h.name})]})}),e.jsx("td",{className:"px-4 py-3",children:v?e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},h.id)})})]})})]}):e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-700 dark:text-slate-300",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{children:l?e.jsxs(e.Fragment,{children:["All ",t.length," members have submitted."]}):e.jsxs(e.Fragment,{children:["Waiting for ",e.jsx("span",{className:"font-semibold",children:n})," of ",t.length," to submit."]})}),!l&&e.jsxs("button",{type:"button",onClick:h=>{h.preventDefault(),h.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),c()},className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&e.jsxs("div",{className:`mb-3 text-sm ${b?"text-orange-600 dark:text-orange-400 font-semibold":"text-slate-600 dark:text-slate-400"}`,children:[b?"â° Deadline Passed:":"â° Deadline:",f]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600 dark:text-slate-400",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600 dark:text-slate-400",children:"Status"})]})}),e.jsx("tbody",{children:t.slice().sort((h,M)=>h.name.localeCompare(M.name)).map(h=>{const M=`${h.id}:${i}`,v=!!o.get(M);return e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{userId:h.id,name:h.name,size:24,className:"flex-shrink-0",fallbackToInitials:!0}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:h.name})]})}),e.jsx("td",{className:"px-4 py-3",children:v?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"âœ… Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"â³ Not yet"})})]},h.id)})})]})})]})}function Oa({letter:t,userId:o,userName:i,correct:l,unicorn:n,hasSubmitted:m,isLive:x,isOngoing:s,isFinished:c}){let p;l===!0?x||s?p="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":c?p="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white relative overflow-hidden before:absolute before:inset-0 before:z-10 before:pointer-events-none before:w-[200%] before:bg-gradient-to-r before:from-transparent before:via-white/40 before:via-white/50 before:via-white/40 before:to-transparent before:animate-[shimmer_2.5s_ease-in-out_infinite] after:absolute after:inset-0 after:z-10 after:pointer-events-none after:w-[200%] after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:via-yellow-200/40 after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_3s_ease-in-out_infinite_0.5s]":p="bg-emerald-600 text-white border-emerald-600":m?p="bg-emerald-600 text-white border-emerald-600":p="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600";const g=!!o,j=g?p.replace(/\bborder-\S+/g,"").trim():p;return e.jsx("span",{className:["inline-flex items-center justify-center",g?"h-9 w-9 min-w-[36px]":"h-5 min-w-[18px]",g?"rounded-full mb-0.5":"rounded-full border mb-0.5","align-middle overflow-hidden",g?"p-0":"px-1.5 text-xs font-semibold",j].join(" "),title:n?"Correct!":i||void 0,children:g?e.jsx(He,{userId:o,name:i,size:36,className:"border-0 relative z-0",fallbackToInitials:!0}):t})}function Ha(t,o){return t==="FINISHED"?"FT":t==="PAUSED"?"HT":t==="IN_PLAY"?o==null?"LIVE":`${o}'`:"LIVE"}function za(t){const o=(t||"?").trim().split(/\s+/);return o.length?o.length===1?o[0].slice(0,1).toUpperCase():(o[0][0]+o[o.length-1][0]).toUpperCase():"?"}function Wa({fixture:t,picks:o,members:i,outcome:l,liveScore:n,submittedMap:m,picksGw:x,isApiTestLeague:s=!1}){const c=t.home_code||t.home_team||t.home_name||"",p=t.away_code||t.away_team||t.away_name||"",g=ts(c)||t.home_name||t.home_team||"Home",j=ts(p)||t.away_name||t.away_team||"Away",f=(G=>{if(!G)return"";const C=new Date(G);if(isNaN(C.getTime()))return"";const ee=String(C.getUTCHours()).padStart(2,"0"),ue=String(C.getUTCMinutes()).padStart(2,"0");return`${ee}:${ue}`})(t.kickoff_time),h=!!(n&&n.status==="IN_PLAY"),M=!!(n&&(n.status==="PAUSED"||n.status==="HALF_TIME"||n.status==="HT")),v=!!(n&&n.status==="FINISHED"),U=h||M;let L=null;s&&n?n.homeScore>n.awayScore?L="H":n.awayScore>n.homeScore?L="A":n.homeScore===n.awayScore&&(L="D"):L=l;const W=G=>{const C=o.filter(he=>he.pick===G),ee=4,ue=[];for(let he=0;he<C.length;he+=ee){const ve=C.slice(he,he+ee);ue.push(ve)}const me=12;return e.jsx("div",{className:"flex flex-col gap-1",children:ue.map((he,ve)=>e.jsx("div",{className:"flex items-center justify-center",children:he.map((we,Se)=>{const Ee=i.find(E=>E.id===we.user_id),Me=za(Ee?.name??"?"),N=m.has(`${we.user_id}:${x}`),Z=L&&L===G?!0:null;return e.jsx("span",{className:"inline-block",style:{marginLeft:Se>0?`-${me}px`:"0",position:"relative",zIndex:Se},children:e.jsx(Oa,{letter:Me,userId:we.user_id,userName:Ee?.name,correct:Z,unicorn:Z===!0,hasSubmitted:N,isLive:h,isOngoing:U,isFinished:v})},we.user_id)})},ve))})};return e.jsx("li",{className:"border-t first:border-t-0",children:e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800 relative",children:[(h||M)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),v&&!h&&!M&&e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:e.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"FT"})}),e.jsxs("div",{className:`grid grid-cols-3 items-center ${U?"pt-4":""}`,children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:g})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ss,{code:t.home_code||void 0,crest:t.home_crest||void 0,size:24,className:"h-6 w-6"}),e.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600 dark:text-slate-300",children:n&&(h||M||v)?e.jsxs("span",{className:"font-bold text-base text-slate-900 dark:text-slate-100",children:[n.homeScore," - ",n.awayScore]}):e.jsx("span",{children:f})}),e.jsx(ss,{code:t.away_code||void 0,crest:t.away_crest||void 0,size:24,className:"h-6 w-6"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-slate-100 truncate",children:j})})]}),n&&(U||v)&&e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx("span",{className:`text-[10px] font-semibold ${U?"text-red-600":"text-slate-500 dark:text-slate-400"}`,children:Ha(n.status,n.minute)})}),e.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:W("H")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:W("D")})}),e.jsx("div",{className:"relative min-h-[48px]",children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:W("A")})})]})]})})}function hs({label:t,fixtures:o,picksByFixture:i,members:l,outcomes:n,liveScores:m,submittedMap:x,picksGw:s,isApiTestLeague:c=!1,isFirstSection:p=!1,hasLiveGames:g=!1,allGamesFinished:j=!1,allSubmitted:b=!1,resultsPublished:f=!1,deadlinePassed:h=!1,whoDidntSubmit:M=[],liveFixturesCount:v,hasStarted:U=!1}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(Qs,{date:t,className:"text-lg font-normal"}),p&&e.jsxs(e.Fragment,{children:[c&&g&&v!==void 0&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),e.jsxs("span",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:v}),e.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),e.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:o.length})]})]}),c&&j&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),c&&!U&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!c&&(fetch("http://127.0.0.1:7242/ingest/8bc20b5f-9829-459c-9363-d6e04fa799c7",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"LeagueFixtureSection.tsx:79",message:"Checking Round Complete conditions",data:{isApiTestLeague:c,allSubmitted:b,resultsPublished:f,allGamesFinished:j,shouldShow:b&&f&&j},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H3"})}).catch(()=>{}),b&&f&&j)&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!c&&b&&!f&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!c&&h&&!b&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",M.length>0&&`(${M.join(", ")} didn't submit)`]})]})]}),e.jsx("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 overflow-hidden",children:e.jsxs("ul",{children:[o.map(L=>{try{const W=i.get(L.fixture_index)??[],G=n.get(L.fixture_index)||null,C=m[L.fixture_index]||null;return e.jsx(Wa,{fixture:L,picks:W,members:l,outcome:G,liveScore:C,submittedMap:x,picksGw:s,isApiTestLeague:c},`${L.gw}-${L.fixture_index}`)}catch(W){return console.error("Error rendering fixture:",W,L),e.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",L.fixture_index]},`${L.gw}-${L.fixture_index}`)}}),!o.length&&e.jsx("li",{className:"p-4 text-slate-500 dark:text-slate-400",children:"No fixtures."})]})})]})}function Ga({code:t,defaultTab:o="chat"}){const[i,l]=ea(),[n,m]=a.useState(o),[x,s]=a.useState(null),c=a.useRef(n),p=a.useRef(!1),g=a.useRef(!1);a.useEffect(()=>{c.current=n},[n]),a.useEffect(()=>{if(p.current||g.current)return;const f=i.get("tab"),h=i.get("leagueCode");s(null);const M=f==="chat"||f==="mlt"||f==="gw"||f==="gwr";if(!M&&!h)return;if(h&&t&&h.toUpperCase()!==t.toUpperCase()){s(`Deep link mismatch: URL has leagueCode=${h} but we're on league ${t}. URL: ${window.location.href}`);return}M&&c.current!==f&&m(f),p.current=!0;const v=new URLSearchParams(i);v.delete("tab"),v.delete("leagueCode"),v.toString()!==i.toString()&&l(v,{replace:!0})},[i,l,t]);const j=a.useCallback(f=>{g.current=!0,m(f)},[]),b=a.useCallback(()=>{g.current=!0},[]);return{tab:n,setTab:j,deepLinkError:x,markManualTabSelection:b}}function qa(){const t=a.useRef(null);return a.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const o=()=>{const m=t.current;if(!m)return;const x=m.style.top||window.getComputedStyle(m).top;x!=="0px"&&x!=="0"&&(m.style.top="0",m.style.transform="translate3d(0, 0, 0)")},i=()=>{o(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},l=m=>{const x=m.target;x.closest(".league-content-wrapper")||x.closest(".league-header-fixed")||x.closest(".chat-tab-wrapper")||m.preventDefault()};window.addEventListener("scroll",i,{passive:!0}),document.addEventListener("touchmove",l,{passive:!1});const n=window.setInterval(o,100);return o(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",i),document.removeEventListener("touchmove",l),clearInterval(n)}},[]),a.useEffect(()=>{const o=l=>{const n=l.target;(n.tagName==="INPUT"||n.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const m=t.current;m&&(m.style.top="0")},100)},i=()=>{const l=t.current;l&&(l.style.top="0")};return document.addEventListener("focusin",o),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),()=>{document.removeEventListener("focusin",o),window.removeEventListener("resize",i),window.removeEventListener("orientationchange",i)}},[]),a.useEffect(()=>{const o=window.visualViewport;if(!o)return;let i=null;const l=()=>{const m=t.current;if(!m)return;const x=o.offsetTop??0;m.style.setProperty("transform",`translate3d(0, ${x}px, 0)`,"important")},n=()=>{i&&cancelAnimationFrame(i),i=window.requestAnimationFrame(l)};return n(),o.addEventListener("resize",n),o.addEventListener("scroll",n),()=>{i&&cancelAnimationFrame(i),o.removeEventListener("resize",n),o.removeEventListener("scroll",n),t.current&&t.current.style.removeProperty("transform")}},[]),{headerRef:t}}function Ja({code:t,userId:o}){const[i,l]=a.useState(()=>{if(!t)return null;try{return le(`leagues:${o||""}`)?.find(h=>h.code.toUpperCase()===t.toUpperCase())??null}catch{return null}}),[n,m]=a.useState(()=>{if(!i?.id)return[];try{const b=le(`league:members:${i.id}`);if(b?.length)return b.map(([f,h])=>({id:f,name:h||"(no name)"}))}catch{}return[]}),[x,s]=a.useState(()=>!i),[c,p]=a.useState(null);a.useEffect(()=>{let b=!0;return(async()=>{if(!t){if(!b)return;l(null),m([]),s(!1);return}let f=i;if(!f){const{data:h}=await B.from("leagues").select("id,name,code,created_at,avatar").eq("code",t).maybeSingle();if(!b)return;if(!h){l(null),m([]),s(!1);return}f=h,l(f)}if(f?.id&&n.length===0){const{data:h}=await B.from("league_members").select("users(id,name),created_at").eq("league_id",f.id).order("created_at",{ascending:!0}),v=[...h?.map(U=>({id:U.users.id,name:U.users.name??"(no name)"}))??[]].sort((U,L)=>U.name.localeCompare(L.name));if(!b)return;m(v),Ke(`league:members:${f.id}`,v.map(U=>[U.id,U.name]),300)}b&&s(!1)})(),()=>{b=!1}},[t]),a.useEffect(()=>{p(n.length?n[0]:null)},[n]);const g=a.useMemo(()=>!!o&&n.some(b=>b.id===o),[o,n]),j=a.useMemo(()=>!!o&&!!c&&c.id===o,[o,c]);return{league:i,members:n,firstMember:c,isMember:g,isAdmin:j,loading:x,setLeague:l,setMembers:m}}function Va(t){return t.result==="H"||t.result==="D"||t.result==="A"?t.result:typeof t.home_goals=="number"&&typeof t.away_goals=="number"?t.home_goals>t.away_goals?"H":t.home_goals<t.away_goals?"A":"D":null}function Ka({members:t,picks:o,results:i,liveScores:l,resGw:n,currentGw:m,isApiTestLeague:x,currentTestGw:s}){const c=new Map;(x?n===s:n===m&&Object.keys(l).length>0)?Object.entries(l).forEach(([b,f])=>{const h=Number(b);Number.isFinite(h)&&(f.status!=="IN_PLAY"&&f.status!=="PAUSED"&&f.status!=="FINISHED"||(f.homeScore>f.awayScore?c.set(h,"H"):f.awayScore>f.homeScore?c.set(h,"A"):c.set(h,"D")))}):i.forEach(b=>{if(b.gw!==n)return;const f=Va(b);f&&c.set(b.fixture_index,f)});const g=t.map(b=>({user_id:b.id,name:b.name,score:0,unicorns:0})),j=new Map;return o.forEach(b=>{if(b.gw!==n)return;const f=j.get(b.fixture_index)??[];f.push(b),j.set(b.fixture_index,f)}),Array.from(c.entries()).forEach(([b,f])=>{const M=(j.get(b)??[]).filter(v=>v.pick===f).map(v=>v.user_id);if(M.forEach(v=>{const U=g.find(L=>L.user_id===v);U&&(U.score+=1)}),M.length===1&&t.length>=3){const v=g.find(U=>U.user_id===M[0]);v&&(v.unicorns+=1)}}),g.sort((b,f)=>f.score-b.score||f.unicorns-b.unicorns||b.name.localeCompare(f.name)),g}const Tt=8;function At(t){return t.result==="H"||t.result==="D"||t.result==="A"?t.result:typeof t.home_goals=="number"&&typeof t.away_goals=="number"?t.home_goals>t.away_goals?"H":t.home_goals<t.away_goals?"A":"D":null}function Za(){const t=a.useRef(0);t.current=0;const{code:o=""}=ta();t.current++;const{user:i}=xs();t.current++;const{currentGw:l}=sa();t.current++;const[n]=a.useState(()=>{const r=localStorage.getItem("oldSchoolMode");return r?JSON.parse(r):!1});t.current++,a.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(n))},[n]),t.current++;const{headerRef:m}=qa(),x=()=>{if(!o)return null;try{const r=le(`leagues:${i?.id||""}`);if(r){const u=r.find(d=>d.code.toUpperCase()===o.toUpperCase());if(u)return u}}catch{}return null},{league:s,members:c,firstMember:p,isMember:g,isAdmin:j,loading:b,setLeague:f}=Ja({code:o,userId:i?.id});t.current++;const[h,M]=a.useState(!1);t.current++;const{tab:v,setTab:U,deepLinkError:L}=Ga({code:o}),W=a.useRef(null);a.useEffect(()=>{if(W.current!==null&&W.current!==v)try{const r=localStorage.getItem("message_subscription_logs"),u=r?JSON.parse(r):[];u.push({timestamp:Date.now(),leagueId:s?.id,status:"TAB_CHANGED",channel:`league-messages:${s?.id}`,from:W.current,to:v,reason:`Tab changed from "${W.current}" to "${v}"`});const d=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(d))}catch(r){console.error("[LeaguePage] Failed to log tab change:",r)}W.current=v},[v,s?.id]);const G=a.useRef(null);a.useEffect(()=>{if(G.current!==null&&G.current!==s?.id)try{const r=localStorage.getItem("message_subscription_logs"),u=r?JSON.parse(r):[];u.push({timestamp:Date.now(),leagueId:s?.id,status:"LEAGUE_ID_CHANGED",channel:`league-messages:${s?.id}`,from:G.current,to:s?.id,reason:`League ID changed from "${G.current}" to "${s?.id}"`});const d=u.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(d))}catch(r){console.error("[LeaguePage] Failed to log league ID change:",r)}G.current=s?.id??null},[s?.id]),a.useEffect(()=>{const r=Date.now();try{const u=localStorage.getItem("message_subscription_logs"),d=u?JSON.parse(u):[],w={timestamp:Date.now(),leagueId:s?.id,status:"LEAGUE_PAGE_MOUNT",channel:`league-messages:${s?.id}`,pageId:r,tab:v,reason:"LeaguePage component mounted"};d.push(w);const y=d.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(y))}catch(u){console.error("[LeaguePage] Failed to log mount:",u)}return()=>{try{const u=localStorage.getItem("message_subscription_logs"),d=u?JSON.parse(u):[],w={timestamp:Date.now(),leagueId:s?.id,status:"LEAGUE_PAGE_UNMOUNT",channel:`league-messages:${s?.id}`,pageId:r,tab:v,reason:"LeaguePage component unmounting"};d.push(w);const y=d.slice(-50);localStorage.setItem("message_subscription_logs",JSON.stringify(y))}catch(u){console.error("[LeaguePage] Failed to log unmount:",u)}}},[]),t.current++;const C=a.useRef(v);t.current++,a.useEffect(()=>{C.current=v},[v]),t.current++;const ee=a.useRef(!1);t.current++;const ue=a.useRef(!1);t.current++;const[me,he]=a.useState(!1),[ve,we]=a.useState(!1),[Se,Ee]=a.useState(!1),Me=()=>{try{return le("app_meta:current_gw")?.current_gw??null}catch{return null}},[N,Z]=a.useState(Me),[E,se]=a.useState(null),[q,ce]=a.useState(Me),re=()=>{try{return le("app:available_gws")??[]}catch{return[]}},[z,k]=a.useState(()=>re()),D=a.useRef({}),R=a.useRef({}),K=a.useRef(new Map),xe=a.useRef(new Map),[De,Pt]=a.useState(new Set),[dt,ps]=a.useState(!1),[bs,ze]=a.useState(!1),[ut,ws]=a.useState(0),[ys,It]=a.useState(!1),[vs,$t]=a.useState(!1),[ks,We]=a.useState(!1),[$e,Ye]=a.useState(!1),[Xe,ke]=a.useState(null),[js,Pe]=a.useState(!1),[Re,Ue]=a.useState(null),[_s,Ut]=a.useState({x:0,y:0}),[mt,ft]=a.useState(1),[Ze,Ft]=a.useState(null),[Ce,Ge]=a.useState(null),[qe,Fe]=a.useState(!1);t.current++;const[Je,Qe]=a.useState(!1);t.current++;const[Ns,et]=a.useState(!1);t.current++;const[ht,tt]=a.useState(!1);t.current++;const[st,Be]=a.useState(!1),[Ss,gt]=a.useState(!1),[Cs,xt]=a.useState(!1),[at,Bt]=a.useState(null),[pt,Ot]=a.useState(!1),[bt,Ht]=a.useState(!1),Es=a.useMemo(()=>p?.name??"League admin",[p]),Ls=a.useMemo(()=>{const r=new Map;return c.forEach(u=>r.set(u.id,u.name)),r.set(ct,gs),r},[c]),Ms=a.useCallback(()=>{if(!s?.code||typeof window>"u"||typeof navigator>"u")return;const r=`Join my mini league "${s.name}" on TotL!`,u=`${window.location.origin}/league/${s.code}`,d=navigator;if(typeof d.share=="function"){d.share({title:`Join ${s.name}`,text:r,url:u}).catch(()=>{});return}const w=`${r}
${u}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(w).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",s.code)}):window.prompt?.("Share this league code:",s.code)},[s]),Rs=a.useCallback(async()=>{if(!(!s?.id||!i?.id)){Ee(!0);try{const{error:r}=await B.from("league_members").delete().eq("league_id",s.id).eq("user_id",i.id);if(r)throw r;typeof window<"u"&&(window.location.href="/leagues")}catch(r){typeof window<"u"&&window.alert?.(r?.message??"Failed to leave league. Please try again.")}finally{Ee(!1),we(!1)}}},[s?.id,i?.id]),Ts=a.useCallback(async()=>{if(!(!s?.id||!i?.id)){tt(!0);try{if((await aa(i.id)).length>=20){typeof window<"u"&&window.alert?.("You're already in 20 mini-leagues, which is the maximum. Leave a league before joining another."),et(!1),tt(!1);return}const u=l;if(u!==null){const y=await Et({id:s.id,name:s.name,created_at:s.created_at},u);if(u-y>=4){typeof window<"u"&&window.alert?.("This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."),et(!1),tt(!1);return}}if(c.length>=Tt){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),et(!1);return}const{error:d}=await B.from("league_members").insert({league_id:s.id,user_id:i.id});if(d)throw d;const w=i.user_metadata?.display_name||i.email||"Someone";try{const y=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:s.id,userId:i.id,userName:w})}),P=await y.text();try{P&&JSON.parse(P)}catch{}y.ok}catch{}typeof window<"u"&&window.location.reload()}catch(r){typeof window<"u"&&window.alert?.(r?.message??"Failed to join league.")}finally{tt(!1)}}},[s?.id,s?.name,s?.created_at,i?.id,c.length,l]),As=a.useCallback(async()=>{if(!(!at||!s?.id||!i?.id)){Ot(!0);try{const{error:r}=await B.from("league_members").delete().eq("league_id",s.id).eq("user_id",at.id);if(r)throw r;typeof window<"u"&&window.location.reload()}catch(r){typeof window<"u"&&window.alert?.(r?.message??"Failed to remove member.")}finally{Ot(!1),gt(!1),Bt(null)}}},[s?.id,at,i?.id]),Ds=a.useCallback(async()=>{if(!(!s?.id||!i?.id)){Ht(!0);try{const{error:r}=await B.from("league_members").delete().eq("league_id",s.id);if(r)throw r;const{error:u}=await B.from("leagues").delete().eq("id",s.id);if(u)throw u;typeof window<"u"&&(window.location.href="/leagues")}catch(r){typeof window<"u"&&window.alert?.(r?.message??"Failed to end league.")}finally{Ht(!1),xt(!1)}}},[s?.id,i?.id]),Ps=r=>new Promise((u,d)=>{const w=new Image;w.addEventListener("load",()=>u(w)),w.addEventListener("error",y=>d(y)),w.src=r}),zt=async(r,u)=>{const d=await Ps(r),w=document.createElement("canvas"),y=w.getContext("2d");if(!y)throw new Error("No 2d context");return w.width=u.width,w.height=u.height,y.drawImage(d,u.x,u.y,u.width,u.height,0,0,u.width,u.height),new Promise((P,O)=>{w.toBlob(H=>{if(!H){O(new Error("Canvas is empty"));return}P(H)},"image/jpeg",.9)})},Is=a.useCallback(r=>{if(!s?.id||!g){ke("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(r.type)){ke("Please upload a PNG, JPG, or WebP image.");return}const d=20*1024*1024;if(r.size>d){ke("Please choose an image smaller than 20MB.");return}if(ke(null),Pe(!1),r.size>5*1024*1024)as(r,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(w=>{const y=new FileReader;y.onload=()=>{Ue(y.result)},y.readAsDataURL(w)}).catch(()=>{ke("Failed to process image. Please try a smaller file.")});else{const w=new FileReader;w.onload=()=>{Ue(w.result)},w.readAsDataURL(r)}},[g,s?.id]),$s=a.useCallback(async(r,u)=>{if(Ft(u),Re)try{const d=await zt(Re,u),w=URL.createObjectURL(d);Ge(w)}catch{}},[Re]),Us=a.useCallback(async()=>{if(!(!Re||!Ze||!s?.id||!g)){ke(null),Pe(!1),Ye(!0);try{const r=await zt(Re,Ze),u=new File([r],"badge.jpg",{type:"image/jpeg"}),d=await as(u,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(d.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const w=`${s.id}-${Date.now()}.jpg`,{error:y}=await B.storage.from("league-avatars").upload(w,d,{cacheControl:"3600",upsert:!0,contentType:d.type});if(y)throw y;const{data:P}=B.storage.from("league-avatars").getPublicUrl(w),O=P?.publicUrl;if(!O)throw new Error("Unable to get public URL for badge.");const{error:H}=await B.from("leagues").update({avatar:O}).eq("id",s.id);if(H)throw H;f(ae=>ae&&{...ae,avatar:O}),Pe(!0),Ce&&URL.revokeObjectURL(Ce),Ue(null),Ge(null),We(!1),i?.id&&(Dt(i.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:s.id,avatar:O}})))}catch(r){ke(r?.message??"Failed to upload badge. Please try again.")}finally{Ye(!1)}}},[Re,Ze,g,s?.id,i?.id]),Fs=a.useCallback(async()=>{if(!(!s?.id||!g)){ke(null),Pe(!1),Ye(!0);try{const{error:r}=await B.from("leagues").update({avatar:null}).eq("id",s.id);if(r)throw r;f(u=>u&&{...u,avatar:null}),Pe(!0),i?.id&&(Dt(i.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:s.id,avatar:null}})))}catch(r){ke(r?.message??"Failed to remove badge. Please try again.")}finally{Ye(!1)}}},[g,s?.id]),[Wt,Bs]=a.useState(new Map);a.useEffect(()=>{(async()=>{const r=new Map,{data:u}=await B.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:d}=await B.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),w=new Map;if(u&&u.forEach(y=>{(!w.has(y.gw)||y.kickoff_time&&new Date(y.kickoff_time)<new Date(w.get(y.gw)))&&y.kickoff_time&&w.set(y.gw,y.kickoff_time)}),d&&d.length>0){const y=d.find(P=>P.kickoff_time)?.kickoff_time;if(y){const P=w.get(1);(!P||new Date(y)<new Date(P))&&w.set(1,y)}}w.forEach((y,P)=>{const O=new Date(y),H=new Date(O.getTime()-4500*1e3);r.set(P,H)}),Bs(r)})()},[]),a.useEffect(()=>{const r=u=>{const d=u.target;dt&&!d.closest(".gw-dropdown-container")&&ps(!1)};return dt&&document.addEventListener("click",r),()=>document.removeEventListener("click",r)},[dt]),a.useEffect(()=>{let r=!0;return(async()=>{const{data:u}=await B.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!r)return;Z(u?.current_gw??null);const{data:d}=await B.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!r)return;se(d&&d.length?d[0].gw:null);const{data:w}=await B.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!r)return;const y=w?[...new Set(w.map(O=>O.gw))].sort((O,H)=>H-O):[],P=u?.current_gw;P&&!y.includes(P)&&y.unshift(P),k(y),(y.length>0&&!q||y.length>0&&q&&!y.includes(q))&&ce(y[0])})(),()=>{r=!1}},[ut]);const Os=a.useMemo(()=>c.map(r=>r.id).sort().join(","),[c]),Te=a.useMemo(()=>c.map(r=>r.id),[Os]),[fe,Gt]=a.useState([]);t.current++;const[qt,wt]=a.useState([]);t.current++;const[Jt,yt]=a.useState([]);t.current++;const[rt,vt]=a.useState([]);t.current++,a.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[v]),t.current++;const{state:kt}=Oe(N);t.current++;const nt=a.useMemo(()=>s?.name==="API Test",[s?.name]),[ye,Vt]=a.useState(null);t.current++;const jt=a.useMemo(()=>s?s.name==="API Test"?ye??1:ue.current&&q||!N?q:kt==="LIVE"||kt==="RESULTS_PRE_GW"?N:E&&E<N?E:N>1?N-1:N:N||q||null,[s?.name,ye,q,N,kt,E]);t.current++;const{state:Hs}=Oe(jt??null);t.current++;const Ve=a.useRef(""),Kt=a.useRef(0),Yt=a.useMemo(()=>{const r=fe?.length||0;if(r===Kt.current&&Ve.current&&(fe?.map(w=>w.api_match_id).filter(w=>w!=null).sort().join(",")||"")===Ve.current)return Ve.current;if(Kt.current=r,!fe||fe.length===0)return Ve.current="","";const u=fe.map(d=>d.api_match_id).filter(d=>d!=null).sort().join(",");return Ve.current=u,u},[fe]);a.useEffect(()=>{if(!nt){Vt(null);return}let r=!0;return(async()=>{const{data:u}=await B.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let d=u?.current_test_gw??1;if(d&&d!==1){const{data:w}=await B.from("app_fixtures").select("gw").eq("gw",d).limit(1).maybeSingle();if(!w){const{data:y}=await B.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();y&&(d=1)}}r&&Vt(d)})(),()=>{r=!1}},[nt]);const zs=a.useMemo(()=>nt&&ye!==null?ye:N||q||void 0,[nt,ye,N,q]),_t=a.useRef({key:"",array:void 0}),Ws=a.useMemo(()=>{const r=Yt||"";if(_t.current.key===r)return _t.current.array;const u=r?r.split(",").map(d=>parseInt(d,10)).filter(d=>!isNaN(d)):void 0;return _t.current={key:r,array:u},u},[Yt]),{liveScores:Xt}=ra(zs,Ws),pe=a.useMemo(()=>{const r={};if(!fe||fe.length===0)return Object.keys(R.current).length===0?R.current:(R.current=r,r);fe.forEach(P=>{const O=P.api_match_id;if(O){const H=Xt.get(O);H&&(r[P.fixture_index]={homeScore:H.home_score??0,awayScore:H.away_score??0,status:H.status||"SCHEDULED",minute:H.minute??null})}});const u=R.current,d=Object.keys(r).map(Number),w=Object.keys(u).map(Number);if(d.length!==w.length)return R.current=r,r;let y=!1;for(const P of d){const O=r[P],H=u[P];if(!H||O.homeScore!==H.homeScore||O.awayScore!==H.awayScore||O.status!==H.status||O.minute!==H.minute){y=!0;break}}return y?(R.current=r,r):u},[Xt,fe]),Gs=()=>{try{const r=typeof window<"u"&&localStorage.getItem("debug:verbose")==="true";if(r&&console.log("[League] getInitialMltRows called",{code:o,userId:i?.id}),o&&i?.id){const d=le(`leagues:${i.id}`);if(r&&console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!d,length:d?.length}),d&&Array.isArray(d)){const w=d.find(y=>y.code.toUpperCase()===o.toUpperCase());if(r&&console.log("[League] getInitialMltRows - found league",{found:!!w,leagueId:w?.id}),w?.id){const y=`league:mltRows:${w.id}`,P=le(y);if(r&&console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!P,length:P?.length,cacheKey:y,cachedType:typeof P,isArray:Array.isArray(P),rawCache:P}),P&&Array.isArray(P)&&P.length>0)return r&&console.log("[League] âœ… getInitialMltRows returning cached rows",P.length),P;r&&console.log("[League] âŒ Cache check failed",{cached:!!P,isArray:Array.isArray(P),length:P?.length,cacheKey:y})}}}const u=x();if(r&&console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!u,leagueId:u?.id}),u?.id){const d=le(`league:mltRows:${u.id}`);if(r&&console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!d,length:d?.length}),d&&Array.isArray(d)&&d.length>0)return r&&console.log("[League] âœ… getInitialMltRows returning cached rows from initialLeague",d.length),d}if(o&&i?.id){const d=le(`leagues:${i.id}`);if(d&&Array.isArray(d)){for(const w of d)if(w.code?.toUpperCase()===o.toUpperCase()&&w.id){const y=le(`league:mltRows:${w.id}`);if(y&&Array.isArray(y)&&y.length>0)return r&&console.log("[League] âœ… getInitialMltRows returning cached rows from strategy 3",y.length),y}}}r&&console.log("[League] âš ï¸ getInitialMltRows returning empty array - cache miss")}catch(r){console.error("[League] âŒ getInitialMltRows error",r)}return[]},[je,Le]=a.useState(Gs);a.useEffect(()=>{console.log("[League] Tab changed to:",v,"mltRows.length:",je.length)},[v,je.length]),a.useEffect(()=>{if(s?.id){const r=`league:mltRows:${s.id}`,u=le(r);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:s.id,cacheKey:r,hasCached:!!u,cachedLength:u?.length,currentMltRowsLength:je.length}),u&&u.length>0)je.length===0?(console.log("[League] âœ… Setting mltRows from cache",u.length),Le(u)):console.log("[League] mltRows already populated, skipping");else{console.log("[League] âš ï¸ No cached mltRows found - will retry multiple times");let d=0;const w=10,y=[50,100,150,200,250,300,400,500,600,800],P=()=>{if(d>=w){console.log("[League] âŒ Max retries reached, giving up on cache");return}const H=setTimeout(()=>{d++;const ae=le(r);ae&&ae.length>0&&je.length===0?(console.log(`[League] âœ… Retry ${d} successful - Setting mltRows from cache`,ae.length),Le(ae)):d<w&&P()},y[d]||800);return()=>clearTimeout(H)};return P()}}else console.log("[League] âš ï¸ No league.id available yet")},[s?.id,je.length]),a.useEffect(()=>{},[s,v]),a.useEffect(()=>{let r=!0;return(async()=>{const u=s?.name==="API Test";let d=ye??1;if(u){const{data:T}=await B.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(d=T?.current_test_gw??1,d&&d!==1){const{data:F}=await B.from("app_fixtures").select("gw").eq("gw",d).limit(1).maybeSingle();if(!F){const{data:V}=await B.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();V&&(d=1)}}}const w=u&&(v==="gw"||v==="gwr");let y=null;if(v==="gwr")if(ue.current&&q)y=q;else if(N)try{const T=await na(N);T==="LIVE"||T==="RESULTS_PRE_GW"?y=N:E&&E<N?y=E:y=N>1?N-1:N}catch(T){console.error("[League] Error checking game state for fixtures loading:",T),E&&E<N?y=E:y=N>1?N-1:N}else y=q;else y=N;if(u&&(v==="gw"||v==="gwr")&&(y=d),v==="gw"&&!u&&Te.length>0){const{data:T}=await B.from("app_gw_submissions").select("gw").in("user_id",Te).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(T&&T.length>0){const F=[...new Set(T.map(V=>V.gw))].sort((V,I)=>(I||0)-(V||0));for(const V of F)if(V){const{data:I}=await B.from("app_fixtures").select("gw").eq("gw",V).limit(1);if(I&&I.length>0){y=V;break}}}!y&&N&&(y=N)}if(!y&&!w){Gt([]),wt([]),yt([]),vt([]);return}let P;if(w){const{data:T}=await B.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",d).order("fixture_index",{ascending:!0});P=T?.map(F=>({...F,gw:F.test_gw}))||null}else{const{data:T}=await B.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",y).order("fixture_index",{ascending:!0});P=T||null}if(!r)return;if(Gt(T=>{const F=P??[];return T.length!==F.length?F:T.length===0&&F.length===0?T:T.some((I,$)=>!F[$]||I.id!==F[$].id||I.fixture_index!==F[$].fixture_index)||F.some((I,$)=>!T[$]||I.id!==T[$].id||I.fixture_index!==T[$].fixture_index)?F:T}),!Te.length){wt([]),yt([]),vt([]);return}let O=null,H;if(w){const{data:T}=await B.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",d).in("user_id",Te);O=T?.map(A=>({...A,gw:A.matchday}))||null;const{data:F,error:V}=await B.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",d).not("submitted_at","is",null).in("user_id",Te),{data:I}=await B.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",d).order("fixture_index",{ascending:!0}),$=new Set((I||[]).map(A=>A.fixture_index)),S=[];if(F&&O&&I){const A=$.size,Y=new Date("2025-11-18T00:00:00Z");F.forEach(X=>{const ne=(O||[]).filter(de=>de.user_id===X.user_id&&de.matchday===d).filter(de=>$.has(de.fixture_index)),_e=ne.length===A&&A>0,_=new Set(ne.map(de=>de.fixture_index)).size===A,te=X.submitted_at?new Date(X.submitted_at):null,ie=te&&te>=Y;_e&&_&&ie&&S.push(X)})}H=S.map(A=>({...A,gw:A.matchday}))||null}else{const{data:T}=await B.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",y).in("user_id",Te);O=T;const{data:F}=await B.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",y).in("user_id",Te);H=F}if(!r)return;wt(T=>{const F=O??[];if(T.length!==F.length)return F;if(T.length===0&&F.length===0)return T;const V=JSON.stringify(T.sort(($,S)=>$.fixture_index-S.fixture_index)),I=JSON.stringify(F.sort(($,S)=>$.fixture_index-S.fixture_index));return V===I?T:F}),yt(T=>{const F=H??[];if(T.length!==F.length)return F;if(T.length===0&&F.length===0)return T;const V=JSON.stringify(T),I=JSON.stringify(F);return V===I?T:F});const{data:ae}=await B.from("app_gw_results").select("gw,fixture_index,result").eq("gw",w?1:y||0);r&&vt(T=>{const F=ae??[];if(T.length!==F.length)return F;if(T.length===0&&F.length===0)return T;const V=JSON.stringify(T.sort(($,S)=>$.fixture_index-S.fixture_index)),I=JSON.stringify(F.sort(($,S)=>$.fixture_index-S.fixture_index));return V===I?T:F})})(),()=>{r=!1}},[v,N,E,q,Te]),a.useEffect(()=>{D.current=pe},[pe]);const Ae=a.useMemo(()=>{const r=new Map;return Jt.forEach(u=>{if(u.submitted_at){const d=`${u.user_id}:${u.gw}`;r.set(d,!0)}}),r},[Jt]),ot=a.useCallback(r=>r.map(u=>({user_id:u.id,name:u.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);a.useEffect(()=>{const r=B.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{ws(u=>u+1)}).subscribe();return()=>{B.removeChannel(r)}},[]),a.useEffect(()=>{let r=!0;return(async()=>{const u=ut>0,d=je.length>0&&je.every(_=>_.wins===0&&_.draws===0),w=u||d;if(!w&&je.length>0)return;if(!w&&s?.id){const _=le(`league:mltRows:${s.id}`);if(_&&_.length>0){Le(_);return}}if(!c.length){le(`league:mltRows:${s?.id||""}`)||Le([]);return}if(s?.name==="API Test"){Le(ot(c));return}if(!w){const _=s?.id&&le(`league:mltRows:${s.id}`);if(_&&_.length>0){Le(_);return}}if(N===null)return;const{data:y}=await B.from("app_gw_results").select("gw,fixture_index,result"),P=y??[],O=new Map;if(P.forEach(_=>{const te=At(_);te&&O.set(`${_.gw}:${_.fixture_index}`,te)}),O.size===0){Le(ot(c));return}const H=[...new Set(Array.from(O.keys()).map(_=>parseInt(_.split(":")[0],10)))].sort((_,te)=>_-te),ae=["Prem Predictions","FC Football","Easy League"],T=["The Bird league"],F=await Et(s,N);let V=H.filter(_=>_>=F);if(N!==null&&V.includes(N)){const{data:_}=await B.from("app_fixtures").select("fixture_index").eq("gw",N),te=_?.length??0,ie=Array.from(O.keys()).filter(de=>parseInt(de.split(":")[0],10)===N).length;te>0&&ie<te&&(V=V.filter(de=>de<N))}else N!==null&&(V=V.filter(_=>_<N));if(!ae.includes(s?.name||"")&&!T.includes(s?.name||"")&&V.length===0){Le(ot(c));return}const{data:I}=await B.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",c.map(_=>_.id)).in("gw",V),$=I??[],S=new Map;V.forEach(_=>{const te=new Map;c.forEach(ie=>te.set(ie.id,{user_id:ie.id,score:0,unicorns:0})),S.set(_,te)}),V.forEach(_=>{Array.from(O.entries()).filter(([ie])=>parseInt(ie.split(":")[0],10)===_).map(([ie,de])=>({idx:parseInt(ie.split(":")[1],10),out:de})).forEach(({idx:ie,out:de})=>{const Q=$.filter(Ne=>Ne.gw===_&&Ne.fixture_index===ie),be=Q.filter(Ne=>Ne.pick===de).map(Ne=>Ne.user_id),Qt=S.get(_);if(Q.forEach(Ne=>{if(Ne.pick===de){const St=Qt.get(Ne.user_id);St.score+=1}}),be.length===1&&c.length>=3){const Ne=be[0],St=Qt.get(Ne);St.unicorns+=1}})});const A=new Map,Y=new Map,X=new Map,J=new Map,ne=new Map,_e=new Map;c.forEach(_=>{A.set(_.id,0),Y.set(_.id,0),X.set(_.id,0),J.set(_.id,0),ne.set(_.id,0),_e.set(_.id,[])}),V.forEach(_=>{const te=Array.from(S.get(_).values());if(te.forEach(Q=>{Y.set(Q.user_id,(Y.get(Q.user_id)??0)+Q.score),X.set(Q.user_id,(X.get(Q.user_id)??0)+Q.unicorns)}),te.sort((Q,be)=>be.score-Q.score||be.unicorns-Q.unicorns),!te.length)return;const ie=te[0],de=te.filter(Q=>Q.score===ie.score&&Q.unicorns===ie.unicorns);de.length===1?(A.set(ie.user_id,(A.get(ie.user_id)??0)+3),J.set(ie.user_id,(J.get(ie.user_id)??0)+1),_e.get(ie.user_id).push("W"),te.slice(1).forEach(Q=>_e.get(Q.user_id).push("L"))):(de.forEach(Q=>{A.set(Q.user_id,(A.get(Q.user_id)??0)+1),ne.set(Q.user_id,(ne.get(Q.user_id)??0)+1),_e.get(Q.user_id).push("D")}),te.filter(Q=>!de.find(be=>be.user_id===Q.user_id)).forEach(Q=>_e.get(Q.user_id).push("L")))});const oe=c.map(_=>({user_id:_.id,name:_.name,mltPts:A.get(_.id)??0,ocp:Y.get(_.id)??0,unicorns:X.get(_.id)??0,wins:J.get(_.id)??0,draws:ne.get(_.id)??0,form:_e.get(_.id)??[]}));oe.sort((_,te)=>te.mltPts-_.mltPts||te.unicorns-_.unicorns||te.ocp-_.ocp||_.name.localeCompare(te.name)),r&&(Le(oe),s?.id&&Ke(`league:mltRows:${s.id}`,oe,lt.LEAGUES))})(),()=>{r=!1}},[c,s,N,ot,ut]);const Zt=a.useCallback(async()=>{if(!s||!l){Fe(!0);return}try{const r=await Et({id:s.id,name:s.name,created_at:s.created_at},l);if(l-r>=4){Qe(!0);return}Fe(!0)}catch(r){console.error("[League] Error checking league lock status:",r),Fe(!0)}},[s,l]);function Nt(){return e.jsxs("div",{className:"text-center p-8 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("img",{src:"/assets/Volley/volley-with-ball.png",alt:"Volley",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 font-bold",children:"Share your league code with friends to kick things off."}),e.jsx("button",{onClick:Zt,className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]})}function qs(){const r=a.useRef(null);if(a.useEffect(()=>{if(!Je)return;const d=w=>{w.key==="Escape"&&Qe(!1)};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[Je]),a.useEffect(()=>(Je?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[Je]),!Je)return null;const u=d=>{d.target===d.currentTarget&&Qe(!1)};return is.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:r,className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:u,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999}}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"league-locked-error-title",onClick:u,style:{zIndex:1e6},children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-800 px-8 py-8 text-center shadow-2xl max-w-sm w-full",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-red-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-amber-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{id:"league-locked-error-title",className:"text-2xl font-extrabold text-amber-600",children:"League Locked"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"This league has been running for more than 4 gameweeks. New members can only be added during the first 4 gameweeks."}),e.jsx("button",{onClick:()=>Qe(!1),className:"mt-4 px-6 py-2.5 bg-[#1C8376] text-white rounded-lg font-semibold hover:bg-[#156d63] transition-colors",children:"OK"})]})]})})]}),document.body)}function Js(){const[r,u]=a.useState(""),d=a.useRef(null),w=a.useRef(null);a.useEffect(()=>{if(!qe)return;const T=F=>{F.key==="Escape"&&Fe(!1)};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[qe]);const y=T=>{T.target===T.currentTarget&&Fe(!1)};if(a.useEffect(()=>(qe?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[qe]),!qe||!s)return null;const P=T=>{u(T),window.clearTimeout(P._t),P._t=window.setTimeout(()=>u(""),1600)},O=async()=>{try{await navigator.clipboard.writeText(s.code),P("Code copied")}catch{try{const F=document.createElement("textarea");F.value=s.code,document.body.appendChild(F),F.select(),document.execCommand("copy"),document.body.removeChild(F),P("Code copied")}catch{P("Couldn't copy")}}},H=async()=>{if(!s?.code||typeof window>"u"||typeof navigator>"u")return;const T=`Join my mini league "${s.name}" on TotL!`,F=`${window.location.origin}/league/${s.code}`,V=navigator;if(typeof V.share=="function")try{await V.share({title:`Join ${s.name}`,text:T,url:F});return}catch{return}const I=`${T}
${F}`;try{await navigator.clipboard.writeText(I),P("Share text copied")}catch{P("Couldn't share")}},ae=e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:d,className:"fixed inset-0 bg-black/50",onClick:y,"aria-hidden":"true",style:{animation:"fadeIn 200ms ease-out",zIndex:999999,touchAction:"manipulation"}}),e.jsxs("div",{ref:w,className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 rounded-t-3xl shadow-2xl",role:"dialog","aria-modal":"true","aria-labelledby":"share-league-code-tray-title",onClick:T=>T.stopPropagation(),style:{animation:"slideUp 300ms ease-out",zIndex:1e6,touchAction:"manipulation"},children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[e.jsx("h2",{id:"share-league-code-tray-title",className:"text-lg font-medium text-slate-900 dark:text-slate-100 uppercase tracking-wide",style:{fontFamily:'"Gramatika", sans-serif',fontWeight:700},children:"Share League Code"}),e.jsx("button",{onClick:()=>Fe(!1),className:"w-8 h-8 flex items-center justify-center rounded-full","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 pb-8 max-h-[70vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-3",children:["Share this code (up to ",Tt," members):"]}),e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("code",{className:"flex-1 font-mono text-2xl font-bold text-center py-3 px-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-100",children:s.code})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:O,className:"flex-1 px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-semibold hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors",children:"Copy"}),e.jsx("button",{onClick:H,className:"flex-1 px-4 py-3 rounded-lg bg-[#1C8376] text-white font-semibold hover:bg-[#156b60] transition-colors",children:"Share"})]}),e.jsx("div",{className:`mt-3 text-xs rounded bg-slate-900 text-white px-3 py-2 text-center transition-opacity ${r?"opacity-100":"opacity-0 pointer-events-none"}`,children:r||"â€¦"}),e.jsxs("div",{className:"mt-4 text-xs text-slate-500 dark:text-slate-400 text-center",children:[c.length,"/",Tt," members"]})]})})}),e.jsx("div",{className:"flex justify-center pb-3",children:e.jsx("div",{className:"w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"})})]})]});return typeof document<"u"&&document.body?is.createPortal(ae,document.body):ae}function Vs(){const r=a.useMemo(()=>N??null,[N]);Oe(r);const u=je.length>0?je:c.length>0?c.map(O=>({user_id:O.id,name:O.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],d=["Prem Predictions","FC Football","Easy League"],w=["The Bird league"],y=["gregVjofVcarl","Let Down"],P=!!(s&&!d.includes(s.name)&&!w.includes(s.name)&&!y.includes(s.name));return c.length===1?e.jsx(Nt,{}):e.jsxs("div",{className:"pt-4",children:[e.jsx(Ia,{rows:u,members:c,showForm:me,currentUserId:i?.id,loading:!1,isLateStartingLeague:P}),e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(Da,{showForm:me,onToggle:he}),e.jsxs("button",{onClick:()=>It(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s?.name==="API Test"&&e.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:e.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function Ks(){const r=a.useMemo(()=>s?.name==="API Test"?ye??1:N??null,[s?.name,ye,N]),{state:u}=Oe(r);if(c.length===1)return e.jsx(Nt,{});if(!r)return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No current gameweek available."});if(!ls(s,r,Wt))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Predictions Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",r," predictions are not included in this league."]})]})});const d=new Map;rt.forEach(S=>{if(S.gw!==r)return;const A=At(S);A&&d.set(S.fixture_index,A)}),fe.forEach(S=>{if(S.gw!==r)return;const A=pe[S.fixture_index];A&&(A.status==="IN_PLAY"||A.status==="PAUSED"||A.status==="FINISHED")&&(A.homeScore>A.awayScore?d.set(S.fixture_index,"H"):A.awayScore>A.homeScore?d.set(S.fixture_index,"A"):d.set(S.fixture_index,"D"))});const w=a.useMemo(()=>{const S=X=>{if(!X)return"Fixtures";const J=new Date(X);return isNaN(J.getTime())?"Fixtures":J.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},A=new Map;fe.filter(X=>X.gw===r).forEach(X=>{const J=S(X.kickoff_time),ne=X.kickoff_time?new Date(X.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;A.has(J)||A.set(J,{label:J,key:ne,items:[]}),A.get(J).items.push(X)});const Y=Array.from(A.values());return Y.forEach(X=>X.items.sort((J,ne)=>J.fixture_index-ne.fixture_index)),Y.sort((X,J)=>X.key-J.key),Y},[fe,r]),y=new Set(fe.filter(S=>S.gw===r).map(S=>S.fixture_index)),P=s?.name==="API Test",O=c.length>0&&c.every(S=>Ae.get(`${S.id}:${r}`)),H=new Map;(!P||O)&&qt.forEach(S=>{if(S.gw!==r||!Ae.get(`${S.user_id}:${r}`)||!y.has(S.fixture_index))return;const Y=H.get(S.fixture_index)??[];Y.push(S),H.set(S.fixture_index,Y)});const ae=E!==null&&E>=r,T=c.filter(S=>!Ae.get(`${S.id}:${r}`)).length,F=c.filter(S=>!Ae.get(`${S.id}:${r}`)).map(S=>S.name),V=u!==null&&(u==="DEADLINE_PASSED"||u==="LIVE"||u==="RESULTS_PRE_GW"),I=P?!O:!O&&!V;return(P?!O:!O&&!V)?e.jsx(fs,{members:c,submittedMap:Ae,picksGw:r,allSubmitted:O,remaining:T,fixtures:fe.filter(S=>S.gw===r),variant:"compact"}):e.jsxs("div",{className:"mt-2 pt-2",children:[I?e.jsx(fs,{members:c,submittedMap:Ae,picksGw:r,allSubmitted:O,remaining:T,fixtures:fe.filter(S=>S.gw===r),variant:"full"}):null,s?.name==="API Test"&&O&&w.length>0&&!I&&(()=>{const S=w.flatMap(oe=>oe.items),A=new Set(S.map(oe=>oe.fixture_index)),Y={};Object.keys(pe).forEach(oe=>{const _=parseInt(oe,10);A.has(_)&&(Y[_]=pe[_])});const X=S.some(oe=>{const _=Y[oe.fixture_index];return _&&(_.status==="IN_PLAY"||_.status==="PAUSED")}),J=S.length>0&&S.every(oe=>{const _=Y[oe.fixture_index];return _&&_.status==="FINISHED"}),ne=X||J||S.some(oe=>Y[oe.fixture_index]);let _e=0;return i?.id&&S.forEach(oe=>{const _=Y[oe.fixture_index],te=_&&(_.status==="IN_PLAY"||_.status==="PAUSED"),ie=_&&_.status==="FINISHED";if(_&&(te||ie)){const Q=(H.get(oe.fixture_index)??[]).find(be=>be.user_id===i.id);if(Q){let be=!1;(Q.pick==="H"&&_.homeScore>_.awayScore||Q.pick==="A"&&_.awayScore>_.homeScore||Q.pick==="D"&&_.homeScore===_.awayScore)&&(be=!0),be&&_e++}}}),e.jsx("div",{className:"mt-3 space-y-6",children:w.map((oe,_)=>e.jsx(hs,{label:oe.label,fixtures:oe.items,picksByFixture:H,members:c,outcomes:d,liveScores:Y,submittedMap:Ae,picksGw:r,isApiTestLeague:!0,isFirstSection:_===0,hasLiveGames:X,allGamesFinished:J,hasStarted:ne,liveFixturesCount:_e},_))})})(),w.length>0&&s?.name!=="API Test"&&(()=>{const S=rt.filter(J=>J.gw===r),A=new Set(S.map(J=>J.fixture_index)),Y=w.flatMap(J=>J.items),X=Y.length>0&&Y.every(J=>{if(A.has(J.fixture_index))return!0;const ne=pe[J.fixture_index];return ne&&ne.status==="FINISHED"});return e.jsx("div",{className:"mt-3 space-y-6",children:w.map((J,ne)=>e.jsx(hs,{label:J.label,fixtures:J.items,picksByFixture:H,members:c,outcomes:d,liveScores:pe,submittedMap:Ae,picksGw:r,isApiTestLeague:!1,isFirstSection:ne===0,allSubmitted:O,resultsPublished:ae,allGamesFinished:X,deadlinePassed:V,whoDidntSubmit:F},ne))})})(),!w.length&&!I&&e.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-500 dark:text-slate-400",children:["No fixtures for GW ",r,"."]})]})}function Ys(){const{state:r}=Oe(N),u=a.useMemo(()=>s?.name==="API Test"?ye??1:v==="gwr"?ue.current&&q||!N?q:r==="LIVE"||r==="RESULTS_PRE_GW"?N:E&&E<N?E:N>1?N-1:N:q,[s?.name,ye,v,q,N,r,E]);Oe(u);const d=u;if(c.length===1)return e.jsx(Nt,{});if(!d||z.length===0&&s?.name!=="API Test")return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:"No gameweek selected."});if(!ls(s,d,Wt))return e.jsx("div",{className:"mt-3 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm p-4 text-slate-600 dark:text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"No Results Available"}),e.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),e.jsxs("div",{className:"text-sm",children:["GW",d," results are not included in this league."]})]})});const w=new Map,y=s?.name==="API Test",P=fe.filter(I=>I.gw===d),O=P.some(I=>{const $=pe[I.fixture_index];return $&&($.status==="IN_PLAY"||$.status==="PAUSED"||$.status==="FINISHED")});y&&d===(ye??1)?P.forEach(I=>{const $=pe[I.fixture_index];$&&($.status==="IN_PLAY"||$.status==="PAUSED"||$.status==="FINISHED")&&($.homeScore>$.awayScore?w.set(I.fixture_index,"H"):$.awayScore>$.homeScore?w.set(I.fixture_index,"A"):w.set(I.fixture_index,"D"))}):O&&d===N?P.forEach(I=>{const $=pe[I.fixture_index];$&&($.status==="IN_PLAY"||$.status==="PAUSED"||$.status==="FINISHED")&&($.homeScore>$.awayScore?w.set(I.fixture_index,"H"):$.awayScore>$.homeScore?w.set(I.fixture_index,"A"):w.set(I.fixture_index,"D"))}):rt.forEach(I=>{if(I.gw!==d)return;const $=At(I);$&&w.set(I.fixture_index,$)});const H=Ka({members:c,picks:qt,results:rt,liveScores:pe,resGw:d,currentGw:N,isApiTestLeague:y,currentTestGw:ye});a.useEffect(()=>{if(H.length===0)return;const I=new Map;H.forEach((S,A)=>{I.set(S.user_id,A)});const $=new Set;if(I.forEach((S,A)=>{const Y=K.current.get(A);Y!==void 0&&Y!==S&&$.add(A)}),K.current=I,$.size>0){const S=Date.now(),A=6e3,Y=new Set;if($.forEach(J=>{const ne=xe.current.get(J)??0;S-ne>=A&&(Y.add(J),xe.current.set(J,S))}),Y.size===0)return;Pt(Y);const X=setTimeout(()=>{Pt(new Set)},2e3);return()=>clearTimeout(X)}},[H.map(I=>I.user_id).join(",")]);let ae=!1,T=!1,F=!1,V=!1;if(y&&d===(ye??1)){const I=fe;if(I.length>0&&(ae=I.every(S=>{const A=pe[S.fixture_index];return A&&A.status==="FINISHED"}),T=!!I.find(S=>{const A=pe[S.fixture_index];return A&&(A.status==="IN_PLAY"||A.status==="PAUSED")}),V=I.some(S=>{const A=pe[S.fixture_index];return A&&(A.status==="IN_PLAY"||A.status==="PAUSED"||A.status==="FINISHED")}),!ae)){const S=new Date;F=I.some(A=>{if(!A.kickoff_time)return!1;const X=new Date(A.kickoff_time).getTime()-S.getTime(),J=pe[A.fixture_index];return(!J||J.status!=="IN_PLAY"&&J.status!=="PAUSED"&&J.status!=="FINISHED")&&X>0&&X<=1440*60*1e3})}}else{const I=fe.filter($=>$.gw===d);if(I.length>0){const $=I.every(A=>w.has(A.fixture_index)),S=I.some(A=>{const Y=pe[A.fixture_index];return Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED")});ae=$&&!S}}return e.jsxs("div",{children:[e.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),H.length>0&&ae&&e.jsx(Ta,{winnerName:H[0].name,isDraw:H[0].score===H[1]?.score&&H[0].unicorns===H[1]?.unicorns}),e.jsx($a,{rows:H,members:c,currentUserId:i?.id,positionChangeKeys:De,isApiTestLeague:y,hasLiveFixtures:T,hasStartingSoonFixtures:F,hasStartedFixtures:V,allFixturesFinished:ae,resGw:d}),z.length>1&&e.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[e.jsx(Aa,{availableGws:z,selectedGw:d,onChange:I=>{ue.current=!0,ce(I)}}),e.jsxs("button",{onClick:()=>$t(!0),className:"flex items-center justify-center gap-1.5 bg-white dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-300 cursor-help flex-shrink-0 px-3 py-2",children:[e.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),e.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e.jsx(os,{isOpen:vs,onClose:()=>$t(!1),title:"Weekly Winner",description:`ðŸ† How to Win the Week

The player with the most correct predictions wins.

ðŸ¦„ Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return b?e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:e.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Loadingâ€¦"})}):!s&&!b?e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:e.jsxs("div",{className:"rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-6",children:[e.jsx("div",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"League not found"}),e.jsx(rs,{to:"/leagues",className:"text-slate-600 dark:text-slate-400 underline",children:"Back to Mini Leagues"})]})}):s?e.jsxs("div",{className:`${n?"oldschool-theme":"bg-slate-50 dark:bg-slate-900"}`,style:{position:"fixed",top:"var(--league-page-top, 0px)",left:0,right:0,bottom:0,height:"calc(100vh - var(--league-page-top, 0px))",maxHeight:"calc(100vh - var(--league-page-top, 0px))",overflow:"hidden",touchAction:"none"},children:[e.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
          --league-page-top: 0px;
        }
        /* DesktopNav is sticky top-0 with h-20 (5rem). Offset League UI below it on desktop only. */
        @media (min-width: 1024px) {
          html.league-page-active {
            --league-page-top: 5rem;
          }
        }
        .league-header-fixed {
          position: fixed !important;
          top: var(--league-page-top, 0px) !important;
          left: 0 !important;
          right: 0 !important;
          /* Keep below DesktopNav (z-50) but above League content */
          z-index: 40 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: calc(var(--league-page-top, 0px) + var(--safe-area-top, env(safe-area-inset-top, 0px))) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 3.5rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 12rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 3.5rem + 12rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 3.5rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 12rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 3.5rem + 12rem + var(--safe-area-top, env(safe-area-inset-top, 0px)) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + var(--safe-area-top, env(safe-area-inset-top, 0px)));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - var(--league-page-top, 0px) - 3.5rem - 3rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
          max-height: calc(100vh - var(--league-page-top, 0px) - 3.5rem - 3rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(var(--league-page-top, 0px) + 3.5rem + 3rem + 3.5rem + var(--safe-area-top, env(safe-area-inset-top, 0px)));
          height: calc(100vh - var(--league-page-top, 0px) - 3.5rem - 3rem - 3.5rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
          max-height: calc(100vh - var(--league-page-top, 0px) - 3.5rem - 3rem - 3.5rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - var(--league-page-top, 0px) - 3.5rem - 3rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
            max-height: calc(100dvh - var(--league-page-top, 0px) - 3.5rem - 3rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - var(--league-page-top, 0px) - 3.5rem - 3rem - 3.5rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
            max-height: calc(100dvh - var(--league-page-top, 0px) - 3.5rem - 3rem - 3.5rem - var(--safe-area-top, env(safe-area-inset-top, 0px)));
          }
        }
      `}),e.jsx("div",{ref:m,className:"league-header-fixed bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx(rs,{to:"/leagues",className:"flex items-center text-slate-600 dark:text-slate-400 -ml-2 px-2 py-1",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[e.jsx("button",{type:"button",onClick:()=>{M(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 flex-shrink-0 relative cursor-pointer",children:s?e.jsx("img",{src:Lt(s),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:r=>{const u=r.target,w=`/assets/league-avatars/${ns(s.id)}`;u.src!==w&&(u.src=w)}}):e.jsx("div",{className:"w-full h-full bg-slate-200"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 truncate",children:s.name}),q&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Gameweek ",q]})]})]}),e.jsx("div",{className:"relative",style:{zIndex:100},children:e.jsx("button",{onClick:()=>Be(!st),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),e.jsx("div",{className:`bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out overflow-hidden ${st?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-4 py-3",children:[j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 dark:border-slate-700 px-0",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Admin"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800 dark:text-white",children:Es})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("button",{onClick:()=>{ze(!0),Be(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsxs("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Manage"})]})}),e.jsx("div",{className:"my-3 border-b border-slate-200 dark:border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[g&&e.jsxs("button",{onClick:()=>{We(!0),Be(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Edit League Badge"})]}),e.jsxs("button",{onClick:async()=>{Be(!1),await Zt()},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Invite players"})]}),e.jsxs("button",{onClick:()=>{Ms(),Be(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-slate-700 dark:text-white active:bg-slate-100 dark:active:bg-slate-700 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{children:"Share league code"})]}),e.jsxs("button",{onClick:()=>{we(!0),Be(!1)},className:"w-full text-left px-0 py-2.5 text-base font-semibold text-red-600 dark:text-red-400 active:bg-red-100 dark:active:bg-red-900/30 rounded-lg flex items-center gap-2 touch-manipulation",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Leave"})]})]})]})}),e.jsxs("div",{className:`flex border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 gap-2 transition-all duration-300 ease-in-out ${st?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[e.jsxs("button",{onClick:()=>{ee.current=!0,U("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="chat"?"text-[#1C8376]":"text-slate-400 dark:text-slate-500"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Chat"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),v==="chat"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(z.length>0||s?.name==="API Test")&&e.jsxs("button",{onClick:()=>{ee.current=!0,U("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(v==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const r=jt!=null&&Hs==="LIVE";return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),v==="gwr"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(N||s?.name==="API Test")&&e.jsxs("button",{onClick:()=>{ee.current=!0,U("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="gw"?"text-[#1C8376]":"text-slate-400"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),e.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),v==="gw"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),e.jsxs("button",{onClick:()=>{ee.current=!0,U("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(v==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",v==="mlt"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),v==="chat"?e.jsx("div",{className:"chat-tab-wrapper",children:e.jsx("div",{className:"h-full w-full max-w-[1024px] mx-auto px-0 lg:px-6",children:e.jsx(Ra,{miniLeagueId:s?.id??null,memberNames:Ls,deepLinkError:L,isChatActive:v==="chat"})})}):e.jsx("div",{className:`league-content-wrapper ${st?"menu-open":""}`,children:e.jsxs("div",{className:"max-w-[1024px] mx-auto px-1 sm:px-2 lg:px-6",children:[v==="mlt"&&e.jsx(Vs,{}),v==="gw"&&e.jsx(Ks,{}),v==="gwr"&&e.jsx(Ys,{})]})}),j&&bs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>ze(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:()=>ze(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-6 pt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900 mb-6",children:"League Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),e.jsxs("div",{className:"space-y-2",children:[c.filter(r=>r.id!==i?.id).map(r=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-800",children:r.name}),e.jsx("button",{onClick:()=>{Bt(r),gt(!0),ze(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-semibold",children:"Remove"})]},r.id)),c.filter(r=>r.id!==i?.id).length===0&&e.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:()=>{xt(!0),ze(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2",children:"ðŸ—‘ï¸ End League"})})]})]})]})}),g&&ks&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{We(!1),Ce&&URL.revokeObjectURL(Ce),Ue(null),ke(null),Pe(!1),Ge(null)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:()=>{We(!1),Ce&&URL.revokeObjectURL(Ce),Ue(null),ke(null),Pe(!1),Ge(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-4 pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-1",children:"League Badge"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Upload and customize your mini-league badge"}),Re?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsx("p",{className:"font-medium",children:"Position your image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),e.jsx("div",{className:"relative w-full",style:{height:"280px"},children:e.jsx(oa,{image:Re,crop:_s,zoom:mt,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Ut,onZoomChange:ft,onCropComplete:$s,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(mt*100),"%"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:mt,onChange:r=>ft(Number(r.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Ce?e.jsx("img",{src:Ce,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),Xe&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Xe}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{Ce&&URL.revokeObjectURL(Ce),Ue(null),Ut({x:0,y:0}),ft(1),Ft(null),Ge(null)},disabled:$e,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),e.jsx("button",{onClick:Us,disabled:$e||!Ze,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:$e?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:e.jsx("img",{src:s?Lt(s):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:r=>{const u=r.target;u.src="/assets/league-avatars/ML-avatar-1.png"}})}),s?.avatar&&e.jsx("button",{onClick:Fs,disabled:$e,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:r=>{const u=r.target.files?.[0];u&&Is(u)},disabled:$e,className:"hidden",id:"badge-upload-input"}),e.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),$e&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),e.jsx("span",{children:"Processing and uploading..."})]}),js&&e.jsx("div",{className:"p-2 bg-emerald-50 border border-emerald-200 rounded-lg text-xs text-emerald-800",children:"âœ“ Badge uploaded successfully!"}),Xe&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Xe})]})]})]})]})}),e.jsx(os,{isOpen:ys,onClose:()=>It(!1),title:"League Points",description:`Win the week â€“ 3 points
Draw â€“ 1 point
Lose â€“ 0 points

ðŸ¤ Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${s&&(["The Bird league"].includes(s.name)||["gregVjofVcarl","Let Down"].includes(s.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),e.jsx(Js,{}),e.jsx(qs,{}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',s?.name,`"? You'll need the league code to rejoin later.`]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>we(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Se,children:"Cancel"}),e.jsx("button",{onClick:Rs,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Se,children:Se?"Leaving...":"Leave League"})]})]})}),Ns&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",e.jsxs("strong",{children:['"',s?.name,'"']}),". Are you sure?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>et(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:ht,children:"Cancel"}),e.jsx("button",{onClick:Ts,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:ht,children:ht?"Joining...":"Join League"})]})]})}),Ss&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",e.jsxs("strong",{children:['"',at?.name,'"']})," from the league? They will need the league code to rejoin."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>gt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:pt,children:"Cancel"}),e.jsx("button",{onClick:As,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:pt,children:pt?"Removing...":"Remove Member"})]})]})}),Cs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"âš ï¸ End League"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",e.jsx("strong",{children:"permanently end"})," the league ",e.jsxs("strong",{children:['"',s?.name,'"']}),"?"]}),e.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>xt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:bt,children:"Cancel"}),e.jsx("button",{onClick:Ds,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:bt,children:bt?"Ending...":"Yes, End League"})]})]})}),s?.name==="API Test"&&e.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"âš ï¸ Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),h&&s&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>M(!1),children:e.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:e.jsx("img",{src:Lt(s),alt:"League badge",className:"w-full h-full object-cover",onError:r=>{const u=r.target,w=`/assets/league-avatars/${ns(s.id)}`;u.src!==w&&(u.src=w)}})}),g&&e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),M(!1),We(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:e.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("div",{className:"text-white text-xl font-medium",children:s.name})]})})]}):null}export{Za as default};
