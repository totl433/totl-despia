import{r as n,j as e,u as Y,c as D,s as T}from"./index-CKJVCyNd.js";const U=n.forwardRef(({row:d,index:u,array:v,activeTab:f,isCurrentUser:j,prevRanks:p,currRanks:y},N)=>{const g="rank"in d?d.rank:u+1,C=v.filter((w,x)=>("rank"in w?w.rank:x+1)===g).length>1,l=g===1;let k="",h="bg-gray-300";if(f==="overall"){const w=p[d.user_id],x=y[d.user_id];x&&w?x<w?(k="▲",h="bg-green-500 text-white"):x>w?(k="▼",h="bg-red-500 text-white"):(k="→",h="bg-gray-500 text-white"):x&&!w&&(k="",h="bg-gray-400")}return e.jsxs("tr",{ref:N,style:{...u>0?{borderTop:"1px solid #e2e8f0",position:"relative",backgroundColor:"#f8fafc"}:{position:"relative",backgroundColor:"#f8fafc"}},children:[e.jsx("td",{className:"py-3 text-left tabular-nums whitespace-nowrap relative",style:{width:"45px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:e.jsxs("span",{children:[g,C?"=":""]})}),e.jsx("td",{className:"px-4 py-3",style:{backgroundColor:"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[(k||h)&&f==="overall"&&e.jsx("span",{className:`inline-flex items-center justify-center w-4 h-4 rounded-full text-xs font-bold ${h} align-middle flex-shrink-0`,"aria-hidden":!0,children:k}),l&&e.jsx("span",{className:"inline-flex items-center sparkle-trophy flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-4 h-4 text-yellow-500",children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:"M16 3c1.1046 0 2 0.89543 2 2h2c1.1046 0 2 0.89543 2 2v1c0 2.695 -2.1323 4.89 -4.8018 4.9941 -0.8777 1.5207 -2.4019 2.6195 -4.1982 2.9209V19h3c0.5523 0 1 0.4477 1 1s-0.4477 1 -1 1H8c-0.55228 0 -1 -0.4477 -1 -1s0.44772 -1 1 -1h3v-3.085c-1.7965 -0.3015 -3.32148 -1.4 -4.19922 -2.9209C4.13175 12.8895 2 10.6947 2 8V7c0 -1.10457 0.89543 -2 2 -2h2c0 -1.10457 0.89543 -2 2 -2zm-8 7c0 2.2091 1.79086 4 4 4 2.2091 0 4 -1.7909 4 -4V5H8zM4 8c0 1.32848 0.86419 2.4532 2.06055 2.8477C6.02137 10.5707 6 10.2878 6 10V7H4zm14 2c0 0.2878 -0.0223 0.5706 -0.0615 0.8477C19.1353 10.4535 20 9.32881 20 8V7h-2z",strokeWidth:"1"})})})}),e.jsx("span",{className:"font-normal text-sm truncate min-w-0 whitespace-nowrap",style:{color:"rgb(0, 0, 0)",overflow:"hidden",textOverflow:"ellipsis"},children:d.name}),j&&e.jsx("span",{className:"ml-2 rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-semibold text-emerald-800 flex-shrink-0 flash-you-badge",children:"you"})]})}),f==="overall"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"px-1 py-3 text-center tabular-nums font-bold",style:{width:"55px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"this_gw"in d?d.this_gw:0}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"ocp"in d?d.ocp:0})]}),(f==="form5"||f==="form10")&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"formPoints"in d?d.formPoints:0})]}),f==="lastgw"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"points"in d?d.points:0})]})]})});U.displayName="LeaderboardRow";const B=n.forwardRef(({rows:d,activeTab:u,currentUserId:v,prevRanks:f,currRanks:j,latestGw:p,userRowRef:y},N)=>e.jsx("div",{ref:N,className:"flex-1 overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{overscrollBehavior:"contain",WebkitOverflowScrolling:"touch",paddingTop:"0",paddingBottom:"100px",paddingLeft:"1rem",paddingRight:"1rem",backgroundColor:"#f8fafc",touchAction:"pan-y"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0 full-width-header-border",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #cbd5e1"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"45px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#64748b"},children:"Player"}),u==="overall"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsxs("th",{className:"px-1 py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"55px",color:"#64748b",paddingLeft:"0.5rem",paddingRight:"0.5rem"},children:["GW",p||"?"]}),e.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"OCP"})]}),(u==="form5"||u==="form10")&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"PTS"})]}),u==="lastgw"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsxs("th",{className:"py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem"},children:["GW",p||"?"]})]})]})}),e.jsx("tbody",{children:d.map((g,L,C)=>{const l=g.user_id===v;return e.jsx(U,{ref:l?y:null,row:g,index:L,array:C,activeTab:u,isCurrentUser:l,prevRanks:f,currRanks:j,latestGw:p},g.user_id)})})]})}));B.displayName="LeaderboardTable";function q({activeTab:d,onTabChange:u}){return e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"flex rounded-full bg-slate-100 p-1.5 border border-slate-200 shadow-sm w-full max-w-md",children:[e.jsx("button",{onClick:()=>u("lastgw"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${d==="lastgw"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"GW"}),e.jsx("button",{onClick:()=>u("form5"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${d==="form5"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"5"}),e.jsx("button",{onClick:()=>u("form10"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${d==="form10"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"10"}),e.jsx("button",{onClick:()=>u("overall"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all flex items-center justify-center ${d==="overall"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-5 h-5",children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:"M16 3c1.1046 0 2 0.89543 2 2h2c1.1046 0 2 0.89543 2 2v1c0 2.695 -2.1323 4.89 -4.8018 4.9941 -0.8777 1.5207 -2.4019 2.6195 -4.1982 2.9209V19h3c0.5523 0 1 0.4477 1 1s-0.4477 1 -1 1H8c-0.55228 0 -1 -0.4477 -1 -1s0.44772 -1 1 -1h3v-3.085c-1.7965 -0.3015 -3.32148 -1.4 -4.19922 -2.9209C4.13175 12.8895 2 10.6947 2 8V7c0 -1.10457 0.89543 -2 2 -2h2c0 -1.10457 0.89543 -2 2 -2zm-8 7c0 2.2091 1.79086 4 4 4 2.2091 0 4 -1.7909 4 -4V5H8zM4 8c0 1.32848 0.86419 2.4532 2.06055 2.8477C6.02137 10.5707 6 10.2878 6 10V7H4zm14 2c0 0.2878 -0.0223 0.5706 -0.0615 0.8477C19.1353 10.4535 20 9.32881 20 8V7h-2z",strokeWidth:"1"})})})})]})})}function K(){const{user:d}=Y(),[u,v]=D(),f=n.useRef(null),j=n.useRef(null),p=u.get("tab"),y=p==="form5"||p==="form10"||p==="lastgw"||p==="overall"?p:"lastgw",[N,g]=n.useState(!0),[L,C]=n.useState(""),[l,k]=n.useState(null),[h,w]=n.useState([]),[x,S]=n.useState([]),[F,M]=n.useState({}),[m,W]=n.useState(y);n.useEffect(()=>{p||v({tab:"lastgw"},{replace:!0}),y!==m&&W(y)},[y,p,m,v]);const A=n.useCallback(t=>{W(t),v({tab:t})},[v]);n.useEffect(()=>{let t=!0;return(async()=>{try{g(!0),C("");const[a,i,r]=await Promise.all([T.from("gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle(),T.from("v_gw_points").select("user_id, gw, points").order("gw",{ascending:!0}),T.from("v_ocp_overall").select("user_id, name, ocp")]);if(a.error)throw a.error;if(i.error)throw i.error;if(r.error)throw r.error;const s=a.data?.gw??1;if(!t)return;if(k(s),S(i.data??[]),w(r.data??[]),s&&s>1){const o=i.data?.filter(b=>b.gw<s)??[],c={};for(const b of o)c[b.user_id]=(c[b.user_id]??0)+(b.points??0);t&&M(c)}else t&&M({})}catch(a){t&&C(a?.message??"Failed to load leaderboard.")}finally{t&&g(!1)}})(),()=>{t=!1}},[]);const _=n.useCallback(t=>{const a=Object.keys(t);a.sort((r,s)=>(t[s]??0)-(t[r]??0)||r.localeCompare(s));const i={};return a.forEach((r,s)=>i[r]=s+1),i},[]),I=n.useMemo(()=>{const t={};for(const a of h)t[a.user_id]=a.ocp??0;for(const a of x)a.user_id in t||(t[a.user_id]=a.points??0);return _(t)},[h,x,_]),$=n.useMemo(()=>_(F),[F,_]),P=n.useMemo(()=>t=>{if(!l||l<t)return[];const a=l-t+1,i=x.filter(o=>o.gw>=a&&o.gw<=l),r=new Map;for(const o of h)r.set(o.user_id,{user_id:o.user_id,name:o.name??"User",formPoints:0,weeksPlayed:new Set});for(const o of i){const c=r.get(o.user_id);c?(c.formPoints+=o.points,c.weeksPlayed.add(o.gw)):r.set(o.user_id,{user_id:o.user_id,name:"User",formPoints:o.points,weeksPlayed:new Set([o.gw])})}return Array.from(r.values()).filter(o=>{for(let c=a;c<=l;c++)if(!o.weeksPlayed.has(c))return!1;return!0}).map(o=>({user_id:o.user_id,name:o.name,formPoints:o.formPoints,gamesPlayed:t})).sort((o,c)=>c.formPoints-o.formPoints||o.name.localeCompare(c.name))},[h,x,l]),G=n.useMemo(()=>P(5),[P]),V=n.useMemo(()=>P(10),[P]),z=n.useMemo(()=>{if(!l)return[];const t=x.filter(s=>s.gw===l),a=new Map(h.map(s=>[s.user_id,s.name??"User"])),i=t.map(s=>({user_id:s.user_id,name:a.get(s.user_id)??"User",points:s.points})).sort((s,o)=>o.points-s.points||s.name.localeCompare(o.name));let r=1;return i.map((s,o)=>(o>0&&i[o-1].points!==s.points&&(r=o+1),{...s,rank:r}))},[x,l,h]),H=n.useMemo(()=>{const t=x.filter(r=>r.gw===l),a=new Map;for(const r of t)a.set(r.user_id,r.points);const i=h.map(r=>({user_id:r.user_id,name:r.name??"User",this_gw:a.get(r.user_id)??0,ocp:r.ocp??0}));for(const r of t)i.find(s=>s.user_id===r.user_id)||i.push({user_id:r.user_id,name:"User",this_gw:r.points,ocp:r.points});return i.sort((r,s)=>s.ocp-r.ocp||r.name.localeCompare(s.name)),i},[h,x,l]),R=n.useMemo(()=>m==="overall"?H:m==="form5"?G:m==="form10"?V:z,[m,H,G,V,z]);return n.useEffect(()=>(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),[]),n.useEffect(()=>{f.current&&(f.current.scrollTop=0)},[m]),n.useEffect(()=>{const t=f.current;if(!t)return;const a=()=>{t.scrollTop<0&&(t.scrollTop=0),requestAnimationFrame(()=>{t.scrollTop<0&&(t.scrollTop=0)})};t.addEventListener("scroll",a,{passive:!1}),t.addEventListener("touchmove",a,{passive:!1});const i=s=>{t.scrollTop<=0&&s.deltaY<0&&(s.preventDefault(),s.stopPropagation(),t.scrollTop=0)};t.addEventListener("wheel",i,{passive:!1});const r=s=>{if(t.scrollTop<=0){const o=s.touches[0];if(o){const c=o.clientY,b=E=>{const O=E.touches[0];O&&O.clientY<c&&E.preventDefault()};t.addEventListener("touchmove",b,{passive:!1}),t.addEventListener("touchend",()=>{t.removeEventListener("touchmove",b)},{once:!0})}}};return t.addEventListener("touchstart",r,{passive:!1}),()=>{t.removeEventListener("scroll",a),t.removeEventListener("touchmove",a),t.removeEventListener("wheel",i),t.removeEventListener("touchstart",r)}},[]),n.useEffect(()=>{if(!N&&d?.id&&f.current&&j.current){const t=R.findIndex(r=>r.user_id===d.id),a=t>=0?R[t].rank||t+1:null;if(a!==null&&a<=8)return;f.current&&(f.current.scrollTop=0);const i=setTimeout(()=>{const r=f.current,s=j.current;r&&s&&setTimeout(()=>{if(r&&s){const o=s.offsetTop,c=r.clientHeight,b=s.offsetHeight,E=o-c/2+b/2;r.style.scrollBehavior="smooth",r.scrollTop=E,setTimeout(()=>{r&&(r.style.scrollBehavior="auto")},1e3)}},500)},150);return()=>clearTimeout(i)}},[N,d?.id,m,R]),e.jsxs("div",{className:"fixed inset-0 bg-slate-50 overflow-hidden flex flex-col",children:[e.jsx("style",{children:`
        @keyframes sparkle {
          0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
          25% { opacity: 0.8; transform: scale(1.1) rotate(-5deg); }
          50% { opacity: 1; transform: scale(1.15) rotate(5deg); }
          75% { opacity: 0.9; transform: scale(1.05) rotate(-3deg); }
        }
        .sparkle-trophy {
          animation: sparkle 2s ease-in-out infinite;
          filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6));
        }
        .sparkle-trophy svg {
          filter: drop-shadow(0 0 2px rgba(251, 191, 36, 0.8));
        }
        @keyframes flash {
          0%, 100% { background-color: rgb(209, 250, 229); }
          25% { background-color: rgb(167, 243, 208); }
          50% { background-color: rgb(209, 250, 229); }
          75% { background-color: rgb(167, 243, 208); }
        }
        .flash-you-badge {
          animation: flash 1.5s ease-in-out 3;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pb-0 flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-slate-50 py-4",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight text-slate-900",children:"Leaderboard"}),e.jsx("p",{className:"mt-2 mb-6 text-sm text-slate-600 w-full",children:"See how you rank against every TotL player in the world. - COMPONENT VERSION"}),e.jsx(q,{activeTab:m,onTabChange:A}),m==="overall"&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("div",{className:"text-sm text-slate-600",children:"All players overall"})}),m==="form5"&&e.jsx("div",{className:"text-center mb-2",children:l&&l>=5?e.jsx("div",{className:"text-sm text-slate-600",children:"Completed the last 5 Rounds"}):e.jsx("div",{className:"text-sm text-amber-600 font-medium",children:"⚠️ Watch this space! Complete 5 GW in a row to see the 5 Week Form Leaderboard."})}),m==="form10"&&e.jsx("div",{className:"text-center mb-2",children:l&&l>=10?e.jsx("div",{className:"text-sm text-slate-600",children:"Completed the last 10 Rounds"}):e.jsx("div",{className:"text-sm text-amber-600 font-medium",children:"⚠️ Watch this space! Complete 10 GW in a row to see the 10 Week Form Leaderboard."})}),m==="lastgw"&&e.jsx("div",{className:"text-center mb-2",children:e.jsxs("div",{className:"text-sm text-slate-600",children:["Players who completed GW",l]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[L&&e.jsx("div",{className:"mb-6 rounded border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700 flex-shrink-0",children:L}),N?e.jsx("div",{className:"text-slate-500",children:"Loading…"}):m==="form5"&&l&&l<5?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-12 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"5 Week Form Leaderboard Coming Soon"}),e.jsx("div",{className:"text-slate-600",children:"Complete 5 game weeks in a row to unlock the 5 Week Form Leaderboard and see who's in the best form!"})]}):m==="form10"&&l&&l<10?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-12 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"10 Week Form Leaderboard Coming Soon"}),e.jsx("div",{className:"text-slate-600",children:"Complete 10 game weeks in a row to unlock the 10 Week Form Leaderboard and see who's in the best form!"})]}):R.length===0?e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-slate-600",children:"No leaderboard data yet."}):e.jsx(B,{ref:f,rows:R,activeTab:m,currentUserId:d?.id,prevRanks:$,currRanks:I,latestGw:l,userRowRef:j})]})]})]})}export{K as default};
