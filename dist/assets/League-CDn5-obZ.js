import{g as gn,r as z,s as le,j as s,V as xn,a as Fr,u as zr,i as wn,b as gr,T as xr,D as bn,c as vn,d as yn,e as _n,f as qt,h as jn,k as kn,L as wr,l as Vt,m as br,I as vr,n as Cn,o as yr}from"./index-ClmaWrCL.js";function Sn(d,u){return u.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(n){if(n!=="default"&&!(n in d)){var t=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(d,n,t.get?t:{enumerable:!0,get:function(){return r[n]}})}}))})),Object.freeze(d)}function $r(d,u){return new Promise((function(r,n){let t;return Nn(d).then((function(e){try{return t=e,r(new Blob([u.slice(0,2),t,u.slice(2)],{type:"image/jpeg"}))}catch(i){return n(i)}}),n)}))}const Nn=d=>new Promise(((u,r)=>{const n=new FileReader;n.addEventListener("load",(({target:{result:t}})=>{const e=new DataView(t);let i=0;if(e.getUint16(i)!==65496)return r("not a valid JPEG");for(i+=2;;){const c=e.getUint16(i);if(c===65498)break;const b=e.getUint16(i+2);if(c===65505&&e.getUint32(i+4)===1165519206){const p=i+10;let o;switch(e.getUint16(p)){case 18761:o=!0;break;case 19789:o=!1;break;default:return r("TIFF header contains invalid endian")}if(e.getUint16(p+2,o)!==42)return r("TIFF header contains invalid version");const l=e.getUint32(p+4,o),a=p+l+2+12*e.getUint16(p+l,o);for(let h=p+l+2;h<a;h+=12)if(e.getUint16(h,o)==274){if(e.getUint16(h+2,o)!==3)return r("Orientation data type is invalid");if(e.getUint32(h+4,o)!==1)return r("Orientation data count is invalid");e.setUint16(h+8,1,o);break}return u(t.slice(i,i+2+b))}i+=2+b}return u(new Blob)})),n.readAsArrayBuffer(d)}));var Pt={},En={get exports(){return Pt},set exports(d){Pt=d}};(function(d){var u,r,n={};En.exports=n,n.parse=function(t,e){for(var i=n.bin.readUshort,c=n.bin.readUint,b=0,p={},o=new Uint8Array(t),l=o.length-4;c(o,l)!=101010256;)l--;b=l,b+=4;var a=i(o,b+=4);i(o,b+=2);var h=c(o,b+=2),f=c(o,b+=4);b+=4,b=f;for(var C=0;C<a;C++){c(o,b),b+=4,b+=4,b+=4,c(o,b+=4),h=c(o,b+=4);var E=c(o,b+=4),k=i(o,b+=4),$=i(o,b+2),P=i(o,b+4);b+=6;var M=c(o,b+=8);b+=4,b+=k+$+P,n._readLocal(o,M,p,h,E,e)}return p},n._readLocal=function(t,e,i,c,b,p){var o=n.bin.readUshort,l=n.bin.readUint;l(t,e),o(t,e+=4),o(t,e+=2);var a=o(t,e+=2);l(t,e+=2),l(t,e+=4),e+=4;var h=o(t,e+=8),f=o(t,e+=2);e+=2;var C=n.bin.readUTF8(t,e,h);if(e+=h,e+=f,p)i[C]={size:b,csize:c};else{var E=new Uint8Array(t.buffer,e);if(a==0)i[C]=new Uint8Array(E.buffer.slice(e,e+c));else{if(a!=8)throw"unknown compression method: "+a;var k=new Uint8Array(b);n.inflateRaw(E,k),i[C]=k}}},n.inflateRaw=function(t,e){return n.F.inflate(t,e)},n.inflate=function(t,e){return t[0],t[1],n.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),e)},n.deflate=function(t,e){e==null&&(e={level:6});var i=0,c=new Uint8Array(50+Math.floor(1.1*t.length));c[i]=120,c[i+1]=156,i+=2,i=n.F.deflateRaw(t,c,i,e.level);var b=n.adler(t,0,t.length);return c[i+0]=b>>>24&255,c[i+1]=b>>>16&255,c[i+2]=b>>>8&255,c[i+3]=b>>>0&255,new Uint8Array(c.buffer,0,i+4)},n.deflateRaw=function(t,e){e==null&&(e={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),c=n.F.deflateRaw(t,i,c,e.level);return new Uint8Array(i.buffer,0,c)},n.encode=function(t,e){e==null&&(e=!1);var i=0,c=n.bin.writeUint,b=n.bin.writeUshort,p={};for(var o in t){var l=!n._noNeed(o)&&!e,a=t[o],h=n.crc.crc(a,0,a.length);p[o]={cpr:l,usize:a.length,crc:h,file:l?n.deflateRaw(a):a}}for(var o in p)i+=p[o].file.length+30+46+2*n.bin.sizeUTF8(o);i+=22;var f=new Uint8Array(i),C=0,E=[];for(var o in p){var k=p[o];E.push(C),C=n._writeHeader(f,C,o,k,0)}var $=0,P=C;for(var o in p)k=p[o],E.push(C),C=n._writeHeader(f,C,o,k,1,E[$++]);var M=C-P;return c(f,C,101010256),C+=4,b(f,C+=4,$),b(f,C+=2,$),c(f,C+=2,M),c(f,C+=4,P),C+=4,C+=2,f.buffer},n._noNeed=function(t){var e=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(e)!=-1},n._writeHeader=function(t,e,i,c,b,p){var o=n.bin.writeUint,l=n.bin.writeUshort,a=c.file;return o(t,e,b==0?67324752:33639248),e+=4,b==1&&(e+=2),l(t,e,20),l(t,e+=2,0),l(t,e+=2,c.cpr?8:0),o(t,e+=2,0),o(t,e+=4,c.crc),o(t,e+=4,a.length),o(t,e+=4,c.usize),l(t,e+=4,n.bin.sizeUTF8(i)),l(t,e+=2,0),e+=2,b==1&&(e+=2,e+=2,o(t,e+=6,p),e+=4),e+=n.bin.writeUTF8(t,e,i),b==0&&(t.set(a,e),e+=a.length),e},n.crc={table:(function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var i=e,c=0;c<8;c++)1&i?i=3988292384^i>>>1:i>>>=1;t[e]=i}return t})(),update:function(t,e,i,c){for(var b=0;b<c;b++)t=n.crc.table[255&(t^e[i+b])]^t>>>8;return t},crc:function(t,e,i){return 4294967295^n.crc.update(4294967295,t,e,i)}},n.adler=function(t,e,i){for(var c=1,b=0,p=e,o=e+i;p<o;){for(var l=Math.min(p+5552,o);p<l;)b+=c+=t[p++];c%=65521,b%=65521}return b<<16|c},n.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255,t[e+2]=i>>16&255,t[e+3]=i>>24&255},readASCII:function(t,e,i){for(var c="",b=0;b<i;b++)c+=String.fromCharCode(t[e+b]);return c},writeASCII:function(t,e,i){for(var c=0;c<i.length;c++)t[e+c]=i.charCodeAt(c)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,e,i){for(var c,b="",p=0;p<i;p++)b+="%"+n.bin.pad(t[e+p].toString(16));try{c=decodeURIComponent(b)}catch{return n.bin.readASCII(t,e,i)}return c},writeUTF8:function(t,e,i){for(var c=i.length,b=0,p=0;p<c;p++){var o=i.charCodeAt(p);if((4294967168&o)==0)t[e+b]=o,b++;else if((4294965248&o)==0)t[e+b]=192|o>>6,t[e+b+1]=128|o>>0&63,b+=2;else if((4294901760&o)==0)t[e+b]=224|o>>12,t[e+b+1]=128|o>>6&63,t[e+b+2]=128|o>>0&63,b+=3;else{if((4292870144&o)!=0)throw"e";t[e+b]=240|o>>18,t[e+b+1]=128|o>>12&63,t[e+b+2]=128|o>>6&63,t[e+b+3]=128|o>>0&63,b+=4}}return b},sizeUTF8:function(t){for(var e=t.length,i=0,c=0;c<e;c++){var b=t.charCodeAt(c);if((4294967168&b)==0)i++;else if((4294965248&b)==0)i+=2;else if((4294901760&b)==0)i+=3;else{if((4292870144&b)!=0)throw"e";i+=4}}return i}},n.F={},n.F.deflateRaw=function(t,e,i,c){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],p=n.F.U,o=n.F._goodIndex;n.F._hash;var l=n.F._putsE,a=0,h=i<<3,f=0,C=t.length;if(c==0){for(;a<C;)l(e,h,a+(N=Math.min(65535,C-a))==C?1:0),h=n.F._copyExact(t,a,N,e,h+8),a+=N;return h>>>3}var E=p.lits,k=p.strt,$=p.prev,P=0,M=0,I=0,v=0,F=0,m=0;for(C>2&&(k[m=n.F._hash(t,0)]=0),a=0;a<C;a++){if(F=m,a+1<C-2){m=n.F._hash(t,a+1);var g=a+1&32767;$[g]=k[m],k[m]=g}if(f<=a){(P>14e3||M>26697)&&C-a>100&&(f<a&&(E[P]=a-f,P+=2,f=a),h=n.F._writeBlock(a==C-1||f==C?1:0,E,P,v,t,I,a-I,e,h),P=M=v=0,I=a);var _=0;a<C-2&&(_=n.F._bestMatch(t,a,$,F,Math.min(b[2],C-a),b[3]));var N=_>>>16,y=65535&_;if(_!=0){y=65535&_;var L=o(N=_>>>16,p.of0);p.lhst[257+L]++;var S=o(y,p.df0);p.dhst[S]++,v+=p.exb[L]+p.dxb[S],E[P]=N<<23|a-f,E[P+1]=y<<16|L<<8|S,P+=2,f=a+N}else p.lhst[t[a]]++;M++}}for(I==a&&t.length!=0||(f<a&&(E[P]=a-f,P+=2,f=a),h=n.F._writeBlock(1,E,P,v,t,I,a-I,e,h),P=0,M=0,P=M=v=0,I=a);(7&h)!=0;)h++;return h>>>3},n.F._bestMatch=function(t,e,i,c,b,p){var o=32767&e,l=i[o],a=o-l+32768&32767;if(l==o||c!=n.F._hash(t,e-a))return 0;for(var h=0,f=0,C=Math.min(32767,e);a<=C&&--p!=0&&l!=o;){if(h==0||t[e+h]==t[e+h-a]){var E=n.F._howLong(t,e,a);if(E>h){if(f=a,(h=E)>=b)break;a+2<E&&(E=a+2);for(var k=0,$=0;$<E-2;$++){var P=e-a+$+32768&32767,M=P-i[P]+32768&32767;M>k&&(k=M,l=P)}}}a+=(o=l)-(l=i[o])+32768&32767}return h<<16|f},n.F._howLong=function(t,e,i){if(t[e]!=t[e-i]||t[e+1]!=t[e+1-i]||t[e+2]!=t[e+2-i])return 0;var c=e,b=Math.min(t.length,e+258);for(e+=3;e<b&&t[e]==t[e-i];)e++;return e-c},n.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(t,e,i,c,b,p,o,l,a){var h,f,C,E,k,$,P,M,I,v=n.F.U,F=n.F._putsF,m=n.F._putsE;v.lhst[256]++,f=(h=n.F.getTrees())[0],C=h[1],E=h[2],k=h[3],$=h[4],P=h[5],M=h[6],I=h[7];var g=32+((a+3&7)==0?0:8-(a+3&7))+(o<<3),_=c+n.F.contSize(v.fltree,v.lhst)+n.F.contSize(v.fdtree,v.dhst),N=c+n.F.contSize(v.ltree,v.lhst)+n.F.contSize(v.dtree,v.dhst);N+=14+3*P+n.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var y=0;y<286;y++)v.lhst[y]=0;for(y=0;y<30;y++)v.dhst[y]=0;for(y=0;y<19;y++)v.ihst[y]=0;var L=g<_&&g<N?0:_<N?1:2;if(F(l,a,t),F(l,a+1,L),a+=3,L==0){for(;(7&a)!=0;)a++;a=n.F._copyExact(b,p,o,l,a)}else{var S,A;if(L==1&&(S=v.fltree,A=v.fdtree),L==2){n.F.makeCodes(v.ltree,f),n.F.revCodes(v.ltree,f),n.F.makeCodes(v.dtree,C),n.F.revCodes(v.dtree,C),n.F.makeCodes(v.itree,E),n.F.revCodes(v.itree,E),S=v.ltree,A=v.dtree,m(l,a,k-257),m(l,a+=5,$-1),m(l,a+=5,P-4),a+=4;for(var x=0;x<P;x++)m(l,a+3*x,v.itree[1+(v.ordr[x]<<1)]);a+=3*P,a=n.F._codeTiny(M,v.itree,l,a),a=n.F._codeTiny(I,v.itree,l,a)}for(var w=p,B=0;B<i;B+=2){for(var D=e[B],H=D>>>23,ae=w+(8388607&D);w<ae;)a=n.F._writeLit(b[w++],S,l,a);if(H!=0){var X=e[B+1],U=X>>16,T=X>>8&255,R=255&X;m(l,a=n.F._writeLit(257+T,S,l,a),H-v.of0[T]),a+=v.exb[T],F(l,a=n.F._writeLit(R,A,l,a),U-v.df0[R]),a+=v.dxb[R],w+=H}}a=n.F._writeLit(256,S,l,a)}return a},n.F._copyExact=function(t,e,i,c,b){var p=b>>>3;return c[p]=i,c[p+1]=i>>>8,c[p+2]=255-c[p],c[p+3]=255-c[p+1],p+=4,c.set(new Uint8Array(t.buffer,e,i),p),b+(i+4<<3)},n.F.getTrees=function(){for(var t=n.F.U,e=n.F._hufTree(t.lhst,t.ltree,15),i=n.F._hufTree(t.dhst,t.dtree,15),c=[],b=n.F._lenCodes(t.ltree,c),p=[],o=n.F._lenCodes(t.dtree,p),l=0;l<c.length;l+=2)t.ihst[c[l]]++;for(l=0;l<p.length;l+=2)t.ihst[p[l]]++;for(var a=n.F._hufTree(t.ihst,t.itree,7),h=19;h>4&&t.itree[1+(t.ordr[h-1]<<1)]==0;)h--;return[e,i,a,b,o,h,c,p]},n.F.getSecond=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(t[i+1]);return e},n.F.nonZero=function(t){for(var e="",i=0;i<t.length;i+=2)t[i+1]!=0&&(e+=(i>>1)+",");return e},n.F.contSize=function(t,e){for(var i=0,c=0;c<e.length;c++)i+=e[c]*t[1+(c<<1)];return i},n.F._codeTiny=function(t,e,i,c){for(var b=0;b<t.length;b+=2){var p=t[b],o=t[b+1];c=n.F._writeLit(p,e,i,c);var l=p==16?2:p==17?3:7;p>15&&(n.F._putsE(i,c,o,l),c+=l)}return c},n.F._lenCodes=function(t,e){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var c=0;c<i;c+=2){var b=t[c+1],p=c+3<i?t[c+3]:-1,o=c+5<i?t[c+5]:-1,l=c==0?-1:t[c-1];if(b==0&&p==b&&o==b){for(var a=c+5;a+2<i&&t[a+2]==b;)a+=2;(h=Math.min(a+1-c>>>1,138))<11?e.push(17,h-3):e.push(18,h-11),c+=2*h-2}else if(b==l&&p==b&&o==b){for(a=c+5;a+2<i&&t[a+2]==b;)a+=2;var h=Math.min(a+1-c>>>1,6);e.push(16,h-3),c+=2*h-2}else e.push(b,0)}return i>>>1},n.F._hufTree=function(t,e,i){var c=[],b=t.length,p=e.length,o=0;for(o=0;o<p;o+=2)e[o]=0,e[o+1]=0;for(o=0;o<b;o++)t[o]!=0&&c.push({lit:o,f:t[o]});var l=c.length,a=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return a=h==0?1:0,e[1+(h<<1)]=1,e[1+(a<<1)]=1,1}c.sort((function(M,I){return M.f-I.f}));var f=c[0],C=c[1],E=0,k=1,$=2;for(c[0]={lit:-1,f:f.f+C.f,l:f,r:C,d:0};k!=l-1;)f=E!=k&&($==l||c[E].f<c[$].f)?c[E++]:c[$++],C=E!=k&&($==l||c[E].f<c[$].f)?c[E++]:c[$++],c[k++]={lit:-1,f:f.f+C.f,l:f,r:C};var P=n.F.setDepth(c[k-1],0);for(P>i&&(n.F.restrictDepth(a,i,P),P=i),o=0;o<l;o++)e[1+(a[o].lit<<1)]=a[o].d;return P},n.F.setDepth=function(t,e){return t.lit!=-1?(t.d=e,e):Math.max(n.F.setDepth(t.l,e+1),n.F.setDepth(t.r,e+1))},n.F.restrictDepth=function(t,e,i){var c=0,b=1<<i-e,p=0;for(t.sort((function(l,a){return a.d==l.d?l.f-a.f:a.d-l.d})),c=0;c<t.length&&t[c].d>e;c++){var o=t[c].d;t[c].d=e,p+=b-(1<<i-o)}for(p>>>=i-e;p>0;)(o=t[c].d)<e?(t[c].d++,p-=1<<e-o-1):c++;for(;c>=0;c--)t[c].d==e&&p<0&&(t[c].d--,p++);p!=0&&console.log("debt left")},n.F._goodIndex=function(t,e){var i=0;return e[16|i]<=t&&(i|=16),e[8|i]<=t&&(i|=8),e[4|i]<=t&&(i|=4),e[2|i]<=t&&(i|=2),e[1|i]<=t&&(i|=1),i},n.F._writeLit=function(t,e,i,c){return n.F._putsF(i,c,e[t<<1]),c+e[1+(t<<1)]},n.F.inflate=function(t,e){var i=Uint8Array;if(t[0]==3&&t[1]==0)return e||new i(0);var c=n.F,b=c._bitsF,p=c._bitsE,o=c._decodeTiny,l=c.makeCodes,a=c.codes2map,h=c._get17,f=c.U,C=e==null;C&&(e=new i(t.length>>>2<<3));for(var E,k,$=0,P=0,M=0,I=0,v=0,F=0,m=0,g=0,_=0;$==0;)if($=b(t,_,1),P=b(t,_+1,2),_+=3,P!=0){if(C&&(e=n.F._check(e,g+(1<<17))),P==1&&(E=f.flmap,k=f.fdmap,F=511,m=31),P==2){M=p(t,_,5)+257,I=p(t,_+5,5)+1,v=p(t,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)f.itree[N]=0,f.itree[N+1]=0;var y=1;for(N=0;N<v;N++){var L=p(t,_+3*N,3);f.itree[1+(f.ordr[N]<<1)]=L,L>y&&(y=L)}_+=3*v,l(f.itree,y),a(f.itree,y,f.imap),E=f.lmap,k=f.dmap,_=o(f.imap,(1<<y)-1,M+I,t,_,f.ttree);var S=c._copyOut(f.ttree,0,M,f.ltree);F=(1<<S)-1;var A=c._copyOut(f.ttree,M,I,f.dtree);m=(1<<A)-1,l(f.ltree,S),a(f.ltree,S,E),l(f.dtree,A),a(f.dtree,A,k)}for(;;){var x=E[h(t,_)&F];_+=15&x;var w=x>>>4;if(!(w>>>8))e[g++]=w;else{if(w==256)break;var B=g+w-254;if(w>264){var D=f.ldef[w-257];B=g+(D>>>3)+p(t,_,7&D),_+=7&D}var H=k[h(t,_)&m];_+=15&H;var ae=H>>>4,X=f.ddef[ae],U=(X>>>4)+b(t,_,15&X);for(_+=15&X,C&&(e=n.F._check(e,g+(1<<17)));g<B;)e[g]=e[g++-U],e[g]=e[g++-U],e[g]=e[g++-U],e[g]=e[g++-U];g=B}}}else{(7&_)!=0&&(_+=8-(7&_));var T=4+(_>>>3),R=t[T-4]|t[T-3]<<8;C&&(e=n.F._check(e,g+R)),e.set(new i(t.buffer,t.byteOffset+T,R),g),_=T+R<<3,g+=R}return e.length==g?e:e.slice(0,g)},n.F._check=function(t,e){var i=t.length;if(e<=i)return t;var c=new Uint8Array(Math.max(i<<1,e));return c.set(t,0),c},n.F._decodeTiny=function(t,e,i,c,b,p){for(var o=n.F._bitsE,l=n.F._get17,a=0;a<i;){var h=t[l(c,b)&e];b+=15&h;var f=h>>>4;if(f<=15)p[a]=f,a++;else{var C=0,E=0;f==16?(E=3+o(c,b,2),b+=2,C=p[a-1]):f==17?(E=3+o(c,b,3),b+=3):f==18&&(E=11+o(c,b,7),b+=7);for(var k=a+E;a<k;)p[a]=C,a++}}return b},n.F._copyOut=function(t,e,i,c){for(var b=0,p=0,o=c.length>>>1;p<i;){var l=t[p+e];c[p<<1]=0,c[1+(p<<1)]=l,l>b&&(b=l),p++}for(;p<o;)c[p<<1]=0,c[1+(p<<1)]=0,p++;return b},n.F.makeCodes=function(t,e){for(var i,c,b,p,o=n.F.U,l=t.length,a=o.bl_count,h=0;h<=e;h++)a[h]=0;for(h=1;h<l;h+=2)a[t[h]]++;var f=o.next_code;for(i=0,a[0]=0,c=1;c<=e;c++)i=i+a[c-1]<<1,f[c]=i;for(b=0;b<l;b+=2)(p=t[b+1])!=0&&(t[b]=f[p],f[p]++)},n.F.codes2map=function(t,e,i){for(var c=t.length,b=n.F.U.rev15,p=0;p<c;p+=2)if(t[p+1]!=0)for(var o=p>>1,l=t[p+1],a=o<<4|l,h=e-l,f=t[p]<<h,C=f+(1<<h);f!=C;)i[b[f]>>>15-e]=a,f++},n.F.revCodes=function(t,e){for(var i=n.F.U.rev15,c=15-e,b=0;b<t.length;b+=2){var p=t[b]<<e-t[b+1];t[b]=i[p]>>>c}},n.F._putsE=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8},n.F._putsF=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8,t[c+2]|=i>>>16},n.F._bitsE=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<i)-1},n.F._bitsF=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<i)-1},n.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},n.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},n.F.U=(u=Uint16Array,r=Uint32Array,{next_code:new u(16),bl_count:new u(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new u(512),fltree:[],fdmap:new u(32),fdtree:[],lmap:new u(32768),ltree:[],ttree:[],dmap:new u(32768),dtree:[],imap:new u(512),itree:[],rev15:new u(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new u(65536),prev:new u(32768)}),(function(){for(var t=n.F.U,e=0;e<32768;e++){var i=e;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[e]=(i>>>16|i<<16)>>>17}function c(b,p,o){for(;p--!=0;)b.push(0,o)}for(e=0;e<32;e++)t.ldef[e]=t.of0[e]<<3|t.exb[e],t.ddef[e]=t.df0[e]<<4|t.dxb[e];c(t.fltree,144,8),c(t.fltree,112,9),c(t.fltree,24,7),c(t.fltree,8,8),n.F.makeCodes(t.fltree,9),n.F.codes2map(t.fltree,9,t.flmap),n.F.revCodes(t.fltree,9),c(t.fdtree,32,5),n.F.makeCodes(t.fdtree,5),n.F.codes2map(t.fdtree,5,t.fdmap),n.F.revCodes(t.fdtree,5),c(t.itree,19,0),c(t.ltree,286,0),c(t.dtree,30,0),c(t.ttree,320,0)})()})();var An=Sn({__proto__:null,default:Pt},[Pt]);const nt=(function(){var d={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,a){o[l]=a>>8&255,o[l+1]=255&a},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,a){o[l]=a>>24&255,o[l+1]=a>>16&255,o[l+2]=a>>8&255,o[l+3]=255&a},readASCII(o,l,a){let h="";for(let f=0;f<a;f++)h+=String.fromCharCode(o[l+f]);return h},writeASCII(o,l,a){for(let h=0;h<a.length;h++)o[l+h]=a.charCodeAt(h)},readBytes(o,l,a){const h=[];for(let f=0;f<a;f++)h.push(o[l+f]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,a){let h,f="";for(let C=0;C<a;C++)f+=`%${d.pad(o[l+C].toString(16))}`;try{h=decodeURIComponent(f)}catch{return d.readASCII(o,l,a)}return h}};function u(o,l,a,h){const f=l*a,C=e(h),E=Math.ceil(l*C/8),k=new Uint8Array(4*f),$=new Uint32Array(k.buffer),{ctype:P}=h,{depth:M}=h,I=d.readUshort;if(P==6){const D=f<<2;if(M==8)for(var v=0;v<D;v+=4)k[v]=o[v],k[v+1]=o[v+1],k[v+2]=o[v+2],k[v+3]=o[v+3];if(M==16)for(v=0;v<D;v++)k[v]=o[v<<1]}else if(P==2){const D=h.tabs.tRNS;if(D==null){if(M==8)for(v=0;v<f;v++){var F=3*v;$[v]=255<<24|o[F+2]<<16|o[F+1]<<8|o[F]}if(M==16)for(v=0;v<f;v++)F=6*v,$[v]=255<<24|o[F+4]<<16|o[F+2]<<8|o[F]}else{var m=D[0];const H=D[1],ae=D[2];if(M==8)for(v=0;v<f;v++){var g=v<<2;F=3*v,$[v]=255<<24|o[F+2]<<16|o[F+1]<<8|o[F],o[F]==m&&o[F+1]==H&&o[F+2]==ae&&(k[g+3]=0)}if(M==16)for(v=0;v<f;v++)g=v<<2,F=6*v,$[v]=255<<24|o[F+4]<<16|o[F+2]<<8|o[F],I(o,F)==m&&I(o,F+2)==H&&I(o,F+4)==ae&&(k[g+3]=0)}}else if(P==3){const D=h.tabs.PLTE,H=h.tabs.tRNS,ae=H?H.length:0;if(M==1)for(var _=0;_<a;_++){var N=_*E,y=_*l;for(v=0;v<l;v++){g=y+v<<2;var L=3*(S=o[N+(v>>3)]>>7-((7&v)<<0)&1);k[g]=D[L],k[g+1]=D[L+1],k[g+2]=D[L+2],k[g+3]=S<ae?H[S]:255}}if(M==2)for(_=0;_<a;_++)for(N=_*E,y=_*l,v=0;v<l;v++)g=y+v<<2,L=3*(S=o[N+(v>>2)]>>6-((3&v)<<1)&3),k[g]=D[L],k[g+1]=D[L+1],k[g+2]=D[L+2],k[g+3]=S<ae?H[S]:255;if(M==4)for(_=0;_<a;_++)for(N=_*E,y=_*l,v=0;v<l;v++)g=y+v<<2,L=3*(S=o[N+(v>>1)]>>4-((1&v)<<2)&15),k[g]=D[L],k[g+1]=D[L+1],k[g+2]=D[L+2],k[g+3]=S<ae?H[S]:255;if(M==8)for(v=0;v<f;v++){var S;g=v<<2,L=3*(S=o[v]),k[g]=D[L],k[g+1]=D[L+1],k[g+2]=D[L+2],k[g+3]=S<ae?H[S]:255}}else if(P==4){if(M==8)for(v=0;v<f;v++){g=v<<2;var A=o[x=v<<1];k[g]=A,k[g+1]=A,k[g+2]=A,k[g+3]=o[x+1]}if(M==16)for(v=0;v<f;v++){var x;g=v<<2,A=o[x=v<<2],k[g]=A,k[g+1]=A,k[g+2]=A,k[g+3]=o[x+2]}}else if(P==0)for(m=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<a;_++){const D=_*E,H=_*l;if(M==1)for(var w=0;w<l;w++){var B=(A=255*(o[D+(w>>>3)]>>>7-(7&w)&1))==255*m?0:255;$[H+w]=B<<24|A<<16|A<<8|A}else if(M==2)for(w=0;w<l;w++)B=(A=85*(o[D+(w>>>2)]>>>6-((3&w)<<1)&3))==85*m?0:255,$[H+w]=B<<24|A<<16|A<<8|A;else if(M==4)for(w=0;w<l;w++)B=(A=17*(o[D+(w>>>1)]>>>4-((1&w)<<2)&15))==17*m?0:255,$[H+w]=B<<24|A<<16|A<<8|A;else if(M==8)for(w=0;w<l;w++)B=(A=o[D+w])==m?0:255,$[H+w]=B<<24|A<<16|A<<8|A;else if(M==16)for(w=0;w<l;w++)A=o[D+(w<<1)],B=I(o,D+(w<<1))==m?0:255,$[H+w]=B<<24|A<<16|A<<8|A}return k}function r(o,l,a,h){const f=e(o),C=Math.ceil(a*f/8),E=new Uint8Array((C+1+o.interlace)*h);return l=o.tabs.CgBI?t(l,E):n(l,E),o.interlace==0?l=i(l,o,0,a,h):o.interlace==1&&(l=(function($,P){const M=P.width,I=P.height,v=e(P),F=v>>3,m=Math.ceil(M*v/8),g=new Uint8Array(I*m);let _=0;const N=[0,0,4,0,2,0,1],y=[0,4,0,2,0,1,0],L=[8,8,8,4,4,2,2],S=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const w=L[A],B=S[A];let D=0,H=0,ae=N[A];for(;ae<I;)ae+=w,H++;let X=y[A];for(;X<M;)X+=B,D++;const U=Math.ceil(D*v/8);i($,P,_,D,H);let T=0,R=N[A];for(;R<I;){let K=y[A],Y=_+T*U<<3;for(;K<M;){var x;if(v==1&&(x=(x=$[Y>>3])>>7-(7&Y)&1,g[R*m+(K>>3)]|=x<<7-((7&K)<<0)),v==2&&(x=(x=$[Y>>3])>>6-(7&Y)&3,g[R*m+(K>>2)]|=x<<6-((3&K)<<1)),v==4&&(x=(x=$[Y>>3])>>4-(7&Y)&15,g[R*m+(K>>1)]|=x<<4-((1&K)<<2)),v>=8){const O=R*m+K*F;for(let ee=0;ee<F;ee++)g[O+ee]=$[(Y>>3)+ee]}Y+=v,K+=B}T++,R+=w}D*H!=0&&(_+=H*(1+U)),A+=1}return g})(l,o)),l}function n(o,l){return t(new Uint8Array(o.buffer,2,o.length-6),l)}var t=(function(){const o={H:{}};return o.H.N=function(l,a){const h=Uint8Array;let f,C,E=0,k=0,$=0,P=0,M=0,I=0,v=0,F=0,m=0;if(l[0]==3&&l[1]==0)return a||new h(0);const g=o.H,_=g.b,N=g.e,y=g.R,L=g.n,S=g.A,A=g.Z,x=g.m,w=a==null;for(w&&(a=new h(l.length>>>2<<5));E==0;)if(E=_(l,m,1),k=_(l,m+1,2),m+=3,k!=0){if(w&&(a=o.H.W(a,F+(1<<17))),k==1&&(f=x.J,C=x.h,I=511,v=31),k==2){$=N(l,m,5)+257,P=N(l,m+5,5)+1,M=N(l,m+10,4)+4,m+=14;let D=1;for(var B=0;B<38;B+=2)x.Q[B]=0,x.Q[B+1]=0;for(B=0;B<M;B++){const X=N(l,m+3*B,3);x.Q[1+(x.X[B]<<1)]=X,X>D&&(D=X)}m+=3*M,L(x.Q,D),S(x.Q,D,x.u),f=x.w,C=x.d,m=y(x.u,(1<<D)-1,$+P,l,m,x.v);const H=g.V(x.v,0,$,x.C);I=(1<<H)-1;const ae=g.V(x.v,$,P,x.D);v=(1<<ae)-1,L(x.C,H),S(x.C,H,f),L(x.D,ae),S(x.D,ae,C)}for(;;){const D=f[A(l,m)&I];m+=15&D;const H=D>>>4;if(!(H>>>8))a[F++]=H;else{if(H==256)break;{let ae=F+H-254;if(H>264){const K=x.q[H-257];ae=F+(K>>>3)+N(l,m,7&K),m+=7&K}const X=C[A(l,m)&v];m+=15&X;const U=X>>>4,T=x.c[U],R=(T>>>4)+_(l,m,15&T);for(m+=15&T;F<ae;)a[F]=a[F++-R],a[F]=a[F++-R],a[F]=a[F++-R],a[F]=a[F++-R];F=ae}}}}else{(7&m)!=0&&(m+=8-(7&m));const D=4+(m>>>3),H=l[D-4]|l[D-3]<<8;w&&(a=o.H.W(a,F+H)),a.set(new h(l.buffer,l.byteOffset+D,H),F),m=D+H<<3,F+=H}return a.length==F?a:a.slice(0,F)},o.H.W=function(l,a){const h=l.length;if(a<=h)return l;const f=new Uint8Array(h<<1);return f.set(l,0),f},o.H.R=function(l,a,h,f,C,E){const k=o.H.e,$=o.H.Z;let P=0;for(;P<h;){const M=l[$(f,C)&a];C+=15&M;const I=M>>>4;if(I<=15)E[P]=I,P++;else{let v=0,F=0;I==16?(F=3+k(f,C,2),C+=2,v=E[P-1]):I==17?(F=3+k(f,C,3),C+=3):I==18&&(F=11+k(f,C,7),C+=7);const m=P+F;for(;P<m;)E[P]=v,P++}}return C},o.H.V=function(l,a,h,f){let C=0,E=0;const k=f.length>>>1;for(;E<h;){const $=l[E+a];f[E<<1]=0,f[1+(E<<1)]=$,$>C&&(C=$),E++}for(;E<k;)f[E<<1]=0,f[1+(E<<1)]=0,E++;return C},o.H.n=function(l,a){const h=o.H.m,f=l.length;let C,E,k,$;const P=h.j;for(var M=0;M<=a;M++)P[M]=0;for(M=1;M<f;M+=2)P[l[M]]++;const I=h.K;for(C=0,P[0]=0,E=1;E<=a;E++)C=C+P[E-1]<<1,I[E]=C;for(k=0;k<f;k+=2)$=l[k+1],$!=0&&(l[k]=I[$],I[$]++)},o.H.A=function(l,a,h){const f=l.length,C=o.H.m.r;for(let E=0;E<f;E+=2)if(l[E+1]!=0){const k=E>>1,$=l[E+1],P=k<<4|$,M=a-$;let I=l[E]<<M;const v=I+(1<<M);for(;I!=v;)h[C[I]>>>15-a]=P,I++}},o.H.l=function(l,a){const h=o.H.m.r,f=15-a;for(let C=0;C<l.length;C+=2){const E=l[C]<<a-l[C+1];l[C]=h[E]>>>f}},o.H.M=function(l,a,h){h<<=7&a;const f=a>>>3;l[f]|=h,l[f+1]|=h>>>8},o.H.I=function(l,a,h){h<<=7&a;const f=a>>>3;l[f]|=h,l[f+1]|=h>>>8,l[f+2]|=h>>>16},o.H.e=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8)>>>(7&a)&(1<<h)-1},o.H.b=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)&(1<<h)-1},o.H.Z=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)},o.H.i=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16|l[3+(a>>>3)]<<24)>>>(7&a)},o.H.m=(function(){const l=Uint16Array,a=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new a(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new a(286),Y:new a(30),a:new a(19),t:new a(15e3),k:new l(65536),g:new l(32768)}})(),(function(){const l=o.H.m;for(var a=0;a<32768;a++){let f=a;f=(2863311530&f)>>>1|(1431655765&f)<<1,f=(3435973836&f)>>>2|(858993459&f)<<2,f=(4042322160&f)>>>4|(252645135&f)<<4,f=(4278255360&f)>>>8|(16711935&f)<<8,l.r[a]=(f>>>16|f<<16)>>>17}function h(f,C,E){for(;C--!=0;)f.push(0,E)}for(a=0;a<32;a++)l.q[a]=l.S[a]<<3|l.T[a],l.c[a]=l.p[a]<<4|l.z[a];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)})(),o.H.N})();function e(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function i(o,l,a,h,f){let C=e(l);const E=Math.ceil(h*C/8);let k,$;C=Math.ceil(C/8);let P=o[a],M=0;if(P>1&&(o[a]=[0,0,1][P-2]),P==3)for(M=C;M<E;M++)o[M+1]=o[M+1]+(o[M+1-C]>>>1)&255;for(let I=0;I<f;I++)if(k=a+I*E,$=k+I+1,P=o[$-1],M=0,P==0)for(;M<E;M++)o[k+M]=o[$+M];else if(P==1){for(;M<C;M++)o[k+M]=o[$+M];for(;M<E;M++)o[k+M]=o[$+M]+o[k+M-C]}else if(P==2)for(;M<E;M++)o[k+M]=o[$+M]+o[k+M-E];else if(P==3){for(;M<C;M++)o[k+M]=o[$+M]+(o[k+M-E]>>>1);for(;M<E;M++)o[k+M]=o[$+M]+(o[k+M-E]+o[k+M-C]>>>1)}else{for(;M<C;M++)o[k+M]=o[$+M]+c(0,o[k+M-E],0);for(;M<E;M++)o[k+M]=o[$+M]+c(o[k+M-C],o[k+M-E],o[k+M-C-E])}return o}function c(o,l,a){const h=o+l-a,f=h-o,C=h-l,E=h-a;return f*f<=C*C&&f*f<=E*E?o:C*C<=E*E?l:a}function b(o,l,a){a.width=d.readUint(o,l),l+=4,a.height=d.readUint(o,l),l+=4,a.depth=o[l],l++,a.ctype=o[l],l++,a.compress=o[l],l++,a.filter=o[l],l++,a.interlace=o[l],l++}function p(o,l,a,h,f,C,E,k,$){const P=Math.min(l,f),M=Math.min(a,C);let I=0,v=0;for(let A=0;A<M;A++)for(let x=0;x<P;x++)if(E>=0&&k>=0?(I=A*l+x<<2,v=(k+A)*f+E+x<<2):(I=(-k+A)*l-E+x<<2,v=A*f+x<<2),$==0)h[v]=o[I],h[v+1]=o[I+1],h[v+2]=o[I+2],h[v+3]=o[I+3];else if($==1){var F=o[I+3]*.00392156862745098,m=o[I]*F,g=o[I+1]*F,_=o[I+2]*F,N=h[v+3]*(1/255),y=h[v]*N,L=h[v+1]*N,S=h[v+2]*N;const w=1-F,B=F+N*w,D=B==0?0:1/B;h[v+3]=255*B,h[v+0]=(m+y*w)*D,h[v+1]=(g+L*w)*D,h[v+2]=(_+S*w)*D}else if($==2)F=o[I+3],m=o[I],g=o[I+1],_=o[I+2],N=h[v+3],y=h[v],L=h[v+1],S=h[v+2],F==N&&m==y&&g==L&&_==S?(h[v]=0,h[v+1]=0,h[v+2]=0,h[v+3]=0):(h[v]=m,h[v+1]=g,h[v+2]=_,h[v+3]=F);else if($==3){if(F=o[I+3],m=o[I],g=o[I+1],_=o[I+2],N=h[v+3],y=h[v],L=h[v+1],S=h[v+2],F==N&&m==y&&g==L&&_==S)continue;if(F<220&&N>20)return!1}return!0}return{decode:function(l){const a=new Uint8Array(l);let h=8;const f=d,C=f.readUshort,E=f.readUint,k={tabs:{},frames:[]},$=new Uint8Array(a.length);let P,M=0,I=0;const v=[137,80,78,71,13,10,26,10];for(var F=0;F<8;F++)if(a[F]!=v[F])throw"The input is not a PNG file!";for(;h<a.length;){const A=f.readUint(a,h);h+=4;const x=f.readASCII(a,h,4);if(h+=4,x=="IHDR")b(a,h,k);else if(x=="iCCP"){for(var m=h;a[m]!=0;)m++;f.readASCII(a,h,m-h),a[m+1];const w=a.slice(m+2,h+A);let B=null;try{B=n(w)}catch{B=t(w)}k.tabs[x]=B}else if(x=="CgBI")k.tabs[x]=a.slice(h,h+4);else if(x=="IDAT"){for(F=0;F<A;F++)$[M+F]=a[h+F];M+=A}else if(x=="acTL")k.tabs[x]={num_frames:E(a,h),num_plays:E(a,h+4)},P=new Uint8Array(a.length);else if(x=="fcTL"){I!=0&&((S=k.frames[k.frames.length-1]).data=r(k,P.slice(0,I),S.rect.width,S.rect.height),I=0);const w={x:E(a,h+12),y:E(a,h+16),width:E(a,h+4),height:E(a,h+8)};let B=C(a,h+22);B=C(a,h+20)/(B==0?100:B);const D={rect:w,delay:Math.round(1e3*B),dispose:a[h+24],blend:a[h+25]};k.frames.push(D)}else if(x=="fdAT"){for(F=0;F<A-4;F++)P[I+F]=a[h+F+4];I+=A-4}else if(x=="pHYs")k.tabs[x]=[f.readUint(a,h),f.readUint(a,h+4),a[h+8]];else if(x=="cHRM")for(k.tabs[x]=[],F=0;F<8;F++)k.tabs[x].push(f.readUint(a,h+4*F));else if(x=="tEXt"||x=="zTXt"){k.tabs[x]==null&&(k.tabs[x]={});var g=f.nextZero(a,h),_=f.readASCII(a,h,g-h),N=h+A-g-1;if(x=="tEXt")L=f.readASCII(a,g+1,N);else{var y=n(a.slice(g+2,g+2+N));L=f.readUTF8(y,0,y.length)}k.tabs[x][_]=L}else if(x=="iTXt"){k.tabs[x]==null&&(k.tabs[x]={}),g=0,m=h,g=f.nextZero(a,m),_=f.readASCII(a,m,g-m);const w=a[m=g+1];var L;a[m+1],m+=2,g=f.nextZero(a,m),f.readASCII(a,m,g-m),m=g+1,g=f.nextZero(a,m),f.readUTF8(a,m,g-m),N=A-((m=g+1)-h),w==0?L=f.readUTF8(a,m,N):(y=n(a.slice(m,m+N)),L=f.readUTF8(y,0,y.length)),k.tabs[x][_]=L}else if(x=="PLTE")k.tabs[x]=f.readBytes(a,h,A);else if(x=="hIST"){const w=k.tabs.PLTE.length/3;for(k.tabs[x]=[],F=0;F<w;F++)k.tabs[x].push(C(a,h+2*F))}else if(x=="tRNS")k.ctype==3?k.tabs[x]=f.readBytes(a,h,A):k.ctype==0?k.tabs[x]=C(a,h):k.ctype==2&&(k.tabs[x]=[C(a,h),C(a,h+2),C(a,h+4)]);else if(x=="gAMA")k.tabs[x]=f.readUint(a,h)/1e5;else if(x=="sRGB")k.tabs[x]=a[h];else if(x=="bKGD")k.ctype==0||k.ctype==4?k.tabs[x]=[C(a,h)]:k.ctype==2||k.ctype==6?k.tabs[x]=[C(a,h),C(a,h+2),C(a,h+4)]:k.ctype==3&&(k.tabs[x]=a[h]);else if(x=="IEND")break;h+=A,f.readUint(a,h),h+=4}var S;return I!=0&&((S=k.frames[k.frames.length-1]).data=r(k,P.slice(0,I),S.rect.width,S.rect.height)),k.data=r(k,$,k.width,k.height),delete k.compress,delete k.interlace,delete k.filter,k},toRGBA8:function(l){const a=l.width,h=l.height;if(l.tabs.acTL==null)return[u(l.data,a,h,l).buffer];const f=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const C=a*h*4,E=new Uint8Array(C),k=new Uint8Array(C),$=new Uint8Array(C);for(let M=0;M<l.frames.length;M++){const I=l.frames[M],v=I.rect.x,F=I.rect.y,m=I.rect.width,g=I.rect.height,_=u(I.data,m,g,l);if(M!=0)for(var P=0;P<C;P++)$[P]=E[P];if(I.blend==0?p(_,m,g,E,a,h,v,F,0):I.blend==1&&p(_,m,g,E,a,h,v,F,1),f.push(E.buffer.slice(0)),I.dispose!=0){if(I.dispose==1)p(k,m,g,E,a,h,v,F,0);else if(I.dispose==2)for(P=0;P<C;P++)E[P]=$[P]}}return f},_paeth:c,_copyTile:p,_bin:d}})();(function(){const{_copyTile:d}=nt,{_bin:u}=nt,r=nt._paeth;var n={table:(function(){const m=new Uint32Array(256);for(let g=0;g<256;g++){let _=g;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;m[g]=_}return m})(),update(m,g,_,N){for(let y=0;y<N;y++)m=n.table[255&(m^g[_+y])]^m>>>8;return m},crc:(m,g,_)=>4294967295^n.update(4294967295,m,g,_)};function t(m,g,_,N){g[_]+=m[0]*N>>4,g[_+1]+=m[1]*N>>4,g[_+2]+=m[2]*N>>4,g[_+3]+=m[3]*N>>4}function e(m){return Math.max(0,Math.min(255,m))}function i(m,g){const _=m[0]-g[0],N=m[1]-g[1],y=m[2]-g[2],L=m[3]-g[3];return _*_+N*N+y*y+L*L}function c(m,g,_,N,y,L,S){S==null&&(S=1);const A=N.length,x=[];for(var w=0;w<A;w++){const R=N[w];x.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(w=0;w<A;w++){let R=4294967295;for(var B=0,D=0;D<A;D++){var H=i(x[w],x[D]);D!=w&&H<R&&(R=H,B=D)}}const ae=new Uint32Array(y.buffer),X=new Int16Array(g*_*4),U=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(w=0;w<U.length;w++)U[w]=255*((U[w]+.5)/16-.5);for(let R=0;R<_;R++)for(let K=0;K<g;K++){var T;w=4*(R*g+K),S!=2?T=[e(m[w]+X[w]),e(m[w+1]+X[w+1]),e(m[w+2]+X[w+2]),e(m[w+3]+X[w+3])]:(H=U[4*(3&R)+(3&K)],T=[e(m[w]+H),e(m[w+1]+H),e(m[w+2]+H),e(m[w+3]+H)]),B=0;let Y=16777215;for(D=0;D<A;D++){const te=i(T,x[D]);te<Y&&(Y=te,B=D)}const O=x[B],ee=[T[0]-O[0],T[1]-O[1],T[2]-O[2],T[3]-O[3]];S==1&&(K!=g-1&&t(ee,X,w+4,7),R!=_-1&&(K!=0&&t(ee,X,w+4*g-4,3),t(ee,X,w+4*g,5),K!=g-1&&t(ee,X,w+4*g+4,1))),L[w>>2]=B,ae[w>>2]=N[B]}}function b(m,g,_,N,y){y==null&&(y={});const{crc:L}=n,S=u.writeUint,A=u.writeUshort,x=u.writeASCII;let w=8;const B=m.frames.length>1;let D,H=!1,ae=33+(B?20:0);if(y.sRGB!=null&&(ae+=13),y.pHYs!=null&&(ae+=21),y.iCCP!=null&&(D=pako.deflate(y.iCCP),ae+=21+D.length+4),m.ctype==3){for(var X=m.plte.length,U=0;U<X;U++)m.plte[U]>>>24!=255&&(H=!0);ae+=8+3*X+4+(H?8+1*X+4:0)}for(var T=0;T<m.frames.length;T++)B&&(ae+=38),ae+=(O=m.frames[T]).cimg.length+12,T!=0&&(ae+=4);ae+=12;const R=new Uint8Array(ae),K=[137,80,78,71,13,10,26,10];for(U=0;U<8;U++)R[U]=K[U];if(S(R,w,13),w+=4,x(R,w,"IHDR"),w+=4,S(R,w,g),w+=4,S(R,w,_),w+=4,R[w]=m.depth,w++,R[w]=m.ctype,w++,R[w]=0,w++,R[w]=0,w++,R[w]=0,w++,S(R,w,L(R,w-17,17)),w+=4,y.sRGB!=null&&(S(R,w,1),w+=4,x(R,w,"sRGB"),w+=4,R[w]=y.sRGB,w++,S(R,w,L(R,w-5,5)),w+=4),y.iCCP!=null){const ee=13+D.length;S(R,w,ee),w+=4,x(R,w,"iCCP"),w+=4,x(R,w,"ICC profile"),w+=11,w+=2,R.set(D,w),w+=D.length,S(R,w,L(R,w-(ee+4),ee+4)),w+=4}if(y.pHYs!=null&&(S(R,w,9),w+=4,x(R,w,"pHYs"),w+=4,S(R,w,y.pHYs[0]),w+=4,S(R,w,y.pHYs[1]),w+=4,R[w]=y.pHYs[2],w++,S(R,w,L(R,w-13,13)),w+=4),B&&(S(R,w,8),w+=4,x(R,w,"acTL"),w+=4,S(R,w,m.frames.length),w+=4,S(R,w,y.loop!=null?y.loop:0),w+=4,S(R,w,L(R,w-12,12)),w+=4),m.ctype==3){for(S(R,w,3*(X=m.plte.length)),w+=4,x(R,w,"PLTE"),w+=4,U=0;U<X;U++){const ee=3*U,te=m.plte[U],se=255&te,ie=te>>>8&255,He=te>>>16&255;R[w+ee+0]=se,R[w+ee+1]=ie,R[w+ee+2]=He}if(w+=3*X,S(R,w,L(R,w-3*X-4,3*X+4)),w+=4,H){for(S(R,w,X),w+=4,x(R,w,"tRNS"),w+=4,U=0;U<X;U++)R[w+U]=m.plte[U]>>>24&255;w+=X,S(R,w,L(R,w-X-4,X+4)),w+=4}}let Y=0;for(T=0;T<m.frames.length;T++){var O=m.frames[T];B&&(S(R,w,26),w+=4,x(R,w,"fcTL"),w+=4,S(R,w,Y++),w+=4,S(R,w,O.rect.width),w+=4,S(R,w,O.rect.height),w+=4,S(R,w,O.rect.x),w+=4,S(R,w,O.rect.y),w+=4,A(R,w,N[T]),w+=2,A(R,w,1e3),w+=2,R[w]=O.dispose,w++,R[w]=O.blend,w++,S(R,w,L(R,w-30,30)),w+=4);const ee=O.cimg;S(R,w,(X=ee.length)+(T==0?0:4)),w+=4;const te=w;x(R,w,T==0?"IDAT":"fdAT"),w+=4,T!=0&&(S(R,w,Y++),w+=4),R.set(ee,w),w+=X,S(R,w,L(R,te,w-te)),w+=4}return S(R,w,0),w+=4,x(R,w,"IEND"),w+=4,S(R,w,L(R,w-4,4)),w+=4,R.buffer}function p(m,g,_){for(let N=0;N<m.frames.length;N++){const y=m.frames[N];y.rect.width;const L=y.rect.height,S=new Uint8Array(L*y.bpl+L);y.cimg=h(y.img,L,y.bpp,y.bpl,S,g,_)}}function o(m,g,_,N,y){const L=y[0],S=y[1],A=y[2],x=y[3],w=y[4],B=y[5];let D=6,H=8,ae=255;for(var X=0;X<m.length;X++){const ke=new Uint8Array(m[X]);for(var U=ke.length,T=0;T<U;T+=4)ae&=ke[T+3]}const R=ae!=255,K=(function(be,pe,he,Ie,ye,Ne){const _e=[];for(var je=0;je<be.length;je++){const Ee=new Uint8Array(be[je]),ze=new Uint32Array(Ee.buffer);var Le;let Ve=0,Ze=0,Qe=pe,et=he,pt=Ie?1:0;if(je!=0){const At=Ne||Ie||je==1||_e[je-2].dispose!=0?1:2;let ht=0,ct=1e9;for(let gt=0;gt<At;gt++){var qe=new Uint8Array(be[je-1-gt]);const yt=new Uint32Array(be[je-1-gt]);let ot=pe,Xe=he,tt=-1,mt=-1;for(let at=0;at<he;at++)for(let rt=0;rt<pe;rt++)ze[De=at*pe+rt]!=yt[De]&&(rt<ot&&(ot=rt),rt>tt&&(tt=rt),at<Xe&&(Xe=at),at>mt&&(mt=at));tt==-1&&(ot=Xe=tt=mt=0),ye&&((1&ot)==1&&ot--,(1&Xe)==1&&Xe--);const wt=(tt-ot+1)*(mt-Xe+1);wt<ct&&(ct=wt,ht=gt,Ve=ot,Ze=Xe,Qe=tt-ot+1,et=mt-Xe+1)}qe=new Uint8Array(be[je-1-ht]),ht==1&&(_e[je-1].dispose=2),Le=new Uint8Array(Qe*et*4),d(qe,pe,he,Le,Qe,et,-Ve,-Ze,0),pt=d(Ee,pe,he,Le,Qe,et,-Ve,-Ze,3)?1:0,pt==1?a(Ee,pe,he,Le,{x:Ve,y:Ze,width:Qe,height:et}):d(Ee,pe,he,Le,Qe,et,-Ve,-Ze,0)}else Le=Ee.slice(0);_e.push({rect:{x:Ve,y:Ze,width:Qe,height:et},img:Le,blend:pt,dispose:0})}if(Ie)for(je=0;je<_e.length;je++){if((st=_e[je]).blend==1)continue;const Ee=st.rect,ze=_e[je-1].rect,Ve=Math.min(Ee.x,ze.x),Ze=Math.min(Ee.y,ze.y),Qe={x:Ve,y:Ze,width:Math.max(Ee.x+Ee.width,ze.x+ze.width)-Ve,height:Math.max(Ee.y+Ee.height,ze.y+ze.height)-Ze};_e[je-1].dispose=1,je-1!=0&&l(be,pe,he,_e,je-1,Qe,ye),l(be,pe,he,_e,je,Qe,ye)}let Je=0;if(be.length!=1)for(var De=0;De<_e.length;De++){var st;Je+=(st=_e[De]).rect.width*st.rect.height}return _e})(m,g,_,L,S,A),Y={},O=[],ee=[];if(N!=0){const ke=[];for(T=0;T<K.length;T++)ke.push(K[T].img.buffer);const be=(function(ye){let Ne=0;for(var _e=0;_e<ye.length;_e++)Ne+=ye[_e].byteLength;const je=new Uint8Array(Ne);let Le=0;for(_e=0;_e<ye.length;_e++){const qe=new Uint8Array(ye[_e]),Je=qe.length;for(let De=0;De<Je;De+=4){let st=qe[De],Ee=qe[De+1],ze=qe[De+2];const Ve=qe[De+3];Ve==0&&(st=Ee=ze=0),je[Le+De]=st,je[Le+De+1]=Ee,je[Le+De+2]=ze,je[Le+De+3]=Ve}Le+=Je}return je.buffer})(ke),pe=C(be,N);for(T=0;T<pe.plte.length;T++)O.push(pe.plte[T].est.rgba);let he=0;for(T=0;T<K.length;T++){const Ie=(se=K[T]).img.length;var te=new Uint8Array(pe.inds.buffer,he>>2,Ie>>2);ee.push(te);const ye=new Uint8Array(pe.abuf,he,Ie);B&&c(se.img,se.rect.width,se.rect.height,O,ye,te),se.img.set(ye),he+=Ie}}else for(X=0;X<K.length;X++){var se=K[X];const ke=new Uint32Array(se.img.buffer);var ie=se.rect.width;for(U=ke.length,te=new Uint8Array(U),ee.push(te),T=0;T<U;T++){const be=ke[T];if(T!=0&&be==ke[T-1])te[T]=te[T-1];else if(T>ie&&be==ke[T-ie])te[T]=te[T-ie];else{let pe=Y[be];if(pe==null&&(Y[be]=pe=O.length,O.push(be),O.length>=300))break;te[T]=pe}}}const He=O.length;for(He<=256&&w==0&&(H=He<=2?1:He<=4?2:He<=16?4:8,H=Math.max(H,x)),X=0;X<K.length;X++){(se=K[X]).rect.x,se.rect.y,ie=se.rect.width;const ke=se.rect.height;let be=se.img;new Uint32Array(be.buffer);let pe=4*ie,he=4;if(He<=256&&w==0){pe=Math.ceil(H*ie/8);var Ge=new Uint8Array(pe*ke);const Ie=ee[X];for(let ye=0;ye<ke;ye++){T=ye*pe;const Ne=ye*ie;if(H==8)for(var we=0;we<ie;we++)Ge[T+we]=Ie[Ne+we];else if(H==4)for(we=0;we<ie;we++)Ge[T+(we>>1)]|=Ie[Ne+we]<<4-4*(1&we);else if(H==2)for(we=0;we<ie;we++)Ge[T+(we>>2)]|=Ie[Ne+we]<<6-2*(3&we);else if(H==1)for(we=0;we<ie;we++)Ge[T+(we>>3)]|=Ie[Ne+we]<<7-1*(7&we)}be=Ge,D=3,he=1}else if(R==0&&K.length==1){Ge=new Uint8Array(ie*ke*3);const Ie=ie*ke;for(T=0;T<Ie;T++){const ye=3*T,Ne=4*T;Ge[ye]=be[Ne],Ge[ye+1]=be[Ne+1],Ge[ye+2]=be[Ne+2]}be=Ge,D=2,he=3,pe=3*ie}se.img=be,se.bpl=pe,se.bpp=he}return{ctype:D,depth:H,plte:O,frames:K}}function l(m,g,_,N,y,L,S){const A=Uint8Array,x=Uint32Array,w=new A(m[y-1]),B=new x(m[y-1]),D=y+1<m.length?new A(m[y+1]):null,H=new A(m[y]),ae=new x(H.buffer);let X=g,U=_,T=-1,R=-1;for(let Y=0;Y<L.height;Y++)for(let O=0;O<L.width;O++){const ee=L.x+O,te=L.y+Y,se=te*g+ee,ie=ae[se];ie==0||N[y-1].dispose==0&&B[se]==ie&&(D==null||D[4*se+3]!=0)||(ee<X&&(X=ee),ee>T&&(T=ee),te<U&&(U=te),te>R&&(R=te))}T==-1&&(X=U=T=R=0),S&&((1&X)==1&&X--,(1&U)==1&&U--),L={x:X,y:U,width:T-X+1,height:R-U+1};const K=N[y];K.rect=L,K.blend=1,K.img=new Uint8Array(L.width*L.height*4),N[y-1].dispose==0?(d(w,g,_,K.img,L.width,L.height,-L.x,-L.y,0),a(H,g,_,K.img,L)):d(H,g,_,K.img,L.width,L.height,-L.x,-L.y,0)}function a(m,g,_,N,y){d(m,g,_,N,y.width,y.height,-y.x,-y.y,2)}function h(m,g,_,N,y,L,S){const A=[];let x,w=[0,1,2,3,4];L!=-1?w=[L]:(g*N>5e5||_==1)&&(w=[0]),S&&(x={level:0});const B=An;for(var D=0;D<w.length;D++){for(let X=0;X<g;X++)f(y,m,X,N,_,w[D]);A.push(B.deflate(y,x))}let H,ae=1e9;for(D=0;D<A.length;D++)A[D].length<ae&&(H=D,ae=A[D].length);return A[H]}function f(m,g,_,N,y,L){const S=_*N;let A=S+_;if(m[A]=L,A++,L==0)if(N<500)for(var x=0;x<N;x++)m[A+x]=g[S+x];else m.set(new Uint8Array(g.buffer,S,N),A);else if(L==1){for(x=0;x<y;x++)m[A+x]=g[S+x];for(x=y;x<N;x++)m[A+x]=g[S+x]-g[S+x-y]+256&255}else if(_==0){for(x=0;x<y;x++)m[A+x]=g[S+x];if(L==2)for(x=y;x<N;x++)m[A+x]=g[S+x];if(L==3)for(x=y;x<N;x++)m[A+x]=g[S+x]-(g[S+x-y]>>1)+256&255;if(L==4)for(x=y;x<N;x++)m[A+x]=g[S+x]-r(g[S+x-y],0,0)+256&255}else{if(L==2)for(x=0;x<N;x++)m[A+x]=g[S+x]+256-g[S+x-N]&255;if(L==3){for(x=0;x<y;x++)m[A+x]=g[S+x]+256-(g[S+x-N]>>1)&255;for(x=y;x<N;x++)m[A+x]=g[S+x]+256-(g[S+x-N]+g[S+x-y]>>1)&255}if(L==4){for(x=0;x<y;x++)m[A+x]=g[S+x]+256-r(0,g[S+x-N],0)&255;for(x=y;x<N;x++)m[A+x]=g[S+x]+256-r(g[S+x-y],g[S+x-N],g[S+x-y-N])&255}}}function C(m,g){const _=new Uint8Array(m),N=_.slice(0),y=new Uint32Array(N.buffer),L=E(N,g),S=L[0],A=L[1],x=_.length,w=new Uint8Array(x>>2);let B;if(_.length<2e7)for(var D=0;D<x;D+=4)B=k(S,H=_[D]*(1/255),ae=_[D+1]*(1/255),X=_[D+2]*(1/255),U=_[D+3]*(1/255)),w[D>>2]=B.ind,y[D>>2]=B.est.rgba;else for(D=0;D<x;D+=4){var H=_[D]*.00392156862745098,ae=_[D+1]*(1/255),X=_[D+2]*(1/255),U=_[D+3]*(1/255);for(B=S;B.left;)B=$(B.est,H,ae,X,U)<=0?B.left:B.right;w[D>>2]=B.ind,y[D>>2]=B.est.rgba}return{abuf:N.buffer,inds:w,plte:A}}function E(m,g,_){_==null&&(_=1e-4);const N=new Uint32Array(m.buffer),y={i0:0,i1:m.length,bst:null,est:null,tdst:0,left:null,right:null};y.bst=I(m,y.i0,y.i1),y.est=v(y.bst);const L=[y];for(;L.length<g;){let A=0,x=0;for(var S=0;S<L.length;S++)L[S].est.L>A&&(A=L[S].est.L,x=S);if(A<_)break;const w=L[x],B=P(m,N,w.i0,w.i1,w.est.e,w.est.eMq255);if(w.i0>=B||w.i1<=B){w.est.L=0;continue}const D={i0:w.i0,i1:B,bst:null,est:null,tdst:0,left:null,right:null};D.bst=I(m,D.i0,D.i1),D.est=v(D.bst);const H={i0:B,i1:w.i1,bst:null,est:null,tdst:0,left:null,right:null};for(H.bst={R:[],m:[],N:w.bst.N-D.bst.N},S=0;S<16;S++)H.bst.R[S]=w.bst.R[S]-D.bst.R[S];for(S=0;S<4;S++)H.bst.m[S]=w.bst.m[S]-D.bst.m[S];H.est=v(H.bst),w.left=D,w.right=H,L[x]=D,L.push(H)}for(L.sort(((A,x)=>x.bst.N-A.bst.N)),S=0;S<L.length;S++)L[S].ind=S;return[y,L]}function k(m,g,_,N,y){if(m.left==null)return m.tdst=(function(D,H,ae,X,U){const T=H-D[0],R=ae-D[1],K=X-D[2],Y=U-D[3];return T*T+R*R+K*K+Y*Y})(m.est.q,g,_,N,y),m;const L=$(m.est,g,_,N,y);let S=m.left,A=m.right;L>0&&(S=m.right,A=m.left);const x=k(S,g,_,N,y);if(x.tdst<=L*L)return x;const w=k(A,g,_,N,y);return w.tdst<x.tdst?w:x}function $(m,g,_,N,y){const{e:L}=m;return L[0]*g+L[1]*_+L[2]*N+L[3]*y-m.eMq}function P(m,g,_,N,y,L){for(N-=4;_<N;){for(;M(m,_,y)<=L;)_+=4;for(;M(m,N,y)>L;)N-=4;if(_>=N)break;const S=g[_>>2];g[_>>2]=g[N>>2],g[N>>2]=S,_+=4,N-=4}for(;M(m,_,y)>L;)_-=4;return _+4}function M(m,g,_){return m[g]*_[0]+m[g+1]*_[1]+m[g+2]*_[2]+m[g+3]*_[3]}function I(m,g,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=[0,0,0,0],L=_-g>>2;for(let S=g;S<_;S+=4){const A=m[S]*.00392156862745098,x=m[S+1]*(1/255),w=m[S+2]*(1/255),B=m[S+3]*(1/255);y[0]+=A,y[1]+=x,y[2]+=w,y[3]+=B,N[0]+=A*A,N[1]+=A*x,N[2]+=A*w,N[3]+=A*B,N[5]+=x*x,N[6]+=x*w,N[7]+=x*B,N[10]+=w*w,N[11]+=w*B,N[15]+=B*B}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:y,N:L}}function v(m){const{R:g}=m,{m:_}=m,{N}=m,y=_[0],L=_[1],S=_[2],A=_[3],x=N==0?0:1/N,w=[g[0]-y*y*x,g[1]-y*L*x,g[2]-y*S*x,g[3]-y*A*x,g[4]-L*y*x,g[5]-L*L*x,g[6]-L*S*x,g[7]-L*A*x,g[8]-S*y*x,g[9]-S*L*x,g[10]-S*S*x,g[11]-S*A*x,g[12]-A*y*x,g[13]-A*L*x,g[14]-A*S*x,g[15]-A*A*x],B=w,D=F;let H=[Math.random(),Math.random(),Math.random(),Math.random()],ae=0,X=0;if(N!=0)for(let T=0;T<16&&(H=D.multVec(B,H),X=Math.sqrt(D.dot(H,H)),H=D.sml(1/X,H),!(T!=0&&Math.abs(X-ae)<1e-9));T++)ae=X;const U=[y*x,L*x,S*x,A*x];return{Cov:w,q:U,e:H,L:ae,eMq255:D.dot(D.sml(255,U),H),eMq:D.dot(H,U),rgba:(Math.round(255*U[3])<<24|Math.round(255*U[2])<<16|Math.round(255*U[1])<<8|Math.round(255*U[0])<<0)>>>0}}var F={multVec:(m,g)=>[m[0]*g[0]+m[1]*g[1]+m[2]*g[2]+m[3]*g[3],m[4]*g[0]+m[5]*g[1]+m[6]*g[2]+m[7]*g[3],m[8]*g[0]+m[9]*g[1]+m[10]*g[2]+m[11]*g[3],m[12]*g[0]+m[13]*g[1]+m[14]*g[2]+m[15]*g[3]],dot:(m,g)=>m[0]*g[0]+m[1]*g[1]+m[2]*g[2]+m[3]*g[3],sml:(m,g)=>[m*g[0],m*g[1],m*g[2],m*g[3]]};nt.encode=function(g,_,N,y,L,S,A){y==null&&(y=0),A==null&&(A=!1);const x=o(g,_,N,y,[!1,!1,!1,0,A,!1]);return p(x,-1),b(x,_,N,L,S)},nt.encodeLL=function(g,_,N,y,L,S,A,x){const w={ctype:0+(y==1?0:2)+(L==0?0:4),depth:S,frames:[]},B=(y+L)*S,D=B*_;for(let H=0;H<g.length;H++)w.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(g[H]),blend:0,dispose:1,bpp:Math.ceil(B/8),bpl:Math.ceil(D/8)});return p(w,0,!0),b(w,_,N,A,x)},nt.encode.compress=o,nt.encode.dither=c,nt.quantize=C,nt.quantize.getKDtree=E,nt.quantize.getNearest=k})();const Wr={toArrayBuffer(d,u){const r=d.width,n=d.height,t=r<<2,e=d.getContext("2d").getImageData(0,0,r,n),i=new Uint32Array(e.data.buffer),c=(32*r+31)/32<<2,b=c*n,p=122+b,o=new ArrayBuffer(p),l=new DataView(o),a=1<<20;let h,f,C,E,k=a,$=0,P=0,M=0;function I(m){l.setUint16(P,m,!0),P+=2}function v(m){l.setUint32(P,m,!0),P+=4}function F(m){P+=m}I(19778),v(p),F(4),v(122),v(108),v(r),v(-n>>>0),I(1),I(32),v(3),v(b),v(2835),v(2835),F(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),(function m(){for(;$<n&&k>0;){for(E=122+$*c,h=0;h<t;)k--,f=i[M++],C=f>>>24,l.setUint32(E+h,f<<8|C),h+=4;$++}M<i.length?(k=a,setTimeout(m,Wr._dly)):u(o)})()},toBlob(d,u){this.toArrayBuffer(d,(r=>{u(new Blob([r],{type:"image/bmp"}))}))},_dly:9};var Ye={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ln={[Ye.CHROME]:16384,[Ye.FIREFOX]:11180,[Ye.DESKTOP_SAFARI]:16384,[Ye.IE]:8192,[Ye.IOS]:4096,[Ye.ETC]:8192};const sr=typeof window<"u",Or=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,It=sr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Rn=(sr||Or)&&(It&&It.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Br=(sr||Or)&&(It&&It.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function or(d,u,r=Date.now()){return new Promise((n=>{const t=d.split(","),e=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]);let c=i.length;const b=new Uint8Array(c);for(;c--;)b[c]=i.charCodeAt(c);const p=new Blob([b],{type:e});p.name=u,p.lastModified=r,n(p)}))}function Hr(d){return new Promise(((u,r)=>{const n=new Br;n.onload=()=>u(n.result),n.onerror=t=>r(t),n.readAsDataURL(d)}))}function Gr(d){return new Promise(((u,r)=>{const n=new Image;n.onload=()=>u(n),n.onerror=t=>r(t),n.src=d}))}function xt(){if(xt.cachedResult!==void 0)return xt.cachedResult;let d=Ye.ETC;const{userAgent:u}=navigator;return/Chrom(e|ium)/i.test(u)?d=Ye.CHROME:/iP(ad|od|hone)/i.test(u)&&/WebKit/i.test(u)?d=Ye.IOS:/Safari/i.test(u)?d=Ye.DESKTOP_SAFARI:/Firefox/i.test(u)?d=Ye.FIREFOX:(/MSIE/i.test(u)||document.documentMode)&&(d=Ye.IE),xt.cachedResult=d,xt.cachedResult}function qr(d,u){const r=xt(),n=Ln[r];let t=d,e=u,i=t*e;const c=t>e?e/t:t/e;for(;i>n*n;){const b=(n+t)/2,p=(n+e)/2;b<p?(e=p,t=p*c):(e=b*c,t=b),i=t*e}return{width:t,height:e}}function $t(d,u){let r,n;try{if(r=new OffscreenCanvas(d,u),n=r.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),n=r.getContext("2d")}return r.width=d,r.height=u,[r,n]}function Vr(d,u){const{width:r,height:n}=qr(d.width,d.height),[t,e]=$t(r,n);return u&&/jpe?g/.test(u)&&(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)),e.drawImage(d,0,0,t.width,t.height),t}function Ut(){return Ut.cachedResult!==void 0||(Ut.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ut.cachedResult}function Ft(d,u={}){return new Promise((function(r,n){let t,e;var i=function(){try{return e=Vr(t,u.fileType||d.type),r([t,e])}catch(b){return n(b)}},c=function(b){try{var p=function(o){try{throw o}catch(l){return n(l)}};try{let o;return Hr(d).then((function(l){try{return o=l,Gr(o).then((function(a){try{return t=a,(function(){try{return i()}catch(h){return n(h)}})()}catch(h){return p(h)}}),p)}catch(a){return p(a)}}),p)}catch(o){p(o)}}catch(o){return n(o)}};try{if(Ut()||[Ye.DESKTOP_SAFARI,Ye.MOBILE_SAFARI].includes(xt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(d).then((function(b){try{return t=b,i()}catch{return c()}}),c)}catch{c()}}))}function zt(d,u,r,n,t=1){return new Promise((function(e,i){let c;if(u==="image/png"){let p,o,l;return p=d.getContext("2d"),{data:o}=p.getImageData(0,0,d.width,d.height),l=nt.encode([o.buffer],d.width,d.height,4096*t),c=new Blob([l],{type:u}),c.name=r,c.lastModified=n,b.call(this)}{let p=function(){return b.call(this)};if(u==="image/bmp")return new Promise((o=>Wr.toBlob(d,o))).then((function(o){try{return c=o,c.name=r,c.lastModified=n,p.call(this)}catch(l){return i(l)}}).bind(this),i);{let o=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&d instanceof OffscreenCanvas)return d.convertToBlob({type:u,quality:t}).then((function(l){try{return c=l,c.name=r,c.lastModified=n,o.call(this)}catch(a){return i(a)}}).bind(this),i);{let l;return l=d.toDataURL(u,t),or(l,r,n).then((function(a){try{return c=a,o.call(this)}catch(h){return i(h)}}).bind(this),i)}}}function b(){return e(c)}}))}function lt(d){d.width=0,d.height=0}function bt(){return new Promise((function(d,u){let r,n,t,e;return bt.cachedResult!==void 0?d(bt.cachedResult):or("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(i){try{return r=i,Ft(r).then((function(c){try{return n=c[1],zt(n,r.type,r.name,r.lastModified).then((function(b){try{return t=b,lt(n),Ft(t).then((function(p){try{return e=p[0],bt.cachedResult=e.width===1&&e.height===2,d(bt.cachedResult)}catch(o){return u(o)}}),u)}catch(p){return u(p)}}),u)}catch(b){return u(b)}}),u)}catch(c){return u(c)}}),u)}))}function Yr(d){return new Promise(((u,r)=>{const n=new Br;n.onload=t=>{const e=new DataView(t.target.result);if(e.getUint16(0,!1)!=65496)return u(-2);const i=e.byteLength;let c=2;for(;c<i;){if(e.getUint16(c+2,!1)<=8)return u(-1);const b=e.getUint16(c,!1);if(c+=2,b==65505){if(e.getUint32(c+=2,!1)!=1165519206)return u(-1);const p=e.getUint16(c+=6,!1)==18761;c+=e.getUint32(c+4,p);const o=e.getUint16(c,p);c+=2;for(let l=0;l<o;l++)if(e.getUint16(c+12*l,p)==274)return u(e.getUint16(c+12*l+8,p))}else{if((65280&b)!=65280)break;c+=e.getUint16(c,!1)}}return u(-1)},n.onerror=t=>r(t),n.readAsArrayBuffer(d)}))}function Zr(d,u){const{width:r}=d,{height:n}=d,{maxWidthOrHeight:t}=u;let e,i=d;return isFinite(t)&&(r>t||n>t)&&([i,e]=$t(r,n),r>n?(i.width=t,i.height=n/r*t):(i.width=r/n*t,i.height=t),e.drawImage(d,0,0,i.width,i.height),lt(d)),i}function Kr(d,u){const{width:r}=d,{height:n}=d,[t,e]=$t(r,n);switch(u>4&&u<9?(t.width=n,t.height=r):(t.width=r,t.height=n),u){case 2:e.transform(-1,0,0,1,r,0);break;case 3:e.transform(-1,0,0,-1,r,n);break;case 4:e.transform(1,0,0,-1,0,n);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,n,0);break;case 7:e.transform(0,-1,-1,0,n,r);break;case 8:e.transform(0,-1,1,0,0,r)}return e.drawImage(d,0,0,r,n),lt(d),t}function _r(d,u,r=0){return new Promise((function(n,t){let e,i,c,b,p,o,l,a,h,f,C,E,k,$,P,M,I,v,F,m;function g(N=5){if(u.signal&&u.signal.aborted)throw u.signal.reason;e+=N,u.onProgress(Math.min(e,100))}function _(N){if(u.signal&&u.signal.aborted)throw u.signal.reason;e=Math.min(Math.max(N,e),100),u.onProgress(e)}return e=r,i=u.maxIteration||10,c=1024*u.maxSizeMB*1024,g(),Ft(d,u).then((function(N){try{return[,b]=N,g(),p=Zr(b,u),g(),new Promise((function(y,L){var S;if(!(S=u.exifOrientation))return Yr(d).then((function(x){try{return S=x,A.call(this)}catch(w){return L(w)}}).bind(this),L);function A(){return y(S)}return A.call(this)})).then((function(y){try{return o=y,g(),bt().then((function(L){try{return l=L?p:Kr(p,o),g(),a=u.initialQuality||1,h=u.fileType||d.type,zt(l,h,d.name,d.lastModified,a).then((function(S){try{{let x=function(){if(i--&&(P>c||P>k)){let B,D;return B=m?.95*F.width:F.width,D=m?.95*F.height:F.height,[I,v]=$t(B,D),v.drawImage(F,0,0,B,D),a*=h==="image/png"?.85:.95,zt(I,h,d.name,d.lastModified,a).then((function(H){try{return M=H,lt(F),F=I,P=M.size,_(Math.min(99,Math.floor(($-P)/($-c)*100))),x}catch(ae){return t(ae)}}),t)}return[1]},w=function(){return lt(F),lt(I),lt(p),lt(l),lt(b),_(100),n(M)};if(f=S,g(),C=f.size>c,E=f.size>d.size,!C&&!E)return _(100),n(f);var A;return k=d.size,$=f.size,P=$,F=l,m=!u.alwaysKeepResolution&&C,(A=(function(B){for(;B;){if(B.then)return void B.then(A,t);try{if(B.pop){if(B.length)return B.pop()?w.call(this):B;B=x}else B=B.call(this)}catch(D){return t(D)}}}).bind(this))(x)}}catch(x){return t(x)}}).bind(this),t)}catch(S){return t(S)}}).bind(this),t)}catch(L){return t(L)}}).bind(this),t)}catch(y){return t(y)}}).bind(this),t)}))}const Mn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Yt;function Tn(d,u){return new Promise(((r,n)=>{Yt||(Yt=(function(i){const c=[];return c.push(i),URL.createObjectURL(new Blob(c))})(Mn));const t=new Worker(Yt);t.addEventListener("message",(function(i){if(u.signal&&u.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return n(new Error(i.data.error)),void t.terminate();r(i.data.file),t.terminate()}else u.onProgress(i.data.progress)})),t.addEventListener("error",n),u.signal&&u.signal.addEventListener("abort",(()=>{n(u.signal.reason),t.terminate()})),t.postMessage({file:d,imageCompressionLibUrl:u.libURL,options:{...u,onProgress:void 0,signal:void 0}})}))}function Oe(d,u){return new Promise((function(r,n){let t,e,i,c,b,p;if(t={...u},i=0,{onProgress:c}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=h=>{i=h,typeof c=="function"&&c(i)},!(d instanceof Blob||d instanceof Rn))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(d.type))return n(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||p)return _r(d,t).then((function(h){try{return e=h,a.call(this)}catch(f){return n(f)}}).bind(this),n);var o=(function(){try{return a.call(this)}catch(h){return n(h)}}).bind(this),l=function(h){try{return _r(d,t).then((function(f){try{return e=f,o()}catch(C){return n(C)}}),n)}catch(f){return n(f)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Tn(d,t).then((function(h){try{return e=h,o()}catch{return l()}}),l)}catch{l()}function a(){try{e.name=d.name,e.lastModified=d.lastModified}catch{}try{t.preserveExif&&d.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===d.type)&&(e=$r(d,e))}catch{}return r(e)}}))}Oe.getDataUrlFromFile=Hr,Oe.getFilefromDataUrl=or,Oe.loadImage=Gr,Oe.drawImageInCanvas=Vr,Oe.drawFileInCanvas=Ft,Oe.canvasToFile=zt,Oe.getExifOrientation=Yr,Oe.handleMaxWidthOrHeight=Zr,Oe.followExifOrientation=Kr,Oe.cleanupCanvasMemory=lt,Oe.isAutoOrientationInBrowser=bt,Oe.approximateBelowMaximumCanvasSizeOfBrowser=qr,Oe.copyExifWithoutOrientation=$r,Oe.getBrowserName=xt,Oe.version="2.0.2";var nr=function(d,u){return nr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])},nr(d,u)};function Dn(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");nr(d,u);function r(){this.constructor=d}d.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}var Fe=function(){return Fe=Object.assign||function(u){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e])}return u},Fe.apply(this,arguments)};var Zt,jr;function Un(){if(jr)return Zt;jr=1;var d=!1,u,r,n,t,e,i,c,b,p,o,l,a,h,f,C;function E(){if(!d){d=!0;var $=navigator.userAgent,P=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec($),M=/(Mac OS X)|(Windows)|(Linux)/.exec($);if(a=/\b(iPhone|iP[ao]d)/.exec($),h=/\b(iP[ao]d)/.exec($),o=/Android/i.exec($),f=/FBAN\/\w+;/i.exec($),C=/Mobile/i.exec($),l=!!/Win64/.exec($),P){u=P[1]?parseFloat(P[1]):P[5]?parseFloat(P[5]):NaN,u&&document&&document.documentMode&&(u=document.documentMode);var I=/(?:Trident\/(\d+.\d+))/.exec($);i=I?parseFloat(I[1])+4:u,r=P[2]?parseFloat(P[2]):NaN,n=P[3]?parseFloat(P[3]):NaN,t=P[4]?parseFloat(P[4]):NaN,t?(P=/(?:Chrome\/(\d+\.\d+))/.exec($),e=P&&P[1]?parseFloat(P[1]):NaN):e=NaN}else u=r=n=e=t=NaN;if(M){if(M[1]){var v=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec($);c=v?parseFloat(v[1].replace("_",".")):!0}else c=!1;b=!!M[2],p=!!M[3]}else c=b=p=!1}}var k={ie:function(){return E()||u},ieCompatibilityMode:function(){return E()||i>u},ie64:function(){return k.ie()&&l},firefox:function(){return E()||r},opera:function(){return E()||n},webkit:function(){return E()||t},safari:function(){return k.webkit()},chrome:function(){return E()||e},windows:function(){return E()||b},osx:function(){return E()||c},linux:function(){return E()||p},iphone:function(){return E()||a},mobile:function(){return E()||a||h||o||C},nativeApp:function(){return E()||f},android:function(){return E()||o},ipad:function(){return E()||h}};return Zt=k,Zt}var Kt,kr;function Pn(){if(kr)return Kt;kr=1;var d=!!(typeof window<"u"&&window.document&&window.document.createElement),u={canUseDOM:d,canUseWorkers:typeof Worker<"u",canUseEventListeners:d&&!!(window.addEventListener||window.attachEvent),canUseViewport:d&&!!window.screen,isInWorker:!d};return Kt=u,Kt}var Jt,Cr;function In(){if(Cr)return Jt;Cr=1;var d=Pn(),u;d.canUseDOM&&(u=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function r(n,t){if(!d.canUseDOM||t&&!("addEventListener"in document))return!1;var e="on"+n,i=e in document;if(!i){var c=document.createElement("div");c.setAttribute(e,"return;"),i=typeof c[e]=="function"}return!i&&u&&n==="wheel"&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i}return Jt=r,Jt}var Qt,Sr;function Fn(){if(Sr)return Qt;Sr=1;var d=Un(),u=In(),r=10,n=40,t=800;function e(i){var c=0,b=0,p=0,o=0;return"detail"in i&&(b=i.detail),"wheelDelta"in i&&(b=-i.wheelDelta/120),"wheelDeltaY"in i&&(b=-i.wheelDeltaY/120),"wheelDeltaX"in i&&(c=-i.wheelDeltaX/120),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(c=b,b=0),p=c*r,o=b*r,"deltaY"in i&&(o=i.deltaY),"deltaX"in i&&(p=i.deltaX),(p||o)&&i.deltaMode&&(i.deltaMode==1?(p*=n,o*=n):(p*=t,o*=t)),p&&!c&&(c=p<1?-1:1),o&&!b&&(b=o<1?-1:1),{spinX:c,spinY:b,pixelX:p,pixelY:o}}return e.getEventType=function(){return d.firefox()?"DOMMouseScroll":u("wheel")?"wheel":"mousewheel"},Qt=e,Qt}var Xt,Nr;function zn(){return Nr||(Nr=1,Xt=Fn()),Xt}var $n=zn();const Wn=gn($n);function On(d,u,r,n,t,e){e===void 0&&(e=0);var i=vt(d,u,e),c=i.width,b=i.height,p=Math.min(c,r),o=Math.min(b,n);return p>o*t?{width:o*t,height:o}:{width:p,height:p/t}}function Bn(d){return d.width>d.height?d.width/d.naturalWidth:d.height/d.naturalHeight}function St(d,u,r,n,t){t===void 0&&(t=0);var e=vt(u.width,u.height,t),i=e.width,c=e.height;return{x:Er(d.x,i,r.width,n),y:Er(d.y,c,r.height,n)}}function Er(d,u,r,n){var t=u*n/2-r/2;return Wt(d,-t,t)}function Ar(d,u){return Math.sqrt(Math.pow(d.y-u.y,2)+Math.pow(d.x-u.x,2))}function Lr(d,u){return Math.atan2(u.y-d.y,u.x-d.x)*180/Math.PI}function Hn(d,u,r,n,t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);var c=i?Gn:qn,b=vt(u.width,u.height,e),p=vt(u.naturalWidth,u.naturalHeight,e),o={x:c(100,((b.width-r.width/t)/2-d.x/t)/b.width*100),y:c(100,((b.height-r.height/t)/2-d.y/t)/b.height*100),width:c(100,r.width/b.width*100/t),height:c(100,r.height/b.height*100/t)},l=Math.round(c(p.width,o.width*p.width/100)),a=Math.round(c(p.height,o.height*p.height/100)),h=p.width>=p.height*n,f=h?{width:Math.round(a*n),height:a}:{width:l,height:Math.round(l/n)},C=Fe(Fe({},f),{x:Math.round(c(p.width-f.width,o.x*p.width/100)),y:Math.round(c(p.height-f.height,o.y*p.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:C}}function Gn(d,u){return Math.min(d,Math.max(0,u))}function qn(d,u){return u}function Vn(d,u,r,n,t,e){var i=vt(u.width,u.height,r),c=Wt(n.width/i.width*(100/d.width),t,e),b={x:c*i.width/2-n.width/2-i.width*c*(d.x/100),y:c*i.height/2-n.height/2-i.height*c*(d.y/100)};return{crop:b,zoom:c}}function Yn(d,u,r){var n=Bn(u);return r.height>r.width?r.height/(d.height*n):r.width/(d.width*n)}function Zn(d,u,r,n,t,e){r===void 0&&(r=0);var i=vt(u.naturalWidth,u.naturalHeight,r),c=Wt(Yn(d,u,n),t,e),b=n.height>n.width?n.height/d.height:n.width/d.width,p={x:((i.width-d.width)/2-d.x)*b,y:((i.height-d.height)/2-d.y)*b};return{crop:p,zoom:c}}function Rr(d,u){return{x:(u.x+d.x)/2,y:(u.y+d.y)/2}}function Kn(d){return d*Math.PI/180}function vt(d,u,r){var n=Kn(r);return{width:Math.abs(Math.cos(n)*d)+Math.abs(Math.sin(n)*u),height:Math.abs(Math.sin(n)*d)+Math.abs(Math.cos(n)*u)}}function Wt(d,u,r){return Math.min(Math.max(d,u),r)}function Tt(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return d.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var Jn=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Qn=1,Xn=3,es=1,ts=(function(d){Dn(u,d);function u(){var r=d!==null&&d.apply(this,arguments)||this;return r.cropperRef=z.createRef(),r.imageRef=z.createRef(),r.videoRef=z.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var n=!0;r.resizeObserver=new window.ResizeObserver(function(t){if(n){n=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(n){return n.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var n=r.computeSizes();n&&(r.previousCropSize=n,r.emitCropData(),r.setInitialCrop(n),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(n){if(r.props.initialCroppedAreaPercentages){var t=Vn(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=t.crop,i=t.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}else if(r.props.initialCroppedAreaPixels){var c=Zn(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=c.crop,i=c.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}},r.computeSizes=function(){var n,t,e,i,c,b,p=r.imageRef.current||r.videoRef.current;if(p&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var o=r.containerRect.width/r.containerRect.height,l=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((t=r.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,a=((e=r.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((i=r.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,h=p.offsetWidth<l||p.offsetHeight<a,f=l/a,C=void 0;if(h)switch(r.state.mediaObjectFit){default:case"contain":C=o>f?{width:r.containerRect.height*f,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/f};break;case"horizontal-cover":C={width:r.containerRect.width,height:r.containerRect.width/f};break;case"vertical-cover":C={width:r.containerRect.height*f,height:r.containerRect.height};break}else C={width:p.offsetWidth,height:p.offsetHeight};r.mediaSize=Fe(Fe({},C),{naturalWidth:l,naturalHeight:a}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var E=r.props.cropSize?r.props.cropSize:On(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((c=r.state.cropSize)===null||c===void 0?void 0:c.height)!==E.height||((b=r.state.cropSize)===null||b===void 0?void 0:b.width)!==E.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(E),r.setState({cropSize:E},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(E),E}},r.saveContainerPosition=function(){if(r.containerRef){var n=r.containerRef.getBoundingClientRect();r.containerPosition={x:n.left,y:n.top}}},r.onMouseDown=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(u.getMousePoint(n)))},r.onMouseMove=function(n){return r.onDrag(u.getMousePoint(n))},r.onScroll=function(n){r.currentDoc&&(n.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(n){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(n))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),n.touches.length===2?r.onPinchStart(n):n.touches.length===1&&r.onDragStart(u.getTouchPoint(n.touches[0]))))},r.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?r.onPinchMove(n):n.touches.length===1&&r.onDrag(u.getTouchPoint(n.touches[0]))},r.onGestureStart=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(n){if(n.preventDefault(),!r.isTouching){var t=u.getMousePoint(n),e=r.gestureZoomStart-1+n.scale;if(r.setNewZoom(e,t,{shouldUpdatePosition:!0}),r.props.onRotationChange){var i=r.gestureRotationStart+n.rotation;r.props.onRotationChange(i)}}},r.onGestureEnd=function(n){r.cleanEvents()},r.onDragStart=function(n){var t,e,i=n.x,c=n.y;r.dragStartPosition={x:i,y:c},r.dragStartCrop=Fe({},r.props.crop),(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t)},r.onDrag=function(n){var t=n.x,e=n.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(t===void 0||e===void 0)){var i=t-r.dragStartPosition.x,c=e-r.dragStartPosition.y,b={x:r.dragStartCrop.x+i,y:r.dragStartCrop.y+c},p=r.props.restrictPosition?St(b,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):b;r.props.onCropChange(p)}}))},r.onDragStopped=function(){var n,t;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(t=(n=r.props).onInteractionEnd)===null||t===void 0||t.call(n)},r.onWheel=function(n){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(n))){n.preventDefault();var t=u.getMousePoint(n),e=Wn(n).pixelY,i=r.props.zoom-e*r.props.zoomSpeed/200;r.setNewZoom(i,t,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var c,b;return(b=(c=r.props).onInteractionStart)===null||b===void 0?void 0:b.call(c)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var c,b;return(b=(c=r.props).onInteractionEnd)===null||b===void 0?void 0:b.call(c)})},250)}},r.getPointOnContainer=function(n,t){var e=n.x,i=n.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(e-t.x),y:r.containerRect.height/2-(i-t.y)}},r.getPointOnMedia=function(n){var t=n.x,e=n.y,i=r.props,c=i.crop,b=i.zoom;return{x:(t+c.x)/b,y:(e+c.y)/b}},r.setNewZoom=function(n,t,e){var i=e===void 0?{}:e,c=i.shouldUpdatePosition,b=c===void 0?!0:c;if(!(!r.state.cropSize||!r.props.onZoomChange)){var p=Wt(n,r.props.minZoom,r.props.maxZoom);if(b){var o=r.getPointOnContainer(t,r.containerPosition),l=r.getPointOnMedia(o),a={x:l.x*p-o.x,y:l.y*p-o.y},h=r.props.restrictPosition?St(a,r.mediaSize,r.state.cropSize,p,r.props.rotation):a;r.props.onCropChange(h)}r.props.onZoomChange(p)}},r.getCropData=function(){if(!r.state.cropSize)return null;var n=r.props.restrictPosition?St(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return Hn(n,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,e),r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.emitCropAreaChange=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.recomputeCropPosition=function(){var n,t;if(r.state.cropSize){var e=r.props.crop;if(r.isInitialized&&(!((n=r.previousCropSize)===null||n===void 0)&&n.width)&&(!((t=r.previousCropSize)===null||t===void 0)&&t.height)){var i=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(i){var c=r.state.cropSize.width/r.previousCropSize.width,b=r.state.cropSize.height/r.previousCropSize.height;e={x:r.props.crop.x*c,y:r.props.crop.y*b}}}var p=r.props.restrictPosition?St(e,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):e;r.previousCropSize=r.state.cropSize,r.props.onCropChange(p),r.emitCropData()}},r.onKeyDown=function(n){var t,e,i=r.props,c=i.crop,b=i.onCropChange,p=i.keyboardStep,o=i.zoom,l=i.rotation,a=p;if(r.state.cropSize){n.shiftKey&&(a*=.2);var h=Fe({},c);switch(n.key){case"ArrowUp":h.y-=a,n.preventDefault();break;case"ArrowDown":h.y+=a,n.preventDefault();break;case"ArrowLeft":h.x-=a,n.preventDefault();break;case"ArrowRight":h.x+=a,n.preventDefault();break;default:return}r.props.restrictPosition&&(h=St(h,r.mediaSize,r.state.cropSize,o,l)),n.repeat||(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t),b(h)}},r.onKeyUp=function(n){var t,e;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}r.emitCropData(),(e=(t=r.props).onInteractionEnd)===null||e===void 0||e.call(t)},r}return u.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Jn,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},u.prototype.componentWillUnmount=function(){var r,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},u.prototype.componentDidUpdate=function(r){var n,t,e,i,c,b,p,o,l;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((n=r.cropSize)===null||n===void 0?void 0:n.height)!==((t=this.props.cropSize)===null||t===void 0?void 0:t.height)||((e=r.cropSize)===null||e===void 0?void 0:e.width)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.width)?this.computeSizes():(((c=r.crop)===null||c===void 0?void 0:c.x)!==((b=this.props.crop)===null||b===void 0?void 0:b.x)||((p=r.crop)===null||p===void 0?void 0:p.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((l=this.videoRef.current)===null||l===void 0||l.load());var a=this.getObjectFit();a!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:a},this.computeSizes)},u.prototype.getAspect=function(){var r=this.props,n=r.cropSize,t=r.aspect;return n?n.width/n.height:t},u.prototype.getObjectFit=function(){var r,n,t,e;if(this.props.objectFit==="cover"){var i=this.imageRef.current||this.videoRef.current;if(i&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,b=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,p=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalHeight)||((e=this.videoRef.current)===null||e===void 0?void 0:e.videoHeight)||0,o=b/p;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},u.prototype.onPinchStart=function(r){var n=u.getTouchPoint(r.touches[0]),t=u.getTouchPoint(r.touches[1]);this.lastPinchDistance=Ar(n,t),this.lastPinchRotation=Lr(n,t),this.onDragStart(Rr(n,t))},u.prototype.onPinchMove=function(r){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var t=u.getTouchPoint(r.touches[0]),e=u.getTouchPoint(r.touches[1]),i=Rr(t,e);this.onDrag(i),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=Ar(t,e),b=n.props.zoom*(c/n.lastPinchDistance);n.setNewZoom(b,i,{shouldUpdatePosition:!1}),n.lastPinchDistance=c;var p=Lr(t,e),o=n.props.rotation+(p-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(o),n.lastPinchRotation=p})}},u.prototype.render=function(){var r=this,n,t=this.props,e=t.image,i=t.video,c=t.mediaProps,b=t.cropperProps,p=t.transform,o=t.crop,l=o.x,a=o.y,h=t.rotation,f=t.zoom,C=t.cropShape,E=t.showGrid,k=t.roundCropAreaPixels,$=t.style,P=$.containerStyle,M=$.cropAreaStyle,I=$.mediaStyle,v=t.classes,F=v.containerClassName,m=v.cropAreaClassName,g=v.mediaClassName,_=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return z.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(y){return r.containerRef=y},"data-testid":"container",style:P,className:Tt("reactEasyCrop_Container",F)},e?z.createElement("img",Fe({alt:"",className:Tt("reactEasyCrop_Image",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",g)},c,{src:e,ref:this.imageRef,style:Fe(Fe({},I),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(f,")")}),onLoad:this.onMediaLoad})):i&&z.createElement("video",Fe({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Tt("reactEasyCrop_Video",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",g)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:Fe(Fe({},I),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(f,")")}),controls:!1}),(Array.isArray(i)?i:[{src:i}]).map(function(N){return z.createElement("source",Fe({key:N.src},N))})),this.state.cropSize&&z.createElement("div",Fe({ref:this.cropperRef,style:Fe(Fe({},M),{width:k?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:k?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Tt("reactEasyCrop_CropArea",C==="round"&&"reactEasyCrop_CropAreaRound",E&&"reactEasyCrop_CropAreaGrid",m)},b)))},u.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:Xn,minZoom:Qn,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:es},u.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u})(z.Component);const We=[];for(let d=0;d<256;++d)We.push((d+256).toString(16).slice(1));function rs(d,u=0){return(We[d[u+0]]+We[d[u+1]]+We[d[u+2]]+We[d[u+3]]+"-"+We[d[u+4]]+We[d[u+5]]+"-"+We[d[u+6]]+We[d[u+7]]+"-"+We[d[u+8]]+We[d[u+9]]+"-"+We[d[u+10]]+We[d[u+11]]+We[d[u+12]]+We[d[u+13]]+We[d[u+14]]+We[d[u+15]]).toLowerCase()}let er;const ns=new Uint8Array(16);function ss(){if(!er){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");er=crypto.getRandomValues.bind(crypto)}return er(ns)}const os=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mr={randomUUID:os};function as(d,u,r){d=d||{};const n=d.random??d.rng?.()??ss();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,rs(n)}function is(d,u,r){return Mr.randomUUID&&!d?Mr.randomUUID():as(d)}const Tr=50,Dt=d=>{let u=null;if(d.reply_to){const r=Array.isArray(d.reply_to)?d.reply_to[0]:d.reply_to;d.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",d.reply_to_message_id,"reply_to:",d.reply_to,"replyToData:",r),r&&console.log("[normalizeMessage] replyToData.id:",r.id,"replyToData.user_id:",r.user_id,"replyToData.content:",r.content)),r&&r.id&&r.user_id?u={id:r.id,content:r.content||"",user_id:r.user_id,author_name:r.author_name}:d.reply_to_message_id&&r&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",r,"has id:",!!r?.id,"has user_id:",!!r?.user_id)}return{id:d.id,league_id:d.league_id,user_id:d.user_id,content:d.content,created_at:d.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:d.reply_to_message_id??null,reply_to:u}},Nt=d=>{const u=new Map;for(const r of d)u.set(r.id,r);return Array.from(u.values()).sort((r,n)=>new Date(r.created_at).getTime()-new Date(n.created_at).getTime())};function ls(d,u={}){const{userId:r,enabled:n=!0,autoSubscribe:t=!0}=u,[e,i]=z.useState([]),[c,b]=z.useState(!1),[p,o]=z.useState(!1),[l,a]=z.useState(!0),[h,f]=z.useState(null),C=z.useRef(null),E=z.useCallback(v=>{i(F=>{const m=v(F);return C.current=m.length?m[0].created_at:null,m})},[]),k=z.useCallback(async({before:v,append:F})=>{if(!d||!n)return;console.log("[fetchPage] Starting fetch for league:",d,"append:",F,"before:",v);const m=le.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",d).order("created_at",{ascending:!1}).limit(Tr);v&&m.lt("created_at",v);const{data:g,error:_}=await m;if(_)throw console.error("[useMiniLeagueChat] Error fetching messages:",_),_;console.log("[fetchPage] Fetched",g?.length||0,"messages from database");const N=(g??[]).filter(A=>A.reply_to_message_id),y=[...new Set(N.map(A=>A.reply_to_message_id))];console.log("[fetchPage] Found",N.length,"messages with reply_to_message_id, unique reply IDs:",y.length);let L=new Map;if(y.length>0){const{data:A,error:x}=await le.from("league_messages").select("id, content, user_id").in("id",y);x&&console.error("[useMiniLeagueChat] Error fetching reply messages:",x),!x&&A&&A.forEach(w=>{L.set(w.id,w)})}if(g&&g.length>0){const A=g.filter(x=>x.reply_to_message_id);A.length>0&&(console.log("[fetchPage] Found",A.length,"messages with reply_to_message_id"),A.slice(0,3).forEach(x=>{const w=L.get(x.reply_to_message_id);console.log("[fetchPage] Message",x.id,"reply_to_message_id:",x.reply_to_message_id,"replyData:",w)}))}const S=(g??[]).map(A=>{if(A.reply_to_message_id){const x=L.get(A.reply_to_message_id);x?A.reply_to=x:A.reply_to=null}else A.reply_to=null;return Dt(A)}).reverse();E(A=>Nt(F?[...S,...A]:S)),(g??[]).length<Tr?a(!1):F||a(!0)},[d,n,E]),$=z.useCallback(async()=>{if(!d||!n){i([]),a(!0);return}b(!0),f(null),C.current=null;try{await k({append:!1})}catch(v){console.error("[useMiniLeagueChat] Error in refresh:",v),f(v?.message??"Failed to load chat")}finally{b(!1)}},[d,n,k]);z.useEffect(()=>{if(!d||!n){i([]),a(!0);return}let v=!0;if($(),!t)return()=>{v=!1};const F=le.channel(`league-messages:${d}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${d}`},async g=>{if(!v)return;const{data:_}=await le.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",g.new.id).single();if(_){if(_.reply_to_message_id){const{data:y}=await le.from("league_messages").select("id, content, user_id").eq("id",_.reply_to_message_id).single();y&&(_.reply_to=y)}const N=Dt(_);E(y=>y.some(L=>L.id===N.id)?y:Nt([...y,N]))}else{console.warn("[useMiniLeagueChat] Failed to fetch full message, using payload data:",g.new.id);const N=Dt(g.new);E(y=>y.some(L=>L.id===N.id)?y:Nt([...y,N]))}}).subscribe(),m=()=>{v&&document.visibilityState==="visible"&&$()};return document.addEventListener("visibilitychange",m),()=>{v=!1,document.removeEventListener("visibilitychange",m),le.removeChannel(F)}},[d,n,t,$,E]);const P=z.useCallback(async()=>{if(!d||!n||!l||p)return;const v=C.current??e[0]?.created_at;if(v){o(!0);try{await k({before:v,append:!0})}catch(F){console.error("[useMiniLeagueChat] Error loading more messages:",F),f(F?.message??"Failed to load more messages")}finally{o(!1)}}},[d,n,l,p,k,e]),M=z.useCallback(async(v,F)=>{if(!d||!r)throw new Error("Missing league or user");const m=v.trim();if(!m)return;const g=is(),_=`optimistic-${g}`,N={id:_,client_msg_id:g,league_id:d,user_id:r,content:m,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:F??null};E(S=>Nt([...S,N]));const{data:y,error:L}=await le.from("league_messages").insert({league_id:d,user_id:r,content:m,reply_to_message_id:F??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(y&&y.reply_to_message_id){const{data:S}=await le.from("league_messages").select("id, content, user_id").eq("id",y.reply_to_message_id).single();S&&(y.reply_to=S)}if(L)throw console.error("[useMiniLeagueChat] Error sending message:",L),E(S=>S.map(A=>A.id===_?{...A,status:"error"}:A)),L;if(y){const S=Dt(y);S.client_msg_id=g,E(A=>A.map(x=>x.id===_?{...S,status:"sent",client_msg_id:g}:x))}},[d,r,E]),I=z.useMemo(()=>e.slice(-5),[e]);return{messages:e,previewMessages:I,loading:c,loadingMore:p,hasMore:l,error:h,refresh:$,loadMore:P,sendMessage:M}}const cs={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},ds={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},us=["","",""],fs=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function hs({author:d,text:u,time:r,isOwnMessage:n,shape:t="single",messageId:e,reactions:i=[],onReactionClick:c,replyTo:b,onMessageClick:p}){const o=n?"text-right":"text-left",l=n?"bg-[#1C8376] text-white":"bg-white text-slate-900",a=n?ds:cs,h="max-w-[80%]",[f,C]=z.useState(!1),[E,k]=z.useState(!1),$=z.useRef(null);z.useEffect(()=>{if(!f)return;const I=F=>{$.current&&!$.current.contains(F.target)&&C(!1)},v=setTimeout(()=>{document.addEventListener("mousedown",I)},100);return()=>{clearTimeout(v),document.removeEventListener("mousedown",I)}},[f]);const P=I=>{e&&c&&c(e,I),C(!1),k(!1)},M=I=>{const v=I.target;v.closest("button")||v.closest("[data-reaction]")||p&&p()};return s.jsxs("div",{className:`inline-block w-fit ${h} min-w-0 relative`,children:[s.jsxs("div",{className:`px-3 py-2 text-sm leading-snug shadow-sm whitespace-normal break-words ${o} ${l} ${a[t]} ${p?"cursor-pointer hover:opacity-90 transition-opacity":""}`,onClick:M,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[d&&!n&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:d}),b&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${n?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-sm`,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[s.jsx("div",{className:"font-medium text-xs mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:b.authorName||"Unknown"}),s.jsx("div",{className:"text-xs line-clamp-2 truncate break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:b.content})]}),s.jsx("div",{style:{wordBreak:"break-word",overflowWrap:"break-word"},children:u}),s.jsx("div",{className:"text-[11px] text-[#DCDCDD] mt-1",children:r})]}),e&&!n&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[f&&s.jsxs("div",{ref:$,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[us.map(I=>s.jsx("button",{onClick:()=>P(I),className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-base",title:`React with ${I}`,children:I},I)),p&&s.jsx("button",{onClick:()=>{C(!1),p()},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{C(!1),k(!0)},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>C(!f),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200 transition-colors flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),E&&e&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>k(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>k(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:fs.map(I=>s.jsx("button",{onClick:()=>{e&&c&&c(e,I),k(!1)},className:"w-10 h-10 rounded-lg hover:bg-slate-100 active:bg-slate-200 transition-colors flex items-center justify-center text-2xl",title:I,children:I},I))})]})})]}),i.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${n?"justify-end":"justify-start"}`,children:i.map(I=>s.jsxs("button",{onClick:()=>P(I.emoji),className:`px-2 py-0.5 rounded-full text-xs flex items-center gap-1 transition-colors ${I.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:[s.jsx("span",{children:I.emoji}),s.jsx("span",{children:I.count})]},I.emoji))})]})}function ms({author:d,messages:u,isOwnMessage:r,avatarInitials:n,userId:t,reactions:e,onReactionClick:i,onMessageClick:c}){d==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",r,"messages:",u.length);const b=r?"justify-end":"justify-start",p=t===Fr;return s.jsxs("div",{className:`flex items-end gap-3 w-full ${b}`,children:[r?s.jsx("div",{className:"w-10 flex-shrink-0"}):p?s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:xn,alt:"Volley",className:"w-10 h-10 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-sm font-semibold text-slate-500 flex-shrink-0",children:(n||d.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:u.map((o,l)=>{const a=u.length===1?"single":l===0?"top":l===u.length-1?"bottom":"middle",h=o.messageId||o.id;let f="";if(typeof o.text=="string")f=o.text;else if(typeof o.text=="object"&&o.text!==null){const C=o.text?.props?.children||String(o.text);f=typeof C=="string"?C:String(C)}else f=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${r?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${r?"justify-end":"justify-start"}`,children:[s.jsx(hs,{author:!r&&l===0?d:void 0,text:o.text,time:o.time,isOwnMessage:r,shape:a,messageId:h,reactions:e?.[h]||[],onReactionClick:i,replyTo:o.replyTo,onMessageClick:c?()=>c(h,f,!r&&l===0?d:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function ps({groups:d,reactions:u,onReactionClick:r,onMessageClick:n}){const t=d.filter(e=>e.author==="Unknown");return t.length>0&&(console.error("[ChatThread] RENDERING with",t.length,'groups with "Unknown" author!'),t.forEach((e,i)=>{console.error(`[ChatThread] Group ${i}: id="${e.id}", author="${e.author}", messages=${e.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:d.map((e,i)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[e.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:e.dayLabel}),s.jsx(ms,{author:e.author,avatarInitials:e.avatarInitials,isOwnMessage:e.isOwnMessage,userId:e.userId,messages:e.messages,reactions:u,onReactionClick:r,onMessageClick:n},`${e.id}-${e.author}-${i}`)]},`${e.id}-${e.author}-${i}`))})}const gs=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),xs=d=>new Date(d).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Dr=d=>{if(!d)return"?";const u=d.trim().split(/\s+/);return u.length===1?u[0][0]?.toUpperCase()??"?":`${u[0][0]?.toUpperCase()??""}${u[u.length-1][0]?.toUpperCase()??""}`},Et=(d,u)=>u?u instanceof Map?u.get(d)??"":u[d]??"":"";function ws({miniLeagueId:d,memberNames:u,deepLinkError:r}){const{user:n}=zr(),{messages:t,loading:e,loadingMore:i,hasMore:c,error:b,loadMore:p,sendMessage:o}=ls(d,{userId:n?.id,enabled:!!d}),[l,a]=z.useState(""),[h,f]=z.useState(!1),[C,E]=z.useState({}),[k,$]=z.useState(null),[P,M]=z.useState([]);z.useEffect(()=>{if(!d||!n?.id)return;const U=async()=>{try{const{error:R}=await le.from("chat_presence").upsert({league_id:d,user_id:n.id,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"});R&&console.error("[MiniLeagueChatBeta] Failed to update presence:",R)}catch(R){console.error("[MiniLeagueChatBeta] Failed to update presence:",R)}};U();const T=setInterval(U,1e4);return()=>{clearInterval(T)}},[d,n?.id]);const[I,v]=z.useState(0),F=z.useRef(null),m=z.useRef(null),g=z.useRef(null),[_,N]=z.useState(0),y=z.useCallback(()=>{F.current&&(F.current.scrollTop=F.current.scrollHeight)},[]),L=z.useCallback((U=[0,100,300,500,700])=>{requestAnimationFrame(()=>{U.forEach(T=>{setTimeout(()=>y(),T)})})},[y]);z.useEffect(()=>{if(t.length===0||!n?.id)return;const U=t.map(R=>R.id).filter(R=>!R.startsWith("optimistic-"));if(U.length===0)return;(async()=>{try{const{data:R,error:K}=await le.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",U);if(K){console.error("[MiniLeagueChatBeta] Error loading reactions:",K),M(ee=>[...ee,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${K.message}`,timestamp:Date.now()}]);return}const Y={};(R||[]).forEach(ee=>{Y[ee.message_id]||(Y[ee.message_id]={}),Y[ee.message_id][ee.emoji]||(Y[ee.message_id][ee.emoji]={count:0,hasUserReacted:!1}),Y[ee.message_id][ee.emoji].count++,ee.user_id===n.id&&(Y[ee.message_id][ee.emoji].hasUserReacted=!0)});const O={};Object.keys(Y).forEach(ee=>{O[ee]=Object.entries(Y[ee]).map(([te,se])=>({emoji:te,count:se.count,hasUserReacted:se.hasUserReacted}))}),E(O)}catch(R){console.error("[MiniLeagueChatBeta] Error in loadReactions:",R),M(K=>[...K,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${R?.message||String(R)}`,timestamp:Date.now()}])}})()},[t,n?.id]),z.useEffect(()=>{if(t.length===0||!n?.id)return;const U=t.map(R=>R.id).filter(R=>!R.startsWith("optimistic-"));if(U.length===0)return;const T=le.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:K,error:Y}=await le.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",U);if(Y){console.error("[MiniLeagueChatBeta] Error reloading reactions:",Y),M(te=>[...te,{id:`reactions-reload-${Date.now()}`,message:`Failed to reload reactions: ${Y.message}`,timestamp:Date.now()}]);return}const O={};(K||[]).forEach(te=>{O[te.message_id]||(O[te.message_id]={}),O[te.message_id][te.emoji]||(O[te.message_id][te.emoji]={count:0,hasUserReacted:!1}),O[te.message_id][te.emoji].count++,te.user_id===n.id&&(O[te.message_id][te.emoji].hasUserReacted=!0)});const ee={};Object.keys(O).forEach(te=>{ee[te]=Object.entries(O[te]).map(([se,ie])=>({emoji:se,count:ie.count,hasUserReacted:ie.hasUserReacted}))}),E(ee)}catch(K){console.error("[MiniLeagueChatBeta] Error in reaction subscription handler:",K),M(Y=>[...Y,{id:`reactions-sub-${Date.now()}`,message:`Error updating reactions: ${K?.message||String(K)}`,timestamp:Date.now()}])}})()}).subscribe();return()=>{le.removeChannel(T)}},[t,n?.id]);const S=z.useCallback(async(U,T)=>{if(!n?.id)return;const K=(C[U]||[]).find(Y=>Y.emoji===T&&Y.hasUserReacted);if(E(Y=>{const O={...Y},ee=O[U]||[];if(K){const te=ee.map(se=>se.emoji===T?{...se,count:Math.max(0,se.count-1),hasUserReacted:!1}:se).filter(se=>se.count>0||se.emoji!==T);te.length===0?delete O[U]:O[U]=te}else ee.find(se=>se.emoji===T)?O[U]=ee.map(se=>se.emoji===T?{...se,count:se.count+1,hasUserReacted:!0}:se):O[U]=[...ee,{emoji:T,count:1,hasUserReacted:!0}];return O}),K){const{error:Y}=await le.from("league_message_reactions").delete().eq("message_id",U).eq("user_id",n.id).eq("emoji",T);Y&&E(O=>{const ee={...O},te=ee[U]||[];return te.find(ie=>ie.emoji===T)?ee[U]=te.map(ie=>ie.emoji===T?{...ie,count:ie.count+1,hasUserReacted:!0}:ie):ee[U]=[...te,{emoji:T,count:1,hasUserReacted:!0}],ee})}else{const{error:Y}=await le.from("league_message_reactions").upsert({message_id:U,user_id:n.id,emoji:T});Y&&(console.error("[MiniLeagueChatBeta] Error adding reaction:",Y),M(O=>[...O,{id:`reaction-add-${Date.now()}`,message:`Failed to add reaction: ${Y.message}`,timestamp:Date.now()}]),E(O=>{const ee={...O},se=(ee[U]||[]).map(ie=>ie.emoji===T?{...ie,count:Math.max(0,ie.count-1),hasUserReacted:!1}:ie).filter(ie=>ie.count>0||ie.emoji!==T);return se.length===0?delete ee[U]:ee[U]=se,ee}))}},[n?.id,C]);z.useEffect(()=>{t.length>0&&L([0,150,300])},[t.length,L]),z.useEffect(()=>{!l&&m.current&&(m.current.style.height="auto",m.current.style.height="42px")},[l]);const A=z.useCallback((U,T=[0,100,300,500,700])=>{const R=g.current?.offsetHeight||72;if(U>0){const K=U+R;N(U),F.current&&(F.current.style.paddingBottom=`${K+8}px`)}else N(0),F.current&&(F.current.style.paddingBottom=`${R+8}px`);L(T)},[L]);z.useEffect(()=>{const U=window.visualViewport;let T=null,R=0,K=!1;const Y=()=>{if(U){const ie=window.innerHeight,He=U.height,Ge=U.offsetTop+He;return Math.max(0,ie-Ge)}else return 0},O=()=>{T&&(clearTimeout(T),T=null),T=setTimeout(()=>{const ie=Y();Math.abs(ie-R)<10&&ie>0&&!K||(R=ie,A(ie))},50)};U&&(U.addEventListener("resize",O),U.addEventListener("scroll",O)),window.addEventListener("resize",O);const ee=()=>{K=!0,setTimeout(O,50),setTimeout(O,150),setTimeout(O,300),setTimeout(O,500)},te=()=>{K=!1,setTimeout(O,100)},se=setTimeout(()=>{m.current&&(m.current.addEventListener("focus",ee),m.current.addEventListener("blur",te))},100);return O(),()=>{T&&clearTimeout(T),clearTimeout(se),U&&(U.removeEventListener("resize",O),U.removeEventListener("scroll",O)),window.removeEventListener("resize",O),m.current&&(m.current.removeEventListener("focus",ee),m.current.removeEventListener("blur",te))}},[A]),z.useEffect(()=>{if(typeof window>"u")return;const U=()=>{const T=window.visualViewport;let R=0;if(T){const K=window.innerHeight,Y=T.height,O=T.offsetTop+Y;R=Math.max(0,K-O)}A(R)};return window.addEventListener("resize",U),()=>window.removeEventListener("resize",U)},[A]),z.useEffect(()=>{if(F.current&&g.current){const U=g.current.offsetHeight||72;F.current.style.paddingBottom=`${U+8}px`}},[]);const x=()=>{m.current&&m.current.removeAttribute("readonly");const U=()=>{const T=window.visualViewport;let R=0;if(T){const K=window.innerHeight,Y=T.height,O=T.offsetTop+Y;R=Math.max(0,K-O)}A(R,[0,100,200,400,600,800])};setTimeout(U,50),setTimeout(U,150),setTimeout(U,300),setTimeout(U,500),L([100,200,400,600])},w=U=>{const T=U.target;!(T.tagName==="A"||T.tagName==="BUTTON"||T.closest("a, button"))&&m.current&&document.activeElement===m.current&&m.current.blur()},B=z.useMemo(()=>{if(!n)return"";const U=n.user_metadata??{};return U.display_name||U.full_name||n.email||""},[n]),D=z.useMemo(()=>{if(!t.length)return[];if(!(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1))return[];let T=null;return t.reduce((Y,O)=>{const ee=O.user_id===n?.id,ie=Et(O.user_id,u)||(ee?B:"")||(ee?"You":"Unknown"),He=ee?void 0:Dr(ie),we=new Date(O.created_at).toDateString(),ke=we!==T;ke&&(T=we);const be=O.reply_to?Et(O.reply_to.user_id,u)||"Unknown":null,pe={id:O.id,text:O.content,time:gs(O.created_at),status:O.status&&O.status!=="sent"?O.status:void 0,messageId:O.id,replyTo:O.reply_to?{id:O.reply_to.id,content:O.reply_to.content,authorName:be||void 0}:null},he=Y[Y.length-1],Ie=he?.messages.length>0&&he.messages[0].messageId?t.find(Ne=>Ne.id===he.messages[0].messageId)?.user_id:null;if(he&&!ke&&he.isOwnMessage===ee&&Ie===O.user_id){const Ne=he.id.includes("-")?he.id.split("-")[0]:he.id,_e=he.messages.map(Le=>{const qe=Le.messageId?t.find(Je=>Je.id===Le.messageId):null;if(qe?.reply_to){const Je=Et(qe.reply_to.user_id,u)||"Unknown";return{...Le,replyTo:Le.replyTo?{...Le.replyTo,authorName:Je}:null}}return Le}),je={...he,id:`${Ne}-${ie}`,author:ie,avatarInitials:He,userId:O.user_id,messages:[..._e,pe]};return[...Y.slice(0,-1),je]}else return[...Y,{id:`${O.id}-${ie}`,author:ie,avatarInitials:He,isOwnMessage:ee,userId:O.user_id,dayLabel:ke?xs(O.created_at):void 0,messages:[pe]}]},[]).map(Y=>{const O={...Y},ee=O.messages.map(te=>{const se=te.messageId?t.find(ie=>ie.id===te.messageId):null;if(se?.reply_to&&te.replyTo){const ie=Et(se.reply_to.user_id,u)||"Unknown";if(ie!==te.replyTo.authorName)return{...te,replyTo:{...te.replyTo,authorName:ie}}}return te});if(O.author==="Unknown"&&O.messages.length>0&&O.messages[0].messageId){const te=t.find(se=>se.id===O.messages[0].messageId);if(te){const se=Et(te.user_id,u);if(se&&se!=="Unknown"){const ie=O.id.includes("-")?O.id.split("-")[0]:O.id;return{...O,id:`${ie}-${se}`,author:se,avatarInitials:Dr(se),userId:te.user_id,messages:ee}}}}return{...O,messages:ee}})},[B,u,t,n?.id,I]);z.useEffect(()=>{(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1)&&I===0&&v(1)},[u,I]),z.useEffect(()=>{const U=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1,T=D.some(R=>R.author==="Unknown");U&&T&&D.length>0&&(setTimeout(()=>{v(R=>R+1)},50),setTimeout(()=>{v(R=>R+1)},200))},[D,u]);const H=z.useMemo(()=>{const U=D.map(R=>R.author).join(","),T=D.some(R=>R.author==="Unknown");return`chat-${D.length}-${T?"unknown":"resolved"}-${I}-${U.slice(0,50)}`},[D,I]),ae=z.useCallback(async U=>{if(!d||!n?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const R=n.user_metadata?.display_name||n.user_metadata?.full_name||n.email||"User",K={timestamp:new Date().toISOString(),leagueId:d,senderId:n.id,ok:!1,sent:0,error:"Unknown error"};try{const Y=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:d,senderId:n.id,senderName:R,content:U,activeUserIds:[n.id]})}),O=await Y.json().catch(ee=>(K.error=`Failed to parse response: ${ee?.message||String(ee)}`,K.httpStatus=Y.status,{ok:!1,error:"Failed to parse response"}));Object.assign(K,{ok:O.ok,sent:O.sent||0,recipients:O.recipients||0,message:O.message,error:O.error,details:O.details,httpStatus:Y.status,fullResponse:O})}catch(Y){K.error=Y?.message||String(Y),K.exception=!0}finally{try{const Y=JSON.parse(localStorage.getItem("notification_logs")||"[]");Y.push(K);const O=Y.slice(-50);localStorage.setItem("notification_logs",JSON.stringify(O))}catch(Y){console.error("[MiniLeagueChatBeta] Error storing notification log:",Y),M(O=>[...O,{id:`notif-log-${Date.now()}`,message:`Failed to log notification: ${Y?.message||String(Y)}`,timestamp:Date.now()}])}}},[d,n?.id]),X=z.useCallback(async()=>{const U=l.trim();if(!(!d||!U||h))try{f(!0),a(""),m.current&&(m.current.style.height="auto",m.current.style.height="42px"),await o(U,k?.id||null),await ae(U),$(null),L([0,150,300])}catch(T){console.error("[MiniLeagueChatBeta] Error sending message:",T),M(R=>[...R,{id:`send-${Date.now()}`,message:`Failed to send message: ${T?.message||String(T)}`,timestamp:Date.now()}]),a(U)}finally{f(!1)}},[l,d,ae,L,o,h,k]);return z.useEffect(()=>{r&&M(U=>U.some(T=>T.message.includes("Deep Link"))?U:[...U,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${r}`,timestamp:Date.now()}])},[r]),z.useEffect(()=>{if(P.length===0)return;const U=setTimeout(()=>{M(T=>T.filter(R=>Date.now()-R.timestamp<5e3))},5e3);return()=>clearTimeout(U)},[P]),s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[P.length>0&&s.jsx("div",{className:"px-4 pt-2 space-y-2",children:P.map(U=>s.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[s.jsx("span",{className:"flex-1",children:U.message}),s.jsx("button",{onClick:()=>M(T=>T.filter(R=>R.id!==U.id)),className:"text-red-600 hover:text-red-800 flex-shrink-0",children:""})]},U.id))}),s.jsxs("div",{ref:F,className:"flex-1 overflow-y-auto px-4 py-5",onClick:w,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%"},children:[c&&d&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:p,disabled:i,children:i?"Loading earlier":"Load earlier messages"}),D.length===0&&!e?s.jsx("div",{className:"text-center text-sm text-slate-500 mt-8",children:"Say hi to kick off this chat!"}):s.jsx(ps,{groups:D,reactions:C,onReactionClick:S,onMessageClick:(U,T,R)=>{const K=t.find(Y=>Y.id===U);if(K){let Y="";if(typeof T=="string")Y=T;else if(typeof T=="object"&&T!==null){const O=T?.props?.children||String(T);Y=typeof O=="string"?O:String(O)}else Y=String(T);$({id:U,content:Y||K.content,authorName:R}),setTimeout(()=>{m.current?.focus()},100)}}},H)]}),s.jsxs("div",{ref:g,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:_>0?"fixed":"relative",bottom:_>0?`${_}px`:"0",left:_>0?0:"auto",right:_>0?0:"auto",width:"100%",maxWidth:_>0?"440px":"100%",marginLeft:_>0?"auto":void 0,marginRight:_>0?"auto":void 0,zIndex:_>0?100:"auto",boxShadow:_>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[k&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",k.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:k.content})]}),s.jsx("button",{onClick:()=>$(null),className:"flex-shrink-0 w-5 h-5 rounded-full hover:bg-slate-200 flex items-center justify-center text-slate-500 transition-colors",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:m,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:l,disabled:!d||h,placeholder:d?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",onKeyDown:U=>{if(U.key==="Escape"&&k){$(null),U.preventDefault();return}U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),X())},onChange:U=>{a(U.target.value),m.current&&(m.current.style.height="auto",m.current.style.height=`${Math.min(m.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const T=window.visualViewport;if(T){const R=window.innerHeight,K=T.height,Y=T.offsetTop+K,O=R-Y;A(O,[0,100])}})},onFocus:x,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:X,disabled:!d||h||!l.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),b&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[b,"  try again or switch to the classic chat tab."]})]})]})}function bs({winnerName:d,isDraw:u}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:u?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[d," Wins!"]})})})}function vs({availableGws:d,selectedGw:u,onChange:r,className:n=""}){return d.length<=1?null:s.jsx("div",{className:`flex-1 ${n}`,children:s.jsx("select",{value:u||void 0,onChange:t=>{const e=parseInt(t.target.value,10);r(e)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:d.map(t=>s.jsxs("option",{value:t,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",t]},t))})})}function ys({showForm:d,onToggle:u}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>u(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"text-slate-600 hover:text-slate-900 hover:bg-white/50":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>u(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"Form"})]})}function _s({form:d}){const u=d.slice(-5),r=5-u.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:r}).map((n,t)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${t}`)),u.map((n,t)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${n==="W"?"bg-green-100 text-green-700":n==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n},t))]})}function js({rows:d,members:u,showForm:r,currentUserId:n,loading:t,isLateStartingLeague:e}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),r?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:e?"CP":"OCP"}),u.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[d.map((i,c)=>{const b=i.user_id===n,p=c===d.length-1;return s.jsxs("tr",{className:b?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...p?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:i.name}),r?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(_s,{form:i.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.ocp}),u.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:i.mltPts})]})]},i.user_id)}),t&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!t&&!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function ks({rows:d,members:u,currentUserId:r,positionChangeKeys:n,isApiTestLeague:t,hasLiveFixtures:e,hasStartingSoonFixtures:i,hasStartedFixtures:c,allFixturesFinished:b,resGw:p}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",t&&e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),t&&!b&&i&&!e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),u.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[d.map((o,l)=>{const a=o.user_id===r,h=l===d.length-1,f=n.has(o.user_id);return s.jsxs("tr",{className:`${a?"flash-user-row":""} ${f?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...h?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:l+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[t&&e&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),t&&!e&&i&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold ${t&&e?"pulse-live-score":""}`,style:{width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:o.score}),u.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums ${t&&e?"pulse-live-score":""}`,style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:o.unicorns})]},o.user_id)}),!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:u.length>=3?4:3,style:{backgroundColor:"#f8fafc"},children:["No results recorded for GW ",p," yet."]})})]})]})})]})}function Cs(d){const u=wn(),r=encodeURIComponent(d);if(u){const n=`whatsapp://send?text=${r}`;let t=!1,e=!1;try{const i=document.createElement("a");i.href=n,i.style.display="none",document.body.appendChild(i),i.click(),t=!0,setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},100)}catch{}if(!t)try{window.open(n),e=!0}catch{}if(!t&&!e)try{window.location.href=n}catch{window.open(`https://wa.me/?text=${r}`,"_blank")}}else{const n=`https://wa.me/?text=${r}`;try{window.open(n,"_blank")}catch{navigator.clipboard.writeText(d).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+d)})}}}function Ss(d,u){const r=new Date(u.find(l=>l.gw===d)?.kickoff_time||""),n=new Date(r.getTime()-4500*1e3),t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],e=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],i=t[n.getUTCDay()],c=n.getUTCDate(),b=e[n.getUTCMonth()],p=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${d} Predictions Reminder!

DEADLINE: THIS ${i} ${c} ${b}, ${p}:${o} BST

Don't forget!
playtotl.com`}function Ns(d,u){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",d);try{const r=Ss(d,u);console.log("[SubmissionStatusTable] Generated message:",r),Cs(r)}catch(r){console.error("[SubmissionStatusTable] Error in handleShareReminder:",r),alert("Error sharing reminder. Please try again.")}}function Ur({members:d,submittedMap:u,picksGw:r,allSubmitted:n,remaining:t,fixtures:e,onShareReminder:i,variant:c="full"}){const b=i||(()=>Ns(r,e)),p=e.map(f=>f.kickoff_time).filter(f=>!!f).map(f=>new Date(f)).filter(f=>!isNaN(f.getTime())),o=p.length>0?new Date(Math.min(...p.map(f=>f.getTime()))):null,l=o?new Date(o.getTime()-4500*1e3):null,a=l?new Date>=l:!1;let h="";if(l){const f=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=f[l.getUTCDay()],k=l.getUTCDate(),$=C[l.getUTCMonth()],P=l.getUTCHours().toString().padStart(2,"0"),M=l.getUTCMinutes().toString().padStart(2,"0");h=`${E} ${k} ${$}, ${P}:${M} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),b()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${a?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),a?"Deadline Passed: ":"Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((f,C)=>f.name.localeCompare(C.name)).map(f=>{const C=`${f.id}:${r}`,E=!!u.get(C);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:f.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},f.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:n?s.jsxs(s.Fragment,{children:["All ",d.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),b()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-sm ${a?"text-orange-600 font-semibold":"text-slate-600"}`,children:[a?" Deadline Passed: ":" Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((f,C)=>f.name.localeCompare(C.name)).map(f=>{const C=`${f.id}:${r}`,E=!!u.get(C);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:f.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},f.id)})})]})})]})}function Pr({letter:d,correct:u,unicorn:r,hasSubmitted:n,isLive:t,isOngoing:e,isFinished:i}){let c;return u===!0?t||e?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":i?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":n?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:r?"Correct!":void 0,children:d})}function Es(d,u){return d==="FINISHED"?"FT":d==="PAUSED"?"HT":d==="IN_PLAY"?u==null?"LIVE":`${u}'`:"LIVE"}function As(d){const u=(d||"?").trim().split(/\s+/);return u.length?u.length===1?u[0].slice(0,1).toUpperCase():(u[0][0]+u[u.length-1][0]).toUpperCase():"?"}function Ls({fixture:d,picks:u,members:r,outcome:n,liveScore:t,submittedMap:e,picksGw:i,isApiTestLeague:c=!1}){const b=d.home_code||d.home_team||d.home_name||"",p=d.away_code||d.away_team||d.away_name||"",o=gr(b)||d.home_name||d.home_team||"Home",l=gr(p)||d.away_name||d.away_team||"Away",h=(M=>{if(!M)return"";const I=new Date(M);if(isNaN(I.getTime()))return"";const v=String(I.getUTCHours()).padStart(2,"0"),F=String(I.getUTCMinutes()).padStart(2,"0");return`${v}:${F}`})(d.kickoff_time),f=!!(t&&t.status==="IN_PLAY"),C=!!(t&&(t.status==="PAUSED"||t.status==="HALF_TIME"||t.status==="HT")),E=!!(t&&t.status==="FINISHED"),k=f||C;let $=null;c&&t?t.homeScore>t.awayScore?$="H":t.awayScore>t.homeScore?$="A":t.homeScore===t.awayScore&&($="D"):$=n;const P=M=>{const I=u.filter(g=>g.pick===M),v=u.length===r.length&&I.length===r.length,F=4,m=[];for(let g=0;g<I.length;g+=F){const _=I.slice(g,g+F);m.push(_)}return s.jsx("div",{className:"flex flex-col gap-1",children:m.map((g,_)=>s.jsx("div",{className:"flex items-center justify-center",children:g.map((N,y)=>{const L=r.find(w=>w.id===N.user_id),S=As(L?.name??"?"),A=e.has(`${N.user_id}:${i}`),x=$&&$===M?!0:null;return v?s.jsx("span",{className:"inline-block",style:{marginLeft:y>0?"-8px":"0",position:"relative",zIndex:y},children:s.jsx(Pr,{letter:S,correct:x,unicorn:x===!0,hasSubmitted:A,isLive:f,isOngoing:k,isFinished:E})},N.user_id):s.jsx(Pr,{letter:S,correct:x,unicorn:x===!0,hasSubmitted:A,isLive:f,isOngoing:k,isFinished:E},N.user_id)})},_))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(f||C)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),E&&!f&&!C&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${k?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(xr,{code:d.home_code||void 0,crest:d.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:t&&(f||C||E)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[t.homeScore," - ",t.awayScore]}):s.jsx("span",{children:h})}),s.jsx(xr,{code:d.away_code||void 0,crest:d.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:l})})]}),t&&(k||E)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${k?"text-red-600":"text-slate-500"}`,children:Es(t.status,t.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:P("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:P("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:P("A")})})]})]})})}function Ir({label:d,fixtures:u,picksByFixture:r,members:n,outcomes:t,liveScores:e,submittedMap:i,picksGw:c,isApiTestLeague:b=!1,isFirstSection:p=!1,hasLiveGames:o=!1,allGamesFinished:l=!1,allSubmitted:a=!1,resultsPublished:h=!1,deadlinePassed:f=!1,whoDidntSubmit:C=[],liveFixturesCount:E,hasStarted:k=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(bn,{date:d,className:"text-lg font-normal"}),p&&s.jsxs(s.Fragment,{children:[b&&o&&E!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:E}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:u.length})]})]}),b&&l&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),b&&!k&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&a&&h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!b&&a&&!h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&f&&!a&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",C.length>0&&`(${C.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[u.map($=>{try{const P=r.get($.fixture_index)??[],M=t.get($.fixture_index)||null,I=e[$.fixture_index]||null;return s.jsx(Ls,{fixture:$,picks:P,members:n,outcome:M,liveScore:I,submittedMap:i,picksGw:c,isApiTestLeague:b},`${$.gw}-${$.fixture_index}`)}catch(P){return console.error("Error rendering fixture:",P,$),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",$.fixture_index]},`${$.gw}-${$.fixture_index}`)}}),!u.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const tr=8;function rr(d){return d.result==="H"||d.result==="D"||d.result==="A"?d.result:typeof d.home_goals=="number"&&typeof d.away_goals=="number"?d.home_goals>d.away_goals?"H":d.home_goals<d.away_goals?"A":"D":null}function Ms(){const{code:d=""}=vn(),[u,r]=yn(),{user:n}=zr(),[t]=z.useState(()=>{const j=localStorage.getItem("oldSchoolMode");return j?JSON.parse(j):!1});z.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(t))},[t]),z.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const j=()=>{const Z=document.querySelector(".league-header-fixed");if(Z){const oe=Z.style.top||window.getComputedStyle(Z).top;oe!=="0px"&&oe!=="0"&&(Z.style.top="0",Z.style.transform="translate3d(0, 0, 0)")}},W=()=>{j(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},q=Z=>{const oe=Z.target;oe.closest(".league-content-wrapper")||oe.closest(".league-header-fixed")||oe.closest(".chat-tab-wrapper")||Z.preventDefault()};window.addEventListener("scroll",W,{passive:!0}),document.addEventListener("touchmove",q,{passive:!1});const G=setInterval(j,100);return j(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",W),document.removeEventListener("touchmove",q),clearInterval(G)}},[]),z.useEffect(()=>{const j=q=>{const G=q.target;(G.tagName==="INPUT"||G.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const Z=document.querySelector(".league-header-fixed");Z&&(Z.style.top="0")},100)},W=()=>{const q=document.querySelector(".league-header-fixed");q&&(q.style.top="0")};return document.addEventListener("focusin",j),window.addEventListener("resize",W),window.addEventListener("orientationchange",W),()=>{document.removeEventListener("focusin",j),window.removeEventListener("resize",W),window.removeEventListener("orientationchange",W)}},[]),z.useEffect(()=>{if(typeof window>"u")return;const j=window.visualViewport;if(!j)return;let W=null;const q=()=>{const Z=I.current;if(!Z)return;const oe=j.offsetTop??0;Z.style.setProperty("transform",`translate3d(0, ${oe}px, 0)`,"important")},G=()=>{W&&cancelAnimationFrame(W),W=window.requestAnimationFrame(q)};return G(),j.addEventListener("resize",G),j.addEventListener("scroll",G),()=>{W&&cancelAnimationFrame(W),j.removeEventListener("resize",G),j.removeEventListener("scroll",G),I.current&&I.current.style.removeProperty("transform")}},[]);const[e,i]=z.useState(null),[c,b]=z.useState(!1),[p,o]=z.useState([]),[l,a]=z.useState(!0),h="chat",[f,C]=z.useState(h),[E,k]=z.useState(null),$=z.useRef(f);z.useEffect(()=>{$.current=f},[f]);const P=z.useRef(!1),M=z.useRef(!1);z.useEffect(()=>{const j=u.get("tab"),W=u.get("leagueCode");if(k(null),j==="chat"||W){if(W&&d!==W){k(`Deep link mismatch: URL has leagueCode=${W} but we're on league ${d}. Current URL: ${window.location.href}`);return}if(j==="chat"){f!=="chat"&&(C("chat"),setTimeout(()=>{$.current!=="chat"&&k(`Failed to open chat tab. Current tab: ${$.current}, Expected: chat. URL: ${window.location.href}`)},300));const q=setTimeout(()=>{r({},{replace:!0})},200);return()=>clearTimeout(q)}}(j==="chat"||W)&&console.log("[Deep Link] URL params:",{urlTab:j,urlLeagueCode:W,currentCode:d,currentTab:f,fullUrl:window.location.href})},[u,r,f,d]);const I=z.useRef(null),[v,F]=z.useState(!1),[m,g]=z.useState(!1),[_,N]=z.useState(!1),[y,L]=z.useState(null),[S,A]=z.useState(null),[x,w]=z.useState(null),[B,D]=z.useState([]),H=z.useRef({}),ae=z.useRef(new Map),[X,U]=z.useState(new Set),[T,R]=z.useState(!1),[K,Y]=z.useState(!1),[O,ee]=z.useState(0),[te,se]=z.useState(!1),[ie,He]=z.useState(!1),[Ge,we]=z.useState(!1),[ke,be]=z.useState(!1),[pe,he]=z.useState(null),[Ie,ye]=z.useState(!1),[Ne,_e]=z.useState(null),[je,Le]=z.useState({x:0,y:0}),[qe,Je]=z.useState(1),[De,st]=z.useState(null),[Ee,ze]=z.useState(null),[Ve,Ze]=z.useState(!1),[Qe,et]=z.useState(!1),[pt,At]=z.useState(!1),[ht,ct]=z.useState(!1),[gt,yt]=z.useState(!1),[ot,Xe]=z.useState(!1),[tt,mt]=z.useState(null),[wt,at]=z.useState(!1),[rt,ar]=z.useState(!1),[_t,Jr]=z.useState(null),it=z.useMemo(()=>!!n?.id&&p.some(j=>j.id===n.id),[n?.id,p]),ir=z.useMemo(()=>!!n?.id&&!!_t&&_t.id===n.id,[n?.id,_t]),Qr=z.useMemo(()=>_t?.name??"League admin",[_t]),Xr=z.useMemo(()=>{const j=new Map;return p.forEach(W=>j.set(W.id,W.name)),j.set(Fr,_n),j},[p]),lr=z.useCallback(()=>{if(!e?.code||typeof window>"u"||typeof navigator>"u")return;const j=`Join my mini league "${e.name}" on TotL!`,W=`${window.location.origin}/league/${e.code}`,q=navigator;if(typeof q.share=="function"){q.share({title:`Join ${e.name}`,text:j,url:W}).catch(Z=>{console.warn("[League] Share cancelled",Z)});return}const G=`${j}
${W}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(G).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",e.code)}):window.prompt?.("Share this league code:",e.code)},[e]),en=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){N(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id).eq("user_id",n.id);if(j)throw j;typeof window<"u"&&(window.location.href="/leagues")}catch(j){console.error("[League] Error leaving league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to leave league. Please try again.")}finally{N(!1),g(!1)}}},[e?.id,n?.id]),tn=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){At(!0);try{if(p.length>=tr){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),et(!1);return}const{error:j}=await le.from("league_members").insert({league_id:e.id,user_id:n.id});if(j)throw j;const W=n.user_metadata?.display_name||n.email||"Someone";try{const q=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:e.id,userId:n.id,userName:W})}),G=await q.text();let Z;try{Z=G?JSON.parse(G):{error:"Empty response body"}}catch(oe){console.error("[League] Failed to parse notification response. Status:",q.status,"Text:",G,"Error:",oe),Z={error:"Invalid JSON response",status:q.status,raw:G.substring(0,200)}}q.ok?console.log("[League] Join notification sent:",JSON.stringify({sent:Z.sent,recipients:Z.recipients,ok:Z.ok,breakdown:Z.breakdown},null,2)):console.error("[League] Notification function returned error:",q.status,Z)}catch(q){console.error("[League] Error sending join notification:",q)}typeof window<"u"&&window.location.reload()}catch(j){console.error("[League] Error joining league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to join league.")}finally{At(!1)}}},[e?.id,n?.id,p.length]),rn=z.useCallback(async()=>{if(!(!tt||!e?.id||!n?.id)){at(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id).eq("user_id",tt.id);if(j)throw j;typeof window<"u"&&window.location.reload()}catch(j){console.error("[League] Error removing member:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to remove member.")}finally{at(!1),yt(!1),mt(null)}}},[e?.id,tt,n?.id]),nn=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){ar(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id);if(j)throw j;const{error:W}=await le.from("leagues").delete().eq("id",e.id);if(W)throw W;typeof window<"u"&&(window.location.href="/leagues")}catch(j){console.error("[League] Error ending league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to end league.")}finally{ar(!1),Xe(!1)}}},[e?.id,n?.id]),sn=j=>new Promise((W,q)=>{const G=new Image;G.addEventListener("load",()=>W(G)),G.addEventListener("error",Z=>q(Z)),G.src=j}),cr=async(j,W)=>{const q=await sn(j),G=document.createElement("canvas"),Z=G.getContext("2d");if(!Z)throw new Error("No 2d context");return G.width=W.width,G.height=W.height,Z.drawImage(q,W.x,W.y,W.width,W.height,0,0,W.width,W.height),new Promise((oe,de)=>{G.toBlob(ge=>{if(!ge){de(new Error("Canvas is empty"));return}oe(ge)},"image/jpeg",.9)})},on=z.useCallback(j=>{if(!e?.id||!it){he("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(j.type)){he("Please upload a PNG, JPG, or WebP image.");return}const q=20*1024*1024;if(j.size>q){he("Please choose an image smaller than 20MB.");return}if(j.size>5*1024*1024&&console.log(`[League] Processing large image (${(j.size/1024/1024).toFixed(1)}MB) - will be optimized automatically`),he(null),ye(!1),j.size>5*1024*1024)Oe(j,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(G=>{const Z=new FileReader;Z.onload=()=>{_e(Z.result)},Z.readAsDataURL(G)}).catch(G=>{console.error("[League] Error pre-compressing image:",G),he("Failed to process image. Please try a smaller file.")});else{const G=new FileReader;G.onload=()=>{_e(G.result)},G.readAsDataURL(j)}},[it,e?.id]),an=z.useCallback(async(j,W)=>{if(st(W),Ne)try{const q=await cr(Ne,W),G=URL.createObjectURL(q);ze(G)}catch(q){console.error("[League] Error creating preview:",q)}},[Ne]),ln=z.useCallback(async()=>{if(!(!Ne||!De||!e?.id||!it)){he(null),ye(!1),be(!0);try{const j=await cr(Ne,De),W=new File([j],"badge.jpg",{type:"image/jpeg"}),q=await Oe(W,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(q.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const G=`${e.id}-${Date.now()}.jpg`,{error:Z}=await le.storage.from("league-avatars").upload(G,q,{cacheControl:"3600",upsert:!0,contentType:q.type});if(Z)throw Z;const{data:oe}=le.storage.from("league-avatars").getPublicUrl(G),de=oe?.publicUrl;if(!de)throw new Error("Unable to get public URL for badge.");const{error:ge}=await le.from("leagues").update({avatar:de}).eq("id",e.id);if(ge)throw ge;i(Re=>Re&&{...Re,avatar:de}),ye(!0),Ee&&URL.revokeObjectURL(Ee),_e(null),ze(null),we(!1),n?.id&&(qt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:de}})))}catch(j){console.error("[League] Error uploading badge:",j),he(j?.message??"Failed to upload badge. Please try again.")}finally{be(!1)}}},[Ne,De,it,e?.id,n?.id]),cn=z.useCallback(async()=>{if(!(!e?.id||!it)){he(null),ye(!1),be(!0);try{const{error:j}=await le.from("leagues").update({avatar:null}).eq("id",e.id);if(j)throw j;i(W=>W&&{...W,avatar:null}),ye(!0),n?.id&&(qt(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:null}})))}catch(j){console.error("[League] Error removing badge:",j),he(j?.message??"Failed to remove badge. Please try again.")}finally{be(!1)}}},[it,e?.id]),[dr,dn]=z.useState(new Map);z.useEffect(()=>{(async()=>{const j=new Map,{data:W}=await le.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:q}=await le.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),G=new Map;if(W&&W.forEach(Z=>{(!G.has(Z.gw)||Z.kickoff_time&&new Date(Z.kickoff_time)<new Date(G.get(Z.gw)))&&Z.kickoff_time&&G.set(Z.gw,Z.kickoff_time)}),q&&q.length>0){const Z=q.find(oe=>oe.kickoff_time)?.kickoff_time;if(Z){const oe=G.get(1);(!oe||new Date(Z)<new Date(oe))&&G.set(1,Z)}}G.forEach((Z,oe)=>{const de=new Date(Z),ge=new Date(de.getTime()-4500*1e3);j.set(oe,ge)}),dn(j)})()},[]),z.useEffect(()=>{const j=W=>{const q=W.target;T&&!q.closest(".gw-dropdown-container")&&R(!1)};return T&&document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[T]),z.useEffect(()=>{let j=!0;return(async()=>{const{data:W}=await le.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!j)return;L(W?.current_gw??null);const{data:q}=await le.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!j)return;A(q&&q.length?q[0].gw:null);const{data:G}=await le.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!j)return;const Z=G?[...new Set(G.map(de=>de.gw))].sort((de,ge)=>ge-de):[],oe=W?.current_gw;oe&&!Z.includes(oe)&&Z.unshift(oe),D(Z),Z.length>0&&!x&&w(Z[0])})(),()=>{j=!1}},[O]);const dt=z.useMemo(()=>p.map(j=>j.id),[p]),[Me,ur]=z.useState([]),[jt,Ot]=z.useState([]),[Bt,Ht]=z.useState([]),[Lt,Gt]=z.useState([]),fr=z.useMemo(()=>!Me||Me.length===0?[]:Me.map(j=>j.api_match_id).filter(j=>j!=null),[Me]),Rt=z.useMemo(()=>e?.name==="API Test",[e?.name]),[ut,hr]=z.useState(null);z.useEffect(()=>{if(!Rt){hr(null);return}let j=!0;return(async()=>{const{data:W}=await le.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let q=W?.current_test_gw??1;if(q&&q!==1){const{data:G}=await le.from("app_fixtures").select("gw").eq("gw",q).limit(1).maybeSingle();if(!G){const{data:Z}=await le.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Z&&(q=1)}}j&&hr(q)})(),()=>{j=!1}},[Rt]);const un=z.useMemo(()=>Rt&&ut!==null?ut:y||x||void 0,[Rt,ut,y,x]),{liveScores:mr}=jn(un,fr.length>0?fr:void 0),Be=z.useMemo(()=>{const j={};return!Me||Me.length===0||Me.forEach(W=>{const q=W.api_match_id;if(q){const G=mr.get(q);G&&(j[W.fixture_index]={homeScore:G.home_score??0,awayScore:G.away_score??0,status:G.status||"SCHEDULED",minute:G.minute??null})}}),j},[mr,Me]),[pr,kt]=z.useState([]),[fn,Ct]=z.useState(!1);z.useEffect(()=>{let j=!0;return(async()=>{a(!0);const{data:W}=await le.from("leagues").select("id,name,code,created_at,avatar").eq("code",d).maybeSingle();if(!j)return;if(!W){i(null),o([]),a(!1);return}i(W);const{data:q}=await le.from("league_members").select("users(id,name),created_at").eq("league_id",W.id).order("created_at",{ascending:!0}),G=q?.map(de=>({id:de.users.id,name:de.users.name??"(no name)"}))??[],Z=[...G].sort((de,ge)=>de.name.localeCompare(ge.name));o(Z);const oe=G[0];Jr(oe),n?.id&&!G.some(de=>de.id===n.id)&&et(!0),a(!1)})(),()=>{j=!1}},[d]),z.useEffect(()=>{},[e,f]),z.useEffect(()=>{if(f!=="chat"||!e?.id||!n?.id)return;(async()=>{await le.from("league_message_reads").upsert({league_id:e.id,user_id:n.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),qt(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:e.id,userId:n.id}}))})()},[f,e?.id,n?.id]),z.useEffect(()=>{let j=!0;return(async()=>{const W=e?.name==="API Test";let q=ut??1;if(W){const{data:Ae}=await le.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(q=Ae?.current_test_gw??1,q&&q!==1){const{data:Ue}=await le.from("app_fixtures").select("gw").eq("gw",q).limit(1).maybeSingle();if(Ue)console.log("[League] Using current_test_gw from meta:",q);else{const{data:Q}=await le.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Q&&(q=1,console.log("[League] No fixtures for current_test_gw, falling back to GW T1"))}}else console.log("[League] Using GW T1 or current_test_gw:",q)}const G=W&&(f==="gw"||f==="gwr");console.log("[League] Data fetch:",{isApiTestLeague:W,tab:f,useTestFixtures:G,leagueName:e?.name,testGwForData:q,willUseTestTables:G,willUseMainTables:!G});let Z=f==="gwr"?M.current?x:y||x:y;if(W&&(f==="gw"||f==="gwr")&&(Z=q),console.log("[League] gwForData calculation:",{tab:f,manualGwSelected:M.current,selectedGw:x,currentGw:y,gwForData:Z,isApiTestLeague:W}),f==="gw"&&!W&&dt.length>0){const{data:Ae}=await le.from("app_gw_submissions").select("gw").in("user_id",dt).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(Ae&&Ae.length>0){const Ue=[...new Set(Ae.map(Q=>Q.gw))].sort((Q,ne)=>(ne||0)-(Q||0));for(const Q of Ue)if(Q){const{data:ne}=await le.from("app_fixtures").select("gw").eq("gw",Q).limit(1);if(ne&&ne.length>0){console.log("[League] Found fixtures for GW",Q,"from submissions - using this GW (currentGw was",Z,")"),Z=Q;break}}}!Z&&y&&(Z=y,console.log("[League] Using currentGw as fallback:",y))}if(console.log("[League] gwForData:",Z,"memberIds:",dt),!Z&&!G){ur([]),Ot([]),Ht([]),Gt([]);return}let oe;if(G){const{data:Ae}=await le.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",q).order("fixture_index",{ascending:!0});oe=Ae?.map(Ue=>({...Ue,gw:Ue.test_gw}))||null}else{console.log("[League] Fetching from MAIN database table (app_fixtures) for regular league, GW:",Z);const{data:Ae}=await le.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",Z).order("fixture_index",{ascending:!0});oe=Ae||null,console.log("[League] Fetched fixtures from main database:",Ae?.length||0,"fixtures")}if(!j)return;if(ur(oe??[]),!dt.length){Ot([]),Ht([]),Gt([]);return}let de=null,ge;if(G){const{data:Ae}=await le.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",q).in("user_id",dt);de=Ae?.map(J=>({...J,gw:J.matchday}))||null;const{data:Ue,error:Q}=await le.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",q).not("submitted_at","is",null).in("user_id",dt);Q&&console.error("Error fetching test_api_submissions:",Q);const{data:ne}=await le.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",q).order("fixture_index",{ascending:!0}),Ce=new Set((ne||[]).map(J=>J.fixture_index));console.log("[League] Current fixture indices from test_api_fixtures:",Array.from(Ce)),console.log("[League] Current fixtures:",ne?.map(J=>({index:J.fixture_index,home:J.home_team,away:J.away_team})));const V=[];if(Ue&&de&&ne){const J=Ce.size;console.log("[League] Required fixture count for valid submission:",J);const me=(ne||[]).map(re=>re.kickoff_time?new Date(re.kickoff_time):null).filter(re=>re!==null&&!isNaN(re.getTime())),ce=me.length>0?new Date(Math.min(...me.map(re=>re.getTime()))):null,Se=new Date("2025-11-18T00:00:00Z");console.log("[League] Submission cutoff date (submissions before this are old):",Se.toISOString()),console.log("[League] Earliest kickoff:",ce?.toISOString()),Ue.forEach(re=>{const ve=(de||[]).filter(Te=>Te.user_id===re.user_id&&Te.matchday===q),fe=ve.filter(Te=>Ce.has(Te.fixture_index)),ue=fe.length===J&&J>0,xe=new Set(fe.map(Te=>Te.fixture_index)),Ke=xe.size===J,ft=re.submitted_at?new Date(re.submitted_at):null,Pe=ft&&ft>=Se;if(ue&&Ke&&Pe)V.push(re),console.log("[League]  VALID submission (has picks for ALL current fixtures AND recent submission):",{user_id:re.user_id,submitted_at:re.submitted_at,submissionDate:ft?.toISOString(),cutoffDate:Se.toISOString(),picksCount:ve.length,picksForCurrentFixtures:fe.length,uniqueIndices:xe.size,requiredCount:J});else{const Te=[];ue||Te.push("missing picks"),Ke||Te.push("duplicate/extra picks"),Pe||Te.push(`old submission (${ft?.toISOString()} < ${Se.toISOString()})`),console.log("[League]  INVALID submission:",{user_id:re.user_id,submitted_at:re.submitted_at,submissionDate:ft?.toISOString(),cutoffDate:Se.toISOString(),picksCount:ve.length,picksForCurrentFixtures:fe.length,uniqueIndices:xe.size,requiredCount:J,hasAllRequired:ue,hasExactMatch:Ke,isRecent:Pe,reason:Te.join(", ")})}})}ge=V.map(J=>({...J,gw:J.matchday}))||null,console.log("[League] Test API submissions fetched (filtered to only current fixtures):",ge),console.log("[League] Valid submissions count:",V.length,"out of",Ue?.length||0,"total")}else{console.log("[League] Fetching from MAIN database tables (picks, gw_submissions) for regular league");const{data:Ae}=await le.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",Z).in("user_id",dt);de=Ae,console.log("[League] Fetched picks from main database:",Ae?.length||0,"picks");const{data:Ue}=await le.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",Z).in("user_id",dt);ge=Ue,console.log("[League] Fetched submissions from main database:",Ue?.length||0,"submissions")}if(!j)return;Ot(de??[]),Ht(ge??[]);const{data:Re}=await le.from("app_gw_results").select("gw,fixture_index,result").eq("gw",G?1:Z||0);j&&Gt(Re??[])})(),()=>{j=!1}},[f,y,S,x,dt]),z.useEffect(()=>{H.current=Be},[Be]);const $e=z.useMemo(()=>{const j=new Map;return console.log("[League] Building submittedMap from subs:",Bt),Bt.forEach(W=>{if(W.submitted_at){const q=`${W.user_id}:${W.gw}`;console.log(`[League] Adding submission key: ${q}`,W),j.set(q,!0)}else console.log("[League] Skipping submission with null submitted_at:",W)}),console.log("[League] Final submittedMap:",Array.from(j.entries())),j},[Bt]),Mt=z.useCallback(j=>j.map(W=>({user_id:W.id,name:W.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);z.useEffect(()=>{const j=le.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{ee(W=>W+1)}).subscribe();return()=>{le.removeChannel(j)}},[]),z.useEffect(()=>{let j=!0;return(async()=>{if(!p.length){kt([]);return}if(e?.name==="API Test"){kt(Mt(p)),Ct(!1);return}if(y===null)return;Ct(!0);const{data:W}=await le.from("app_gw_results").select("gw,fixture_index,result"),q=W??[],G=new Map;if(q.forEach(re=>{const ve=rr(re);ve&&G.set(`${re.gw}:${re.fixture_index}`,ve)}),G.size===0){kt(Mt(p)),Ct(!1);return}const Z=[...new Set(Array.from(G.keys()).map(re=>parseInt(re.split(":")[0],10)))].sort((re,ve)=>re-ve),oe=["Prem Predictions","FC Football","Easy League"],de=["The Bird league"],ge=await kn(e,y);let Re=Z.filter(re=>re>=ge);if(y!==null&&Re.includes(y)){const{data:re}=await le.from("app_fixtures").select("fixture_index").eq("gw",y),ve=re?.length??0,fe=Array.from(G.keys()).filter(ue=>parseInt(ue.split(":")[0],10)===y).length;ve>0&&fe<ve&&(Re=Re.filter(ue=>ue<y))}else y!==null&&(Re=Re.filter(re=>re<y));if(!oe.includes(e?.name||"")&&!de.includes(e?.name||"")&&Re.length===0){kt(Mt(p)),Ct(!1);return}const{data:Ae}=await le.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",p.map(re=>re.id)).in("gw",Re),Ue=Ae??[],Q=new Map;Re.forEach(re=>{const ve=new Map;p.forEach(fe=>ve.set(fe.id,{user_id:fe.id,score:0,unicorns:0})),Q.set(re,ve)}),Re.forEach(re=>{Array.from(G.entries()).filter(([fe])=>parseInt(fe.split(":")[0],10)===re).map(([fe,ue])=>({idx:parseInt(fe.split(":")[1],10),out:ue})).forEach(({idx:fe,out:ue})=>{const xe=Ue.filter(Pe=>Pe.gw===re&&Pe.fixture_index===fe),Ke=xe.filter(Pe=>Pe.pick===ue).map(Pe=>Pe.user_id),ft=Q.get(re);if(xe.forEach(Pe=>{if(Pe.pick===ue){const Te=ft.get(Pe.user_id);Te.score+=1}}),Ke.length===1&&p.length>=3){const Pe=Ke[0],Te=ft.get(Pe);Te.unicorns+=1}})});const ne=new Map,Ce=new Map,V=new Map,J=new Map,me=new Map,ce=new Map;p.forEach(re=>{ne.set(re.id,0),Ce.set(re.id,0),V.set(re.id,0),J.set(re.id,0),me.set(re.id,0),ce.set(re.id,[])}),Re.forEach(re=>{const ve=Array.from(Q.get(re).values());if(ve.forEach(xe=>{Ce.set(xe.user_id,(Ce.get(xe.user_id)??0)+xe.score),V.set(xe.user_id,(V.get(xe.user_id)??0)+xe.unicorns)}),ve.sort((xe,Ke)=>Ke.score-xe.score||Ke.unicorns-xe.unicorns),!ve.length)return;const fe=ve[0],ue=ve.filter(xe=>xe.score===fe.score&&xe.unicorns===fe.unicorns);ue.length===1?(ne.set(fe.user_id,(ne.get(fe.user_id)??0)+3),J.set(fe.user_id,(J.get(fe.user_id)??0)+1),ce.get(fe.user_id).push("W"),ve.slice(1).forEach(xe=>ce.get(xe.user_id).push("L"))):(ue.forEach(xe=>{ne.set(xe.user_id,(ne.get(xe.user_id)??0)+1),me.set(xe.user_id,(me.get(xe.user_id)??0)+1),ce.get(xe.user_id).push("D")}),ve.filter(xe=>!ue.find(Ke=>Ke.user_id===xe.user_id)).forEach(xe=>ce.get(xe.user_id).push("L")))});const Se=p.map(re=>({user_id:re.id,name:re.name,mltPts:ne.get(re.id)??0,ocp:Ce.get(re.id)??0,unicorns:V.get(re.id)??0,wins:J.get(re.id)??0,draws:me.get(re.id)??0,form:ce.get(re.id)??[]}));Se.sort((re,ve)=>ve.mltPts-re.mltPts||ve.unicorns-re.unicorns||ve.ocp-re.ocp||re.name.localeCompare(ve.name)),j&&(kt(Se),Ct(!1))})(),()=>{j=!1}},[p,e,y,Mt,O]);function hn(){const j=["Prem Predictions","FC Football","Easy League"],W=["The Bird league"],q=["gregVjofVcarl","Let Down"],G=!!(e&&!j.includes(e.name)&&!W.includes(e.name)&&!q.includes(e.name)),Z=pr.length?pr:p.map(oe=>({user_id:oe.id,name:oe.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]}));return p.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>Ze(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg hover:bg-emerald-700 transition-colors",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(js,{rows:Z,members:p,showForm:v,currentUserId:n?.id,loading:fn,isLateStartingLeague:G}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(ys,{showForm:v,onToggle:F}),s.jsxs("button",{onClick:()=>se(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function mn(){const j=e?.name==="API Test"?ut??1:y,{state:W}=Cn(j);if(!j)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!yr(e,j,dr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",j," predictions are not included in this league."]})]})});const q=new Map;Lt.forEach(V=>{if(V.gw!==j)return;const J=rr(V);J&&q.set(V.fixture_index,J)}),Me.forEach(V=>{if(V.gw!==j)return;const J=Be[V.fixture_index];J&&(J.status==="IN_PLAY"||J.status==="PAUSED"||J.status==="FINISHED")&&(J.homeScore>J.awayScore?q.set(V.fixture_index,"H"):J.awayScore>J.homeScore?q.set(V.fixture_index,"A"):q.set(V.fixture_index,"D"))});const G=z.useMemo(()=>{const V=ce=>{if(!ce)return"Fixtures";const Se=new Date(ce);return isNaN(Se.getTime())?"Fixtures":Se.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},J=new Map;Me.filter(ce=>ce.gw===j).forEach(ce=>{const Se=V(ce.kickoff_time),re=ce.kickoff_time?new Date(ce.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;J.has(Se)||J.set(Se,{label:Se,key:re,items:[]}),J.get(Se).items.push(ce)});const me=Array.from(J.values());return me.forEach(ce=>ce.items.sort((Se,re)=>Se.fixture_index-re.fixture_index)),me.sort((ce,Se)=>ce.key-Se.key),me},[Me,j]),Z=new Set(Me.filter(V=>V.gw===j).map(V=>V.fixture_index)),oe=e?.name==="API Test",de=p.length>0&&p.every(V=>$e.get(`${V.id}:${j}`));if(oe&&j===(ut??1)){console.log("[League] API Test filtering:",{currentFixtureIndices:Array.from(Z),totalPicks:jt.length,picksForGw:jt.filter(J=>J.gw===j).length,submittedMapSize:$e.size,allSubmitted:de,members:p.map(J=>({id:J.id,name:J.name,submitted:$e.get(`${J.id}:${j}`)})),fixturesCount:Me.filter(J=>J.gw===j).length});const V=jt.filter(J=>J.gw===j);console.log(`[League] All picks for GW${j}:`,V.map(J=>({user_id:J.user_id,userName:p.find(me=>me.id===J.user_id)?.name,fixture_index:J.fixture_index,pick:J.pick,hasSubmitted:!!$e.get(`${J.user_id}:${j}`),inCurrentFixtures:Z.has(J.fixture_index)})))}const ge=new Map;!oe||de?jt.forEach(V=>{if(V.gw!==j)return;if(!$e.get(`${V.user_id}:${j}`)){oe&&j===1&&console.log("[League] API Test: Filtering out unsubmitted pick:",{user_id:V.user_id,fixture_index:V.fixture_index,userName:p.find(ce=>ce.id===V.user_id)?.name});return}if(!Z.has(V.fixture_index)){oe&&j===1&&console.log("[League] Filtering out old pick (not in current fixtures):",{fixture_index:V.fixture_index,currentIndices:Array.from(Z),userName:p.find(ce=>ce.id===V.user_id)?.name});return}const me=ge.get(V.fixture_index)??[];me.push(V),ge.set(V.fixture_index,me)}):console.log("[League] API Test: Not all submitted - skipping ALL picks processing. allSubmitted=",de);const Re=S!==null&&S>=j,Ae=p.filter(V=>!$e.get(`${V.id}:${j}`)).length,Ue=p.filter(V=>!$e.get(`${V.id}:${j}`)).map(V=>V.name),Q=W!==null&&(W==="DEADLINE_PASSED"||W==="LIVE"||W==="RESULTS_PRE_GW");if(oe&&j===1){const V=p.map(ce=>{const Se=`${ce.id}:${j}`,re=$e.get(Se);return{id:ce.id,name:ce.name,submitted:!!re,key:Se}});console.log(`[League] ===== API Test GW${j} SUBMISSION CHECK =====`),console.log("[League] All submitted:",de),console.log("[League] Remaining:",Ae),console.log("[League] Who didn't submit:",Ue),console.log("[League] Member submission status:",V),console.log("[League] Submitted map entries:",Array.from($e.entries())),console.log("[League] ================================================");const J=p.find(ce=>ce.name.toLowerCase().includes("steve")||ce.name.toLowerCase().includes("s")),me=p.find(ce=>ce.name.toLowerCase().includes("jof")||ce.name.toLowerCase().includes("j"));if(J){const ce=`${J.id}:${j}`;console.log(`[League] STEVE (${J.name}):`,{id:J.id,submitted:!!$e.get(ce),key:ce})}if(me){const ce=`${me.id}:${j}`;console.log(`[League] JOF (${me.name}):`,{id:me.id,submitted:!!$e.get(ce),key:ce})}}console.log(`GW${j} deadline check:`,{gameState:W,deadlinePassed:Q,allSubmitted:de,willShowPredictions:de||Q});const ne=oe?!de:!de&&!Q;return(oe?!de:!de&&!Q)?(console.log(`[League] Not all submitted, showing ONLY "Who's submitted" view. Blocking all predictions/fixtures.`,{isApiTestLeague:oe,allSubmitted:de,deadlinePassed:Q,remaining:Ae}),s.jsx(Ur,{members:p,submittedMap:$e,picksGw:j,allSubmitted:de,remaining:Ae,fixtures:Me.filter(V=>V.gw===j),variant:"compact"})):s.jsxs("div",{className:"mt-2 pt-2",children:[ne?s.jsx(Ur,{members:p,submittedMap:$e,picksGw:j,allSubmitted:de,remaining:Ae,fixtures:Me.filter(V=>V.gw===j),variant:"full"}):null,e?.name==="API Test"&&de&&G.length>0&&!ne&&(()=>{const V=G.flatMap(fe=>fe.items),J=new Set(V.map(fe=>fe.fixture_index)),me={};Object.keys(Be).forEach(fe=>{const ue=parseInt(fe,10);J.has(ue)&&(me[ue]=Be[ue])});const ce=V.some(fe=>{const ue=me[fe.fixture_index];return ue&&(ue.status==="IN_PLAY"||ue.status==="PAUSED")}),Se=V.length>0&&V.every(fe=>{const ue=me[fe.fixture_index];return ue&&ue.status==="FINISHED"}),re=ce||Se||V.some(fe=>me[fe.fixture_index]);let ve=0;return n?.id&&V.forEach(fe=>{const ue=me[fe.fixture_index],xe=ue&&(ue.status==="IN_PLAY"||ue.status==="PAUSED"),Ke=ue&&ue.status==="FINISHED";if(ue&&(xe||Ke)){const Pe=(ge.get(fe.fixture_index)??[]).find(Te=>Te.user_id===n.id);if(Pe){let Te=!1;(Pe.pick==="H"&&ue.homeScore>ue.awayScore||Pe.pick==="A"&&ue.awayScore>ue.homeScore||Pe.pick==="D"&&ue.homeScore===ue.awayScore)&&(Te=!0),Te&&ve++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:G.map((fe,ue)=>s.jsx(Ir,{label:fe.label,fixtures:fe.items,picksByFixture:ge,members:p,outcomes:q,liveScores:me,submittedMap:$e,picksGw:j,isApiTestLeague:!0,isFirstSection:ue===0,hasLiveGames:ce,allGamesFinished:Se,hasStarted:re,liveFixturesCount:ve},ue))})})(),G.length>0&&e?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:G.map((V,J)=>s.jsx(Ir,{label:V.label,fixtures:V.items,picksByFixture:ge,members:p,outcomes:q,liveScores:Be,submittedMap:$e,picksGw:j,isApiTestLeague:!1,isFirstSection:J===0,allSubmitted:de,resultsPublished:Re,deadlinePassed:Q,whoDidntSubmit:Ue},J))}),!G.length&&!ne&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",j,"."]})]})}function pn(){const j=e?.name==="API Test"?ut??1:f==="gwr"?M.current?x:y||x:x;if(!j||B.length===0&&e?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!yr(e,j,dr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",j," results are not included in this league."]})]})});const W=new Map,q=e?.name==="API Test",G=Me.filter(Q=>Q.gw===j),Z=G.some(Q=>{const ne=Be[Q.fixture_index];return ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")});console.log("[League] Live Table calculation:",{resGw:j,currentGw:y,selectedGw:x,hasLiveScores:Z,liveScoresCount:Object.keys(Be).length,isApiTestLeague:q,fixturesCount:Me.length,fixturesForGwCount:G.length,manualGwSelected:M.current}),q&&j===(ut??1)?G.forEach(Q=>{const ne=Be[Q.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?W.set(Q.fixture_index,"H"):ne.awayScore>ne.homeScore?W.set(Q.fixture_index,"A"):W.set(Q.fixture_index,"D"))}):Z&&j===y?(console.log("[League] Using live scores for regular league GW",j),G.forEach(Q=>{const ne=Be[Q.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?W.set(Q.fixture_index,"H"):ne.awayScore>ne.homeScore?W.set(Q.fixture_index,"A"):W.set(Q.fixture_index,"D"))}),console.log("[League] Outcomes from live scores:",Array.from(W.entries()))):(console.log("[League] Using results table for GW",j,{hasLiveScores:Z,resGwEqualsCurrentGw:j===y,resultsCount:Lt.length,resultsForThisGw:Lt.filter(Q=>Q.gw===j).length,manualGwSelected:M.current,selectedGw:x}),Lt.forEach(Q=>{if(Q.gw!==j)return;const ne=rr(Q);ne&&W.set(Q.fixture_index,ne)}),console.log("[League] Outcomes from results:",Array.from(W.entries())));const oe=p.filter(Q=>$e.get(`${Q.id}:${j}`)).map(Q=>({user_id:Q.id,name:Q.name,score:0,unicorns:0})),de=new Map;jt.forEach(Q=>{if(Q.gw!==j||!$e.get(`${Q.user_id}:${j}`))return;const ne=de.get(Q.fixture_index)??[];ne.push(Q),de.set(Q.fixture_index,ne)}),Array.from(W.entries()).forEach(([Q,ne])=>{const V=(de.get(Q)??[]).filter(J=>J.pick===ne).map(J=>J.user_id);if(V.forEach(J=>{const me=oe.find(ce=>ce.user_id===J);me.score+=1}),V.length===1&&p.length>=3){const J=oe.find(me=>me.user_id===V[0]);J.unicorns+=1}}),oe.sort((Q,ne)=>ne.score-Q.score||ne.unicorns-Q.unicorns||Q.name.localeCompare(ne.name)),z.useEffect(()=>{if(oe.length===0)return;const Q=new Map;oe.forEach((Ce,V)=>{Q.set(Ce.user_id,V)});const ne=new Set;if(Q.forEach((Ce,V)=>{const J=ae.current.get(V);J!==void 0&&J!==Ce&&ne.add(V)}),ae.current=Q,ne.size>0){U(ne);const Ce=setTimeout(()=>{U(new Set)},2e3);return()=>clearTimeout(Ce)}},[oe.map(Q=>`${Q.user_id}-${Q.score}-${Q.unicorns}`).join(",")]);let ge=!1,Re=!1,Ae=!1,Ue=!1;if(q&&j===(ut??1)){const Q=Me;if(Q.length>0&&(ge=Q.every(Ce=>{const V=Be[Ce.fixture_index];return V&&V.status==="FINISHED"}),Re=!!Q.find(Ce=>{const V=Be[Ce.fixture_index];return V&&(V.status==="IN_PLAY"||V.status==="PAUSED")}),Ue=Q.some(Ce=>{const V=Be[Ce.fixture_index];return V&&(V.status==="IN_PLAY"||V.status==="PAUSED"||V.status==="FINISHED")}),!ge)){const Ce=new Date;Ae=Q.some(V=>{if(!V.kickoff_time)return!1;const me=new Date(V.kickoff_time).getTime()-Ce.getTime(),ce=Be[V.fixture_index];return(!ce||ce.status!=="IN_PLAY"&&ce.status!=="PAUSED"&&ce.status!=="FINISHED")&&me>0&&me<=1440*60*1e3})}}else{const Q=Me.filter(ne=>ne.gw===j);if(Q.length>0){const ne=Q.every(V=>W.has(V.fixture_index)),Ce=Q.some(V=>{const J=Be[V.fixture_index];return J&&(J.status==="IN_PLAY"||J.status==="PAUSED")});ge=ne&&!Ce,console.log(`[League] GW ${j} finished check:`,{allHaveResults:ne,hasActiveGames:Ce,fixturesCount:Q.length,outcomesCount:Q.filter(V=>W.has(V.fixture_index)).length,allFixturesFinished:ge})}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),oe.length>0&&ge&&s.jsx(bs,{winnerName:oe[0].name,isDraw:oe[0].score===oe[1]?.score&&oe[0].unicorns===oe[1]?.unicorns}),s.jsx(ks,{rows:oe,members:p,currentUserId:n?.id,positionChangeKeys:X,isApiTestLeague:q,hasLiveFixtures:Re,hasStartingSoonFixtures:Ae,hasStartedFixtures:Ue,allFixturesFinished:ge,resGw:j}),B.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(vs,{availableGws:B,selectedGw:j,onChange:Q=>{M.current=!0,w(Q)}}),s.jsxs("button",{onClick:()=>He(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(vr,{isOpen:ie,onClose:()=>He(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return z.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[f]),l?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!e&&!l?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(wr,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):e?s.jsxs("div",{className:`${t?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:I,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(wr,{to:"/leagues",className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{console.log("[League] Badge clicked, opening modal. isMember:",it),b(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative hover:opacity-80 transition-opacity cursor-pointer",children:e?s.jsx("img",{src:Vt(e),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:j=>{const W=j.target;console.error("[League] Badge image failed to load:",W.src,"League:",e);const G=`/assets/league-avatars/${br(e.id)}`;W.src!==G&&(W.src=G)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:e.name}),x&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",x]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>ct(!ht),className:"flex items-center justify-center w-8 h-8 rounded-full hover:bg-slate-100 transition-colors -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${ht?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[ir&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:Qr})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{Y(!0),ct(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[it&&s.jsxs("button",{onClick:()=>{we(!0),ct(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{Ze(!0),ct(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{lr(),ct(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{g(!0),ct(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 hover:bg-red-50 active:bg-red-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${ht?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{P.current=!0,C("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(f==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),f==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(B.length>0||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{P.current=!0,C("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight flex items-center justify-center gap-1.5 "+(f==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const j=new Date,W=Me[0],q=W?.kickoff_time?new Date(W.kickoff_time):null,G=q&&q<=j,oe=Me[Me.length-1]?.fixture_index,ge=(oe!==void 0?Be[oe]:null)?.status==="FINISHED",Re=G&&!ge;return s.jsxs(s.Fragment,{children:[Re&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),f==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(y||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{P.current=!0,C("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(f==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),f==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{P.current=!0,C("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(f==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",f==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),f==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(ws,{miniLeagueId:e?.id??null,memberNames:Xr,deepLinkError:E})}):s.jsx("div",{className:`league-content-wrapper ${ht?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[f==="mlt"&&s.jsx(hn,{}),f==="gw"&&s.jsx(mn,{}),f==="gwr"&&s.jsx(pn,{})]})}),ir&&K&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>Y(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("button",{onClick:()=>Y(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[p.filter(j=>j.id!==n?.id).map(j=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:j.name}),s.jsx("button",{onClick:()=>{mt(j),yt(!0),Y(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 hover:bg-red-200 rounded-md transition-colors font-medium",children:"Remove"})]},j.id)),p.filter(j=>j.id!==n?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{Xe(!0),Y(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),it&&Ge&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{we(!1),Ee&&URL.revokeObjectURL(Ee),_e(null),he(null),ye(!1),ze(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("button",{onClick:()=>{we(!1),Ee&&URL.revokeObjectURL(Ee),_e(null),he(null),ye(!1),ze(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Ne?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(ts,{image:Ne,crop:je,zoom:qe,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Le,onZoomChange:Je,onCropComplete:an,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(qe*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:qe,onChange:j=>Je(Number(j.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Ee?s.jsx("img",{src:Ee,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),pe&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:pe}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{Ee&&URL.revokeObjectURL(Ee),_e(null),Le({x:0,y:0}),Je(1),st(null),ze(null)},disabled:ke,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:ln,disabled:ke||!De,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:ke?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:e?Vt(e):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:j=>{const W=j.target;W.src="/assets/league-avatars/ML-avatar-1.png"}})}),e?.avatar&&s.jsx("button",{onClick:cn,disabled:ke,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:j=>{const W=j.target.files?.[0];W&&on(W)},disabled:ke,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] transition-colors touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),ke&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),Ie&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),pe&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:pe})]})]})]})]})}),s.jsx(vr,{isOpen:te,onClose:()=>se(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${e&&(["The Bird league"].includes(e.name)||["gregVjofVcarl","Let Down"].includes(e.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),Ve&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",tr," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:e.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.code)},className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Copy"}),s.jsx("button",{onClick:lr,className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[p.length,"/",tr," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>Ze(!1),className:"px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50",children:"Close"})})]})}),m&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',e?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:_,children:"Cancel"}),s.jsx("button",{onClick:en,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:_,children:_?"Leaving...":"Leave League"})]})]})}),Qe&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',e?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>et(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:pt,children:"Cancel"}),s.jsx("button",{onClick:tn,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md hover:bg-emerald-700 transition-colors disabled:opacity-50",disabled:pt,children:pt?"Joining...":"Join League"})]})]})}),gt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',tt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>yt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:wt,children:"Cancel"}),s.jsx("button",{onClick:rn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:wt,children:wt?"Removing...":"Remove Member"})]})]})}),ot&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',e?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:rt,children:"Cancel"}),s.jsx("button",{onClick:nn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:rt,children:rt?"Ending...":"Yes, End League"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),c&&e&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>b(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:Vt(e),alt:"League badge",className:"w-full h-full object-cover",onError:j=>{const W=j.target,G=`/assets/league-avatars/${br(e.id)}`;W.src!==G&&(W.src=G)}})}),it&&s.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),console.log("[League] Edit icon clicked"),b(!1),we(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white hover:bg-slate-50 shadow-2xl flex items-center justify-center transition-all z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:e.name})]})})]}):null}export{Ms as default};
