import{u as Y,c as D,r as d,s as P,j as e}from"./index-D_YpmWng.js";function J(){const{user:v}=Y(),[V,R]=D(),x=d.useRef(null),E=d.useRef(null),b=V.get("tab"),y=b==="form5"||b==="form10"||b==="lastgw"||b==="overall"?b:"lastgw",[T,S]=d.useState(!0),[F,W]=d.useState(""),[i,B]=d.useState(null),[p,O]=d.useState([]),[g,U]=d.useState([]),[M,G]=d.useState({}),[a,H]=d.useState(y);d.useEffect(()=>{b||R({tab:"lastgw"},{replace:!0}),y!==a&&H(y)},[y,b,a,R]);const k=t=>{H(t),R({tab:t})};d.useEffect(()=>{let t=!0;return(async()=>{try{S(!0),W("");const{data:n,error:l}=await P.from("gw_results").select("gw").order("gw",{ascending:!1}).limit(1).maybeSingle();if(l)throw l;const r=n?.gw??1;t&&B(r);const{data:s,error:o}=await P.from("v_gw_points").select("user_id, gw, points").order("gw",{ascending:!0});if(o)throw o;const{data:c,error:u}=await P.from("v_ocp_overall").select("user_id, name, ocp");if(u)throw u;if(!t)return;if(U(s??[]),O(c??[]),r&&r>1){const f=s?.filter(h=>h.gw<r)??[],m={};f.forEach(h=>{m[h.user_id]=(m[h.user_id]??0)+(h.points??0)}),t&&G(m)}else t&&G({})}catch(n){t&&W(n?.message??"Failed to load leaderboard.")}finally{t&&S(!1)}})(),()=>{t=!1}},[]);function z(t){const n=Object.keys(t);n.sort((r,s)=>(t[s]??0)-(t[r]??0)||r.localeCompare(s));const l={};return n.forEach((r,s)=>l[r]=s+1),l}const A=d.useMemo(()=>{const t={};return p.forEach(n=>{t[n.user_id]=n.ocp??0}),g.forEach(n=>{n.user_id in t||(t[n.user_id]=n.points??0)}),z(t)},[p,g]),$=d.useMemo(()=>z(M),[M]),j=d.useMemo(()=>t=>{if(!i||i<t)return[];const n=i-t+1,l=g.filter(o=>o.gw>=n&&o.gw<=i),r=new Map;return p.forEach(o=>{r.set(o.user_id,{user_id:o.user_id,name:o.name??"User",formPoints:0,weeksPlayed:new Set})}),l.forEach(o=>{const c=r.get(o.user_id);c?(c.formPoints+=o.points,c.weeksPlayed.add(o.gw)):r.set(o.user_id,{user_id:o.user_id,name:"User",formPoints:o.points,weeksPlayed:new Set([o.gw])})}),Array.from(r.values()).filter(o=>{for(let c=n;c<=i;c++)if(!o.weeksPlayed.has(c))return!1;return!0}).map(o=>({user_id:o.user_id,name:o.name,formPoints:o.formPoints,gamesPlayed:t})).sort((o,c)=>c.formPoints-o.formPoints||o.name.localeCompare(c.name))},[p,g,i]),N=d.useMemo(()=>j(5),[j]),C=d.useMemo(()=>j(10),[j]),L=d.useMemo(()=>{if(!i)return[];const t=g.filter(s=>s.gw===i),n=new Map(p.map(s=>[s.user_id,s.name??"User"])),l=t.map(s=>({user_id:s.user_id,name:n.get(s.user_id)??"User",points:s.points})).sort((s,o)=>o.points-s.points||s.name.localeCompare(o.name));let r=1;return l.map((s,o)=>(o>0&&l[o-1].points!==s.points&&(r=o+1),{...s,rank:r}))},[g,i,p]),_=d.useMemo(()=>{const t=g.filter(r=>r.gw===i),n=new Map;t.forEach(r=>n.set(r.user_id,r.points));const l=p.map(r=>({user_id:r.user_id,name:r.name??"User",this_gw:n.get(r.user_id)??0,ocp:r.ocp??0}));return t.forEach(r=>{l.find(s=>s.user_id===r.user_id)||l.push({user_id:r.user_id,name:"User",this_gw:r.points,ocp:r.points})}),l.sort((r,s)=>s.ocp-r.ocp||r.name.localeCompare(s.name)),l},[p,g,i]);return d.useEffect(()=>(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),[]),d.useEffect(()=>{x.current&&(x.current.scrollTop=0)},[a]),d.useEffect(()=>{const t=x.current;if(!t)return;const n=()=>{t.scrollTop<0&&(t.scrollTop=0),requestAnimationFrame(()=>{t.scrollTop<0&&(t.scrollTop=0)})};t.addEventListener("scroll",n,{passive:!1}),t.addEventListener("touchmove",n,{passive:!1});const l=s=>{t.scrollTop<=0&&s.deltaY<0&&(s.preventDefault(),s.stopPropagation(),t.scrollTop=0)};t.addEventListener("wheel",l,{passive:!1});const r=s=>{if(t.scrollTop<=0){const o=s.touches[0];if(o){const c=o.clientY,u=f=>{const m=f.touches[0];m&&m.clientY<c&&f.preventDefault()};t.addEventListener("touchmove",u,{passive:!1}),t.addEventListener("touchend",()=>{t.removeEventListener("touchmove",u)},{once:!0})}}};return t.addEventListener("touchstart",r,{passive:!1}),()=>{t.removeEventListener("scroll",n),t.removeEventListener("touchmove",n),t.removeEventListener("wheel",l),t.removeEventListener("touchstart",r)}},[]),d.useEffect(()=>{if(!T&&v?.id&&x.current&&E.current){const t=a==="overall"?_:a==="form5"?N:a==="form10"?C:L,n=t.findIndex(s=>s.user_id===v.id),l=n>=0?t[n].rank||n+1:null;if(l!==null&&l<=8)return;x.current&&(x.current.scrollTop=0);const r=setTimeout(()=>{const s=x.current,o=E.current;s&&o&&setTimeout(()=>{if(s&&o){const c=o.offsetTop,u=s.clientHeight,f=o.offsetHeight,m=c-u/2+f/2;s.style.scrollBehavior="smooth",s.scrollTop=m,setTimeout(()=>{s&&(s.style.scrollBehavior="auto")},1e3)}},500)},150);return()=>clearTimeout(r)}},[T,v?.id,a,_,N,C,L]),e.jsxs("div",{className:"fixed inset-0 bg-slate-50 overflow-hidden flex flex-col",children:[e.jsx("style",{children:`
        @keyframes sparkle {
          0%, 100% {
            opacity: 1;
            transform: scale(1) rotate(0deg);
          }
          25% {
            opacity: 0.8;
            transform: scale(1.1) rotate(-5deg);
          }
          50% {
            opacity: 1;
            transform: scale(1.15) rotate(5deg);
          }
          75% {
            opacity: 0.9;
            transform: scale(1.05) rotate(-3deg);
          }
        }
        .sparkle-trophy {
          animation: sparkle 2s ease-in-out infinite;
          filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6));
        }
        .sparkle-trophy svg {
          filter: drop-shadow(0 0 2px rgba(251, 191, 36, 0.8));
        }
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        .flash-you-badge {
          animation: flash 1.5s ease-in-out 3;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pb-0 flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-slate-50 py-4",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight text-slate-900",children:"Leaderboard"}),e.jsx("p",{className:"mt-2 mb-6 text-sm text-slate-600 w-full",children:"See how you rank against every TotL player in the world."}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"flex rounded-full bg-slate-100 p-1.5 border border-slate-200 shadow-sm w-full max-w-md",children:[e.jsx("button",{onClick:()=>k("lastgw"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${a==="lastgw"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"GW"}),e.jsx("button",{onClick:()=>k("form5"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${a==="form5"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"5"}),e.jsx("button",{onClick:()=>k("form10"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all ${a==="form10"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"10"}),e.jsx("button",{onClick:()=>k("overall"),className:`flex-1 py-2.5 rounded-full text-base font-semibold transition-all flex items-center justify-center ${a==="overall"?"bg-[#1C8376] text-white shadow-md":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-5 h-5",children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:"M16 3c1.1046 0 2 0.89543 2 2h2c1.1046 0 2 0.89543 2 2v1c0 2.695 -2.1323 4.89 -4.8018 4.9941 -0.8777 1.5207 -2.4019 2.6195 -4.1982 2.9209V19h3c0.5523 0 1 0.4477 1 1s-0.4477 1 -1 1H8c-0.55228 0 -1 -0.4477 -1 -1s0.44772 -1 1 -1h3v-3.085c-1.7965 -0.3015 -3.32148 -1.4 -4.19922 -2.9209C4.13175 12.8895 2 10.6947 2 8V7c0 -1.10457 0.89543 -2 2 -2h2c0 -1.10457 0.89543 -2 2 -2zm-8 7c0 2.2091 1.79086 4 4 4 2.2091 0 4 -1.7909 4 -4V5H8zM4 8c0 1.32848 0.86419 2.4532 2.06055 2.8477C6.02137 10.5707 6 10.2878 6 10V7H4zm14 2c0 0.2878 -0.0223 0.5706 -0.0615 0.8477C19.1353 10.4535 20 9.32881 20 8V7h-2z",strokeWidth:"1"})})})})]})}),a==="overall"&&e.jsx("div",{className:"text-center mb-2",children:e.jsx("div",{className:"text-sm text-slate-600",children:"All players overall"})}),a==="form5"&&e.jsx("div",{className:"text-center mb-2",children:i&&i>=5?e.jsx("div",{className:"text-sm text-slate-600",children:"Completed the last 5 Rounds"}):e.jsx("div",{className:"text-sm text-amber-600 font-medium",children:"⚠️ Watch this space! Complete 5 GW in a row to see the 5 Week Form Leaderboard."})}),a==="form10"&&e.jsx("div",{className:"text-center mb-2",children:i&&i>=10?e.jsx("div",{className:"text-sm text-slate-600",children:"Completed the last 10 Rounds"}):e.jsx("div",{className:"text-sm text-amber-600 font-medium",children:"⚠️ Watch this space! Complete 10 GW in a row to see the 10 Week Form Leaderboard."})}),a==="lastgw"&&e.jsx("div",{className:"text-center mb-2",children:e.jsxs("div",{className:"text-sm text-slate-600",children:["Players who completed GW",i]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[F&&e.jsx("div",{className:"mb-6 rounded border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700 flex-shrink-0",children:F}),T?e.jsx("div",{className:"text-slate-500",children:"Loading…"}):a==="form5"&&i&&i<5?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-12 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"5 Week Form Leaderboard Coming Soon"}),e.jsx("div",{className:"text-slate-600",children:"Complete 5 game weeks in a row to unlock the 5 Week Form Leaderboard and see who's in the best form!"})]}):a==="form10"&&i&&i<10?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-12 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"10 Week Form Leaderboard Coming Soon"}),e.jsx("div",{className:"text-slate-600",children:"Complete 10 game weeks in a row to unlock the 10 Week Form Leaderboard and see who's in the best form!"})]}):(a==="overall"?_:a==="form5"?N:a==="form10"?C:L).length===0?e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-slate-600",children:"No leaderboard data yet."}):e.jsx("div",{ref:x,className:"flex-1 overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{overscrollBehavior:"contain",WebkitOverflowScrolling:"touch",minHeight:0,paddingBottom:"100px",paddingLeft:"1rem",paddingRight:"1rem",backgroundColor:"#f8fafc",touchAction:"pan-y"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[e.jsx("thead",{className:"sticky top-0 full-width-header-border",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"1px solid #cbd5e1"},children:[e.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"45px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#64748b"},children:"Player"}),a==="overall"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsxs("th",{className:"px-1 py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"55px",color:"#64748b",paddingLeft:"0.5rem",paddingRight:"0.5rem"},children:["GW",i||"?"]}),e.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"OCP"})]}),(a==="form5"||a==="form10")&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:"PTS"})]}),a==="lastgw"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-center font-semibold",style:{backgroundColor:"#f8fafc",width:"40px",borderTop:"none",paddingLeft:"0.5rem",paddingRight:"0.5rem"}}),e.jsxs("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",color:"#64748b"},children:["GW",i||"?"]})]})]})}),e.jsx("tbody",{children:(a==="overall"?_:a==="form5"?N:a==="form10"?C:L).map((t,n,l)=>{const r=t.user_id===v?.id,s="rank"in t?t.rank:n+1,c=l.filter((h,w)=>("rank"in h?h.rank:w+1)===s).length>1,u=s===1;let f="",m="bg-gray-300";if(a==="overall"){const h=$[t.user_id],w=A[t.user_id];w&&h?w<h?(f="▲",m="bg-green-500 text-white"):w>h?(f="▼",m="bg-red-500 text-white"):(f="→",m="bg-gray-500 text-white"):w&&!h&&(f="",m="bg-gray-400")}return e.jsxs("tr",{ref:r?E:null,className:"",style:{...n>0?{borderTop:"1px solid #e2e8f0",position:"relative",backgroundColor:"#f8fafc"}:{position:"relative",backgroundColor:"#f8fafc"}},children:[e.jsx("td",{className:"py-3 text-left tabular-nums whitespace-nowrap relative",style:{width:"45px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:e.jsxs("span",{children:[s,c?"=":""]})}),e.jsx("td",{className:"px-4 py-3",style:{backgroundColor:"#f8fafc"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[(f||m)&&a==="overall"&&e.jsx("span",{className:`inline-flex items-center justify-center w-4 h-4 rounded-full text-xs font-bold ${m} align-middle flex-shrink-0`,"aria-hidden":!0,children:f}),u&&e.jsx("span",{className:"inline-flex items-center sparkle-trophy flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-4 h-4 text-yellow-500",children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:"M16 3c1.1046 0 2 0.89543 2 2h2c1.1046 0 2 0.89543 2 2v1c0 2.695 -2.1323 4.89 -4.8018 4.9941 -0.8777 1.5207 -2.4019 2.6195 -4.1982 2.9209V19h3c0.5523 0 1 0.4477 1 1s-0.4477 1 -1 1H8c-0.55228 0 -1 -0.4477 -1 -1s0.44772 -1 1 -1h3v-3.085c-1.7965 -0.3015 -3.32148 -1.4 -4.19922 -2.9209C4.13175 12.8895 2 10.6947 2 8V7c0 -1.10457 0.89543 -2 2 -2h2c0 -1.10457 0.89543 -2 2 -2zm-8 7c0 2.2091 1.79086 4 4 4 2.2091 0 4 -1.7909 4 -4V5H8zM4 8c0 1.32848 0.86419 2.4532 2.06055 2.8477C6.02137 10.5707 6 10.2878 6 10V7H4zm14 2c0 0.2878 -0.0223 0.5706 -0.0615 0.8477C19.1353 10.4535 20 9.32881 20 8V7h-2z",strokeWidth:"1"})})})}),e.jsx("span",{className:"font-normal text-sm truncate min-w-0 whitespace-nowrap",style:{color:"rgb(0, 0, 0)",overflow:"hidden",textOverflow:"ellipsis"},children:t.name}),r&&e.jsx("span",{className:"ml-2 rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-semibold text-emerald-800 flex-shrink-0 flash-you-badge",children:"you"})]})}),a==="overall"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"px-1 py-3 text-center tabular-nums font-bold",style:{width:"55px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"this_gw"in t?t.this_gw:0}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"ocp"in t?t.ocp:0})]}),(a==="form5"||a==="form10")&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"formPoints"in t?t.formPoints:0})]}),a==="lastgw"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"}}),e.jsx("td",{className:"py-3 text-center tabular-nums font-bold",style:{width:"60px",paddingLeft:"0.5rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc"},children:"points"in t?t.points:0})]})]},t.user_id)})})]})})]})]})]})}export{J as default};
