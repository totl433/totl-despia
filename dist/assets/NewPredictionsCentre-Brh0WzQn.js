import{u as ie,r as d,s as g,j as e}from"./index-CTKCpAmM.js";import{a as ae}from"./teamNames-lueGeFt9.js";import{u as oe}from"./useLiveScores-CezJ10XJ.js";function z(x,m){const $=x?.[`${m}_name`],y=x?.[`${m}_team`],v=x?.[`${m}_code`]||$||y||"";return ae(v)||(m==="home"?"Home":"Away")}function de(){const{user:x}=ie(),[m,$]=d.useState(null),[y,q]=d.useState([]),[v,C]=d.useState(new Map),[P,R]=d.useState(new Map),[K,D]=d.useState(!0),[U,E]=d.useState(""),[T,H]=d.useState(!1),[B,I]=d.useState(!1),[J,A]=d.useState(!1),[V,F]=d.useState(!1),[Q,W]=d.useState("saved"),[w,X]=d.useState(!1),[L,Z]=d.useState(null),[O,ee]=d.useState(null),[k,te]=d.useState(!1),[j,se]=d.useState(null),Y=d.useMemo(()=>y.map(s=>s.api_match_id).filter(s=>s!=null),[y]),{liveScores:re}=oe(m||void 0,Y.length>0?Y:void 0);return d.useEffect(()=>{console.log("isPastDeadline state changed to:",w)},[w]),d.useEffect(()=>{if(P.size>0&&v.size>0){let s=0;v.forEach(t=>{const r=P.get(t.fixture_index);r&&r===t.pick&&s++}),Z(s),console.log("Calculated score:",s),(async()=>{if(m){const{data:t}=await g.from("picks").select("user_id, fixture_index, pick").eq("gw",m);if(t){const r=new Map;t.forEach(b=>{const p=P.get(b.fixture_index),u=r.get(b.user_id)||0;p&&p===b.pick?r.set(b.user_id,u+1):r.set(b.user_id,u)});const a=Array.from(r.values()).sort((b,p)=>p-b),i=a.filter(b=>b>=s).length,h=a.length,f=Math.round(i/h*100);ee(f),console.log("Top percent:",f)}}})()}},[P,v,m]),d.useEffect(()=>{let s=!0;return(async()=>{try{let t=!1;if(x?.id)try{const{data:l,error:n}=await g.from("league_members").select("leagues(id,name)").eq("user_id",x.id);n?(console.warn("[NewPredictionsCentre] Error checking leagues (non-fatal):",n),t=!1):l&&(t=l.some(c=>c.leagues?.name==="API Test"))}catch(l){console.error("[NewPredictionsCentre] Error checking API Test membership:",l),t=!1}s&&te(t);const{data:r,error:a}=await g.from("meta").select("current_gw").eq("id",1).maybeSingle();if(a){console.error("[NewPredictionsCentre] Error fetching current GW:",a),s&&(E(`Failed to load gameweek: ${a.message||"Unknown error"}`),D(!1));return}const i=r?.current_gw??1;let h,f=i;if(t)try{const{data:l}=await g.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let n=l?.current_test_gw??1;if(n&&n!==1){const{data:_}=await g.from("test_api_fixtures").select("test_gw").eq("test_gw",n).limit(1).maybeSingle();if(!_){const{data:M}=await g.from("test_api_fixtures").select("test_gw").eq("test_gw",1).limit(1).maybeSingle();M&&(n=1)}}const c=await g.from("test_api_fixtures").select("id,test_gw as gw,fixture_index,home_name,away_name,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",n).order("fixture_index",{ascending:!0});if(c.error){const _=c.error?.code,M=c.error.message||"";if(_==="PGRST116"||M.includes("404")||M.includes("does not exist"))console.log("[NewPredictionsCentre] Test fixtures table not found, using regular fixtures"),h=await g.from("fixtures").select("id,gw,fixture_index,home_name,away_name,home_team,away_team,home_code,away_code,kickoff_time").eq("gw",i).order("fixture_index",{ascending:!0});else throw console.error("[NewPredictionsCentre] Error fetching test fixtures:",c.error),c.error}else c.data&&c.data.length>0?(h={data:c.data,error:null},f=1,console.log("[NewPredictionsCentre] Using test fixtures for GW 1:",c.data.length,"fixtures")):(console.log("[NewPredictionsCentre] No test fixtures found, using regular fixtures"),h=await g.from("fixtures").select("id,gw,fixture_index,home_name,away_name,home_team,away_team,home_code,away_code,kickoff_time").eq("gw",i).order("fixture_index",{ascending:!0}))}catch(l){console.error("[NewPredictionsCentre] Error fetching test fixtures, falling back to regular:",l),h=await g.from("fixtures").select("id,gw,fixture_index,home_name,away_name,home_team,away_team,home_code,away_code,kickoff_time").eq("gw",i).order("fixture_index",{ascending:!0})}else h=await g.from("fixtures").select("id,gw,fixture_index,home_name,away_name,home_team,away_team,home_code,away_code,kickoff_time").eq("gw",i).order("fixture_index",{ascending:!0});const{data:b,error:p}=h;if(p){console.error("Error fetching fixtures:",p),s&&(D(!1),E(`Failed to load fixtures: ${p.message||"Unknown error"}`));return}const u=b??[];if(s&&(q(u),$(f),s&&se(f),console.log("Loaded",u.length,"fixtures for GW",f,t&&f===1?"(Test GW 1)":""),u.length>0&&u[0].kickoff_time)){const l=u.reduce((n,c)=>{if(!c.kickoff_time)return n;const _=new Date(c.kickoff_time);return!n||_<n?_:n},null);if(l){const n=new Date(l.getTime()-45e5),c=new Date,_=c.getTime()>n.getTime();console.log("Earliest kickoff:",l.toISOString()),console.log("Deadline time:",n.toISOString()),console.log("Current time:",c.toISOString()),console.log("Is past deadline?",_),X(_)}}const S=t&&f===1?1:i;if(x?.id){const{data:l,error:n}=await g.from("picks").select("gw,fixture_index,pick").eq("gw",S).eq("user_id",x.id);n&&console.error("Error fetching picks:",n);const c=new Map;l?.forEach(_=>{c.set(_.fixture_index,{fixture_index:_.fixture_index,pick:_.pick,gw:_.gw})}),s&&(C(c),console.log("Loaded",c.size,"user picks for GW",i))}if(x?.id){const{data:l}=await g.from("gw_submissions").select("submitted_at").eq("gw",S).eq("user_id",x.id).maybeSingle();s&&(H(!!l?.submitted_at),console.log("Submission status:",l?.submitted_at?"confirmed":"not confirmed"))}const o=t&&f===1?1:i,{data:N,error:G}=await g.from("gw_results").select("gw,fixture_index,result").eq("gw",o);if(!G&&N){const l=new Map;N.forEach(n=>{(n.result==="H"||n.result==="D"||n.result==="A")&&l.set(n.fixture_index,n.result)}),s&&(R(l),console.log("Loaded",l.size,"results for GW",i))}}catch(t){if(console.error("Error loading GW data:",t),s){D(!1);let r="Unknown error";t?.message?r=t.message:typeof t=="string"?r=t:t?.toString&&(r=t.toString()),(r.includes("Unexpected token")||r.includes("is not valid JSON"))&&(r="Server returned invalid response. Please check your connection and try again."),E(`Failed to load matches: ${r}`)}}finally{s&&D(!1)}})(),()=>{s=!1}},[x?.id]),U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"text-red-600 font-semibold text-lg mb-2",children:"Failed to Load Matches"}),e.jsx("div",{className:"text-slate-600 text-sm mb-4",children:U}),e.jsx("button",{onClick:()=>{E(""),D(!0),window.location.reload()},className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Retry"})]})}):K||!m||y.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-600",children:"Loading fixtures..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold tracking-tight text-slate-900",children:"Predictions Centre"}),e.jsx("p",{className:"mt-2 mb-6 text-sm text-slate-600 w-full",children:"Call every game, lock in your results, and climb the table."})]}),m&&e.jsx("div",{className:"mt-2 mb-3",children:T?e.jsx("div",{className:"rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-bold text-slate-900 text-xl mb-3",children:["Game Week ",m]}),L!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[L,"/",y.length]}),O!==null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",O,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${L/y.length*100}%`}})})]})]})}):e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-[#1C8376]/10 to-blue-50 border-[#1C8376]/20 px-6 py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-[#1C8376] text-lg",children:["Gameweek ",m]}),e.jsx("div",{className:"text-sm text-slate-600",children:"Make your predictions below"})]})})}),e.jsx("div",{className:"space-y-4",children:y.map(s=>{const t=v.get(s.fixture_index),r=P.get(s.fixture_index),a=s.api_match_id,i=a?re.get(a):null,h=s.kickoff_time?(()=>{const o=new Date(s.kickoff_time),N=String(o.getUTCHours()).padStart(2,"0"),G=String(o.getUTCMinutes()).padStart(2,"0");return`${N}:${G}`})():"—",f=i&&(i.status==="IN_PLAY"||i.status==="PAUSED"||i.status==="FINISHED"),b=f?`${i.home_score??0}-${i.away_score??0}`:h,p=i?.status==="IN_PLAY"?i.minute?`${i.minute}'`:"LIVE":i?.status==="PAUSED"?"HT":i?.status==="FINISHED"?"FT":null,u=z(s,"home"),S=z(s,"away");return e.jsxs("div",{className:"rounded-2xl border bg-white p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center px-2 pt-1 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-1 justify-end",children:[e.jsx("div",{className:"truncate font-medium",children:u}),e.jsx("img",{src:`/assets/badges/${s.home_code?.toUpperCase()||"UNK"}.png`,alt:u,className:"w-5 h-5",onError:o=>{o.currentTarget.style.display="none"}})]}),e.jsx("div",{className:"text-slate-500 text-sm px-4 text-center",children:f?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"font-bold text-slate-900 text-base",children:b}),p&&e.jsx("div",{className:"text-xs text-slate-500",children:p})]}):h}),e.jsxs("div",{className:"flex items-center gap-1 flex-1 justify-start",children:[e.jsx("img",{src:`/assets/badges/${s.away_code?.toUpperCase()||"UNK"}.png`,alt:S,className:"w-5 h-5",onError:o=>{o.currentTarget.style.display="none"}}),e.jsx("div",{className:"truncate font-medium",children:S})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:T?e.jsxs(e.Fragment,{children:[(()=>{const o=r&&t?.pick===r,N=r&&t?.pick!==r;return e.jsx("div",{className:`h-16 rounded-xl border text-sm font-medium flex items-center justify-center relative overflow-hidden ${t?.pick==="H"?o?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl shadow-gray-400/40 before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s] ring-2 ring-yellow-300/60":N&&r==="H"?"bg-red-500 text-white border-red-400":"bg-[#1C8376] text-white border-[#1C8376]":r==="H"?"bg-gray-300 text-slate-700 border-gray-400":"bg-slate-50 text-slate-400 border-slate-200"}`,children:"Home Win"})})(),(()=>{const o=r&&t?.pick===r,N=r&&t?.pick!==r;return e.jsx("div",{className:`h-16 rounded-xl border text-sm font-medium flex items-center justify-center relative overflow-hidden ${t?.pick==="D"?o?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl shadow-gray-400/40 before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s] ring-2 ring-yellow-300/60":N&&r==="D"?"bg-red-500 text-white border-red-400":"bg-[#1C8376] text-white border-[#1C8376]":r==="D"?"bg-gray-300 text-slate-700 border-gray-400":"bg-slate-50 text-slate-400 border-slate-200"}`,children:"Draw"})})(),(()=>{const o=r&&t?.pick===r,N=r&&t?.pick!==r;return e.jsx("div",{className:`h-16 rounded-xl border text-sm font-medium flex items-center justify-center relative overflow-hidden ${t?.pick==="A"?o?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl shadow-gray-400/40 before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s] ring-2 ring-yellow-300/60":N&&r==="A"?"bg-red-500 text-white border-red-400":"bg-[#1C8376] text-white border-[#1C8376]":r==="A"?"bg-gray-300 text-slate-700 border-gray-400":"bg-slate-50 text-slate-400 border-slate-200"}`,children:"Away Win"})})()]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{if(w)return;const o=new Map(v);o.set(s.fixture_index,{fixture_index:s.fixture_index,pick:"H",gw:m}),C(o)},disabled:w,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${t?.pick==="H"?"bg-[#1C8376] text-white border-[#1C8376]":w?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(w)return;const o=new Map(v);o.set(s.fixture_index,{fixture_index:s.fixture_index,pick:"D",gw:m}),C(o)},disabled:w,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${t?.pick==="D"?"bg-[#1C8376] text-white border-[#1C8376]":w?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(w)return;const o=new Map(v);o.set(s.fixture_index,{fixture_index:s.fixture_index,pick:"A",gw:m}),C(o)},disabled:w,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${t?.pick==="A"?"bg-[#1C8376] text-white border-[#1C8376]":w?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})})]},s.id)})})]})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-3",children:[y.length>0&&(()=>{const s=y.reduce((t,r)=>{if(!r.kickoff_time)return t;const a=new Date(r.kickoff_time);return!t||a<t?a:t},null);return s&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Deadline"}),e.jsx("div",{className:"text-sm font-bold text-slate-700",children:(()=>{const t=new Date(s.getTime()-45e5),r=t.toLocaleDateString(void 0,{weekday:"short"}),a=t.toLocaleDateString(void 0,{month:"short"}),i=t.toLocaleDateString(void 0,{day:"numeric"}),h=t.getUTCHours().toString().padStart(2,"0"),f=t.getUTCMinutes().toString().padStart(2,"0");return`${r}, ${a} ${i}, ${h}:${f}`})()}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"(75 minutes before first kickoff)"})]})})(),!T&&!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{if(w){alert("⚠️ Too late! Predictions are now closed. The deadline was 75 minutes before the first kickoff.");return}I(!0)},className:"w-full py-4 bg-slate-600 text-white rounded-2xl font-bold hover:bg-slate-700 transition-colors",children:"Save Predictions"}),e.jsx("button",{onClick:()=>{if(w){alert("⚠️ Too late! Predictions are now closed. The deadline was 75 minutes before the first kickoff.");return}y.every(t=>v.has(t.fixture_index))?A(!0):alert("Please make all predictions before confirming")},className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors",children:"Confirm Predictions"})]}),w&&!T&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-red-600 mb-2",children:"⚠️ Deadline Passed"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Predictions are now closed. The deadline was 75 minutes before the first kickoff."})]}),T&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-green-600 mb-2",children:"✅ Predictions Submitted!"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your predictions for Gameweek ",m," have been confirmed and locked."]})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Save Predictions?"}),e.jsxs("div",{className:"text-slate-600 mb-6",children:["Your predictions will be saved but you can still change them before confirming.",y.length>0&&(()=>{const s=y.reduce((t,r)=>{if(!r.kickoff_time)return t;const a=new Date(r.kickoff_time);return!t||a<t?a:t},null);return s&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[e.jsx("div",{className:"text-sm font-medium text-amber-800 mb-1",children:"Deadline Reminder"}),e.jsx("div",{className:"text-xs text-amber-700",children:(()=>{const t=new Date(s.getTime()-45e5),r=t.toLocaleDateString(void 0,{weekday:"short"}),a=t.toLocaleDateString(void 0,{month:"short"}),i=t.toLocaleDateString(void 0,{day:"numeric"}),h=t.getUTCHours().toString().padStart(2,"0"),f=t.getUTCMinutes().toString().padStart(2,"0");return`${r}, ${a} ${i}, ${h}:${f}`})()}),e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"(75 minutes before first kickoff)"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"flex-1 py-3 bg-slate-200 text-slate-800 rounded-xl font-bold hover:bg-slate-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const s=Array.from(v.values()).map(i=>k&&j===1?{user_id:x?.id,matchday:1,fixture_index:i.fixture_index,pick:i.pick}:{user_id:x?.id,gw:i.gw,fixture_index:i.fixture_index,pick:i.pick}),t=k&&j===1?"test_api_picks":"picks",r=k&&j===1?"user_id,matchday,fixture_index":"user_id,gw,fixture_index",{error:a}=await g.from(t).upsert(s,{onConflict:r,ignoreDuplicates:!1});if(a){console.error("Error saving picks:",a),alert("Failed to save predictions. Please try again.");return}console.log("Successfully saved picks:",s),I(!1),W("saved"),F(!0)}catch(s){console.error("Error saving picks:",s),alert("Failed to save predictions. Please try again.")}},className:"flex-1 py-3 bg-slate-600 text-white rounded-xl font-bold hover:bg-slate-700 transition-colors",children:"Save"})]})]})})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Are You Sure?"}),e.jsx("div",{className:"text-slate-600 mb-6",children:"Once confirmed, you cannot change your predictions. Make sure you're happy with all your picks!"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-3 bg-slate-200 text-slate-800 rounded-xl font-bold hover:bg-slate-300 transition-colors",children:"Go Back"}),e.jsx("button",{onClick:async()=>{try{const s=Array.from(v.values()).map(u=>k&&j===1?{user_id:x?.id,matchday:1,fixture_index:u.fixture_index,pick:u.pick}:{user_id:x?.id,gw:u.gw,fixture_index:u.fixture_index,pick:u.pick}),t=k&&j===1?"test_api_picks":"picks",r=k&&j===1?"user_id,matchday,fixture_index":"user_id,gw,fixture_index",{error:a}=await g.from(t).upsert(s,{onConflict:r,ignoreDuplicates:!1});if(a){console.error("Error confirming picks:",a),alert("Failed to confirm predictions. Please try again.");return}const i=k&&j===1?"test_api_submissions":"gw_submissions",h=k&&j===1?{user_id:x?.id,matchday:1,submitted_at:new Date().toISOString()}:{user_id:x?.id,gw:m??1,submitted_at:new Date().toISOString()},f=k&&j===1?"user_id,matchday":"user_id,gw",{error:b}=await g.from(i).upsert(h,{onConflict:f});if(b){console.error("Error recording submission:",b),alert("Failed to record submission. Please try again.");return}const{data:p}=await g.from("league_members").select("league_id").eq("user_id",x?.id);if(p&&p.length>0){const u=k&&j===1?1:m??1;p.forEach(({league_id:S})=>{fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:S,matchday:u,isTestApi:k&&j===1})}).catch(o=>{console.error("[NewPredictionsCentre] Failed to check final submission:",o)})})}console.log("Successfully confirmed picks:",s),H(!0),A(!1),W("confirmed"),F(!0),window.dispatchEvent(new CustomEvent("predictionsSubmitted"))}catch(s){console.error("Error confirming picks:",s),alert("Failed to confirm predictions. Please try again.")}},className:"flex-1 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors",children:"Confirm"})]})]})})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[Q==="saved"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:"Predictions Saved!"}),e.jsx("div",{className:"text-slate-600 mb-4",children:"Your predictions have been saved as a draft. You can still edit them until you confirm."}),e.jsxs("div",{className:"text-sm text-amber-700 bg-amber-50 rounded-lg p-3 mb-6 border border-amber-200",children:["⚠️ ",e.jsx("strong",{children:"Important:"})," Don't forget to come back and publish your predictions before the deadline to make them final!"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:"Predictions Confirmed!"}),e.jsx("div",{className:"text-slate-600 mb-6",children:"Your predictions have been published and locked. Good luck!"})]}),e.jsx("button",{onClick:()=>F(!1),className:"w-full py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors",children:"Done"})]})})})]})}export{de as default};
