import{j as e,r as y,u as at,e as ot,s as C,i as nt}from"./index-KOZHjtGm.js";import{a as F}from"./teamNames-lueGeFt9.js";function lt({code:x,size:v=22,className:h="",rounded:q=!1}){const m=`/assets/badges/${x}.png`,B=`${x} badge`;return e.jsx("img",{src:m,alt:B,width:v,height:v,className:`${q?"rounded-full":"rounded"} object-contain inline-block align-middle select-none ${h}`,loading:"lazy",onError:T=>{T.currentTarget.style.opacity="0.35"}})}function oe({code:x,crest:v,size:h=22,className:q=""}){const[m,B]=y.useState(!1);return v&&!m?e.jsx("img",{src:v,alt:`${x||"Team"} badge`,width:h,height:h,className:`rounded object-contain inline-block align-middle select-none ${q}`,loading:"lazy",onError:()=>{B(!0)}}):x?e.jsx(lt,{code:x,size:h,className:q}):e.jsx("div",{className:`rounded bg-slate-200 ${q}`,style:{width:h,height:h}})}function ct(x,v,h=!1){if(x==="FINISHED")return"FT";if(x==="PAUSED")return"HT";if(x==="IN_PLAY"){if(v==null)return"LIVE";if(h)return`${v}'`;if(v>=1&&v<=45)return"First Half";if(v>45&&v<=50)return"45+";if(v>50)return"Second Half"}return"LIVE"}function dt(x){let v=0;for(let B=0;B<x.length;B++)v=x.charCodeAt(B)+((v<<5)-v);const h=Math.abs(v%360),q=60+Math.abs(v)%20,m=45+Math.abs(v)%15;return`hsl(${h}, ${q}%, ${m}%)`}function ye(x,v){return x&&ze[x]?ze[x].primary:dt(x||v||"default")}const ze={ARS:{primary:"#EF0107",secondary:"#023474"},AVL:{primary:"#95BFE5",secondary:"#670E36"},BOU:{primary:"#DA291C",secondary:"#000000"},BRE:{primary:"#E30613",secondary:"#FBB800"},BHA:{primary:"#0057B8",secondary:"#FFCD00"},CHE:{primary:"#034694",secondary:"#034694"},CRY:{primary:"#1B458F",secondary:"#C4122E"},EVE:{primary:"#003399",secondary:"#003399"},FUL:{primary:"#FFFFFF",secondary:"#000000"},LIV:{primary:"#C8102E",secondary:"#00B2A9"},MCI:{primary:"#6CABDD",secondary:"#1C2C5B"},MUN:{primary:"#DA291C",secondary:"#FBE122"},NEW:{primary:"#241F20",secondary:"#FFFFFF"},NFO:{primary:"#DD0000",secondary:"#FFFFFF"},TOT:{primary:"#132257",secondary:"#FFFFFF"},WHU:{primary:"#7A263A",secondary:"#1BB1E7"},WOL:{primary:"#FDB913",secondary:"#231F20"},SUN:{primary:"#EB172B",secondary:"#211E1F"},LEE:{primary:"#FFCD00",secondary:"#1D428A"}};function xt(){const{user:x}=at(),v=ot(),[h,q]=y.useState(null),[m,B]=y.useState([]),[T,U]=y.useState(new Map),[z,Pe]=y.useState(new Map),[I,H]=y.useState(0),[Z,ne]=y.useState("cards"),[L,me]=y.useState({x:0,y:0,rotation:0,opacity:1,scale:1}),[le,Ce]=y.useState(!1),[V,Te]=y.useState(!1),[we,ee]=y.useState(null),[Ye,Oe]=y.useState(!1),[ce,te]=y.useState(null),[ue,xe]=y.useState(!0),[Ae,fe]=y.useState(!1),[se,re]=y.useState(!1),[p,Y]=y.useState(!1);y.useEffect(()=>{!ue&&!p&&m.length>0&&I===0&&ne("cards")},[ue,p,m.length,I]);const[Ee,he]=y.useState(null),[Ve,Xe]=y.useState(!1),[pe,Ke]=y.useState([]),[Le,Je]=y.useState(new Set),[De,Qe]=y.useState(null),[X,Me]=y.useState({}),Fe=y.useRef({}),ie=()=>{if(typeof window>"u")return!1;const t=`test_api_submitted_${h}_${x?.id}`;return sessionStorage.getItem(t)==="true"},ae=t=>{if(typeof window>"u"||!h||!x?.id)return;const s=`test_api_submitted_${h}_${x?.id}`;t?sessionStorage.setItem(s,"true"):sessionStorage.removeItem(s)},W=y.useRef(ie());y.useEffect(()=>{const t=document.documentElement,s=document.body,i=document.getElementById("root");t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important");const r=setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},100);return()=>{clearTimeout(r),t.style.setProperty("overflow","","important"),s.style.setProperty("overflow","","important"),s.style.setProperty("position","","important"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.setProperty("overflow","","important"),setTimeout(()=>{t.style.removeProperty("overflow"),s.style.removeProperty("overflow"),s.style.removeProperty("position"),s.style.removeProperty("width"),s.style.removeProperty("height"),s.style.removeProperty("top"),i&&i.style.removeProperty("overflow")},50)}},[]),y.useEffect(()=>{const t=I>=m.length,s=Z==="cards"&&!t&&m.length>0&&!p,i=document.documentElement,r=document.body,d=document.getElementById("root"),o=()=>{i.style.setProperty("overflow","","important"),r.style.setProperty("overflow","","important"),r.style.setProperty("position","","important"),d&&d.style.setProperty("overflow","","important"),i.style.removeProperty("overflow"),r.style.removeProperty("overflow"),r.style.removeProperty("position"),r.style.removeProperty("width"),r.style.removeProperty("height"),r.style.removeProperty("top"),d&&d.style.removeProperty("overflow")};if(!s){o();return}window.scrollTo({top:0,behavior:"auto"}),i.style.setProperty("overflow","hidden","important"),r.style.setProperty("overflow","hidden","important"),r.style.setProperty("position","fixed","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("height","100%","important"),r.style.setProperty("top","0","important"),d&&d.style.setProperty("overflow","hidden","important");const n=a=>{a.preventDefault()},c=a=>{a.target.closest('[style*="aspectRatio"]')||a.preventDefault()};return window.addEventListener("wheel",n,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),()=>{o(),window.removeEventListener("wheel",n),document.removeEventListener("touchmove",c)}},[Z,I,m.length,p]);const de=y.useMemo(()=>m.length===0?!1:m.every(t=>T.has(t.fixture_index)),[m,T]),Ze=y.useRef(null),ve=y.useRef({x:0,y:0}),_e=y.useRef(!1);y.useEffect(()=>{let t=!0;return(async()=>{try{xe(!0),fe(!1),re(!1);let s=null;const{data:i}=await C.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(s=i?.current_test_gw??1,s&&s!==1){const{data:a}=await C.from("test_api_fixtures").select("test_gw").eq("test_gw",s).limit(1).maybeSingle();if(!a){const{data:w}=await C.from("test_api_fixtures").select("test_gw").eq("test_gw",1).limit(1).maybeSingle();w&&(s=1)}}if(!s){t&&(B([]),xe(!1));return}q(s);const{data:r,error:d}=await C.from("test_api_fixtures").select("*").eq("test_gw",s).order("fixture_index",{ascending:!0});if(d)throw new Error(`Failed to load test fixtures: ${d.message}`);if(!r||r.length===0){t&&(B([]),xe(!1));return}const o=r.map(a=>({id:String(a.api_match_id),gw:s,fixture_index:a.fixture_index,home_team:a.home_team,away_team:a.away_team,home_code:a.home_code,away_code:a.away_code,home_name:a.home_name,away_name:a.away_name,home_crest:a.home_crest||null,away_crest:a.away_crest||null,kickoff_time:a.kickoff_time,api_match_id:a.api_match_id||null}));t&&(B(o),Pe(new Map));let n=!1;if(x?.id&&o.length>0){const{data:a}=await C.from("test_api_submissions").select("submitted_at").eq("matchday",s).eq("user_id",x.id).maybeSingle();if(t&&a?.submitted_at)n=!0,Y(!0),W.current=!0,ae(!0),re(!0);else{Y(!1);const w=ie();w&&a?.submitted_at?(Y(!0),n=!0,W.current=!0):(w&&!a?.submitted_at&&ae(!1),W.current=!1),re(!0)}}else t&&(Y(!1),re(!0));let c=!1;if(x?.id&&o.length>0&&!n){const{data:a,error:w}=await C.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",s).eq("user_id",x.id);if(!w&&a&&a.length>0){const D=new Set(o.map(P=>P.fixture_index)),_=a.filter(P=>D.has(P.fixture_index)),u=o.every(P=>_.some(E=>E.fixture_index===P.fixture_index)),A=_.length===o.length;if(u&&A&&_.length>0){const P=new Map;_.forEach(E=>{P.set(E.fixture_index,{fixture_index:E.fixture_index,pick:E.pick,matchday:E.matchday})}),t&&(U(P),c=!0)}else t&&a.length>0&&(console.log("[TestApiPredictions] Picks found but don't match current fixtures - clearing old picks"),await C.from("test_api_picks").delete().eq("matchday",s).eq("user_id",x.id),U(new Map),c=!1)}}else if(n&&x?.id&&o.length>0){const{data:a,error:w}=await C.from("test_api_picks").select("matchday,fixture_index,pick").eq("matchday",s).eq("user_id",x.id);if(!w&&a&&a.length>0){const D=new Set(o.map(u=>u.fixture_index)),_=a.filter(u=>D.has(u.fixture_index));if(_.length===o.length){const u=new Map;_.forEach(A=>{u.set(A.fixture_index,{fixture_index:A.fixture_index,pick:A.pick,matchday:A.matchday})}),t&&(U(u),c=!0)}}t&&!c&&(Y(!1),await C.from("test_api_submissions").delete().eq("matchday",s).eq("user_id",x.id))}if(t&&o.length>0&&x?.id){const{data:a}=await C.from("leagues").select("id").eq("name","API Test").maybeSingle();if(a){t&&Qe(a.id);const{data:w}=await C.from("league_members").select("user_id, profiles!inner(id, name)").eq("league_id",a.id);if(w){const D=w.map(N=>({id:N.user_id,name:N.profiles?.name||"Unknown"}));t&&Ke(D);const _=D.map(N=>N.id),{data:u}=await C.from("test_api_submissions").select("user_id, submitted_at").eq("matchday",s).in("user_id",_).not("submitted_at","is",null),{data:A}=await C.from("test_api_picks").select("user_id, fixture_index").eq("matchday",s).in("user_id",_),G=new Set(o.map(N=>N.fixture_index)),P=G.size,E=new Date("2025-11-18T00:00:00Z"),O=new Set;u&&A&&P>0&&u.forEach(N=>{const J=(A??[]).filter(l=>l.user_id===N.user_id).filter(l=>G.has(l.fixture_index)),Q=J.length===P,k=new Set(J.map(l=>l.fixture_index)).size===P,g=N.submitted_at?new Date(N.submitted_at):null,M=g&&g>=E;Q&&k&&M&&O.add(N.user_id)});const K=_.length>0&&O.size===_.length;t&&(Xe(K),Je(O))}}}t&&(fe(!0),se||re(!0)),t&&o.length>0&&(c&&!n?H(o.length):n&&c||(H(0),ne("cards")))}catch(s){console.error("Error loading test API data:",s),t&&fe(!0)}finally{t&&xe(!1)}})(),()=>{t=!1}},[x?.id]);const Ie=async(t,s)=>{try{console.log("[TestApiPredictions] fetchLiveScore called for matchId:",t,"kickoffTime:",s);const{data:i,error:r}=await C.from("live_scores").select("*").eq("api_match_id",t).single();if(r)return r.code==="PGRST116"?(console.log("[TestApiPredictions] No live score found in Supabase for match",t,"- scheduled function may not have run yet"),null):(console.error("[TestApiPredictions] Error fetching live score from Supabase:",r),null);if(!i)return console.warn("[TestApiPredictions] No live score data in Supabase"),null;console.log("[TestApiPredictions] Live score from Supabase:",i);const d=i.home_score??0,o=i.away_score??0,n=i.status||"SCHEDULED";let c=i.minute;if(c==null&&(n==="IN_PLAY"||n==="PAUSED")&&s)try{const w=new Date(s),_=Math.floor((new Date().getTime()-w.getTime())/(1e3*60));_>0&&_<120&&(n==="PAUSED"?c=null:n==="IN_PLAY"&&(_<=50?c=_:c=46+Math.max(0,_-50)))}catch(w){console.warn("[TestApiPredictions] Error calculating minute from kickoff time:",w)}const a={homeScore:d,awayScore:o,status:n,minute:c,retryAfter:null,goals:i.goals||null,red_cards:i.red_cards||null,home_team:i.home_team||null,away_team:i.away_team||null};return console.log("[TestApiPredictions] Returning score data from Supabase:",a),a}catch(i){return console.error("[TestApiPredictions] Error fetching live score from Supabase:",i?.message||i,i?.stack),null}};y.useEffect(()=>{if(!m.length)return;const t=m.filter(r=>r.api_match_id&&r.kickoff_time);if(t.length===0)return;const s=new Map,i=[];return t.forEach(r=>{if(!r.api_match_id||!r.kickoff_time)return;const d=new Date(r.kickoff_time),o=new Date,n=r.fixture_index,c=()=>{const a=X[n];if(a&&a.status==="FINISHED")return;const w=new Map,D=async()=>{const u=await Ie(r.api_match_id,r.kickoff_time);if(u){const A=u.status==="IN_PLAY"||u.status==="PAUSED",G=u.status==="HALF_TIME"||u.status==="HT",P=u.status==="FINISHED";console.log("[TestApiPredictions] Poll result for fixture",n,":",{status:u.status,isLive:A,isHalfTime:G,isFinished:P,homeScore:u.homeScore,awayScore:u.awayScore,minute:u.minute,apiMatchId:r.api_match_id}),!A&&!P&&!G&&console.warn("[TestApiPredictions] Game",n,"has status",u.status,"but is not detected as live"),X[n]?.status==="PAUSED"&&u.status==="IN_PLAY"&&(Fe.current[r.api_match_id]=new Date,console.log("[TestApiPredictions] Halftime ended for fixture",n,"match",r.api_match_id));let O=u.minute;const K=Fe.current[r.api_match_id];if(u.status==="IN_PLAY"&&K){const $=Math.floor((new Date().getTime()-K.getTime())/(1e3*60));O=46+$,console.log("[TestApiPredictions] Recalculated minute from halftime end:",{fixtureIndex:n,apiMatchId:r.api_match_id,originalMinute:u.minute,finalMinute:O,minutesSinceHalftimeEnd:$})}if(Me(N=>({...N,[n]:{homeScore:u.homeScore,awayScore:u.awayScore,status:u.status,minute:O??null,goals:u.goals||null,red_cards:u.red_cards||null,home_team:u.home_team||null,away_team:u.away_team||null}})),P){console.log("[TestApiPredictions] Game",n,"finished, stopping polling");const N=s.get(n);N&&(clearInterval(N),s.delete(n));const $=w.get(n);$&&(clearTimeout($),w.delete(n))}else if(G){console.log("[TestApiPredictions] Game",n,"at half-time, stopping polling, will resume in 15 minutes");const N=s.get(n);N&&(clearInterval(N),s.delete(n));const $=w.get(n);$&&clearTimeout($);const J=setTimeout(()=>{console.log("[TestApiPredictions] Resuming polling for fixture",n,"after half-time");const Q=async()=>{const k=await Ie(r.api_match_id);if(k){const g=k.status==="FINISHED",M=k.status==="IN_PLAY"||k.status==="PAUSED",l=k.status==="HALF_TIME"||k.status==="HT";if(Me(f=>({...f,[n]:{homeScore:k.homeScore,awayScore:k.awayScore,status:k.status,minute:k.minute??null,goals:k.goals||null,red_cards:k.red_cards||null}})),g){console.log("[TestApiPredictions] Game",n,"finished, stopping polling");const f=s.get(n);f&&(clearInterval(f),s.delete(n)),w.delete(n)}else M?console.log("[TestApiPredictions] Game",n,"second half started - status:",k.status,"minute:",k.minute):l&&console.log("[TestApiPredictions] Game",n,"still at half-time, continuing to poll...")}};Q();const j=setInterval(Q,60*1e3);s.set(n,j),w.delete(n)},900*1e3);w.set(n,J)}else A&&console.log("[TestApiPredictions] Game",n,"is LIVE - status:",u.status,"minute:",u.minute)}};D();const _=setInterval(D,60*1e3);s.set(n,_)};if(d>o){const a=d.getTime()-o.getTime(),w=setTimeout(c,a);i.push(w)}else c()}),()=>{console.log("[TestApiPredictions] Cleaning up polling intervals and timeouts"),s.forEach(clearInterval),i.forEach(clearTimeout)}},[m.map(t=>t.api_match_id).join(",")]),y.useEffect(()=>{const t=new Map;m.forEach(i=>{const r=X[i.fixture_index];r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")&&(r.homeScore>r.awayScore?t.set(i.fixture_index,"H"):r.awayScore>r.homeScore?t.set(i.fixture_index,"A"):t.set(i.fixture_index,"D"))}),Pe(t)},[X,m]),y.useEffect(()=>{if(!h||!x?.id||z.size===0||m.length===0){he(null);return}let t=0;if(m.forEach(s=>{const i=z.get(s.fixture_index),r=T.get(s.fixture_index);i&&r&&i===r.pick&&t++}),t===0){he(null);return}(async()=>{try{const{data:s}=await C.from("test_api_picks").select("user_id, fixture_index, pick").eq("matchday",h);if(s){const i=new Map;s.forEach(c=>{const a=z.get(c.fixture_index),w=i.get(c.user_id)||0;a&&a===c.pick?i.set(c.user_id,w+1):i.set(c.user_id,w)});const r=Array.from(i.values()).sort((c,a)=>a-c),d=r.filter(c=>c>=t).length,o=r.length,n=o>0?Math.round(d/o*100):null;he(n)}}catch(s){console.error("[TestApiPredictions] Error calculating top percent:",s),he(null)}})()},[z,T,m,h,x?.id]);const S=m[I],ge=y.useMemo(()=>{let t=0;return m.forEach(s=>{const i=z.get(s.fixture_index),r=T.get(s.fixture_index);i&&r&&r.pick===i&&(t+=1)}),t},[m,z,T]),$e=(t,s)=>{V||p||(Ce(!0),ve.current={x:t,y:s},ee(null))},Be=(t,s)=>{if(!le||V||p)return;const i=t-ve.current.x,r=s-ve.current.y,d=i*.1;me({x:i,y:r,rotation:d,opacity:1,scale:1}),Math.abs(i)>50&&Math.abs(i)>Math.abs(r)?ee(i>0?"away":"home"):r>50&&r>Math.abs(i)?ee("draw"):ee(null)},je=()=>{if(!le||V||p)return;Ce(!1);const{x:t,y:s}=L,i=100;let r=null;Math.abs(t)>i&&Math.abs(t)>Math.abs(s)?r=t>0?"A":"H":s>i&&s>Math.abs(t)&&(r="D"),r?He(r):(me({x:0,y:0,rotation:0,opacity:1,scale:1}),ee(null))},et=t=>{t.touches.length===1&&$e(t.touches[0].clientX,t.touches[0].clientY)},tt=t=>{t.touches.length===1&&le&&(t.preventDefault(),Be(t.touches[0].clientX,t.touches[0].clientY))},st=t=>{t.touches.length>0||(t.preventDefault(),je())},He=async t=>{Te(!0),ee(null);const s=t==="H"?-1:t==="A"?1:0,i=s*window.innerWidth,r=t==="D"?window.innerHeight:0;me({x:i,y:r,rotation:s*30,opacity:0,scale:.8}),await be(t),setTimeout(()=>{_e.current=!0,Ye?(H(m.length),Oe(!1)):H(I+1),me({x:0,y:0,rotation:0,opacity:1,scale:1}),requestAnimationFrame(()=>{_e.current=!1,Te(!1)})},300)},ke=t=>{!V&&!p&&He(t)},be=async t=>{if(!S||!x?.id||!h)return;const s=new Map(T);s.set(S.fixture_index,{fixture_index:S.fixture_index,pick:t,matchday:h}),U(s);try{const{error:i}=await C.from("test_api_picks").upsert({user_id:x.id,matchday:h,fixture_index:S.fixture_index,pick:t},{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});i&&console.error("Error saving test pick:",i)}catch(i){console.error("Error saving test pick:",i)}},rt=async()=>{if(!(!x?.id||!h))try{const{error:t}=await C.from("test_api_submissions").delete().eq("user_id",x.id).eq("matchday",h);t?console.error("[TestApiPredictions] Error deleting test_api_submission:",t):console.log("[TestApiPredictions] ‚úÖ Successfully deleted submission on Start Over");const{error:s}=await C.from("test_api_picks").delete().eq("user_id",x.id).eq("matchday",h);s?console.error("[TestApiPredictions] ‚ùå Error deleting test_api_picks:",s):console.log("[TestApiPredictions] ‚úÖ Successfully deleted picks on Start Over"),U(new Map),H(0),Y(!1),ne("cards"),W.current=!1,ae(!1),re(!1),fe(!1),console.log("[TestApiPredictions] ‚úÖ All picks and submissions cleared - reset to swipe mode")}catch(t){console.error("[TestApiPredictions] ‚ùå Error resetting picks:",t),U(new Map),H(0),Y(!1),ne("cards"),W.current=!1,ae(!1)}},Ne=async()=>{if(!de){te({success:!1,message:"You still have fixtures to call!"}),setTimeout(()=>te(null),2200);return}if(!(!x?.id||!h))try{const{data:t}=await C.from("test_api_submissions").select("submitted_at").eq("user_id",x.id).eq("matchday",h).maybeSingle();if(t?.submitted_at){console.warn("[TestApiPredictions] Already submitted - this should not happen if Start Over worked"),Y(!0);return}const s=Array.from(T.values()).filter(d=>d.matchday===h).map(d=>({user_id:x.id,matchday:d.matchday,fixture_index:d.fixture_index,pick:d.pick}));if(s.length!==m.length)throw new Error(`Expected ${m.length} picks but got ${s.length}`);const{error:i}=await C.from("test_api_picks").upsert(s,{onConflict:"user_id,matchday,fixture_index",ignoreDuplicates:!1});if(i)throw console.error("[TestApiPredictions] Error saving picks:",i),i;const{error:r}=await C.from("test_api_submissions").upsert({user_id:x.id,matchday:h,submitted_at:new Date().toISOString()},{onConflict:"user_id,matchday"});if(r)throw console.error("[TestApiPredictions] Error saving submission:",r),r;console.log("[TestApiPredictions] Successfully confirmed test picks and submission"),Y(!0),W.current=!0,ae(!0),x?.id&&nt(x.id),te({success:!0,message:"Your test predictions are locked in. Good luck!"}),setTimeout(()=>{te(null)},2500),De&&h&&fetch("/.netlify/functions/notifyFinalSubmission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:De,matchday:h,isTestApi:!0})}).catch(d=>{console.error("[TestApiPredictions] Failed to check final submission:",d)})}catch(t){console.error("Error confirming test picks:",t),te({success:!1,message:"Failed to confirm predictions. Please try again."}),setTimeout(()=>te(null),2200)}},it={loading:ue,currentTestGw:!!h,picksChecked:Ae,submissionChecked:se,submitted:p,sessionStorageSubmitted:ie()};if(console.log("[TestApiPredictions] Render check - loading state:",it),ue||!h||!Ae||!se)return console.log("[TestApiPredictions] Showing skeleton loader"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Test API Predictions"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})})]});if(m.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"No Test Fixtures Found"}),e.jsx("div",{className:"text-sm text-slate-600 mb-4",children:"Please create a test gameweek in the Test API Admin page first."}),e.jsx("button",{onClick:()=>v("/test-admin-api"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Test API Admin"})]})});const Re=ie(),We=p||!se&&Re;if(console.log("[TestApiPredictions] Checking if submitted - state:",p,"sessionStorage:",Re,"submissionChecked:",se,"isUserSubmitted:",We),We){if(console.log("[TestApiPredictions] ‚úÖ Showing submitted view"),!Ve&&pe.length>0){const t=pe.filter(s=>!Le.has(s.id)).length;return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 mb-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-700 mb-3",children:["Waiting for ",e.jsx("span",{className:"font-bold",children:t})," of ",pe.length," to submit..."]}),e.jsx("div",{className:"text-xs text-slate-500 mb-4",children:"Your predictions have been confirmed. Once all members have submitted, you'll be able to see everyone's picks."}),e.jsx("div",{className:"overflow-hidden rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),e.jsx("tbody",{children:pe.slice().sort((s,i)=>s.name.localeCompare(i.name)).map(s=>{const i=Le.has(s.id);return e.jsxs("tr",{className:"border-t border-slate-200",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx("td",{className:"px-4 py-3",children:i?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:"Submitted"}):e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:"Not yet"})})]},s.id)})})]})})]})})})]})}return m.forEach(t=>{const s=X[t.fixture_index],i=s&&(s.status==="IN_PLAY"||s.status==="PAUSED"),r=s&&s.status==="FINISHED";if(s&&(i||r)){const d=T.get(t.fixture_index);d&&(d.pick==="H"&&s.homeScore>s.awayScore||d.pick==="A"&&s.awayScore>s.homeScore||d.pick==="D"&&(s.homeScore,s.awayScore))}}),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v("/"),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Game Week ",h]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[(()=>{const t=m.length>0&&m.some(i=>{const r=X[i.fixture_index];return r&&(r.status==="IN_PLAY"||r.status==="PAUSED"||r.status==="FINISHED")});let s=0;if(t?m.forEach(i=>{const r=X[i.fixture_index],d=T.get(i.fixture_index);if(r&&d){let o=!1;(d.pick==="H"&&r.homeScore>r.awayScore||d.pick==="A"&&r.awayScore>r.homeScore||d.pick==="D"&&r.homeScore===r.awayScore)&&(o=!0),o&&s++}}):p&&m.forEach(i=>{const r=z.get(i.fixture_index),d=T.get(i.fixture_index);r&&d&&r===d.pick&&s++}),t||p&&m.length>0){const i=t?s:p?ge:0,r=m.length>0?i/m.length*100:0;return e.jsx("div",{className:"mb-4 rounded-xl border bg-gradient-to-br from-[#1C8376]/5 to-blue-50/50 shadow-sm px-6 py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsxs("div",{className:"text-4xl font-extrabold text-[#1C8376]",children:[i,"/",m.length]}),Ee!==null&&e.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300",children:e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:["Top ",Ee,"%"]})})]}),e.jsx("div",{className:"mb-3 bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#1C8376] to-blue-500 transition-all duration-500",style:{width:`${r}%`}})})]})})}return null})(),e.jsx("div",{className:"space-y-6 [&>div:first-child]:mt-0",children:(()=>{const t=[];let s="",i=[];return m.forEach(r=>{const d=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";d!==s?(i.length>0&&t.push({label:s,items:i}),s=d,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,d)=>e.jsxs("div",{className:d>0?"mt-6":"",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700 mb-3 px-1",children:e.jsx("span",{children:r.label})}),e.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:e.jsx("ul",{children:r.items.map((o,n)=>{const c=T.get(o.fixture_index),a=X[o.fixture_index],w=a&&a.status==="IN_PLAY",D=a&&(a.status==="PAUSED"||a.status==="HALF_TIME"||a.status==="HT"),_=a&&a.status==="FINISHED",u=w||D,A=o.home_team||o.home_name||o.home_code||"",G=o.away_team||o.away_name||o.away_code||"",P=F(A),E=F(G),O=o.kickoff_time?(()=>{const j=new Date(o.kickoff_time),k=String(j.getUTCHours()).padStart(2,"0"),g=String(j.getUTCMinutes()).padStart(2,"0");return`${k}:${g}`})():"‚Äî",K=j=>{const k=c?.pick===j;let g=!1;return a&&(j==="H"&&a.homeScore>a.awayScore||j==="A"&&a.awayScore>a.homeScore||j==="D"&&a.homeScore===a.awayScore)&&(g=!0),{isPicked:k,isCorrectResult:g,isCorrect:k&&g,isWrong:k&&(u||_)&&!g}},N=K("H"),$=K("D"),J=K("A"),Q=(j,k)=>{const g="h-16 rounded-xl border text-sm font-medium transition-all flex items-center justify-center select-none";return w||u?j.isCorrect?`${g} bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50`:j.isWrong?`${g} bg-[#1C8376] text-white border-[#1C8376]`:j.isPicked?`${g} bg-[#1C8376] text-white border-[#1C8376]`:j.isCorrectResult&&!j.isPicked?`${g} bg-slate-50 text-slate-600 border-2 border-slate-300 animate-pulse`:`${g} bg-slate-50 text-slate-600 border-slate-200`:_?j.isCorrect?`${g} bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-2xl shadow-yellow-400/40 transform scale-110 rotate-1 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]`:j.isWrong?`${g} bg-[#1C8376] text-white border-[#1C8376]`:j.isCorrectResult&&!j.isPicked?`${g} bg-slate-50 text-slate-600 border-4 border-emerald-600`:j.isPicked?`${g} bg-[#1C8376] text-white border-[#1C8376]`:`${g} bg-slate-50 text-slate-600 border-slate-200`:j.isPicked?`${g} bg-[#1C8376] text-white border-[#1C8376]`:`${g} bg-slate-50 text-slate-600 border-slate-200`};return e.jsx("li",{className:n>0?"border-t":"",children:e.jsxs("div",{className:"p-4 bg-white relative",children:[(w||D)&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),e.jsx("div",{className:`flex flex-col px-2 pb-3 ${u?"pt-4":"pt-1"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`break-words ${a&&(u||_)&&a.homeScore>a.awayScore?"font-bold":"font-medium"}`,children:P}),e.jsx("img",{src:`/assets/badges/${(o.home_code||A).toUpperCase()}.png`,alt:P,className:"w-5 h-5",onError:j=>{j.currentTarget.style.opacity="0.35"}})]}),a&&(u||_)&&(()=>{const j=(a.goals||[]).filter(l=>{if(!l||!l.team)return!1;const f=l.team||"",b=F(f),R=a.home_team?F(a.home_team):P;return b===R||b===P||b===F(o.home_team||"")||b===F(o.home_name||"")||f.toLowerCase()===(a.home_team||"").toLowerCase()||f.toLowerCase()===P.toLowerCase()||f.toLowerCase()===(o.home_team||"").toLowerCase()||f.toLowerCase()===(o.home_name||"").toLowerCase()}),k=(a.red_cards||[]).filter(l=>{const f=l.team||"",b=F(f);return b===P||b===F(o.home_team||"")}),g=[],M=new Map;return j.forEach(l=>{const f=l.scorer||"Unknown",b=l.minute;M.has(f)||M.set(f,[]),b!=null&&M.get(f).push(b)}),M.forEach((l,f)=>{const b=l.sort((R,Se)=>R-Se);g.push({type:"goal",minute:b[0],scorer:f,minutes:b})}),k.forEach(l=>{g.push({type:"red_card",minute:l.minute,player:l.player||"Unknown"})}),g.sort((l,f)=>l.minute===null?1:f.minute===null?-1:l.minute-f.minute),g.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-end gap-0.5",children:g.map((l,f)=>l.type==="goal"?e.jsxs("span",{className:"text-[11px] text-slate-600",children:[l.scorer," ",l.minutes.sort((b,R)=>b-R).map(b=>`${b}'`).join(", ")]},f):e.jsxs("span",{className:"text-[11px] text-slate-600",children:["üü• ",l.player," ",l.minute,"'"]},f))})})()]}),e.jsx("div",{className:"px-4 flex flex-col items-center",children:a&&(u||_)?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-base text-slate-900",children:[a.homeScore," - ",a.awayScore]}),e.jsx("span",{className:`text-[10px] font-semibold mt-0.5 ${u?"text-red-600":"text-slate-500"}`,children:ct(a.status,a.minute,!0)})]}):e.jsx("span",{className:"text-slate-500 text-sm",children:O})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:`/assets/badges/${(o.away_code||G).toUpperCase()}.png`,alt:E,className:"w-5 h-5",onError:j=>{j.currentTarget.style.opacity="0.35"}}),e.jsx("div",{className:`break-words ${a&&(u||_)&&a.awayScore>a.homeScore?"font-bold":"font-medium"}`,children:E})]}),a&&(u||_)&&(()=>{const j=(a.goals||[]).filter(l=>{if(!l||!l.team)return!1;const f=l.team||"",b=F(f),R=a.away_team?F(a.away_team):E;return b===R||b===E||b===F(o.away_team||"")||b===F(o.away_name||"")||f.toLowerCase()===(a.away_team||"").toLowerCase()||f.toLowerCase()===E.toLowerCase()||f.toLowerCase()===(o.away_team||"").toLowerCase()||f.toLowerCase()===(o.away_name||"").toLowerCase()}),k=(a.red_cards||[]).filter(l=>{const f=l.team||"",b=F(f);return b===E||b===F(o.away_team||"")}),g=[],M=new Map;return j.forEach(l=>{const f=l.scorer||"Unknown",b=l.minute;M.has(f)||M.set(f,[]),b!=null&&M.get(f).push(b)}),M.forEach((l,f)=>{const b=l.sort((R,Se)=>R-Se);g.push({type:"goal",minute:b[0],scorer:f,minutes:b})}),k.forEach(l=>{g.push({type:"red_card",minute:l.minute,player:l.player||"Unknown"})}),g.sort((l,f)=>l.minute===null?1:f.minute===null?-1:l.minute-f.minute),g.length===0?null:e.jsx("div",{className:"mt-3 mb-2 flex flex-col items-start gap-0.5",children:g.map((l,f)=>l.type==="goal"?e.jsxs("span",{className:"text-[11px] text-slate-600",children:[l.scorer," ",l.minutes.sort((b,R)=>b-R).map(b=>`${b}'`).join(", ")]},f):e.jsxs("span",{className:"text-[11px] text-slate-600",children:["üü• ",l.player," ",l.minute,"'"]},f))})})()]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 relative mt-4",children:[e.jsx("div",{className:`${Q(N)} flex items-center justify-center`,children:e.jsx("span",{className:`${N.isCorrect?"font-bold":""} ${N.isWrong&&_?"line-through decoration-2 decoration-white":""}`,children:"Home Win"})}),e.jsx("div",{className:`${Q($)} flex items-center justify-center`,children:e.jsx("span",{className:`${$.isCorrect?"font-bold":""} ${$.isWrong&&_?"line-through decoration-2 decoration-white":""}`,children:"Draw"})}),e.jsx("div",{className:`${Q(J)} flex items-center justify-center`,children:e.jsx("span",{className:`${J.isCorrect?"font-bold":""} ${J.isWrong&&_?"line-through decoration-2 decoration-white":""}`,children:"Away Win"})})]})]})},o.id)})})})]},d))})()})]})})]})}const Ge=ie();if(!p&&Ge&&se&&(console.log("[TestApiPredictions] WARNING: sessionStorage says submitted but state says no - clearing sessionStorage"),ae(!1),W.current=!1),console.log("[TestApiPredictions] Review mode check - submitted:",p,"ref:",W.current,"sessionStorage:",Ge),console.log("[TestApiPredictions] Review mode check - currentIndex:",I,"fixtures.length:",m.length,"submitted:",p),I>=m.length)return console.log("[TestApiPredictions] ‚úÖ Showing review mode"),e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[ce&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-white px-10 py-8 text-center shadow-2xl max-w-sm mx-4",children:[e.jsx("div",{className:"absolute -top-16 -left-10 h-32 w-32 rounded-full bg-emerald-200/40 blur-2xl"}),e.jsx("div",{className:"absolute -bottom-14 -right-12 h-32 w-32 rounded-full bg-cyan-200/40 blur-2xl"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[ce.success?e.jsx("svg",{className:"w-16 h-16 mx-auto text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-16 h-16 mx-auto text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("div",{className:`text-2xl font-extrabold ${ce.success?"text-emerald-700":"text-amber-600"}`,children:ce.success?"Good Luck!":"Not Quite Yet!"}),e.jsx("p",{className:"text-sm text-slate-600",children:ce.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>H(0),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:"Review Mode"}),de&&!p?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-emerald-500 px-3 py-1.5 text-sm font-semibold text-white shadow hover:bg-emerald-600",children:"Confirm"}):p?e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"‚úì Submitted"}):T.size>0?e.jsx("button",{onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 shadow-inner",children:"Confirm"}):e.jsx("button",{onClick:()=>H(0),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:"Swipe View"})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative rounded-3xl border border-emerald-100 bg-white px-5 py-3 shadow-sm max-w-md w-full flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center text-emerald-700",children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v4m0 4h.01"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("div",{className:"text-sm text-slate-600",children:p?"Your predictions are locked in. This is a TEST game and does not affect the main game.":"Need to tweak something? Tap a prediction to adjust it. Everything locks in once you hit confirm."})]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:(()=>{const t=[];let s="",i=[];return m.forEach(r=>{const d=r.kickoff_time?new Date(r.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"No date";d!==s?(i.length>0&&t.push({label:s,items:i}),s=d,i=[r]):i.push(r)}),i.length>0&&t.push({label:s,items:i}),t.map((r,d)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-4",children:r.label}),e.jsx("div",{className:"space-y-4",children:r.items.map(o=>{const n=T.get(o.fixture_index),c=z.get(o.fixture_index);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0 text-right",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:o.home_team||o.home_name})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(oe,{code:o.home_code,crest:o.home_crest,size:28}),e.jsx("div",{className:"text-slate-400 font-medium text-sm",children:o.kickoff_time?new Date(o.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):""}),e.jsx(oe,{code:o.away_code,crest:o.away_crest,size:28})]}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-slate-800 truncate inline-block",children:o.away_team||o.away_name})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{if(p)return;const a=new Map(T);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"H",matchday:h}),U(a),be("H")},disabled:p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="H"?c&&c==="H"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="D"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="H"?"bg-gray-300 text-slate-700 border-gray-400":p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Home Win"}),e.jsx("button",{onClick:()=>{if(p)return;const a=new Map(T);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"D",matchday:h}),U(a),be("D")},disabled:p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="D"?c&&c==="D"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="A")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="D"?"bg-gray-300 text-slate-700 border-gray-400":p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Draw"}),e.jsx("button",{onClick:()=>{if(p)return;const a=new Map(T);a.set(o.fixture_index,{fixture_index:o.fixture_index,pick:"A",matchday:h}),U(a),be("A")},disabled:p,className:`h-16 rounded-xl border text-sm font-medium transition-colors flex items-center justify-center ${n?.pick==="A"?c&&c==="A"&&n.pick===c?"bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white border-yellow-300 shadow-xl":c&&(c==="H"||c==="D")?"bg-red-500 text-white border-red-400":"bg-purple-600 text-white border-purple-600":c==="A"?"bg-gray-300 text-slate-700 border-gray-400":p?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":"bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100"}`,children:"Away Win"})]})]},o.id)})})]},d))})()})}),e.jsx("div",{className:"p-6 bg-white shadow-lg",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:p?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800 mb-2",children:"Predictions Submitted (TEST)"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Your test predictions for Test GW ",h," have been confirmed."]}),ge>0&&e.jsxs("div",{className:"mt-4 text-2xl font-bold text-purple-700",children:[ge,"/",m.length]})]}):e.jsxs(e.Fragment,{children:[!de&&e.jsx("div",{className:"text-center text-sm text-amber-600 mb-2",children:"You haven't made all your predictions yet"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{onClick:rt,disabled:p,className:"w-full py-3 bg-slate-200 text-slate-700 rounded-2xl font-semibold hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Over"}),e.jsx("button",{onClick:Ne,disabled:!de,className:"w-full py-4 bg-green-600 text-white rounded-2xl font-bold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Confirm Predictions (TEST)":"Complete All Predictions First"}),e.jsx("button",{onClick:()=>v("/"),className:"w-full py-3 text-slate-600 hover:text-slate-800 font-medium",children:"Cancel"})]})]})})})]});const qe=ie(),Ue=p||qe&&W.current;return console.log("[TestApiPredictions] üî¥ SWIPE VIEW CHECK - submitted:",p,"ref:",W.current,"sessionStorage:",qe,"checkSubmittedBeforeSwipe:",Ue),Ue?(console.log("[TestApiPredictions] üö´ BLOCKING swipe view - user has submitted"),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):(console.log("[TestApiPredictions] ‚úÖ Showing swipe view - user has NOT submitted"),!S&&m.length>0?(console.log("[TestApiPredictions] ‚ö†Ô∏è currentFixture is undefined, resetting to index 0"),H(0),e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#1C8376]"})})):m.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4 max-w-md",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 mb-2",children:"No fixtures available"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Check back later for Test GW ",h," fixtures."]})]})}):e.jsxs("div",{className:"h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col overflow-hidden",children:[Z==="cards"&&e.jsx("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-2 bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>v("/"),className:"text-slate-600 hover:text-slate-800 text-3xl font-bold w-10 h-10 flex items-center justify-center",children:"‚úï"}),e.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 text-lg font-extrabold text-slate-700",children:["Test GW ",h]}),Z==="cards"&&e.jsxs("button",{onClick:()=>H(m.length),className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition hover:shadow-lg hover:from-emerald-600 hover:via-emerald-700 hover:to-emerald-800",children:[e.jsx("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"List View"]})]}),Z==="cards"&&e.jsx("div",{className:"mt-4 flex justify-center mb-2",children:e.jsx("div",{className:"inline-flex items-center gap-2 rounded-full bg-[#e6f3f0] px-3 py-2",children:m.map((t,s)=>{const i=s<I,r=s===I;return e.jsx("div",{className:`flex items-center justify-center transition-all ${r?"h-2 w-6 rounded-full bg-[#178f72]":"h-3 w-3 rounded-full"} ${i&&!r?"bg-[#116f59]":r?"":"bg-white"}`},s)})})})]})}),Z==="list"?e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{onClick:()=>v("/"),className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 hover:text-slate-800 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900 mt-0 mb-2",children:"Test API Predictions"}),e.jsxs("div",{className:"mt-0 mb-4 text-base text-slate-500",children:["Call every game, lock in your results.",e.jsx("br",{}),"This is a TEST game."]})]})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("div",{className:"rounded-xl border bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-purple-900 font-semibold text-lg",children:["Test GW ",h," Complete"]}),e.jsx("div",{className:"text-purple-900 text-sm font-bold mt-1",children:"Your Score"})]}),e.jsx("div",{className:"text-purple-900 text-5xl font-extrabold",children:ge})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>{ne("cards"),H(0)},className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-600 to-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:shadow-lg",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),"Back to Swipe View"]})})]})}):e.jsxs("div",{className:"flex flex-col min-h-0 overflow-hidden flex-1 pb-[90px]",style:{height:"100%"},children:[e.jsxs("div",{className:"flex items-center justify-center px-4 relative overflow-hidden pt-2",style:{minHeight:0},children:[e.jsxs("div",{className:`absolute left-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${we==="home"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üê"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Home Win"})]}),e.jsxs("div",{className:`absolute right-8 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${we==="away"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üí"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg whitespace-nowrap",children:"Away Win"})]}),e.jsxs("div",{className:`absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 transition-opacity z-50 ${we==="draw"?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"text-6xl font-bold text-slate-700",children:"‚Üì"}),e.jsx("div",{className:"text-lg font-bold text-slate-700 bg-white px-4 py-2 rounded-full shadow-lg",children:"Draw"})]}),e.jsxs("div",{className:"max-w-md w-full relative",style:{aspectRatio:"0.75"},children:[I<m.length-1&&(()=>{const t=m[I+1];return e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1)",opacity:le||V?.5:0,zIndex:1,transition:"opacity 0.15s ease-out"},children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8",children:[t.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(t.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(oe,{code:t.home_code,crest:t.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.home_team||t.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:t.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(t.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(oe,{code:t.away_code,crest:t.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:t.away_team||t.away_name})]})]})]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{style:{position:"absolute",inset:0,background:ye(t.home_code,t.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:ye(t.away_code,t.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})},I+1)})(),e.jsx("div",{ref:Ze,className:"absolute inset-0 z-10 cursor-grab active:cursor-grabbing",style:{transform:`translate(${L.x}px, ${L.y}px) rotate(${L.rotation}deg) scale(${L.scale})`,opacity:L.opacity,transition:le||_e.current?"none":"all 0.3s ease-out",touchAction:"none"},onMouseDown:t=>!p&&$e(t.clientX,t.clientY),onMouseMove:t=>!p&&Be(t.clientX,t.clientY),onMouseUp:je,onMouseLeave:je,onTouchStart:et,onTouchMove:tt,onTouchEnd:st,children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl overflow-hidden select-none",children:[e.jsxs("div",{className:"pt-2 px-8 pb-8 relative pointer-events-none",children:[e.jsx("div",{className:"absolute top-2 right-4 flex items-center gap-2 text-slate-400 text-xs font-semibold",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/4603/4603384.png",alt:"Swipe gesture icon",className:"w-6 h-6 opacity-80"})}),S.kickoff_time&&e.jsx("div",{className:"text-center mb-1",children:e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:new Date(S.kickoff_time).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(oe,{code:S.home_code,crest:S.home_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:S.home_team||S.home_name})]}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:S.kickoff_time&&e.jsx("div",{className:"text-sm text-slate-700",children:new Date(S.kickoff_time).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(oe,{code:S.away_code,crest:S.away_crest,size:120}),e.jsx("div",{className:"text-sm font-bold text-slate-700 mt-4 text-center max-w-[120px]",children:S.away_team||S.away_name})]})]}),(()=>{const t=z.get(S.fixture_index),s=T.get(S.fixture_index);if(t&&s){const i=s.pick===t;return e.jsxs("div",{className:"text-center mb-4 space-y-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-semibold",children:[e.jsx("span",{children:"üéØ"}),e.jsxs("span",{children:["Result: ",t==="H"?"Home Win":t==="A"?"Away Win":"Draw"]})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold ${i?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[e.jsx("span",{children:i?"‚úì":"‚úó"}),e.jsx("span",{children:i?"Correct!":"Incorrect"})]})]})}return null})()]}),e.jsxs("div",{className:"h-48 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",style:{background:ye(S.home_code,S.home_name),clipPath:"polygon(0 0, 0 100%, 100% 100%)"}}),e.jsx("div",{className:"absolute inset-0",style:{background:ye(S.away_code,S.away_name),clipPath:"polygon(0 0, 100% 0, 100% 100%)"}})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 pt-2 px-4 bg-[#eef4f3] z-[10000]",style:{paddingBottom:"calc(5rem + env(safe-area-inset-bottom, 0px))"},children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-stretch justify-center gap-3",children:[e.jsx("button",{onClick:()=>ke("H"),disabled:V||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:L.x<-30?`rgba(34, 197, 94, ${Math.min(.8,Math.abs(L.x)/150)})`:void 0,color:L.x<-30?"#fff":void 0},children:"Home Win"}),e.jsx("button",{onClick:()=>ke("D"),disabled:V||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:L.y>30?`rgba(59, 130, 246, ${Math.min(.8,L.y/150)})`:void 0,color:L.y>30?"#fff":void 0},children:"Draw"}),e.jsx("button",{onClick:()=>ke("A"),disabled:V||p,className:"flex-1 py-4 rounded-2xl font-semibold transition-all flex items-center justify-center bg-[#d7e6e3] text-slate-700 disabled:opacity-70",style:{backgroundColor:L.x>30?`rgba(34, 197, 94, ${Math.min(.8,L.x/150)})`:void 0,color:L.x>30?"#fff":void 0},children:"Away Win"})]})})})]})]}))}export{xt as default};
