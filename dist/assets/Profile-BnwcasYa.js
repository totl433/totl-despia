const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-R40JW4BH.js","assets/index-m_LwnUIU.css","assets/index-CbcbaRan.js"])))=>i.map(i=>d[i]);
import{u as X,a as l,p as Z,s as P,j as e,q as ee,_ as C,L as T}from"./index-R40JW4BH.js";function se(){const{user:o,signOut:G,session:w}=X(),[r,W]=l.useState(null),[V,H]=l.useState(!0),[D,E]=l.useState(!1),[v,c]=l.useState(null),[_,A]=l.useState(!1),[m,I]=l.useState(null),[b,O]=l.useState(null),[y,B]=l.useState(null),[F,J]=l.useState(Z()),[N,K]=l.useState(""),[j,L]=l.useState(""),[$,R]=l.useState(!1),[S,x]=l.useState(null),[U,M]=l.useState(!1),[k,h]=l.useState(null),Y=o?.id==="4542c037-5b38-40d0-b189-847b8f17c222"||o?.id==="36f31625-6d6c-4aa4-815a-1493a812841b";l.useEffect(()=>{let t=0;const s=40,i=()=>{const a=[globalThis?.despia,typeof window<"u"?window?.despia:null,globalThis?.Despia,typeof window<"u"?window?.Despia:null,globalThis?.DESPIA,typeof window<"u"?window?.DESPIA:null,globalThis?.OneSignal,typeof window<"u"?window?.OneSignal:null,globalThis?.webkit?.messageHandlers?.despia,typeof window<"u"?window?.webkit?.messageHandlers?.despia:null].find(f=>f!=null)||null;let d=null;try{const f=typeof window<"u"?window:globalThis;for(const g in f)if(g.toLowerCase().includes("despia")||g.toLowerCase().includes("onesignal")){d={key:g,value:f[g]};break}}catch{}const u=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)||globalThis?.oneSignalPlayerId||(typeof window<"u"?window?.oneSignalPlayerId:null);if(a||d||u){console.log("[Profile] Native API detected:",{despia:!!a,foundInGlobals:d,directPlayerId:u?String(u).slice(0,12)+"‚Ä¶":null,despiaKeys:a?Object.keys(a):[],hasOneSignalRequestPermission:a&&typeof a.oneSignalRequestPermission=="function",hasRequestPermission:a&&typeof a.requestPermission=="function",playerId:a?a.onesignalplayerid||a.oneSignalPlayerId:u}),O(!0);const f=a?a.onesignalplayerid||a.oneSignalPlayerId:u;return f&&B(String(f)),!0}return t++,t<s?setTimeout(i,500):(console.warn("[Profile] Native API not detected after",s,"attempts"),O(!1)),!1};i()},[]),l.useEffect(()=>{Q()},[o]);async function Q(){if(o)try{const{data:t,error:s}=await P.from("picks").select("*").eq("user_id",o.id);s&&console.error("Error fetching picks:",s);const{data:i,error:n}=await P.from("v_ocp_overall").select("user_id, name, ocp").order("ocp",{ascending:!1});n&&console.error("Error fetching standings:",n);const a=i?i.findIndex(p=>p.user_id===o.id)+1:0,d=i?.find(p=>p.user_id===o.id),{data:u,error:f}=await P.from("gw_results").select("gw, fixture_index, result");f&&console.error("Error fetching results:",f);let g=0;t&&u&&t.forEach(p=>{const q=u.find(z=>z.gw===p.gw&&z.fixture_index===p.fixture_index);q&&q.result===p.pick&&g++}),W({totalPredictions:t?.length||0,correctPredictions:g,totalPoints:d?.ocp||0,globalRank:a,totalUsers:i?.length||0})}catch(t){console.error("Error fetching user stats:",t)}finally{H(!1)}}return o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-[#1C8376] rounded-full flex items-center justify-center text-white text-xl sm:text-2xl font-bold flex-shrink-0",children:(o.user_metadata?.display_name||o.email||"U")[0].toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 mb-2 truncate",children:o.user_metadata?.display_name||"User"}),e.jsx("p",{className:"text-slate-600 break-all text-sm sm:text-base",children:o.email}),e.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:["Member since ",new Date(o.created_at||"").toLocaleDateString("en-GB",{month:"long",year:"numeric"})]})]})]})}),V?e.jsx("div",{className:"text-center py-12 text-slate-600",children:"Loading stats..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-4xl font-bold text-[#1C8376] mb-2",children:r?.totalPoints||0}),e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"OCP"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:r?.globalRank||0}),e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"Global Rank"}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["of ",r?.totalUsers||0,r&&r.globalRank>0&&r.totalUsers>0&&e.jsxs("span",{className:"block mt-1 text-[#1C8376] font-semibold",children:["Top ",Math.round(r.globalRank/r.totalUsers*100),"%"]})]})]})]}),r&&r.totalPredictions>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:"Prediction Accuracy"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-slate-600",children:[e.jsx("span",{className:"text-3xl font-bold text-[#1C8376]",children:r.correctPredictions}),e.jsxs("span",{className:"text-slate-500",children:[" / ",r.totalPredictions]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-[#1C8376]",children:[(r.correctPredictions/r.totalPredictions*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:"accuracy rate"})]})]}),e.jsx("div",{className:"overflow-hidden h-4 text-xs flex rounded-full bg-[#1C8376]/20",children:e.jsx("div",{style:{width:`${r.correctPredictions/r.totalPredictions*100}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-[#1C8376] transition-all duration-500"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:"Account Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:"Display Name"}),e.jsx("div",{className:"text-sm text-slate-600",children:o.user_metadata?.display_name||"Not set"})]})}),e.jsx("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-slate-800",children:"Email"}),e.jsx("div",{className:"text-sm text-slate-600 break-all",children:o.email})]})}),e.jsx("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:"User ID"}),e.jsx("div",{className:"text-xs text-slate-500 font-mono",children:o.id})]})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Data Loading"}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-800",children:"Load Everything First"}),e.jsx("div",{className:"text-sm text-slate-600 mt-1",children:F?"All data loads before app opens (slower start, no stale data)":"Data loads as you navigate (faster start, may show cached data)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-4",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:t=>{const s=t.target.checked;J(s),ee(s),alert(s?'"Load Everything First" mode enabled. The app will reload on next visit to apply the change.':'"Load Everything First" mode disabled. The app will reload on next visit to apply the change.')},className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#1C8376]/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#1C8376]"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Advanced"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Check and fix your notification settings to receive chat notifications in mini-leagues."}),e.jsx("div",{className:"mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"OS Permission:"}),e.jsx("div",{className:"font-semibold text-slate-800",children:b===null?"‚è≥ Checking...":b===!1?"‚ùì Unknown (not native app)":globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)||y?'‚úÖ Native app (use "Enable Notifications" to check status)':"‚ùì Unknown (not native app)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"OneSignal Status:"}),e.jsx("div",{className:"font-semibold text-slate-800",children:(()=>{if(b===null)return"‚è≥ Checking...";if(b===!1)return"‚ùå Not initialized";const t=globalThis?.despia||(typeof window<"u"?window?.despia:null),s=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null);return t?.onesignalplayerid||t?.oneSignalPlayerId||s||y?"‚úÖ Player ID found":"‚ùå Not initialized"})()})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-slate-600 mb-1",children:"Player ID:"}),e.jsx("div",{className:"font-mono text-xs text-slate-700 break-all",children:(()=>{if(b===null)return"Checking...";const t=globalThis?.despia||(typeof window<"u"?window?.despia:null),s=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null),i=t?.onesignalplayerid||t?.oneSignalPlayerId||s||y;if(!i)return"Not available";const n=String(i);return n.slice(0,8)+"‚Ä¶"+n.slice(-4)})()})]})]})}),e.jsxs("div",{className:"mb-4 p-3 bg-slate-100 rounded-lg border border-slate-300 text-xs",children:[e.jsx("div",{className:"font-semibold text-slate-700 mb-2",children:"üîç Debug Info:"}),e.jsxs("div",{className:"space-y-1 text-slate-600 font-mono break-all",children:[e.jsxs("div",{children:["User Agent: ",typeof navigator<"u"?navigator.userAgent.slice(0,50)+"‚Ä¶":"N/A"]}),e.jsxs("div",{children:["globalThis.despia: ",globalThis?.despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.despia: ",typeof window<"u"&&window?.despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["globalThis.Despia: ",globalThis?.Despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.Despia: ",typeof window<"u"&&window?.Despia?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["globalThis.OneSignal: ",globalThis?.OneSignal?"‚úÖ Found":"‚ùå Not found"]}),e.jsxs("div",{children:["window.OneSignal: ",typeof window<"u"&&window?.OneSignal?"‚úÖ Found":"‚ùå Not found"]}),(()=>{const s=[globalThis?.despia,typeof window<"u"?window?.despia:null,globalThis?.Despia,typeof window<"u"?window?.Despia:null,globalThis?.DESPIA,typeof window<"u"?window?.DESPIA:null].find(n=>n!=null)||null;let i=[];try{const n=typeof window<"u"?window:globalThis;for(const a in n)(a.toLowerCase().includes("despia")||a.toLowerCase().includes("onesignal"))&&i.push(a)}catch{}return i.length>0?e.jsxs("div",{className:"mt-2 text-green-600",children:["‚úÖ Found global properties: ",i.join(", ")]}):s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 font-semibold",children:"Despia Object Found:"}),e.jsxs("div",{children:["Keys: ",Object.keys(s).slice(0,10).join(", "),Object.keys(s).length>10?"‚Ä¶":""]}),e.jsxs("div",{children:["oneSignalRequestPermission: ",typeof s.oneSignalRequestPermission=="function"?"‚úÖ Function":"‚ùå Not a function"]}),e.jsxs("div",{children:["requestPermission: ",typeof s.requestPermission=="function"?"‚úÖ Function":"‚ùå Not a function"]}),e.jsxs("div",{children:["onesignalplayerid: ",s.onesignalplayerid?"‚úÖ "+String(s.onesignalplayerid).slice(0,12)+"‚Ä¶":"‚ùå"]}),e.jsxs("div",{children:["oneSignalPlayerId: ",s.oneSignalPlayerId?"‚úÖ "+String(s.oneSignalPlayerId).slice(0,12)+"‚Ä¶":"‚ùå"]})]}):e.jsx("div",{className:"mt-2 text-red-600",children:"‚ùå No Despia object found in any location"})})(),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Polling: ",b===null?"‚è≥ Checking...":b?"‚úÖ Detected":"‚ùå Not detected"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:async()=>{if(!w?.access_token){c("Error: Not signed in");return}E(!0),c(null);try{c("‚è≥ Waiting for OneSignal to initialize... (this may take up to 15 seconds)");const{ensurePushSubscribed:t}=await C(async()=>{const{ensurePushSubscribed:i}=await import("./index-R40JW4BH.js").then(n=>n.v);return{ensurePushSubscribed:i}},__vite__mapDeps([0,1])),s=await t(w);if(s.ok)c(`‚úÖ Successfully enabled notifications! Player ID: ${s.playerId?.slice(0,8)}‚Ä¶`),setTimeout(()=>c(null),5e3);else{const i={"permission-denied":"Permission denied. Please enable notifications in iOS Settings.","no-player-id":s.error||"OneSignal not initialized. Try: 1) Close the app completely, 2) Reopen it, 3) Wait 10 seconds, 4) Try again.","api-not-available":"Not available in browser. Please use the native app.","no-session":"Not signed in. Please sign in and try again.",unknown:s.error||"Unknown error. Please try again or contact support."};c(`‚ö†Ô∏è ${i[s.reason||"unknown"]||"Failed to enable notifications"}`)}}catch(t){c(`‚ùå Error: ${t.message||"Failed to enable notifications"}`)}finally{E(!1)}},disabled:D||!w?.access_token,className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 disabled:bg-gray-100 disabled:opacity-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:D?"Enabling... (waiting for OneSignal)":"Enable Notifications"}),e.jsx("button",{onClick:async()=>{let t=null;try{t=(await C(()=>import("./index-CbcbaRan.js").then(i=>i.i),__vite__mapDeps([2,0,1]))).default}catch{t=globalThis?.despia||(typeof window<"u"?window?.despia:null)}if(t&&typeof t=="function")try{t("settingsapp://")}catch{alert("Please go to iOS Settings ‚Üí TotL ‚Üí Notifications and enable notifications")}else alert("Please go to iOS Settings ‚Üí TotL ‚Üí Notifications and enable notifications")},className:"w-full py-2 bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium rounded-xl transition-colors text-sm hidden",children:"‚öôÔ∏è Open OS Settings"}),e.jsx("button",{onClick:async()=>{if(!w?.access_token){c("Error: Not signed in");return}A(!0),c(null),I(null);try{const s=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",n=await(await fetch(`${s}/.netlify/functions/checkMySubscription`,{headers:{Authorization:`Bearer ${w.access_token}`}})).json();if(I(n),n.subscribed)c("‚úÖ Device is subscribed! Notifications should work.");else{const a=n.reasons||[],d=n.suggestion||"Enable notifications in iOS Settings";c(`‚ö†Ô∏è Not subscribed: ${a.join("; ")}. ${d}`)}}catch(t){c(`‚ùå Error checking subscription: ${t.message}`)}finally{A(!1)}},disabled:_||!w?.access_token,className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 disabled:bg-gray-100 disabled:opacity-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:_?"Checking...":"Check Subscription Status"}),e.jsx("button",{onClick:async()=>{let t=null;try{const i=(await C(()=>import("./index-CbcbaRan.js").then(n=>n.i),__vite__mapDeps([2,0,1]))).default;t=i?.onesignalplayerid||i?.oneSignalPlayerId||null}catch{t=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null)}t=t||y,t?(await navigator.clipboard.writeText(String(t)),c("‚úÖ Player ID copied to clipboard"),setTimeout(()=>c(null),2e3)):c("‚ö†Ô∏è Player ID not available")},className:"w-full py-3 bg-white border border-slate-300 hover:bg-slate-50 text-slate-600 hover:text-slate-800 font-medium rounded-xl transition-colors",children:"Copy Player ID"})]}),v&&e.jsx("div",{className:`mt-3 p-3 rounded-lg text-sm ${v.includes("‚úÖ")?"bg-green-50 text-green-800 border border-green-200":v.includes("‚ö†Ô∏è")?"bg-amber-50 text-amber-800 border border-amber-200":"bg-red-50 text-red-800 border border-red-200"}`,children:v}),m&&m.details&&e.jsxs("div",{className:"mt-3 p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs",children:[e.jsx("div",{className:"font-semibold text-slate-700 mb-2",children:"üìä OneSignal Status Details:"}),e.jsxs("div",{className:"space-y-1 text-slate-600 font-mono",children:[e.jsxs("div",{children:["Has Token: ",m.details.hasToken?"‚úÖ Yes":"‚ùå No"]}),e.jsxs("div",{children:["Invalid: ",m.details.invalid?"‚ùå Yes":"‚úÖ No"]}),e.jsxs("div",{children:["Notification Types: ",m.details.notificationTypes??"null"]}),e.jsxs("div",{children:["Device Type: ",m.details.deviceType||"N/A"]}),e.jsxs("div",{children:["Last Active: ",m.details.lastActive?new Date(m.details.lastActive).toLocaleString():"Never"]}),m.reasons&&m.reasons.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-300",children:[e.jsx("div",{className:"font-semibold text-red-600",children:"Issues Found:"}),m.reasons.map((t,s)=>e.jsxs("div",{className:"text-red-600",children:["‚Ä¢ ",t]},s))]})]})]})]}),Y&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Admin"}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Activate Carl's Devices"}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Syncs Carl's devices with OneSignal and marks them as active if subscribed. Run this before sending test notifications."}),k&&e.jsx("div",{className:`mb-3 rounded border px-3 py-2 text-sm ${k.includes("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":k.includes("‚ö†Ô∏è")?"border-amber-200 bg-amber-50 text-amber-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:k}),e.jsx("button",{onClick:async()=>{M(!0),h(null);try{const i=`${window.location.hostname==="localhost"?"https://totl-staging.netlify.app":""}/.netlify/functions/diagnoseCarlNotifications?update=true`;console.log("[Profile] Activating Carl devices, calling:",i);const n=await fetch(i,{method:"GET",mode:"cors"});if(!n.ok){const d=await n.text().catch(()=>"Unknown error");h(`‚ùå Server error (${n.status}): ${d||"Failed to activate devices"}`);return}const a=await n.json();if(a.error)h(`‚ùå ${a.error}`);else{const d=a.active_devices||0,u=a.subscribed_devices||0;d>0&&u>0?h(`‚úÖ Activated ${d} device(s) (${u} subscribed). Carl should receive notifications.`):u>0?h(`‚ö†Ô∏è Found ${u} subscribed device(s) but none are active. Check device status.`):h("‚ö†Ô∏è No subscribed devices found. Carl may need to enable notifications in iOS Settings.")}}catch(t){console.error("[Profile] Error activating Carl devices:",t);let s="Failed to activate devices";t.message?s=t.message:t.name==="TypeError"&&t.message?.includes("fetch")&&(s="Network error: Could not reach server. Check your connection or try again later."),h(`‚ùå Error: ${s}`)}finally{M(!1)}},disabled:U,className:"w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:U?"Activating...":"Activate Carl's Devices"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Send Notification to All Users"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Title"}),e.jsx("input",{type:"text",value:N,onChange:t=>K(t.target.value),placeholder:"Notification title",className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Message"}),e.jsx("textarea",{value:j,onChange:t=>L(t.target.value),placeholder:"Notification message",rows:3,className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),S&&e.jsx("div",{className:`rounded border px-3 py-2 text-sm ${S.startsWith("‚úÖ")?"border-emerald-200 bg-emerald-50 text-emerald-800":S.startsWith("‚ö†Ô∏è")?"border-amber-200 bg-amber-50 text-amber-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:S}),e.jsx("button",{onClick:async()=>{if(!N.trim()||!j.trim()){x("‚ùå Please enter both title and message");return}R(!0),x(null);try{const s=window.location.hostname==="localhost"?"https://totl-staging.netlify.app":"",i=await fetch(`${s}/.netlify/functions/sendPushAll`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:N.trim(),message:j.trim()})});if(!i.ok){const d=await i.text().catch(()=>"Unknown error");x(`‚ùå Server error (${i.status}): ${d||"Failed to send notification"}`);return}let n;const a=await i.text();if(!a||a.trim()===""){x("‚ùå Empty response from server");return}try{n=JSON.parse(a)}catch(d){x(`‚ùå Invalid response from server: ${d.message||"Failed to parse response"}`);return}n.ok?n.warning?x(`‚ö†Ô∏è ${n.warning} (checked ${n.checked||0} device(s))`):(x(`‚úÖ Notification sent to ${n.sentTo||0} device(s)`),L("")):x(`‚ùå Failed to send: ${n.error||"Unknown error"}`)}catch(t){console.error("[Profile] Error sending notification:",t);let s="Failed to send notification";t.message?s=t.message:t.name==="TypeError"&&t.message?.includes("fetch")&&(s="Network error: Could not reach server. Check your connection or try again later."),x(`‚ùå Error: ${s}`)}finally{R(!1)}},disabled:$||!N.trim()||!j.trim(),className:"w-full py-2 bg-[#1C8376] hover:bg-[#1a7569] text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Sending...":"Send to All Users"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Sends a push notification to all users with active, subscribed devices."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{to:"/api-admin",className:"block w-full py-3 bg-[#1C8376] hover:bg-[#1C8376]/90 text-white font-semibold rounded-xl transition-colors text-center",children:"API Admin - Premier League"}),e.jsx(T,{to:"/test-fixtures",className:"block w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-xl transition-colors text-center",children:"Test Fixtures (Non-PL)"}),e.jsx(T,{to:"/admin",className:"block w-full py-3 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-xl transition-colors text-center",children:"Admin Panel (Web)"})]})]}),e.jsx("button",{onClick:async()=>{await G()},className:"w-full mt-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors",children:"Sign Out"})]})]})}):e.jsx("div",{className:"p-6",children:"Please sign in to view your profile."})}export{se as default};
