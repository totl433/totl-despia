const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D10Mz2vs.js","assets/index-CKJVCyNd.js","assets/index-CKk--m-9.css"])))=>i.map(i=>d[i]);
import{u as w,r as u,j as t,_ as x}from"./index-CKJVCyNd.js";function T(){const{user:b,session:g}=w(),[n,h]=u.useState([]),[m,p]=u.useState(!1),[c,y]=u.useState(null);u.useEffect(()=>{(async()=>{let a=null;try{a=(await x(()=>import("./index-D10Mz2vs.js").then(l=>l.i),__vite__mapDeps([0,1,2]))).default}catch{a=globalThis?.despia||window?.despia}y(!!a)})()},[]);const v=async()=>{p(!0);const e=[];let a=null;try{a=(await x(()=>import("./index-D10Mz2vs.js").then(i=>i.i),__vite__mapDeps([0,1,2]))).default,e.push({name:"Despia SDK Import",status:"pass",message:"despia-native module loaded successfully",details:{keys:Object.keys(a||{}).slice(0,5)}})}catch(s){if(a=globalThis?.despia||window?.despia,a)e.push({name:"Despia SDK Import",status:"pass",message:"Despia found in global scope (fallback)",details:{keys:Object.keys(a||{}).slice(0,5)}});else{e.push({name:"Despia SDK Import",status:"fail",message:"Despia not found - not running in native app",details:{error:String(s)}}),p(!1),h(e);return}}const o=a?.onesignalplayerid||a?.oneSignalPlayerId||globalThis?.onesignalplayerid;o?e.push({name:"OneSignal Player ID",status:"pass",message:`Player ID found: ${String(o).slice(0,20)}...`,details:{playerId:String(o)}}):e.push({name:"OneSignal Player ID",status:"fail",message:"OneSignal Player ID not available",details:{availableKeys:Object.keys(a||{})}});try{typeof a=="function"?(a(`sendlocalpushmsg://push.send?s=5=msg!Test notification&!#Despia Test&!#${window.location.origin}`),e.push({name:"Local Notification",status:"pass",message:"Notification scheduled (check in 5 seconds)",details:{scheduled:!0}})):e.push({name:"Local Notification",status:"fail",message:"Despia is not a function - cannot send notifications",details:{type:typeof a}})}catch(s){e.push({name:"Local Notification",status:"fail",message:`Error scheduling notification: ${String(s)}`,details:{error:String(s)}})}try{if(typeof a=="function"){const s=Promise.resolve(a("readvalue://",["storedValues"])),i=new Promise((d,f)=>setTimeout(()=>f(new Error("Timeout after 3 seconds")),3e3)),r=await Promise.race([s,i]);e.push({name:"Native Storage Read",status:"pass",message:"Storage read successful",details:{data:r||"empty"}})}else e.push({name:"Native Storage Read",status:"skip",message:"Despia not a function - cannot test storage"})}catch(s){e.push({name:"Native Storage Read",status:"fail",message:`Storage read failed: ${String(s)}`,details:{error:String(s)}})}try{if(typeof a=="function"){const s={test:!0,timestamp:Date.now()},i=encodeURIComponent(JSON.stringify(s)),r=Promise.resolve(a(`writevalue://${i}`)),d=new Promise((f,D)=>setTimeout(()=>D(new Error("Timeout after 3 seconds")),3e3));await Promise.race([r,d]),e.push({name:"Native Storage Write",status:"pass",message:"Storage write successful",details:{written:s}})}else e.push({name:"Native Storage Write",status:"skip",message:"Despia not a function - cannot test storage"})}catch(s){e.push({name:"Native Storage Write",status:"fail",message:`Storage write failed: ${String(s)}`,details:{error:String(s)}})}if(b&&g&&o)try{const s=new AbortController,i=setTimeout(()=>s.abort(),1e4),r=await fetch("/.netlify/functions/registerPlayer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.access_token}`},body:JSON.stringify({playerId:o,platform:"ios"}),signal:s.signal});clearTimeout(i);const d=await r.json();r.ok?e.push({name:"Push Registration",status:"pass",message:"Device registered successfully",details:d}):e.push({name:"Push Registration",status:"fail",message:`Registration failed: ${d.error||"Unknown error"}`,details:d})}catch(s){e.push({name:"Push Registration",status:"fail",message:`Registration error: ${s.name==="AbortError"?"Request timed out":String(s)}`,details:{error:String(s)}})}else e.push({name:"Push Registration",status:"skip",message:"User not logged in - skipping registration test"});try{if(typeof a=="function"){const s=a("checkNativePushPermissions://",["nativePushEnabled"]);if(s&&typeof s=="object"&&"nativePushEnabled"in s){const i=!!s.nativePushEnabled;e.push({name:"Push Permissions",status:i?"pass":"fail",message:i?"Push notifications enabled in iOS Settings":"Push notifications disabled - enable in iOS Settings",details:{enabled:i,permissionData:s}})}else e.push({name:"Push Permissions",status:"fail",message:"Could not read permission status - API returned unexpected format",details:{permissionData:s,type:typeof s}})}else e.push({name:"Push Permissions",status:"skip",message:"Cannot check permissions - Despia not available"})}catch(s){e.push({name:"Push Permissions",status:"fail",message:`Permission check failed: ${String(s)}`,details:{error:String(s)}})}const l=window.location.hostname,j=l.includes("staging")||l.includes("netlify.app");e.push({name:"Environment",status:"pass",message:`Running on: ${l}`,details:{hostname:l,isStaging:j,isLocalhost:l.includes("localhost"),isDespia:c}}),h(e),p(!1)},N=n.filter(e=>e.status==="pass").length,S=n.filter(e=>e.status==="fail").length,P=n.filter(e=>e.status==="skip").length;return t.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Despia Integration Test"}),t.jsx("p",{className:"text-slate-600 mb-4",children:"Test all Despia native features to verify they work correctly"}),t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx("button",{onClick:v,disabled:m,className:"px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:m?"Running Tests...":"Run All Tests"}),c!==null&&t.jsx("div",{className:`px-4 py-2 rounded-lg ${c?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c?"✅ Despia Detected":"❌ Despia Not Detected"})]}),n.length>0&&t.jsx("div",{className:"mb-4 p-4 bg-slate-100 rounded-lg",children:t.jsxs("div",{className:"flex gap-6 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Pass:"})," ",t.jsx("span",{className:"text-green-600",children:N})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Fail:"})," ",t.jsx("span",{className:"text-red-600",children:S})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Skip:"})," ",t.jsx("span",{className:"text-slate-500",children:P})]})]})})]}),n.length>0&&t.jsx("div",{className:"space-y-3",children:n.map((e,a)=>t.jsx("div",{className:`bg-white rounded-lg border p-4 ${e.status==="pass"?"border-green-200 bg-green-50":e.status==="fail"?"border-red-200 bg-red-50":"border-slate-200 bg-slate-50"}`,children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-semibold text-slate-900",children:e.name}),t.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${e.status==="pass"?"bg-green-200 text-green-800":e.status==="fail"?"bg-red-200 text-red-800":"bg-slate-200 text-slate-600"}`,children:e.status.toUpperCase()})]}),t.jsx("p",{className:"text-sm text-slate-700",children:e.message}),e.details&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"text-xs text-slate-500 cursor-pointer",children:"Details"}),t.jsx("pre",{className:"mt-2 text-xs bg-slate-100 p-2 rounded overflow-auto",children:JSON.stringify(e.details,null,2)})]})]})})},a))}),n.length===0&&!m&&t.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-8 text-center text-slate-500",children:'Click "Run All Tests" to start testing Despia features'})]})})}export{T as default};
