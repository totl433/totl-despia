import{u as G,z as W,r as o,j as e,L as p,A as K,B as z,a as g}from"./index-ic2x2StX.js";function V(){const{user:x}=G(),y=W(),w=x?.id==="4542c037-5b38-40d0-b189-847b8f17c222"||x?.id==="36f31625-6d6c-4aa4-815a-1493a812841b",[M,$]=o.useState(null),[f,P]=o.useState(null),[j,H]=o.useState(""),[v,k]=o.useState(""),[C,L]=o.useState(!1),[S,m]=o.useState(null),[N,D]=o.useState([]),[c,I]=o.useState(null),[E,O]=o.useState(!1),[h,T]=o.useState([]),[A,F]=o.useState(!1),[d,_]=o.useState([]),[R,J]=o.useState(!1);o.useEffect(()=>{x&&!w&&y("/profile")},[x,w,y]),o.useEffect(()=>{let s=0;const r=40,t=()=>{const a=globalThis?.onesignalplayerid||(typeof window<"u"?window?.onesignalplayerid:null);return a?($(!0),P(String(a)),!0):(s++,s<r?setTimeout(t,500):$(!1),!1)};t()},[]),o.useEffect(()=>{const s=()=>{try{const t=localStorage.getItem("app_crashes");t&&D(JSON.parse(t))}catch(t){console.error("[AdminData] Failed to load crashes:",t)}try{const t=z();T(t)}catch(t){console.error("[AdminData] Failed to load fetch logs:",t)}try{const t=localStorage.getItem("message_subscription_logs");t&&_(JSON.parse(t))}catch(t){console.error("[AdminData] Failed to load subscription logs:",t)}};s();const r=setInterval(s,2e3);return()=>clearInterval(r)},[]);const U=async()=>{O(!0);try{const s={timestamp:Date.now(),checks:{},issues:[]},{data:r,error:t}=await g.from("meta").select("*").limit(1);s.checks.meta={exists:!t&&r&&r.length>0,error:t?.message},(t||!r||r.length===0)&&s.issues.push("meta table missing or empty");const{data:a,error:n}=await g.from("fixtures").select("id").limit(1);s.checks.fixtures={exists:!n&&a&&a.length>0,error:n?.message},(n||!a||a.length===0)&&s.issues.push("fixtures table missing or empty");const{error:l}=await g.from("live_scores").select("id").limit(1);s.checks.live_scores={exists:!l,error:l?.message};const{error:i}=await g.from("app_gw_results").select("*").limit(1);s.checks.app_gw_results={exists:!i,error:i?.message};const{error:u}=await g.from("push_subscriptions").select("id").limit(1);s.checks.push_subscriptions={exists:!u,error:u?.message};const{error:b}=await g.from("league_members").select("id").limit(1);s.checks.league_members={exists:!b,error:b?.message},I(s)}catch(s){console.error("[AdminData] Error checking data health:",s),I({timestamp:Date.now(),error:s.message,checks:{},issues:["Failed to check data health"]})}finally{O(!1)}},B=async()=>{try{if(d.length===0){alert("No subscription logs to copy");return}const s=`=== SUBSCRIPTION STATUS LOGS ===
Date: ${new Date().toISOString()}
Total Logs: ${d.length}

${d.slice().reverse().map((r,t)=>{const a=new Date(r.timestamp).toISOString();return`[${t+1}] ${a}
  Status: ${r.status}
  League ID: ${r.leagueId||"N/A"}
  Channel: ${r.channel||"N/A"}
`}).join(`
`)}`;await navigator.clipboard.writeText(s),J(!0),setTimeout(()=>J(!1),3e3)}catch(s){console.error("[AdminData] Failed to copy subscription logs:",s),alert("Failed to copy subscription logs: "+s.message)}},q=async()=>{try{const s={timestamp:new Date().toISOString(),user:x?.id||"unknown",despiaDetected:M,playerId:f?f.slice(0,8)+"...":null,crashes:N.length>0?N.slice(-10).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),errorMessage:t.errorMessage,url:t.url})):[],dataHealth:c?{timestamp:new Date(c.timestamp).toISOString(),issues:c.issues||[],checks:c.checks||{}}:null,dataFetches:h.slice(-20).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),location:t.location,query:t.query,table:t.table,result:t.result,rowCount:t.rowCount,error:t.error})),messageSubscriptions:d.slice(-20).reverse().map(t=>({timestamp:new Date(t.timestamp).toISOString(),leagueId:t.leagueId,status:t.status,channel:t.channel})),deepLink:(()=>{try{const t=localStorage.getItem("deepLink_debug"),a=localStorage.getItem("deepLink_result"),n=localStorage.getItem("deepLink_history"),l=n?JSON.parse(n):[];return{debug:t?JSON.parse(t):null,result:a?JSON.parse(a):null,history:l.length>0?l:null,summary:l.length>0?{total:l.length,successful:l.filter(i=>i.success).length,failed:l.filter(i=>!i.success).length}:null}}catch{return null}})(),notifications:(()=>{try{const t=localStorage.getItem("notification_logs");return t?JSON.parse(t).slice(-10).reverse():[]}catch{return[]}})()},r=`=== TOTL DEBUG REPORT ===
Date: ${s.timestamp}
User: ${s.user}
Despia: ${s.despiaDetected?"Yes":"No"}
Player ID: ${s.playerId||"Not available"}

=== CRASHES ===
${s.crashes.length>0?s.crashes.map(t=>`[${t.timestamp}] ${t.errorMessage}
  URL: ${t.url}`).join(`

`):"No crashes recorded"}

=== DATA HEALTH ===
${s.dataHealth?`Checked: ${s.dataHealth.timestamp}
Issues: ${s.dataHealth.issues.length>0?s.dataHealth.issues.join(", "):"None"}

Checks:
${Object.entries(s.dataHealth.checks).map(([t,a])=>`  ${t}: ${a.exists?"âœ…":"âŒ"} ${a.error||""}`).join(`
`)}`:"Not checked yet"}

=== DATA FETCHES (Last 20) ===
${s.dataFetches.map(t=>`[${t.timestamp}] ${t.location} - ${t.query}
  Table: ${t.table}
  Result: ${t.result} ${t.rowCount!==void 0?`(${t.rowCount} rows)`:""}${t.error?`
  Error: ${t.error}`:""}`).join(`

`)}

=== DEEP LINK DEBUG ===
${s.deepLink?(()=>{const t=s.deepLink;let a="";return t.summary&&(a+=`Summary: ${t.summary.total} attempts (${t.summary.successful} successful, ${t.summary.failed} failed)

`),t.debug&&(a+=`Last Check:
${JSON.stringify(t.debug,null,2)}

`),t.result&&(a+=`Last Result:
${JSON.stringify(t.result,null,2)}

`),t.history&&t.history.length>0&&(a+=`History (last ${Math.min(t.history.length,20)}):
`,t.history.slice(-20).reverse().forEach((n,l)=>{a+=`[${l+1}] ${n.success?"âœ…":"âŒ"} ${new Date(n.timestamp).toISOString()}
`,a+=`${JSON.stringify(n,null,2)}

`})),a.trim()})():"No deep link attempts"}

=== NOTIFICATION LOGS ===
${s.notifications.length>0?s.notifications.map(t=>`[${new Date(t.timestamp).toISOString()}] ${t.ok?"OK":"Failed"} - Sent: ${t.sent||0}`).join(`
`):"No notification attempts"}

=== MESSAGE SUBSCRIPTION LOGS ===
${s.messageSubscriptions&&s.messageSubscriptions.length>0?s.messageSubscriptions.map(t=>`[${t.timestamp}] League ${t.leagueId?.slice(0,8)}... - Status: ${t.status} - Channel: ${t.channel}`).join(`
`):"No subscription logs"}

=== MESSAGE FETCHES (from Data Fetch Logs) ===
${s.dataFetches.filter(t=>t.table==="league_messages"||t.query?.toLowerCase().includes("message")).map(t=>`[${t.timestamp}] ${t.location} - ${t.query}
  Table: ${t.table}
  Result: ${t.result} ${t.rowCount!==void 0?`(${t.rowCount} rows)`:""}${t.error?`
  Error: ${t.error}`:""}`).join(`

`)||"No message-related fetches yet"}`;await navigator.clipboard.writeText(r),F(!0),setTimeout(()=>F(!1),3e3)}catch(s){console.error("[AdminData] Failed to copy logs:",s),alert("Failed to copy logs: "+s.message)}};return x?w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-slate-800",children:"Admin Data"}),e.jsx(p,{to:"/profile",className:"text-slate-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})]}),e.jsx("p",{className:"text-slate-600 text-sm mb-4",children:"Admin tools for debugging and managing data."}),e.jsx("button",{onClick:q,className:`w-full py-3 font-semibold rounded-xl text-center transition-colors ${A?"bg-emerald-600 text-white":"bg-[#1C8376] text-white hover:bg-[#156d62]"}`,children:A?"âœ… Logs Copied! Paste to share":"ðŸ“‹ Copy All Logs"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2 text-center",children:"Copies all diagnostic logs in an easy-to-share format"})]}),f&&e.jsx("div",{className:"mb-6 bg-white rounded-xl shadow-md p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Player ID: "}),e.jsxs("span",{className:"font-mono text-xs text-slate-700",children:[f.slice(0,8),"â€¦",f.slice(-4)]})]})}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ’¥ Crash Logs"}),e.jsx("div",{className:"space-y-3",children:N.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-slate-600 mb-2",children:["Total crashes: ",N.length," (showing last 10)"]}),N.slice(-10).reverse().map((s,r)=>e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-1",children:new Date(s.timestamp).toLocaleString()}),e.jsx("div",{className:"text-red-700 mb-2",children:s.errorMessage}),e.jsxs("details",{className:"text-red-600",children:[e.jsx("summary",{className:"cursor-pointer",children:"Stack trace"}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-red-100 p-2 rounded",children:s.errorStack})]}),s.componentStack&&e.jsxs("details",{className:"text-red-600 mt-2",children:[e.jsx("summary",{className:"cursor-pointer",children:"Component stack"}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-red-100 p-2 rounded",children:s.componentStack})]}),e.jsxs("div",{className:"text-red-600 mt-2 text-xs",children:["URL: ",s.url]})]},r)),e.jsx("button",{onClick:()=>{localStorage.removeItem("app_crashes"),D([])},className:"w-full py-2 bg-red-600 text-white font-medium rounded-lg text-sm",children:"Clear All Crashes"})]}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No crashes recorded. The app is running smoothly! ðŸŽ‰"})})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ“Š Data Fetch Logs"}),e.jsx("div",{className:"space-y-3",children:h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-slate-600 mb-2",children:["Total fetches: ",h.length," (showing last 15)"]}),h.slice(-15).reverse().map((s,r)=>e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${s.result==="error"?"bg-red-50 border-red-200":s.result==="empty"?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"font-semibold mb-1",children:[new Date(s.timestamp).toLocaleString()," - ",s.location]}),e.jsxs("div",{className:"text-slate-700 mb-1",children:[e.jsx("strong",{children:"Query:"})," ",s.query]}),e.jsxs("div",{className:"text-slate-600 mb-1",children:[e.jsx("strong",{children:"Table:"})," ",s.table,s.filters&&Object.keys(s.filters).length>0&&e.jsxs("span",{className:"ml-2",children:["(",JSON.stringify(s.filters),")"]})]}),e.jsxs("div",{className:`font-medium ${s.result==="error"?"text-red-600":s.result==="empty"?"text-amber-600":"text-emerald-600"}`,children:["Result: ",s.result==="error"?"âŒ Error":s.result==="empty"?"âš ï¸ Empty":"âœ… Success",s.rowCount!==void 0&&` (${s.rowCount} rows)`,s.error&&` - ${s.error}`]}),s.dataPreview&&s.result==="success"&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-slate-500",children:"Data preview"}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap break-all text-xs bg-white p-2 rounded border",children:JSON.stringify(s.dataPreview,null,2)})]})]},r)),e.jsx("button",{onClick:()=>{K(),T([])},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Fetch Logs"})]}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No data fetch logs yet. Data fetches will appear here as you use the app."})})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ’¬ Message Debug"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-2",children:"Message fetch logs from Data Fetch Logs (filtered for messages):"}),h.filter(s=>s.table==="league_messages"||s.query?.toLowerCase().includes("message")).length>0?e.jsx("div",{className:"space-y-2",children:h.filter(s=>s.table==="league_messages"||s.query?.toLowerCase().includes("message")).slice(-10).reverse().map((s,r)=>e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${s.result==="error"?"bg-red-50 border-red-200":s.result==="empty"?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"font-semibold mb-1",children:[new Date(s.timestamp).toLocaleString()," - ",s.query]}),e.jsxs("div",{className:"text-slate-600 mb-1",children:["League: ",s.filters?.leagueId||"N/A"," | Result: ",s.result==="error"?"âŒ Error":s.result==="empty"?"âš ï¸ Empty":"âœ… Success"," (",s.rowCount||0," rows)"]}),s.error&&e.jsxs("div",{className:"text-red-600 text-xs",children:["Error: ",s.error]})]},r))}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No message fetch logs yet. Open a league chat to see message queries."}),e.jsx("div",{className:"text-sm text-slate-600 mb-2 mt-4",children:"Real-time subscription status (last 20):"}),d.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 text-xs",children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“Š Subscription Stats:"}),e.jsxs("div",{className:"space-y-1 text-blue-700",children:[e.jsxs("div",{children:["Total events: ",d.length]}),e.jsxs("div",{children:["SUBSCRIBED: ",d.filter(s=>s.status==="SUBSCRIBED").length," | CLOSED: ",d.filter(s=>s.status==="CLOSED").length," | Errors: ",d.filter(s=>s.status==="CHANNEL_ERROR"||s.status==="TIMED_OUT").length]}),d.length>=2&&(()=>{const s=d.slice(-10).reverse(),r=[];for(let t=0;t<s.length-1;t++)if(s[t].status==="CLOSED"&&s[t+1]?.status==="SUBSCRIBED"){const a=s[t].timestamp-s[t+1].timestamp;r.push(a)}if(r.length>0){const t=Math.round(r.reduce((l,i)=>l+i,0)/r.length/1e3),a=Math.round(Math.min(...r)/1e3),n=Math.round(Math.max(...r)/1e3);return e.jsx("div",{className:"mt-1",children:r.length>1?e.jsxs(e.Fragment,{children:["Avg cycle time: ~",t,"s (min: ",a,"s, max: ",n,"s)"]}):e.jsxs(e.Fragment,{children:["Last cycle: ~",t,"s"]})})}return null})()]})]}),d.slice(-20).reverse().map((s,r)=>e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${s.status==="SUBSCRIBED"?"bg-emerald-50 border-emerald-200":s.status==="CHANNEL_ERROR"||s.status==="TIMED_OUT"?"bg-red-50 border-red-200":s.status==="CLOSED"?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"font-semibold mb-1",children:[new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})," - ",s.status]}),e.jsxs("div",{className:"text-slate-600 text-xs mb-1",children:["League: ",s.leagueId?.slice(0,8),"... | Channel: ",s.channel]}),s.dependencies&&e.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["Dependencies: ",JSON.stringify(s.dependencies)]}),s.reason&&e.jsxs("div",{className:"text-orange-600 text-xs mt-1",children:["Reason: ",s.reason]}),r<d.slice(-20).length-1&&(()=>{const t=d.slice(-20).reverse()[r+1],a=Math.round((s.timestamp-t.timestamp)/1e3);return e.jsxs("div",{className:"text-slate-400 text-xs mt-1",children:["â±ï¸ ",a,"s after previous event"]})})()]},r)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:B,className:`flex-1 py-2 font-medium rounded-lg text-sm ${R?"bg-emerald-600 text-white":"bg-[#1C8376] text-white hover:bg-[#156d62]"}`,children:R?"âœ… Copied!":"ðŸ“‹ Copy All Subscription Logs"}),e.jsx("button",{onClick:()=>{localStorage.removeItem("message_subscription_logs"),_([]),window.location.reload()},className:"flex-1 py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Subscription Logs"})]})]}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No subscription logs yet. Open a league chat to see subscription status."})]})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ¥ Data Health"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:U,disabled:E,className:"w-full py-2 bg-blue-600 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:E?"Checking...":"Check Data Health"}),c&&e.jsxs("div",{className:`p-4 rounded-lg border ${c.issues&&c.issues.length>0?"bg-red-50 border-red-200":"bg-emerald-50 border-emerald-200"}`,children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Last checked: ",new Date(c.timestamp).toLocaleString()]}),c.error?e.jsxs("div",{className:"text-red-700 text-sm",children:["Error: ",c.error]}):e.jsxs(e.Fragment,{children:[c.issues&&c.issues.length>0?e.jsxs("div",{className:"text-red-700 text-sm mb-2",children:["âš ï¸ Issues found: ",c.issues.join(", ")]}):e.jsx("div",{className:"text-emerald-700 text-sm mb-2",children:"âœ… All checks passed"}),e.jsx("div",{className:"space-y-1 text-xs",children:Object.entries(c.checks||{}).map(([s,r])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-mono",children:[s,":"]}),e.jsxs("span",{className:r.exists?"text-emerald-600":"text-red-600",children:[r.exists?"âœ…":"âŒ"," ",r.error||""]})]},s))})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-800 mb-3",children:"Send Notification to All Users"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Title"}),e.jsx("input",{type:"text",value:j,onChange:s=>H(s.target.value),placeholder:"Notification title",className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Message"}),e.jsx("textarea",{value:v,onChange:s=>k(s.target.value),placeholder:"Notification message",rows:3,className:"w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-[#1C8376] focus:outline-none focus:ring-1 focus:ring-[#1C8376]"})]}),S&&e.jsx("div",{className:`rounded border px-3 py-2 text-sm whitespace-pre-wrap break-words max-h-60 overflow-y-auto ${S.startsWith("âœ…")?"border-emerald-200 bg-emerald-50 text-emerald-800":S.startsWith("âš ï¸")?"border-amber-200 bg-amber-50 text-amber-800":"border-red-200 bg-red-50 text-red-700"}`,children:S}),e.jsx("button",{onClick:async()=>{if(!j.trim()||!v.trim()){m("âŒ Please enter both title and message");return}L(!0),m(null);try{const t=`${window.location.hostname==="localhost"?"https://totl-staging.netlify.app":""}/.netlify/functions/sendPushAllV2`,a=await fetch(t,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j.trim(),message:v.trim()})}).catch(i=>{throw new Error(`Network error: ${i.message||"Failed to connect to server."}`)});if(!a.ok){const i=await a.text().catch(()=>"Unknown error");m(`âŒ Server error (${a.status}): ${i||"Failed to send notification"}`);return}const n=await a.text();if(!n||n.trim()===""){m("âŒ Empty response from server");return}let l;try{l=JSON.parse(n)}catch(i){m(`âŒ Invalid response from server: ${i.message||"Failed to parse response"}`);return}if(l.ok){if(l.warning)m(`âš ï¸ ${l.warning} (checked ${l.checked||0} device(s))`);else{const i=l.sentTo||0,u=l.expected||i,b=l.userCount||0;l.hasNotificationId&&!l.oneSignalErrors?m(`âœ… Notification sent to ${u} device(s) (${b} users)`):l.oneSignalErrors&&l.oneSignalErrors.length>0?m(`âš ï¸ Sent to ${i} device(s) (${b} users, expected ${u}). OneSignal errors: ${l.oneSignalErrors.join(", ")}`):m(`âœ… Notification sent to ${i} device(s) (${b} users)`)}k("")}else m(`âŒ Failed to send: ${l.error||"Unknown error"}`)}catch(s){console.error("[AdminData] Error sending notification:",s),m(`âŒ Error: ${s.message||"Failed to send notification"}`)}finally{L(!1)}},disabled:C||!j.trim()||!v.trim(),className:"w-full py-2 bg-[#1C8376] text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Sending...":"Send to All Users"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Sends a push notification to all users with active, subscribed devices."})]})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ”— Deep Link Debug"}),e.jsx("div",{className:"space-y-3",children:(()=>{try{const s=localStorage.getItem("deepLink_debug"),r=localStorage.getItem("deepLink_result"),t=localStorage.getItem("deepLink_history"),a=t?JSON.parse(t):[],n=a.filter(i=>!i.success).length,l=a.filter(i=>i.success).length;return e.jsxs(e.Fragment,{children:[a.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 text-xs",children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“Š Summary:"}),e.jsxs("div",{className:"text-blue-700 space-y-1",children:[e.jsxs("div",{children:["Total attempts: ",a.length]}),e.jsxs("div",{children:["âœ… Successful: ",l," | âŒ Failed: ",n]})]})]}),s&&e.jsxs("div",{className:"p-3 bg-blue-600/10 rounded-lg border border-blue-600/20 text-xs",children:[e.jsx("div",{className:"font-semibold text-blue-600 mb-2",children:"Last Check:"}),e.jsx("pre",{className:"text-blue-600 whitespace-pre-wrap break-all",children:JSON.stringify(JSON.parse(s),null,2)})]}),r&&e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${JSON.parse(r).success?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:`font-semibold mb-2 ${JSON.parse(r).success?"text-emerald-800":"text-red-800"}`,children:[JSON.parse(r).success?"âœ… Success":"âŒ Failed",":"]}),e.jsx("pre",{className:`whitespace-pre-wrap break-all ${JSON.parse(r).success?"text-emerald-700":"text-red-700"}`,children:JSON.stringify(JSON.parse(r),null,2)})]}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-slate-600 mb-2 font-semibold",children:["History (last ",Math.min(a.length,20)," attempts):"]}),a.slice(-20).reverse().map((i,u)=>e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${i.success?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:`font-semibold mb-1 ${i.success?"text-emerald-800":"text-red-800"}`,children:[i.success?"âœ…":"âŒ Failed",": ",new Date(i.timestamp).toLocaleString()]}),e.jsx("pre",{className:`whitespace-pre-wrap break-all text-xs ${i.success?"text-emerald-700":"text-red-700"}`,children:JSON.stringify(i,null,2)})]},u))]}),!s&&!r&&a.length===0&&e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No deep link attempts recorded yet. Tap a chat notification to see debug info."}),e.jsx("button",{onClick:()=>{localStorage.removeItem("deepLink_debug"),localStorage.removeItem("deepLink_result"),localStorage.removeItem("deepLink_history"),window.location.reload()},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Debug Info"})]})}catch(s){return e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs text-red-700",children:["Error reading debug info: ",String(s)]})}})()})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"ðŸ”” Notification Diagnostic"}),e.jsx("div",{className:"space-y-3",children:(()=>{try{const s=localStorage.getItem("notification_logs"),r=s?JSON.parse(s):[];return e.jsxs(e.Fragment,{children:[r.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-slate-600 mb-2",children:"Recent notification attempts (last 10):"}),r.slice(-10).reverse().map((t,a)=>e.jsxs("div",{className:`p-3 rounded-lg border text-xs ${t.ok?t.sent>0?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"font-semibold mb-1",children:[new Date(t.timestamp).toLocaleTimeString()," - ",t.ok?t.sent>0?"âœ… Sent":"âš ï¸ No delivery":"âŒ Failed"]}),e.jsx("pre",{className:"whitespace-pre-wrap break-all text-xs",children:JSON.stringify(t,null,2)})]},a))]}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-xs text-slate-600",children:"No notification attempts logged yet. Send a chat message to see diagnostic info."}),e.jsx("button",{onClick:()=>{localStorage.removeItem("notification_logs"),window.location.reload()},className:"w-full py-2 bg-slate-200 text-slate-700 font-medium rounded-lg text-sm",children:"Clear Notification Logs"})]})}catch(s){return e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-xs text-red-700",children:["Error reading notification logs: ",String(s)]})}})()})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Admin Pages"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{to:"/api-admin",className:"block w-full py-3 bg-[#1C8376] text-white font-semibold rounded-xl text-center",children:"API Admin - Premier League"}),e.jsx(p,{to:"/test-fixtures",className:"block w-full py-3 bg-purple-600 text-white font-semibold rounded-xl text-center",children:"Test Fixtures (Non-PL)"}),e.jsx(p,{to:"/admin",className:"block w-full py-3 bg-slate-600 text-white font-semibold rounded-xl text-center",children:"Admin Panel (Web)"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-600 mb-4",children:"Access denied. Admin only."}),e.jsx(p,{to:"/profile",className:"text-[#1C8376]",children:"Go to Profile"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-600 mb-4",children:"Please sign in to view admin data."}),e.jsx(p,{to:"/profile",className:"text-[#1C8376]",children:"Go to Profile"})]})})}export{V as default};
