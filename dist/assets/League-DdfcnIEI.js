import{g as hn,r as z,s as le,j as s,V as mn,a as Pr,u as Ir,i as pn,b as mr,T as pr,D as gn,c as xn,d as wn,e as bn,f as Ht,h as vn,k as yn,L as gr,l as qt,m as xr,I as wr,n as _n,o as br}from"./index-DSmtLBbs.js";function jn(d,u){return u.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(n){if(n!=="default"&&!(n in d)){var t=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(d,n,t.get?t:{enumerable:!0,get:function(){return r[n]}})}}))})),Object.freeze(d)}function Fr(d,u){return new Promise((function(r,n){let t;return kn(d).then((function(e){try{return t=e,r(new Blob([u.slice(0,2),t,u.slice(2)],{type:"image/jpeg"}))}catch(i){return n(i)}}),n)}))}const kn=d=>new Promise(((u,r)=>{const n=new FileReader;n.addEventListener("load",(({target:{result:t}})=>{const e=new DataView(t);let i=0;if(e.getUint16(i)!==65496)return r("not a valid JPEG");for(i+=2;;){const c=e.getUint16(i);if(c===65498)break;const w=e.getUint16(i+2);if(c===65505&&e.getUint32(i+4)===1165519206){const p=i+10;let o;switch(e.getUint16(p)){case 18761:o=!0;break;case 19789:o=!1;break;default:return r("TIFF header contains invalid endian")}if(e.getUint16(p+2,o)!==42)return r("TIFF header contains invalid version");const l=e.getUint32(p+4,o),a=p+l+2+12*e.getUint16(p+l,o);for(let h=p+l+2;h<a;h+=12)if(e.getUint16(h,o)==274){if(e.getUint16(h+2,o)!==3)return r("Orientation data type is invalid");if(e.getUint32(h+4,o)!==1)return r("Orientation data count is invalid");e.setUint16(h+8,1,o);break}return u(t.slice(i,i+2+w))}i+=2+w}return u(new Blob)})),n.readAsArrayBuffer(d)}));var Dt={},Sn={get exports(){return Dt},set exports(d){Dt=d}};(function(d){var u,r,n={};Sn.exports=n,n.parse=function(t,e){for(var i=n.bin.readUshort,c=n.bin.readUint,w=0,p={},o=new Uint8Array(t),l=o.length-4;c(o,l)!=101010256;)l--;w=l,w+=4;var a=i(o,w+=4);i(o,w+=2);var h=c(o,w+=2),m=c(o,w+=4);w+=4,w=m;for(var k=0;k<a;k++){c(o,w),w+=4,w+=4,w+=4,c(o,w+=4),h=c(o,w+=4);var E=c(o,w+=4),y=i(o,w+=4),I=i(o,w+2),F=i(o,w+4);w+=6;var M=c(o,w+=8);w+=4,w+=y+I+F,n._readLocal(o,M,p,h,E,e)}return p},n._readLocal=function(t,e,i,c,w,p){var o=n.bin.readUshort,l=n.bin.readUint;l(t,e),o(t,e+=4),o(t,e+=2);var a=o(t,e+=2);l(t,e+=2),l(t,e+=4),e+=4;var h=o(t,e+=8),m=o(t,e+=2);e+=2;var k=n.bin.readUTF8(t,e,h);if(e+=h,e+=m,p)i[k]={size:w,csize:c};else{var E=new Uint8Array(t.buffer,e);if(a==0)i[k]=new Uint8Array(E.buffer.slice(e,e+c));else{if(a!=8)throw"unknown compression method: "+a;var y=new Uint8Array(w);n.inflateRaw(E,y),i[k]=y}}},n.inflateRaw=function(t,e){return n.F.inflate(t,e)},n.inflate=function(t,e){return t[0],t[1],n.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),e)},n.deflate=function(t,e){e==null&&(e={level:6});var i=0,c=new Uint8Array(50+Math.floor(1.1*t.length));c[i]=120,c[i+1]=156,i+=2,i=n.F.deflateRaw(t,c,i,e.level);var w=n.adler(t,0,t.length);return c[i+0]=w>>>24&255,c[i+1]=w>>>16&255,c[i+2]=w>>>8&255,c[i+3]=w>>>0&255,new Uint8Array(c.buffer,0,i+4)},n.deflateRaw=function(t,e){e==null&&(e={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),c=n.F.deflateRaw(t,i,c,e.level);return new Uint8Array(i.buffer,0,c)},n.encode=function(t,e){e==null&&(e=!1);var i=0,c=n.bin.writeUint,w=n.bin.writeUshort,p={};for(var o in t){var l=!n._noNeed(o)&&!e,a=t[o],h=n.crc.crc(a,0,a.length);p[o]={cpr:l,usize:a.length,crc:h,file:l?n.deflateRaw(a):a}}for(var o in p)i+=p[o].file.length+30+46+2*n.bin.sizeUTF8(o);i+=22;var m=new Uint8Array(i),k=0,E=[];for(var o in p){var y=p[o];E.push(k),k=n._writeHeader(m,k,o,y,0)}var I=0,F=k;for(var o in p)y=p[o],E.push(k),k=n._writeHeader(m,k,o,y,1,E[I++]);var M=k-F;return c(m,k,101010256),k+=4,w(m,k+=4,I),w(m,k+=2,I),c(m,k+=2,M),c(m,k+=4,F),k+=4,k+=2,m.buffer},n._noNeed=function(t){var e=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(e)!=-1},n._writeHeader=function(t,e,i,c,w,p){var o=n.bin.writeUint,l=n.bin.writeUshort,a=c.file;return o(t,e,w==0?67324752:33639248),e+=4,w==1&&(e+=2),l(t,e,20),l(t,e+=2,0),l(t,e+=2,c.cpr?8:0),o(t,e+=2,0),o(t,e+=4,c.crc),o(t,e+=4,a.length),o(t,e+=4,c.usize),l(t,e+=4,n.bin.sizeUTF8(i)),l(t,e+=2,0),e+=2,w==1&&(e+=2,e+=2,o(t,e+=6,p),e+=4),e+=n.bin.writeUTF8(t,e,i),w==0&&(t.set(a,e),e+=a.length),e},n.crc={table:(function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var i=e,c=0;c<8;c++)1&i?i=3988292384^i>>>1:i>>>=1;t[e]=i}return t})(),update:function(t,e,i,c){for(var w=0;w<c;w++)t=n.crc.table[255&(t^e[i+w])]^t>>>8;return t},crc:function(t,e,i){return 4294967295^n.crc.update(4294967295,t,e,i)}},n.adler=function(t,e,i){for(var c=1,w=0,p=e,o=e+i;p<o;){for(var l=Math.min(p+5552,o);p<l;)w+=c+=t[p++];c%=65521,w%=65521}return w<<16|c},n.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,i){t[e]=255&i,t[e+1]=i>>8&255,t[e+2]=i>>16&255,t[e+3]=i>>24&255},readASCII:function(t,e,i){for(var c="",w=0;w<i;w++)c+=String.fromCharCode(t[e+w]);return c},writeASCII:function(t,e,i){for(var c=0;c<i.length;c++)t[e+c]=i.charCodeAt(c)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,e,i){for(var c,w="",p=0;p<i;p++)w+="%"+n.bin.pad(t[e+p].toString(16));try{c=decodeURIComponent(w)}catch{return n.bin.readASCII(t,e,i)}return c},writeUTF8:function(t,e,i){for(var c=i.length,w=0,p=0;p<c;p++){var o=i.charCodeAt(p);if((4294967168&o)==0)t[e+w]=o,w++;else if((4294965248&o)==0)t[e+w]=192|o>>6,t[e+w+1]=128|o>>0&63,w+=2;else if((4294901760&o)==0)t[e+w]=224|o>>12,t[e+w+1]=128|o>>6&63,t[e+w+2]=128|o>>0&63,w+=3;else{if((4292870144&o)!=0)throw"e";t[e+w]=240|o>>18,t[e+w+1]=128|o>>12&63,t[e+w+2]=128|o>>6&63,t[e+w+3]=128|o>>0&63,w+=4}}return w},sizeUTF8:function(t){for(var e=t.length,i=0,c=0;c<e;c++){var w=t.charCodeAt(c);if((4294967168&w)==0)i++;else if((4294965248&w)==0)i+=2;else if((4294901760&w)==0)i+=3;else{if((4292870144&w)!=0)throw"e";i+=4}}return i}},n.F={},n.F.deflateRaw=function(t,e,i,c){var w=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],p=n.F.U,o=n.F._goodIndex;n.F._hash;var l=n.F._putsE,a=0,h=i<<3,m=0,k=t.length;if(c==0){for(;a<k;)l(e,h,a+(N=Math.min(65535,k-a))==k?1:0),h=n.F._copyExact(t,a,N,e,h+8),a+=N;return h>>>3}var E=p.lits,y=p.strt,I=p.prev,F=0,M=0,T=0,v=0,P=0,b=0;for(k>2&&(y[b=n.F._hash(t,0)]=0),a=0;a<k;a++){if(P=b,a+1<k-2){b=n.F._hash(t,a+1);var f=a+1&32767;I[f]=y[b],y[b]=f}if(m<=a){(F>14e3||M>26697)&&k-a>100&&(m<a&&(E[F]=a-m,F+=2,m=a),h=n.F._writeBlock(a==k-1||m==k?1:0,E,F,v,t,T,a-T,e,h),F=M=v=0,T=a);var _=0;a<k-2&&(_=n.F._bestMatch(t,a,I,P,Math.min(w[2],k-a),w[3]));var N=_>>>16,C=65535&_;if(_!=0){C=65535&_;var A=o(N=_>>>16,p.of0);p.lhst[257+A]++;var S=o(C,p.df0);p.dhst[S]++,v+=p.exb[A]+p.dxb[S],E[F]=N<<23|a-m,E[F+1]=C<<16|A<<8|S,F+=2,m=a+N}else p.lhst[t[a]]++;M++}}for(T==a&&t.length!=0||(m<a&&(E[F]=a-m,F+=2,m=a),h=n.F._writeBlock(1,E,F,v,t,T,a-T,e,h),F=0,M=0,F=M=v=0,T=a);(7&h)!=0;)h++;return h>>>3},n.F._bestMatch=function(t,e,i,c,w,p){var o=32767&e,l=i[o],a=o-l+32768&32767;if(l==o||c!=n.F._hash(t,e-a))return 0;for(var h=0,m=0,k=Math.min(32767,e);a<=k&&--p!=0&&l!=o;){if(h==0||t[e+h]==t[e+h-a]){var E=n.F._howLong(t,e,a);if(E>h){if(m=a,(h=E)>=w)break;a+2<E&&(E=a+2);for(var y=0,I=0;I<E-2;I++){var F=e-a+I+32768&32767,M=F-i[F]+32768&32767;M>y&&(y=M,l=F)}}}a+=(o=l)-(l=i[o])+32768&32767}return h<<16|m},n.F._howLong=function(t,e,i){if(t[e]!=t[e-i]||t[e+1]!=t[e+1-i]||t[e+2]!=t[e+2-i])return 0;var c=e,w=Math.min(t.length,e+258);for(e+=3;e<w&&t[e]==t[e-i];)e++;return e-c},n.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(t,e,i,c,w,p,o,l,a){var h,m,k,E,y,I,F,M,T,v=n.F.U,P=n.F._putsF,b=n.F._putsE;v.lhst[256]++,m=(h=n.F.getTrees())[0],k=h[1],E=h[2],y=h[3],I=h[4],F=h[5],M=h[6],T=h[7];var f=32+((a+3&7)==0?0:8-(a+3&7))+(o<<3),_=c+n.F.contSize(v.fltree,v.lhst)+n.F.contSize(v.fdtree,v.dhst),N=c+n.F.contSize(v.ltree,v.lhst)+n.F.contSize(v.dtree,v.dhst);N+=14+3*F+n.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var C=0;C<286;C++)v.lhst[C]=0;for(C=0;C<30;C++)v.dhst[C]=0;for(C=0;C<19;C++)v.ihst[C]=0;var A=f<_&&f<N?0:_<N?1:2;if(P(l,a,t),P(l,a+1,A),a+=3,A==0){for(;(7&a)!=0;)a++;a=n.F._copyExact(w,p,o,l,a)}else{var S,L;if(A==1&&(S=v.fltree,L=v.fdtree),A==2){n.F.makeCodes(v.ltree,m),n.F.revCodes(v.ltree,m),n.F.makeCodes(v.dtree,k),n.F.revCodes(v.dtree,k),n.F.makeCodes(v.itree,E),n.F.revCodes(v.itree,E),S=v.ltree,L=v.dtree,b(l,a,y-257),b(l,a+=5,I-1),b(l,a+=5,F-4),a+=4;for(var x=0;x<F;x++)b(l,a+3*x,v.itree[1+(v.ordr[x]<<1)]);a+=3*F,a=n.F._codeTiny(M,v.itree,l,a),a=n.F._codeTiny(T,v.itree,l,a)}for(var g=p,G=0;G<i;G+=2){for(var U=e[G],H=U>>>23,oe=g+(8388607&U);g<oe;)a=n.F._writeLit(w[g++],S,l,a);if(H!=0){var D=e[G+1],O=D>>16,$=D>>8&255,R=255&D;b(l,a=n.F._writeLit(257+$,S,l,a),H-v.of0[$]),a+=v.exb[$],P(l,a=n.F._writeLit(R,L,l,a),O-v.df0[R]),a+=v.dxb[R],g+=H}}a=n.F._writeLit(256,S,l,a)}return a},n.F._copyExact=function(t,e,i,c,w){var p=w>>>3;return c[p]=i,c[p+1]=i>>>8,c[p+2]=255-c[p],c[p+3]=255-c[p+1],p+=4,c.set(new Uint8Array(t.buffer,e,i),p),w+(i+4<<3)},n.F.getTrees=function(){for(var t=n.F.U,e=n.F._hufTree(t.lhst,t.ltree,15),i=n.F._hufTree(t.dhst,t.dtree,15),c=[],w=n.F._lenCodes(t.ltree,c),p=[],o=n.F._lenCodes(t.dtree,p),l=0;l<c.length;l+=2)t.ihst[c[l]]++;for(l=0;l<p.length;l+=2)t.ihst[p[l]]++;for(var a=n.F._hufTree(t.ihst,t.itree,7),h=19;h>4&&t.itree[1+(t.ordr[h-1]<<1)]==0;)h--;return[e,i,a,w,o,h,c,p]},n.F.getSecond=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(t[i+1]);return e},n.F.nonZero=function(t){for(var e="",i=0;i<t.length;i+=2)t[i+1]!=0&&(e+=(i>>1)+",");return e},n.F.contSize=function(t,e){for(var i=0,c=0;c<e.length;c++)i+=e[c]*t[1+(c<<1)];return i},n.F._codeTiny=function(t,e,i,c){for(var w=0;w<t.length;w+=2){var p=t[w],o=t[w+1];c=n.F._writeLit(p,e,i,c);var l=p==16?2:p==17?3:7;p>15&&(n.F._putsE(i,c,o,l),c+=l)}return c},n.F._lenCodes=function(t,e){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var c=0;c<i;c+=2){var w=t[c+1],p=c+3<i?t[c+3]:-1,o=c+5<i?t[c+5]:-1,l=c==0?-1:t[c-1];if(w==0&&p==w&&o==w){for(var a=c+5;a+2<i&&t[a+2]==w;)a+=2;(h=Math.min(a+1-c>>>1,138))<11?e.push(17,h-3):e.push(18,h-11),c+=2*h-2}else if(w==l&&p==w&&o==w){for(a=c+5;a+2<i&&t[a+2]==w;)a+=2;var h=Math.min(a+1-c>>>1,6);e.push(16,h-3),c+=2*h-2}else e.push(w,0)}return i>>>1},n.F._hufTree=function(t,e,i){var c=[],w=t.length,p=e.length,o=0;for(o=0;o<p;o+=2)e[o]=0,e[o+1]=0;for(o=0;o<w;o++)t[o]!=0&&c.push({lit:o,f:t[o]});var l=c.length,a=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return a=h==0?1:0,e[1+(h<<1)]=1,e[1+(a<<1)]=1,1}c.sort((function(M,T){return M.f-T.f}));var m=c[0],k=c[1],E=0,y=1,I=2;for(c[0]={lit:-1,f:m.f+k.f,l:m,r:k,d:0};y!=l-1;)m=E!=y&&(I==l||c[E].f<c[I].f)?c[E++]:c[I++],k=E!=y&&(I==l||c[E].f<c[I].f)?c[E++]:c[I++],c[y++]={lit:-1,f:m.f+k.f,l:m,r:k};var F=n.F.setDepth(c[y-1],0);for(F>i&&(n.F.restrictDepth(a,i,F),F=i),o=0;o<l;o++)e[1+(a[o].lit<<1)]=a[o].d;return F},n.F.setDepth=function(t,e){return t.lit!=-1?(t.d=e,e):Math.max(n.F.setDepth(t.l,e+1),n.F.setDepth(t.r,e+1))},n.F.restrictDepth=function(t,e,i){var c=0,w=1<<i-e,p=0;for(t.sort((function(l,a){return a.d==l.d?l.f-a.f:a.d-l.d})),c=0;c<t.length&&t[c].d>e;c++){var o=t[c].d;t[c].d=e,p+=w-(1<<i-o)}for(p>>>=i-e;p>0;)(o=t[c].d)<e?(t[c].d++,p-=1<<e-o-1):c++;for(;c>=0;c--)t[c].d==e&&p<0&&(t[c].d--,p++);p!=0&&console.log("debt left")},n.F._goodIndex=function(t,e){var i=0;return e[16|i]<=t&&(i|=16),e[8|i]<=t&&(i|=8),e[4|i]<=t&&(i|=4),e[2|i]<=t&&(i|=2),e[1|i]<=t&&(i|=1),i},n.F._writeLit=function(t,e,i,c){return n.F._putsF(i,c,e[t<<1]),c+e[1+(t<<1)]},n.F.inflate=function(t,e){var i=Uint8Array;if(t[0]==3&&t[1]==0)return e||new i(0);var c=n.F,w=c._bitsF,p=c._bitsE,o=c._decodeTiny,l=c.makeCodes,a=c.codes2map,h=c._get17,m=c.U,k=e==null;k&&(e=new i(t.length>>>2<<3));for(var E,y,I=0,F=0,M=0,T=0,v=0,P=0,b=0,f=0,_=0;I==0;)if(I=w(t,_,1),F=w(t,_+1,2),_+=3,F!=0){if(k&&(e=n.F._check(e,f+(1<<17))),F==1&&(E=m.flmap,y=m.fdmap,P=511,b=31),F==2){M=p(t,_,5)+257,T=p(t,_+5,5)+1,v=p(t,_+10,4)+4,_+=14;for(var N=0;N<38;N+=2)m.itree[N]=0,m.itree[N+1]=0;var C=1;for(N=0;N<v;N++){var A=p(t,_+3*N,3);m.itree[1+(m.ordr[N]<<1)]=A,A>C&&(C=A)}_+=3*v,l(m.itree,C),a(m.itree,C,m.imap),E=m.lmap,y=m.dmap,_=o(m.imap,(1<<C)-1,M+T,t,_,m.ttree);var S=c._copyOut(m.ttree,0,M,m.ltree);P=(1<<S)-1;var L=c._copyOut(m.ttree,M,T,m.dtree);b=(1<<L)-1,l(m.ltree,S),a(m.ltree,S,E),l(m.dtree,L),a(m.dtree,L,y)}for(;;){var x=E[h(t,_)&P];_+=15&x;var g=x>>>4;if(!(g>>>8))e[f++]=g;else{if(g==256)break;var G=f+g-254;if(g>264){var U=m.ldef[g-257];G=f+(U>>>3)+p(t,_,7&U),_+=7&U}var H=y[h(t,_)&b];_+=15&H;var oe=H>>>4,D=m.ddef[oe],O=(D>>>4)+w(t,_,15&D);for(_+=15&D,k&&(e=n.F._check(e,f+(1<<17)));f<G;)e[f]=e[f++-O],e[f]=e[f++-O],e[f]=e[f++-O],e[f]=e[f++-O];f=G}}}else{(7&_)!=0&&(_+=8-(7&_));var $=4+(_>>>3),R=t[$-4]|t[$-3]<<8;k&&(e=n.F._check(e,f+R)),e.set(new i(t.buffer,t.byteOffset+$,R),f),_=$+R<<3,f+=R}return e.length==f?e:e.slice(0,f)},n.F._check=function(t,e){var i=t.length;if(e<=i)return t;var c=new Uint8Array(Math.max(i<<1,e));return c.set(t,0),c},n.F._decodeTiny=function(t,e,i,c,w,p){for(var o=n.F._bitsE,l=n.F._get17,a=0;a<i;){var h=t[l(c,w)&e];w+=15&h;var m=h>>>4;if(m<=15)p[a]=m,a++;else{var k=0,E=0;m==16?(E=3+o(c,w,2),w+=2,k=p[a-1]):m==17?(E=3+o(c,w,3),w+=3):m==18&&(E=11+o(c,w,7),w+=7);for(var y=a+E;a<y;)p[a]=k,a++}}return w},n.F._copyOut=function(t,e,i,c){for(var w=0,p=0,o=c.length>>>1;p<i;){var l=t[p+e];c[p<<1]=0,c[1+(p<<1)]=l,l>w&&(w=l),p++}for(;p<o;)c[p<<1]=0,c[1+(p<<1)]=0,p++;return w},n.F.makeCodes=function(t,e){for(var i,c,w,p,o=n.F.U,l=t.length,a=o.bl_count,h=0;h<=e;h++)a[h]=0;for(h=1;h<l;h+=2)a[t[h]]++;var m=o.next_code;for(i=0,a[0]=0,c=1;c<=e;c++)i=i+a[c-1]<<1,m[c]=i;for(w=0;w<l;w+=2)(p=t[w+1])!=0&&(t[w]=m[p],m[p]++)},n.F.codes2map=function(t,e,i){for(var c=t.length,w=n.F.U.rev15,p=0;p<c;p+=2)if(t[p+1]!=0)for(var o=p>>1,l=t[p+1],a=o<<4|l,h=e-l,m=t[p]<<h,k=m+(1<<h);m!=k;)i[w[m]>>>15-e]=a,m++},n.F.revCodes=function(t,e){for(var i=n.F.U.rev15,c=15-e,w=0;w<t.length;w+=2){var p=t[w]<<e-t[w+1];t[w]=i[p]>>>c}},n.F._putsE=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8},n.F._putsF=function(t,e,i){i<<=7&e;var c=e>>>3;t[c]|=i,t[c+1]|=i>>>8,t[c+2]|=i>>>16},n.F._bitsE=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<i)-1},n.F._bitsF=function(t,e,i){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<i)-1},n.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},n.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},n.F.U=(u=Uint16Array,r=Uint32Array,{next_code:new u(16),bl_count:new u(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new u(512),fltree:[],fdmap:new u(32),fdtree:[],lmap:new u(32768),ltree:[],ttree:[],dmap:new u(32768),dtree:[],imap:new u(512),itree:[],rev15:new u(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new u(65536),prev:new u(32768)}),(function(){for(var t=n.F.U,e=0;e<32768;e++){var i=e;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[e]=(i>>>16|i<<16)>>>17}function c(w,p,o){for(;p--!=0;)w.push(0,o)}for(e=0;e<32;e++)t.ldef[e]=t.of0[e]<<3|t.exb[e],t.ddef[e]=t.df0[e]<<4|t.dxb[e];c(t.fltree,144,8),c(t.fltree,112,9),c(t.fltree,24,7),c(t.fltree,8,8),n.F.makeCodes(t.fltree,9),n.F.codes2map(t.fltree,9,t.flmap),n.F.revCodes(t.fltree,9),c(t.fdtree,32,5),n.F.makeCodes(t.fdtree,5),n.F.codes2map(t.fdtree,5,t.fdmap),n.F.revCodes(t.fdtree,5),c(t.itree,19,0),c(t.ltree,286,0),c(t.dtree,30,0),c(t.ttree,320,0)})()})();var Cn=jn({__proto__:null,default:Dt},[Dt]);const nt=(function(){var d={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,a){o[l]=a>>8&255,o[l+1]=255&a},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,a){o[l]=a>>24&255,o[l+1]=a>>16&255,o[l+2]=a>>8&255,o[l+3]=255&a},readASCII(o,l,a){let h="";for(let m=0;m<a;m++)h+=String.fromCharCode(o[l+m]);return h},writeASCII(o,l,a){for(let h=0;h<a.length;h++)o[l+h]=a.charCodeAt(h)},readBytes(o,l,a){const h=[];for(let m=0;m<a;m++)h.push(o[l+m]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,a){let h,m="";for(let k=0;k<a;k++)m+=`%${d.pad(o[l+k].toString(16))}`;try{h=decodeURIComponent(m)}catch{return d.readASCII(o,l,a)}return h}};function u(o,l,a,h){const m=l*a,k=e(h),E=Math.ceil(l*k/8),y=new Uint8Array(4*m),I=new Uint32Array(y.buffer),{ctype:F}=h,{depth:M}=h,T=d.readUshort;if(F==6){const U=m<<2;if(M==8)for(var v=0;v<U;v+=4)y[v]=o[v],y[v+1]=o[v+1],y[v+2]=o[v+2],y[v+3]=o[v+3];if(M==16)for(v=0;v<U;v++)y[v]=o[v<<1]}else if(F==2){const U=h.tabs.tRNS;if(U==null){if(M==8)for(v=0;v<m;v++){var P=3*v;I[v]=255<<24|o[P+2]<<16|o[P+1]<<8|o[P]}if(M==16)for(v=0;v<m;v++)P=6*v,I[v]=255<<24|o[P+4]<<16|o[P+2]<<8|o[P]}else{var b=U[0];const H=U[1],oe=U[2];if(M==8)for(v=0;v<m;v++){var f=v<<2;P=3*v,I[v]=255<<24|o[P+2]<<16|o[P+1]<<8|o[P],o[P]==b&&o[P+1]==H&&o[P+2]==oe&&(y[f+3]=0)}if(M==16)for(v=0;v<m;v++)f=v<<2,P=6*v,I[v]=255<<24|o[P+4]<<16|o[P+2]<<8|o[P],T(o,P)==b&&T(o,P+2)==H&&T(o,P+4)==oe&&(y[f+3]=0)}}else if(F==3){const U=h.tabs.PLTE,H=h.tabs.tRNS,oe=H?H.length:0;if(M==1)for(var _=0;_<a;_++){var N=_*E,C=_*l;for(v=0;v<l;v++){f=C+v<<2;var A=3*(S=o[N+(v>>3)]>>7-((7&v)<<0)&1);y[f]=U[A],y[f+1]=U[A+1],y[f+2]=U[A+2],y[f+3]=S<oe?H[S]:255}}if(M==2)for(_=0;_<a;_++)for(N=_*E,C=_*l,v=0;v<l;v++)f=C+v<<2,A=3*(S=o[N+(v>>2)]>>6-((3&v)<<1)&3),y[f]=U[A],y[f+1]=U[A+1],y[f+2]=U[A+2],y[f+3]=S<oe?H[S]:255;if(M==4)for(_=0;_<a;_++)for(N=_*E,C=_*l,v=0;v<l;v++)f=C+v<<2,A=3*(S=o[N+(v>>1)]>>4-((1&v)<<2)&15),y[f]=U[A],y[f+1]=U[A+1],y[f+2]=U[A+2],y[f+3]=S<oe?H[S]:255;if(M==8)for(v=0;v<m;v++){var S;f=v<<2,A=3*(S=o[v]),y[f]=U[A],y[f+1]=U[A+1],y[f+2]=U[A+2],y[f+3]=S<oe?H[S]:255}}else if(F==4){if(M==8)for(v=0;v<m;v++){f=v<<2;var L=o[x=v<<1];y[f]=L,y[f+1]=L,y[f+2]=L,y[f+3]=o[x+1]}if(M==16)for(v=0;v<m;v++){var x;f=v<<2,L=o[x=v<<2],y[f]=L,y[f+1]=L,y[f+2]=L,y[f+3]=o[x+2]}}else if(F==0)for(b=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<a;_++){const U=_*E,H=_*l;if(M==1)for(var g=0;g<l;g++){var G=(L=255*(o[U+(g>>>3)]>>>7-(7&g)&1))==255*b?0:255;I[H+g]=G<<24|L<<16|L<<8|L}else if(M==2)for(g=0;g<l;g++)G=(L=85*(o[U+(g>>>2)]>>>6-((3&g)<<1)&3))==85*b?0:255,I[H+g]=G<<24|L<<16|L<<8|L;else if(M==4)for(g=0;g<l;g++)G=(L=17*(o[U+(g>>>1)]>>>4-((1&g)<<2)&15))==17*b?0:255,I[H+g]=G<<24|L<<16|L<<8|L;else if(M==8)for(g=0;g<l;g++)G=(L=o[U+g])==b?0:255,I[H+g]=G<<24|L<<16|L<<8|L;else if(M==16)for(g=0;g<l;g++)L=o[U+(g<<1)],G=T(o,U+(g<<1))==b?0:255,I[H+g]=G<<24|L<<16|L<<8|L}return y}function r(o,l,a,h){const m=e(o),k=Math.ceil(a*m/8),E=new Uint8Array((k+1+o.interlace)*h);return l=o.tabs.CgBI?t(l,E):n(l,E),o.interlace==0?l=i(l,o,0,a,h):o.interlace==1&&(l=(function(I,F){const M=F.width,T=F.height,v=e(F),P=v>>3,b=Math.ceil(M*v/8),f=new Uint8Array(T*b);let _=0;const N=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],A=[8,8,8,4,4,2,2],S=[8,8,4,4,2,2,1];let L=0;for(;L<7;){const g=A[L],G=S[L];let U=0,H=0,oe=N[L];for(;oe<T;)oe+=g,H++;let D=C[L];for(;D<M;)D+=G,U++;const O=Math.ceil(U*v/8);i(I,F,_,U,H);let $=0,R=N[L];for(;R<T;){let q=C[L],K=_+$*O<<3;for(;q<M;){var x;if(v==1&&(x=(x=I[K>>3])>>7-(7&K)&1,f[R*b+(q>>3)]|=x<<7-((7&q)<<0)),v==2&&(x=(x=I[K>>3])>>6-(7&K)&3,f[R*b+(q>>2)]|=x<<6-((3&q)<<1)),v==4&&(x=(x=I[K>>3])>>4-(7&K)&15,f[R*b+(q>>1)]|=x<<4-((1&q)<<2)),v>=8){const Y=R*b+q*P;for(let W=0;W<P;W++)f[Y+W]=I[(K>>3)+W]}K+=v,q+=G}$++,R+=g}U*H!=0&&(_+=H*(1+O)),L+=1}return f})(l,o)),l}function n(o,l){return t(new Uint8Array(o.buffer,2,o.length-6),l)}var t=(function(){const o={H:{}};return o.H.N=function(l,a){const h=Uint8Array;let m,k,E=0,y=0,I=0,F=0,M=0,T=0,v=0,P=0,b=0;if(l[0]==3&&l[1]==0)return a||new h(0);const f=o.H,_=f.b,N=f.e,C=f.R,A=f.n,S=f.A,L=f.Z,x=f.m,g=a==null;for(g&&(a=new h(l.length>>>2<<5));E==0;)if(E=_(l,b,1),y=_(l,b+1,2),b+=3,y!=0){if(g&&(a=o.H.W(a,P+(1<<17))),y==1&&(m=x.J,k=x.h,T=511,v=31),y==2){I=N(l,b,5)+257,F=N(l,b+5,5)+1,M=N(l,b+10,4)+4,b+=14;let U=1;for(var G=0;G<38;G+=2)x.Q[G]=0,x.Q[G+1]=0;for(G=0;G<M;G++){const D=N(l,b+3*G,3);x.Q[1+(x.X[G]<<1)]=D,D>U&&(U=D)}b+=3*M,A(x.Q,U),S(x.Q,U,x.u),m=x.w,k=x.d,b=C(x.u,(1<<U)-1,I+F,l,b,x.v);const H=f.V(x.v,0,I,x.C);T=(1<<H)-1;const oe=f.V(x.v,I,F,x.D);v=(1<<oe)-1,A(x.C,H),S(x.C,H,m),A(x.D,oe),S(x.D,oe,k)}for(;;){const U=m[L(l,b)&T];b+=15&U;const H=U>>>4;if(!(H>>>8))a[P++]=H;else{if(H==256)break;{let oe=P+H-254;if(H>264){const q=x.q[H-257];oe=P+(q>>>3)+N(l,b,7&q),b+=7&q}const D=k[L(l,b)&v];b+=15&D;const O=D>>>4,$=x.c[O],R=($>>>4)+_(l,b,15&$);for(b+=15&$;P<oe;)a[P]=a[P++-R],a[P]=a[P++-R],a[P]=a[P++-R],a[P]=a[P++-R];P=oe}}}}else{(7&b)!=0&&(b+=8-(7&b));const U=4+(b>>>3),H=l[U-4]|l[U-3]<<8;g&&(a=o.H.W(a,P+H)),a.set(new h(l.buffer,l.byteOffset+U,H),P),b=U+H<<3,P+=H}return a.length==P?a:a.slice(0,P)},o.H.W=function(l,a){const h=l.length;if(a<=h)return l;const m=new Uint8Array(h<<1);return m.set(l,0),m},o.H.R=function(l,a,h,m,k,E){const y=o.H.e,I=o.H.Z;let F=0;for(;F<h;){const M=l[I(m,k)&a];k+=15&M;const T=M>>>4;if(T<=15)E[F]=T,F++;else{let v=0,P=0;T==16?(P=3+y(m,k,2),k+=2,v=E[F-1]):T==17?(P=3+y(m,k,3),k+=3):T==18&&(P=11+y(m,k,7),k+=7);const b=F+P;for(;F<b;)E[F]=v,F++}}return k},o.H.V=function(l,a,h,m){let k=0,E=0;const y=m.length>>>1;for(;E<h;){const I=l[E+a];m[E<<1]=0,m[1+(E<<1)]=I,I>k&&(k=I),E++}for(;E<y;)m[E<<1]=0,m[1+(E<<1)]=0,E++;return k},o.H.n=function(l,a){const h=o.H.m,m=l.length;let k,E,y,I;const F=h.j;for(var M=0;M<=a;M++)F[M]=0;for(M=1;M<m;M+=2)F[l[M]]++;const T=h.K;for(k=0,F[0]=0,E=1;E<=a;E++)k=k+F[E-1]<<1,T[E]=k;for(y=0;y<m;y+=2)I=l[y+1],I!=0&&(l[y]=T[I],T[I]++)},o.H.A=function(l,a,h){const m=l.length,k=o.H.m.r;for(let E=0;E<m;E+=2)if(l[E+1]!=0){const y=E>>1,I=l[E+1],F=y<<4|I,M=a-I;let T=l[E]<<M;const v=T+(1<<M);for(;T!=v;)h[k[T]>>>15-a]=F,T++}},o.H.l=function(l,a){const h=o.H.m.r,m=15-a;for(let k=0;k<l.length;k+=2){const E=l[k]<<a-l[k+1];l[k]=h[E]>>>m}},o.H.M=function(l,a,h){h<<=7&a;const m=a>>>3;l[m]|=h,l[m+1]|=h>>>8},o.H.I=function(l,a,h){h<<=7&a;const m=a>>>3;l[m]|=h,l[m+1]|=h>>>8,l[m+2]|=h>>>16},o.H.e=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8)>>>(7&a)&(1<<h)-1},o.H.b=function(l,a,h){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)&(1<<h)-1},o.H.Z=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16)>>>(7&a)},o.H.i=function(l,a){return(l[a>>>3]|l[1+(a>>>3)]<<8|l[2+(a>>>3)]<<16|l[3+(a>>>3)]<<24)>>>(7&a)},o.H.m=(function(){const l=Uint16Array,a=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new a(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new a(286),Y:new a(30),a:new a(19),t:new a(15e3),k:new l(65536),g:new l(32768)}})(),(function(){const l=o.H.m;for(var a=0;a<32768;a++){let m=a;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,l.r[a]=(m>>>16|m<<16)>>>17}function h(m,k,E){for(;k--!=0;)m.push(0,E)}for(a=0;a<32;a++)l.q[a]=l.S[a]<<3|l.T[a],l.c[a]=l.p[a]<<4|l.z[a];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)})(),o.H.N})();function e(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function i(o,l,a,h,m){let k=e(l);const E=Math.ceil(h*k/8);let y,I;k=Math.ceil(k/8);let F=o[a],M=0;if(F>1&&(o[a]=[0,0,1][F-2]),F==3)for(M=k;M<E;M++)o[M+1]=o[M+1]+(o[M+1-k]>>>1)&255;for(let T=0;T<m;T++)if(y=a+T*E,I=y+T+1,F=o[I-1],M=0,F==0)for(;M<E;M++)o[y+M]=o[I+M];else if(F==1){for(;M<k;M++)o[y+M]=o[I+M];for(;M<E;M++)o[y+M]=o[I+M]+o[y+M-k]}else if(F==2)for(;M<E;M++)o[y+M]=o[I+M]+o[y+M-E];else if(F==3){for(;M<k;M++)o[y+M]=o[I+M]+(o[y+M-E]>>>1);for(;M<E;M++)o[y+M]=o[I+M]+(o[y+M-E]+o[y+M-k]>>>1)}else{for(;M<k;M++)o[y+M]=o[I+M]+c(0,o[y+M-E],0);for(;M<E;M++)o[y+M]=o[I+M]+c(o[y+M-k],o[y+M-E],o[y+M-k-E])}return o}function c(o,l,a){const h=o+l-a,m=h-o,k=h-l,E=h-a;return m*m<=k*k&&m*m<=E*E?o:k*k<=E*E?l:a}function w(o,l,a){a.width=d.readUint(o,l),l+=4,a.height=d.readUint(o,l),l+=4,a.depth=o[l],l++,a.ctype=o[l],l++,a.compress=o[l],l++,a.filter=o[l],l++,a.interlace=o[l],l++}function p(o,l,a,h,m,k,E,y,I){const F=Math.min(l,m),M=Math.min(a,k);let T=0,v=0;for(let L=0;L<M;L++)for(let x=0;x<F;x++)if(E>=0&&y>=0?(T=L*l+x<<2,v=(y+L)*m+E+x<<2):(T=(-y+L)*l-E+x<<2,v=L*m+x<<2),I==0)h[v]=o[T],h[v+1]=o[T+1],h[v+2]=o[T+2],h[v+3]=o[T+3];else if(I==1){var P=o[T+3]*.00392156862745098,b=o[T]*P,f=o[T+1]*P,_=o[T+2]*P,N=h[v+3]*(1/255),C=h[v]*N,A=h[v+1]*N,S=h[v+2]*N;const g=1-P,G=P+N*g,U=G==0?0:1/G;h[v+3]=255*G,h[v+0]=(b+C*g)*U,h[v+1]=(f+A*g)*U,h[v+2]=(_+S*g)*U}else if(I==2)P=o[T+3],b=o[T],f=o[T+1],_=o[T+2],N=h[v+3],C=h[v],A=h[v+1],S=h[v+2],P==N&&b==C&&f==A&&_==S?(h[v]=0,h[v+1]=0,h[v+2]=0,h[v+3]=0):(h[v]=b,h[v+1]=f,h[v+2]=_,h[v+3]=P);else if(I==3){if(P=o[T+3],b=o[T],f=o[T+1],_=o[T+2],N=h[v+3],C=h[v],A=h[v+1],S=h[v+2],P==N&&b==C&&f==A&&_==S)continue;if(P<220&&N>20)return!1}return!0}return{decode:function(l){const a=new Uint8Array(l);let h=8;const m=d,k=m.readUshort,E=m.readUint,y={tabs:{},frames:[]},I=new Uint8Array(a.length);let F,M=0,T=0;const v=[137,80,78,71,13,10,26,10];for(var P=0;P<8;P++)if(a[P]!=v[P])throw"The input is not a PNG file!";for(;h<a.length;){const L=m.readUint(a,h);h+=4;const x=m.readASCII(a,h,4);if(h+=4,x=="IHDR")w(a,h,y);else if(x=="iCCP"){for(var b=h;a[b]!=0;)b++;m.readASCII(a,h,b-h),a[b+1];const g=a.slice(b+2,h+L);let G=null;try{G=n(g)}catch{G=t(g)}y.tabs[x]=G}else if(x=="CgBI")y.tabs[x]=a.slice(h,h+4);else if(x=="IDAT"){for(P=0;P<L;P++)I[M+P]=a[h+P];M+=L}else if(x=="acTL")y.tabs[x]={num_frames:E(a,h),num_plays:E(a,h+4)},F=new Uint8Array(a.length);else if(x=="fcTL"){T!=0&&((S=y.frames[y.frames.length-1]).data=r(y,F.slice(0,T),S.rect.width,S.rect.height),T=0);const g={x:E(a,h+12),y:E(a,h+16),width:E(a,h+4),height:E(a,h+8)};let G=k(a,h+22);G=k(a,h+20)/(G==0?100:G);const U={rect:g,delay:Math.round(1e3*G),dispose:a[h+24],blend:a[h+25]};y.frames.push(U)}else if(x=="fdAT"){for(P=0;P<L-4;P++)F[T+P]=a[h+P+4];T+=L-4}else if(x=="pHYs")y.tabs[x]=[m.readUint(a,h),m.readUint(a,h+4),a[h+8]];else if(x=="cHRM")for(y.tabs[x]=[],P=0;P<8;P++)y.tabs[x].push(m.readUint(a,h+4*P));else if(x=="tEXt"||x=="zTXt"){y.tabs[x]==null&&(y.tabs[x]={});var f=m.nextZero(a,h),_=m.readASCII(a,h,f-h),N=h+L-f-1;if(x=="tEXt")A=m.readASCII(a,f+1,N);else{var C=n(a.slice(f+2,f+2+N));A=m.readUTF8(C,0,C.length)}y.tabs[x][_]=A}else if(x=="iTXt"){y.tabs[x]==null&&(y.tabs[x]={}),f=0,b=h,f=m.nextZero(a,b),_=m.readASCII(a,b,f-b);const g=a[b=f+1];var A;a[b+1],b+=2,f=m.nextZero(a,b),m.readASCII(a,b,f-b),b=f+1,f=m.nextZero(a,b),m.readUTF8(a,b,f-b),N=L-((b=f+1)-h),g==0?A=m.readUTF8(a,b,N):(C=n(a.slice(b,b+N)),A=m.readUTF8(C,0,C.length)),y.tabs[x][_]=A}else if(x=="PLTE")y.tabs[x]=m.readBytes(a,h,L);else if(x=="hIST"){const g=y.tabs.PLTE.length/3;for(y.tabs[x]=[],P=0;P<g;P++)y.tabs[x].push(k(a,h+2*P))}else if(x=="tRNS")y.ctype==3?y.tabs[x]=m.readBytes(a,h,L):y.ctype==0?y.tabs[x]=k(a,h):y.ctype==2&&(y.tabs[x]=[k(a,h),k(a,h+2),k(a,h+4)]);else if(x=="gAMA")y.tabs[x]=m.readUint(a,h)/1e5;else if(x=="sRGB")y.tabs[x]=a[h];else if(x=="bKGD")y.ctype==0||y.ctype==4?y.tabs[x]=[k(a,h)]:y.ctype==2||y.ctype==6?y.tabs[x]=[k(a,h),k(a,h+2),k(a,h+4)]:y.ctype==3&&(y.tabs[x]=a[h]);else if(x=="IEND")break;h+=L,m.readUint(a,h),h+=4}var S;return T!=0&&((S=y.frames[y.frames.length-1]).data=r(y,F.slice(0,T),S.rect.width,S.rect.height)),y.data=r(y,I,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(l){const a=l.width,h=l.height;if(l.tabs.acTL==null)return[u(l.data,a,h,l).buffer];const m=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const k=a*h*4,E=new Uint8Array(k),y=new Uint8Array(k),I=new Uint8Array(k);for(let M=0;M<l.frames.length;M++){const T=l.frames[M],v=T.rect.x,P=T.rect.y,b=T.rect.width,f=T.rect.height,_=u(T.data,b,f,l);if(M!=0)for(var F=0;F<k;F++)I[F]=E[F];if(T.blend==0?p(_,b,f,E,a,h,v,P,0):T.blend==1&&p(_,b,f,E,a,h,v,P,1),m.push(E.buffer.slice(0)),T.dispose!=0){if(T.dispose==1)p(y,b,f,E,a,h,v,P,0);else if(T.dispose==2)for(F=0;F<k;F++)E[F]=I[F]}}return m},_paeth:c,_copyTile:p,_bin:d}})();(function(){const{_copyTile:d}=nt,{_bin:u}=nt,r=nt._paeth;var n={table:(function(){const b=new Uint32Array(256);for(let f=0;f<256;f++){let _=f;for(let N=0;N<8;N++)1&_?_=3988292384^_>>>1:_>>>=1;b[f]=_}return b})(),update(b,f,_,N){for(let C=0;C<N;C++)b=n.table[255&(b^f[_+C])]^b>>>8;return b},crc:(b,f,_)=>4294967295^n.update(4294967295,b,f,_)};function t(b,f,_,N){f[_]+=b[0]*N>>4,f[_+1]+=b[1]*N>>4,f[_+2]+=b[2]*N>>4,f[_+3]+=b[3]*N>>4}function e(b){return Math.max(0,Math.min(255,b))}function i(b,f){const _=b[0]-f[0],N=b[1]-f[1],C=b[2]-f[2],A=b[3]-f[3];return _*_+N*N+C*C+A*A}function c(b,f,_,N,C,A,S){S==null&&(S=1);const L=N.length,x=[];for(var g=0;g<L;g++){const R=N[g];x.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(g=0;g<L;g++){let R=4294967295;for(var G=0,U=0;U<L;U++){var H=i(x[g],x[U]);U!=g&&H<R&&(R=H,G=U)}}const oe=new Uint32Array(C.buffer),D=new Int16Array(f*_*4),O=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(g=0;g<O.length;g++)O[g]=255*((O[g]+.5)/16-.5);for(let R=0;R<_;R++)for(let q=0;q<f;q++){var $;g=4*(R*f+q),S!=2?$=[e(b[g]+D[g]),e(b[g+1]+D[g+1]),e(b[g+2]+D[g+2]),e(b[g+3]+D[g+3])]:(H=O[4*(3&R)+(3&q)],$=[e(b[g]+H),e(b[g+1]+H),e(b[g+2]+H),e(b[g+3]+H)]),G=0;let K=16777215;for(U=0;U<L;U++){const te=i($,x[U]);te<K&&(K=te,G=U)}const Y=x[G],W=[$[0]-Y[0],$[1]-Y[1],$[2]-Y[2],$[3]-Y[3]];S==1&&(q!=f-1&&t(W,D,g+4,7),R!=_-1&&(q!=0&&t(W,D,g+4*f-4,3),t(W,D,g+4*f,5),q!=f-1&&t(W,D,g+4*f+4,1))),A[g>>2]=G,oe[g>>2]=N[G]}}function w(b,f,_,N,C){C==null&&(C={});const{crc:A}=n,S=u.writeUint,L=u.writeUshort,x=u.writeASCII;let g=8;const G=b.frames.length>1;let U,H=!1,oe=33+(G?20:0);if(C.sRGB!=null&&(oe+=13),C.pHYs!=null&&(oe+=21),C.iCCP!=null&&(U=pako.deflate(C.iCCP),oe+=21+U.length+4),b.ctype==3){for(var D=b.plte.length,O=0;O<D;O++)b.plte[O]>>>24!=255&&(H=!0);oe+=8+3*D+4+(H?8+1*D+4:0)}for(var $=0;$<b.frames.length;$++)G&&(oe+=38),oe+=(Y=b.frames[$]).cimg.length+12,$!=0&&(oe+=4);oe+=12;const R=new Uint8Array(oe),q=[137,80,78,71,13,10,26,10];for(O=0;O<8;O++)R[O]=q[O];if(S(R,g,13),g+=4,x(R,g,"IHDR"),g+=4,S(R,g,f),g+=4,S(R,g,_),g+=4,R[g]=b.depth,g++,R[g]=b.ctype,g++,R[g]=0,g++,R[g]=0,g++,R[g]=0,g++,S(R,g,A(R,g-17,17)),g+=4,C.sRGB!=null&&(S(R,g,1),g+=4,x(R,g,"sRGB"),g+=4,R[g]=C.sRGB,g++,S(R,g,A(R,g-5,5)),g+=4),C.iCCP!=null){const W=13+U.length;S(R,g,W),g+=4,x(R,g,"iCCP"),g+=4,x(R,g,"ICC profile"),g+=11,g+=2,R.set(U,g),g+=U.length,S(R,g,A(R,g-(W+4),W+4)),g+=4}if(C.pHYs!=null&&(S(R,g,9),g+=4,x(R,g,"pHYs"),g+=4,S(R,g,C.pHYs[0]),g+=4,S(R,g,C.pHYs[1]),g+=4,R[g]=C.pHYs[2],g++,S(R,g,A(R,g-13,13)),g+=4),G&&(S(R,g,8),g+=4,x(R,g,"acTL"),g+=4,S(R,g,b.frames.length),g+=4,S(R,g,C.loop!=null?C.loop:0),g+=4,S(R,g,A(R,g-12,12)),g+=4),b.ctype==3){for(S(R,g,3*(D=b.plte.length)),g+=4,x(R,g,"PLTE"),g+=4,O=0;O<D;O++){const W=3*O,te=b.plte[O],ae=255&te,de=te>>>8&255,he=te>>>16&255;R[g+W+0]=ae,R[g+W+1]=de,R[g+W+2]=he}if(g+=3*D,S(R,g,A(R,g-3*D-4,3*D+4)),g+=4,H){for(S(R,g,D),g+=4,x(R,g,"tRNS"),g+=4,O=0;O<D;O++)R[g+O]=b.plte[O]>>>24&255;g+=D,S(R,g,A(R,g-D-4,D+4)),g+=4}}let K=0;for($=0;$<b.frames.length;$++){var Y=b.frames[$];G&&(S(R,g,26),g+=4,x(R,g,"fcTL"),g+=4,S(R,g,K++),g+=4,S(R,g,Y.rect.width),g+=4,S(R,g,Y.rect.height),g+=4,S(R,g,Y.rect.x),g+=4,S(R,g,Y.rect.y),g+=4,L(R,g,N[$]),g+=2,L(R,g,1e3),g+=2,R[g]=Y.dispose,g++,R[g]=Y.blend,g++,S(R,g,A(R,g-30,30)),g+=4);const W=Y.cimg;S(R,g,(D=W.length)+($==0?0:4)),g+=4;const te=g;x(R,g,$==0?"IDAT":"fdAT"),g+=4,$!=0&&(S(R,g,K++),g+=4),R.set(W,g),g+=D,S(R,g,A(R,te,g-te)),g+=4}return S(R,g,0),g+=4,x(R,g,"IEND"),g+=4,S(R,g,A(R,g-4,4)),g+=4,R.buffer}function p(b,f,_){for(let N=0;N<b.frames.length;N++){const C=b.frames[N];C.rect.width;const A=C.rect.height,S=new Uint8Array(A*C.bpl+A);C.cimg=h(C.img,A,C.bpp,C.bpl,S,f,_)}}function o(b,f,_,N,C){const A=C[0],S=C[1],L=C[2],x=C[3],g=C[4],G=C[5];let U=6,H=8,oe=255;for(var D=0;D<b.length;D++){const ye=new Uint8Array(b[D]);for(var O=ye.length,$=0;$<O;$+=4)oe&=ye[$+3]}const R=oe!=255,q=(function(je,me,ke,we,Re,We){const xe=[];for(var pe=0;pe<je.length;pe++){const Fe=new Uint8Array(je[pe]),Ke=new Uint32Array(Fe.buffer);var Te;let qe=0,Ze=0,Je=me,et=ke,st=we?1:0;if(pe!=0){const $t=We||we||pe==1||xe[pe-2].dispose!=0?1:2;let pt=0,Nt=1e9;for(let lt=0;lt<$t;lt++){var ze=new Uint8Array(je[pe-1-lt]);const xt=new Uint32Array(je[pe-1-lt]);let rt=me,tt=ke,ct=-1,dt=-1;for(let Qe=0;Qe<ke;Qe++)for(let ut=0;ut<me;ut++)Ke[Ae=Qe*me+ut]!=xt[Ae]&&(ut<rt&&(rt=ut),ut>ct&&(ct=ut),Qe<tt&&(tt=Qe),Qe>dt&&(dt=Qe));ct==-1&&(rt=tt=ct=dt=0),Re&&((1&rt)==1&&rt--,(1&tt)==1&&tt--);const yt=(ct-rt+1)*(dt-tt+1);yt<Nt&&(Nt=yt,pt=lt,qe=rt,Ze=tt,Je=ct-rt+1,et=dt-tt+1)}ze=new Uint8Array(je[pe-1-pt]),pt==1&&(xe[pe-1].dispose=2),Te=new Uint8Array(Je*et*4),d(ze,me,ke,Te,Je,et,-qe,-Ze,0),st=d(Fe,me,ke,Te,Je,et,-qe,-Ze,3)?1:0,st==1?a(Fe,me,ke,Te,{x:qe,y:Ze,width:Je,height:et}):d(Fe,me,ke,Te,Je,et,-qe,-Ze,0)}else Te=Fe.slice(0);xe.push({rect:{x:qe,y:Ze,width:Je,height:et},img:Te,blend:st,dispose:0})}if(we)for(pe=0;pe<xe.length;pe++){if((it=xe[pe]).blend==1)continue;const Fe=it.rect,Ke=xe[pe-1].rect,qe=Math.min(Fe.x,Ke.x),Ze=Math.min(Fe.y,Ke.y),Je={x:qe,y:Ze,width:Math.max(Fe.x+Fe.width,Ke.x+Ke.width)-qe,height:Math.max(Fe.y+Fe.height,Ke.y+Ke.height)-Ze};xe[pe-1].dispose=1,pe-1!=0&&l(je,me,ke,xe,pe-1,Je,Re),l(je,me,ke,xe,pe,Je,Re)}let $e=0;if(je.length!=1)for(var Ae=0;Ae<xe.length;Ae++){var it;$e+=(it=xe[Ae]).rect.width*it.rect.height}return xe})(b,f,_,A,S,L),K={},Y=[],W=[];if(N!=0){const ye=[];for($=0;$<q.length;$++)ye.push(q[$].img.buffer);const je=(function(Re){let We=0;for(var xe=0;xe<Re.length;xe++)We+=Re[xe].byteLength;const pe=new Uint8Array(We);let Te=0;for(xe=0;xe<Re.length;xe++){const ze=new Uint8Array(Re[xe]),$e=ze.length;for(let Ae=0;Ae<$e;Ae+=4){let it=ze[Ae],Fe=ze[Ae+1],Ke=ze[Ae+2];const qe=ze[Ae+3];qe==0&&(it=Fe=Ke=0),pe[Te+Ae]=it,pe[Te+Ae+1]=Fe,pe[Te+Ae+2]=Ke,pe[Te+Ae+3]=qe}Te+=$e}return pe.buffer})(ye),me=k(je,N);for($=0;$<me.plte.length;$++)Y.push(me.plte[$].est.rgba);let ke=0;for($=0;$<q.length;$++){const we=(ae=q[$]).img.length;var te=new Uint8Array(me.inds.buffer,ke>>2,we>>2);W.push(te);const Re=new Uint8Array(me.abuf,ke,we);G&&c(ae.img,ae.rect.width,ae.rect.height,Y,Re,te),ae.img.set(Re),ke+=we}}else for(D=0;D<q.length;D++){var ae=q[D];const ye=new Uint32Array(ae.img.buffer);var de=ae.rect.width;for(O=ye.length,te=new Uint8Array(O),W.push(te),$=0;$<O;$++){const je=ye[$];if($!=0&&je==ye[$-1])te[$]=te[$-1];else if($>de&&je==ye[$-de])te[$]=te[$-de];else{let me=K[je];if(me==null&&(K[je]=me=Y.length,Y.push(je),Y.length>=300))break;te[$]=me}}}const he=Y.length;for(he<=256&&g==0&&(H=he<=2?1:he<=4?2:he<=16?4:8,H=Math.max(H,x)),D=0;D<q.length;D++){(ae=q[D]).rect.x,ae.rect.y,de=ae.rect.width;const ye=ae.rect.height;let je=ae.img;new Uint32Array(je.buffer);let me=4*de,ke=4;if(he<=256&&g==0){me=Math.ceil(H*de/8);var Ce=new Uint8Array(me*ye);const we=W[D];for(let Re=0;Re<ye;Re++){$=Re*me;const We=Re*de;if(H==8)for(var Se=0;Se<de;Se++)Ce[$+Se]=we[We+Se];else if(H==4)for(Se=0;Se<de;Se++)Ce[$+(Se>>1)]|=we[We+Se]<<4-4*(1&Se);else if(H==2)for(Se=0;Se<de;Se++)Ce[$+(Se>>2)]|=we[We+Se]<<6-2*(3&Se);else if(H==1)for(Se=0;Se<de;Se++)Ce[$+(Se>>3)]|=we[We+Se]<<7-1*(7&Se)}je=Ce,U=3,ke=1}else if(R==0&&q.length==1){Ce=new Uint8Array(de*ye*3);const we=de*ye;for($=0;$<we;$++){const Re=3*$,We=4*$;Ce[Re]=je[We],Ce[Re+1]=je[We+1],Ce[Re+2]=je[We+2]}je=Ce,U=2,ke=3,me=3*de}ae.img=je,ae.bpl=me,ae.bpp=ke}return{ctype:U,depth:H,plte:Y,frames:q}}function l(b,f,_,N,C,A,S){const L=Uint8Array,x=Uint32Array,g=new L(b[C-1]),G=new x(b[C-1]),U=C+1<b.length?new L(b[C+1]):null,H=new L(b[C]),oe=new x(H.buffer);let D=f,O=_,$=-1,R=-1;for(let K=0;K<A.height;K++)for(let Y=0;Y<A.width;Y++){const W=A.x+Y,te=A.y+K,ae=te*f+W,de=oe[ae];de==0||N[C-1].dispose==0&&G[ae]==de&&(U==null||U[4*ae+3]!=0)||(W<D&&(D=W),W>$&&($=W),te<O&&(O=te),te>R&&(R=te))}$==-1&&(D=O=$=R=0),S&&((1&D)==1&&D--,(1&O)==1&&O--),A={x:D,y:O,width:$-D+1,height:R-O+1};const q=N[C];q.rect=A,q.blend=1,q.img=new Uint8Array(A.width*A.height*4),N[C-1].dispose==0?(d(g,f,_,q.img,A.width,A.height,-A.x,-A.y,0),a(H,f,_,q.img,A)):d(H,f,_,q.img,A.width,A.height,-A.x,-A.y,0)}function a(b,f,_,N,C){d(b,f,_,N,C.width,C.height,-C.x,-C.y,2)}function h(b,f,_,N,C,A,S){const L=[];let x,g=[0,1,2,3,4];A!=-1?g=[A]:(f*N>5e5||_==1)&&(g=[0]),S&&(x={level:0});const G=Cn;for(var U=0;U<g.length;U++){for(let D=0;D<f;D++)m(C,b,D,N,_,g[U]);L.push(G.deflate(C,x))}let H,oe=1e9;for(U=0;U<L.length;U++)L[U].length<oe&&(H=U,oe=L[U].length);return L[H]}function m(b,f,_,N,C,A){const S=_*N;let L=S+_;if(b[L]=A,L++,A==0)if(N<500)for(var x=0;x<N;x++)b[L+x]=f[S+x];else b.set(new Uint8Array(f.buffer,S,N),L);else if(A==1){for(x=0;x<C;x++)b[L+x]=f[S+x];for(x=C;x<N;x++)b[L+x]=f[S+x]-f[S+x-C]+256&255}else if(_==0){for(x=0;x<C;x++)b[L+x]=f[S+x];if(A==2)for(x=C;x<N;x++)b[L+x]=f[S+x];if(A==3)for(x=C;x<N;x++)b[L+x]=f[S+x]-(f[S+x-C]>>1)+256&255;if(A==4)for(x=C;x<N;x++)b[L+x]=f[S+x]-r(f[S+x-C],0,0)+256&255}else{if(A==2)for(x=0;x<N;x++)b[L+x]=f[S+x]+256-f[S+x-N]&255;if(A==3){for(x=0;x<C;x++)b[L+x]=f[S+x]+256-(f[S+x-N]>>1)&255;for(x=C;x<N;x++)b[L+x]=f[S+x]+256-(f[S+x-N]+f[S+x-C]>>1)&255}if(A==4){for(x=0;x<C;x++)b[L+x]=f[S+x]+256-r(0,f[S+x-N],0)&255;for(x=C;x<N;x++)b[L+x]=f[S+x]+256-r(f[S+x-C],f[S+x-N],f[S+x-C-N])&255}}}function k(b,f){const _=new Uint8Array(b),N=_.slice(0),C=new Uint32Array(N.buffer),A=E(N,f),S=A[0],L=A[1],x=_.length,g=new Uint8Array(x>>2);let G;if(_.length<2e7)for(var U=0;U<x;U+=4)G=y(S,H=_[U]*(1/255),oe=_[U+1]*(1/255),D=_[U+2]*(1/255),O=_[U+3]*(1/255)),g[U>>2]=G.ind,C[U>>2]=G.est.rgba;else for(U=0;U<x;U+=4){var H=_[U]*.00392156862745098,oe=_[U+1]*(1/255),D=_[U+2]*(1/255),O=_[U+3]*(1/255);for(G=S;G.left;)G=I(G.est,H,oe,D,O)<=0?G.left:G.right;g[U>>2]=G.ind,C[U>>2]=G.est.rgba}return{abuf:N.buffer,inds:g,plte:L}}function E(b,f,_){_==null&&(_=1e-4);const N=new Uint32Array(b.buffer),C={i0:0,i1:b.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=T(b,C.i0,C.i1),C.est=v(C.bst);const A=[C];for(;A.length<f;){let L=0,x=0;for(var S=0;S<A.length;S++)A[S].est.L>L&&(L=A[S].est.L,x=S);if(L<_)break;const g=A[x],G=F(b,N,g.i0,g.i1,g.est.e,g.est.eMq255);if(g.i0>=G||g.i1<=G){g.est.L=0;continue}const U={i0:g.i0,i1:G,bst:null,est:null,tdst:0,left:null,right:null};U.bst=T(b,U.i0,U.i1),U.est=v(U.bst);const H={i0:G,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null};for(H.bst={R:[],m:[],N:g.bst.N-U.bst.N},S=0;S<16;S++)H.bst.R[S]=g.bst.R[S]-U.bst.R[S];for(S=0;S<4;S++)H.bst.m[S]=g.bst.m[S]-U.bst.m[S];H.est=v(H.bst),g.left=U,g.right=H,A[x]=U,A.push(H)}for(A.sort(((L,x)=>x.bst.N-L.bst.N)),S=0;S<A.length;S++)A[S].ind=S;return[C,A]}function y(b,f,_,N,C){if(b.left==null)return b.tdst=(function(U,H,oe,D,O){const $=H-U[0],R=oe-U[1],q=D-U[2],K=O-U[3];return $*$+R*R+q*q+K*K})(b.est.q,f,_,N,C),b;const A=I(b.est,f,_,N,C);let S=b.left,L=b.right;A>0&&(S=b.right,L=b.left);const x=y(S,f,_,N,C);if(x.tdst<=A*A)return x;const g=y(L,f,_,N,C);return g.tdst<x.tdst?g:x}function I(b,f,_,N,C){const{e:A}=b;return A[0]*f+A[1]*_+A[2]*N+A[3]*C-b.eMq}function F(b,f,_,N,C,A){for(N-=4;_<N;){for(;M(b,_,C)<=A;)_+=4;for(;M(b,N,C)>A;)N-=4;if(_>=N)break;const S=f[_>>2];f[_>>2]=f[N>>2],f[N>>2]=S,_+=4,N-=4}for(;M(b,_,C)>A;)_-=4;return _+4}function M(b,f,_){return b[f]*_[0]+b[f+1]*_[1]+b[f+2]*_[2]+b[f+3]*_[3]}function T(b,f,_){const N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],A=_-f>>2;for(let S=f;S<_;S+=4){const L=b[S]*.00392156862745098,x=b[S+1]*(1/255),g=b[S+2]*(1/255),G=b[S+3]*(1/255);C[0]+=L,C[1]+=x,C[2]+=g,C[3]+=G,N[0]+=L*L,N[1]+=L*x,N[2]+=L*g,N[3]+=L*G,N[5]+=x*x,N[6]+=x*g,N[7]+=x*G,N[10]+=g*g,N[11]+=g*G,N[15]+=G*G}return N[4]=N[1],N[8]=N[2],N[9]=N[6],N[12]=N[3],N[13]=N[7],N[14]=N[11],{R:N,m:C,N:A}}function v(b){const{R:f}=b,{m:_}=b,{N}=b,C=_[0],A=_[1],S=_[2],L=_[3],x=N==0?0:1/N,g=[f[0]-C*C*x,f[1]-C*A*x,f[2]-C*S*x,f[3]-C*L*x,f[4]-A*C*x,f[5]-A*A*x,f[6]-A*S*x,f[7]-A*L*x,f[8]-S*C*x,f[9]-S*A*x,f[10]-S*S*x,f[11]-S*L*x,f[12]-L*C*x,f[13]-L*A*x,f[14]-L*S*x,f[15]-L*L*x],G=g,U=P;let H=[Math.random(),Math.random(),Math.random(),Math.random()],oe=0,D=0;if(N!=0)for(let $=0;$<16&&(H=U.multVec(G,H),D=Math.sqrt(U.dot(H,H)),H=U.sml(1/D,H),!($!=0&&Math.abs(D-oe)<1e-9));$++)oe=D;const O=[C*x,A*x,S*x,L*x];return{Cov:g,q:O,e:H,L:oe,eMq255:U.dot(U.sml(255,O),H),eMq:U.dot(H,O),rgba:(Math.round(255*O[3])<<24|Math.round(255*O[2])<<16|Math.round(255*O[1])<<8|Math.round(255*O[0])<<0)>>>0}}var P={multVec:(b,f)=>[b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]*f[3],b[4]*f[0]+b[5]*f[1]+b[6]*f[2]+b[7]*f[3],b[8]*f[0]+b[9]*f[1]+b[10]*f[2]+b[11]*f[3],b[12]*f[0]+b[13]*f[1]+b[14]*f[2]+b[15]*f[3]],dot:(b,f)=>b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]*f[3],sml:(b,f)=>[b*f[0],b*f[1],b*f[2],b*f[3]]};nt.encode=function(f,_,N,C,A,S,L){C==null&&(C=0),L==null&&(L=!1);const x=o(f,_,N,C,[!1,!1,!1,0,L,!1]);return p(x,-1),w(x,_,N,A,S)},nt.encodeLL=function(f,_,N,C,A,S,L,x){const g={ctype:0+(C==1?0:2)+(A==0?0:4),depth:S,frames:[]},G=(C+A)*S,U=G*_;for(let H=0;H<f.length;H++)g.frames.push({rect:{x:0,y:0,width:_,height:N},img:new Uint8Array(f[H]),blend:0,dispose:1,bpp:Math.ceil(G/8),bpl:Math.ceil(U/8)});return p(g,0,!0),w(g,_,N,L,x)},nt.encode.compress=o,nt.encode.dither=c,nt.quantize=k,nt.quantize.getKDtree=E,nt.quantize.getNearest=y})();const zr={toArrayBuffer(d,u){const r=d.width,n=d.height,t=r<<2,e=d.getContext("2d").getImageData(0,0,r,n),i=new Uint32Array(e.data.buffer),c=(32*r+31)/32<<2,w=c*n,p=122+w,o=new ArrayBuffer(p),l=new DataView(o),a=1<<20;let h,m,k,E,y=a,I=0,F=0,M=0;function T(b){l.setUint16(F,b,!0),F+=2}function v(b){l.setUint32(F,b,!0),F+=4}function P(b){F+=b}T(19778),v(p),P(4),v(122),v(108),v(r),v(-n>>>0),T(1),T(32),v(3),v(w),v(2835),v(2835),P(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),(function b(){for(;I<n&&y>0;){for(E=122+I*c,h=0;h<t;)y--,m=i[M++],k=m>>>24,l.setUint32(E+h,m<<8|k),h+=4;I++}M<i.length?(y=a,setTimeout(b,zr._dly)):u(o)})()},toBlob(d,u){this.toArrayBuffer(d,(r=>{u(new Blob([r],{type:"image/bmp"}))}))},_dly:9};var Ye={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Nn={[Ye.CHROME]:16384,[Ye.FIREFOX]:11180,[Ye.DESKTOP_SAFARI]:16384,[Ye.IE]:8192,[Ye.IOS]:4096,[Ye.ETC]:8192};const nr=typeof window<"u",$r=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ut=nr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),En=(nr||$r)&&(Ut&&Ut.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Or=(nr||$r)&&(Ut&&Ut.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function sr(d,u,r=Date.now()){return new Promise((n=>{const t=d.split(","),e=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]);let c=i.length;const w=new Uint8Array(c);for(;c--;)w[c]=i.charCodeAt(c);const p=new Blob([w],{type:e});p.name=u,p.lastModified=r,n(p)}))}function Wr(d){return new Promise(((u,r)=>{const n=new Or;n.onload=()=>u(n.result),n.onerror=t=>r(t),n.readAsDataURL(d)}))}function Br(d){return new Promise(((u,r)=>{const n=new Image;n.onload=()=>u(n),n.onerror=t=>r(t),n.src=d}))}function gt(){if(gt.cachedResult!==void 0)return gt.cachedResult;let d=Ye.ETC;const{userAgent:u}=navigator;return/Chrom(e|ium)/i.test(u)?d=Ye.CHROME:/iP(ad|od|hone)/i.test(u)&&/WebKit/i.test(u)?d=Ye.IOS:/Safari/i.test(u)?d=Ye.DESKTOP_SAFARI:/Firefox/i.test(u)?d=Ye.FIREFOX:(/MSIE/i.test(u)||document.documentMode)&&(d=Ye.IE),gt.cachedResult=d,gt.cachedResult}function Gr(d,u){const r=gt(),n=Nn[r];let t=d,e=u,i=t*e;const c=t>e?e/t:t/e;for(;i>n*n;){const w=(n+t)/2,p=(n+e)/2;w<p?(e=p,t=p*c):(e=w*c,t=w),i=t*e}return{width:t,height:e}}function Ft(d,u){let r,n;try{if(r=new OffscreenCanvas(d,u),n=r.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),n=r.getContext("2d")}return r.width=d,r.height=u,[r,n]}function Hr(d,u){const{width:r,height:n}=Gr(d.width,d.height),[t,e]=Ft(r,n);return u&&/jpe?g/.test(u)&&(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)),e.drawImage(d,0,0,t.width,t.height),t}function Tt(){return Tt.cachedResult!==void 0||(Tt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Tt.cachedResult}function Pt(d,u={}){return new Promise((function(r,n){let t,e;var i=function(){try{return e=Hr(t,u.fileType||d.type),r([t,e])}catch(w){return n(w)}},c=function(w){try{var p=function(o){try{throw o}catch(l){return n(l)}};try{let o;return Wr(d).then((function(l){try{return o=l,Br(o).then((function(a){try{return t=a,(function(){try{return i()}catch(h){return n(h)}})()}catch(h){return p(h)}}),p)}catch(a){return p(a)}}),p)}catch(o){p(o)}}catch(o){return n(o)}};try{if(Tt()||[Ye.DESKTOP_SAFARI,Ye.MOBILE_SAFARI].includes(gt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(d).then((function(w){try{return t=w,i()}catch{return c()}}),c)}catch{c()}}))}function It(d,u,r,n,t=1){return new Promise((function(e,i){let c;if(u==="image/png"){let p,o,l;return p=d.getContext("2d"),{data:o}=p.getImageData(0,0,d.width,d.height),l=nt.encode([o.buffer],d.width,d.height,4096*t),c=new Blob([l],{type:u}),c.name=r,c.lastModified=n,w.call(this)}{let p=function(){return w.call(this)};if(u==="image/bmp")return new Promise((o=>zr.toBlob(d,o))).then((function(o){try{return c=o,c.name=r,c.lastModified=n,p.call(this)}catch(l){return i(l)}}).bind(this),i);{let o=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&d instanceof OffscreenCanvas)return d.convertToBlob({type:u,quality:t}).then((function(l){try{return c=l,c.name=r,c.lastModified=n,o.call(this)}catch(a){return i(a)}}).bind(this),i);{let l;return l=d.toDataURL(u,t),sr(l,r,n).then((function(a){try{return c=a,o.call(this)}catch(h){return i(h)}}).bind(this),i)}}}function w(){return e(c)}}))}function at(d){d.width=0,d.height=0}function bt(){return new Promise((function(d,u){let r,n,t,e;return bt.cachedResult!==void 0?d(bt.cachedResult):sr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(i){try{return r=i,Pt(r).then((function(c){try{return n=c[1],It(n,r.type,r.name,r.lastModified).then((function(w){try{return t=w,at(n),Pt(t).then((function(p){try{return e=p[0],bt.cachedResult=e.width===1&&e.height===2,d(bt.cachedResult)}catch(o){return u(o)}}),u)}catch(p){return u(p)}}),u)}catch(w){return u(w)}}),u)}catch(c){return u(c)}}),u)}))}function qr(d){return new Promise(((u,r)=>{const n=new Or;n.onload=t=>{const e=new DataView(t.target.result);if(e.getUint16(0,!1)!=65496)return u(-2);const i=e.byteLength;let c=2;for(;c<i;){if(e.getUint16(c+2,!1)<=8)return u(-1);const w=e.getUint16(c,!1);if(c+=2,w==65505){if(e.getUint32(c+=2,!1)!=1165519206)return u(-1);const p=e.getUint16(c+=6,!1)==18761;c+=e.getUint32(c+4,p);const o=e.getUint16(c,p);c+=2;for(let l=0;l<o;l++)if(e.getUint16(c+12*l,p)==274)return u(e.getUint16(c+12*l+8,p))}else{if((65280&w)!=65280)break;c+=e.getUint16(c,!1)}}return u(-1)},n.onerror=t=>r(t),n.readAsArrayBuffer(d)}))}function Vr(d,u){const{width:r}=d,{height:n}=d,{maxWidthOrHeight:t}=u;let e,i=d;return isFinite(t)&&(r>t||n>t)&&([i,e]=Ft(r,n),r>n?(i.width=t,i.height=n/r*t):(i.width=r/n*t,i.height=t),e.drawImage(d,0,0,i.width,i.height),at(d)),i}function Yr(d,u){const{width:r}=d,{height:n}=d,[t,e]=Ft(r,n);switch(u>4&&u<9?(t.width=n,t.height=r):(t.width=r,t.height=n),u){case 2:e.transform(-1,0,0,1,r,0);break;case 3:e.transform(-1,0,0,-1,r,n);break;case 4:e.transform(1,0,0,-1,0,n);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,n,0);break;case 7:e.transform(0,-1,-1,0,n,r);break;case 8:e.transform(0,-1,1,0,0,r)}return e.drawImage(d,0,0,r,n),at(d),t}function vr(d,u,r=0){return new Promise((function(n,t){let e,i,c,w,p,o,l,a,h,m,k,E,y,I,F,M,T,v,P,b;function f(N=5){if(u.signal&&u.signal.aborted)throw u.signal.reason;e+=N,u.onProgress(Math.min(e,100))}function _(N){if(u.signal&&u.signal.aborted)throw u.signal.reason;e=Math.min(Math.max(N,e),100),u.onProgress(e)}return e=r,i=u.maxIteration||10,c=1024*u.maxSizeMB*1024,f(),Pt(d,u).then((function(N){try{return[,w]=N,f(),p=Vr(w,u),f(),new Promise((function(C,A){var S;if(!(S=u.exifOrientation))return qr(d).then((function(x){try{return S=x,L.call(this)}catch(g){return A(g)}}).bind(this),A);function L(){return C(S)}return L.call(this)})).then((function(C){try{return o=C,f(),bt().then((function(A){try{return l=A?p:Yr(p,o),f(),a=u.initialQuality||1,h=u.fileType||d.type,It(l,h,d.name,d.lastModified,a).then((function(S){try{{let x=function(){if(i--&&(F>c||F>y)){let G,U;return G=b?.95*P.width:P.width,U=b?.95*P.height:P.height,[T,v]=Ft(G,U),v.drawImage(P,0,0,G,U),a*=h==="image/png"?.85:.95,It(T,h,d.name,d.lastModified,a).then((function(H){try{return M=H,at(P),P=T,F=M.size,_(Math.min(99,Math.floor((I-F)/(I-c)*100))),x}catch(oe){return t(oe)}}),t)}return[1]},g=function(){return at(P),at(T),at(p),at(l),at(w),_(100),n(M)};if(m=S,f(),k=m.size>c,E=m.size>d.size,!k&&!E)return _(100),n(m);var L;return y=d.size,I=m.size,F=I,P=l,b=!u.alwaysKeepResolution&&k,(L=(function(G){for(;G;){if(G.then)return void G.then(L,t);try{if(G.pop){if(G.length)return G.pop()?g.call(this):G;G=x}else G=G.call(this)}catch(U){return t(U)}}}).bind(this))(x)}}catch(x){return t(x)}}).bind(this),t)}catch(S){return t(S)}}).bind(this),t)}catch(A){return t(A)}}).bind(this),t)}catch(C){return t(C)}}).bind(this),t)}))}const An=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Vt;function Ln(d,u){return new Promise(((r,n)=>{Vt||(Vt=(function(i){const c=[];return c.push(i),URL.createObjectURL(new Blob(c))})(An));const t=new Worker(Vt);t.addEventListener("message",(function(i){if(u.signal&&u.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return n(new Error(i.data.error)),void t.terminate();r(i.data.file),t.terminate()}else u.onProgress(i.data.progress)})),t.addEventListener("error",n),u.signal&&u.signal.addEventListener("abort",(()=>{n(u.signal.reason),t.terminate()})),t.postMessage({file:d,imageCompressionLibUrl:u.libURL,options:{...u,onProgress:void 0,signal:void 0}})}))}function He(d,u){return new Promise((function(r,n){let t,e,i,c,w,p;if(t={...u},i=0,{onProgress:c}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,w=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=h=>{i=h,typeof c=="function"&&c(i)},!(d instanceof Blob||d instanceof En))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(d.type))return n(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!w||typeof Worker!="function"||p)return vr(d,t).then((function(h){try{return e=h,a.call(this)}catch(m){return n(m)}}).bind(this),n);var o=(function(){try{return a.call(this)}catch(h){return n(h)}}).bind(this),l=function(h){try{return vr(d,t).then((function(m){try{return e=m,o()}catch(k){return n(k)}}),n)}catch(m){return n(m)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ln(d,t).then((function(h){try{return e=h,o()}catch{return l()}}),l)}catch{l()}function a(){try{e.name=d.name,e.lastModified=d.lastModified}catch{}try{t.preserveExif&&d.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===d.type)&&(e=Fr(d,e))}catch{}return r(e)}}))}He.getDataUrlFromFile=Wr,He.getFilefromDataUrl=sr,He.loadImage=Br,He.drawImageInCanvas=Hr,He.drawFileInCanvas=Pt,He.canvasToFile=It,He.getExifOrientation=qr,He.handleMaxWidthOrHeight=Vr,He.followExifOrientation=Yr,He.cleanupCanvasMemory=at,He.isAutoOrientationInBrowser=bt,He.approximateBelowMaximumCanvasSizeOfBrowser=Gr,He.copyExifWithoutOrientation=Fr,He.getBrowserName=gt,He.version="2.0.2";var rr=function(d,u){return rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])},rr(d,u)};function Rn(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");rr(d,u);function r(){this.constructor=d}d.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}var Oe=function(){return Oe=Object.assign||function(u){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e])}return u},Oe.apply(this,arguments)};var Yt,yr;function Mn(){if(yr)return Yt;yr=1;var d=!1,u,r,n,t,e,i,c,w,p,o,l,a,h,m,k;function E(){if(!d){d=!0;var I=navigator.userAgent,F=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(I),M=/(Mac OS X)|(Windows)|(Linux)/.exec(I);if(a=/\b(iPhone|iP[ao]d)/.exec(I),h=/\b(iP[ao]d)/.exec(I),o=/Android/i.exec(I),m=/FBAN\/\w+;/i.exec(I),k=/Mobile/i.exec(I),l=!!/Win64/.exec(I),F){u=F[1]?parseFloat(F[1]):F[5]?parseFloat(F[5]):NaN,u&&document&&document.documentMode&&(u=document.documentMode);var T=/(?:Trident\/(\d+.\d+))/.exec(I);i=T?parseFloat(T[1])+4:u,r=F[2]?parseFloat(F[2]):NaN,n=F[3]?parseFloat(F[3]):NaN,t=F[4]?parseFloat(F[4]):NaN,t?(F=/(?:Chrome\/(\d+\.\d+))/.exec(I),e=F&&F[1]?parseFloat(F[1]):NaN):e=NaN}else u=r=n=e=t=NaN;if(M){if(M[1]){var v=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(I);c=v?parseFloat(v[1].replace("_",".")):!0}else c=!1;w=!!M[2],p=!!M[3]}else c=w=p=!1}}var y={ie:function(){return E()||u},ieCompatibilityMode:function(){return E()||i>u},ie64:function(){return y.ie()&&l},firefox:function(){return E()||r},opera:function(){return E()||n},webkit:function(){return E()||t},safari:function(){return y.webkit()},chrome:function(){return E()||e},windows:function(){return E()||w},osx:function(){return E()||c},linux:function(){return E()||p},iphone:function(){return E()||a},mobile:function(){return E()||a||h||o||k},nativeApp:function(){return E()||m},android:function(){return E()||o},ipad:function(){return E()||h}};return Yt=y,Yt}var Kt,_r;function Tn(){if(_r)return Kt;_r=1;var d=!!(typeof window<"u"&&window.document&&window.document.createElement),u={canUseDOM:d,canUseWorkers:typeof Worker<"u",canUseEventListeners:d&&!!(window.addEventListener||window.attachEvent),canUseViewport:d&&!!window.screen,isInWorker:!d};return Kt=u,Kt}var Zt,jr;function Dn(){if(jr)return Zt;jr=1;var d=Tn(),u;d.canUseDOM&&(u=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function r(n,t){if(!d.canUseDOM||t&&!("addEventListener"in document))return!1;var e="on"+n,i=e in document;if(!i){var c=document.createElement("div");c.setAttribute(e,"return;"),i=typeof c[e]=="function"}return!i&&u&&n==="wheel"&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i}return Zt=r,Zt}var Jt,kr;function Un(){if(kr)return Jt;kr=1;var d=Mn(),u=Dn(),r=10,n=40,t=800;function e(i){var c=0,w=0,p=0,o=0;return"detail"in i&&(w=i.detail),"wheelDelta"in i&&(w=-i.wheelDelta/120),"wheelDeltaY"in i&&(w=-i.wheelDeltaY/120),"wheelDeltaX"in i&&(c=-i.wheelDeltaX/120),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(c=w,w=0),p=c*r,o=w*r,"deltaY"in i&&(o=i.deltaY),"deltaX"in i&&(p=i.deltaX),(p||o)&&i.deltaMode&&(i.deltaMode==1?(p*=n,o*=n):(p*=t,o*=t)),p&&!c&&(c=p<1?-1:1),o&&!w&&(w=o<1?-1:1),{spinX:c,spinY:w,pixelX:p,pixelY:o}}return e.getEventType=function(){return d.firefox()?"DOMMouseScroll":u("wheel")?"wheel":"mousewheel"},Jt=e,Jt}var Qt,Sr;function Pn(){return Sr||(Sr=1,Qt=Un()),Qt}var In=Pn();const Fn=hn(In);function zn(d,u,r,n,t,e){e===void 0&&(e=0);var i=vt(d,u,e),c=i.width,w=i.height,p=Math.min(c,r),o=Math.min(w,n);return p>o*t?{width:o*t,height:o}:{width:p,height:p/t}}function $n(d){return d.width>d.height?d.width/d.naturalWidth:d.height/d.naturalHeight}function St(d,u,r,n,t){t===void 0&&(t=0);var e=vt(u.width,u.height,t),i=e.width,c=e.height;return{x:Cr(d.x,i,r.width,n),y:Cr(d.y,c,r.height,n)}}function Cr(d,u,r,n){var t=u*n/2-r/2;return zt(d,-t,t)}function Nr(d,u){return Math.sqrt(Math.pow(d.y-u.y,2)+Math.pow(d.x-u.x,2))}function Er(d,u){return Math.atan2(u.y-d.y,u.x-d.x)*180/Math.PI}function On(d,u,r,n,t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);var c=i?Wn:Bn,w=vt(u.width,u.height,e),p=vt(u.naturalWidth,u.naturalHeight,e),o={x:c(100,((w.width-r.width/t)/2-d.x/t)/w.width*100),y:c(100,((w.height-r.height/t)/2-d.y/t)/w.height*100),width:c(100,r.width/w.width*100/t),height:c(100,r.height/w.height*100/t)},l=Math.round(c(p.width,o.width*p.width/100)),a=Math.round(c(p.height,o.height*p.height/100)),h=p.width>=p.height*n,m=h?{width:Math.round(a*n),height:a}:{width:l,height:Math.round(l/n)},k=Oe(Oe({},m),{x:Math.round(c(p.width-m.width,o.x*p.width/100)),y:Math.round(c(p.height-m.height,o.y*p.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:k}}function Wn(d,u){return Math.min(d,Math.max(0,u))}function Bn(d,u){return u}function Gn(d,u,r,n,t,e){var i=vt(u.width,u.height,r),c=zt(n.width/i.width*(100/d.width),t,e),w={x:c*i.width/2-n.width/2-i.width*c*(d.x/100),y:c*i.height/2-n.height/2-i.height*c*(d.y/100)};return{crop:w,zoom:c}}function Hn(d,u,r){var n=$n(u);return r.height>r.width?r.height/(d.height*n):r.width/(d.width*n)}function qn(d,u,r,n,t,e){r===void 0&&(r=0);var i=vt(u.naturalWidth,u.naturalHeight,r),c=zt(Hn(d,u,n),t,e),w=n.height>n.width?n.height/d.height:n.width/d.width,p={x:((i.width-d.width)/2-d.x)*w,y:((i.height-d.height)/2-d.y)*w};return{crop:p,zoom:c}}function Ar(d,u){return{x:(u.x+d.x)/2,y:(u.y+d.y)/2}}function Vn(d){return d*Math.PI/180}function vt(d,u,r){var n=Vn(r);return{width:Math.abs(Math.cos(n)*d)+Math.abs(Math.sin(n)*u),height:Math.abs(Math.sin(n)*d)+Math.abs(Math.cos(n)*u)}}function zt(d,u,r){return Math.min(Math.max(d,u),r)}function Rt(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return d.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var Yn=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Kn=1,Zn=3,Jn=1,Qn=(function(d){Rn(u,d);function u(){var r=d!==null&&d.apply(this,arguments)||this;return r.cropperRef=z.createRef(),r.imageRef=z.createRef(),r.videoRef=z.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var n=!0;r.resizeObserver=new window.ResizeObserver(function(t){if(n){n=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(n){return n.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var n=r.computeSizes();n&&(r.previousCropSize=n,r.emitCropData(),r.setInitialCrop(n),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(n){if(r.props.initialCroppedAreaPercentages){var t=Gn(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=t.crop,i=t.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}else if(r.props.initialCroppedAreaPixels){var c=qn(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),e=c.crop,i=c.zoom;r.props.onCropChange(e),r.props.onZoomChange&&r.props.onZoomChange(i)}},r.computeSizes=function(){var n,t,e,i,c,w,p=r.imageRef.current||r.videoRef.current;if(p&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var o=r.containerRect.width/r.containerRect.height,l=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((t=r.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,a=((e=r.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((i=r.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,h=p.offsetWidth<l||p.offsetHeight<a,m=l/a,k=void 0;if(h)switch(r.state.mediaObjectFit){default:case"contain":k=o>m?{width:r.containerRect.height*m,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/m};break;case"horizontal-cover":k={width:r.containerRect.width,height:r.containerRect.width/m};break;case"vertical-cover":k={width:r.containerRect.height*m,height:r.containerRect.height};break}else k={width:p.offsetWidth,height:p.offsetHeight};r.mediaSize=Oe(Oe({},k),{naturalWidth:l,naturalHeight:a}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var E=r.props.cropSize?r.props.cropSize:zn(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((c=r.state.cropSize)===null||c===void 0?void 0:c.height)!==E.height||((w=r.state.cropSize)===null||w===void 0?void 0:w.width)!==E.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(E),r.setState({cropSize:E},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(E),E}},r.saveContainerPosition=function(){if(r.containerRef){var n=r.containerRef.getBoundingClientRect();r.containerPosition={x:n.left,y:n.top}}},r.onMouseDown=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(u.getMousePoint(n)))},r.onMouseMove=function(n){return r.onDrag(u.getMousePoint(n))},r.onScroll=function(n){r.currentDoc&&(n.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(n){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(n))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),n.touches.length===2?r.onPinchStart(n):n.touches.length===1&&r.onDragStart(u.getTouchPoint(n.touches[0]))))},r.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?r.onPinchMove(n):n.touches.length===1&&r.onDrag(u.getTouchPoint(n.touches[0]))},r.onGestureStart=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(n){if(n.preventDefault(),!r.isTouching){var t=u.getMousePoint(n),e=r.gestureZoomStart-1+n.scale;if(r.setNewZoom(e,t,{shouldUpdatePosition:!0}),r.props.onRotationChange){var i=r.gestureRotationStart+n.rotation;r.props.onRotationChange(i)}}},r.onGestureEnd=function(n){r.cleanEvents()},r.onDragStart=function(n){var t,e,i=n.x,c=n.y;r.dragStartPosition={x:i,y:c},r.dragStartCrop=Oe({},r.props.crop),(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t)},r.onDrag=function(n){var t=n.x,e=n.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(t===void 0||e===void 0)){var i=t-r.dragStartPosition.x,c=e-r.dragStartPosition.y,w={x:r.dragStartCrop.x+i,y:r.dragStartCrop.y+c},p=r.props.restrictPosition?St(w,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):w;r.props.onCropChange(p)}}))},r.onDragStopped=function(){var n,t;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(t=(n=r.props).onInteractionEnd)===null||t===void 0||t.call(n)},r.onWheel=function(n){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(n))){n.preventDefault();var t=u.getMousePoint(n),e=Fn(n).pixelY,i=r.props.zoom-e*r.props.zoomSpeed/200;r.setNewZoom(i,t,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var c,w;return(w=(c=r.props).onInteractionStart)===null||w===void 0?void 0:w.call(c)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var c,w;return(w=(c=r.props).onInteractionEnd)===null||w===void 0?void 0:w.call(c)})},250)}},r.getPointOnContainer=function(n,t){var e=n.x,i=n.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(e-t.x),y:r.containerRect.height/2-(i-t.y)}},r.getPointOnMedia=function(n){var t=n.x,e=n.y,i=r.props,c=i.crop,w=i.zoom;return{x:(t+c.x)/w,y:(e+c.y)/w}},r.setNewZoom=function(n,t,e){var i=e===void 0?{}:e,c=i.shouldUpdatePosition,w=c===void 0?!0:c;if(!(!r.state.cropSize||!r.props.onZoomChange)){var p=zt(n,r.props.minZoom,r.props.maxZoom);if(w){var o=r.getPointOnContainer(t,r.containerPosition),l=r.getPointOnMedia(o),a={x:l.x*p-o.x,y:l.y*p-o.y},h=r.props.restrictPosition?St(a,r.mediaSize,r.state.cropSize,p,r.props.rotation):a;r.props.onCropChange(h)}r.props.onZoomChange(p)}},r.getCropData=function(){if(!r.state.cropSize)return null;var n=r.props.restrictPosition?St(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return On(n,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,e),r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.emitCropAreaChange=function(){var n=r.getCropData();if(n){var t=n.croppedAreaPercentages,e=n.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(t,e)}},r.recomputeCropPosition=function(){var n,t;if(r.state.cropSize){var e=r.props.crop;if(r.isInitialized&&(!((n=r.previousCropSize)===null||n===void 0)&&n.width)&&(!((t=r.previousCropSize)===null||t===void 0)&&t.height)){var i=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(i){var c=r.state.cropSize.width/r.previousCropSize.width,w=r.state.cropSize.height/r.previousCropSize.height;e={x:r.props.crop.x*c,y:r.props.crop.y*w}}}var p=r.props.restrictPosition?St(e,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):e;r.previousCropSize=r.state.cropSize,r.props.onCropChange(p),r.emitCropData()}},r.onKeyDown=function(n){var t,e,i=r.props,c=i.crop,w=i.onCropChange,p=i.keyboardStep,o=i.zoom,l=i.rotation,a=p;if(r.state.cropSize){n.shiftKey&&(a*=.2);var h=Oe({},c);switch(n.key){case"ArrowUp":h.y-=a,n.preventDefault();break;case"ArrowDown":h.y+=a,n.preventDefault();break;case"ArrowLeft":h.x-=a,n.preventDefault();break;case"ArrowRight":h.x+=a,n.preventDefault();break;default:return}r.props.restrictPosition&&(h=St(h,r.mediaSize,r.state.cropSize,o,l)),n.repeat||(e=(t=r.props).onInteractionStart)===null||e===void 0||e.call(t),w(h)}},r.onKeyUp=function(n){var t,e;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}r.emitCropData(),(e=(t=r.props).onInteractionEnd)===null||e===void 0||e.call(t)},r}return u.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Yn,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},u.prototype.componentWillUnmount=function(){var r,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},u.prototype.componentDidUpdate=function(r){var n,t,e,i,c,w,p,o,l;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((n=r.cropSize)===null||n===void 0?void 0:n.height)!==((t=this.props.cropSize)===null||t===void 0?void 0:t.height)||((e=r.cropSize)===null||e===void 0?void 0:e.width)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.width)?this.computeSizes():(((c=r.crop)===null||c===void 0?void 0:c.x)!==((w=this.props.crop)===null||w===void 0?void 0:w.x)||((p=r.crop)===null||p===void 0?void 0:p.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((l=this.videoRef.current)===null||l===void 0||l.load());var a=this.getObjectFit();a!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:a},this.computeSizes)},u.prototype.getAspect=function(){var r=this.props,n=r.cropSize,t=r.aspect;return n?n.width/n.height:t},u.prototype.getObjectFit=function(){var r,n,t,e;if(this.props.objectFit==="cover"){var i=this.imageRef.current||this.videoRef.current;if(i&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,w=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,p=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalHeight)||((e=this.videoRef.current)===null||e===void 0?void 0:e.videoHeight)||0,o=w/p;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},u.prototype.onPinchStart=function(r){var n=u.getTouchPoint(r.touches[0]),t=u.getTouchPoint(r.touches[1]);this.lastPinchDistance=Nr(n,t),this.lastPinchRotation=Er(n,t),this.onDragStart(Ar(n,t))},u.prototype.onPinchMove=function(r){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var t=u.getTouchPoint(r.touches[0]),e=u.getTouchPoint(r.touches[1]),i=Ar(t,e);this.onDrag(i),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=Nr(t,e),w=n.props.zoom*(c/n.lastPinchDistance);n.setNewZoom(w,i,{shouldUpdatePosition:!1}),n.lastPinchDistance=c;var p=Er(t,e),o=n.props.rotation+(p-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(o),n.lastPinchRotation=p})}},u.prototype.render=function(){var r=this,n,t=this.props,e=t.image,i=t.video,c=t.mediaProps,w=t.cropperProps,p=t.transform,o=t.crop,l=o.x,a=o.y,h=t.rotation,m=t.zoom,k=t.cropShape,E=t.showGrid,y=t.roundCropAreaPixels,I=t.style,F=I.containerStyle,M=I.cropAreaStyle,T=I.mediaStyle,v=t.classes,P=v.containerClassName,b=v.cropAreaClassName,f=v.mediaClassName,_=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return z.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(C){return r.containerRef=C},"data-testid":"container",style:F,className:Rt("reactEasyCrop_Container",P)},e?z.createElement("img",Oe({alt:"",className:Rt("reactEasyCrop_Image",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",f)},c,{src:e,ref:this.imageRef,style:Oe(Oe({},T),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(m,")")}),onLoad:this.onMediaLoad})):i&&z.createElement("video",Oe({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Rt("reactEasyCrop_Video",_==="contain"&&"reactEasyCrop_Contain",_==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",_==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",f)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:Oe(Oe({},T),{transform:p||"translate(".concat(l,"px, ").concat(a,"px) rotate(").concat(h,"deg) scale(").concat(m,")")}),controls:!1}),(Array.isArray(i)?i:[{src:i}]).map(function(N){return z.createElement("source",Oe({key:N.src},N))})),this.state.cropSize&&z.createElement("div",Oe({ref:this.cropperRef,style:Oe(Oe({},M),{width:y?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:y?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Rt("reactEasyCrop_CropArea",k==="round"&&"reactEasyCrop_CropAreaRound",E&&"reactEasyCrop_CropAreaGrid",b)},w)))},u.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:Zn,minZoom:Kn,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:Jn},u.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u})(z.Component);const Ge=[];for(let d=0;d<256;++d)Ge.push((d+256).toString(16).slice(1));function Xn(d,u=0){return(Ge[d[u+0]]+Ge[d[u+1]]+Ge[d[u+2]]+Ge[d[u+3]]+"-"+Ge[d[u+4]]+Ge[d[u+5]]+"-"+Ge[d[u+6]]+Ge[d[u+7]]+"-"+Ge[d[u+8]]+Ge[d[u+9]]+"-"+Ge[d[u+10]]+Ge[d[u+11]]+Ge[d[u+12]]+Ge[d[u+13]]+Ge[d[u+14]]+Ge[d[u+15]]).toLowerCase()}let Xt;const es=new Uint8Array(16);function ts(){if(!Xt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Xt=crypto.getRandomValues.bind(crypto)}return Xt(es)}const rs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Lr={randomUUID:rs};function ns(d,u,r){d=d||{};const n=d.random??d.rng?.()??ts();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Xn(n)}function ss(d,u,r){return Lr.randomUUID&&!d?Lr.randomUUID():ns(d)}const Rr=50,Mt=d=>{let u=null;if(d.reply_to){const r=Array.isArray(d.reply_to)?d.reply_to[0]:d.reply_to;d.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",d.reply_to_message_id,"reply_to:",d.reply_to,"replyToData:",r),r&&console.log("[normalizeMessage] replyToData.id:",r.id,"replyToData.user_id:",r.user_id,"replyToData.content:",r.content)),r&&r.id&&r.user_id?u={id:r.id,content:r.content||"",user_id:r.user_id,author_name:r.author_name}:d.reply_to_message_id&&r&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",r,"has id:",!!r?.id,"has user_id:",!!r?.user_id)}return{id:d.id,league_id:d.league_id,user_id:d.user_id,content:d.content,created_at:d.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:d.reply_to_message_id??null,reply_to:u}},Ct=d=>{const u=new Map;for(const r of d)u.set(r.id,r);return Array.from(u.values()).sort((r,n)=>new Date(r.created_at).getTime()-new Date(n.created_at).getTime())};function os(d,u={}){const{userId:r,enabled:n=!0,autoSubscribe:t=!0}=u,[e,i]=z.useState([]),[c,w]=z.useState(!1),[p,o]=z.useState(!1),[l,a]=z.useState(!0),[h,m]=z.useState(null),k=z.useRef(null),E=z.useCallback(v=>{i(P=>{const b=v(P);return k.current=b.length?b[0].created_at:null,b})},[]),y=z.useCallback(async({before:v,append:P})=>{if(!d||!n)return;console.log("[fetchPage] Starting fetch for league:",d,"append:",P,"before:",v);const b=le.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",d).order("created_at",{ascending:!1}).limit(Rr);v&&b.lt("created_at",v);const{data:f,error:_}=await b;if(_)throw _;console.log("[fetchPage] Fetched",f?.length||0,"messages from database");const N=(f??[]).filter(L=>L.reply_to_message_id),C=[...new Set(N.map(L=>L.reply_to_message_id))];console.log("[fetchPage] Found",N.length,"messages with reply_to_message_id, unique reply IDs:",C.length);let A=new Map;if(C.length>0){const{data:L,error:x}=await le.from("league_messages").select("id, content, user_id").in("id",C);!x&&L&&L.forEach(g=>{A.set(g.id,g)})}if(f&&f.length>0){const L=f.filter(x=>x.reply_to_message_id);L.length>0&&(console.log("[fetchPage] Found",L.length,"messages with reply_to_message_id"),L.slice(0,3).forEach(x=>{const g=A.get(x.reply_to_message_id);console.log("[fetchPage] Message",x.id,"reply_to_message_id:",x.reply_to_message_id,"replyData:",g)}))}const S=(f??[]).map(L=>{if(L.reply_to_message_id){const x=A.get(L.reply_to_message_id);x?L.reply_to=x:L.reply_to=null}else L.reply_to=null;return Mt(L)}).reverse();E(L=>Ct(P?[...S,...L]:S)),(f??[]).length<Rr?a(!1):P||a(!0)},[d,n,E]),I=z.useCallback(async()=>{if(!d||!n){i([]),a(!0);return}w(!0),m(null),k.current=null;try{await y({append:!1})}catch(v){m(v?.message??"Failed to load chat")}finally{w(!1)}},[d,n,y]);z.useEffect(()=>{if(!d||!n){i([]),a(!0);return}let v=!0;if(I(),!t)return()=>{v=!1};const P=le.channel(`league-messages:${d}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${d}`},async b=>{if(!v)return;const{data:f}=await le.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",b.new.id).single();if(f){if(f.reply_to_message_id){const{data:N}=await le.from("league_messages").select("id, content, user_id").eq("id",f.reply_to_message_id).single();N&&(f.reply_to=N)}const _=Mt(f);E(N=>N.some(C=>C.id===_.id)?N:Ct([...N,_]))}else{const _=Mt(b.new);E(N=>N.some(C=>C.id===_.id)?N:Ct([...N,_]))}}).subscribe();return()=>{v=!1,le.removeChannel(P)}},[d,n,t,I,E]);const F=z.useCallback(async()=>{if(!d||!n||!l||p)return;const v=k.current??e[0]?.created_at;if(v){o(!0);try{await y({before:v,append:!0})}catch(P){m(P?.message??"Failed to load more messages")}finally{o(!1)}}},[d,n,l,p,y,e]),M=z.useCallback(async(v,P)=>{if(!d||!r)throw new Error("Missing league or user");const b=v.trim();if(!b)return;const f=ss(),_=`optimistic-${f}`,N={id:_,client_msg_id:f,league_id:d,user_id:r,content:b,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:P??null};E(S=>Ct([...S,N]));const{data:C,error:A}=await le.from("league_messages").insert({league_id:d,user_id:r,content:b,reply_to_message_id:P??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(C&&C.reply_to_message_id){const{data:S}=await le.from("league_messages").select("id, content, user_id").eq("id",C.reply_to_message_id).single();S&&(C.reply_to=S)}if(A)throw E(S=>S.map(L=>L.id===_?{...L,status:"error"}:L)),A;if(C){const S=Mt(C);S.client_msg_id=f,E(L=>L.map(x=>x.id===_?{...S,status:"sent",client_msg_id:f}:x))}},[d,r,E]),T=z.useMemo(()=>e.slice(-5),[e]);return{messages:e,previewMessages:T,loading:c,loadingMore:p,hasMore:l,error:h,refresh:I,loadMore:F,sendMessage:M}}const as={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},is={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},ls=["","",""],cs=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function ds({author:d,text:u,time:r,isOwnMessage:n,shape:t="single",messageId:e,reactions:i=[],onReactionClick:c,replyTo:w,onMessageClick:p}){const o=n?"text-right":"text-left",l=n?"bg-[#1C8376] text-white":"bg-white text-slate-900",a=n?is:as,h="max-w-[80%]",[m,k]=z.useState(!1),[E,y]=z.useState(!1),I=z.useRef(null);z.useEffect(()=>{if(!m)return;const T=P=>{I.current&&!I.current.contains(P.target)&&k(!1)},v=setTimeout(()=>{document.addEventListener("mousedown",T)},100);return()=>{clearTimeout(v),document.removeEventListener("mousedown",T)}},[m]);const F=T=>{e&&c&&c(e,T),k(!1),y(!1)},M=T=>{const v=T.target;v.closest("button")||v.closest("[data-reaction]")||p&&p()};return s.jsxs("div",{className:`inline-block w-fit ${h} min-w-0 relative`,children:[s.jsxs("div",{className:`px-3 py-2 text-sm leading-snug shadow-sm whitespace-normal break-words ${o} ${l} ${a[t]} ${p?"cursor-pointer hover:opacity-90 transition-opacity":""}`,onClick:M,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[d&&!n&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:d}),w&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${n?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-sm`,style:{wordBreak:"break-word",overflowWrap:"break-word"},children:[s.jsx("div",{className:"font-medium text-xs mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:w.authorName||"Unknown"}),s.jsx("div",{className:"text-xs line-clamp-2 truncate break-words",style:{wordBreak:"break-word",overflowWrap:"break-word"},children:w.content})]}),s.jsx("div",{style:{wordBreak:"break-word",overflowWrap:"break-word"},children:u}),s.jsx("div",{className:"text-[11px] text-[#DCDCDD] mt-1",children:r})]}),e&&!n&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[m&&s.jsxs("div",{ref:I,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[ls.map(T=>s.jsx("button",{onClick:()=>F(T),className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-base",title:`React with ${T}`,children:T},T)),p&&s.jsx("button",{onClick:()=>{k(!1),p()},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{k(!1),y(!0)},className:"w-7 h-7 rounded-full hover:bg-slate-50 transition-colors flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>k(!m),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200 transition-colors flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),E&&e&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>y(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>y(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:cs.map(T=>s.jsx("button",{onClick:()=>{e&&c&&c(e,T),y(!1)},className:"w-10 h-10 rounded-lg hover:bg-slate-100 active:bg-slate-200 transition-colors flex items-center justify-center text-2xl",title:T,children:T},T))})]})})]}),i.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${n?"justify-end":"justify-start"}`,children:i.map(T=>s.jsxs("button",{onClick:()=>F(T.emoji),className:`px-2 py-0.5 rounded-full text-xs flex items-center gap-1 transition-colors ${T.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:[s.jsx("span",{children:T.emoji}),s.jsx("span",{children:T.count})]},T.emoji))})]})}function us({author:d,messages:u,isOwnMessage:r,avatarInitials:n,userId:t,reactions:e,onReactionClick:i,onMessageClick:c}){d==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",r,"messages:",u.length);const w=r?"justify-end":"justify-start",p=t===Pr;return s.jsxs("div",{className:`flex items-end gap-3 w-full ${w}`,children:[r?s.jsx("div",{className:"w-10 flex-shrink-0"}):p?s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:mn,alt:"Volley",className:"w-10 h-10 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-sm font-semibold text-slate-500 flex-shrink-0",children:(n||d.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:u.map((o,l)=>{const a=u.length===1?"single":l===0?"top":l===u.length-1?"bottom":"middle",h=o.messageId||o.id;let m="";if(typeof o.text=="string")m=o.text;else if(typeof o.text=="object"&&o.text!==null){const k=o.text?.props?.children||String(o.text);m=typeof k=="string"?k:String(k)}else m=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${r?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${r?"justify-end":"justify-start"}`,children:[s.jsx(ds,{author:!r&&l===0?d:void 0,text:o.text,time:o.time,isOwnMessage:r,shape:a,messageId:h,reactions:e?.[h]||[],onReactionClick:i,replyTo:o.replyTo,onMessageClick:c?()=>c(h,m,!r&&l===0?d:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function fs({groups:d,reactions:u,onReactionClick:r,onMessageClick:n}){const t=d.filter(e=>e.author==="Unknown");return t.length>0&&(console.error("[ChatThread] RENDERING with",t.length,'groups with "Unknown" author!'),t.forEach((e,i)=>{console.error(`[ChatThread] Group ${i}: id="${e.id}", author="${e.author}", messages=${e.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:d.map((e,i)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[e.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:e.dayLabel}),s.jsx(us,{author:e.author,avatarInitials:e.avatarInitials,isOwnMessage:e.isOwnMessage,userId:e.userId,messages:e.messages,reactions:u,onReactionClick:r,onMessageClick:n},`${e.id}-${e.author}-${i}`)]},`${e.id}-${e.author}-${i}`))})}const hs=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ms=d=>new Date(d).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Mr=d=>{if(!d)return"?";const u=d.trim().split(/\s+/);return u.length===1?u[0][0]?.toUpperCase()??"?":`${u[0][0]?.toUpperCase()??""}${u[u.length-1][0]?.toUpperCase()??""}`},wt=(d,u)=>u?u instanceof Map?u.get(d)??"":u[d]??"":"";function ps({miniLeagueId:d,memberNames:u}){const{user:r}=Ir(),{messages:n,loading:t,loadingMore:e,hasMore:i,error:c,loadMore:w,sendMessage:p}=os(d,{userId:r?.id,enabled:!!d}),[o,l]=z.useState(""),[a,h]=z.useState(!1),[m,k]=z.useState({}),[E,y]=z.useState(null),[I,F]=z.useState(0),M=z.useRef(null),T=z.useRef(null),v=z.useRef(null),[P,b]=z.useState(0),f=z.useCallback(()=>{M.current&&(M.current.scrollTop=M.current.scrollHeight)},[]),_=z.useCallback((D=[0,100,300,500,700])=>{requestAnimationFrame(()=>{D.forEach(O=>{setTimeout(()=>f(),O)})})},[f]);z.useEffect(()=>{if(n.length===0||!r?.id)return;const D=n.map($=>$.id);if(D.length===0)return;(async()=>{try{const{data:$,error:R}=await le.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",D);if(R){console.error("[MiniLeagueChatBeta] Error loading reactions:",R);return}const q={};($||[]).forEach(Y=>{q[Y.message_id]||(q[Y.message_id]={}),q[Y.message_id][Y.emoji]||(q[Y.message_id][Y.emoji]={count:0,hasUserReacted:!1}),q[Y.message_id][Y.emoji].count++,Y.user_id===r.id&&(q[Y.message_id][Y.emoji].hasUserReacted=!0)});const K={};Object.keys(q).forEach(Y=>{K[Y]=Object.entries(q[Y]).map(([W,te])=>({emoji:W,count:te.count,hasUserReacted:te.hasUserReacted}))}),k(K)}catch($){console.error("[MiniLeagueChatBeta] Error in loadReactions:",$)}})()},[n,r?.id]),z.useEffect(()=>{if(n.length===0||!r?.id)return;const D=n.map($=>$.id);if(D.length===0)return;const O=le.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},()=>{(async()=>{try{const{data:R,error:q}=await le.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",D);if(q)return;const K={};(R||[]).forEach(W=>{K[W.message_id]||(K[W.message_id]={}),K[W.message_id][W.emoji]||(K[W.message_id][W.emoji]={count:0,hasUserReacted:!1}),K[W.message_id][W.emoji].count++,W.user_id===r.id&&(K[W.message_id][W.emoji].hasUserReacted=!0)});const Y={};Object.keys(K).forEach(W=>{Y[W]=Object.entries(K[W]).map(([te,ae])=>({emoji:te,count:ae.count,hasUserReacted:ae.hasUserReacted}))}),k(Y)}catch(R){console.error("[MiniLeagueChatBeta] Error reloading reactions:",R)}})()}).subscribe();return()=>{le.removeChannel(O)}},[n,r?.id]);const N=z.useCallback(async(D,O)=>{if(!r?.id)return;const R=(m[D]||[]).find(q=>q.emoji===O&&q.hasUserReacted);if(k(q=>{const K={...q},Y=K[D]||[];if(R){const W=Y.map(te=>te.emoji===O?{...te,count:Math.max(0,te.count-1),hasUserReacted:!1}:te).filter(te=>te.count>0||te.emoji!==O);W.length===0?delete K[D]:K[D]=W}else Y.find(te=>te.emoji===O)?K[D]=Y.map(te=>te.emoji===O?{...te,count:te.count+1,hasUserReacted:!0}:te):K[D]=[...Y,{emoji:O,count:1,hasUserReacted:!0}];return K}),R){const{error:q}=await le.from("league_message_reactions").delete().eq("message_id",D).eq("user_id",r.id).eq("emoji",O);q&&(console.error("[MiniLeagueChatBeta] Error removing reaction:",q),k(K=>{const Y={...K},W=Y[D]||[];return W.find(ae=>ae.emoji===O)?Y[D]=W.map(ae=>ae.emoji===O?{...ae,count:ae.count+1,hasUserReacted:!0}:ae):Y[D]=[...W,{emoji:O,count:1,hasUserReacted:!0}],Y}))}else{const{error:q}=await le.from("league_message_reactions").upsert({message_id:D,user_id:r.id,emoji:O});q&&(console.error("[MiniLeagueChatBeta] Error adding reaction:",q),k(K=>{const Y={...K},te=(Y[D]||[]).map(ae=>ae.emoji===O?{...ae,count:Math.max(0,ae.count-1),hasUserReacted:!1}:ae).filter(ae=>ae.count>0||ae.emoji!==O);return te.length===0?delete Y[D]:Y[D]=te,Y}))}},[r?.id,m]);z.useEffect(()=>{n.length>0&&_([0,150,300])},[n.length,_]),z.useEffect(()=>{!o&&T.current&&(T.current.style.height="auto",T.current.style.height="42px")},[o]);const C=z.useCallback((D,O=[0,100,300,500,700])=>{const $=v.current?.offsetHeight||72;if(D>0){const R=D+$;b(D),M.current&&(M.current.style.paddingBottom=`${R+8}px`)}else b(0),M.current&&(M.current.style.paddingBottom=`${$+8}px`);_(O)},[_]);z.useEffect(()=>{const D=window.visualViewport;let O=null,$=0,R=!1;const q=()=>{if(D){const ae=window.innerHeight,de=D.height,he=D.offsetTop+de;return Math.max(0,ae-he)}else return 0},K=()=>{O&&(clearTimeout(O),O=null),O=setTimeout(()=>{const ae=q();Math.abs(ae-$)<10&&ae>0&&!R||($=ae,C(ae))},50)};D&&(D.addEventListener("resize",K),D.addEventListener("scroll",K)),window.addEventListener("resize",K);const Y=()=>{R=!0,setTimeout(K,50),setTimeout(K,150),setTimeout(K,300),setTimeout(K,500)},W=()=>{R=!1,setTimeout(K,100)},te=setTimeout(()=>{T.current&&(T.current.addEventListener("focus",Y),T.current.addEventListener("blur",W))},100);return K(),()=>{O&&clearTimeout(O),clearTimeout(te),D&&(D.removeEventListener("resize",K),D.removeEventListener("scroll",K)),window.removeEventListener("resize",K),T.current&&(T.current.removeEventListener("focus",Y),T.current.removeEventListener("blur",W))}},[C]),z.useEffect(()=>{if(typeof window>"u")return;const D=()=>{const O=window.visualViewport;let $=0;if(O){const R=window.innerHeight,q=O.height,K=O.offsetTop+q;$=Math.max(0,R-K)}C($)};return window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[C]),z.useEffect(()=>{if(M.current&&v.current){const D=v.current.offsetHeight||72;M.current.style.paddingBottom=`${D+8}px`}},[]);const A=()=>{T.current&&T.current.removeAttribute("readonly");const D=()=>{const O=window.visualViewport;let $=0;if(O){const R=window.innerHeight,q=O.height,K=O.offsetTop+q;$=Math.max(0,R-K)}C($,[0,100,200,400,600,800])};setTimeout(D,50),setTimeout(D,150),setTimeout(D,300),setTimeout(D,500),_([100,200,400,600])},S=D=>{const O=D.target;!(O.tagName==="A"||O.tagName==="BUTTON"||O.closest("a, button"))&&T.current&&document.activeElement===T.current&&T.current.blur()},L=z.useMemo(()=>{if(!r)return"";const D=r.user_metadata??{};return D.display_name||D.full_name||r.email||""},[r]),x=z.useMemo(()=>{if(!n.length)return[];if(!(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1))return console.warn('[chatGroups] memberNames not available yet, returning empty array to prevent "Unknown" authors'),[];if(console.log("[chatGroups] Computing with memberNames:",u instanceof Map?`Map(${u.size})`:u?`Record(${Object.keys(u).length})`:"null/undefined"),u instanceof Map){const Y=Array.from(u.keys());console.log("[chatGroups] memberNames keys:",Y),Y.forEach(W=>{const te=u.get(W);console.log(`[chatGroups] memberNames[${W}] = "${te}"`)})}let O=null;const $=n.reduce((Y,W)=>{const te=W.user_id===r?.id,ae=wt(W.user_id,u),de=ae||(te?L:""),he=de||(te?"You":"Unknown");if(n.indexOf(W)<5){const xe=u instanceof Map?u.has(W.user_id):u?W.user_id in u:!1,pe=u instanceof Map?u.get(W.user_id):u?u[W.user_id]:void 0;console.log(`[chatGroups] Message ${n.indexOf(W)}: user_id=${W.user_id}, hasKey=${xe}, mapValue="${pe}", resolvedName="${ae}", fallbackName="${he}"`)}if(!ae&&!te&&u){const xe=u instanceof Map?u.has(W.user_id):W.user_id in u;console.warn("[chatGroups] Could not resolve name for user_id:",W.user_id,"memberNames has this key?",xe,"resolvedName:",ae,"authorName:",de,"fallbackName:",he)}const Ce=te?void 0:Mr(he),ye=new Date(W.created_at).toDateString(),je=ye!==O;je&&(O=ye),W.reply_to&&console.log("[chatGroups] Message",W.id,"has reply_to:",{id:W.reply_to.id,content:W.reply_to.content,user_id:W.reply_to.user_id,author_name:W.reply_to.author_name,full_reply_to:W.reply_to});const me=W.reply_to?wt(W.reply_to.user_id,u)||"Unknown":null;if(W.reply_to&&me==="Unknown"){const xe=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1,pe=u instanceof Map?u.has(W.reply_to.user_id):u?W.reply_to.user_id in u:!1;if(console.warn('[chatGroups] Reply author is "Unknown" for message',W.id,"reply_to.user_id:",W.reply_to.user_id,"hasMemberNames:",xe,"hasKey:",pe,"reply_to object:",W.reply_to),pe&&u){const Te=wt(W.reply_to.user_id,u);console.warn("[chatGroups] Resolved name should be:",Te,'but got "Unknown"')}}const ke={id:W.id,text:W.content,time:hs(W.created_at),status:W.status&&W.status!=="sent"?W.status:void 0,messageId:W.id,replyTo:W.reply_to?{id:W.reply_to.id,content:W.reply_to.content,authorName:me||void 0}:null},we=Y[Y.length-1],Re=we?.messages.length>0&&we.messages[0].messageId?n.find(xe=>xe.id===we.messages[0].messageId)?.user_id:null;if(we&&!je&&we.isOwnMessage===te&&Re===W.user_id){const xe=we.id.includes("-")?we.id.split("-")[0]:we.id,pe=we.messages.map(ze=>{const $e=ze.messageId?n.find(Ae=>Ae.id===ze.messageId):null;if($e?.reply_to){const Ae=wt($e.reply_to.user_id,u)||"Unknown";return{...ze,replyTo:ze.replyTo?{...ze.replyTo,authorName:Ae}:null}}return ze}),Te={...we,id:`${xe}-${he}`,author:he,avatarInitials:Ce,userId:W.user_id,messages:[...pe,ke]};return[...Y.slice(0,-1),Te]}else return[...Y,{id:`${W.id}-${he}`,author:he,avatarInitials:Ce,isOwnMessage:te,userId:W.user_id,dayLabel:je?ms(W.created_at):void 0,messages:[ke]}]},[]),R=$.map((Y,W)=>{const te={...Y},ae=te.messages.map(de=>{const he=de.messageId?n.find(Ce=>Ce.id===de.messageId):null;if(he?.reply_to&&de.replyTo){const Ce=wt(he.reply_to.user_id,u)||"Unknown";if(Ce!==de.replyTo.authorName)return console.log("[chatGroups] POST-PROCESSING: Updating replyTo.authorName for message",de.messageId,"from",de.replyTo.authorName,"to",Ce),{...de,replyTo:{...de.replyTo,authorName:Ce}}}return de});if(te.author==="Unknown"&&te.messages.length>0&&te.messages[0].messageId){const de=n.find(he=>he.id===te.messages[0].messageId);if(de){const he=wt(de.user_id,u);if(he&&he!=="Unknown"){console.log('[chatGroups] POST-PROCESSING: Resolving "Unknown" to:',he,"for user_id:",de.user_id,"group.id:",te.id,"group index:",W);const Ce=te.id.includes("-")?te.id.split("-")[0]:te.id;return{...te,id:`${Ce}-${he}`,author:he,avatarInitials:Mr(he),userId:de.user_id,messages:ae}}else console.log('[chatGroups] POST-PROCESSING: Could not resolve "Unknown" for group',W,"user_id:",de.user_id,"resolvedName:",he)}else console.log("[chatGroups] POST-PROCESSING: Could not find first message for group",W,"messageId:",te.messages[0]?.messageId)}else te.author==="Unknown"&&console.log("[chatGroups] POST-PROCESSING: Group",W,'has "Unknown" author but no messages');return{...te,messages:ae}}),q=R.filter(Y=>Y.author!=="Unknown"&&$.find(W=>{const te=W.id.includes("-")?W.id.split("-")[0]:W.id,ae=Y.id.includes("-")?Y.id.split("-")[0]:Y.id;return te===ae&&W.author==="Unknown"})).length;q>0&&console.log("[chatGroups] Resolved",q,'groups from "Unknown" to actual names');const K=R.filter(Y=>Y.author==="Unknown").length;return K>0?(console.warn("[chatGroups] FINAL GROUPS: Found",K,'groups with "Unknown" author out of',R.length,"total groups"),R.forEach((Y,W)=>{Y.author==="Unknown"&&console.warn(`[chatGroups] Group ${W}: id="${Y.id}", author="${Y.author}", messages=${Y.messages.length}, firstMessageId=${Y.messages[0]?.messageId}`)})):console.log("[chatGroups] FINAL GROUPS: All",R.length,"groups have resolved author names"),R},[L,u,n,r?.id,I]);z.useEffect(()=>{(u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1)&&I===0&&(console.log("[MiniLeagueChatBeta] memberNames loaded, incrementing version to force re-render"),F(1))},[u,I]),z.useEffect(()=>{const D=u instanceof Map?u.size>0:u?Object.keys(u).length>0:!1,O=x.some($=>$.author==="Unknown");D&&O&&x.length>0&&(console.warn('[MiniLeagueChatBeta] DETECTED: memberNames available but groups have "Unknown" authors - forcing re-render'),setTimeout(()=>{F($=>{const R=$+1;return console.warn("[MiniLeagueChatBeta] Incrementing memberNamesVersion to",R),R})},50),setTimeout(()=>{F($=>{const R=$+1;return console.warn("[MiniLeagueChatBeta] Second increment of memberNamesVersion to",R),R})},200))},[x,u]),z.useEffect(()=>{const D=x.filter(O=>O.author==="Unknown");D.length>0?(console.error("[MiniLeagueChatBeta] chatGroups changed:",D.length,'groups with "Unknown" author out of',x.length,"total groups"),D.forEach(($,R)=>{console.error(`[MiniLeagueChatBeta] Group ${R}: id="${$.id}", author="${$.author}", messages=${$.messages.length}, firstMessageId=${$.messages[0]?.id}`)}),(u instanceof Map?u.size>0:u&&Object.keys(u).length>0)&&console.error('[MiniLeagueChatBeta] ERROR: memberNames is available but groups still have "Unknown" authors! This should not happen!')):console.log("[MiniLeagueChatBeta] chatGroups changed: All",x.length,"groups have resolved author names"),x.slice(0,5).forEach((O,$)=>{console.log(`[MiniLeagueChatBeta] Group ${$}: id="${O.id}", author="${O.author}", messages=${O.messages.length}`)})},[x,u]);const g=z.useMemo(()=>{const D=x.map($=>$.author).join(","),O=x.some($=>$.author==="Unknown");return`chat-${x.length}-${O?"unknown":"resolved"}-${I}-${D.slice(0,50)}`},[x,I]),[G,U]=z.useState(null),H=z.useCallback(async D=>{if(!d||!r?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const $=r.user_metadata?.display_name||r.user_metadata?.full_name||r.email||"User",R={timestamp:new Date().toISOString(),leagueId:d,senderId:r.id,ok:!1,sent:0,error:"Unknown error"};try{const q=await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:d,senderId:r.id,senderName:$,content:D})}),K=await q.json().catch(Y=>(R.error=`Failed to parse response: ${Y?.message||String(Y)}`,R.httpStatus=q.status,{ok:!1,error:"Failed to parse response"}));if(Object.assign(R,{ok:K.ok,sent:K.sent||0,recipients:K.recipients||0,message:K.message,error:K.error,details:K.details,httpStatus:q.status,fullResponse:K}),K.ok===!0)if(K.recipients>0||K.sent>0){const Y=K.recipients||K.sent||0;U({message:` Sent to ${Y} device${Y===1?"":"s"}`,type:"success"})}else K.message==="No devices"||K.message==="No eligible recipients"?U({message:" No devices to notify",type:"warning"}):U({message:` ${K.message||"Notification sent"}`,type:"success"});else{const Y=K.details?.body?.errors?.[0]||K.details?.error||K.error||"Failed to send notification";U({message:` ${Y}`,type:"error"})}setTimeout(()=>U(null),5e3)}catch(q){R.error=q?.message||String(q),R.exception=!0,U({message:` Error: ${q?.message||"Failed to send notification"}`,type:"error"}),setTimeout(()=>U(null),5e3)}finally{try{const q=JSON.parse(localStorage.getItem("notification_logs")||"[]");q.push(R);const K=q.slice(-50);localStorage.setItem("notification_logs",JSON.stringify(K))}catch(q){console.error("[MiniLeagueChatBeta] Failed to store notification log:",q)}}},[d,r?.id]),oe=z.useCallback(async()=>{const D=o.trim();if(!(!d||!D||a))try{h(!0),l(""),T.current&&(T.current.style.height="auto",T.current.style.height="42px"),await p(D,E?.id||null),await H(D),y(null),_([0,150,300])}catch(O){console.error("[MiniLeagueChatBeta] Failed to send message",O),l(D)}finally{h(!1)}},[o,d,H,_,p,a,E]);return s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[s.jsxs("div",{ref:M,className:"flex-1 overflow-y-auto px-4 py-5",onClick:S,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%"},children:[i&&d&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:w,disabled:e,children:e?"Loading earlier":"Load earlier messages"}),x.length===0&&!t?s.jsx("div",{className:"text-center text-sm text-slate-500 mt-8",children:"Say hi to kick off this chat!"}):s.jsx(fs,{groups:x,reactions:m,onReactionClick:N,onMessageClick:(D,O,$)=>{const R=n.find(q=>q.id===D);if(R){let q="";if(typeof O=="string")q=O;else if(typeof O=="object"&&O!==null){const K=O?.props?.children||String(O);q=typeof K=="string"?K:String(K)}else q=String(O);y({id:D,content:q||R.content,authorName:$}),setTimeout(()=>{T.current?.focus()},100)}}},g)]}),s.jsxs("div",{ref:v,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:P>0?"fixed":"relative",bottom:P>0?`${P}px`:"0",left:P>0?0:"auto",right:P>0?0:"auto",width:"100%",maxWidth:P>0?"440px":"100%",marginLeft:P>0?"auto":void 0,marginRight:P>0?"auto":void 0,zIndex:P>0?100:"auto",boxShadow:P>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[E&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",E.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:E.content})]}),s.jsx("button",{onClick:()=>y(null),className:"flex-shrink-0 w-5 h-5 rounded-full hover:bg-slate-200 flex items-center justify-center text-slate-500 transition-colors",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:T,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:o,disabled:!d||a,placeholder:d?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text","data-1p-ignore":"true",onKeyDown:D=>{if(D.key==="Escape"&&E){y(null),D.preventDefault();return}D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),oe())},onChange:D=>{l(D.target.value),T.current&&(T.current.style.height="auto",T.current.style.height=`${Math.min(T.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const O=window.visualViewport;if(O){const $=window.innerHeight,R=O.height,q=O.offsetTop+R,K=$-q;C(K,[0,100])}})},onFocus:A,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:oe,disabled:!d||a||!o.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),c&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[c,"  try again or switch to the classic chat tab."]}),G&&s.jsx("div",{className:`text-xs mt-2 text-center ${G.type==="success"?"text-green-600":G.type==="warning"?"text-amber-600":"text-red-600"}`,children:G.message})]})]})}function gs({winnerName:d,isDraw:u}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:u?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[d," Wins!"]})})})}function xs({availableGws:d,selectedGw:u,onChange:r,className:n=""}){return d.length<=1?null:s.jsx("div",{className:`flex-1 ${n}`,children:s.jsx("select",{value:u||void 0,onChange:t=>{const e=parseInt(t.target.value,10);r(e)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:d.map(t=>s.jsxs("option",{value:t,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",t]},t))})})}function ws({showForm:d,onToggle:u}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>u(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"text-slate-600 hover:text-slate-900 hover:bg-white/50":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>u(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"Form"})]})}function bs({form:d}){const u=d.slice(-5),r=5-u.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:r}).map((n,t)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${t}`)),u.map((n,t)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${n==="W"?"bg-green-100 text-green-700":n==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n},t))]})}function vs({rows:d,members:u,showForm:r,currentUserId:n,loading:t,isLateStartingLeague:e}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),r?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:e?"CP":"OCP"}),u.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[d.map((i,c)=>{const w=i.user_id===n,p=c===d.length-1;return s.jsxs("tr",{className:w?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...p?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:i.name}),r?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(bs,{form:i.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.ocp}),u.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:i.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:i.mltPts})]})]},i.user_id)}),t&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!t&&!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function ys({rows:d,members:u,currentUserId:r,positionChangeKeys:n,isApiTestLeague:t,hasLiveFixtures:e,hasStartingSoonFixtures:i,hasStartedFixtures:c,allFixturesFinished:w,resGw:p}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",t&&e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),t&&!w&&i&&!e&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),u.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[d.map((o,l)=>{const a=o.user_id===r,h=l===d.length-1,m=n.has(o.user_id);return s.jsxs("tr",{className:`${a?"flash-user-row":""} ${m?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...h?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:l+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[t&&e&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),t&&!e&&i&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold ${t&&e?"pulse-live-score":""}`,style:{width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:o.score}),u.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums ${t&&e?"pulse-live-score":""}`,style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:o.unicorns})]},o.user_id)}),!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:u.length>=3?4:3,style:{backgroundColor:"#f8fafc"},children:["No results recorded for GW ",p," yet."]})})]})]})})]})}function _s(d){const u=pn(),r=encodeURIComponent(d);if(u){const n=`whatsapp://send?text=${r}`;let t=!1,e=!1;try{const i=document.createElement("a");i.href=n,i.style.display="none",document.body.appendChild(i),i.click(),t=!0,setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},100)}catch{}if(!t)try{window.open(n),e=!0}catch{}if(!t&&!e)try{window.location.href=n}catch{window.open(`https://wa.me/?text=${r}`,"_blank")}}else{const n=`https://wa.me/?text=${r}`;try{window.open(n,"_blank")}catch{navigator.clipboard.writeText(d).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+d)})}}}function js(d,u){const r=new Date(u.find(l=>l.gw===d)?.kickoff_time||""),n=new Date(r.getTime()-4500*1e3),t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],e=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],i=t[n.getUTCDay()],c=n.getUTCDate(),w=e[n.getUTCMonth()],p=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${d} Predictions Reminder!

DEADLINE: THIS ${i} ${c} ${w}, ${p}:${o} BST

Don't forget!
playtotl.com`}function ks(d,u){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",d);try{const r=js(d,u);console.log("[SubmissionStatusTable] Generated message:",r),_s(r)}catch(r){console.error("[SubmissionStatusTable] Error in handleShareReminder:",r),alert("Error sharing reminder. Please try again.")}}function Tr({members:d,submittedMap:u,picksGw:r,allSubmitted:n,remaining:t,fixtures:e,onShareReminder:i,variant:c="full"}){const w=i||(()=>ks(r,e)),p=e.map(m=>m.kickoff_time).filter(m=>!!m).map(m=>new Date(m)).filter(m=>!isNaN(m.getTime())),o=p.length>0?new Date(Math.min(...p.map(m=>m.getTime()))):null,l=o?new Date(o.getTime()-4500*1e3):null,a=l?new Date>=l:!1;let h="";if(l){const m=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=m[l.getUTCDay()],y=l.getUTCDate(),I=k[l.getUTCMonth()],F=l.getUTCHours().toString().padStart(2,"0"),M=l.getUTCMinutes().toString().padStart(2,"0");h=`${E} ${y} ${I}, ${F}:${M} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),w()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${a?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),a?"Deadline Passed: ":"Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((m,k)=>m.name.localeCompare(k.name)).map(m=>{const k=`${m.id}:${r}`,E=!!u.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:m.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},m.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:n?s.jsxs(s.Fragment,{children:["All ",d.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:t})," of ",d.length," to submit."]})}),!n&&s.jsxs("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),w()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),h&&s.jsxs("div",{className:`mb-3 text-sm ${a?"text-orange-600 font-semibold":"text-slate-600"}`,children:[a?" Deadline Passed: ":" Deadline: ",h]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((m,k)=>m.name.localeCompare(k.name)).map(m=>{const k=`${m.id}:${r}`,E=!!u.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:m.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},m.id)})})]})})]})}function Dr({letter:d,correct:u,unicorn:r,hasSubmitted:n,isLive:t,isOngoing:e,isFinished:i}){let c;return u===!0?t||e?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":i?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":n?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:r?"Correct!":void 0,children:d})}function Ss(d,u){return d==="FINISHED"?"FT":d==="PAUSED"?"HT":d==="IN_PLAY"?u==null?"LIVE":`${u}'`:"LIVE"}function Cs(d){const u=(d||"?").trim().split(/\s+/);return u.length?u.length===1?u[0].slice(0,1).toUpperCase():(u[0][0]+u[u.length-1][0]).toUpperCase():"?"}function Ns({fixture:d,picks:u,members:r,outcome:n,liveScore:t,submittedMap:e,picksGw:i,isApiTestLeague:c=!1}){const w=d.home_code||d.home_team||d.home_name||"",p=d.away_code||d.away_team||d.away_name||"",o=mr(w)||d.home_name||d.home_team||"Home",l=mr(p)||d.away_name||d.away_team||"Away",h=(M=>{if(!M)return"";const T=new Date(M);if(isNaN(T.getTime()))return"";const v=String(T.getUTCHours()).padStart(2,"0"),P=String(T.getUTCMinutes()).padStart(2,"0");return`${v}:${P}`})(d.kickoff_time),m=!!(t&&t.status==="IN_PLAY"),k=!!(t&&(t.status==="PAUSED"||t.status==="HALF_TIME"||t.status==="HT")),E=!!(t&&t.status==="FINISHED"),y=m||k;let I=null;c&&t?t.homeScore>t.awayScore?I="H":t.awayScore>t.homeScore?I="A":t.homeScore===t.awayScore&&(I="D"):I=n;const F=M=>{const T=u.filter(f=>f.pick===M),v=u.length===r.length&&T.length===r.length,P=4,b=[];for(let f=0;f<T.length;f+=P){const _=T.slice(f,f+P);b.push(_)}return s.jsx("div",{className:"flex flex-col gap-1",children:b.map((f,_)=>s.jsx("div",{className:"flex items-center justify-center",children:f.map((N,C)=>{const A=r.find(g=>g.id===N.user_id),S=Cs(A?.name??"?"),L=e.has(`${N.user_id}:${i}`),x=I&&I===M?!0:null;return v?s.jsx("span",{className:"inline-block",style:{marginLeft:C>0?"-8px":"0",position:"relative",zIndex:C},children:s.jsx(Dr,{letter:S,correct:x,unicorn:x===!0,hasSubmitted:L,isLive:m,isOngoing:y,isFinished:E})},N.user_id):s.jsx(Dr,{letter:S,correct:x,unicorn:x===!0,hasSubmitted:L,isLive:m,isOngoing:y,isFinished:E},N.user_id)})},_))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(m||k)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),E&&!m&&!k&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${y?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(pr,{code:d.home_code||void 0,crest:d.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:t&&(m||k||E)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[t.homeScore," - ",t.awayScore]}):s.jsx("span",{children:h})}),s.jsx(pr,{code:d.away_code||void 0,crest:d.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:l})})]}),t&&(y||E)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${y?"text-red-600":"text-slate-500"}`,children:Ss(t.status,t.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:F("A")})})]})]})})}function Ur({label:d,fixtures:u,picksByFixture:r,members:n,outcomes:t,liveScores:e,submittedMap:i,picksGw:c,isApiTestLeague:w=!1,isFirstSection:p=!1,hasLiveGames:o=!1,allGamesFinished:l=!1,allSubmitted:a=!1,resultsPublished:h=!1,deadlinePassed:m=!1,whoDidntSubmit:k=[],liveFixturesCount:E,hasStarted:y=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(gn,{date:d,className:"text-lg font-normal"}),p&&s.jsxs(s.Fragment,{children:[w&&o&&E!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:E}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:u.length})]})]}),w&&l&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),w&&!y&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&a&&h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!w&&a&&!h&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&m&&!a&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",k.length>0&&`(${k.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[u.map(I=>{try{const F=r.get(I.fixture_index)??[],M=t.get(I.fixture_index)||null,T=e[I.fixture_index]||null;return s.jsx(Ns,{fixture:I,picks:F,members:n,outcome:M,liveScore:T,submittedMap:i,picksGw:c,isApiTestLeague:w},`${I.gw}-${I.fixture_index}`)}catch(F){return console.error("Error rendering fixture:",F,I),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",I.fixture_index]},`${I.gw}-${I.fixture_index}`)}}),!u.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const er=8;function tr(d){return d.result==="H"||d.result==="D"||d.result==="A"?d.result:typeof d.home_goals=="number"&&typeof d.away_goals=="number"?d.home_goals>d.away_goals?"H":d.home_goals<d.away_goals?"A":"D":null}function As(){const{code:d=""}=xn(),[u,r]=wn(),{user:n}=Ir(),[t]=z.useState(()=>{const j=localStorage.getItem("oldSchoolMode");return j?JSON.parse(j):!1});z.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(t))},[t]),z.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const j=()=>{const Q=document.querySelector(".league-header-fixed");if(Q){const se=Q.style.top||window.getComputedStyle(Q).top;se!=="0px"&&se!=="0"&&(Q.style.top="0",Q.style.transform="translate3d(0, 0, 0)")}},B=()=>{j(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},Z=Q=>{const se=Q.target;se.closest(".league-content-wrapper")||se.closest(".league-header-fixed")||se.closest(".chat-tab-wrapper")||Q.preventDefault()};window.addEventListener("scroll",B,{passive:!0}),document.addEventListener("touchmove",Z,{passive:!1});const V=setInterval(j,100);return j(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",B),document.removeEventListener("touchmove",Z),clearInterval(V)}},[]),z.useEffect(()=>{const j=Z=>{const V=Z.target;(V.tagName==="INPUT"||V.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const Q=document.querySelector(".league-header-fixed");Q&&(Q.style.top="0")},100)},B=()=>{const Z=document.querySelector(".league-header-fixed");Z&&(Z.style.top="0")};return document.addEventListener("focusin",j),window.addEventListener("resize",B),window.addEventListener("orientationchange",B),()=>{document.removeEventListener("focusin",j),window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B)}},[]),z.useEffect(()=>{if(typeof window>"u")return;const j=window.visualViewport;if(!j)return;let B=null;const Z=()=>{const Q=I.current;if(!Q)return;const se=j.offsetTop??0;Q.style.setProperty("transform",`translate3d(0, ${se}px, 0)`,"important")},V=()=>{B&&cancelAnimationFrame(B),B=window.requestAnimationFrame(Z)};return V(),j.addEventListener("resize",V),j.addEventListener("scroll",V),()=>{B&&cancelAnimationFrame(B),j.removeEventListener("resize",V),j.removeEventListener("scroll",V),I.current&&I.current.style.removeProperty("transform")}},[]);const[e,i]=z.useState(null),[c,w]=z.useState(!1),[p,o]=z.useState([]),[l,a]=z.useState(!0),h="chat",[m,k]=z.useState(h),E=z.useRef(!1),y=z.useRef(!1);z.useEffect(()=>{u.get("tab")==="chat"&&(m!=="chat"&&(console.log("[League] Opening chat tab from deep link"),k("chat")),r({},{replace:!0}))},[u,r,m]);const I=z.useRef(null),[F,M]=z.useState(!1),[T,v]=z.useState(!1),[P,b]=z.useState(!1),[f,_]=z.useState(null),[N,C]=z.useState(null),[A,S]=z.useState(null),[L,x]=z.useState([]),g=z.useRef({}),G=z.useRef(new Map),[U,H]=z.useState(new Set),[oe,D]=z.useState(!1),[O,$]=z.useState(!1),[R,q]=z.useState(0),[K,Y]=z.useState(!1),[W,te]=z.useState(!1),[ae,de]=z.useState(!1),[he,Ce]=z.useState(!1),[Se,ye]=z.useState(null),[je,me]=z.useState(!1),[ke,we]=z.useState(null),[Re,We]=z.useState({x:0,y:0}),[xe,pe]=z.useState(1),[Te,ze]=z.useState(null),[$e,Ae]=z.useState(null),[it,Fe]=z.useState(!1),[Ke,qe]=z.useState(!1),[Ze,Je]=z.useState(!1),[et,st]=z.useState(!1),[$t,pt]=z.useState(!1),[Nt,lt]=z.useState(!1),[xt,rt]=z.useState(null),[tt,ct]=z.useState(!1),[dt,yt]=z.useState(!1),[Qe,ut]=z.useState(null),ot=z.useMemo(()=>!!n?.id&&p.some(j=>j.id===n.id),[n?.id,p]),or=z.useMemo(()=>!!n?.id&&!!Qe&&Qe.id===n.id,[n?.id,Qe]),Kr=z.useMemo(()=>Qe?.name??"League admin",[Qe]),Zr=z.useMemo(()=>{const j=new Map;return p.forEach(B=>j.set(B.id,B.name)),j.set(Pr,bn),j},[p]),ar=z.useCallback(()=>{if(!e?.code||typeof window>"u"||typeof navigator>"u")return;const j=`Join my mini league "${e.name}" on TotL!`,B=`${window.location.origin}/league/${e.code}`,Z=navigator;if(typeof Z.share=="function"){Z.share({title:`Join ${e.name}`,text:j,url:B}).catch(Q=>{console.warn("[League] Share cancelled",Q)});return}const V=`${j}
${B}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(V).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",e.code)}):window.prompt?.("Share this league code:",e.code)},[e]),Jr=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){b(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id).eq("user_id",n.id);if(j)throw j;typeof window<"u"&&(window.location.href="/leagues")}catch(j){console.error("[League] Error leaving league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to leave league. Please try again.")}finally{b(!1),v(!1)}}},[e?.id,n?.id]),Qr=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){Je(!0);try{if(p.length>=er){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),qe(!1);return}const{error:j}=await le.from("league_members").insert({league_id:e.id,user_id:n.id});if(j)throw j;const B=n.user_metadata?.display_name||n.email||"Someone";try{const Z=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:e.id,userId:n.id,userName:B})}),V=await Z.text();let Q;try{Q=V?JSON.parse(V):{error:"Empty response body"}}catch(se){console.error("[League] Failed to parse notification response. Status:",Z.status,"Text:",V,"Error:",se),Q={error:"Invalid JSON response",status:Z.status,raw:V.substring(0,200)}}Z.ok?console.log("[League] Join notification sent:",JSON.stringify({sent:Q.sent,recipients:Q.recipients,ok:Q.ok,breakdown:Q.breakdown},null,2)):console.error("[League] Notification function returned error:",Z.status,Q)}catch(Z){console.error("[League] Error sending join notification:",Z)}typeof window<"u"&&window.location.reload()}catch(j){console.error("[League] Error joining league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to join league.")}finally{Je(!1)}}},[e?.id,n?.id,p.length]),Xr=z.useCallback(async()=>{if(!(!xt||!e?.id||!n?.id)){ct(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id).eq("user_id",xt.id);if(j)throw j;typeof window<"u"&&window.location.reload()}catch(j){console.error("[League] Error removing member:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to remove member.")}finally{ct(!1),pt(!1),rt(null)}}},[e?.id,xt,n?.id]),en=z.useCallback(async()=>{if(!(!e?.id||!n?.id)){yt(!0);try{const{error:j}=await le.from("league_members").delete().eq("league_id",e.id);if(j)throw j;const{error:B}=await le.from("leagues").delete().eq("id",e.id);if(B)throw B;typeof window<"u"&&(window.location.href="/leagues")}catch(j){console.error("[League] Error ending league:",j),typeof window<"u"&&window.alert?.(j?.message??"Failed to end league.")}finally{yt(!1),lt(!1)}}},[e?.id,n?.id]),tn=j=>new Promise((B,Z)=>{const V=new Image;V.addEventListener("load",()=>B(V)),V.addEventListener("error",Q=>Z(Q)),V.src=j}),ir=async(j,B)=>{const Z=await tn(j),V=document.createElement("canvas"),Q=V.getContext("2d");if(!Q)throw new Error("No 2d context");return V.width=B.width,V.height=B.height,Q.drawImage(Z,B.x,B.y,B.width,B.height,0,0,B.width,B.height),new Promise((se,ce)=>{V.toBlob(be=>{if(!be){ce(new Error("Canvas is empty"));return}se(be)},"image/jpeg",.9)})},rn=z.useCallback(j=>{if(!e?.id||!ot){ye("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(j.type)){ye("Please upload a PNG, JPG, or WebP image.");return}const Z=20*1024*1024;if(j.size>Z){ye("Please choose an image smaller than 20MB.");return}if(j.size>5*1024*1024&&console.log(`[League] Processing large image (${(j.size/1024/1024).toFixed(1)}MB) - will be optimized automatically`),ye(null),me(!1),j.size>5*1024*1024)He(j,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(V=>{const Q=new FileReader;Q.onload=()=>{we(Q.result)},Q.readAsDataURL(V)}).catch(V=>{console.error("[League] Error pre-compressing image:",V),ye("Failed to process image. Please try a smaller file.")});else{const V=new FileReader;V.onload=()=>{we(V.result)},V.readAsDataURL(j)}},[ot,e?.id]),nn=z.useCallback(async(j,B)=>{if(ze(B),ke)try{const Z=await ir(ke,B),V=URL.createObjectURL(Z);Ae(V)}catch(Z){console.error("[League] Error creating preview:",Z)}},[ke]),sn=z.useCallback(async()=>{if(!(!ke||!Te||!e?.id||!ot)){ye(null),me(!1),Ce(!0);try{const j=await ir(ke,Te),B=new File([j],"badge.jpg",{type:"image/jpeg"}),Z=await He(B,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(Z.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const V=`${e.id}-${Date.now()}.jpg`,{error:Q}=await le.storage.from("league-avatars").upload(V,Z,{cacheControl:"3600",upsert:!0,contentType:Z.type});if(Q)throw Q;const{data:se}=le.storage.from("league-avatars").getPublicUrl(V),ce=se?.publicUrl;if(!ce)throw new Error("Unable to get public URL for badge.");const{error:be}=await le.from("leagues").update({avatar:ce}).eq("id",e.id);if(be)throw be;i(Me=>Me&&{...Me,avatar:ce}),me(!0),$e&&URL.revokeObjectURL($e),we(null),Ae(null),de(!1),n?.id&&(Ht(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:ce}})))}catch(j){console.error("[League] Error uploading badge:",j),ye(j?.message??"Failed to upload badge. Please try again.")}finally{Ce(!1)}}},[ke,Te,ot,e?.id,n?.id]),on=z.useCallback(async()=>{if(!(!e?.id||!ot)){ye(null),me(!1),Ce(!0);try{const{error:j}=await le.from("leagues").update({avatar:null}).eq("id",e.id);if(j)throw j;i(B=>B&&{...B,avatar:null}),me(!0),n?.id&&(Ht(n.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:e.id,avatar:null}})))}catch(j){console.error("[League] Error removing badge:",j),ye(j?.message??"Failed to remove badge. Please try again.")}finally{Ce(!1)}}},[ot,e?.id]),[lr,an]=z.useState(new Map);z.useEffect(()=>{(async()=>{const j=new Map,{data:B}=await le.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:Z}=await le.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),V=new Map;if(B&&B.forEach(Q=>{(!V.has(Q.gw)||Q.kickoff_time&&new Date(Q.kickoff_time)<new Date(V.get(Q.gw)))&&Q.kickoff_time&&V.set(Q.gw,Q.kickoff_time)}),Z&&Z.length>0){const Q=Z.find(se=>se.kickoff_time)?.kickoff_time;if(Q){const se=V.get(1);(!se||new Date(Q)<new Date(se))&&V.set(1,Q)}}V.forEach((Q,se)=>{const ce=new Date(Q),be=new Date(ce.getTime()-4500*1e3);j.set(se,be)}),an(j)})()},[]),z.useEffect(()=>{const j=B=>{const Z=B.target;oe&&!Z.closest(".gw-dropdown-container")&&D(!1)};return oe&&document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[oe]),z.useEffect(()=>{let j=!0;return(async()=>{const{data:B}=await le.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!j)return;_(B?.current_gw??null);const{data:Z}=await le.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!j)return;C(Z&&Z.length?Z[0].gw:null);const{data:V}=await le.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!j)return;const Q=V?[...new Set(V.map(ce=>ce.gw))].sort((ce,be)=>be-ce):[],se=B?.current_gw;se&&!Q.includes(se)&&Q.unshift(se),x(Q),Q.length>0&&!A&&S(Q[0])})(),()=>{j=!1}},[R]);const ft=z.useMemo(()=>p.map(j=>j.id),[p]),[De,cr]=z.useState([]),[_t,Ot]=z.useState([]),[Wt,Bt]=z.useState([]),[Et,Gt]=z.useState([]),dr=z.useMemo(()=>!De||De.length===0?[]:De.map(j=>j.api_match_id).filter(j=>j!=null),[De]),At=z.useMemo(()=>e?.name==="API Test",[e?.name]),[ht,ur]=z.useState(null);z.useEffect(()=>{if(!At){ur(null);return}let j=!0;return(async()=>{const{data:B}=await le.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let Z=B?.current_test_gw??1;if(Z&&Z!==1){const{data:V}=await le.from("app_fixtures").select("gw").eq("gw",Z).limit(1).maybeSingle();if(!V){const{data:Q}=await le.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();Q&&(Z=1)}}j&&ur(Z)})(),()=>{j=!1}},[At]);const ln=z.useMemo(()=>At&&ht!==null?ht:f||A||void 0,[At,ht,f,A]),{liveScores:fr}=vn(ln,dr.length>0?dr:void 0),Ve=z.useMemo(()=>{const j={};return!De||De.length===0||De.forEach(B=>{const Z=B.api_match_id;if(Z){const V=fr.get(Z);V&&(j[B.fixture_index]={homeScore:V.home_score??0,awayScore:V.away_score??0,status:V.status||"SCHEDULED",minute:V.minute??null})}}),j},[fr,De]),[hr,jt]=z.useState([]),[cn,kt]=z.useState(!1);z.useEffect(()=>{let j=!0;return(async()=>{a(!0);const{data:B}=await le.from("leagues").select("id,name,code,created_at,avatar").eq("code",d).maybeSingle();if(!j)return;if(!B){i(null),o([]),a(!1);return}i(B);const{data:Z}=await le.from("league_members").select("users(id,name),created_at").eq("league_id",B.id).order("created_at",{ascending:!0}),V=Z?.map(ce=>({id:ce.users.id,name:ce.users.name??"(no name)"}))??[],Q=[...V].sort((ce,be)=>ce.name.localeCompare(be.name));o(Q);const se=V[0];ut(se),n?.id&&!V.some(ce=>ce.id===n.id)&&qe(!0),a(!1)})(),()=>{j=!1}},[d]),z.useEffect(()=>{},[e,m]),z.useEffect(()=>{if(m!=="chat"||!e?.id||!n?.id)return;(async()=>{await le.from("league_message_reads").upsert({league_id:e.id,user_id:n.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),Ht(n.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:e.id,userId:n.id}}))})()},[m,e?.id,n?.id]),z.useEffect(()=>{let j=!0;return(async()=>{const B=e?.name==="API Test";let Z=ht??1;if(B){const{data:Le}=await le.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(Z=Le?.current_test_gw??1,Z&&Z!==1){const{data:Pe}=await le.from("app_fixtures").select("gw").eq("gw",Z).limit(1).maybeSingle();if(Pe)console.log("[League] Using current_test_gw from meta:",Z);else{const{data:ee}=await le.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();ee&&(Z=1,console.log("[League] No fixtures for current_test_gw, falling back to GW T1"))}}else console.log("[League] Using GW T1 or current_test_gw:",Z)}const V=B&&(m==="gw"||m==="gwr");console.log("[League] Data fetch:",{isApiTestLeague:B,tab:m,useTestFixtures:V,leagueName:e?.name,testGwForData:Z,willUseTestTables:V,willUseMainTables:!V});let Q=m==="gwr"?y.current?A:f||A:f;if(B&&(m==="gw"||m==="gwr")&&(Q=Z),console.log("[League] gwForData calculation:",{tab:m,manualGwSelected:y.current,selectedGw:A,currentGw:f,gwForData:Q,isApiTestLeague:B}),m==="gw"&&!B&&ft.length>0){const{data:Le}=await le.from("app_gw_submissions").select("gw").in("user_id",ft).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(Le&&Le.length>0){const Pe=[...new Set(Le.map(ee=>ee.gw))].sort((ee,ne)=>(ne||0)-(ee||0));for(const ee of Pe)if(ee){const{data:ne}=await le.from("app_fixtures").select("gw").eq("gw",ee).limit(1);if(ne&&ne.length>0){console.log("[League] Found fixtures for GW",ee,"from submissions - using this GW (currentGw was",Q,")"),Q=ee;break}}}!Q&&f&&(Q=f,console.log("[League] Using currentGw as fallback:",f))}if(console.log("[League] gwForData:",Q,"memberIds:",ft),!Q&&!V){cr([]),Ot([]),Bt([]),Gt([]);return}let se;if(V){const{data:Le}=await le.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",Z).order("fixture_index",{ascending:!0});se=Le?.map(Pe=>({...Pe,gw:Pe.test_gw}))||null}else{console.log("[League] Fetching from MAIN database table (app_fixtures) for regular league, GW:",Q);const{data:Le}=await le.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",Q).order("fixture_index",{ascending:!0});se=Le||null,console.log("[League] Fetched fixtures from main database:",Le?.length||0,"fixtures")}if(!j)return;if(cr(se??[]),!ft.length){Ot([]),Bt([]),Gt([]);return}let ce=null,be;if(V){const{data:Le}=await le.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",Z).in("user_id",ft);ce=Le?.map(X=>({...X,gw:X.matchday}))||null;const{data:Pe,error:ee}=await le.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",Z).not("submitted_at","is",null).in("user_id",ft);ee&&console.error("Error fetching test_api_submissions:",ee);const{data:ne}=await le.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",Z).order("fixture_index",{ascending:!0}),Ne=new Set((ne||[]).map(X=>X.fixture_index));console.log("[League] Current fixture indices from test_api_fixtures:",Array.from(Ne)),console.log("[League] Current fixtures:",ne?.map(X=>({index:X.fixture_index,home:X.home_team,away:X.away_team})));const J=[];if(Pe&&ce&&ne){const X=Ne.size;console.log("[League] Required fixture count for valid submission:",X);const ge=(ne||[]).map(re=>re.kickoff_time?new Date(re.kickoff_time):null).filter(re=>re!==null&&!isNaN(re.getTime())),ie=ge.length>0?new Date(Math.min(...ge.map(re=>re.getTime()))):null,Ee=new Date("2025-11-18T00:00:00Z");console.log("[League] Submission cutoff date (submissions before this are old):",Ee.toISOString()),console.log("[League] Earliest kickoff:",ie?.toISOString()),Pe.forEach(re=>{const _e=(ce||[]).filter(Ue=>Ue.user_id===re.user_id&&Ue.matchday===Z),fe=_e.filter(Ue=>Ne.has(Ue.fixture_index)),ue=fe.length===X&&X>0,ve=new Set(fe.map(Ue=>Ue.fixture_index)),Xe=ve.size===X,mt=re.submitted_at?new Date(re.submitted_at):null,Ie=mt&&mt>=Ee;if(ue&&Xe&&Ie)J.push(re),console.log("[League]  VALID submission (has picks for ALL current fixtures AND recent submission):",{user_id:re.user_id,submitted_at:re.submitted_at,submissionDate:mt?.toISOString(),cutoffDate:Ee.toISOString(),picksCount:_e.length,picksForCurrentFixtures:fe.length,uniqueIndices:ve.size,requiredCount:X});else{const Ue=[];ue||Ue.push("missing picks"),Xe||Ue.push("duplicate/extra picks"),Ie||Ue.push(`old submission (${mt?.toISOString()} < ${Ee.toISOString()})`),console.log("[League]  INVALID submission:",{user_id:re.user_id,submitted_at:re.submitted_at,submissionDate:mt?.toISOString(),cutoffDate:Ee.toISOString(),picksCount:_e.length,picksForCurrentFixtures:fe.length,uniqueIndices:ve.size,requiredCount:X,hasAllRequired:ue,hasExactMatch:Xe,isRecent:Ie,reason:Ue.join(", ")})}})}be=J.map(X=>({...X,gw:X.matchday}))||null,console.log("[League] Test API submissions fetched (filtered to only current fixtures):",be),console.log("[League] Valid submissions count:",J.length,"out of",Pe?.length||0,"total")}else{console.log("[League] Fetching from MAIN database tables (picks, gw_submissions) for regular league");const{data:Le}=await le.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",Q).in("user_id",ft);ce=Le,console.log("[League] Fetched picks from main database:",Le?.length||0,"picks");const{data:Pe}=await le.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",Q).in("user_id",ft);be=Pe,console.log("[League] Fetched submissions from main database:",Pe?.length||0,"submissions")}if(!j)return;Ot(ce??[]),Bt(be??[]);const{data:Me}=await le.from("app_gw_results").select("gw,fixture_index,result").eq("gw",V?1:Q||0);j&&Gt(Me??[])})(),()=>{j=!1}},[m,f,N,A,ft]),z.useEffect(()=>{g.current=Ve},[Ve]);const Be=z.useMemo(()=>{const j=new Map;return console.log("[League] Building submittedMap from subs:",Wt),Wt.forEach(B=>{if(B.submitted_at){const Z=`${B.user_id}:${B.gw}`;console.log(`[League] Adding submission key: ${Z}`,B),j.set(Z,!0)}else console.log("[League] Skipping submission with null submitted_at:",B)}),console.log("[League] Final submittedMap:",Array.from(j.entries())),j},[Wt]),Lt=z.useCallback(j=>j.map(B=>({user_id:B.id,name:B.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);z.useEffect(()=>{const j=le.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{q(B=>B+1)}).subscribe();return()=>{le.removeChannel(j)}},[]),z.useEffect(()=>{let j=!0;return(async()=>{if(!p.length){jt([]);return}if(e?.name==="API Test"){jt(Lt(p)),kt(!1);return}if(f===null)return;kt(!0);const{data:B}=await le.from("app_gw_results").select("gw,fixture_index,result"),Z=B??[],V=new Map;if(Z.forEach(re=>{const _e=tr(re);_e&&V.set(`${re.gw}:${re.fixture_index}`,_e)}),V.size===0){jt(Lt(p)),kt(!1);return}const Q=[...new Set(Array.from(V.keys()).map(re=>parseInt(re.split(":")[0],10)))].sort((re,_e)=>re-_e),se=["Prem Predictions","FC Football","Easy League"],ce=["The Bird league"],be=await yn(e,f);let Me=Q.filter(re=>re>=be);if(f!==null&&Me.includes(f)){const{data:re}=await le.from("app_fixtures").select("fixture_index").eq("gw",f),_e=re?.length??0,fe=Array.from(V.keys()).filter(ue=>parseInt(ue.split(":")[0],10)===f).length;_e>0&&fe<_e&&(Me=Me.filter(ue=>ue<f))}else f!==null&&(Me=Me.filter(re=>re<f));if(!se.includes(e?.name||"")&&!ce.includes(e?.name||"")&&Me.length===0){jt(Lt(p)),kt(!1);return}const{data:Le}=await le.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",p.map(re=>re.id)).in("gw",Me),Pe=Le??[],ee=new Map;Me.forEach(re=>{const _e=new Map;p.forEach(fe=>_e.set(fe.id,{user_id:fe.id,score:0,unicorns:0})),ee.set(re,_e)}),Me.forEach(re=>{Array.from(V.entries()).filter(([fe])=>parseInt(fe.split(":")[0],10)===re).map(([fe,ue])=>({idx:parseInt(fe.split(":")[1],10),out:ue})).forEach(({idx:fe,out:ue})=>{const ve=Pe.filter(Ie=>Ie.gw===re&&Ie.fixture_index===fe),Xe=ve.filter(Ie=>Ie.pick===ue).map(Ie=>Ie.user_id),mt=ee.get(re);if(ve.forEach(Ie=>{if(Ie.pick===ue){const Ue=mt.get(Ie.user_id);Ue.score+=1}}),Xe.length===1&&p.length>=3){const Ie=Xe[0],Ue=mt.get(Ie);Ue.unicorns+=1}})});const ne=new Map,Ne=new Map,J=new Map,X=new Map,ge=new Map,ie=new Map;p.forEach(re=>{ne.set(re.id,0),Ne.set(re.id,0),J.set(re.id,0),X.set(re.id,0),ge.set(re.id,0),ie.set(re.id,[])}),Me.forEach(re=>{const _e=Array.from(ee.get(re).values());if(_e.forEach(ve=>{Ne.set(ve.user_id,(Ne.get(ve.user_id)??0)+ve.score),J.set(ve.user_id,(J.get(ve.user_id)??0)+ve.unicorns)}),_e.sort((ve,Xe)=>Xe.score-ve.score||Xe.unicorns-ve.unicorns),!_e.length)return;const fe=_e[0],ue=_e.filter(ve=>ve.score===fe.score&&ve.unicorns===fe.unicorns);ue.length===1?(ne.set(fe.user_id,(ne.get(fe.user_id)??0)+3),X.set(fe.user_id,(X.get(fe.user_id)??0)+1),ie.get(fe.user_id).push("W"),_e.slice(1).forEach(ve=>ie.get(ve.user_id).push("L"))):(ue.forEach(ve=>{ne.set(ve.user_id,(ne.get(ve.user_id)??0)+1),ge.set(ve.user_id,(ge.get(ve.user_id)??0)+1),ie.get(ve.user_id).push("D")}),_e.filter(ve=>!ue.find(Xe=>Xe.user_id===ve.user_id)).forEach(ve=>ie.get(ve.user_id).push("L")))});const Ee=p.map(re=>({user_id:re.id,name:re.name,mltPts:ne.get(re.id)??0,ocp:Ne.get(re.id)??0,unicorns:J.get(re.id)??0,wins:X.get(re.id)??0,draws:ge.get(re.id)??0,form:ie.get(re.id)??[]}));Ee.sort((re,_e)=>_e.mltPts-re.mltPts||_e.unicorns-re.unicorns||_e.ocp-re.ocp||re.name.localeCompare(_e.name)),j&&(jt(Ee),kt(!1))})(),()=>{j=!1}},[p,e,f,Lt,R]);function dn(){const j=["Prem Predictions","FC Football","Easy League"],B=["The Bird league"],Z=["gregVjofVcarl","Let Down"],V=!!(e&&!j.includes(e.name)&&!B.includes(e.name)&&!Z.includes(e.name)),Q=hr.length?hr:p.map(se=>({user_id:se.id,name:se.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]}));return p.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>Fe(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg hover:bg-emerald-700 transition-colors",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(vs,{rows:Q,members:p,showForm:F,currentUserId:n?.id,loading:cn,isLateStartingLeague:V}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(ws,{showForm:F,onToggle:M}),s.jsxs("button",{onClick:()=>Y(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function un(){const j=e?.name==="API Test"?ht??1:f,{state:B}=_n(j);if(!j)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!br(e,j,lr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",j," predictions are not included in this league."]})]})});const Z=new Map;Et.forEach(J=>{if(J.gw!==j)return;const X=tr(J);X&&Z.set(J.fixture_index,X)}),De.forEach(J=>{if(J.gw!==j)return;const X=Ve[J.fixture_index];X&&(X.status==="IN_PLAY"||X.status==="PAUSED"||X.status==="FINISHED")&&(X.homeScore>X.awayScore?Z.set(J.fixture_index,"H"):X.awayScore>X.homeScore?Z.set(J.fixture_index,"A"):Z.set(J.fixture_index,"D"))});const V=z.useMemo(()=>{const J=ie=>{if(!ie)return"Fixtures";const Ee=new Date(ie);return isNaN(Ee.getTime())?"Fixtures":Ee.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},X=new Map;De.filter(ie=>ie.gw===j).forEach(ie=>{const Ee=J(ie.kickoff_time),re=ie.kickoff_time?new Date(ie.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;X.has(Ee)||X.set(Ee,{label:Ee,key:re,items:[]}),X.get(Ee).items.push(ie)});const ge=Array.from(X.values());return ge.forEach(ie=>ie.items.sort((Ee,re)=>Ee.fixture_index-re.fixture_index)),ge.sort((ie,Ee)=>ie.key-Ee.key),ge},[De,j]),Q=new Set(De.filter(J=>J.gw===j).map(J=>J.fixture_index)),se=e?.name==="API Test",ce=p.length>0&&p.every(J=>Be.get(`${J.id}:${j}`));if(se&&j===(ht??1)){console.log("[League] API Test filtering:",{currentFixtureIndices:Array.from(Q),totalPicks:_t.length,picksForGw:_t.filter(X=>X.gw===j).length,submittedMapSize:Be.size,allSubmitted:ce,members:p.map(X=>({id:X.id,name:X.name,submitted:Be.get(`${X.id}:${j}`)})),fixturesCount:De.filter(X=>X.gw===j).length});const J=_t.filter(X=>X.gw===j);console.log(`[League] All picks for GW${j}:`,J.map(X=>({user_id:X.user_id,userName:p.find(ge=>ge.id===X.user_id)?.name,fixture_index:X.fixture_index,pick:X.pick,hasSubmitted:!!Be.get(`${X.user_id}:${j}`),inCurrentFixtures:Q.has(X.fixture_index)})))}const be=new Map;!se||ce?_t.forEach(J=>{if(J.gw!==j)return;if(!Be.get(`${J.user_id}:${j}`)){se&&j===1&&console.log("[League] API Test: Filtering out unsubmitted pick:",{user_id:J.user_id,fixture_index:J.fixture_index,userName:p.find(ie=>ie.id===J.user_id)?.name});return}if(!Q.has(J.fixture_index)){se&&j===1&&console.log("[League] Filtering out old pick (not in current fixtures):",{fixture_index:J.fixture_index,currentIndices:Array.from(Q),userName:p.find(ie=>ie.id===J.user_id)?.name});return}const ge=be.get(J.fixture_index)??[];ge.push(J),be.set(J.fixture_index,ge)}):console.log("[League] API Test: Not all submitted - skipping ALL picks processing. allSubmitted=",ce);const Me=N!==null&&N>=j,Le=p.filter(J=>!Be.get(`${J.id}:${j}`)).length,Pe=p.filter(J=>!Be.get(`${J.id}:${j}`)).map(J=>J.name),ee=B!==null&&(B==="DEADLINE_PASSED"||B==="LIVE"||B==="RESULTS_PRE_GW");if(se&&j===1){const J=p.map(ie=>{const Ee=`${ie.id}:${j}`,re=Be.get(Ee);return{id:ie.id,name:ie.name,submitted:!!re,key:Ee}});console.log(`[League] ===== API Test GW${j} SUBMISSION CHECK =====`),console.log("[League] All submitted:",ce),console.log("[League] Remaining:",Le),console.log("[League] Who didn't submit:",Pe),console.log("[League] Member submission status:",J),console.log("[League] Submitted map entries:",Array.from(Be.entries())),console.log("[League] ================================================");const X=p.find(ie=>ie.name.toLowerCase().includes("steve")||ie.name.toLowerCase().includes("s")),ge=p.find(ie=>ie.name.toLowerCase().includes("jof")||ie.name.toLowerCase().includes("j"));if(X){const ie=`${X.id}:${j}`;console.log(`[League] STEVE (${X.name}):`,{id:X.id,submitted:!!Be.get(ie),key:ie})}if(ge){const ie=`${ge.id}:${j}`;console.log(`[League] JOF (${ge.name}):`,{id:ge.id,submitted:!!Be.get(ie),key:ie})}}console.log(`GW${j} deadline check:`,{gameState:B,deadlinePassed:ee,allSubmitted:ce,willShowPredictions:ce||ee});const ne=se?!ce:!ce&&!ee;return(se?!ce:!ce&&!ee)?(console.log(`[League] Not all submitted, showing ONLY "Who's submitted" view. Blocking all predictions/fixtures.`,{isApiTestLeague:se,allSubmitted:ce,deadlinePassed:ee,remaining:Le}),s.jsx(Tr,{members:p,submittedMap:Be,picksGw:j,allSubmitted:ce,remaining:Le,fixtures:De.filter(J=>J.gw===j),variant:"compact"})):s.jsxs("div",{className:"mt-2 pt-2",children:[ne?s.jsx(Tr,{members:p,submittedMap:Be,picksGw:j,allSubmitted:ce,remaining:Le,fixtures:De.filter(J=>J.gw===j),variant:"full"}):null,e?.name==="API Test"&&ce&&V.length>0&&!ne&&(()=>{const J=V.flatMap(fe=>fe.items),X=new Set(J.map(fe=>fe.fixture_index)),ge={};Object.keys(Ve).forEach(fe=>{const ue=parseInt(fe,10);X.has(ue)&&(ge[ue]=Ve[ue])});const ie=J.some(fe=>{const ue=ge[fe.fixture_index];return ue&&(ue.status==="IN_PLAY"||ue.status==="PAUSED")}),Ee=J.length>0&&J.every(fe=>{const ue=ge[fe.fixture_index];return ue&&ue.status==="FINISHED"}),re=ie||Ee||J.some(fe=>ge[fe.fixture_index]);let _e=0;return n?.id&&J.forEach(fe=>{const ue=ge[fe.fixture_index],ve=ue&&(ue.status==="IN_PLAY"||ue.status==="PAUSED"),Xe=ue&&ue.status==="FINISHED";if(ue&&(ve||Xe)){const Ie=(be.get(fe.fixture_index)??[]).find(Ue=>Ue.user_id===n.id);if(Ie){let Ue=!1;(Ie.pick==="H"&&ue.homeScore>ue.awayScore||Ie.pick==="A"&&ue.awayScore>ue.homeScore||Ie.pick==="D"&&ue.homeScore===ue.awayScore)&&(Ue=!0),Ue&&_e++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:V.map((fe,ue)=>s.jsx(Ur,{label:fe.label,fixtures:fe.items,picksByFixture:be,members:p,outcomes:Z,liveScores:ge,submittedMap:Be,picksGw:j,isApiTestLeague:!0,isFirstSection:ue===0,hasLiveGames:ie,allGamesFinished:Ee,hasStarted:re,liveFixturesCount:_e},ue))})})(),V.length>0&&e?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:V.map((J,X)=>s.jsx(Ur,{label:J.label,fixtures:J.items,picksByFixture:be,members:p,outcomes:Z,liveScores:Ve,submittedMap:Be,picksGw:j,isApiTestLeague:!1,isFirstSection:X===0,allSubmitted:ce,resultsPublished:Me,deadlinePassed:ee,whoDidntSubmit:Pe},X))}),!V.length&&!ne&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",j,"."]})]})}function fn(){const j=e?.name==="API Test"?ht??1:m==="gwr"?y.current?A:f||A:A;if(!j||L.length===0&&e?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!br(e,j,lr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",j," results are not included in this league."]})]})});const B=new Map,Z=e?.name==="API Test",V=De.filter(ee=>ee.gw===j),Q=V.some(ee=>{const ne=Ve[ee.fixture_index];return ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")});console.log("[League] Live Table calculation:",{resGw:j,currentGw:f,selectedGw:A,hasLiveScores:Q,liveScoresCount:Object.keys(Ve).length,isApiTestLeague:Z,fixturesCount:De.length,fixturesForGwCount:V.length,manualGwSelected:y.current}),Z&&j===(ht??1)?V.forEach(ee=>{const ne=Ve[ee.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?B.set(ee.fixture_index,"H"):ne.awayScore>ne.homeScore?B.set(ee.fixture_index,"A"):B.set(ee.fixture_index,"D"))}):Q&&j===f?(console.log("[League] Using live scores for regular league GW",j),V.forEach(ee=>{const ne=Ve[ee.fixture_index];ne&&(ne.status==="IN_PLAY"||ne.status==="PAUSED"||ne.status==="FINISHED")&&(ne.homeScore>ne.awayScore?B.set(ee.fixture_index,"H"):ne.awayScore>ne.homeScore?B.set(ee.fixture_index,"A"):B.set(ee.fixture_index,"D"))}),console.log("[League] Outcomes from live scores:",Array.from(B.entries()))):(console.log("[League] Using results table for GW",j,{hasLiveScores:Q,resGwEqualsCurrentGw:j===f,resultsCount:Et.length,resultsForThisGw:Et.filter(ee=>ee.gw===j).length,manualGwSelected:y.current,selectedGw:A}),Et.forEach(ee=>{if(ee.gw!==j)return;const ne=tr(ee);ne&&B.set(ee.fixture_index,ne)}),console.log("[League] Outcomes from results:",Array.from(B.entries())));const se=p.filter(ee=>Be.get(`${ee.id}:${j}`)).map(ee=>({user_id:ee.id,name:ee.name,score:0,unicorns:0})),ce=new Map;_t.forEach(ee=>{if(ee.gw!==j||!Be.get(`${ee.user_id}:${j}`))return;const ne=ce.get(ee.fixture_index)??[];ne.push(ee),ce.set(ee.fixture_index,ne)}),Array.from(B.entries()).forEach(([ee,ne])=>{const J=(ce.get(ee)??[]).filter(X=>X.pick===ne).map(X=>X.user_id);if(J.forEach(X=>{const ge=se.find(ie=>ie.user_id===X);ge.score+=1}),J.length===1&&p.length>=3){const X=se.find(ge=>ge.user_id===J[0]);X.unicorns+=1}}),se.sort((ee,ne)=>ne.score-ee.score||ne.unicorns-ee.unicorns||ee.name.localeCompare(ne.name)),z.useEffect(()=>{if(se.length===0)return;const ee=new Map;se.forEach((Ne,J)=>{ee.set(Ne.user_id,J)});const ne=new Set;if(ee.forEach((Ne,J)=>{const X=G.current.get(J);X!==void 0&&X!==Ne&&ne.add(J)}),G.current=ee,ne.size>0){H(ne);const Ne=setTimeout(()=>{H(new Set)},2e3);return()=>clearTimeout(Ne)}},[se.map(ee=>`${ee.user_id}-${ee.score}-${ee.unicorns}`).join(",")]);let be=!1,Me=!1,Le=!1,Pe=!1;if(Z&&j===(ht??1)){const ee=De;if(ee.length>0&&(be=ee.every(Ne=>{const J=Ve[Ne.fixture_index];return J&&J.status==="FINISHED"}),Me=!!ee.find(Ne=>{const J=Ve[Ne.fixture_index];return J&&(J.status==="IN_PLAY"||J.status==="PAUSED")}),Pe=ee.some(Ne=>{const J=Ve[Ne.fixture_index];return J&&(J.status==="IN_PLAY"||J.status==="PAUSED"||J.status==="FINISHED")}),!be)){const Ne=new Date;Le=ee.some(J=>{if(!J.kickoff_time)return!1;const ge=new Date(J.kickoff_time).getTime()-Ne.getTime(),ie=Ve[J.fixture_index];return(!ie||ie.status!=="IN_PLAY"&&ie.status!=="PAUSED"&&ie.status!=="FINISHED")&&ge>0&&ge<=1440*60*1e3})}}else{const ee=De.filter(ne=>ne.gw===j);if(ee.length>0){const ne=ee.every(J=>B.has(J.fixture_index)),Ne=ee.some(J=>{const X=Ve[J.fixture_index];return X&&(X.status==="IN_PLAY"||X.status==="PAUSED")});be=ne&&!Ne,console.log(`[League] GW ${j} finished check:`,{allHaveResults:ne,hasActiveGames:Ne,fixturesCount:ee.length,outcomesCount:ee.filter(J=>B.has(J.fixture_index)).length,allFixturesFinished:be})}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),se.length>0&&be&&s.jsx(gs,{winnerName:se[0].name,isDraw:se[0].score===se[1]?.score&&se[0].unicorns===se[1]?.unicorns}),s.jsx(ys,{rows:se,members:p,currentUserId:n?.id,positionChangeKeys:U,isApiTestLeague:Z,hasLiveFixtures:Me,hasStartingSoonFixtures:Le,hasStartedFixtures:Pe,allFixturesFinished:be,resGw:j}),L.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(xs,{availableGws:L,selectedGw:j,onChange:ee=>{y.current=!0,S(ee)}}),s.jsxs("button",{onClick:()=>te(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(wr,{isOpen:W,onClose:()=>te(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return z.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[m]),l?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!e&&!l?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(gr,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):e?s.jsxs("div",{className:`${t?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:I,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(gr,{to:"/leagues",className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{console.log("[League] Badge clicked, opening modal. isMember:",ot),w(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative hover:opacity-80 transition-opacity cursor-pointer",children:e?s.jsx("img",{src:qt(e),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:j=>{const B=j.target;console.error("[League] Badge image failed to load:",B.src,"League:",e);const V=`/assets/league-avatars/${xr(e.id)}`;B.src!==V&&(B.src=V)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:e.name}),A&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",A]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>st(!et),className:"flex items-center justify-center w-8 h-8 rounded-full hover:bg-slate-100 transition-colors -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${et?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[or&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:Kr})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{$(!0),st(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[ot&&s.jsxs("button",{onClick:()=>{de(!0),st(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{Fe(!0),st(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{ar(),st(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{v(!0),st(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 hover:bg-red-50 active:bg-red-100 rounded-lg transition-colors flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${et?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{E.current=!0,k("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),m==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(L.length>0||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{E.current=!0,k("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight flex items-center justify-center gap-1.5 "+(m==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const j=new Date,B=De[0],Z=B?.kickoff_time?new Date(B.kickoff_time):null,V=Z&&Z<=j,se=De[De.length-1]?.fixture_index,be=(se!==void 0?Ve[se]:null)?.status==="FINISHED",Me=V&&!be;return s.jsxs(s.Fragment,{children:[Me&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),m==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(f||e?.name==="API Test")&&s.jsxs("button",{onClick:()=>{E.current=!0,k("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),m==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{E.current=!0,k("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(m==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",m==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),m==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(ps,{miniLeagueId:e?.id??null,memberNames:Zr})}):s.jsx("div",{className:`league-content-wrapper ${et?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[m==="mlt"&&s.jsx(dn,{}),m==="gw"&&s.jsx(un,{}),m==="gwr"&&s.jsx(fn,{})]})}),or&&O&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>$(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("button",{onClick:()=>$(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[p.filter(j=>j.id!==n?.id).map(j=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:j.name}),s.jsx("button",{onClick:()=>{rt(j),pt(!0),$(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 hover:bg-red-200 rounded-md transition-colors font-medium",children:"Remove"})]},j.id)),p.filter(j=>j.id!==n?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{lt(!0),$(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),ot&&ae&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{de(!1),$e&&URL.revokeObjectURL($e),we(null),ye(null),me(!1),Ae(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("button",{onClick:()=>{de(!1),$e&&URL.revokeObjectURL($e),we(null),ye(null),me(!1),Ae(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),ke?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(Qn,{image:ke,crop:Re,zoom:xe,aspect:1,cropShape:"round",showGrid:!1,onCropChange:We,onZoomChange:pe,onCropComplete:nn,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(xe*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:xe,onChange:j=>pe(Number(j.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:$e?s.jsx("img",{src:$e,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),Se&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Se}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{$e&&URL.revokeObjectURL($e),we(null),We({x:0,y:0}),pe(1),ze(null),Ae(null)},disabled:he,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:sn,disabled:he||!Te,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:he?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:e?qt(e):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:j=>{const B=j.target;B.src="/assets/league-avatars/ML-avatar-1.png"}})}),e?.avatar&&s.jsx("button",{onClick:on,disabled:he,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:j=>{const B=j.target.files?.[0];B&&rn(B)},disabled:he,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] transition-colors touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),he&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),je&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),Se&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:Se})]})]})]})]})}),s.jsx(wr,{isOpen:K,onClose:()=>Y(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${e&&(["The Bird league"].includes(e.name)||["gregVjofVcarl","Let Down"].includes(e.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),it&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",er," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:e.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.code)},className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Copy"}),s.jsx("button",{onClick:ar,className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[p.length,"/",er," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>Fe(!1),className:"px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50",children:"Close"})})]})}),T&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',e?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>v(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:P,children:"Cancel"}),s.jsx("button",{onClick:Jr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:P,children:P?"Leaving...":"Leave League"})]})]})}),Ke&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',e?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>qe(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:Ze,children:"Cancel"}),s.jsx("button",{onClick:Qr,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md hover:bg-emerald-700 transition-colors disabled:opacity-50",disabled:Ze,children:Ze?"Joining...":"Join League"})]})]})}),$t&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',xt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>pt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:tt,children:"Cancel"}),s.jsx("button",{onClick:Xr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:tt,children:tt?"Removing...":"Remove Member"})]})]})}),Nt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',e?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>lt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:dt,children:"Cancel"}),s.jsx("button",{onClick:en,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:dt,children:dt?"Ending...":"Yes, End League"})]})]})}),e?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),c&&e&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>w(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:j=>j.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:qt(e),alt:"League badge",className:"w-full h-full object-cover",onError:j=>{const B=j.target,V=`/assets/league-avatars/${xr(e.id)}`;B.src!==V&&(B.src=V)}})}),ot&&s.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),console.log("[League] Edit icon clicked"),w(!1),de(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white hover:bg-slate-50 shadow-2xl flex items-center justify-center transition-all z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:e.name})]})})]}):null}export{As as default};
