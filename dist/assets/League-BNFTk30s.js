import{g as En,r as U,s as ae,a as Fe,j as s,V as An,b as Yr,u as Kr,i as Rn,c as Nr,T as kr,D as Mn,d as Ln,e as Tn,f as Dn,h as Jt,k as Pn,l as Un,m as In,L as Er,n as Qt,o as Ar,I as Rr,p as Tt,q as Mr,C as Fn}from"./index-BBpCtrxf.js";function zn(d,h){return h.forEach((function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if(r!=="default"&&!(r in d)){var e=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(d,r,e.get?e:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(d)}function Zr(d,h){return new Promise((function(t,r){let e;return Wn(d).then((function(n){try{return e=n,t(new Blob([h.slice(0,2),e,h.slice(2)],{type:"image/jpeg"}))}catch(a){return r(a)}}),r)}))}const Wn=d=>new Promise(((h,t)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:e}})=>{const n=new DataView(e);let a=0;if(n.getUint16(a)!==65496)return t("not a valid JPEG");for(a+=2;;){const c=n.getUint16(a);if(c===65498)break;const w=n.getUint16(a+2);if(c===65505&&n.getUint32(a+4)===1165519206){const b=a+10;let o;switch(n.getUint16(b)){case 18761:o=!0;break;case 19789:o=!1;break;default:return t("TIFF header contains invalid endian")}if(n.getUint16(b+2,o)!==42)return t("TIFF header contains invalid version");const i=n.getUint32(b+4,o),l=b+i+2+12*n.getUint16(b+i,o);for(let u=b+i+2;u<l;u+=12)if(n.getUint16(u,o)==274){if(n.getUint16(u+2,o)!==3)return t("Orientation data type is invalid");if(n.getUint32(u+4,o)!==1)return t("Orientation data count is invalid");n.setUint16(u+8,1,o);break}return h(e.slice(a,a+2+w))}a+=2+w}return h(new Blob)})),r.readAsArrayBuffer(d)}));var It={},$n={get exports(){return It},set exports(d){It=d}};(function(d){var h,t,r={};$n.exports=r,r.parse=function(e,n){for(var a=r.bin.readUshort,c=r.bin.readUint,w=0,b={},o=new Uint8Array(e),i=o.length-4;c(o,i)!=101010256;)i--;w=i,w+=4;var l=a(o,w+=4);a(o,w+=2);var u=c(o,w+=2),p=c(o,w+=4);w+=4,w=p;for(var k=0;k<l;k++){c(o,w),w+=4,w+=4,w+=4,c(o,w+=4),u=c(o,w+=4);var _=c(o,w+=4),y=a(o,w+=4),D=a(o,w+2),I=a(o,w+4);w+=6;var P=c(o,w+=8);w+=4,w+=y+D+I,r._readLocal(o,P,b,u,_,n)}return b},r._readLocal=function(e,n,a,c,w,b){var o=r.bin.readUshort,i=r.bin.readUint;i(e,n),o(e,n+=4),o(e,n+=2);var l=o(e,n+=2);i(e,n+=2),i(e,n+=4),n+=4;var u=o(e,n+=8),p=o(e,n+=2);n+=2;var k=r.bin.readUTF8(e,n,u);if(n+=u,n+=p,b)a[k]={size:w,csize:c};else{var _=new Uint8Array(e.buffer,n);if(l==0)a[k]=new Uint8Array(_.buffer.slice(n,n+c));else{if(l!=8)throw"unknown compression method: "+l;var y=new Uint8Array(w);r.inflateRaw(_,y),a[k]=y}}},r.inflateRaw=function(e,n){return r.F.inflate(e,n)},r.inflate=function(e,n){return e[0],e[1],r.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),n)},r.deflate=function(e,n){n==null&&(n={level:6});var a=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[a]=120,c[a+1]=156,a+=2,a=r.F.deflateRaw(e,c,a,n.level);var w=r.adler(e,0,e.length);return c[a+0]=w>>>24&255,c[a+1]=w>>>16&255,c[a+2]=w>>>8&255,c[a+3]=w>>>0&255,new Uint8Array(c.buffer,0,a+4)},r.deflateRaw=function(e,n){n==null&&(n={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),c=r.F.deflateRaw(e,a,c,n.level);return new Uint8Array(a.buffer,0,c)},r.encode=function(e,n){n==null&&(n=!1);var a=0,c=r.bin.writeUint,w=r.bin.writeUshort,b={};for(var o in e){var i=!r._noNeed(o)&&!n,l=e[o],u=r.crc.crc(l,0,l.length);b[o]={cpr:i,usize:l.length,crc:u,file:i?r.deflateRaw(l):l}}for(var o in b)a+=b[o].file.length+30+46+2*r.bin.sizeUTF8(o);a+=22;var p=new Uint8Array(a),k=0,_=[];for(var o in b){var y=b[o];_.push(k),k=r._writeHeader(p,k,o,y,0)}var D=0,I=k;for(var o in b)y=b[o],_.push(k),k=r._writeHeader(p,k,o,y,1,_[D++]);var P=k-I;return c(p,k,101010256),k+=4,w(p,k+=4,D),w(p,k+=2,D),c(p,k+=2,P),c(p,k+=4,I),k+=4,k+=2,p.buffer},r._noNeed=function(e){var n=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},r._writeHeader=function(e,n,a,c,w,b){var o=r.bin.writeUint,i=r.bin.writeUshort,l=c.file;return o(e,n,w==0?67324752:33639248),n+=4,w==1&&(n+=2),i(e,n,20),i(e,n+=2,0),i(e,n+=2,c.cpr?8:0),o(e,n+=2,0),o(e,n+=4,c.crc),o(e,n+=4,l.length),o(e,n+=4,c.usize),i(e,n+=4,r.bin.sizeUTF8(a)),i(e,n+=2,0),n+=2,w==1&&(n+=2,n+=2,o(e,n+=6,b),n+=4),n+=r.bin.writeUTF8(e,n,a),w==0&&(e.set(l,n),n+=l.length),n},r.crc={table:(function(){for(var e=new Uint32Array(256),n=0;n<256;n++){for(var a=n,c=0;c<8;c++)1&a?a=3988292384^a>>>1:a>>>=1;e[n]=a}return e})(),update:function(e,n,a,c){for(var w=0;w<c;w++)e=r.crc.table[255&(e^n[a+w])]^e>>>8;return e},crc:function(e,n,a){return 4294967295^r.crc.update(4294967295,e,n,a)}},r.adler=function(e,n,a){for(var c=1,w=0,b=n,o=n+a;b<o;){for(var i=Math.min(b+5552,o);b<i;)w+=c+=e[b++];c%=65521,w%=65521}return w<<16|c},r.bin={readUshort:function(e,n){return e[n]|e[n+1]<<8},writeUshort:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255},readUint:function(e,n){return 16777216*e[n+3]+(e[n+2]<<16|e[n+1]<<8|e[n])},writeUint:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255,e[n+2]=a>>16&255,e[n+3]=a>>24&255},readASCII:function(e,n,a){for(var c="",w=0;w<a;w++)c+=String.fromCharCode(e[n+w]);return c},writeASCII:function(e,n,a){for(var c=0;c<a.length;c++)e[n+c]=a.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,n,a){for(var c,w="",b=0;b<a;b++)w+="%"+r.bin.pad(e[n+b].toString(16));try{c=decodeURIComponent(w)}catch{return r.bin.readASCII(e,n,a)}return c},writeUTF8:function(e,n,a){for(var c=a.length,w=0,b=0;b<c;b++){var o=a.charCodeAt(b);if((4294967168&o)==0)e[n+w]=o,w++;else if((4294965248&o)==0)e[n+w]=192|o>>6,e[n+w+1]=128|o>>0&63,w+=2;else if((4294901760&o)==0)e[n+w]=224|o>>12,e[n+w+1]=128|o>>6&63,e[n+w+2]=128|o>>0&63,w+=3;else{if((4292870144&o)!=0)throw"e";e[n+w]=240|o>>18,e[n+w+1]=128|o>>12&63,e[n+w+2]=128|o>>6&63,e[n+w+3]=128|o>>0&63,w+=4}}return w},sizeUTF8:function(e){for(var n=e.length,a=0,c=0;c<n;c++){var w=e.charCodeAt(c);if((4294967168&w)==0)a++;else if((4294965248&w)==0)a+=2;else if((4294901760&w)==0)a+=3;else{if((4292870144&w)!=0)throw"e";a+=4}}return a}},r.F={},r.F.deflateRaw=function(e,n,a,c){var w=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],b=r.F.U,o=r.F._goodIndex;r.F._hash;var i=r.F._putsE,l=0,u=a<<3,p=0,k=e.length;if(c==0){for(;l<k;)i(n,u,l+(A=Math.min(65535,k-l))==k?1:0),u=r.F._copyExact(e,l,A,n,u+8),l+=A;return u>>>3}var _=b.lits,y=b.strt,D=b.prev,I=0,P=0,F=0,j=0,W=0,x=0;for(k>2&&(y[x=r.F._hash(e,0)]=0),l=0;l<k;l++){if(W=x,l+1<k-2){x=r.F._hash(e,l+1);var m=l+1&32767;D[m]=y[x],y[x]=m}if(p<=l){(I>14e3||P>26697)&&k-l>100&&(p<l&&(_[I]=l-p,I+=2,p=l),u=r.F._writeBlock(l==k-1||p==k?1:0,_,I,j,e,F,l-F,n,u),I=P=j=0,F=l);var C=0;l<k-2&&(C=r.F._bestMatch(e,l,D,W,Math.min(w[2],k-l),w[3]));var A=C>>>16,R=65535&C;if(C!=0){R=65535&C;var L=o(A=C>>>16,b.of0);b.lhst[257+L]++;var N=o(R,b.df0);b.dhst[N]++,j+=b.exb[L]+b.dxb[N],_[I]=A<<23|l-p,_[I+1]=R<<16|L<<8|N,I+=2,p=l+A}else b.lhst[e[l]]++;P++}}for(F==l&&e.length!=0||(p<l&&(_[I]=l-p,I+=2,p=l),u=r.F._writeBlock(1,_,I,j,e,F,l-F,n,u),I=0,P=0,I=P=j=0,F=l);(7&u)!=0;)u++;return u>>>3},r.F._bestMatch=function(e,n,a,c,w,b){var o=32767&n,i=a[o],l=o-i+32768&32767;if(i==o||c!=r.F._hash(e,n-l))return 0;for(var u=0,p=0,k=Math.min(32767,n);l<=k&&--b!=0&&i!=o;){if(u==0||e[n+u]==e[n+u-l]){var _=r.F._howLong(e,n,l);if(_>u){if(p=l,(u=_)>=w)break;l+2<_&&(_=l+2);for(var y=0,D=0;D<_-2;D++){var I=n-l+D+32768&32767,P=I-a[I]+32768&32767;P>y&&(y=P,i=I)}}}l+=(o=i)-(i=a[o])+32768&32767}return u<<16|p},r.F._howLong=function(e,n,a){if(e[n]!=e[n-a]||e[n+1]!=e[n+1-a]||e[n+2]!=e[n+2-a])return 0;var c=n,w=Math.min(e.length,n+258);for(n+=3;n<w&&e[n]==e[n-a];)n++;return n-c},r.F._hash=function(e,n){return(e[n]<<8|e[n+1])+(e[n+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(e,n,a,c,w,b,o,i,l){var u,p,k,_,y,D,I,P,F,j=r.F.U,W=r.F._putsF,x=r.F._putsE;j.lhst[256]++,p=(u=r.F.getTrees())[0],k=u[1],_=u[2],y=u[3],D=u[4],I=u[5],P=u[6],F=u[7];var m=32+((l+3&7)==0?0:8-(l+3&7))+(o<<3),C=c+r.F.contSize(j.fltree,j.lhst)+r.F.contSize(j.fdtree,j.dhst),A=c+r.F.contSize(j.ltree,j.lhst)+r.F.contSize(j.dtree,j.dhst);A+=14+3*I+r.F.contSize(j.itree,j.ihst)+(2*j.ihst[16]+3*j.ihst[17]+7*j.ihst[18]);for(var R=0;R<286;R++)j.lhst[R]=0;for(R=0;R<30;R++)j.dhst[R]=0;for(R=0;R<19;R++)j.ihst[R]=0;var L=m<C&&m<A?0:C<A?1:2;if(W(i,l,e),W(i,l+1,L),l+=3,L==0){for(;(7&l)!=0;)l++;l=r.F._copyExact(w,b,o,i,l)}else{var N,E;if(L==1&&(N=j.fltree,E=j.fdtree),L==2){r.F.makeCodes(j.ltree,p),r.F.revCodes(j.ltree,p),r.F.makeCodes(j.dtree,k),r.F.revCodes(j.dtree,k),r.F.makeCodes(j.itree,_),r.F.revCodes(j.itree,_),N=j.ltree,E=j.dtree,x(i,l,y-257),x(i,l+=5,D-1),x(i,l+=5,I-4),l+=4;for(var g=0;g<I;g++)x(i,l+3*g,j.itree[1+(j.ordr[g]<<1)]);l+=3*I,l=r.F._codeTiny(P,j.itree,i,l),l=r.F._codeTiny(F,j.itree,i,l)}for(var f=b,B=0;B<a;B+=2){for(var v=n[B],T=v>>>23,Y=f+(8388607&v);f<Y;)l=r.F._writeLit(w[f++],N,i,l);if(T!=0){var G=n[B+1],$=G>>16,H=G>>8&255,M=255&G;x(i,l=r.F._writeLit(257+H,N,i,l),T-j.of0[H]),l+=j.exb[H],W(i,l=r.F._writeLit(M,E,i,l),$-j.df0[M]),l+=j.dxb[M],f+=T}}l=r.F._writeLit(256,N,i,l)}return l},r.F._copyExact=function(e,n,a,c,w){var b=w>>>3;return c[b]=a,c[b+1]=a>>>8,c[b+2]=255-c[b],c[b+3]=255-c[b+1],b+=4,c.set(new Uint8Array(e.buffer,n,a),b),w+(a+4<<3)},r.F.getTrees=function(){for(var e=r.F.U,n=r.F._hufTree(e.lhst,e.ltree,15),a=r.F._hufTree(e.dhst,e.dtree,15),c=[],w=r.F._lenCodes(e.ltree,c),b=[],o=r.F._lenCodes(e.dtree,b),i=0;i<c.length;i+=2)e.ihst[c[i]]++;for(i=0;i<b.length;i+=2)e.ihst[b[i]]++;for(var l=r.F._hufTree(e.ihst,e.itree,7),u=19;u>4&&e.itree[1+(e.ordr[u-1]<<1)]==0;)u--;return[n,a,l,w,o,u,c,b]},r.F.getSecond=function(e){for(var n=[],a=0;a<e.length;a+=2)n.push(e[a+1]);return n},r.F.nonZero=function(e){for(var n="",a=0;a<e.length;a+=2)e[a+1]!=0&&(n+=(a>>1)+",");return n},r.F.contSize=function(e,n){for(var a=0,c=0;c<n.length;c++)a+=n[c]*e[1+(c<<1)];return a},r.F._codeTiny=function(e,n,a,c){for(var w=0;w<e.length;w+=2){var b=e[w],o=e[w+1];c=r.F._writeLit(b,n,a,c);var i=b==16?2:b==17?3:7;b>15&&(r.F._putsE(a,c,o,i),c+=i)}return c},r.F._lenCodes=function(e,n){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var c=0;c<a;c+=2){var w=e[c+1],b=c+3<a?e[c+3]:-1,o=c+5<a?e[c+5]:-1,i=c==0?-1:e[c-1];if(w==0&&b==w&&o==w){for(var l=c+5;l+2<a&&e[l+2]==w;)l+=2;(u=Math.min(l+1-c>>>1,138))<11?n.push(17,u-3):n.push(18,u-11),c+=2*u-2}else if(w==i&&b==w&&o==w){for(l=c+5;l+2<a&&e[l+2]==w;)l+=2;var u=Math.min(l+1-c>>>1,6);n.push(16,u-3),c+=2*u-2}else n.push(w,0)}return a>>>1},r.F._hufTree=function(e,n,a){var c=[],w=e.length,b=n.length,o=0;for(o=0;o<b;o+=2)n[o]=0,n[o+1]=0;for(o=0;o<w;o++)e[o]!=0&&c.push({lit:o,f:e[o]});var i=c.length,l=c.slice(0);if(i==0)return 0;if(i==1){var u=c[0].lit;return l=u==0?1:0,n[1+(u<<1)]=1,n[1+(l<<1)]=1,1}c.sort((function(P,F){return P.f-F.f}));var p=c[0],k=c[1],_=0,y=1,D=2;for(c[0]={lit:-1,f:p.f+k.f,l:p,r:k,d:0};y!=i-1;)p=_!=y&&(D==i||c[_].f<c[D].f)?c[_++]:c[D++],k=_!=y&&(D==i||c[_].f<c[D].f)?c[_++]:c[D++],c[y++]={lit:-1,f:p.f+k.f,l:p,r:k};var I=r.F.setDepth(c[y-1],0);for(I>a&&(r.F.restrictDepth(l,a,I),I=a),o=0;o<i;o++)n[1+(l[o].lit<<1)]=l[o].d;return I},r.F.setDepth=function(e,n){return e.lit!=-1?(e.d=n,n):Math.max(r.F.setDepth(e.l,n+1),r.F.setDepth(e.r,n+1))},r.F.restrictDepth=function(e,n,a){var c=0,w=1<<a-n,b=0;for(e.sort((function(i,l){return l.d==i.d?i.f-l.f:l.d-i.d})),c=0;c<e.length&&e[c].d>n;c++){var o=e[c].d;e[c].d=n,b+=w-(1<<a-o)}for(b>>>=a-n;b>0;)(o=e[c].d)<n?(e[c].d++,b-=1<<n-o-1):c++;for(;c>=0;c--)e[c].d==n&&b<0&&(e[c].d--,b++);b!=0&&console.log("debt left")},r.F._goodIndex=function(e,n){var a=0;return n[16|a]<=e&&(a|=16),n[8|a]<=e&&(a|=8),n[4|a]<=e&&(a|=4),n[2|a]<=e&&(a|=2),n[1|a]<=e&&(a|=1),a},r.F._writeLit=function(e,n,a,c){return r.F._putsF(a,c,n[e<<1]),c+n[1+(e<<1)]},r.F.inflate=function(e,n){var a=Uint8Array;if(e[0]==3&&e[1]==0)return n||new a(0);var c=r.F,w=c._bitsF,b=c._bitsE,o=c._decodeTiny,i=c.makeCodes,l=c.codes2map,u=c._get17,p=c.U,k=n==null;k&&(n=new a(e.length>>>2<<3));for(var _,y,D=0,I=0,P=0,F=0,j=0,W=0,x=0,m=0,C=0;D==0;)if(D=w(e,C,1),I=w(e,C+1,2),C+=3,I!=0){if(k&&(n=r.F._check(n,m+(1<<17))),I==1&&(_=p.flmap,y=p.fdmap,W=511,x=31),I==2){P=b(e,C,5)+257,F=b(e,C+5,5)+1,j=b(e,C+10,4)+4,C+=14;for(var A=0;A<38;A+=2)p.itree[A]=0,p.itree[A+1]=0;var R=1;for(A=0;A<j;A++){var L=b(e,C+3*A,3);p.itree[1+(p.ordr[A]<<1)]=L,L>R&&(R=L)}C+=3*j,i(p.itree,R),l(p.itree,R,p.imap),_=p.lmap,y=p.dmap,C=o(p.imap,(1<<R)-1,P+F,e,C,p.ttree);var N=c._copyOut(p.ttree,0,P,p.ltree);W=(1<<N)-1;var E=c._copyOut(p.ttree,P,F,p.dtree);x=(1<<E)-1,i(p.ltree,N),l(p.ltree,N,_),i(p.dtree,E),l(p.dtree,E,y)}for(;;){var g=_[u(e,C)&W];C+=15&g;var f=g>>>4;if(!(f>>>8))n[m++]=f;else{if(f==256)break;var B=m+f-254;if(f>264){var v=p.ldef[f-257];B=m+(v>>>3)+b(e,C,7&v),C+=7&v}var T=y[u(e,C)&x];C+=15&T;var Y=T>>>4,G=p.ddef[Y],$=(G>>>4)+w(e,C,15&G);for(C+=15&G,k&&(n=r.F._check(n,m+(1<<17)));m<B;)n[m]=n[m++-$],n[m]=n[m++-$],n[m]=n[m++-$],n[m]=n[m++-$];m=B}}}else{(7&C)!=0&&(C+=8-(7&C));var H=4+(C>>>3),M=e[H-4]|e[H-3]<<8;k&&(n=r.F._check(n,m+M)),n.set(new a(e.buffer,e.byteOffset+H,M),m),C=H+M<<3,m+=M}return n.length==m?n:n.slice(0,m)},r.F._check=function(e,n){var a=e.length;if(n<=a)return e;var c=new Uint8Array(Math.max(a<<1,n));return c.set(e,0),c},r.F._decodeTiny=function(e,n,a,c,w,b){for(var o=r.F._bitsE,i=r.F._get17,l=0;l<a;){var u=e[i(c,w)&n];w+=15&u;var p=u>>>4;if(p<=15)b[l]=p,l++;else{var k=0,_=0;p==16?(_=3+o(c,w,2),w+=2,k=b[l-1]):p==17?(_=3+o(c,w,3),w+=3):p==18&&(_=11+o(c,w,7),w+=7);for(var y=l+_;l<y;)b[l]=k,l++}}return w},r.F._copyOut=function(e,n,a,c){for(var w=0,b=0,o=c.length>>>1;b<a;){var i=e[b+n];c[b<<1]=0,c[1+(b<<1)]=i,i>w&&(w=i),b++}for(;b<o;)c[b<<1]=0,c[1+(b<<1)]=0,b++;return w},r.F.makeCodes=function(e,n){for(var a,c,w,b,o=r.F.U,i=e.length,l=o.bl_count,u=0;u<=n;u++)l[u]=0;for(u=1;u<i;u+=2)l[e[u]]++;var p=o.next_code;for(a=0,l[0]=0,c=1;c<=n;c++)a=a+l[c-1]<<1,p[c]=a;for(w=0;w<i;w+=2)(b=e[w+1])!=0&&(e[w]=p[b],p[b]++)},r.F.codes2map=function(e,n,a){for(var c=e.length,w=r.F.U.rev15,b=0;b<c;b+=2)if(e[b+1]!=0)for(var o=b>>1,i=e[b+1],l=o<<4|i,u=n-i,p=e[b]<<u,k=p+(1<<u);p!=k;)a[w[p]>>>15-n]=l,p++},r.F.revCodes=function(e,n){for(var a=r.F.U.rev15,c=15-n,w=0;w<e.length;w+=2){var b=e[w]<<n-e[w+1];e[w]=a[b]>>>c}},r.F._putsE=function(e,n,a){a<<=7&n;var c=n>>>3;e[c]|=a,e[c+1]|=a>>>8},r.F._putsF=function(e,n,a){a<<=7&n;var c=n>>>3;e[c]|=a,e[c+1]|=a>>>8,e[c+2]|=a>>>16},r.F._bitsE=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8)>>>(7&n)&(1<<a)-1},r.F._bitsF=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)&(1<<a)-1},r.F._get17=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)},r.F._get25=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16|e[3+(n>>>3)]<<24)>>>(7&n)},r.F.U=(h=Uint16Array,t=Uint32Array,{next_code:new h(16),bl_count:new h(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new h(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new h(512),fltree:[],fdmap:new h(32),fdtree:[],lmap:new h(32768),ltree:[],ttree:[],dmap:new h(32768),dtree:[],imap:new h(512),itree:[],rev15:new h(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new h(65536),prev:new h(32768)}),(function(){for(var e=r.F.U,n=0;n<32768;n++){var a=n;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[n]=(a>>>16|a<<16)>>>17}function c(w,b,o){for(;b--!=0;)w.push(0,o)}for(n=0;n<32;n++)e.ldef[n]=e.of0[n]<<3|e.exb[n],e.ddef[n]=e.df0[n]<<4|e.dxb[n];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),r.F.makeCodes(e.fltree,9),r.F.codes2map(e.fltree,9,e.flmap),r.F.revCodes(e.fltree,9),c(e.fdtree,32,5),r.F.makeCodes(e.fdtree,5),r.F.codes2map(e.fdtree,5,e.fdmap),r.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)})()})();var Hn=zn({__proto__:null,default:It},[It]);const at=(function(){var d={nextZero(o,i){for(;o[i]!=0;)i++;return i},readUshort:(o,i)=>o[i]<<8|o[i+1],writeUshort(o,i,l){o[i]=l>>8&255,o[i+1]=255&l},readUint:(o,i)=>16777216*o[i]+(o[i+1]<<16|o[i+2]<<8|o[i+3]),writeUint(o,i,l){o[i]=l>>24&255,o[i+1]=l>>16&255,o[i+2]=l>>8&255,o[i+3]=255&l},readASCII(o,i,l){let u="";for(let p=0;p<l;p++)u+=String.fromCharCode(o[i+p]);return u},writeASCII(o,i,l){for(let u=0;u<l.length;u++)o[i+u]=l.charCodeAt(u)},readBytes(o,i,l){const u=[];for(let p=0;p<l;p++)u.push(o[i+p]);return u},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,i,l){let u,p="";for(let k=0;k<l;k++)p+=`%${d.pad(o[i+k].toString(16))}`;try{u=decodeURIComponent(p)}catch{return d.readASCII(o,i,l)}return u}};function h(o,i,l,u){const p=i*l,k=n(u),_=Math.ceil(i*k/8),y=new Uint8Array(4*p),D=new Uint32Array(y.buffer),{ctype:I}=u,{depth:P}=u,F=d.readUshort;if(I==6){const v=p<<2;if(P==8)for(var j=0;j<v;j+=4)y[j]=o[j],y[j+1]=o[j+1],y[j+2]=o[j+2],y[j+3]=o[j+3];if(P==16)for(j=0;j<v;j++)y[j]=o[j<<1]}else if(I==2){const v=u.tabs.tRNS;if(v==null){if(P==8)for(j=0;j<p;j++){var W=3*j;D[j]=255<<24|o[W+2]<<16|o[W+1]<<8|o[W]}if(P==16)for(j=0;j<p;j++)W=6*j,D[j]=255<<24|o[W+4]<<16|o[W+2]<<8|o[W]}else{var x=v[0];const T=v[1],Y=v[2];if(P==8)for(j=0;j<p;j++){var m=j<<2;W=3*j,D[j]=255<<24|o[W+2]<<16|o[W+1]<<8|o[W],o[W]==x&&o[W+1]==T&&o[W+2]==Y&&(y[m+3]=0)}if(P==16)for(j=0;j<p;j++)m=j<<2,W=6*j,D[j]=255<<24|o[W+4]<<16|o[W+2]<<8|o[W],F(o,W)==x&&F(o,W+2)==T&&F(o,W+4)==Y&&(y[m+3]=0)}}else if(I==3){const v=u.tabs.PLTE,T=u.tabs.tRNS,Y=T?T.length:0;if(P==1)for(var C=0;C<l;C++){var A=C*_,R=C*i;for(j=0;j<i;j++){m=R+j<<2;var L=3*(N=o[A+(j>>3)]>>7-((7&j)<<0)&1);y[m]=v[L],y[m+1]=v[L+1],y[m+2]=v[L+2],y[m+3]=N<Y?T[N]:255}}if(P==2)for(C=0;C<l;C++)for(A=C*_,R=C*i,j=0;j<i;j++)m=R+j<<2,L=3*(N=o[A+(j>>2)]>>6-((3&j)<<1)&3),y[m]=v[L],y[m+1]=v[L+1],y[m+2]=v[L+2],y[m+3]=N<Y?T[N]:255;if(P==4)for(C=0;C<l;C++)for(A=C*_,R=C*i,j=0;j<i;j++)m=R+j<<2,L=3*(N=o[A+(j>>1)]>>4-((1&j)<<2)&15),y[m]=v[L],y[m+1]=v[L+1],y[m+2]=v[L+2],y[m+3]=N<Y?T[N]:255;if(P==8)for(j=0;j<p;j++){var N;m=j<<2,L=3*(N=o[j]),y[m]=v[L],y[m+1]=v[L+1],y[m+2]=v[L+2],y[m+3]=N<Y?T[N]:255}}else if(I==4){if(P==8)for(j=0;j<p;j++){m=j<<2;var E=o[g=j<<1];y[m]=E,y[m+1]=E,y[m+2]=E,y[m+3]=o[g+1]}if(P==16)for(j=0;j<p;j++){var g;m=j<<2,E=o[g=j<<2],y[m]=E,y[m+1]=E,y[m+2]=E,y[m+3]=o[g+2]}}else if(I==0)for(x=u.tabs.tRNS?u.tabs.tRNS:-1,C=0;C<l;C++){const v=C*_,T=C*i;if(P==1)for(var f=0;f<i;f++){var B=(E=255*(o[v+(f>>>3)]>>>7-(7&f)&1))==255*x?0:255;D[T+f]=B<<24|E<<16|E<<8|E}else if(P==2)for(f=0;f<i;f++)B=(E=85*(o[v+(f>>>2)]>>>6-((3&f)<<1)&3))==85*x?0:255,D[T+f]=B<<24|E<<16|E<<8|E;else if(P==4)for(f=0;f<i;f++)B=(E=17*(o[v+(f>>>1)]>>>4-((1&f)<<2)&15))==17*x?0:255,D[T+f]=B<<24|E<<16|E<<8|E;else if(P==8)for(f=0;f<i;f++)B=(E=o[v+f])==x?0:255,D[T+f]=B<<24|E<<16|E<<8|E;else if(P==16)for(f=0;f<i;f++)E=o[v+(f<<1)],B=F(o,v+(f<<1))==x?0:255,D[T+f]=B<<24|E<<16|E<<8|E}return y}function t(o,i,l,u){const p=n(o),k=Math.ceil(l*p/8),_=new Uint8Array((k+1+o.interlace)*u);return i=o.tabs.CgBI?e(i,_):r(i,_),o.interlace==0?i=a(i,o,0,l,u):o.interlace==1&&(i=(function(D,I){const P=I.width,F=I.height,j=n(I),W=j>>3,x=Math.ceil(P*j/8),m=new Uint8Array(F*x);let C=0;const A=[0,0,4,0,2,0,1],R=[0,4,0,2,0,1,0],L=[8,8,8,4,4,2,2],N=[8,8,4,4,2,2,1];let E=0;for(;E<7;){const f=L[E],B=N[E];let v=0,T=0,Y=A[E];for(;Y<F;)Y+=f,T++;let G=R[E];for(;G<P;)G+=B,v++;const $=Math.ceil(v*j/8);a(D,I,C,v,T);let H=0,M=A[E];for(;M<F;){let J=R[E],Q=C+H*$<<3;for(;J<P;){var g;if(j==1&&(g=(g=D[Q>>3])>>7-(7&Q)&1,m[M*x+(J>>3)]|=g<<7-((7&J)<<0)),j==2&&(g=(g=D[Q>>3])>>6-(7&Q)&3,m[M*x+(J>>2)]|=g<<6-((3&J)<<1)),j==4&&(g=(g=D[Q>>3])>>4-(7&Q)&15,m[M*x+(J>>1)]|=g<<4-((1&J)<<2)),j>=8){const ne=M*x+J*W;for(let fe=0;fe<W;fe++)m[ne+fe]=D[(Q>>3)+fe]}Q+=j,J+=B}H++,M+=f}v*T!=0&&(C+=T*(1+$)),E+=1}return m})(i,o)),i}function r(o,i){return e(new Uint8Array(o.buffer,2,o.length-6),i)}var e=(function(){const o={H:{}};return o.H.N=function(i,l){const u=Uint8Array;let p,k,_=0,y=0,D=0,I=0,P=0,F=0,j=0,W=0,x=0;if(i[0]==3&&i[1]==0)return l||new u(0);const m=o.H,C=m.b,A=m.e,R=m.R,L=m.n,N=m.A,E=m.Z,g=m.m,f=l==null;for(f&&(l=new u(i.length>>>2<<5));_==0;)if(_=C(i,x,1),y=C(i,x+1,2),x+=3,y!=0){if(f&&(l=o.H.W(l,W+(1<<17))),y==1&&(p=g.J,k=g.h,F=511,j=31),y==2){D=A(i,x,5)+257,I=A(i,x+5,5)+1,P=A(i,x+10,4)+4,x+=14;let v=1;for(var B=0;B<38;B+=2)g.Q[B]=0,g.Q[B+1]=0;for(B=0;B<P;B++){const G=A(i,x+3*B,3);g.Q[1+(g.X[B]<<1)]=G,G>v&&(v=G)}x+=3*P,L(g.Q,v),N(g.Q,v,g.u),p=g.w,k=g.d,x=R(g.u,(1<<v)-1,D+I,i,x,g.v);const T=m.V(g.v,0,D,g.C);F=(1<<T)-1;const Y=m.V(g.v,D,I,g.D);j=(1<<Y)-1,L(g.C,T),N(g.C,T,p),L(g.D,Y),N(g.D,Y,k)}for(;;){const v=p[E(i,x)&F];x+=15&v;const T=v>>>4;if(!(T>>>8))l[W++]=T;else{if(T==256)break;{let Y=W+T-254;if(T>264){const J=g.q[T-257];Y=W+(J>>>3)+A(i,x,7&J),x+=7&J}const G=k[E(i,x)&j];x+=15&G;const $=G>>>4,H=g.c[$],M=(H>>>4)+C(i,x,15&H);for(x+=15&H;W<Y;)l[W]=l[W++-M],l[W]=l[W++-M],l[W]=l[W++-M],l[W]=l[W++-M];W=Y}}}}else{(7&x)!=0&&(x+=8-(7&x));const v=4+(x>>>3),T=i[v-4]|i[v-3]<<8;f&&(l=o.H.W(l,W+T)),l.set(new u(i.buffer,i.byteOffset+v,T),W),x=v+T<<3,W+=T}return l.length==W?l:l.slice(0,W)},o.H.W=function(i,l){const u=i.length;if(l<=u)return i;const p=new Uint8Array(u<<1);return p.set(i,0),p},o.H.R=function(i,l,u,p,k,_){const y=o.H.e,D=o.H.Z;let I=0;for(;I<u;){const P=i[D(p,k)&l];k+=15&P;const F=P>>>4;if(F<=15)_[I]=F,I++;else{let j=0,W=0;F==16?(W=3+y(p,k,2),k+=2,j=_[I-1]):F==17?(W=3+y(p,k,3),k+=3):F==18&&(W=11+y(p,k,7),k+=7);const x=I+W;for(;I<x;)_[I]=j,I++}}return k},o.H.V=function(i,l,u,p){let k=0,_=0;const y=p.length>>>1;for(;_<u;){const D=i[_+l];p[_<<1]=0,p[1+(_<<1)]=D,D>k&&(k=D),_++}for(;_<y;)p[_<<1]=0,p[1+(_<<1)]=0,_++;return k},o.H.n=function(i,l){const u=o.H.m,p=i.length;let k,_,y,D;const I=u.j;for(var P=0;P<=l;P++)I[P]=0;for(P=1;P<p;P+=2)I[i[P]]++;const F=u.K;for(k=0,I[0]=0,_=1;_<=l;_++)k=k+I[_-1]<<1,F[_]=k;for(y=0;y<p;y+=2)D=i[y+1],D!=0&&(i[y]=F[D],F[D]++)},o.H.A=function(i,l,u){const p=i.length,k=o.H.m.r;for(let _=0;_<p;_+=2)if(i[_+1]!=0){const y=_>>1,D=i[_+1],I=y<<4|D,P=l-D;let F=i[_]<<P;const j=F+(1<<P);for(;F!=j;)u[k[F]>>>15-l]=I,F++}},o.H.l=function(i,l){const u=o.H.m.r,p=15-l;for(let k=0;k<i.length;k+=2){const _=i[k]<<l-i[k+1];i[k]=u[_]>>>p}},o.H.M=function(i,l,u){u<<=7&l;const p=l>>>3;i[p]|=u,i[p+1]|=u>>>8},o.H.I=function(i,l,u){u<<=7&l;const p=l>>>3;i[p]|=u,i[p+1]|=u>>>8,i[p+2]|=u>>>16},o.H.e=function(i,l,u){return(i[l>>>3]|i[1+(l>>>3)]<<8)>>>(7&l)&(1<<u)-1},o.H.b=function(i,l,u){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16)>>>(7&l)&(1<<u)-1},o.H.Z=function(i,l){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16)>>>(7&l)},o.H.i=function(i,l){return(i[l>>>3]|i[1+(l>>>3)]<<8|i[2+(l>>>3)]<<16|i[3+(l>>>3)]<<24)>>>(7&l)},o.H.m=(function(){const i=Uint16Array,l=Uint32Array;return{K:new i(16),j:new i(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new i(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new l(32),J:new i(512),_:[],h:new i(32),$:[],w:new i(32768),C:[],v:[],d:new i(32768),D:[],u:new i(512),Q:[],r:new i(32768),s:new l(286),Y:new l(30),a:new l(19),t:new l(15e3),k:new i(65536),g:new i(32768)}})(),(function(){const i=o.H.m;for(var l=0;l<32768;l++){let p=l;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,i.r[l]=(p>>>16|p<<16)>>>17}function u(p,k,_){for(;k--!=0;)p.push(0,_)}for(l=0;l<32;l++)i.q[l]=i.S[l]<<3|i.T[l],i.c[l]=i.p[l]<<4|i.z[l];u(i._,144,8),u(i._,112,9),u(i._,24,7),u(i._,8,8),o.H.n(i._,9),o.H.A(i._,9,i.J),o.H.l(i._,9),u(i.$,32,5),o.H.n(i.$,5),o.H.A(i.$,5,i.h),o.H.l(i.$,5),u(i.Q,19,0),u(i.C,286,0),u(i.D,30,0),u(i.v,320,0)})(),o.H.N})();function n(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function a(o,i,l,u,p){let k=n(i);const _=Math.ceil(u*k/8);let y,D;k=Math.ceil(k/8);let I=o[l],P=0;if(I>1&&(o[l]=[0,0,1][I-2]),I==3)for(P=k;P<_;P++)o[P+1]=o[P+1]+(o[P+1-k]>>>1)&255;for(let F=0;F<p;F++)if(y=l+F*_,D=y+F+1,I=o[D-1],P=0,I==0)for(;P<_;P++)o[y+P]=o[D+P];else if(I==1){for(;P<k;P++)o[y+P]=o[D+P];for(;P<_;P++)o[y+P]=o[D+P]+o[y+P-k]}else if(I==2)for(;P<_;P++)o[y+P]=o[D+P]+o[y+P-_];else if(I==3){for(;P<k;P++)o[y+P]=o[D+P]+(o[y+P-_]>>>1);for(;P<_;P++)o[y+P]=o[D+P]+(o[y+P-_]+o[y+P-k]>>>1)}else{for(;P<k;P++)o[y+P]=o[D+P]+c(0,o[y+P-_],0);for(;P<_;P++)o[y+P]=o[D+P]+c(o[y+P-k],o[y+P-_],o[y+P-k-_])}return o}function c(o,i,l){const u=o+i-l,p=u-o,k=u-i,_=u-l;return p*p<=k*k&&p*p<=_*_?o:k*k<=_*_?i:l}function w(o,i,l){l.width=d.readUint(o,i),i+=4,l.height=d.readUint(o,i),i+=4,l.depth=o[i],i++,l.ctype=o[i],i++,l.compress=o[i],i++,l.filter=o[i],i++,l.interlace=o[i],i++}function b(o,i,l,u,p,k,_,y,D){const I=Math.min(i,p),P=Math.min(l,k);let F=0,j=0;for(let E=0;E<P;E++)for(let g=0;g<I;g++)if(_>=0&&y>=0?(F=E*i+g<<2,j=(y+E)*p+_+g<<2):(F=(-y+E)*i-_+g<<2,j=E*p+g<<2),D==0)u[j]=o[F],u[j+1]=o[F+1],u[j+2]=o[F+2],u[j+3]=o[F+3];else if(D==1){var W=o[F+3]*.00392156862745098,x=o[F]*W,m=o[F+1]*W,C=o[F+2]*W,A=u[j+3]*(1/255),R=u[j]*A,L=u[j+1]*A,N=u[j+2]*A;const f=1-W,B=W+A*f,v=B==0?0:1/B;u[j+3]=255*B,u[j+0]=(x+R*f)*v,u[j+1]=(m+L*f)*v,u[j+2]=(C+N*f)*v}else if(D==2)W=o[F+3],x=o[F],m=o[F+1],C=o[F+2],A=u[j+3],R=u[j],L=u[j+1],N=u[j+2],W==A&&x==R&&m==L&&C==N?(u[j]=0,u[j+1]=0,u[j+2]=0,u[j+3]=0):(u[j]=x,u[j+1]=m,u[j+2]=C,u[j+3]=W);else if(D==3){if(W=o[F+3],x=o[F],m=o[F+1],C=o[F+2],A=u[j+3],R=u[j],L=u[j+1],N=u[j+2],W==A&&x==R&&m==L&&C==N)continue;if(W<220&&A>20)return!1}return!0}return{decode:function(i){const l=new Uint8Array(i);let u=8;const p=d,k=p.readUshort,_=p.readUint,y={tabs:{},frames:[]},D=new Uint8Array(l.length);let I,P=0,F=0;const j=[137,80,78,71,13,10,26,10];for(var W=0;W<8;W++)if(l[W]!=j[W])throw"The input is not a PNG file!";for(;u<l.length;){const E=p.readUint(l,u);u+=4;const g=p.readASCII(l,u,4);if(u+=4,g=="IHDR")w(l,u,y);else if(g=="iCCP"){for(var x=u;l[x]!=0;)x++;p.readASCII(l,u,x-u),l[x+1];const f=l.slice(x+2,u+E);let B=null;try{B=r(f)}catch{B=e(f)}y.tabs[g]=B}else if(g=="CgBI")y.tabs[g]=l.slice(u,u+4);else if(g=="IDAT"){for(W=0;W<E;W++)D[P+W]=l[u+W];P+=E}else if(g=="acTL")y.tabs[g]={num_frames:_(l,u),num_plays:_(l,u+4)},I=new Uint8Array(l.length);else if(g=="fcTL"){F!=0&&((N=y.frames[y.frames.length-1]).data=t(y,I.slice(0,F),N.rect.width,N.rect.height),F=0);const f={x:_(l,u+12),y:_(l,u+16),width:_(l,u+4),height:_(l,u+8)};let B=k(l,u+22);B=k(l,u+20)/(B==0?100:B);const v={rect:f,delay:Math.round(1e3*B),dispose:l[u+24],blend:l[u+25]};y.frames.push(v)}else if(g=="fdAT"){for(W=0;W<E-4;W++)I[F+W]=l[u+W+4];F+=E-4}else if(g=="pHYs")y.tabs[g]=[p.readUint(l,u),p.readUint(l,u+4),l[u+8]];else if(g=="cHRM")for(y.tabs[g]=[],W=0;W<8;W++)y.tabs[g].push(p.readUint(l,u+4*W));else if(g=="tEXt"||g=="zTXt"){y.tabs[g]==null&&(y.tabs[g]={});var m=p.nextZero(l,u),C=p.readASCII(l,u,m-u),A=u+E-m-1;if(g=="tEXt")L=p.readASCII(l,m+1,A);else{var R=r(l.slice(m+2,m+2+A));L=p.readUTF8(R,0,R.length)}y.tabs[g][C]=L}else if(g=="iTXt"){y.tabs[g]==null&&(y.tabs[g]={}),m=0,x=u,m=p.nextZero(l,x),C=p.readASCII(l,x,m-x);const f=l[x=m+1];var L;l[x+1],x+=2,m=p.nextZero(l,x),p.readASCII(l,x,m-x),x=m+1,m=p.nextZero(l,x),p.readUTF8(l,x,m-x),A=E-((x=m+1)-u),f==0?L=p.readUTF8(l,x,A):(R=r(l.slice(x,x+A)),L=p.readUTF8(R,0,R.length)),y.tabs[g][C]=L}else if(g=="PLTE")y.tabs[g]=p.readBytes(l,u,E);else if(g=="hIST"){const f=y.tabs.PLTE.length/3;for(y.tabs[g]=[],W=0;W<f;W++)y.tabs[g].push(k(l,u+2*W))}else if(g=="tRNS")y.ctype==3?y.tabs[g]=p.readBytes(l,u,E):y.ctype==0?y.tabs[g]=k(l,u):y.ctype==2&&(y.tabs[g]=[k(l,u),k(l,u+2),k(l,u+4)]);else if(g=="gAMA")y.tabs[g]=p.readUint(l,u)/1e5;else if(g=="sRGB")y.tabs[g]=l[u];else if(g=="bKGD")y.ctype==0||y.ctype==4?y.tabs[g]=[k(l,u)]:y.ctype==2||y.ctype==6?y.tabs[g]=[k(l,u),k(l,u+2),k(l,u+4)]:y.ctype==3&&(y.tabs[g]=l[u]);else if(g=="IEND")break;u+=E,p.readUint(l,u),u+=4}var N;return F!=0&&((N=y.frames[y.frames.length-1]).data=t(y,I.slice(0,F),N.rect.width,N.rect.height)),y.data=t(y,D,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(i){const l=i.width,u=i.height;if(i.tabs.acTL==null)return[h(i.data,l,u,i).buffer];const p=[];i.frames[0].data==null&&(i.frames[0].data=i.data);const k=l*u*4,_=new Uint8Array(k),y=new Uint8Array(k),D=new Uint8Array(k);for(let P=0;P<i.frames.length;P++){const F=i.frames[P],j=F.rect.x,W=F.rect.y,x=F.rect.width,m=F.rect.height,C=h(F.data,x,m,i);if(P!=0)for(var I=0;I<k;I++)D[I]=_[I];if(F.blend==0?b(C,x,m,_,l,u,j,W,0):F.blend==1&&b(C,x,m,_,l,u,j,W,1),p.push(_.buffer.slice(0)),F.dispose!=0){if(F.dispose==1)b(y,x,m,_,l,u,j,W,0);else if(F.dispose==2)for(I=0;I<k;I++)_[I]=D[I]}}return p},_paeth:c,_copyTile:b,_bin:d}})();(function(){const{_copyTile:d}=at,{_bin:h}=at,t=at._paeth;var r={table:(function(){const x=new Uint32Array(256);for(let m=0;m<256;m++){let C=m;for(let A=0;A<8;A++)1&C?C=3988292384^C>>>1:C>>>=1;x[m]=C}return x})(),update(x,m,C,A){for(let R=0;R<A;R++)x=r.table[255&(x^m[C+R])]^x>>>8;return x},crc:(x,m,C)=>4294967295^r.update(4294967295,x,m,C)};function e(x,m,C,A){m[C]+=x[0]*A>>4,m[C+1]+=x[1]*A>>4,m[C+2]+=x[2]*A>>4,m[C+3]+=x[3]*A>>4}function n(x){return Math.max(0,Math.min(255,x))}function a(x,m){const C=x[0]-m[0],A=x[1]-m[1],R=x[2]-m[2],L=x[3]-m[3];return C*C+A*A+R*R+L*L}function c(x,m,C,A,R,L,N){N==null&&(N=1);const E=A.length,g=[];for(var f=0;f<E;f++){const M=A[f];g.push([M>>>0&255,M>>>8&255,M>>>16&255,M>>>24&255])}for(f=0;f<E;f++){let M=4294967295;for(var B=0,v=0;v<E;v++){var T=a(g[f],g[v]);v!=f&&T<M&&(M=T,B=v)}}const Y=new Uint32Array(R.buffer),G=new Int16Array(m*C*4),$=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(f=0;f<$.length;f++)$[f]=255*(($[f]+.5)/16-.5);for(let M=0;M<C;M++)for(let J=0;J<m;J++){var H;f=4*(M*m+J),N!=2?H=[n(x[f]+G[f]),n(x[f+1]+G[f+1]),n(x[f+2]+G[f+2]),n(x[f+3]+G[f+3])]:(T=$[4*(3&M)+(3&J)],H=[n(x[f]+T),n(x[f+1]+T),n(x[f+2]+T),n(x[f+3]+T)]),B=0;let Q=16777215;for(v=0;v<E;v++){const me=a(H,g[v]);me<Q&&(Q=me,B=v)}const ne=g[B],fe=[H[0]-ne[0],H[1]-ne[1],H[2]-ne[2],H[3]-ne[3]];N==1&&(J!=m-1&&e(fe,G,f+4,7),M!=C-1&&(J!=0&&e(fe,G,f+4*m-4,3),e(fe,G,f+4*m,5),J!=m-1&&e(fe,G,f+4*m+4,1))),L[f>>2]=B,Y[f>>2]=A[B]}}function w(x,m,C,A,R){R==null&&(R={});const{crc:L}=r,N=h.writeUint,E=h.writeUshort,g=h.writeASCII;let f=8;const B=x.frames.length>1;let v,T=!1,Y=33+(B?20:0);if(R.sRGB!=null&&(Y+=13),R.pHYs!=null&&(Y+=21),R.iCCP!=null&&(v=pako.deflate(R.iCCP),Y+=21+v.length+4),x.ctype==3){for(var G=x.plte.length,$=0;$<G;$++)x.plte[$]>>>24!=255&&(T=!0);Y+=8+3*G+4+(T?8+1*G+4:0)}for(var H=0;H<x.frames.length;H++)B&&(Y+=38),Y+=(ne=x.frames[H]).cimg.length+12,H!=0&&(Y+=4);Y+=12;const M=new Uint8Array(Y),J=[137,80,78,71,13,10,26,10];for($=0;$<8;$++)M[$]=J[$];if(N(M,f,13),f+=4,g(M,f,"IHDR"),f+=4,N(M,f,m),f+=4,N(M,f,C),f+=4,M[f]=x.depth,f++,M[f]=x.ctype,f++,M[f]=0,f++,M[f]=0,f++,M[f]=0,f++,N(M,f,L(M,f-17,17)),f+=4,R.sRGB!=null&&(N(M,f,1),f+=4,g(M,f,"sRGB"),f+=4,M[f]=R.sRGB,f++,N(M,f,L(M,f-5,5)),f+=4),R.iCCP!=null){const fe=13+v.length;N(M,f,fe),f+=4,g(M,f,"iCCP"),f+=4,g(M,f,"ICC profile"),f+=11,f+=2,M.set(v,f),f+=v.length,N(M,f,L(M,f-(fe+4),fe+4)),f+=4}if(R.pHYs!=null&&(N(M,f,9),f+=4,g(M,f,"pHYs"),f+=4,N(M,f,R.pHYs[0]),f+=4,N(M,f,R.pHYs[1]),f+=4,M[f]=R.pHYs[2],f++,N(M,f,L(M,f-13,13)),f+=4),B&&(N(M,f,8),f+=4,g(M,f,"acTL"),f+=4,N(M,f,x.frames.length),f+=4,N(M,f,R.loop!=null?R.loop:0),f+=4,N(M,f,L(M,f-12,12)),f+=4),x.ctype==3){for(N(M,f,3*(G=x.plte.length)),f+=4,g(M,f,"PLTE"),f+=4,$=0;$<G;$++){const fe=3*$,me=x.plte[$],Ce=255&me,Se=me>>>8&255,Je=me>>>16&255;M[f+fe+0]=Ce,M[f+fe+1]=Se,M[f+fe+2]=Je}if(f+=3*G,N(M,f,L(M,f-3*G-4,3*G+4)),f+=4,T){for(N(M,f,G),f+=4,g(M,f,"tRNS"),f+=4,$=0;$<G;$++)M[f+$]=x.plte[$]>>>24&255;f+=G,N(M,f,L(M,f-G-4,G+4)),f+=4}}let Q=0;for(H=0;H<x.frames.length;H++){var ne=x.frames[H];B&&(N(M,f,26),f+=4,g(M,f,"fcTL"),f+=4,N(M,f,Q++),f+=4,N(M,f,ne.rect.width),f+=4,N(M,f,ne.rect.height),f+=4,N(M,f,ne.rect.x),f+=4,N(M,f,ne.rect.y),f+=4,E(M,f,A[H]),f+=2,E(M,f,1e3),f+=2,M[f]=ne.dispose,f++,M[f]=ne.blend,f++,N(M,f,L(M,f-30,30)),f+=4);const fe=ne.cimg;N(M,f,(G=fe.length)+(H==0?0:4)),f+=4;const me=f;g(M,f,H==0?"IDAT":"fdAT"),f+=4,H!=0&&(N(M,f,Q++),f+=4),M.set(fe,f),f+=G,N(M,f,L(M,me,f-me)),f+=4}return N(M,f,0),f+=4,g(M,f,"IEND"),f+=4,N(M,f,L(M,f-4,4)),f+=4,M.buffer}function b(x,m,C){for(let A=0;A<x.frames.length;A++){const R=x.frames[A];R.rect.width;const L=R.rect.height,N=new Uint8Array(L*R.bpl+L);R.cimg=u(R.img,L,R.bpp,R.bpl,N,m,C)}}function o(x,m,C,A,R){const L=R[0],N=R[1],E=R[2],g=R[3],f=R[4],B=R[5];let v=6,T=8,Y=255;for(var G=0;G<x.length;G++){const Te=new Uint8Array(x[G]);for(var $=Te.length,H=0;H<$;H+=4)Y&=Te[H+3]}const M=Y!=255,J=(function(ge,xe,Le,je,we,Re){const ke=[];for(var he=0;he<ge.length;he++){const Pe=new Uint8Array(ge[he]),qe=new Uint32Array(Pe.buffer);var Ge;let Be=0,Ke=0,Xe=xe,Ue=Le,ct=je?1:0;if(he!=0){const Ot=Re||je||he==1||ke[he-2].dispose!=0?1:2;let gt=0,At=1e9;for(let dt=0;dt<Ot;dt++){var Oe=new Uint8Array(ge[he-1-dt]);const jt=new Uint32Array(ge[he-1-dt]);let nt=xe,et=Le,tt=-1,xt=-1;for(let ut=0;ut<Le;ut++)for(let st=0;st<xe;st++)qe[Ae=ut*xe+st]!=jt[Ae]&&(st<nt&&(nt=st),st>tt&&(tt=st),ut<et&&(et=ut),ut>xt&&(xt=ut));tt==-1&&(nt=et=tt=xt=0),we&&((1&nt)==1&&nt--,(1&et)==1&&et--);const vt=(tt-nt+1)*(xt-et+1);vt<At&&(At=vt,gt=dt,Be=nt,Ke=et,Xe=tt-nt+1,Ue=xt-et+1)}Oe=new Uint8Array(ge[he-1-gt]),gt==1&&(ke[he-1].dispose=2),Ge=new Uint8Array(Xe*Ue*4),d(Oe,xe,Le,Ge,Xe,Ue,-Be,-Ke,0),ct=d(Pe,xe,Le,Ge,Xe,Ue,-Be,-Ke,3)?1:0,ct==1?l(Pe,xe,Le,Ge,{x:Be,y:Ke,width:Xe,height:Ue}):d(Pe,xe,Le,Ge,Xe,Ue,-Be,-Ke,0)}else Ge=Pe.slice(0);ke.push({rect:{x:Be,y:Ke,width:Xe,height:Ue},img:Ge,blend:ct,dispose:0})}if(je)for(he=0;he<ke.length;he++){if((lt=ke[he]).blend==1)continue;const Pe=lt.rect,qe=ke[he-1].rect,Be=Math.min(Pe.x,qe.x),Ke=Math.min(Pe.y,qe.y),Xe={x:Be,y:Ke,width:Math.max(Pe.x+Pe.width,qe.x+qe.width)-Be,height:Math.max(Pe.y+Pe.height,qe.y+qe.height)-Ke};ke[he-1].dispose=1,he-1!=0&&i(ge,xe,Le,ke,he-1,Xe,we),i(ge,xe,Le,ke,he,Xe,we)}let Qe=0;if(ge.length!=1)for(var Ae=0;Ae<ke.length;Ae++){var lt;Qe+=(lt=ke[Ae]).rect.width*lt.rect.height}return ke})(x,m,C,L,N,E),Q={},ne=[],fe=[];if(A!=0){const Te=[];for(H=0;H<J.length;H++)Te.push(J[H].img.buffer);const ge=(function(we){let Re=0;for(var ke=0;ke<we.length;ke++)Re+=we[ke].byteLength;const he=new Uint8Array(Re);let Ge=0;for(ke=0;ke<we.length;ke++){const Oe=new Uint8Array(we[ke]),Qe=Oe.length;for(let Ae=0;Ae<Qe;Ae+=4){let lt=Oe[Ae],Pe=Oe[Ae+1],qe=Oe[Ae+2];const Be=Oe[Ae+3];Be==0&&(lt=Pe=qe=0),he[Ge+Ae]=lt,he[Ge+Ae+1]=Pe,he[Ge+Ae+2]=qe,he[Ge+Ae+3]=Be}Ge+=Qe}return he.buffer})(Te),xe=k(ge,A);for(H=0;H<xe.plte.length;H++)ne.push(xe.plte[H].est.rgba);let Le=0;for(H=0;H<J.length;H++){const je=(Ce=J[H]).img.length;var me=new Uint8Array(xe.inds.buffer,Le>>2,je>>2);fe.push(me);const we=new Uint8Array(xe.abuf,Le,je);B&&c(Ce.img,Ce.rect.width,Ce.rect.height,ne,we,me),Ce.img.set(we),Le+=je}}else for(G=0;G<J.length;G++){var Ce=J[G];const Te=new Uint32Array(Ce.img.buffer);var Se=Ce.rect.width;for($=Te.length,me=new Uint8Array($),fe.push(me),H=0;H<$;H++){const ge=Te[H];if(H!=0&&ge==Te[H-1])me[H]=me[H-1];else if(H>Se&&ge==Te[H-Se])me[H]=me[H-Se];else{let xe=Q[ge];if(xe==null&&(Q[ge]=xe=ne.length,ne.push(ge),ne.length>=300))break;me[H]=xe}}}const Je=ne.length;for(Je<=256&&f==0&&(T=Je<=2?1:Je<=4?2:Je<=16?4:8,T=Math.max(T,g)),G=0;G<J.length;G++){(Ce=J[G]).rect.x,Ce.rect.y,Se=Ce.rect.width;const Te=Ce.rect.height;let ge=Ce.img;new Uint32Array(ge.buffer);let xe=4*Se,Le=4;if(Je<=256&&f==0){xe=Math.ceil(T*Se/8);var Ee=new Uint8Array(xe*Te);const je=fe[G];for(let we=0;we<Te;we++){H=we*xe;const Re=we*Se;if(T==8)for(var Ne=0;Ne<Se;Ne++)Ee[H+Ne]=je[Re+Ne];else if(T==4)for(Ne=0;Ne<Se;Ne++)Ee[H+(Ne>>1)]|=je[Re+Ne]<<4-4*(1&Ne);else if(T==2)for(Ne=0;Ne<Se;Ne++)Ee[H+(Ne>>2)]|=je[Re+Ne]<<6-2*(3&Ne);else if(T==1)for(Ne=0;Ne<Se;Ne++)Ee[H+(Ne>>3)]|=je[Re+Ne]<<7-1*(7&Ne)}ge=Ee,v=3,Le=1}else if(M==0&&J.length==1){Ee=new Uint8Array(Se*Te*3);const je=Se*Te;for(H=0;H<je;H++){const we=3*H,Re=4*H;Ee[we]=ge[Re],Ee[we+1]=ge[Re+1],Ee[we+2]=ge[Re+2]}ge=Ee,v=2,Le=3,xe=3*Se}Ce.img=ge,Ce.bpl=xe,Ce.bpp=Le}return{ctype:v,depth:T,plte:ne,frames:J}}function i(x,m,C,A,R,L,N){const E=Uint8Array,g=Uint32Array,f=new E(x[R-1]),B=new g(x[R-1]),v=R+1<x.length?new E(x[R+1]):null,T=new E(x[R]),Y=new g(T.buffer);let G=m,$=C,H=-1,M=-1;for(let Q=0;Q<L.height;Q++)for(let ne=0;ne<L.width;ne++){const fe=L.x+ne,me=L.y+Q,Ce=me*m+fe,Se=Y[Ce];Se==0||A[R-1].dispose==0&&B[Ce]==Se&&(v==null||v[4*Ce+3]!=0)||(fe<G&&(G=fe),fe>H&&(H=fe),me<$&&($=me),me>M&&(M=me))}H==-1&&(G=$=H=M=0),N&&((1&G)==1&&G--,(1&$)==1&&$--),L={x:G,y:$,width:H-G+1,height:M-$+1};const J=A[R];J.rect=L,J.blend=1,J.img=new Uint8Array(L.width*L.height*4),A[R-1].dispose==0?(d(f,m,C,J.img,L.width,L.height,-L.x,-L.y,0),l(T,m,C,J.img,L)):d(T,m,C,J.img,L.width,L.height,-L.x,-L.y,0)}function l(x,m,C,A,R){d(x,m,C,A,R.width,R.height,-R.x,-R.y,2)}function u(x,m,C,A,R,L,N){const E=[];let g,f=[0,1,2,3,4];L!=-1?f=[L]:(m*A>5e5||C==1)&&(f=[0]),N&&(g={level:0});const B=Hn;for(var v=0;v<f.length;v++){for(let G=0;G<m;G++)p(R,x,G,A,C,f[v]);E.push(B.deflate(R,g))}let T,Y=1e9;for(v=0;v<E.length;v++)E[v].length<Y&&(T=v,Y=E[v].length);return E[T]}function p(x,m,C,A,R,L){const N=C*A;let E=N+C;if(x[E]=L,E++,L==0)if(A<500)for(var g=0;g<A;g++)x[E+g]=m[N+g];else x.set(new Uint8Array(m.buffer,N,A),E);else if(L==1){for(g=0;g<R;g++)x[E+g]=m[N+g];for(g=R;g<A;g++)x[E+g]=m[N+g]-m[N+g-R]+256&255}else if(C==0){for(g=0;g<R;g++)x[E+g]=m[N+g];if(L==2)for(g=R;g<A;g++)x[E+g]=m[N+g];if(L==3)for(g=R;g<A;g++)x[E+g]=m[N+g]-(m[N+g-R]>>1)+256&255;if(L==4)for(g=R;g<A;g++)x[E+g]=m[N+g]-t(m[N+g-R],0,0)+256&255}else{if(L==2)for(g=0;g<A;g++)x[E+g]=m[N+g]+256-m[N+g-A]&255;if(L==3){for(g=0;g<R;g++)x[E+g]=m[N+g]+256-(m[N+g-A]>>1)&255;for(g=R;g<A;g++)x[E+g]=m[N+g]+256-(m[N+g-A]+m[N+g-R]>>1)&255}if(L==4){for(g=0;g<R;g++)x[E+g]=m[N+g]+256-t(0,m[N+g-A],0)&255;for(g=R;g<A;g++)x[E+g]=m[N+g]+256-t(m[N+g-R],m[N+g-A],m[N+g-R-A])&255}}}function k(x,m){const C=new Uint8Array(x),A=C.slice(0),R=new Uint32Array(A.buffer),L=_(A,m),N=L[0],E=L[1],g=C.length,f=new Uint8Array(g>>2);let B;if(C.length<2e7)for(var v=0;v<g;v+=4)B=y(N,T=C[v]*(1/255),Y=C[v+1]*(1/255),G=C[v+2]*(1/255),$=C[v+3]*(1/255)),f[v>>2]=B.ind,R[v>>2]=B.est.rgba;else for(v=0;v<g;v+=4){var T=C[v]*.00392156862745098,Y=C[v+1]*(1/255),G=C[v+2]*(1/255),$=C[v+3]*(1/255);for(B=N;B.left;)B=D(B.est,T,Y,G,$)<=0?B.left:B.right;f[v>>2]=B.ind,R[v>>2]=B.est.rgba}return{abuf:A.buffer,inds:f,plte:E}}function _(x,m,C){C==null&&(C=1e-4);const A=new Uint32Array(x.buffer),R={i0:0,i1:x.length,bst:null,est:null,tdst:0,left:null,right:null};R.bst=F(x,R.i0,R.i1),R.est=j(R.bst);const L=[R];for(;L.length<m;){let E=0,g=0;for(var N=0;N<L.length;N++)L[N].est.L>E&&(E=L[N].est.L,g=N);if(E<C)break;const f=L[g],B=I(x,A,f.i0,f.i1,f.est.e,f.est.eMq255);if(f.i0>=B||f.i1<=B){f.est.L=0;continue}const v={i0:f.i0,i1:B,bst:null,est:null,tdst:0,left:null,right:null};v.bst=F(x,v.i0,v.i1),v.est=j(v.bst);const T={i0:B,i1:f.i1,bst:null,est:null,tdst:0,left:null,right:null};for(T.bst={R:[],m:[],N:f.bst.N-v.bst.N},N=0;N<16;N++)T.bst.R[N]=f.bst.R[N]-v.bst.R[N];for(N=0;N<4;N++)T.bst.m[N]=f.bst.m[N]-v.bst.m[N];T.est=j(T.bst),f.left=v,f.right=T,L[g]=v,L.push(T)}for(L.sort(((E,g)=>g.bst.N-E.bst.N)),N=0;N<L.length;N++)L[N].ind=N;return[R,L]}function y(x,m,C,A,R){if(x.left==null)return x.tdst=(function(v,T,Y,G,$){const H=T-v[0],M=Y-v[1],J=G-v[2],Q=$-v[3];return H*H+M*M+J*J+Q*Q})(x.est.q,m,C,A,R),x;const L=D(x.est,m,C,A,R);let N=x.left,E=x.right;L>0&&(N=x.right,E=x.left);const g=y(N,m,C,A,R);if(g.tdst<=L*L)return g;const f=y(E,m,C,A,R);return f.tdst<g.tdst?f:g}function D(x,m,C,A,R){const{e:L}=x;return L[0]*m+L[1]*C+L[2]*A+L[3]*R-x.eMq}function I(x,m,C,A,R,L){for(A-=4;C<A;){for(;P(x,C,R)<=L;)C+=4;for(;P(x,A,R)>L;)A-=4;if(C>=A)break;const N=m[C>>2];m[C>>2]=m[A>>2],m[A>>2]=N,C+=4,A-=4}for(;P(x,C,R)>L;)C-=4;return C+4}function P(x,m,C){return x[m]*C[0]+x[m+1]*C[1]+x[m+2]*C[2]+x[m+3]*C[3]}function F(x,m,C){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],R=[0,0,0,0],L=C-m>>2;for(let N=m;N<C;N+=4){const E=x[N]*.00392156862745098,g=x[N+1]*(1/255),f=x[N+2]*(1/255),B=x[N+3]*(1/255);R[0]+=E,R[1]+=g,R[2]+=f,R[3]+=B,A[0]+=E*E,A[1]+=E*g,A[2]+=E*f,A[3]+=E*B,A[5]+=g*g,A[6]+=g*f,A[7]+=g*B,A[10]+=f*f,A[11]+=f*B,A[15]+=B*B}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:R,N:L}}function j(x){const{R:m}=x,{m:C}=x,{N:A}=x,R=C[0],L=C[1],N=C[2],E=C[3],g=A==0?0:1/A,f=[m[0]-R*R*g,m[1]-R*L*g,m[2]-R*N*g,m[3]-R*E*g,m[4]-L*R*g,m[5]-L*L*g,m[6]-L*N*g,m[7]-L*E*g,m[8]-N*R*g,m[9]-N*L*g,m[10]-N*N*g,m[11]-N*E*g,m[12]-E*R*g,m[13]-E*L*g,m[14]-E*N*g,m[15]-E*E*g],B=f,v=W;let T=[Math.random(),Math.random(),Math.random(),Math.random()],Y=0,G=0;if(A!=0)for(let H=0;H<16&&(T=v.multVec(B,T),G=Math.sqrt(v.dot(T,T)),T=v.sml(1/G,T),!(H!=0&&Math.abs(G-Y)<1e-9));H++)Y=G;const $=[R*g,L*g,N*g,E*g];return{Cov:f,q:$,e:T,L:Y,eMq255:v.dot(v.sml(255,$),T),eMq:v.dot(T,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0])<<0)>>>0}}var W={multVec:(x,m)=>[x[0]*m[0]+x[1]*m[1]+x[2]*m[2]+x[3]*m[3],x[4]*m[0]+x[5]*m[1]+x[6]*m[2]+x[7]*m[3],x[8]*m[0]+x[9]*m[1]+x[10]*m[2]+x[11]*m[3],x[12]*m[0]+x[13]*m[1]+x[14]*m[2]+x[15]*m[3]],dot:(x,m)=>x[0]*m[0]+x[1]*m[1]+x[2]*m[2]+x[3]*m[3],sml:(x,m)=>[x*m[0],x*m[1],x*m[2],x*m[3]]};at.encode=function(m,C,A,R,L,N,E){R==null&&(R=0),E==null&&(E=!1);const g=o(m,C,A,R,[!1,!1,!1,0,E,!1]);return b(g,-1),w(g,C,A,L,N)},at.encodeLL=function(m,C,A,R,L,N,E,g){const f={ctype:0+(R==1?0:2)+(L==0?0:4),depth:N,frames:[]},B=(R+L)*N,v=B*C;for(let T=0;T<m.length;T++)f.frames.push({rect:{x:0,y:0,width:C,height:A},img:new Uint8Array(m[T]),blend:0,dispose:1,bpp:Math.ceil(B/8),bpl:Math.ceil(v/8)});return b(f,0,!0),w(f,C,A,E,g)},at.encode.compress=o,at.encode.dither=c,at.quantize=k,at.quantize.getKDtree=_,at.quantize.getNearest=y})();const Jr={toArrayBuffer(d,h){const t=d.width,r=d.height,e=t<<2,n=d.getContext("2d").getImageData(0,0,t,r),a=new Uint32Array(n.data.buffer),c=(32*t+31)/32<<2,w=c*r,b=122+w,o=new ArrayBuffer(b),i=new DataView(o),l=1<<20;let u,p,k,_,y=l,D=0,I=0,P=0;function F(x){i.setUint16(I,x,!0),I+=2}function j(x){i.setUint32(I,x,!0),I+=4}function W(x){I+=x}F(19778),j(b),W(4),j(122),j(108),j(t),j(-r>>>0),F(1),F(32),j(3),j(w),j(2835),j(2835),W(8),j(16711680),j(65280),j(255),j(4278190080),j(1466527264),(function x(){for(;D<r&&y>0;){for(_=122+D*c,u=0;u<e;)y--,p=a[P++],k=p>>>24,i.setUint32(_+u,p<<8|k),u+=4;D++}P<a.length?(y=l,setTimeout(x,Jr._dly)):h(o)})()},toBlob(d,h){this.toArrayBuffer(d,(t=>{h(new Blob([t],{type:"image/bmp"}))}))},_dly:9};var Ze={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},On={[Ze.CHROME]:16384,[Ze.FIREFOX]:11180,[Ze.DESKTOP_SAFARI]:16384,[Ze.IE]:8192,[Ze.IOS]:4096,[Ze.ETC]:8192};const cr=typeof window<"u",Qr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ft=cr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Bn=(cr||Qr)&&(Ft&&Ft.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Xr=(cr||Qr)&&(Ft&&Ft.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function dr(d,h,t=Date.now()){return new Promise((r=>{const e=d.split(","),n=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let c=a.length;const w=new Uint8Array(c);for(;c--;)w[c]=a.charCodeAt(c);const b=new Blob([w],{type:n});b.name=h,b.lastModified=t,r(b)}))}function en(d){return new Promise(((h,t)=>{const r=new Xr;r.onload=()=>h(r.result),r.onerror=e=>t(e),r.readAsDataURL(d)}))}function tn(d){return new Promise(((h,t)=>{const r=new Image;r.onload=()=>h(r),r.onerror=e=>t(e),r.src=d}))}function bt(){if(bt.cachedResult!==void 0)return bt.cachedResult;let d=Ze.ETC;const{userAgent:h}=navigator;return/Chrom(e|ium)/i.test(h)?d=Ze.CHROME:/iP(ad|od|hone)/i.test(h)&&/WebKit/i.test(h)?d=Ze.IOS:/Safari/i.test(h)?d=Ze.DESKTOP_SAFARI:/Firefox/i.test(h)?d=Ze.FIREFOX:(/MSIE/i.test(h)||document.documentMode)&&(d=Ze.IE),bt.cachedResult=d,bt.cachedResult}function rn(d,h){const t=bt(),r=On[t];let e=d,n=h,a=e*n;const c=e>n?n/e:e/n;for(;a>r*r;){const w=(r+e)/2,b=(r+n)/2;w<b?(n=b,e=b*c):(n=w*c,e=w),a=e*n}return{width:e,height:n}}function $t(d,h){let t,r;try{if(t=new OffscreenCanvas(d,h),r=t.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{t=document.createElement("canvas"),r=t.getContext("2d")}return t.width=d,t.height=h,[t,r]}function nn(d,h){const{width:t,height:r}=rn(d.width,d.height),[e,n]=$t(t,r);return h&&/jpe?g/.test(h)&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height)),n.drawImage(d,0,0,e.width,e.height),e}function Ut(){return Ut.cachedResult!==void 0||(Ut.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ut.cachedResult}function zt(d,h={}){return new Promise((function(t,r){let e,n;var a=function(){try{return n=nn(e,h.fileType||d.type),t([e,n])}catch(w){return r(w)}},c=function(w){try{var b=function(o){try{throw o}catch(i){return r(i)}};try{let o;return en(d).then((function(i){try{return o=i,tn(o).then((function(l){try{return e=l,(function(){try{return a()}catch(u){return r(u)}})()}catch(u){return b(u)}}),b)}catch(l){return b(l)}}),b)}catch(o){b(o)}}catch(o){return r(o)}};try{if(Ut()||[Ze.DESKTOP_SAFARI,Ze.MOBILE_SAFARI].includes(bt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(d).then((function(w){try{return e=w,a()}catch{return c()}}),c)}catch{c()}}))}function Wt(d,h,t,r,e=1){return new Promise((function(n,a){let c;if(h==="image/png"){let b,o,i;return b=d.getContext("2d"),{data:o}=b.getImageData(0,0,d.width,d.height),i=at.encode([o.buffer],d.width,d.height,4096*e),c=new Blob([i],{type:h}),c.name=t,c.lastModified=r,w.call(this)}{let b=function(){return w.call(this)};if(h==="image/bmp")return new Promise((o=>Jr.toBlob(d,o))).then((function(o){try{return c=o,c.name=t,c.lastModified=r,b.call(this)}catch(i){return a(i)}}).bind(this),a);{let o=function(){return b.call(this)};if(typeof OffscreenCanvas=="function"&&d instanceof OffscreenCanvas)return d.convertToBlob({type:h,quality:e}).then((function(i){try{return c=i,c.name=t,c.lastModified=r,o.call(this)}catch(l){return a(l)}}).bind(this),a);{let i;return i=d.toDataURL(h,e),dr(i,t,r).then((function(l){try{return c=l,o.call(this)}catch(u){return a(u)}}).bind(this),a)}}}function w(){return n(c)}}))}function it(d){d.width=0,d.height=0}function yt(){return new Promise((function(d,h){let t,r,e,n;return yt.cachedResult!==void 0?d(yt.cachedResult):dr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(a){try{return t=a,zt(t).then((function(c){try{return r=c[1],Wt(r,t.type,t.name,t.lastModified).then((function(w){try{return e=w,it(r),zt(e).then((function(b){try{return n=b[0],yt.cachedResult=n.width===1&&n.height===2,d(yt.cachedResult)}catch(o){return h(o)}}),h)}catch(b){return h(b)}}),h)}catch(w){return h(w)}}),h)}catch(c){return h(c)}}),h)}))}function sn(d){return new Promise(((h,t)=>{const r=new Xr;r.onload=e=>{const n=new DataView(e.target.result);if(n.getUint16(0,!1)!=65496)return h(-2);const a=n.byteLength;let c=2;for(;c<a;){if(n.getUint16(c+2,!1)<=8)return h(-1);const w=n.getUint16(c,!1);if(c+=2,w==65505){if(n.getUint32(c+=2,!1)!=1165519206)return h(-1);const b=n.getUint16(c+=6,!1)==18761;c+=n.getUint32(c+4,b);const o=n.getUint16(c,b);c+=2;for(let i=0;i<o;i++)if(n.getUint16(c+12*i,b)==274)return h(n.getUint16(c+12*i+8,b))}else{if((65280&w)!=65280)break;c+=n.getUint16(c,!1)}}return h(-1)},r.onerror=e=>t(e),r.readAsArrayBuffer(d)}))}function an(d,h){const{width:t}=d,{height:r}=d,{maxWidthOrHeight:e}=h;let n,a=d;return isFinite(e)&&(t>e||r>e)&&([a,n]=$t(t,r),t>r?(a.width=e,a.height=r/t*e):(a.width=t/r*e,a.height=e),n.drawImage(d,0,0,a.width,a.height),it(d)),a}function on(d,h){const{width:t}=d,{height:r}=d,[e,n]=$t(t,r);switch(h>4&&h<9?(e.width=r,e.height=t):(e.width=t,e.height=r),h){case 2:n.transform(-1,0,0,1,t,0);break;case 3:n.transform(-1,0,0,-1,t,r);break;case 4:n.transform(1,0,0,-1,0,r);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,r,0);break;case 7:n.transform(0,-1,-1,0,r,t);break;case 8:n.transform(0,-1,1,0,0,t)}return n.drawImage(d,0,0,t,r),it(d),e}function Lr(d,h,t=0){return new Promise((function(r,e){let n,a,c,w,b,o,i,l,u,p,k,_,y,D,I,P,F,j,W,x;function m(A=5){if(h.signal&&h.signal.aborted)throw h.signal.reason;n+=A,h.onProgress(Math.min(n,100))}function C(A){if(h.signal&&h.signal.aborted)throw h.signal.reason;n=Math.min(Math.max(A,n),100),h.onProgress(n)}return n=t,a=h.maxIteration||10,c=1024*h.maxSizeMB*1024,m(),zt(d,h).then((function(A){try{return[,w]=A,m(),b=an(w,h),m(),new Promise((function(R,L){var N;if(!(N=h.exifOrientation))return sn(d).then((function(g){try{return N=g,E.call(this)}catch(f){return L(f)}}).bind(this),L);function E(){return R(N)}return E.call(this)})).then((function(R){try{return o=R,m(),yt().then((function(L){try{return i=L?b:on(b,o),m(),l=h.initialQuality||1,u=h.fileType||d.type,Wt(i,u,d.name,d.lastModified,l).then((function(N){try{{let g=function(){if(a--&&(I>c||I>y)){let B,v;return B=x?.95*W.width:W.width,v=x?.95*W.height:W.height,[F,j]=$t(B,v),j.drawImage(W,0,0,B,v),l*=u==="image/png"?.85:.95,Wt(F,u,d.name,d.lastModified,l).then((function(T){try{return P=T,it(W),W=F,I=P.size,C(Math.min(99,Math.floor((D-I)/(D-c)*100))),g}catch(Y){return e(Y)}}),e)}return[1]},f=function(){return it(W),it(F),it(b),it(i),it(w),C(100),r(P)};if(p=N,m(),k=p.size>c,_=p.size>d.size,!k&&!_)return C(100),r(p);var E;return y=d.size,D=p.size,I=D,W=i,x=!h.alwaysKeepResolution&&k,(E=(function(B){for(;B;){if(B.then)return void B.then(E,e);try{if(B.pop){if(B.length)return B.pop()?f.call(this):B;B=g}else B=B.call(this)}catch(v){return e(v)}}}).bind(this))(g)}}catch(g){return e(g)}}).bind(this),e)}catch(N){return e(N)}}).bind(this),e)}catch(L){return e(L)}}).bind(this),e)}catch(R){return e(R)}}).bind(this),e)}))}const Gn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Xt;function qn(d,h){return new Promise(((t,r)=>{Xt||(Xt=(function(a){const c=[];return c.push(a),URL.createObjectURL(new Blob(c))})(Gn));const e=new Worker(Xt);e.addEventListener("message",(function(a){if(h.signal&&h.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return r(new Error(a.data.error)),void e.terminate();t(a.data.file),e.terminate()}else h.onProgress(a.data.progress)})),e.addEventListener("error",r),h.signal&&h.signal.addEventListener("abort",(()=>{r(h.signal.reason),e.terminate()})),e.postMessage({file:d,imageCompressionLibUrl:h.libURL,options:{...h,onProgress:void 0,signal:void 0}})}))}function He(d,h){return new Promise((function(t,r){let e,n,a,c,w,b;if(e={...h},a=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,w=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=u=>{a=u,typeof c=="function"&&c(a)},!(d instanceof Blob||d instanceof Bn))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(d.type))return r(new Error("The file given is not an image"));if(b=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!w||typeof Worker!="function"||b)return Lr(d,e).then((function(u){try{return n=u,l.call(this)}catch(p){return r(p)}}).bind(this),r);var o=(function(){try{return l.call(this)}catch(u){return r(u)}}).bind(this),i=function(u){try{return Lr(d,e).then((function(p){try{return n=p,o()}catch(k){return r(k)}}),r)}catch(p){return r(p)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",qn(d,e).then((function(u){try{return n=u,o()}catch{return i()}}),i)}catch{i()}function l(){try{n.name=d.name,n.lastModified=d.lastModified}catch{}try{e.preserveExif&&d.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===d.type)&&(n=Zr(d,n))}catch{}return t(n)}}))}He.getDataUrlFromFile=en,He.getFilefromDataUrl=dr,He.loadImage=tn,He.drawImageInCanvas=nn,He.drawFileInCanvas=zt,He.canvasToFile=Wt,He.getExifOrientation=sn,He.handleMaxWidthOrHeight=an,He.followExifOrientation=on,He.cleanupCanvasMemory=it,He.isAutoOrientationInBrowser=yt,He.approximateBelowMaximumCanvasSizeOfBrowser=rn,He.copyExifWithoutOrientation=Zr,He.getBrowserName=bt,He.version="2.0.2";var lr=function(d,h){return lr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])},lr(d,h)};function Vn(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");lr(d,h);function t(){this.constructor=d}d.prototype=h===null?Object.create(h):(t.prototype=h.prototype,new t)}var ze=function(){return ze=Object.assign||function(h){for(var t,r=1,e=arguments.length;r<e;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(h[n]=t[n])}return h},ze.apply(this,arguments)};var er,Tr;function Yn(){if(Tr)return er;Tr=1;var d=!1,h,t,r,e,n,a,c,w,b,o,i,l,u,p,k;function _(){if(!d){d=!0;var D=navigator.userAgent,I=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(D),P=/(Mac OS X)|(Windows)|(Linux)/.exec(D);if(l=/\b(iPhone|iP[ao]d)/.exec(D),u=/\b(iP[ao]d)/.exec(D),o=/Android/i.exec(D),p=/FBAN\/\w+;/i.exec(D),k=/Mobile/i.exec(D),i=!!/Win64/.exec(D),I){h=I[1]?parseFloat(I[1]):I[5]?parseFloat(I[5]):NaN,h&&document&&document.documentMode&&(h=document.documentMode);var F=/(?:Trident\/(\d+.\d+))/.exec(D);a=F?parseFloat(F[1])+4:h,t=I[2]?parseFloat(I[2]):NaN,r=I[3]?parseFloat(I[3]):NaN,e=I[4]?parseFloat(I[4]):NaN,e?(I=/(?:Chrome\/(\d+\.\d+))/.exec(D),n=I&&I[1]?parseFloat(I[1]):NaN):n=NaN}else h=t=r=n=e=NaN;if(P){if(P[1]){var j=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(D);c=j?parseFloat(j[1].replace("_",".")):!0}else c=!1;w=!!P[2],b=!!P[3]}else c=w=b=!1}}var y={ie:function(){return _()||h},ieCompatibilityMode:function(){return _()||a>h},ie64:function(){return y.ie()&&i},firefox:function(){return _()||t},opera:function(){return _()||r},webkit:function(){return _()||e},safari:function(){return y.webkit()},chrome:function(){return _()||n},windows:function(){return _()||w},osx:function(){return _()||c},linux:function(){return _()||b},iphone:function(){return _()||l},mobile:function(){return _()||l||u||o||k},nativeApp:function(){return _()||p},android:function(){return _()||o},ipad:function(){return _()||u}};return er=y,er}var tr,Dr;function Kn(){if(Dr)return tr;Dr=1;var d=!!(typeof window<"u"&&window.document&&window.document.createElement),h={canUseDOM:d,canUseWorkers:typeof Worker<"u",canUseEventListeners:d&&!!(window.addEventListener||window.attachEvent),canUseViewport:d&&!!window.screen,isInWorker:!d};return tr=h,tr}var rr,Pr;function Zn(){if(Pr)return rr;Pr=1;var d=Kn(),h;d.canUseDOM&&(h=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function t(r,e){if(!d.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+r,a=n in document;if(!a){var c=document.createElement("div");c.setAttribute(n,"return;"),a=typeof c[n]=="function"}return!a&&h&&r==="wheel"&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}return rr=t,rr}var nr,Ur;function Jn(){if(Ur)return nr;Ur=1;var d=Yn(),h=Zn(),t=10,r=40,e=800;function n(a){var c=0,w=0,b=0,o=0;return"detail"in a&&(w=a.detail),"wheelDelta"in a&&(w=-a.wheelDelta/120),"wheelDeltaY"in a&&(w=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(c=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(c=w,w=0),b=c*t,o=w*t,"deltaY"in a&&(o=a.deltaY),"deltaX"in a&&(b=a.deltaX),(b||o)&&a.deltaMode&&(a.deltaMode==1?(b*=r,o*=r):(b*=e,o*=e)),b&&!c&&(c=b<1?-1:1),o&&!w&&(w=o<1?-1:1),{spinX:c,spinY:w,pixelX:b,pixelY:o}}return n.getEventType=function(){return d.firefox()?"DOMMouseScroll":h("wheel")?"wheel":"mousewheel"},nr=n,nr}var sr,Ir;function Qn(){return Ir||(Ir=1,sr=Jn()),sr}var Xn=Qn();const es=En(Xn);function ts(d,h,t,r,e,n){n===void 0&&(n=0);var a=_t(d,h,n),c=a.width,w=a.height,b=Math.min(c,t),o=Math.min(w,r);return b>o*e?{width:o*e,height:o}:{width:b,height:b/e}}function rs(d){return d.width>d.height?d.width/d.naturalWidth:d.height/d.naturalHeight}function Nt(d,h,t,r,e){e===void 0&&(e=0);var n=_t(h.width,h.height,e),a=n.width,c=n.height;return{x:Fr(d.x,a,t.width,r),y:Fr(d.y,c,t.height,r)}}function Fr(d,h,t,r){var e=h*r/2-t/2;return Ht(d,-e,e)}function zr(d,h){return Math.sqrt(Math.pow(d.y-h.y,2)+Math.pow(d.x-h.x,2))}function Wr(d,h){return Math.atan2(h.y-d.y,h.x-d.x)*180/Math.PI}function ns(d,h,t,r,e,n,a){n===void 0&&(n=0),a===void 0&&(a=!0);var c=a?ss:as,w=_t(h.width,h.height,n),b=_t(h.naturalWidth,h.naturalHeight,n),o={x:c(100,((w.width-t.width/e)/2-d.x/e)/w.width*100),y:c(100,((w.height-t.height/e)/2-d.y/e)/w.height*100),width:c(100,t.width/w.width*100/e),height:c(100,t.height/w.height*100/e)},i=Math.round(c(b.width,o.width*b.width/100)),l=Math.round(c(b.height,o.height*b.height/100)),u=b.width>=b.height*r,p=u?{width:Math.round(l*r),height:l}:{width:i,height:Math.round(i/r)},k=ze(ze({},p),{x:Math.round(c(b.width-p.width,o.x*b.width/100)),y:Math.round(c(b.height-p.height,o.y*b.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:k}}function ss(d,h){return Math.min(d,Math.max(0,h))}function as(d,h){return h}function os(d,h,t,r,e,n){var a=_t(h.width,h.height,t),c=Ht(r.width/a.width*(100/d.width),e,n),w={x:c*a.width/2-r.width/2-a.width*c*(d.x/100),y:c*a.height/2-r.height/2-a.height*c*(d.y/100)};return{crop:w,zoom:c}}function is(d,h,t){var r=rs(h);return t.height>t.width?t.height/(d.height*r):t.width/(d.width*r)}function ls(d,h,t,r,e,n){t===void 0&&(t=0);var a=_t(h.naturalWidth,h.naturalHeight,t),c=Ht(is(d,h,r),e,n),w=r.height>r.width?r.height/d.height:r.width/d.width,b={x:((a.width-d.width)/2-d.x)*w,y:((a.height-d.height)/2-d.y)*w};return{crop:b,zoom:c}}function $r(d,h){return{x:(h.x+d.x)/2,y:(h.y+d.y)/2}}function cs(d){return d*Math.PI/180}function _t(d,h,t){var r=cs(t);return{width:Math.abs(Math.cos(r)*d)+Math.abs(Math.sin(r)*h),height:Math.abs(Math.sin(r)*d)+Math.abs(Math.cos(r)*h)}}function Ht(d,h,t){return Math.min(Math.max(d,h),t)}function Dt(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];return d.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var ds=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,us=1,fs=3,hs=1,ms=(function(d){Vn(h,d);function h(){var t=d!==null&&d.apply(this,arguments)||this;return t.cropperRef=U.createRef(),t.imageRef=U.createRef(),t.videoRef=U.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.previousCropSize=null,t.isInitialized=!1,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var r=!0;t.resizeObserver=new window.ResizeObserver(function(e){if(r){r=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(r){return r.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var r=t.computeSizes();r&&(t.previousCropSize=r,t.emitCropData(),t.setInitialCrop(r),t.isInitialized=!0),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(r){if(t.props.initialCroppedAreaPercentages){var e=os(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),n=e.crop,a=e.zoom;t.props.onCropChange(n),t.props.onZoomChange&&t.props.onZoomChange(a)}else if(t.props.initialCroppedAreaPixels){var c=ls(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),n=c.crop,a=c.zoom;t.props.onCropChange(n),t.props.onZoomChange&&t.props.onZoomChange(a)}},t.computeSizes=function(){var r,e,n,a,c,w,b=t.imageRef.current||t.videoRef.current;if(b&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var o=t.containerRect.width/t.containerRect.height,i=((r=t.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((e=t.videoRef.current)===null||e===void 0?void 0:e.videoWidth)||0,l=((n=t.imageRef.current)===null||n===void 0?void 0:n.naturalHeight)||((a=t.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,u=b.offsetWidth<i||b.offsetHeight<l,p=i/l,k=void 0;if(u)switch(t.state.mediaObjectFit){default:case"contain":k=o>p?{width:t.containerRect.height*p,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/p};break;case"horizontal-cover":k={width:t.containerRect.width,height:t.containerRect.width/p};break;case"vertical-cover":k={width:t.containerRect.height*p,height:t.containerRect.height};break}else k={width:b.offsetWidth,height:b.offsetHeight};t.mediaSize=ze(ze({},k),{naturalWidth:i,naturalHeight:l}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var _=t.props.cropSize?t.props.cropSize:ts(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((c=t.state.cropSize)===null||c===void 0?void 0:c.height)!==_.height||((w=t.state.cropSize)===null||w===void 0?void 0:w.width)!==_.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(_),t.setState({cropSize:_},t.recomputeCropPosition),t.props.setCropSize&&t.props.setCropSize(_),_}},t.saveContainerPosition=function(){if(t.containerRef){var r=t.containerRef.getBoundingClientRect();t.containerPosition={x:r.left,y:r.top}}},t.onMouseDown=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(h.getMousePoint(r)))},t.onMouseMove=function(r){return t.onDrag(h.getMousePoint(r))},t.onScroll=function(r){t.currentDoc&&(r.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(r){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(r))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),r.touches.length===2?t.onPinchStart(r):r.touches.length===1&&t.onDragStart(h.getTouchPoint(r.touches[0]))))},t.onTouchMove=function(r){r.preventDefault(),r.touches.length===2?t.onPinchMove(r):r.touches.length===1&&t.onDrag(h.getTouchPoint(r.touches[0]))},t.onGestureStart=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(r){if(r.preventDefault(),!t.isTouching){var e=h.getMousePoint(r),n=t.gestureZoomStart-1+r.scale;if(t.setNewZoom(n,e,{shouldUpdatePosition:!0}),t.props.onRotationChange){var a=t.gestureRotationStart+r.rotation;t.props.onRotationChange(a)}}},t.onGestureEnd=function(r){t.cleanEvents()},t.onDragStart=function(r){var e,n,a=r.x,c=r.y;t.dragStartPosition={x:a,y:c},t.dragStartCrop=ze({},t.props.crop),(n=(e=t.props).onInteractionStart)===null||n===void 0||n.call(e)},t.onDrag=function(r){var e=r.x,n=r.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(e===void 0||n===void 0)){var a=e-t.dragStartPosition.x,c=n-t.dragStartPosition.y,w={x:t.dragStartCrop.x+a,y:t.dragStartCrop.y+c},b=t.props.restrictPosition?Nt(w,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):w;t.props.onCropChange(b)}}))},t.onDragStopped=function(){var r,e;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(e=(r=t.props).onInteractionEnd)===null||e===void 0||e.call(r)},t.onWheel=function(r){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(r))){r.preventDefault();var e=h.getMousePoint(r),n=es(r).pixelY,a=t.props.zoom-n*t.props.zoomSpeed/200;t.setNewZoom(a,e,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var c,w;return(w=(c=t.props).onInteractionStart)===null||w===void 0?void 0:w.call(c)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var c,w;return(w=(c=t.props).onInteractionEnd)===null||w===void 0?void 0:w.call(c)})},250)}},t.getPointOnContainer=function(r,e){var n=r.x,a=r.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(n-e.x),y:t.containerRect.height/2-(a-e.y)}},t.getPointOnMedia=function(r){var e=r.x,n=r.y,a=t.props,c=a.crop,w=a.zoom;return{x:(e+c.x)/w,y:(n+c.y)/w}},t.setNewZoom=function(r,e,n){var a=n===void 0?{}:n,c=a.shouldUpdatePosition,w=c===void 0?!0:c;if(!(!t.state.cropSize||!t.props.onZoomChange)){var b=Ht(r,t.props.minZoom,t.props.maxZoom);if(w){var o=t.getPointOnContainer(e,t.containerPosition),i=t.getPointOnMedia(o),l={x:i.x*b-o.x,y:i.y*b-o.y},u=t.props.restrictPosition?Nt(l,t.mediaSize,t.state.cropSize,b,t.props.rotation):l;t.props.onCropChange(u)}t.props.onZoomChange(b)}},t.getCropData=function(){if(!t.state.cropSize)return null;var r=t.props.restrictPosition?Nt(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return ns(r,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var r=t.getCropData();if(r){var e=r.croppedAreaPercentages,n=r.croppedAreaPixels;t.props.onCropComplete&&t.props.onCropComplete(e,n),t.props.onCropAreaChange&&t.props.onCropAreaChange(e,n)}},t.emitCropAreaChange=function(){var r=t.getCropData();if(r){var e=r.croppedAreaPercentages,n=r.croppedAreaPixels;t.props.onCropAreaChange&&t.props.onCropAreaChange(e,n)}},t.recomputeCropPosition=function(){var r,e;if(t.state.cropSize){var n=t.props.crop;if(t.isInitialized&&(!((r=t.previousCropSize)===null||r===void 0)&&r.width)&&(!((e=t.previousCropSize)===null||e===void 0)&&e.height)){var a=Math.abs(t.previousCropSize.width-t.state.cropSize.width)>1e-6||Math.abs(t.previousCropSize.height-t.state.cropSize.height)>1e-6;if(a){var c=t.state.cropSize.width/t.previousCropSize.width,w=t.state.cropSize.height/t.previousCropSize.height;n={x:t.props.crop.x*c,y:t.props.crop.y*w}}}var b=t.props.restrictPosition?Nt(n,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):n;t.previousCropSize=t.state.cropSize,t.props.onCropChange(b),t.emitCropData()}},t.onKeyDown=function(r){var e,n,a=t.props,c=a.crop,w=a.onCropChange,b=a.keyboardStep,o=a.zoom,i=a.rotation,l=b;if(t.state.cropSize){r.shiftKey&&(l*=.2);var u=ze({},c);switch(r.key){case"ArrowUp":u.y-=l,r.preventDefault();break;case"ArrowDown":u.y+=l,r.preventDefault();break;case"ArrowLeft":u.x-=l,r.preventDefault();break;case"ArrowRight":u.x+=l,r.preventDefault();break;default:return}t.props.restrictPosition&&(u=Nt(u,t.mediaSize,t.state.cropSize,o,i)),r.repeat||(n=(e=t.props).onInteractionStart)===null||n===void 0||n.call(e),w(u)}},t.onKeyUp=function(r){var e,n;switch(r.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":r.preventDefault();break;default:return}t.emitCropData(),(n=(e=t.props).onInteractionEnd)===null||n===void 0||n.call(e)},t}return h.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=ds,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},h.prototype.componentWillUnmount=function(){var t,r;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((r=this.styleRef.parentNode)===null||r===void 0||r.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},h.prototype.componentDidUpdate=function(t){var r,e,n,a,c,w,b,o,i;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((r=t.cropSize)===null||r===void 0?void 0:r.height)!==((e=this.props.cropSize)===null||e===void 0?void 0:e.height)||((n=t.cropSize)===null||n===void 0?void 0:n.width)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.width)?this.computeSizes():(((c=t.crop)===null||c===void 0?void 0:c.x)!==((w=this.props.crop)===null||w===void 0?void 0:w.x)||((b=t.crop)===null||b===void 0?void 0:b.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((i=this.videoRef.current)===null||i===void 0||i.load());var l=this.getObjectFit();l!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:l},this.computeSizes)},h.prototype.getAspect=function(){var t=this.props,r=t.cropSize,e=t.aspect;return r?r.width/r.height:e},h.prototype.getObjectFit=function(){var t,r,e,n;if(this.props.objectFit==="cover"){var a=this.imageRef.current||this.videoRef.current;if(a&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,w=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((r=this.videoRef.current)===null||r===void 0?void 0:r.videoWidth)||0,b=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoHeight)||0,o=w/b;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},h.prototype.onPinchStart=function(t){var r=h.getTouchPoint(t.touches[0]),e=h.getTouchPoint(t.touches[1]);this.lastPinchDistance=zr(r,e),this.lastPinchRotation=Wr(r,e),this.onDragStart($r(r,e))},h.prototype.onPinchMove=function(t){var r=this;if(!(!this.currentDoc||!this.currentWindow)){var e=h.getTouchPoint(t.touches[0]),n=h.getTouchPoint(t.touches[1]),a=$r(e,n);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=zr(e,n),w=r.props.zoom*(c/r.lastPinchDistance);r.setNewZoom(w,a,{shouldUpdatePosition:!1}),r.lastPinchDistance=c;var b=Wr(e,n),o=r.props.rotation+(b-r.lastPinchRotation);r.props.onRotationChange&&r.props.onRotationChange(o),r.lastPinchRotation=b})}},h.prototype.render=function(){var t=this,r,e=this.props,n=e.image,a=e.video,c=e.mediaProps,w=e.cropperProps,b=e.transform,o=e.crop,i=o.x,l=o.y,u=e.rotation,p=e.zoom,k=e.cropShape,_=e.showGrid,y=e.roundCropAreaPixels,D=e.style,I=D.containerStyle,P=D.cropAreaStyle,F=D.mediaStyle,j=e.classes,W=j.containerClassName,x=j.cropAreaClassName,m=j.mediaClassName,C=(r=this.state.mediaObjectFit)!==null&&r!==void 0?r:this.getObjectFit();return U.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(R){return t.containerRef=R},"data-testid":"container",style:I,className:Dt("reactEasyCrop_Container",W)},n?U.createElement("img",ze({alt:"",className:Dt("reactEasyCrop_Image",C==="contain"&&"reactEasyCrop_Contain",C==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",C==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},c,{src:n,ref:this.imageRef,style:ze(ze({},F),{transform:b||"translate(".concat(i,"px, ").concat(l,"px) rotate(").concat(u,"deg) scale(").concat(p,")")}),onLoad:this.onMediaLoad})):a&&U.createElement("video",ze({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Dt("reactEasyCrop_Video",C==="contain"&&"reactEasyCrop_Contain",C==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",C==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:ze(ze({},F),{transform:b||"translate(".concat(i,"px, ").concat(l,"px) rotate(").concat(u,"deg) scale(").concat(p,")")}),controls:!1}),(Array.isArray(a)?a:[{src:a}]).map(function(A){return U.createElement("source",ze({key:A.src},A))})),this.state.cropSize&&U.createElement("div",ze({ref:this.cropperRef,style:ze(ze({},P),{width:y?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:y?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Dt("reactEasyCrop_CropArea",k==="round"&&"reactEasyCrop_CropAreaRound",_&&"reactEasyCrop_CropAreaGrid",x)},w)))},h.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:fs,minZoom:us,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:hs},h.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},h.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},h})(U.Component);const $e=[];for(let d=0;d<256;++d)$e.push((d+256).toString(16).slice(1));function ps(d,h=0){return($e[d[h+0]]+$e[d[h+1]]+$e[d[h+2]]+$e[d[h+3]]+"-"+$e[d[h+4]]+$e[d[h+5]]+"-"+$e[d[h+6]]+$e[d[h+7]]+"-"+$e[d[h+8]]+$e[d[h+9]]+"-"+$e[d[h+10]]+$e[d[h+11]]+$e[d[h+12]]+$e[d[h+13]]+$e[d[h+14]]+$e[d[h+15]]).toLowerCase()}let ar;const gs=new Uint8Array(16);function xs(){if(!ar){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ar=crypto.getRandomValues.bind(crypto)}return ar(gs)}const ws=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Hr={randomUUID:ws};function bs(d,h,t){d=d||{};const r=d.random??d.rng?.()??xs();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ps(r)}function vs(d,h,t){return Hr.randomUUID&&!d?Hr.randomUUID():bs(d)}const Or=50,Pt=d=>{let h=null;if(d.reply_to){const t=Array.isArray(d.reply_to)?d.reply_to[0]:d.reply_to;d.reply_to_message_id&&(console.log("[normalizeMessage] Message has reply_to_message_id:",d.reply_to_message_id,"reply_to:",d.reply_to,"replyToData:",t),t&&console.log("[normalizeMessage] replyToData.id:",t.id,"replyToData.user_id:",t.user_id,"replyToData.content:",t.content)),t&&t.id&&t.user_id?h={id:t.id,content:t.content||"",user_id:t.user_id,author_name:t.author_name}:d.reply_to_message_id&&t&&console.warn("[normalizeMessage] Cannot create reply_to object - missing required fields. replyToData:",t,"has id:",!!t?.id,"has user_id:",!!t?.user_id)}return{id:d.id,league_id:d.league_id,user_id:d.user_id,content:d.content,created_at:d.created_at??new Date().toISOString(),status:"sent",reply_to_message_id:d.reply_to_message_id??null,reply_to:h}},kt=d=>{const h=new Map;for(const t of d)h.set(t.id,t);return Array.from(h.values()).sort((t,r)=>new Date(t.created_at).getTime()-new Date(r.created_at).getTime())};function ys(d,h={}){const{userId:t,enabled:r=!0,autoSubscribe:e=!0}=h,n=()=>!d||!r?[]:Fe(`chat:messages:${d}`)||[],[a,c]=U.useState(n),[w,b]=U.useState(!1),[o,i]=U.useState(!1),[l,u]=U.useState(!0),[p,k]=U.useState(null),_=U.useRef(null),y=U.useRef(null),D=U.useCallback(x=>{c(m=>{const C=x(m);return _.current=C.length?C[0].created_at:null,C})},[]),I=U.useCallback(async({before:x,append:m})=>{if(!d||!r)return;console.log("[fetchPage] Starting fetch for league:",d,"append:",m,"before:",x);const C=ae.from("league_messages").select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).eq("league_id",d).order("created_at",{ascending:!1}).limit(Or);x&&C.lt("created_at",x);const{data:A,error:R}=await C;if(R)throw console.error("[useMiniLeagueChat] Error fetching messages:",R),R;console.log("[fetchPage] Fetched",A?.length||0,"messages from database");const L=(A??[]).filter(f=>f.reply_to_message_id),N=[...new Set(L.map(f=>f.reply_to_message_id))];console.log("[fetchPage] Found",L.length,"messages with reply_to_message_id, unique reply IDs:",N.length);let E=new Map;if(N.length>0){const{data:f,error:B}=await ae.from("league_messages").select("id, content, user_id").in("id",N);B&&console.error("[useMiniLeagueChat] Error fetching reply messages:",B),!B&&f&&f.forEach(v=>{E.set(v.id,v)})}if(A&&A.length>0){const f=A.filter(B=>B.reply_to_message_id);f.length>0&&(console.log("[fetchPage] Found",f.length,"messages with reply_to_message_id"),f.slice(0,3).forEach(B=>{const v=E.get(B.reply_to_message_id);console.log("[fetchPage] Message",B.id,"reply_to_message_id:",B.reply_to_message_id,"replyData:",v)}))}const g=(A??[]).map(f=>{if(f.reply_to_message_id){const B=E.get(f.reply_to_message_id);B?f.reply_to=B:f.reply_to=null}else f.reply_to=null;return Pt(f)}).reverse();D(f=>kt(m?[...g,...f]:g)),(A??[]).length<Or?u(!1):m||u(!0)},[d,r,D]),P=U.useCallback(async()=>{if(!d||!r){c([]),u(!0);return}const x=a.length>0;x||b(!0),k(null),_.current=null;try{const m=Fe(`chat:messages:${d}`);if(m&&m.length>0){D(()=>m),m.length>0&&(_.current=m[0].created_at),u(m.length>=50),x||b(!1),I({append:!1}).catch(C=>{console.warn("[useMiniLeagueChat] Background refresh failed:",C)});return}await I({append:!1})}catch(m){console.error("[useMiniLeagueChat] Error in refresh:",m),k(m?.message??"Failed to load chat")}finally{x||b(!1)}},[d,r,I,D,a.length]);U.useEffect(()=>{if(!d||!r){c([]),u(!0),y.current=null;return}if(y.current===d)return;y.current=d;const x=a.length>0,m=Fe(`chat:messages:${d}`);if(x||m&&m.length>0){!x&&m?(D(()=>m),m.length>0&&(_.current=m[0].created_at),u(m.length>=50)):x&&a.length>0&&(_.current=a[0].created_at,u(a.length>=50)),y.current=null;return}let C=!0;if(P().finally(()=>{C&&y.current===d&&(y.current=null)}),!e)return()=>{C=!1};const A=ae.channel(`league-messages:${d}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${d}`},async L=>{if(!C)return;const{data:N}=await ae.from("league_messages").select(`
              id, 
              league_id, 
              user_id, 
              content, 
              created_at,
              reply_to_message_id
            `).eq("id",L.new.id).single();if(N){if(N.reply_to_message_id){const{data:g}=await ae.from("league_messages").select("id, content, user_id").eq("id",N.reply_to_message_id).single();g&&(N.reply_to=g)}const E=Pt(N);D(g=>g.some(f=>f.id===E.id)?g:kt([...g,E]))}else{console.warn("[useMiniLeagueChat] Failed to fetch full message, using payload data:",L.new.id);const E=Pt(L.new);D(g=>g.some(f=>f.id===E.id)?g:kt([...g,E]))}}).subscribe(),R=()=>{C&&document.visibilityState==="visible"&&P()};return document.addEventListener("visibilitychange",R),()=>{C=!1,document.removeEventListener("visibilitychange",R),ae.removeChannel(A)}},[d,r,e,P,D]);const F=U.useCallback(async()=>{if(!d||!r||!l||o)return;const x=_.current??a[0]?.created_at;if(x){i(!0);try{await I({before:x,append:!0})}catch(m){console.error("[useMiniLeagueChat] Error loading more messages:",m),k(m?.message??"Failed to load more messages")}finally{i(!1)}}},[d,r,l,o,I,a]),j=U.useCallback(async(x,m)=>{if(!d||!t)throw new Error("Missing league or user");const C=x.trim();if(!C)return;const A=vs(),R=`optimistic-${A}`,L={id:R,client_msg_id:A,league_id:d,user_id:t,content:C,created_at:new Date().toISOString(),status:"sending",reply_to_message_id:m??null};D(g=>kt([...g,L]));const{data:N,error:E}=await ae.from("league_messages").insert({league_id:d,user_id:t,content:C,reply_to_message_id:m??null}).select(`
          id, 
          league_id, 
          user_id, 
          content, 
          created_at,
          reply_to_message_id
        `).single();if(N&&N.reply_to_message_id){const{data:g}=await ae.from("league_messages").select("id, content, user_id").eq("id",N.reply_to_message_id).single();g&&(N.reply_to=g)}if(E)throw console.error("[useMiniLeagueChat] Error sending message:",E),D(g=>g.map(f=>f.id===R?{...f,status:"error"}:f)),E;if(N){const g=Pt(N);g.client_msg_id=A,D(f=>f.map(B=>B.id===R?{...g,status:"sent",client_msg_id:A}:B))}},[d,t,D]),W=U.useMemo(()=>a.slice(-5),[a]);return{messages:a,previewMessages:W,loading:w,loadingMore:o,hasMore:l,error:p,refresh:P,loadMore:F,sendMessage:j}}const _s={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},js={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"},Cs=["","",""],Ss=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function Ns({author:d,text:h,time:t,isOwnMessage:r,shape:e="single",messageId:n,reactions:a=[],onReactionClick:c,replyTo:w,onMessageClick:b}){const o="text-left",i=r?"bg-[#1C8376] text-white":"bg-white text-slate-900",l=r?js:_s,u="max-w-[85%]",[p,k]=U.useState(!1),[_,y]=U.useState(!1),D=U.useRef(null);U.useEffect(()=>{if(!p)return;const F=W=>{D.current&&!D.current.contains(W.target)&&k(!1)},j=setTimeout(()=>{document.addEventListener("mousedown",F)},100);return()=>{clearTimeout(j),document.removeEventListener("mousedown",F)}},[p]);const I=F=>{n&&c&&c(n,F),k(!1),y(!1)},P=F=>{const j=F.target;j.closest("button")||j.closest("[data-reaction]")||b&&b()};return s.jsxs("div",{className:`inline-block ${u} min-w-0 relative`,style:{width:"fit-content",maxWidth:"85%"},children:[s.jsxs("div",{className:`px-2.5 py-1.5 text-sm leading-relaxed shadow-sm whitespace-pre-wrap break-words ${o} ${i} ${l[e]} ${b?"cursor-pointer":""}`,onClick:P,style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline-block",width:"fit-content",maxWidth:"100%",overflow:"hidden"},children:[d&&!r&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:d}),w&&s.jsxs("div",{className:`mb-2 pb-2 border-l-2 ${r?"border-white/30 text-white/90":"border-[#1C8376] text-slate-600"} pl-2 text-xs`,style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",maxWidth:"100%"},children:[s.jsx("div",{className:"font-medium text-[10px] mb-0.5 break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w.authorName||"Unknown"}),s.jsx("div",{className:"text-[10px] break-words",style:{wordBreak:"break-word",overflowWrap:"anywhere",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.3",maxHeight:"2.6em"},children:w.content})]}),s.jsxs("div",{style:{wordBreak:"break-word",overflowWrap:"anywhere",position:"relative"},children:[s.jsx("span",{style:{wordBreak:"break-word",overflowWrap:"anywhere",display:"inline"},children:h}),s.jsx("span",{className:`text-[11px] relative top-1 ${r?"text-[#DCDCDD]":"text-slate-400"}`,style:{whiteSpace:"nowrap",float:"right",clear:"right",marginLeft:"12px"},children:t})]})]}),n&&!r&&s.jsxs("div",{className:"absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 flex items-center gap-1",children:[p&&s.jsxs("div",{ref:D,className:"flex items-center gap-1 bg-white rounded-full px-1 py-1 shadow-lg border border-slate-200 z-50",children:[Cs.map(F=>s.jsx("button",{onClick:()=>I(F),className:"w-7 h-7 rounded-full flex items-center justify-center text-base",title:`React with ${F}`,children:F},F)),b&&s.jsx("button",{onClick:()=>{k(!1),b()},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500",title:"Reply to message",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("button",{onClick:()=>{k(!1),y(!0)},className:"w-7 h-7 rounded-full flex items-center justify-center text-slate-500 font-semibold",title:"More reactions",children:s.jsx("span",{className:"text-sm",children:"+"})})]}),s.jsx("button",{onClick:()=>k(!p),className:"w-7 h-7 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center shadow-sm",title:"Add reaction",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),_&&n&&!r&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>y(!1)}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl border-t border-slate-200 overflow-x-hidden",style:{animation:"slideUp 0.3s ease-out"},children:s.jsxs("div",{className:"px-4 pt-3 pb-4 overflow-x-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full"}),s.jsx("button",{onClick:()=>y(!1),className:"px-4 py-1.5 text-sm font-medium text-slate-600 rounded-lg",children:"Close"}),s.jsx("div",{className:"w-12"})]}),s.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-64 overflow-y-auto overflow-x-hidden",children:Ss.map(F=>s.jsx("button",{onClick:()=>{n&&c&&c(n,F),y(!1)},className:"w-10 h-10 rounded-lg active:bg-slate-200 flex items-center justify-center text-2xl",title:F,children:F},F))})]})})]}),a.length>0&&s.jsx("div",{className:`mt-1 flex items-center gap-1 flex-wrap ${r?"justify-end":"justify-start"}`,children:a.map(F=>s.jsxs("button",{onClick:()=>I(F.emoji),className:`px-2 py-0.5 rounded-full text-sm flex items-center gap-1 ${F.hasUserReacted?"bg-[#1C8376] text-white":"bg-slate-100 text-slate-700"}`,children:[s.jsx("span",{className:"text-base",children:F.emoji}),s.jsx("span",{children:F.count})]},F.emoji))})]})}function ks({author:d,messages:h,isOwnMessage:t,avatarInitials:r,userId:e,reactions:n,onReactionClick:a,onMessageClick:c}){d==="Unknown"&&console.error('[MessageStack] Received "Unknown" as author prop!',"isOwnMessage:",t,"messages:",h.length);const w=t?"justify-end":"justify-start",b=e===Yr;return s.jsxs("div",{className:`flex items-end gap-2 w-full ${w}`,children:[t?s.jsx("div",{className:"w-8 flex-shrink-0"}):b?s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 border border-slate-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:s.jsx("img",{src:An,alt:"Volley",className:"w-8 h-8 rounded-full object-cover"})}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs font-semibold text-slate-500 flex-shrink-0",children:(r||d.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:h.map((o,i)=>{const l=h.length===1?"single":i===0?"top":i===h.length-1?"bottom":"middle",u=o.messageId||o.id;let p="";if(typeof o.text=="string")p=o.text;else if(typeof o.text=="object"&&o.text!==null){const k=o.text?.props?.children||String(o.text);p=typeof k=="string"?k:String(k)}else p=String(o.text);return s.jsx("div",{className:`flex flex-col w-full min-w-0 ${t?"items-end":"items-start"}`,children:s.jsxs("div",{className:`flex w-full min-w-0 ${t?"justify-end":"justify-start"}`,children:[s.jsx(Ns,{author:!t&&i===0?d:void 0,text:o.text,time:o.time,isOwnMessage:t,shape:l,messageId:u,reactions:n?.[u]||[],onReactionClick:a,replyTo:o.replyTo,onMessageClick:c?()=>c(u,p,!t&&i===0?d:void 0):void 0}),o.status&&s.jsx("div",{className:`text-[11px] ml-2 ${o.status==="error"?"text-red-500":"text-slate-400"}`,children:o.status==="error"?"Failed":"Sending"})]})},o.id)})})]})}function Es({groups:d,reactions:h,onReactionClick:t,onMessageClick:r}){const e=d.filter(n=>n.author==="Unknown");return e.length>0&&(console.error("[ChatThread] RENDERING with",e.length,'groups with "Unknown" author!'),e.forEach((n,a)=>{console.error(`[ChatThread] Group ${a}: id="${n.id}", author="${n.author}", messages=${n.messages.length}`)})),s.jsx("div",{className:"flex flex-col gap-5",children:d.map((n,a)=>s.jsxs("div",{className:"flex flex-col gap-3",children:[n.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:n.dayLabel}),s.jsx(ks,{author:n.author,avatarInitials:n.avatarInitials,isOwnMessage:n.isOwnMessage,userId:n.userId,messages:n.messages,reactions:h,onReactionClick:t,onMessageClick:r},`${n.id}-${n.author}-${a}`)]},`${n.id}-${n.author}-${a}`))})}const As=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Rs=d=>new Date(d).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Br=d=>{if(!d)return"?";const h=d.trim().split(/\s+/);return h.length===1?h[0][0]?.toUpperCase()??"?":`${h[0][0]?.toUpperCase()??""}${h[h.length-1][0]?.toUpperCase()??""}`},Et=(d,h)=>h?h instanceof Map?h.get(d)??"":h[d]??"":"";function Ms({miniLeagueId:d,memberNames:h,deepLinkError:t}){const{user:r}=Kr(),{messages:e,error:n,sendMessage:a}=ys(d,{userId:r?.id,enabled:!!d}),[c,w]=U.useState(""),[b,o]=U.useState(!1),[i,l]=U.useState({}),[u,p]=U.useState(null),[k,_]=U.useState([]),y=U.useRef(null),D=U.useRef(null),I=U.useRef(null),P=U.useRef(!1),[F,j]=U.useState(0);U.useEffect(()=>{if(!d||!r?.id)return;const v=async()=>{try{await ae.from("chat_presence").upsert({league_id:d,user_id:r.id,last_seen:new Date().toISOString()},{onConflict:"league_id,user_id"})}catch{}};v();const T=setInterval(v,1e4);return()=>clearInterval(T)},[d,r?.id]),U.useEffect(()=>{P.current=!1},[d]);const W=U.useCallback(()=>{if(y.current){const v=y.current.scrollHeight-y.current.clientHeight;y.current.scrollTop=v}},[]);U.useEffect(()=>{if(e.length===0||!r?.id)return;const v=e.map(Y=>Y.id).filter(Y=>!Y.startsWith("optimistic-"));if(v.length===0)return;(async()=>{try{const{data:Y,error:G}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",v);if(G){_(M=>[...M,{id:`reactions-${Date.now()}`,message:`Failed to load reactions: ${G.message}`,timestamp:Date.now()}]);return}const $={};(Y||[]).forEach(M=>{$[M.message_id]||($[M.message_id]={}),$[M.message_id][M.emoji]||($[M.message_id][M.emoji]={count:0,hasUserReacted:!1}),$[M.message_id][M.emoji].count++,M.user_id===r.id&&($[M.message_id][M.emoji].hasUserReacted=!0)});const H={};Object.keys($).forEach(M=>{H[M]=Object.entries($[M]).map(([J,Q])=>({emoji:J,count:Q.count,hasUserReacted:Q.hasUserReacted}))}),l(H)}catch(Y){_(G=>[...G,{id:`reactions-load-${Date.now()}`,message:`Error loading reactions: ${Y?.message||String(Y)}`,timestamp:Date.now()}])}})()},[e,r?.id]),U.useEffect(()=>{if(e.length===0||!r?.id)return;const v=e.map(Y=>Y.id).filter(Y=>!Y.startsWith("optimistic-"));if(v.length===0)return;const T=ae.channel("message-reactions-mlcb").on("postgres_changes",{event:"*",schema:"public",table:"league_message_reactions"},async()=>{try{const{data:Y,error:G}=await ae.from("league_message_reactions").select("message_id, emoji, user_id").in("message_id",v);if(G)return;const $={};(Y||[]).forEach(M=>{$[M.message_id]||($[M.message_id]={}),$[M.message_id][M.emoji]||($[M.message_id][M.emoji]={count:0,hasUserReacted:!1}),$[M.message_id][M.emoji].count++,M.user_id===r.id&&($[M.message_id][M.emoji].hasUserReacted=!0)});const H={};Object.keys($).forEach(M=>{H[M]=Object.entries($[M]).map(([J,Q])=>({emoji:J,count:Q.count,hasUserReacted:Q.hasUserReacted}))}),l(H)}catch{}}).subscribe();return()=>{ae.removeChannel(T)}},[e,r?.id]);const x=U.useCallback(async(v,T)=>{if(!r?.id)return;const G=(i[v]||[]).find($=>$.emoji===T&&$.hasUserReacted);if(l($=>{const H={...$},M=H[v]||[];if(G){const J=M.map(Q=>Q.emoji===T?{...Q,count:Math.max(0,Q.count-1),hasUserReacted:!1}:Q).filter(Q=>Q.count>0||Q.emoji!==T);J.length===0?delete H[v]:H[v]=J}else M.find(Q=>Q.emoji===T)?H[v]=M.map(Q=>Q.emoji===T?{...Q,count:Q.count+1,hasUserReacted:!0}:Q):H[v]=[...M,{emoji:T,count:1,hasUserReacted:!0}];return H}),G){const{error:$}=await ae.from("league_message_reactions").delete().eq("message_id",v).eq("user_id",r.id).eq("emoji",T);$&&l(H=>{const M={...H},J=M[v]||[];return J.find(ne=>ne.emoji===T)?M[v]=J.map(ne=>ne.emoji===T?{...ne,count:ne.count+1,hasUserReacted:!0}:ne):M[v]=[...J,{emoji:T,count:1,hasUserReacted:!0}],M})}else{const{error:$}=await ae.from("league_message_reactions").upsert({message_id:v,user_id:r.id,emoji:T});$&&l(H=>{const M={...H},Q=(M[v]||[]).map(ne=>ne.emoji===T?{...ne,count:Math.max(0,ne.count-1),hasUserReacted:!1}:ne).filter(ne=>ne.count>0||ne.emoji!==T);return Q.length===0?delete M[v]:M[v]=Q,M})}},[r?.id,i]);U.useEffect(()=>{!c&&D.current&&(D.current.style.height="auto",D.current.style.height="42px")},[c]);const m=U.useCallback(v=>{const T=I.current?.offsetHeight||72;if(v>0){const Y=v+T;if(j(v),y.current){const G=`${Y+8}px`;y.current.style.paddingBottom=G}}else if(j(0),y.current){const Y=`${T+8}px`;y.current.style.paddingBottom=Y}requestAnimationFrame(()=>{W()})},[W]);U.useEffect(()=>{const v=window.visualViewport;if(!v)return;let T=null,Y=0,G=!1;setTimeout(()=>{G=!0},500);const $=()=>{const ne=window.innerHeight,fe=v.height,me=v.offsetTop+fe;return Math.max(0,ne-me)},H=()=>{T&&clearTimeout(T),T=setTimeout(()=>{const ne=$();G&&Math.abs(ne-Y)>10&&(Y=ne,m(ne))},50)};v.addEventListener("resize",H),v.addEventListener("scroll",H),window.addEventListener("resize",H);const M=()=>{setTimeout(H,50)},J=()=>{setTimeout(H,100)},Q=setTimeout(()=>{D.current&&(D.current.addEventListener("focus",M),D.current.addEventListener("blur",J))},100);return H(),()=>{T&&clearTimeout(T),clearTimeout(Q),v.removeEventListener("resize",H),v.removeEventListener("scroll",H),window.removeEventListener("resize",H),D.current&&(D.current.removeEventListener("focus",M),D.current.removeEventListener("blur",J))}},[m]),U.useEffect(()=>{if(y.current&&I.current){const T=`${(I.current.offsetHeight||72)+8}px`;y.current.style.paddingBottom=T}},[]);const C=()=>{D.current&&D.current.removeAttribute("readonly");const v=()=>{const T=window.visualViewport;if(T){const Y=window.innerHeight,G=T.height,$=T.offsetTop+G,H=Math.max(0,Y-$);m(H)}};setTimeout(v,50),setTimeout(v,150),W()},A=v=>{const T=v.target;!(T.tagName==="A"||T.tagName==="BUTTON"||T.closest("a, button"))&&D.current&&document.activeElement===D.current&&D.current.blur()},R=U.useMemo(()=>{if(!r)return"";const v=r.user_metadata??{};return v.display_name||v.full_name||r.email||""},[r]),L=U.useMemo(()=>{if(!e.length)return[];if(!(h instanceof Map?h.size>0:h?Object.keys(h).length>0:!1))return[];let T=null;return e.reduce((G,$)=>{const H=$.user_id===r?.id,Q=Et($.user_id,h)||(H?R:"")||(H?"You":"Unknown"),ne=H?void 0:Br(Q),me=new Date($.created_at).toDateString(),Ce=me!==T;Ce&&(T=me);const Se=$.reply_to?Et($.reply_to.user_id,h)||"Unknown":null,Je={id:$.id,text:$.content,time:As($.created_at),status:$.status&&$.status!=="sent"?$.status:void 0,messageId:$.id,replyTo:$.reply_to?{id:$.reply_to.id,content:$.reply_to.content,authorName:Se||void 0}:null},Ee=G[G.length-1],Ne=Ee?.messages.length>0&&Ee.messages[0].messageId?e.find(ge=>ge.id===Ee.messages[0].messageId)?.user_id:null;if(Ee&&!Ce&&Ee.isOwnMessage===H&&Ne===$.user_id){const ge=Ee.id.includes("-")?Ee.id.split("-")[0]:Ee.id,xe=Ee.messages.map(je=>{const we=je.messageId?e.find(Re=>Re.id===je.messageId):null;if(we?.reply_to){const Re=Et(we.reply_to.user_id,h)||"Unknown";return{...je,replyTo:je.replyTo?{...je.replyTo,authorName:Re}:null}}return je}),Le={...Ee,id:`${ge}-${Q}`,author:Q,avatarInitials:ne,userId:$.user_id,messages:[...xe,Je]};return[...G.slice(0,-1),Le]}else return[...G,{id:`${$.id}-${Q}`,author:Q,avatarInitials:ne,isOwnMessage:H,userId:$.user_id,dayLabel:Ce?Rs($.created_at):void 0,messages:[Je]}]},[]).map(G=>{const $={...G},H=$.messages.map(M=>{const J=M.messageId?e.find(Q=>Q.id===M.messageId):null;if(J?.reply_to&&M.replyTo){const Q=Et(J.reply_to.user_id,h)||"Unknown";if(Q!==M.replyTo.authorName)return{...M,replyTo:{...M.replyTo,authorName:Q}}}return M});if($.author==="Unknown"&&$.messages.length>0&&$.messages[0].messageId){const M=e.find(J=>J.id===$.messages[0].messageId);if(M){const J=Et(M.user_id,h);if(J&&J!=="Unknown"){const Q=$.id.includes("-")?$.id.split("-")[0]:$.id;return{...$,id:`${Q}-${J}`,author:J,avatarInitials:Br(J),userId:M.user_id,messages:H}}}}return{...$,messages:H}})},[R,h,e,r?.id]),N=U.useMemo(()=>{const v=L.map(Y=>Y.author).join(","),T=L.some(Y=>Y.author==="Unknown");return`chat-${L.length}-${T?"unknown":"resolved"}-${v.slice(0,50)}`},[L]),E=U.useCallback(v=>{if(y.current=v,v){if(I.current){const Y=`${(I.current.offsetHeight||72)+8}px`;v.style.paddingBottom=Y}else v.style.paddingBottom="91px";requestAnimationFrame(()=>{requestAnimationFrame(()=>{v&&e.length>0&&L.length>0})})}},[e.length,L.length]);U.useEffect(()=>{P.current=!1},[d]),U.useEffect(()=>{e.length>0&&y.current&&(P.current||(P.current=!0),requestAnimationFrame(()=>{if(y.current){const v=y.current.scrollHeight,T=y.current.clientHeight,Y=v-T;v>T&&(y.current.scrollTop=Y)}}))},[e.length,e]);const g=U.useCallback(async v=>{if(!d||!r?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const Y=r.user_metadata?.display_name||r.user_metadata?.full_name||r.email||"User";try{await fetch("/.netlify/functions/notifyLeagueMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:d,senderId:r.id,senderName:Y,content:v,activeUserIds:[r.id]})})}catch{}},[d,r?.id]),f=U.useCallback(async()=>{const v=c.trim();if(!(!d||!v||b))try{o(!0),w(""),D.current&&(D.current.style.height="auto",D.current.style.height="42px"),await a(v,u?.id||null),await g(v),p(null),W()}catch(T){_(Y=>[...Y,{id:`send-${Date.now()}`,message:`Failed to send message: ${T?.message||String(T)}`,timestamp:Date.now()}]),w(v)}finally{o(!1)}},[c,d,g,W,a,b,u]);U.useEffect(()=>{t&&_(v=>v.some(T=>T.message.includes("Deep Link"))?v:[...v,{id:`deeplink-${Date.now()}`,message:`Deep Link Error: ${t}`,timestamp:Date.now()}])},[t]),U.useEffect(()=>{if(k.length===0)return;const v=setTimeout(()=>{_(T=>T.filter(Y=>Date.now()-Y.timestamp<5e3))},5e3);return()=>clearTimeout(v)},[k]);const B=e.length>0&&L.length>0;return s.jsxs("div",{className:"flex flex-col h-full w-full",style:{position:"relative",zIndex:1,overflowX:"hidden"},children:[k.length>0&&s.jsx("div",{className:"px-4 pt-2 space-y-2",children:k.map(v=>s.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 text-xs px-3 py-2 rounded-lg flex items-start justify-between gap-2",children:[s.jsx("span",{className:"flex-1",children:v.message}),s.jsx("button",{onClick:()=>_(T=>T.filter(Y=>Y.id!==v.id)),className:"text-red-600 flex-shrink-0",children:""})]},v.id))}),s.jsx("div",{ref:E,className:"flex-1 overflow-y-auto px-4 py-5",onClick:A,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",backgroundColor:"transparent",cursor:"pointer",overflowX:"hidden",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",paddingBottom:"91px"},children:B?s.jsx(s.Fragment,{children:s.jsx(Es,{groups:L,reactions:i,onReactionClick:x,onMessageClick:(v,T,Y)=>{const G=e.find($=>$.id===v);if(G){let $="";if(typeof T=="string")$=T;else if(typeof T=="object"&&T!==null){const H=T?.props?.children||String(T);$=typeof H=="string"?H:String(H)}else $=String(T);p({id:v,content:$||G.content,authorName:Y}),setTimeout(()=>{D.current?.focus()},100)}}},N)}):null}),s.jsxs("div",{ref:I,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:F>0?"fixed":"relative",bottom:F>0?`${F}px`:"0",left:F>0?0:"auto",right:F>0?0:"auto",width:"100%",maxWidth:F>0?"440px":"100%",marginLeft:F>0?"auto":void 0,marginRight:F>0?"auto":void 0,zIndex:F>0?100:"auto",boxShadow:F>0?"0 -2px 8px rgba(0, 0, 0, 0.1)":"none",overflowX:"hidden",pointerEvents:"auto"},children:[u&&s.jsxs("div",{className:"mb-2 px-3 py-2 bg-slate-50 border-l-2 border-[#1C8376] rounded-lg flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-xs font-medium text-[#1C8376] mb-0.5",children:["Replying to ",u.authorName||"Unknown"]}),s.jsx("div",{className:"text-xs text-slate-600 line-clamp-2 truncate",children:u.content})]}),s.jsx("button",{onClick:()=>p(null),className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-slate-500",title:"Cancel reply",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2 relative",children:[s.jsx("textarea",{ref:D,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:c,disabled:!d||b,placeholder:d?"Start typing a message":"Join this league to chat",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:!0,inputMode:"text",enterKeyHint:"send","data-1p-ignore":"true",onKeyDown:v=>{if(v.key==="Escape"&&u){p(null),v.preventDefault();return}v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),f())},onChange:v=>{w(v.target.value),D.current&&(D.current.style.height="auto",D.current.style.height=`${Math.min(D.current.scrollHeight,120)}px`),requestAnimationFrame(()=>{const T=window.visualViewport;if(T){const Y=window.innerHeight,G=T.height,$=T.offsetTop+G,H=Y-$;m(H)}})},onFocus:C,style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:f,disabled:!d||b||!c.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),n&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[n,"  try again or switch to the classic chat tab."]})]})]})}function Ls({winnerName:d,isDraw:h}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:h?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[d," Wins!"]})})})}function Ts({availableGws:d,selectedGw:h,onChange:t,className:r=""}){return d.length<=1?null:s.jsx("div",{className:`flex-1 ${r}`,children:s.jsx("select",{value:h||void 0,onChange:e=>{const n=parseInt(e.target.value,10);t(n)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:d.map(e=>s.jsxs("option",{value:e,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",e]},e))})})}function Ds({showForm:d,onToggle:h}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>h(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${d?"text-slate-600":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>h(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full ${d?"bg-[#1C8376] text-white shadow-sm":"text-slate-600"}`,children:"Form"})]})}function Ps({form:d}){const h=d.slice(-5),t=5-h.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:t}).map((r,e)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${e}`)),h.map((r,e)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${r==="W"?"bg-green-100 text-green-700":r==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:r},e))]})}function Us({rows:d,members:h,showForm:t,currentUserId:r,loading:e,isLateStartingLeague:n}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),t?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:n?"CP":"OCP"}),h.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[d.map((a,c)=>{const w=a.user_id===r,b=c===d.length-1;return s.jsxs("tr",{className:w?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...b?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap bg-slate-50 pl-2 pr-4 overflow-hidden text-ellipsis",children:a.name}),t?s.jsx("td",{className:"px-4 py-4 bg-slate-50",children:s.jsx(Ps,{form:a.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-10 pl-1 pr-1",children:a.ocp}),h.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1",children:a.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-10 pl-1 pr-1",children:a.mltPts})]})]},a.user_id)}),e&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:h.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!e&&!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:t?3:h.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function Is({rows:d,members:h,currentUserId:t,positionChangeKeys:r,isApiTestLeague:e,hasLiveFixtures:n,hasStartingSoonFixtures:a,hasStartedFixtures:c,allFixturesFinished:w,resGw:b}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",e&&n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),e&&!w&&a&&!n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),h.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[d.map((o,i)=>{const l=o.user_id===t,u=i===d.length-1,p=r.has(o.user_id);return s.jsxs("tr",{className:`${l?"flash-user-row":""} ${p?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...u?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:i+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[e&&n&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),e&&!n&&a&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold text-[#1C8376] bg-slate-50 w-[50px] pl-1 pr-1 ${e&&n?"pulse-live-score":""}`,children:o.score}),h.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums bg-slate-50 w-[35px] pl-1 pr-1 ${e&&n?"pulse-live-score":""}`,children:o.unicorns})]},o.user_id)}),!d.length&&s.jsx("tr",{className:"bg-slate-50",children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center bg-slate-50",colSpan:h.length>=3?4:3,children:["No results recorded for GW ",b," yet."]})})]})]})})]})}function Fs(d){const h=Rn(),t=encodeURIComponent(d);if(h){const r=`whatsapp://send?text=${t}`;let e=!1,n=!1;try{const a=document.createElement("a");a.href=r,a.style.display="none",document.body.appendChild(a),a.click(),e=!0,setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},100)}catch{}if(!e)try{window.open(r),n=!0}catch{}if(!e&&!n)try{window.location.href=r}catch{window.open(`https://wa.me/?text=${t}`,"_blank")}}else{const r=`https://wa.me/?text=${t}`;try{window.open(r,"_blank")}catch{navigator.clipboard.writeText(d).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+d)})}}}function zs(d,h){const t=new Date(h.find(i=>i.gw===d)?.kickoff_time||""),r=new Date(t.getTime()-4500*1e3),e=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],n=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],a=e[r.getUTCDay()],c=r.getUTCDate(),w=n[r.getUTCMonth()],b=r.getUTCHours().toString().padStart(2,"0"),o=r.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${d} Predictions Reminder!

DEADLINE: THIS ${a} ${c} ${w}, ${b}:${o} BST

Don't forget!
playtotl.com`}function Ws(d,h){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",d);try{const t=zs(d,h);console.log("[SubmissionStatusTable] Generated message:",t),Fs(t)}catch(t){console.error("[SubmissionStatusTable] Error in handleShareReminder:",t),alert("Error sharing reminder. Please try again.")}}function Gr({members:d,submittedMap:h,picksGw:t,allSubmitted:r,remaining:e,fixtures:n,onShareReminder:a,variant:c="full"}){const w=a||(()=>Ws(t,n)),b=n.map(p=>p.kickoff_time).filter(p=>!!p).map(p=>new Date(p)).filter(p=>!isNaN(p.getTime())),o=b.length>0?new Date(Math.min(...b.map(p=>p.getTime()))):null,i=o?new Date(o.getTime()-4500*1e3):null,l=i?new Date>=i:!1;let u="";if(i){const p=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=p[i.getUTCDay()],y=i.getUTCDate(),D=k[i.getUTCMonth()],I=i.getUTCHours().toString().padStart(2,"0"),P=i.getUTCMinutes().toString().padStart(2,"0");u=`${_} ${y} ${D}, ${I}:${P} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",d.length," to submit."]})}),!r&&s.jsxs("button",{type:"button",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),w()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),u&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${l?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),l?"Deadline Passed:":"Deadline:",u]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((p,k)=>p.name.localeCompare(k.name)).map(p=>{const k=`${p.id}:${t}`,_=!!h.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:p.name}),s.jsx("td",{className:"px-4 py-3",children:_?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},p.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:r?s.jsxs(s.Fragment,{children:["All ",d.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",d.length," to submit."]})}),!r&&s.jsxs("button",{type:"button",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),w()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),u&&s.jsxs("div",{className:`mb-3 text-sm ${l?"text-orange-600 font-semibold":"text-slate-600"}`,children:[l?" Deadline Passed:":" Deadline:",u]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((p,k)=>p.name.localeCompare(k.name)).map(p=>{const k=`${p.id}:${t}`,_=!!h.get(k);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:p.name}),s.jsx("td",{className:"px-4 py-3",children:_?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},p.id)})})]})})]})}function qr({letter:d,correct:h,unicorn:t,hasSubmitted:r,isLive:e,isOngoing:n,isFinished:a}){let c;return h===!0?e||n?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":a?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":r?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:t?"Correct!":void 0,children:d})}function $s(d,h){return d==="FINISHED"?"FT":d==="PAUSED"?"HT":d==="IN_PLAY"?h==null?"LIVE":`${h}'`:"LIVE"}function Hs(d){const h=(d||"?").trim().split(/\s+/);return h.length?h.length===1?h[0].slice(0,1).toUpperCase():(h[0][0]+h[h.length-1][0]).toUpperCase():"?"}function Os({fixture:d,picks:h,members:t,outcome:r,liveScore:e,submittedMap:n,picksGw:a,isApiTestLeague:c=!1}){const w=d.home_code||d.home_team||d.home_name||"",b=d.away_code||d.away_team||d.away_name||"",o=Nr(w)||d.home_name||d.home_team||"Home",i=Nr(b)||d.away_name||d.away_team||"Away",u=(P=>{if(!P)return"";const F=new Date(P);if(isNaN(F.getTime()))return"";const j=String(F.getUTCHours()).padStart(2,"0"),W=String(F.getUTCMinutes()).padStart(2,"0");return`${j}:${W}`})(d.kickoff_time),p=!!(e&&e.status==="IN_PLAY"),k=!!(e&&(e.status==="PAUSED"||e.status==="HALF_TIME"||e.status==="HT")),_=!!(e&&e.status==="FINISHED"),y=p||k;let D=null;c&&e?e.homeScore>e.awayScore?D="H":e.awayScore>e.homeScore?D="A":e.homeScore===e.awayScore&&(D="D"):D=r;const I=P=>{const F=h.filter(m=>m.pick===P),j=h.length===t.length&&F.length===t.length,W=4,x=[];for(let m=0;m<F.length;m+=W){const C=F.slice(m,m+W);x.push(C)}return s.jsx("div",{className:"flex flex-col gap-1",children:x.map((m,C)=>s.jsx("div",{className:"flex items-center justify-center",children:m.map((A,R)=>{const L=t.find(f=>f.id===A.user_id),N=Hs(L?.name??"?"),E=n.has(`${A.user_id}:${a}`),g=D&&D===P?!0:null;return j?s.jsx("span",{className:"inline-block",style:{marginLeft:R>0?"-8px":"0",position:"relative",zIndex:R},children:s.jsx(qr,{letter:N,correct:g,unicorn:g===!0,hasSubmitted:E,isLive:p,isOngoing:y,isFinished:_})},A.user_id):s.jsx(qr,{letter:N,correct:g,unicorn:g===!0,hasSubmitted:E,isLive:p,isOngoing:y,isFinished:_},A.user_id)})},C))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(p||k)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),_&&!p&&!k&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${y?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(kr,{code:d.home_code||void 0,crest:d.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:e&&(p||k||_)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[e.homeScore," - ",e.awayScore]}):s.jsx("span",{children:u})}),s.jsx(kr,{code:d.away_code||void 0,crest:d.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:i})})]}),e&&(y||_)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${y?"text-red-600":"text-slate-500"}`,children:$s(e.status,e.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:I("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:I("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:I("A")})})]})]})})}function Vr({label:d,fixtures:h,picksByFixture:t,members:r,outcomes:e,liveScores:n,submittedMap:a,picksGw:c,isApiTestLeague:w=!1,isFirstSection:b=!1,hasLiveGames:o=!1,allGamesFinished:i=!1,allSubmitted:l=!1,resultsPublished:u=!1,deadlinePassed:p=!1,whoDidntSubmit:k=[],liveFixturesCount:_,hasStarted:y=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(Mn,{date:d,className:"text-lg font-normal"}),b&&s.jsxs(s.Fragment,{children:[w&&o&&_!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:_}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:h.length})]})]}),w&&i&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),w&&!y&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&l&&u&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!w&&l&&!u&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!w&&p&&!l&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",k.length>0&&`(${k.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[h.map(D=>{try{const I=t.get(D.fixture_index)??[],P=e.get(D.fixture_index)||null,F=n[D.fixture_index]||null;return s.jsx(Os,{fixture:D,picks:I,members:r,outcome:P,liveScore:F,submittedMap:a,picksGw:c,isApiTestLeague:w},`${D.gw}-${D.fixture_index}`)}catch(I){return console.error("Error rendering fixture:",I,D),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",D.fixture_index]},`${D.gw}-${D.fixture_index}`)}}),!h.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const or=8;function ir(d){return d.result==="H"||d.result==="D"||d.result==="A"?d.result:typeof d.home_goals=="number"&&typeof d.away_goals=="number"?d.home_goals>d.away_goals?"H":d.home_goals<d.away_goals?"A":"D":null}function Gs(){const{code:d=""}=Ln(),[h,t]=Tn(),{user:r}=Kr(),[e]=U.useState(()=>{const S=localStorage.getItem("oldSchoolMode");return S?JSON.parse(S):!1});U.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(e))},[e]),U.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const S=()=>{const V=document.querySelector(".league-header-fixed");if(V){const re=V.style.top||window.getComputedStyle(V).top;re!=="0px"&&re!=="0"&&(V.style.top="0",V.style.transform="translate3d(0, 0, 0)")}},z=()=>{S(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},O=V=>{const re=V.target;re.closest(".league-content-wrapper")||re.closest(".league-header-fixed")||re.closest(".chat-tab-wrapper")||V.preventDefault()};window.addEventListener("scroll",z,{passive:!0}),document.addEventListener("touchmove",O,{passive:!1});const q=setInterval(S,100);return S(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",z),document.removeEventListener("touchmove",O),clearInterval(q)}},[]),U.useEffect(()=>{const S=O=>{const q=O.target;(q.tagName==="INPUT"||q.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const V=document.querySelector(".league-header-fixed");V&&(V.style.top="0")},100)},z=()=>{const O=document.querySelector(".league-header-fixed");O&&(O.style.top="0")};return document.addEventListener("focusin",S),window.addEventListener("resize",z),window.addEventListener("orientationchange",z),()=>{document.removeEventListener("focusin",S),window.removeEventListener("resize",z),window.removeEventListener("orientationchange",z)}},[]),U.useEffect(()=>{if(typeof window>"u")return;const S=window.visualViewport;if(!S)return;let z=null;const O=()=>{const V=W.current;if(!V)return;const re=S.offsetTop??0;V.style.setProperty("transform",`translate3d(0, ${re}px, 0)`,"important")},q=()=>{z&&cancelAnimationFrame(z),z=window.requestAnimationFrame(O)};return q(),S.addEventListener("resize",q),S.addEventListener("scroll",q),()=>{z&&cancelAnimationFrame(z),S.removeEventListener("resize",q),S.removeEventListener("scroll",q),W.current&&W.current.style.removeProperty("transform")}},[]);const n=()=>{if(!d)return null;try{const S=Fe(`leagues:${r?.id||""}`);if(S){const z=S.find(O=>O.code.toUpperCase()===d.toUpperCase());if(z)return z}}catch{}return null},[a,c]=U.useState(()=>n()),[w,b]=U.useState(!1),o=()=>{const S=n();if(!S?.id)return[];try{const z=Fe(`league:members:${S.id}`);if(z&&z.length>0)return z.map(([O,q])=>({id:O,name:q||"(no name)"}))}catch{}return[]},[i,l]=U.useState(o),[u,p]=U.useState(()=>!n()),k="chat",[_,y]=U.useState(k),[D,I]=U.useState(null),P=U.useRef(_);U.useEffect(()=>{P.current=_},[_]);const F=U.useRef(!1),j=U.useRef(!1);U.useEffect(()=>{const S=h.get("tab"),z=h.get("leagueCode");if(I(null),S==="chat"||z){if(z&&d!==z){I(`Deep link mismatch: URL has leagueCode=${z} but we're on league ${d}. Current URL: ${window.location.href}`);return}if(S==="chat"){_!=="chat"&&(y("chat"),setTimeout(()=>{P.current!=="chat"&&I(`Failed to open chat tab. Current tab: ${P.current}, Expected: chat. URL: ${window.location.href}`)},300));const O=setTimeout(()=>{t({},{replace:!0})},200);return()=>clearTimeout(O)}}},[h,t,_,d]);const W=U.useRef(null),[x,m]=U.useState(!1),[C,A]=U.useState(!1),[R,L]=U.useState(!1),N=()=>{try{return Fe("app_meta:current_gw")?.current_gw??null}catch{return null}},[E,g]=U.useState(N),[f,B]=U.useState(null),[v,T]=U.useState(N),Y=()=>{try{return Fe("app:available_gws")??[]}catch{return[]}},[G,$]=U.useState(()=>Y()),H=U.useRef({}),M=U.useRef({}),J=U.useRef(new Map),[Q,ne]=U.useState(new Set),[fe,me]=U.useState(!1),[Ce,Se]=U.useState(!1),[Je,Ee]=U.useState(0),[Ne,Te]=U.useState(!1),[ge,xe]=U.useState(!1),[Le,je]=U.useState(!1),[we,Re]=U.useState(!1),[ke,he]=U.useState(null),[Ge,Oe]=U.useState(!1),[Qe,Ae]=U.useState(null),[lt,Pe]=U.useState({x:0,y:0}),[qe,Be]=U.useState(1),[Ke,Xe]=U.useState(null),[Ue,ct]=U.useState(null),[Ot,gt]=U.useState(!1),[At,dt]=U.useState(!1),[jt,nt]=U.useState(!1),[et,tt]=U.useState(!1),[xt,vt]=U.useState(!1),[ut,st]=U.useState(!1),[Rt,ur]=U.useState(null),[Bt,fr]=U.useState(!1),[Gt,hr]=U.useState(!1),[Ct,ln]=U.useState(null),ft=U.useMemo(()=>!!r?.id&&i.some(S=>S.id===r.id),[r?.id,i]),mr=U.useMemo(()=>!!r?.id&&!!Ct&&Ct.id===r.id,[r?.id,Ct]),cn=U.useMemo(()=>Ct?.name??"League admin",[Ct]),dn=U.useMemo(()=>{const S=new Map;return i.forEach(z=>S.set(z.id,z.name)),S.set(Yr,Dn),S},[i]),pr=U.useCallback(()=>{if(!a?.code||typeof window>"u"||typeof navigator>"u")return;const S=`Join my mini league "${a.name}" on TotL!`,z=`${window.location.origin}/league/${a.code}`,O=navigator;if(typeof O.share=="function"){O.share({title:`Join ${a.name}`,text:S,url:z}).catch(()=>{});return}const q=`${S}
${z}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(q).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",a.code)}):window.prompt?.("Share this league code:",a.code)},[a]),un=U.useCallback(async()=>{if(!(!a?.id||!r?.id)){L(!0);try{const{error:S}=await ae.from("league_members").delete().eq("league_id",a.id).eq("user_id",r.id);if(S)throw S;typeof window<"u"&&(window.location.href="/leagues")}catch(S){typeof window<"u"&&window.alert?.(S?.message??"Failed to leave league. Please try again.")}finally{L(!1),A(!1)}}},[a?.id,r?.id]),fn=U.useCallback(async()=>{if(!(!a?.id||!r?.id)){nt(!0);try{if(i.length>=or){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),dt(!1);return}const{error:S}=await ae.from("league_members").insert({league_id:a.id,user_id:r.id});if(S)throw S;const z=r.user_metadata?.display_name||r.email||"Someone";try{const O=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:a.id,userId:r.id,userName:z})}),q=await O.text();try{q&&JSON.parse(q)}catch{}O.ok}catch{}typeof window<"u"&&window.location.reload()}catch(S){typeof window<"u"&&window.alert?.(S?.message??"Failed to join league.")}finally{nt(!1)}}},[a?.id,r?.id,i.length]),hn=U.useCallback(async()=>{if(!(!Rt||!a?.id||!r?.id)){fr(!0);try{const{error:S}=await ae.from("league_members").delete().eq("league_id",a.id).eq("user_id",Rt.id);if(S)throw S;typeof window<"u"&&window.location.reload()}catch(S){typeof window<"u"&&window.alert?.(S?.message??"Failed to remove member.")}finally{fr(!1),vt(!1),ur(null)}}},[a?.id,Rt,r?.id]),mn=U.useCallback(async()=>{if(!(!a?.id||!r?.id)){hr(!0);try{const{error:S}=await ae.from("league_members").delete().eq("league_id",a.id);if(S)throw S;const{error:z}=await ae.from("leagues").delete().eq("id",a.id);if(z)throw z;typeof window<"u"&&(window.location.href="/leagues")}catch(S){typeof window<"u"&&window.alert?.(S?.message??"Failed to end league.")}finally{hr(!1),st(!1)}}},[a?.id,r?.id]),pn=S=>new Promise((z,O)=>{const q=new Image;q.addEventListener("load",()=>z(q)),q.addEventListener("error",V=>O(V)),q.src=S}),gr=async(S,z)=>{const O=await pn(S),q=document.createElement("canvas"),V=q.getContext("2d");if(!V)throw new Error("No 2d context");return q.width=z.width,q.height=z.height,V.drawImage(O,z.x,z.y,z.width,z.height,0,0,z.width,z.height),new Promise((re,ie)=>{q.toBlob(X=>{if(!X){ie(new Error("Canvas is empty"));return}re(X)},"image/jpeg",.9)})},gn=U.useCallback(S=>{if(!a?.id||!ft){he("You must be a member of the league to upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(S.type)){he("Please upload a PNG, JPG, or WebP image.");return}const O=20*1024*1024;if(S.size>O){he("Please choose an image smaller than 20MB.");return}if(he(null),Oe(!1),S.size>5*1024*1024)He(S,{maxSizeMB:2,maxWidthOrHeight:1024,useWebWorker:!0,initialQuality:.7}).then(q=>{const V=new FileReader;V.onload=()=>{Ae(V.result)},V.readAsDataURL(q)}).catch(()=>{he("Failed to process image. Please try a smaller file.")});else{const q=new FileReader;q.onload=()=>{Ae(q.result)},q.readAsDataURL(S)}},[ft,a?.id]),xn=U.useCallback(async(S,z)=>{if(Xe(z),Qe)try{const O=await gr(Qe,z),q=URL.createObjectURL(O);ct(q)}catch{}},[Qe]),wn=U.useCallback(async()=>{if(!(!Qe||!Ke||!a?.id||!ft)){he(null),Oe(!1),Re(!0);try{const S=await gr(Qe,Ke),z=new File([S],"badge.jpg",{type:"image/jpeg"}),O=await He(z,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if(O.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const q=`${a.id}-${Date.now()}.jpg`,{error:V}=await ae.storage.from("league-avatars").upload(q,O,{cacheControl:"3600",upsert:!0,contentType:O.type});if(V)throw V;const{data:re}=ae.storage.from("league-avatars").getPublicUrl(q),ie=re?.publicUrl;if(!ie)throw new Error("Unable to get public URL for badge.");const{error:X}=await ae.from("leagues").update({avatar:ie}).eq("id",a.id);if(X)throw X;c(ve=>ve&&{...ve,avatar:ie}),Oe(!0),Ue&&URL.revokeObjectURL(Ue),Ae(null),ct(null),je(!1),r?.id&&(Jt(r.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:ie}})))}catch(S){he(S?.message??"Failed to upload badge. Please try again.")}finally{Re(!1)}}},[Qe,Ke,ft,a?.id,r?.id]),bn=U.useCallback(async()=>{if(!(!a?.id||!ft)){he(null),Oe(!1),Re(!0);try{const{error:S}=await ae.from("leagues").update({avatar:null}).eq("id",a.id);if(S)throw S;c(z=>z&&{...z,avatar:null}),Oe(!0),r?.id&&(Jt(r.id),window.dispatchEvent(new CustomEvent("leagueBadgeUpdated",{detail:{leagueId:a.id,avatar:null}})))}catch(S){he(S?.message??"Failed to remove badge. Please try again.")}finally{Re(!1)}}},[ft,a?.id]),[xr,vn]=U.useState(new Map);U.useEffect(()=>{(async()=>{const S=new Map,{data:z}=await ae.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:O}=await ae.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),q=new Map;if(z&&z.forEach(V=>{(!q.has(V.gw)||V.kickoff_time&&new Date(V.kickoff_time)<new Date(q.get(V.gw)))&&V.kickoff_time&&q.set(V.gw,V.kickoff_time)}),O&&O.length>0){const V=O.find(re=>re.kickoff_time)?.kickoff_time;if(V){const re=q.get(1);(!re||new Date(V)<new Date(re))&&q.set(1,V)}}q.forEach((V,re)=>{const ie=new Date(V),X=new Date(ie.getTime()-4500*1e3);S.set(re,X)}),vn(S)})()},[]),U.useEffect(()=>{const S=z=>{const O=z.target;fe&&!O.closest(".gw-dropdown-container")&&me(!1)};return fe&&document.addEventListener("click",S),()=>document.removeEventListener("click",S)},[fe]),U.useEffect(()=>{let S=!0;return(async()=>{const{data:z}=await ae.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!S)return;g(z?.current_gw??null);const{data:O}=await ae.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!S)return;B(O&&O.length?O[0].gw:null);const{data:q}=await ae.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!S)return;const V=q?[...new Set(q.map(ie=>ie.gw))].sort((ie,X)=>X-ie):[],re=z?.current_gw;re&&!V.includes(re)&&V.unshift(re),$(V),(V.length>0&&!v||V.length>0&&v&&!V.includes(v))&&T(V[0])})(),()=>{S=!1}},[Je]);const yn=U.useMemo(()=>i.map(S=>S.id).sort().join(","),[i]),mt=U.useMemo(()=>i.map(S=>S.id),[yn]),[Me,wr]=U.useState([]),[br,qt]=U.useState([]),[vr,Vt]=U.useState([]),[yr,Yt]=U.useState([]),St=U.useRef(""),_r=U.useRef(0),jr=U.useMemo(()=>{const S=Me?.length||0;if(S===_r.current&&St.current&&(Me?.map(q=>q.api_match_id).filter(q=>q!=null).sort().join(",")||"")===St.current)return St.current;if(_r.current=S,!Me||Me.length===0)return St.current="","";const z=Me.map(O=>O.api_match_id).filter(O=>O!=null).sort().join(",");return St.current=z,z},[Me]),Mt=U.useMemo(()=>a?.name==="API Test",[a?.name]),[ot,Cr]=U.useState(null);U.useEffect(()=>{if(!Mt){Cr(null);return}let S=!0;return(async()=>{const{data:z}=await ae.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let O=z?.current_test_gw??1;if(O&&O!==1){const{data:q}=await ae.from("app_fixtures").select("gw").eq("gw",O).limit(1).maybeSingle();if(!q){const{data:V}=await ae.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();V&&(O=1)}}S&&Cr(O)})(),()=>{S=!1}},[Mt]);const _n=U.useMemo(()=>Mt&&ot!==null?ot:E||v||void 0,[Mt,ot,E,v]),Kt=U.useRef({key:"",array:void 0}),jn=U.useMemo(()=>{const S=jr||"";if(Kt.current.key===S)return Kt.current.array;const z=S?S.split(",").map(O=>parseInt(O,10)).filter(O=>!isNaN(O)):void 0;return Kt.current={key:S,array:z},z},[jr]),{liveScores:Sr}=Pn(_n,jn),Ve=U.useMemo(()=>{const S={};if(!Me||Me.length===0)return Object.keys(M.current).length===0?M.current:(M.current=S,S);Me.forEach(re=>{const ie=re.api_match_id;if(ie){const X=Sr.get(ie);X&&(S[re.fixture_index]={homeScore:X.home_score??0,awayScore:X.away_score??0,status:X.status||"SCHEDULED",minute:X.minute??null})}});const z=M.current,O=Object.keys(S).map(Number),q=Object.keys(z).map(Number);if(O.length!==q.length)return M.current=S,S;let V=!1;for(const re of O){const ie=S[re],X=z[re];if(!X||ie.homeScore!==X.homeScore||ie.awayScore!==X.awayScore||ie.status!==X.status||ie.minute!==X.minute){V=!0;break}}return V?(M.current=S,S):z},[Sr,Me]),Cn=()=>{try{if(console.log("[League] getInitialMltRows called",{code:d,userId:r?.id}),d&&r?.id){const z=Fe(`leagues:${r.id}`);if(console.log("[League] getInitialMltRows - cachedLeagues",{hasCached:!!z,length:z?.length}),z&&Array.isArray(z)){const O=z.find(q=>q.code.toUpperCase()===d.toUpperCase());if(console.log("[League] getInitialMltRows - found league",{found:!!O,leagueId:O?.id}),O?.id){const q=`league:mltRows:${O.id}`,V=Fe(q);if(console.log("[League] getInitialMltRows - cached mltRows",{hasCached:!!V,length:V?.length,cacheKey:q,cachedType:typeof V,isArray:Array.isArray(V),rawCache:V}),V&&Array.isArray(V)&&V.length>0)return console.log("[League]  getInitialMltRows returning cached rows",V.length),V;console.log("[League]  Cache check failed",{cached:!!V,isArray:Array.isArray(V),length:V?.length,cacheKey:q})}}}const S=n();if(console.log("[League] getInitialMltRows - initialLeague",{hasLeague:!!S,leagueId:S?.id}),S?.id){const z=Fe(`league:mltRows:${S.id}`);if(console.log("[League] getInitialMltRows - cached from initialLeague",{hasCached:!!z,length:z?.length}),z&&Array.isArray(z)&&z.length>0)return console.log("[League]  getInitialMltRows returning cached rows from initialLeague",z.length),z}if(d&&r?.id){const z=Fe(`leagues:${r.id}`);if(z&&Array.isArray(z)){for(const O of z)if(O.code?.toUpperCase()===d.toUpperCase()&&O.id){const q=Fe(`league:mltRows:${O.id}`);if(q&&Array.isArray(q)&&q.length>0)return console.log("[League]  getInitialMltRows returning cached rows from strategy 3",q.length),q}}}console.log("[League]  getInitialMltRows returning empty array - cache miss")}catch(S){console.error("[League]  getInitialMltRows error",S)}return[]},[rt,ht]=U.useState(Cn);U.useEffect(()=>{console.log("[League] Tab changed to:",_,"mltRows.length:",rt.length)},[_,rt.length]),U.useEffect(()=>{if(a?.id){const S=`league:mltRows:${a.id}`,z=Fe(S);if(console.log("[League] useEffect loading mltRows from cache",{leagueId:a.id,cacheKey:S,hasCached:!!z,cachedLength:z?.length,currentMltRowsLength:rt.length}),z&&z.length>0)rt.length===0?(console.log("[League]  Setting mltRows from cache",z.length),ht(z)):console.log("[League] mltRows already populated, skipping");else{console.log("[League]  No cached mltRows found - will retry multiple times");let O=0;const q=10,V=[50,100,150,200,250,300,400,500,600,800],re=()=>{if(O>=q){console.log("[League]  Max retries reached, giving up on cache");return}const X=setTimeout(()=>{O++;const ve=Fe(S);ve&&ve.length>0&&rt.length===0?(console.log(`[League]  Retry ${O} successful - Setting mltRows from cache`,ve.length),ht(ve)):O<q&&re()},V[O]||800);return()=>clearTimeout(X)};return re()}}else console.log("[League]  No league.id available yet")},[a?.id,rt.length]),U.useEffect(()=>{let S=!0;return(async()=>{let O=a;if(!O){const{data:X}=await ae.from("leagues").select("id,name,code,created_at,avatar").eq("code",d).maybeSingle();if(!S)return;if(!X){c(null),l([]),p(!1);return}O=X,c(O)}const q=Fe(`league:members:${O.id}`);let V=[];if(q&&q.length>0)V=q.map(([X,ve])=>({id:X,name:ve||"(no name)"})),p(!1);else{const{data:X}=await ae.from("league_members").select("users(id,name),created_at").eq("league_id",O.id).order("created_at",{ascending:!0});V=X?.map(ve=>({id:ve.users.id,name:ve.users.name??"(no name)"}))??[],p(!1)}const re=[...V].sort((X,ve)=>X.name.localeCompare(ve.name));l(re);const ie=V[0];ln(ie),r?.id&&!V.some(X=>X.id===r.id)&&dt(!0),p(!1)})(),()=>{S=!1}},[d]),U.useEffect(()=>{},[a,_]),U.useEffect(()=>{if(_!=="chat"||!a?.id||!r?.id)return;(async()=>{await ae.from("league_message_reads").upsert({league_id:a.id,user_id:r.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"}),Jt(r.id),window.dispatchEvent(new CustomEvent("leagueMessagesRead",{detail:{leagueId:a.id,userId:r.id}}))})()},[_,a?.id,r?.id]),U.useEffect(()=>{let S=!0;return(async()=>{const z=a?.name==="API Test";let O=ot??1;if(z){const{data:ee}=await ae.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if(O=ee?.current_test_gw??1,O&&O!==1){const{data:le}=await ae.from("app_fixtures").select("gw").eq("gw",O).limit(1).maybeSingle();if(!le){const{data:ye}=await ae.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();ye&&(O=1)}}}const q=z&&(_==="gw"||_==="gwr");let V=null;if(_==="gwr"?j.current&&v?V=v:E?f&&f<E?V=f:V=E>1?E-1:E:V=v:V=E,z&&(_==="gw"||_==="gwr")&&(V=O),_==="gw"&&!z&&mt.length>0){const{data:ee}=await ae.from("app_gw_submissions").select("gw").in("user_id",mt).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(ee&&ee.length>0){const le=[...new Set(ee.map(ye=>ye.gw))].sort((ye,be)=>(be||0)-(ye||0));for(const ye of le)if(ye){const{data:be}=await ae.from("app_fixtures").select("gw").eq("gw",ye).limit(1);if(be&&be.length>0){V=ye;break}}}!V&&E&&(V=E)}if(!V&&!q){wr([]),qt([]),Vt([]),Yt([]);return}let re;if(q){const{data:ee}=await ae.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",O).order("fixture_index",{ascending:!0});re=ee?.map(le=>({...le,gw:le.test_gw}))||null}else{const{data:ee}=await ae.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",V).order("fixture_index",{ascending:!0});re=ee||null}if(!S)return;if(wr(ee=>{const le=re??[];return ee.length!==le.length?le:ee.length===0&&le.length===0?ee:ee.some((be,Z)=>!le[Z]||be.id!==le[Z].id||be.fixture_index!==le[Z].fixture_index)||le.some((be,Z)=>!ee[Z]||be.id!==ee[Z].id||be.fixture_index!==ee[Z].fixture_index)?le:ee}),!mt.length){qt([]),Vt([]),Yt([]);return}let ie=null,X;if(q){const{data:ee}=await ae.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",O).in("user_id",mt);ie=ee?.map(te=>({...te,gw:te.matchday}))||null;const{data:le,error:ye}=await ae.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",O).not("submitted_at","is",null).in("user_id",mt),{data:be}=await ae.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",O).order("fixture_index",{ascending:!0}),Z=new Set((be||[]).map(te=>te.fixture_index)),K=[];if(le&&ie&&be){const te=Z.size,oe=new Date("2025-11-18T00:00:00Z");le.forEach(ue=>{const De=(ie||[]).filter(Ye=>Ye.user_id===ue.user_id&&Ye.matchday===O).filter(Ye=>Z.has(Ye.fixture_index)),se=De.length===te&&te>0,ce=new Set(De.map(Ye=>Ye.fixture_index)).size===te,We=ue.submitted_at?new Date(ue.submitted_at):null,pe=We&&We>=oe;se&&ce&&pe&&K.push(ue)})}X=K.map(te=>({...te,gw:te.matchday}))||null}else{const{data:ee}=await ae.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",V).in("user_id",mt);ie=ee;const{data:le}=await ae.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",V).in("user_id",mt);X=le}if(!S)return;qt(ee=>{const le=ie??[];if(ee.length!==le.length)return le;if(ee.length===0&&le.length===0)return ee;const ye=JSON.stringify(ee.sort((Z,K)=>Z.fixture_index-K.fixture_index)),be=JSON.stringify(le.sort((Z,K)=>Z.fixture_index-K.fixture_index));return ye===be?ee:le}),Vt(ee=>{const le=X??[];if(ee.length!==le.length)return le;if(ee.length===0&&le.length===0)return ee;const ye=JSON.stringify(ee),be=JSON.stringify(le);return ye===be?ee:le});const{data:ve}=await ae.from("app_gw_results").select("gw,fixture_index,result").eq("gw",q?1:V||0);S&&Yt(ee=>{const le=ve??[];if(ee.length!==le.length)return le;if(ee.length===0&&le.length===0)return ee;const ye=JSON.stringify(ee.sort((Z,K)=>Z.fixture_index-K.fixture_index)),be=JSON.stringify(le.sort((Z,K)=>Z.fixture_index-K.fixture_index));return ye===be?ee:le})})(),()=>{S=!1}},[_,E,f,v,mt]),U.useEffect(()=>{H.current=Ve},[Ve]);const pt=U.useMemo(()=>{const S=new Map;return vr.forEach(z=>{if(z.submitted_at){const O=`${z.user_id}:${z.gw}`;S.set(O,!0)}}),S},[vr]),Lt=U.useCallback(S=>S.map(z=>({user_id:z.id,name:z.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);U.useEffect(()=>{const S=ae.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{Ee(z=>z+1)}).subscribe();return()=>{ae.removeChannel(S)}},[]),U.useEffect(()=>{let S=!0;return(async()=>{if(rt.length>0)return;if(a?.id){const se=Fe(`league:mltRows:${a.id}`);if(se&&se.length>0){ht(se);return}}if(!i.length){Fe(`league:mltRows:${a?.id||""}`)||ht([]);return}if(a?.name==="API Test"){ht(Lt(i));return}const z=a?.id&&Fe(`league:mltRows:${a.id}`);if(z&&z.length>0){ht(z);return}if(E===null)return;const{data:O}=await ae.from("app_gw_results").select("gw,fixture_index,result"),q=O??[],V=new Map;if(q.forEach(se=>{const de=ir(se);de&&V.set(`${se.gw}:${se.fixture_index}`,de)}),V.size===0){ht(Lt(i));return}const re=[...new Set(Array.from(V.keys()).map(se=>parseInt(se.split(":")[0],10)))].sort((se,de)=>se-de),ie=["Prem Predictions","FC Football","Easy League"],X=["The Bird league"],ve=await Un(a,E);let ee=re.filter(se=>se>=ve);if(E!==null&&ee.includes(E)){const{data:se}=await ae.from("app_fixtures").select("fixture_index").eq("gw",E),de=se?.length??0,ce=Array.from(V.keys()).filter(We=>parseInt(We.split(":")[0],10)===E).length;de>0&&ce<de&&(ee=ee.filter(We=>We<E))}else E!==null&&(ee=ee.filter(se=>se<E));if(!ie.includes(a?.name||"")&&!X.includes(a?.name||"")&&ee.length===0){ht(Lt(i));return}const{data:le}=await ae.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",i.map(se=>se.id)).in("gw",ee),ye=le??[],be=new Map;ee.forEach(se=>{const de=new Map;i.forEach(ce=>de.set(ce.id,{user_id:ce.id,score:0,unicorns:0})),be.set(se,de)}),ee.forEach(se=>{Array.from(V.entries()).filter(([ce])=>parseInt(ce.split(":")[0],10)===se).map(([ce,We])=>({idx:parseInt(ce.split(":")[1],10),out:We})).forEach(({idx:ce,out:We})=>{const pe=ye.filter(Ie=>Ie.gw===se&&Ie.fixture_index===ce),Ye=pe.filter(Ie=>Ie.pick===We).map(Ie=>Ie.user_id),wt=be.get(se);if(pe.forEach(Ie=>{if(Ie.pick===We){const Zt=wt.get(Ie.user_id);Zt.score+=1}}),Ye.length===1&&i.length>=3){const Ie=Ye[0],Zt=wt.get(Ie);Zt.unicorns+=1}})});const Z=new Map,K=new Map,te=new Map,oe=new Map,ue=new Map,_e=new Map;i.forEach(se=>{Z.set(se.id,0),K.set(se.id,0),te.set(se.id,0),oe.set(se.id,0),ue.set(se.id,0),_e.set(se.id,[])}),ee.forEach(se=>{const de=Array.from(be.get(se).values());if(de.forEach(pe=>{K.set(pe.user_id,(K.get(pe.user_id)??0)+pe.score),te.set(pe.user_id,(te.get(pe.user_id)??0)+pe.unicorns)}),de.sort((pe,Ye)=>Ye.score-pe.score||Ye.unicorns-pe.unicorns),!de.length)return;const ce=de[0],We=de.filter(pe=>pe.score===ce.score&&pe.unicorns===ce.unicorns);We.length===1?(Z.set(ce.user_id,(Z.get(ce.user_id)??0)+3),oe.set(ce.user_id,(oe.get(ce.user_id)??0)+1),_e.get(ce.user_id).push("W"),de.slice(1).forEach(pe=>_e.get(pe.user_id).push("L"))):(We.forEach(pe=>{Z.set(pe.user_id,(Z.get(pe.user_id)??0)+1),ue.set(pe.user_id,(ue.get(pe.user_id)??0)+1),_e.get(pe.user_id).push("D")}),de.filter(pe=>!We.find(Ye=>Ye.user_id===pe.user_id)).forEach(pe=>_e.get(pe.user_id).push("L")))});const De=i.map(se=>({user_id:se.id,name:se.name,mltPts:Z.get(se.id)??0,ocp:K.get(se.id)??0,unicorns:te.get(se.id)??0,wins:oe.get(se.id)??0,draws:ue.get(se.id)??0,form:_e.get(se.id)??[]}));De.sort((se,de)=>de.mltPts-se.mltPts||de.unicorns-se.unicorns||de.ocp-se.ocp||se.name.localeCompare(de.name)),S&&(ht(De),a?.id&&In(`league:mltRows:${a.id}`,De,Fn.LEAGUES))})(),()=>{S=!1}},[i,a,E,Lt,Je]);function Sn(){const S=performance.now();console.log("[MltTab]  RENDERING START",{mltRowsLength:rt.length,membersLength:i.length,leagueId:a?.id,timestamp:S});const z=performance.now(),O=U.useMemo(()=>E??null,[E]);Tt(O);const q=performance.now();console.log("[MltTab]  Hooks complete",{duration:q-z});const V=performance.now(),re=rt.length>0?rt:i.length>0?i.map(ye=>({user_id:ye.id,name:ye.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})):[],ie=performance.now();console.log("[MltTab]  Rows calculated",{rowsLength:re.length,mltRowsLength:rt.length,duration:ie-V});const X=["Prem Predictions","FC Football","Easy League"],ve=["The Bird league"],ee=["gregVjofVcarl","Let Down"],le=!!(a&&!X.includes(a.name)&&!ve.includes(a.name)&&!ee.includes(a.name));return i.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>gt(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(Us,{rows:re,members:i,showForm:x,currentUserId:r?.id,loading:!1,isLateStartingLeague:le}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(Ds,{showForm:x,onToggle:m}),s.jsxs("button",{onClick:()=>Te(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function Nn(){const S=U.useMemo(()=>a?.name==="API Test"?ot??1:E??null,[a?.name,ot,E]),{state:z}=Tt(S);if(!S)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!Mr(a,S,xr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",S," predictions are not included in this league."]})]})});const O=new Map;yr.forEach(K=>{if(K.gw!==S)return;const te=ir(K);te&&O.set(K.fixture_index,te)}),Me.forEach(K=>{if(K.gw!==S)return;const te=Ve[K.fixture_index];te&&(te.status==="IN_PLAY"||te.status==="PAUSED"||te.status==="FINISHED")&&(te.homeScore>te.awayScore?O.set(K.fixture_index,"H"):te.awayScore>te.homeScore?O.set(K.fixture_index,"A"):O.set(K.fixture_index,"D"))});const q=U.useMemo(()=>{const K=ue=>{if(!ue)return"Fixtures";const _e=new Date(ue);return isNaN(_e.getTime())?"Fixtures":_e.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},te=new Map;Me.filter(ue=>ue.gw===S).forEach(ue=>{const _e=K(ue.kickoff_time),De=ue.kickoff_time?new Date(ue.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;te.has(_e)||te.set(_e,{label:_e,key:De,items:[]}),te.get(_e).items.push(ue)});const oe=Array.from(te.values());return oe.forEach(ue=>ue.items.sort((_e,De)=>_e.fixture_index-De.fixture_index)),oe.sort((ue,_e)=>ue.key-_e.key),oe},[Me,S]),V=new Set(Me.filter(K=>K.gw===S).map(K=>K.fixture_index)),re=a?.name==="API Test",ie=i.length>0&&i.every(K=>pt.get(`${K.id}:${S}`)),X=new Map;(!re||ie)&&br.forEach(K=>{if(K.gw!==S||!pt.get(`${K.user_id}:${S}`)||!V.has(K.fixture_index))return;const oe=X.get(K.fixture_index)??[];oe.push(K),X.set(K.fixture_index,oe)});const ve=f!==null&&f>=S,ee=i.filter(K=>!pt.get(`${K.id}:${S}`)).length,le=i.filter(K=>!pt.get(`${K.id}:${S}`)).map(K=>K.name),ye=z!==null&&(z==="DEADLINE_PASSED"||z==="LIVE"||z==="RESULTS_PRE_GW"),be=re?!ie:!ie&&!ye;return(re?!ie:!ie&&!ye)?s.jsx(Gr,{members:i,submittedMap:pt,picksGw:S,allSubmitted:ie,remaining:ee,fixtures:Me.filter(K=>K.gw===S),variant:"compact"}):s.jsxs("div",{className:"mt-2 pt-2",children:[be?s.jsx(Gr,{members:i,submittedMap:pt,picksGw:S,allSubmitted:ie,remaining:ee,fixtures:Me.filter(K=>K.gw===S),variant:"full"}):null,a?.name==="API Test"&&ie&&q.length>0&&!be&&(()=>{const K=q.flatMap(de=>de.items),te=new Set(K.map(de=>de.fixture_index)),oe={};Object.keys(Ve).forEach(de=>{const ce=parseInt(de,10);te.has(ce)&&(oe[ce]=Ve[ce])});const ue=K.some(de=>{const ce=oe[de.fixture_index];return ce&&(ce.status==="IN_PLAY"||ce.status==="PAUSED")}),_e=K.length>0&&K.every(de=>{const ce=oe[de.fixture_index];return ce&&ce.status==="FINISHED"}),De=ue||_e||K.some(de=>oe[de.fixture_index]);let se=0;return r?.id&&K.forEach(de=>{const ce=oe[de.fixture_index],We=ce&&(ce.status==="IN_PLAY"||ce.status==="PAUSED"),pe=ce&&ce.status==="FINISHED";if(ce&&(We||pe)){const wt=(X.get(de.fixture_index)??[]).find(Ie=>Ie.user_id===r.id);if(wt){let Ie=!1;(wt.pick==="H"&&ce.homeScore>ce.awayScore||wt.pick==="A"&&ce.awayScore>ce.homeScore||wt.pick==="D"&&ce.homeScore===ce.awayScore)&&(Ie=!0),Ie&&se++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:q.map((de,ce)=>s.jsx(Vr,{label:de.label,fixtures:de.items,picksByFixture:X,members:i,outcomes:O,liveScores:oe,submittedMap:pt,picksGw:S,isApiTestLeague:!0,isFirstSection:ce===0,hasLiveGames:ue,allGamesFinished:_e,hasStarted:De,liveFixturesCount:se},ce))})})(),q.length>0&&a?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:q.map((K,te)=>s.jsx(Vr,{label:K.label,fixtures:K.items,picksByFixture:X,members:i,outcomes:O,liveScores:Ve,submittedMap:pt,picksGw:S,isApiTestLeague:!1,isFirstSection:te===0,allSubmitted:ie,resultsPublished:ve,deadlinePassed:ye,whoDidntSubmit:le},te))}),!q.length&&!be&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",S,"."]})]})}function kn(){const{state:S}=Tt(E),z=U.useMemo(()=>a?.name==="API Test"?ot??1:_==="gwr"?j.current&&v||!E?v:S==="LIVE"||S==="RESULTS_PRE_GW"?E:f&&f<E?f:E>1?E-1:E:v,[a?.name,ot,_,v,E,S,f]);Tt(z);const O=z;if(!O||G.length===0&&a?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!Mr(a,O,xr))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",O," results are not included in this league."]})]})});const q=new Map,V=a?.name==="API Test",re=Me.filter(Z=>Z.gw===O),ie=re.some(Z=>{const K=Ve[Z.fixture_index];return K&&(K.status==="IN_PLAY"||K.status==="PAUSED"||K.status==="FINISHED")});V&&O===(ot??1)?re.forEach(Z=>{const K=Ve[Z.fixture_index];K&&(K.status==="IN_PLAY"||K.status==="PAUSED"||K.status==="FINISHED")&&(K.homeScore>K.awayScore?q.set(Z.fixture_index,"H"):K.awayScore>K.homeScore?q.set(Z.fixture_index,"A"):q.set(Z.fixture_index,"D"))}):ie&&O===E?re.forEach(Z=>{const K=Ve[Z.fixture_index];K&&(K.status==="IN_PLAY"||K.status==="PAUSED"||K.status==="FINISHED")&&(K.homeScore>K.awayScore?q.set(Z.fixture_index,"H"):K.awayScore>K.homeScore?q.set(Z.fixture_index,"A"):q.set(Z.fixture_index,"D"))}):yr.forEach(Z=>{if(Z.gw!==O)return;const K=ir(Z);K&&q.set(Z.fixture_index,K)});const X=i.map(Z=>({user_id:Z.id,name:Z.name,score:0,unicorns:0})),ve=new Map;br.forEach(Z=>{if(Z.gw!==O)return;const K=ve.get(Z.fixture_index)??[];K.push(Z),ve.set(Z.fixture_index,K)}),Array.from(q.entries()).forEach(([Z,K])=>{const oe=(ve.get(Z)??[]).filter(ue=>ue.pick===K).map(ue=>ue.user_id);if(oe.forEach(ue=>{const _e=X.find(De=>De.user_id===ue);_e.score+=1}),oe.length===1&&i.length>=3){const ue=X.find(_e=>_e.user_id===oe[0]);ue.unicorns+=1}}),X.sort((Z,K)=>K.score-Z.score||K.unicorns-Z.unicorns||Z.name.localeCompare(K.name)),U.useEffect(()=>{if(X.length===0)return;const Z=new Map;X.forEach((te,oe)=>{Z.set(te.user_id,oe)});const K=new Set;if(Z.forEach((te,oe)=>{const ue=J.current.get(oe);ue!==void 0&&ue!==te&&K.add(oe)}),J.current=Z,K.size>0){ne(K);const te=setTimeout(()=>{ne(new Set)},2e3);return()=>clearTimeout(te)}},[X.map(Z=>`${Z.user_id}-${Z.score}-${Z.unicorns}`).join(",")]);let ee=!1,le=!1,ye=!1,be=!1;if(V&&O===(ot??1)){const Z=Me;if(Z.length>0&&(ee=Z.every(te=>{const oe=Ve[te.fixture_index];return oe&&oe.status==="FINISHED"}),le=!!Z.find(te=>{const oe=Ve[te.fixture_index];return oe&&(oe.status==="IN_PLAY"||oe.status==="PAUSED")}),be=Z.some(te=>{const oe=Ve[te.fixture_index];return oe&&(oe.status==="IN_PLAY"||oe.status==="PAUSED"||oe.status==="FINISHED")}),!ee)){const te=new Date;ye=Z.some(oe=>{if(!oe.kickoff_time)return!1;const _e=new Date(oe.kickoff_time).getTime()-te.getTime(),De=Ve[oe.fixture_index];return(!De||De.status!=="IN_PLAY"&&De.status!=="PAUSED"&&De.status!=="FINISHED")&&_e>0&&_e<=1440*60*1e3})}}else{const Z=Me.filter(K=>K.gw===O);if(Z.length>0){const K=Z.every(oe=>q.has(oe.fixture_index)),te=Z.some(oe=>{const ue=Ve[oe.fixture_index];return ue&&(ue.status==="IN_PLAY"||ue.status==="PAUSED")});ee=K&&!te}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),X.length>0&&ee&&s.jsx(Ls,{winnerName:X[0].name,isDraw:X[0].score===X[1]?.score&&X[0].unicorns===X[1]?.unicorns}),s.jsx(Is,{rows:X,members:i,currentUserId:r?.id,positionChangeKeys:Q,isApiTestLeague:V,hasLiveFixtures:le,hasStartingSoonFixtures:ye,hasStartedFixtures:be,allFixturesFinished:ee,resGw:O}),G.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(Ts,{availableGws:G,selectedGw:O,onChange:Z=>{j.current=!0,T(Z)}}),s.jsxs("button",{onClick:()=>xe(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 rounded-full text-slate-600 cursor-help flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(Rr,{isOpen:ge,onClose:()=>xe(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return U.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[_]),u?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!a&&!u?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(Er,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):a?s.jsxs("div",{className:`${e?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
          transition: top 0.3s ease-in-out;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open {
          top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        .league-content-wrapper.menu-open.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open {
            top: calc(3.5rem + 3rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
          .league-content-wrapper.menu-open.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + 12rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          overflow-x: hidden;
          pointer-events: none;
          width: 100%;
          max-width: 100%;
        }
        .chat-tab-wrapper::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-image: url(/assets/Volley/volley-chat-backgroud.png);
          background-repeat: repeat;
          background-size: 110%;
          background-position: top left;
          background-attachment: local;
          opacity: 0.1;
          pointer-events: none;
          z-index: 0;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:W,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsx(Er,{to:"/leagues",className:"flex items-center text-slate-600 -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 px-2",children:[s.jsx("button",{type:"button",onClick:()=>{b(!0)},className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border border-slate-200 flex-shrink-0 relative cursor-pointer",children:a?s.jsx("img",{src:Qt(a),alt:"League badge",className:"absolute inset-0 w-full h-full object-cover",loading:"eager",decoding:"async",onError:S=>{const z=S.target,q=`/assets/league-avatars/${Ar(a.id)}`;z.src!==q&&(z.src=q)}}):s.jsx("div",{className:"w-full h-full bg-slate-200"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate",children:a.name}),v&&s.jsxs("p",{className:"text-sm text-slate-500 truncate",children:["Gameweek ",v]})]})]}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>tt(!et),className:"flex items-center justify-center w-8 h-8 rounded-full -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsx("div",{className:`bg-white border-b border-slate-200 transition-all duration-300 ease-in-out overflow-hidden ${et?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"px-4 py-3",children:[mr&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 pb-3 border-b border-slate-200 px-0",children:[s.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Admin"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:cn})]}),s.jsx("div",{className:"space-y-1",children:s.jsxs("button",{onClick:()=>{Se(!0),tt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsxs("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Manage"})]})}),s.jsx("div",{className:"my-3 border-b border-slate-200"})]}),s.jsxs("div",{className:"space-y-1",children:[ft&&s.jsxs("button",{onClick:()=>{je(!0),tt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("span",{children:"Edit League Badge"})]}),s.jsxs("button",{onClick:()=>{gt(!0),tt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:"Invite players"})]}),s.jsxs("button",{onClick:()=>{pr(),tt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-slate-700 active:bg-slate-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("span",{children:"Share league code"})]}),s.jsxs("button",{onClick:()=>{A(!0),tt(!1)},className:"w-full text-left px-0 py-2.5 text-base font-bold text-red-600 active:bg-red-100 rounded-lg flex items-center gap-2 touch-manipulation",children:[s.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),s.jsx("span",{children:"Leave"})]})]})]})}),s.jsxs("div",{className:`flex border-b border-slate-200 bg-white gap-2 transition-all duration-300 ease-in-out ${et?"max-h-0 opacity-0 overflow-hidden":"max-h-20 opacity-100"}`,children:[s.jsxs("button",{onClick:()=>{F.current=!0,y("chat")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="chat"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:"Chat"}),_==="chat"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(G.length>0||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{F.current=!0,y("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight flex items-center justify-center gap-1.5 "+(_==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const S=new Date,z=Me[0],O=z?.kickoff_time?new Date(z.kickoff_time):null,q=O&&O<=S,re=Me[Me.length-1]?.fixture_index,X=(re!==void 0?Ve[re]:null)?.status==="FINISHED",ve=q&&!X;return s.jsxs(s.Fragment,{children:[ve&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"GW Table"})]})})(),_==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(E||a?.name==="API Test")&&s.jsxs("button",{onClick:()=>{F.current=!0,y("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:"Predictions"}),_==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{console.log("[League] GW Table tab clicked, setting tab to mlt"),F.current=!0,y("mlt"),console.log("[League] Tab set to mlt, mltRows.length:",rt.length)},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold relative leading-tight "+(_==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Season",_==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),_==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(Ms,{miniLeagueId:a?.id??null,memberNames:dn,deepLinkError:D})}):s.jsx("div",{className:`league-content-wrapper ${et?"menu-open":""}`,children:s.jsxs("div",{className:"px-1 sm:px-2",children:[_==="mlt"&&(()=>{const S=performance.now();console.log("[League] Rendering MltTab, tab is mlt",{tab:_,mltRowsLength:rt.length,leagueId:a?.id,timestamp:S});const z=s.jsx(Sn,{}),O=performance.now();return console.log("[League] MltTab JSX created",{duration:O-S}),z})(),_==="gw"&&s.jsx(Nn,{}),_==="gwr"&&s.jsx(kn,{})]})}),mr&&Ce&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>Se(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:S=>S.stopPropagation(),children:[s.jsx("button",{onClick:()=>Se(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[i.filter(S=>S.id!==r?.id).map(S=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:S.name}),s.jsx("button",{onClick:()=>{ur(S),vt(!0),Se(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md font-medium",children:"Remove"})]},S.id)),i.filter(S=>S.id!==r?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{st(!0),Se(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white rounded-lg font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),ft&&Le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{je(!1),Ue&&URL.revokeObjectURL(Ue),Ae(null),he(null),Oe(!1),ct(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 relative",onClick:S=>S.stopPropagation(),children:[s.jsx("button",{onClick:()=>{je(!1),Ue&&URL.revokeObjectURL(Ue),Ae(null),he(null),Oe(!1),ct(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-4 pt-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"League Badge"}),s.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Upload and customize your mini-league badge"}),Qe?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs text-slate-600",children:[s.jsx("p",{className:"font-medium",children:"Position your image"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Drag to position, use slider to zoom"})]}),s.jsx("div",{className:"relative w-full",style:{height:"280px"},children:s.jsx(ms,{image:Qe,crop:lt,zoom:qe,aspect:1,cropShape:"round",showGrid:!1,onCropChange:Pe,onZoomChange:Be,onCropComplete:xn,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(qe*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:qe,onChange:S=>Be(Number(S.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376] touch-manipulation",style:{WebkitTapHighlightColor:"transparent"}})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center flex-shrink-0",children:Ue?s.jsx("img",{src:Ue,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]})]}),ke&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ke}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx("button",{onClick:()=>{Ue&&URL.revokeObjectURL(Ue),Ae(null),Pe({x:0,y:0}),Be(1),Xe(null),ct(null)},disabled:we,className:"flex-1 px-4 py-3 bg-slate-100 text-slate-700 rounded-lg active:bg-slate-200 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:"Cancel"}),s.jsx("button",{onClick:wn,disabled:we||!Ke,className:"flex-1 px-4 py-3 bg-[#1C8376] text-white rounded-lg active:bg-emerald-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[44px]",children:we?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-2 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:a?Qt(a):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:S=>{const z=S.target;z.src="/assets/league-avatars/ML-avatar-1.png"}})}),a?.avatar&&s.jsx("button",{onClick:bn,disabled:we,className:"px-4 py-2 text-xs bg-red-100 text-red-700 active:bg-red-200 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[36px]",children:"Remove"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:S=>{const z=S.target.files?.[0];z&&gn(z)},disabled:we,className:"hidden",id:"badge-upload-input"}),s.jsx("label",{htmlFor:"badge-upload-input",className:"block w-full border-2 border-dashed border-slate-300 rounded-lg p-6 text-center active:bg-slate-50 active:border-[#1C8376] touch-manipulation",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("div",{className:"text-sm",children:s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Tap to choose image"})}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (up to 20MB - will be optimized automatically)"})]})})]}),we&&s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),Ge&&s.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg text-xs text-green-800",children:" Badge uploaded successfully!"}),ke&&s.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800",children:ke})]})]})]})]})}),s.jsx(Rr,{isOpen:Ne,onClose:()=>Te(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${a&&(["The Bird league"].includes(a.name)||["gregVjofVcarl","Let Down"].includes(a.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),Ot&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",or," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:a.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a.code)},className:"px-3 py-1.5 border rounded-md text-sm",children:"Copy"}),s.jsx("button",{onClick:pr,className:"px-3 py-1.5 border rounded-md text-sm",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[i.length,"/",or," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>gt(!1),className:"px-4 py-2 border border-slate-300 rounded-md",children:"Close"})})]})}),C&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',a?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>A(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:R,children:"Cancel"}),s.jsx("button",{onClick:un,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:R,children:R?"Leaving...":"Leave League"})]})]})}),At&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',a?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>dt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:jt,children:"Cancel"}),s.jsx("button",{onClick:fn,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md disabled:opacity-50",disabled:jt,children:jt?"Joining...":"Join League"})]})]})}),xt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',Rt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>vt(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Bt,children:"Cancel"}),s.jsx("button",{onClick:hn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Bt,children:Bt?"Removing...":"Remove Member"})]})]})}),ut&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',a?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>st(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md",disabled:Gt,children:"Cancel"}),s.jsx("button",{onClick:mn,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md disabled:opacity-50",disabled:Gt,children:Gt?"Ending...":"Yes, End League"})]})]})}),a?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})}),w&&a&&s.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center",onClick:()=>b(!1),children:s.jsxs("div",{className:"flex flex-col items-center gap-4 relative",onClick:S=>S.stopPropagation(),children:[s.jsx("div",{className:"w-80 h-80 rounded-full overflow-hidden bg-white shadow-2xl relative",children:s.jsx("img",{src:Qt(a),alt:"League badge",className:"w-full h-full object-cover",onError:S=>{const z=S.target,q=`/assets/league-avatars/${Ar(a.id)}`;z.src!==q&&(z.src=q)}})}),ft&&s.jsx("button",{type:"button",onClick:S=>{S.stopPropagation(),b(!1),je(!0)},className:"absolute bottom-[272px] right-1/2 translate-x-[144px] w-16 h-16 rounded-full bg-white shadow-2xl flex items-center justify-center z-20 border-4 border-slate-400",title:"Edit League Badge",children:s.jsx("svg",{className:"w-8 h-8 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"text-white text-xl font-medium",children:a.name})]})})]}):null}export{Gs as default};
