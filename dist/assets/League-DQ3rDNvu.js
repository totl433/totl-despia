import{g as un,r as I,s as se,j as s,u as Tr,i as fn,a as fr,T as hr,D as hn,b as mn,c as pn,d as gn,L as mr,e as xn,f as bn,I as pr,h as gr}from"./index-BFKTwyTq.js";function wn(d,u){return u.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(t){if(t!=="default"&&!(t in d)){var e=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(d,t,e.get?e:{enumerable:!0,get:function(){return r[t]}})}}))})),Object.freeze(d)}function Mr(d,u){return new Promise((function(r,t){let e;return vn(d).then((function(n){try{return e=n,r(new Blob([u.slice(0,2),e,u.slice(2)],{type:"image/jpeg"}))}catch(a){return t(a)}}),t)}))}const vn=d=>new Promise(((u,r)=>{const t=new FileReader;t.addEventListener("load",(({target:{result:e}})=>{const n=new DataView(e);let a=0;if(n.getUint16(a)!==65496)return r("not a valid JPEG");for(a+=2;;){const c=n.getUint16(a);if(c===65498)break;const b=n.getUint16(a+2);if(c===65505&&n.getUint32(a+4)===1165519206){const x=a+10;let o;switch(n.getUint16(x)){case 18761:o=!0;break;case 19789:o=!1;break;default:return r("TIFF header contains invalid endian")}if(n.getUint16(x+2,o)!==42)return r("TIFF header contains invalid version");const l=n.getUint32(x+4,o),i=x+l+2+12*n.getUint16(x+l,o);for(let f=x+l+2;f<i;f+=12)if(n.getUint16(f,o)==274){if(n.getUint16(f+2,o)!==3)return r("Orientation data type is invalid");if(n.getUint32(f+4,o)!==1)return r("Orientation data count is invalid");n.setUint16(f+8,1,o);break}return u(e.slice(a,a+2+b))}a+=2+b}return u(new Blob)})),t.readAsArrayBuffer(d)}));var Pt={},yn={get exports(){return Pt},set exports(d){Pt=d}};(function(d){var u,r,t={};yn.exports=t,t.parse=function(e,n){for(var a=t.bin.readUshort,c=t.bin.readUint,b=0,x={},o=new Uint8Array(e),l=o.length-4;c(o,l)!=101010256;)l--;b=l,b+=4;var i=a(o,b+=4);a(o,b+=2);var f=c(o,b+=2),g=c(o,b+=4);b+=4,b=g;for(var j=0;j<i;j++){c(o,b),b+=4,b+=4,b+=4,c(o,b+=4),f=c(o,b+=4);var E=c(o,b+=4),C=a(o,b+=4),P=a(o,b+2),D=a(o,b+4);b+=6;var L=c(o,b+=8);b+=4,b+=C+P+D,t._readLocal(o,L,x,f,E,n)}return x},t._readLocal=function(e,n,a,c,b,x){var o=t.bin.readUshort,l=t.bin.readUint;l(e,n),o(e,n+=4),o(e,n+=2);var i=o(e,n+=2);l(e,n+=2),l(e,n+=4),n+=4;var f=o(e,n+=8),g=o(e,n+=2);n+=2;var j=t.bin.readUTF8(e,n,f);if(n+=f,n+=g,x)a[j]={size:b,csize:c};else{var E=new Uint8Array(e.buffer,n);if(i==0)a[j]=new Uint8Array(E.buffer.slice(n,n+c));else{if(i!=8)throw"unknown compression method: "+i;var C=new Uint8Array(b);t.inflateRaw(E,C),a[j]=C}}},t.inflateRaw=function(e,n){return t.F.inflate(e,n)},t.inflate=function(e,n){return e[0],e[1],t.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),n)},t.deflate=function(e,n){n==null&&(n={level:6});var a=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[a]=120,c[a+1]=156,a+=2,a=t.F.deflateRaw(e,c,a,n.level);var b=t.adler(e,0,e.length);return c[a+0]=b>>>24&255,c[a+1]=b>>>16&255,c[a+2]=b>>>8&255,c[a+3]=b>>>0&255,new Uint8Array(c.buffer,0,a+4)},t.deflateRaw=function(e,n){n==null&&(n={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),c=t.F.deflateRaw(e,a,c,n.level);return new Uint8Array(a.buffer,0,c)},t.encode=function(e,n){n==null&&(n=!1);var a=0,c=t.bin.writeUint,b=t.bin.writeUshort,x={};for(var o in e){var l=!t._noNeed(o)&&!n,i=e[o],f=t.crc.crc(i,0,i.length);x[o]={cpr:l,usize:i.length,crc:f,file:l?t.deflateRaw(i):i}}for(var o in x)a+=x[o].file.length+30+46+2*t.bin.sizeUTF8(o);a+=22;var g=new Uint8Array(a),j=0,E=[];for(var o in x){var C=x[o];E.push(j),j=t._writeHeader(g,j,o,C,0)}var P=0,D=j;for(var o in x)C=x[o],E.push(j),j=t._writeHeader(g,j,o,C,1,E[P++]);var L=j-D;return c(g,j,101010256),j+=4,b(g,j+=4,P),b(g,j+=2,P),c(g,j+=2,L),c(g,j+=4,D),j+=4,j+=2,g.buffer},t._noNeed=function(e){var n=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},t._writeHeader=function(e,n,a,c,b,x){var o=t.bin.writeUint,l=t.bin.writeUshort,i=c.file;return o(e,n,b==0?67324752:33639248),n+=4,b==1&&(n+=2),l(e,n,20),l(e,n+=2,0),l(e,n+=2,c.cpr?8:0),o(e,n+=2,0),o(e,n+=4,c.crc),o(e,n+=4,i.length),o(e,n+=4,c.usize),l(e,n+=4,t.bin.sizeUTF8(a)),l(e,n+=2,0),n+=2,b==1&&(n+=2,n+=2,o(e,n+=6,x),n+=4),n+=t.bin.writeUTF8(e,n,a),b==0&&(e.set(i,n),n+=i.length),n},t.crc={table:(function(){for(var e=new Uint32Array(256),n=0;n<256;n++){for(var a=n,c=0;c<8;c++)1&a?a=3988292384^a>>>1:a>>>=1;e[n]=a}return e})(),update:function(e,n,a,c){for(var b=0;b<c;b++)e=t.crc.table[255&(e^n[a+b])]^e>>>8;return e},crc:function(e,n,a){return 4294967295^t.crc.update(4294967295,e,n,a)}},t.adler=function(e,n,a){for(var c=1,b=0,x=n,o=n+a;x<o;){for(var l=Math.min(x+5552,o);x<l;)b+=c+=e[x++];c%=65521,b%=65521}return b<<16|c},t.bin={readUshort:function(e,n){return e[n]|e[n+1]<<8},writeUshort:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255},readUint:function(e,n){return 16777216*e[n+3]+(e[n+2]<<16|e[n+1]<<8|e[n])},writeUint:function(e,n,a){e[n]=255&a,e[n+1]=a>>8&255,e[n+2]=a>>16&255,e[n+3]=a>>24&255},readASCII:function(e,n,a){for(var c="",b=0;b<a;b++)c+=String.fromCharCode(e[n+b]);return c},writeASCII:function(e,n,a){for(var c=0;c<a.length;c++)e[n+c]=a.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,n,a){for(var c,b="",x=0;x<a;x++)b+="%"+t.bin.pad(e[n+x].toString(16));try{c=decodeURIComponent(b)}catch{return t.bin.readASCII(e,n,a)}return c},writeUTF8:function(e,n,a){for(var c=a.length,b=0,x=0;x<c;x++){var o=a.charCodeAt(x);if((4294967168&o)==0)e[n+b]=o,b++;else if((4294965248&o)==0)e[n+b]=192|o>>6,e[n+b+1]=128|o>>0&63,b+=2;else if((4294901760&o)==0)e[n+b]=224|o>>12,e[n+b+1]=128|o>>6&63,e[n+b+2]=128|o>>0&63,b+=3;else{if((4292870144&o)!=0)throw"e";e[n+b]=240|o>>18,e[n+b+1]=128|o>>12&63,e[n+b+2]=128|o>>6&63,e[n+b+3]=128|o>>0&63,b+=4}}return b},sizeUTF8:function(e){for(var n=e.length,a=0,c=0;c<n;c++){var b=e.charCodeAt(c);if((4294967168&b)==0)a++;else if((4294965248&b)==0)a+=2;else if((4294901760&b)==0)a+=3;else{if((4292870144&b)!=0)throw"e";a+=4}}return a}},t.F={},t.F.deflateRaw=function(e,n,a,c){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],x=t.F.U,o=t.F._goodIndex;t.F._hash;var l=t.F._putsE,i=0,f=a<<3,g=0,j=e.length;if(c==0){for(;i<j;)l(n,f,i+(A=Math.min(65535,j-i))==j?1:0),f=t.F._copyExact(e,i,A,n,f+8),i+=A;return f>>>3}var E=x.lits,C=x.strt,P=x.prev,D=0,L=0,F=0,v=0,T=0,h=0;for(j>2&&(C[h=t.F._hash(e,0)]=0),i=0;i<j;i++){if(T=h,i+1<j-2){h=t.F._hash(e,i+1);var m=i+1&32767;P[m]=C[h],C[h]=m}if(g<=i){(D>14e3||L>26697)&&j-i>100&&(g<i&&(E[D]=i-g,D+=2,g=i),f=t.F._writeBlock(i==j-1||g==j?1:0,E,D,v,e,F,i-F,n,f),D=L=v=0,F=i);var S=0;i<j-2&&(S=t.F._bestMatch(e,i,P,T,Math.min(b[2],j-i),b[3]));var A=S>>>16,y=65535&S;if(S!=0){y=65535&S;var k=o(A=S>>>16,x.of0);x.lhst[257+k]++;var _=o(y,x.df0);x.dhst[_]++,v+=x.exb[k]+x.dxb[_],E[D]=A<<23|i-g,E[D+1]=y<<16|k<<8|_,D+=2,g=i+A}else x.lhst[e[i]]++;L++}}for(F==i&&e.length!=0||(g<i&&(E[D]=i-g,D+=2,g=i),f=t.F._writeBlock(1,E,D,v,e,F,i-F,n,f),D=0,L=0,D=L=v=0,F=i);(7&f)!=0;)f++;return f>>>3},t.F._bestMatch=function(e,n,a,c,b,x){var o=32767&n,l=a[o],i=o-l+32768&32767;if(l==o||c!=t.F._hash(e,n-i))return 0;for(var f=0,g=0,j=Math.min(32767,n);i<=j&&--x!=0&&l!=o;){if(f==0||e[n+f]==e[n+f-i]){var E=t.F._howLong(e,n,i);if(E>f){if(g=i,(f=E)>=b)break;i+2<E&&(E=i+2);for(var C=0,P=0;P<E-2;P++){var D=n-i+P+32768&32767,L=D-a[D]+32768&32767;L>C&&(C=L,l=D)}}}i+=(o=l)-(l=a[o])+32768&32767}return f<<16|g},t.F._howLong=function(e,n,a){if(e[n]!=e[n-a]||e[n+1]!=e[n+1-a]||e[n+2]!=e[n+2-a])return 0;var c=n,b=Math.min(e.length,n+258);for(n+=3;n<b&&e[n]==e[n-a];)n++;return n-c},t.F._hash=function(e,n){return(e[n]<<8|e[n+1])+(e[n+2]<<4)&65535},t.saved=0,t.F._writeBlock=function(e,n,a,c,b,x,o,l,i){var f,g,j,E,C,P,D,L,F,v=t.F.U,T=t.F._putsF,h=t.F._putsE;v.lhst[256]++,g=(f=t.F.getTrees())[0],j=f[1],E=f[2],C=f[3],P=f[4],D=f[5],L=f[6],F=f[7];var m=32+((i+3&7)==0?0:8-(i+3&7))+(o<<3),S=c+t.F.contSize(v.fltree,v.lhst)+t.F.contSize(v.fdtree,v.dhst),A=c+t.F.contSize(v.ltree,v.lhst)+t.F.contSize(v.dtree,v.dhst);A+=14+3*D+t.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var y=0;y<286;y++)v.lhst[y]=0;for(y=0;y<30;y++)v.dhst[y]=0;for(y=0;y<19;y++)v.ihst[y]=0;var k=m<S&&m<A?0:S<A?1:2;if(T(l,i,e),T(l,i+1,k),i+=3,k==0){for(;(7&i)!=0;)i++;i=t.F._copyExact(b,x,o,l,i)}else{var _,R;if(k==1&&(_=v.fltree,R=v.fdtree),k==2){t.F.makeCodes(v.ltree,g),t.F.revCodes(v.ltree,g),t.F.makeCodes(v.dtree,j),t.F.revCodes(v.dtree,j),t.F.makeCodes(v.itree,E),t.F.revCodes(v.itree,E),_=v.ltree,R=v.dtree,h(l,i,C-257),h(l,i+=5,P-1),h(l,i+=5,D-4),i+=4;for(var w=0;w<D;w++)h(l,i+3*w,v.itree[1+(v.ordr[w]<<1)]);i+=3*D,i=t.F._codeTiny(L,v.itree,l,i),i=t.F._codeTiny(F,v.itree,l,i)}for(var p=x,W=0;W<a;W+=2){for(var M=n[W],O=M>>>23,X=p+(8388607&M);p<X;)i=t.F._writeLit(b[p++],_,l,i);if(O!=0){var Z=n[W+1],Q=Z>>16,B=Z>>8&255,z=255&Z;h(l,i=t.F._writeLit(257+B,_,l,i),O-v.of0[B]),i+=v.exb[B],T(l,i=t.F._writeLit(z,R,l,i),Q-v.df0[z]),i+=v.dxb[z],p+=O}}i=t.F._writeLit(256,_,l,i)}return i},t.F._copyExact=function(e,n,a,c,b){var x=b>>>3;return c[x]=a,c[x+1]=a>>>8,c[x+2]=255-c[x],c[x+3]=255-c[x+1],x+=4,c.set(new Uint8Array(e.buffer,n,a),x),b+(a+4<<3)},t.F.getTrees=function(){for(var e=t.F.U,n=t.F._hufTree(e.lhst,e.ltree,15),a=t.F._hufTree(e.dhst,e.dtree,15),c=[],b=t.F._lenCodes(e.ltree,c),x=[],o=t.F._lenCodes(e.dtree,x),l=0;l<c.length;l+=2)e.ihst[c[l]]++;for(l=0;l<x.length;l+=2)e.ihst[x[l]]++;for(var i=t.F._hufTree(e.ihst,e.itree,7),f=19;f>4&&e.itree[1+(e.ordr[f-1]<<1)]==0;)f--;return[n,a,i,b,o,f,c,x]},t.F.getSecond=function(e){for(var n=[],a=0;a<e.length;a+=2)n.push(e[a+1]);return n},t.F.nonZero=function(e){for(var n="",a=0;a<e.length;a+=2)e[a+1]!=0&&(n+=(a>>1)+",");return n},t.F.contSize=function(e,n){for(var a=0,c=0;c<n.length;c++)a+=n[c]*e[1+(c<<1)];return a},t.F._codeTiny=function(e,n,a,c){for(var b=0;b<e.length;b+=2){var x=e[b],o=e[b+1];c=t.F._writeLit(x,n,a,c);var l=x==16?2:x==17?3:7;x>15&&(t.F._putsE(a,c,o,l),c+=l)}return c},t.F._lenCodes=function(e,n){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var c=0;c<a;c+=2){var b=e[c+1],x=c+3<a?e[c+3]:-1,o=c+5<a?e[c+5]:-1,l=c==0?-1:e[c-1];if(b==0&&x==b&&o==b){for(var i=c+5;i+2<a&&e[i+2]==b;)i+=2;(f=Math.min(i+1-c>>>1,138))<11?n.push(17,f-3):n.push(18,f-11),c+=2*f-2}else if(b==l&&x==b&&o==b){for(i=c+5;i+2<a&&e[i+2]==b;)i+=2;var f=Math.min(i+1-c>>>1,6);n.push(16,f-3),c+=2*f-2}else n.push(b,0)}return a>>>1},t.F._hufTree=function(e,n,a){var c=[],b=e.length,x=n.length,o=0;for(o=0;o<x;o+=2)n[o]=0,n[o+1]=0;for(o=0;o<b;o++)e[o]!=0&&c.push({lit:o,f:e[o]});var l=c.length,i=c.slice(0);if(l==0)return 0;if(l==1){var f=c[0].lit;return i=f==0?1:0,n[1+(f<<1)]=1,n[1+(i<<1)]=1,1}c.sort((function(L,F){return L.f-F.f}));var g=c[0],j=c[1],E=0,C=1,P=2;for(c[0]={lit:-1,f:g.f+j.f,l:g,r:j,d:0};C!=l-1;)g=E!=C&&(P==l||c[E].f<c[P].f)?c[E++]:c[P++],j=E!=C&&(P==l||c[E].f<c[P].f)?c[E++]:c[P++],c[C++]={lit:-1,f:g.f+j.f,l:g,r:j};var D=t.F.setDepth(c[C-1],0);for(D>a&&(t.F.restrictDepth(i,a,D),D=a),o=0;o<l;o++)n[1+(i[o].lit<<1)]=i[o].d;return D},t.F.setDepth=function(e,n){return e.lit!=-1?(e.d=n,n):Math.max(t.F.setDepth(e.l,n+1),t.F.setDepth(e.r,n+1))},t.F.restrictDepth=function(e,n,a){var c=0,b=1<<a-n,x=0;for(e.sort((function(l,i){return i.d==l.d?l.f-i.f:i.d-l.d})),c=0;c<e.length&&e[c].d>n;c++){var o=e[c].d;e[c].d=n,x+=b-(1<<a-o)}for(x>>>=a-n;x>0;)(o=e[c].d)<n?(e[c].d++,x-=1<<n-o-1):c++;for(;c>=0;c--)e[c].d==n&&x<0&&(e[c].d--,x++);x!=0&&console.log("debt left")},t.F._goodIndex=function(e,n){var a=0;return n[16|a]<=e&&(a|=16),n[8|a]<=e&&(a|=8),n[4|a]<=e&&(a|=4),n[2|a]<=e&&(a|=2),n[1|a]<=e&&(a|=1),a},t.F._writeLit=function(e,n,a,c){return t.F._putsF(a,c,n[e<<1]),c+n[1+(e<<1)]},t.F.inflate=function(e,n){var a=Uint8Array;if(e[0]==3&&e[1]==0)return n||new a(0);var c=t.F,b=c._bitsF,x=c._bitsE,o=c._decodeTiny,l=c.makeCodes,i=c.codes2map,f=c._get17,g=c.U,j=n==null;j&&(n=new a(e.length>>>2<<3));for(var E,C,P=0,D=0,L=0,F=0,v=0,T=0,h=0,m=0,S=0;P==0;)if(P=b(e,S,1),D=b(e,S+1,2),S+=3,D!=0){if(j&&(n=t.F._check(n,m+(1<<17))),D==1&&(E=g.flmap,C=g.fdmap,T=511,h=31),D==2){L=x(e,S,5)+257,F=x(e,S+5,5)+1,v=x(e,S+10,4)+4,S+=14;for(var A=0;A<38;A+=2)g.itree[A]=0,g.itree[A+1]=0;var y=1;for(A=0;A<v;A++){var k=x(e,S+3*A,3);g.itree[1+(g.ordr[A]<<1)]=k,k>y&&(y=k)}S+=3*v,l(g.itree,y),i(g.itree,y,g.imap),E=g.lmap,C=g.dmap,S=o(g.imap,(1<<y)-1,L+F,e,S,g.ttree);var _=c._copyOut(g.ttree,0,L,g.ltree);T=(1<<_)-1;var R=c._copyOut(g.ttree,L,F,g.dtree);h=(1<<R)-1,l(g.ltree,_),i(g.ltree,_,E),l(g.dtree,R),i(g.dtree,R,C)}for(;;){var w=E[f(e,S)&T];S+=15&w;var p=w>>>4;if(!(p>>>8))n[m++]=p;else{if(p==256)break;var W=m+p-254;if(p>264){var M=g.ldef[p-257];W=m+(M>>>3)+x(e,S,7&M),S+=7&M}var O=C[f(e,S)&h];S+=15&O;var X=O>>>4,Z=g.ddef[X],Q=(Z>>>4)+b(e,S,15&Z);for(S+=15&Z,j&&(n=t.F._check(n,m+(1<<17)));m<W;)n[m]=n[m++-Q],n[m]=n[m++-Q],n[m]=n[m++-Q],n[m]=n[m++-Q];m=W}}}else{(7&S)!=0&&(S+=8-(7&S));var B=4+(S>>>3),z=e[B-4]|e[B-3]<<8;j&&(n=t.F._check(n,m+z)),n.set(new a(e.buffer,e.byteOffset+B,z),m),S=B+z<<3,m+=z}return n.length==m?n:n.slice(0,m)},t.F._check=function(e,n){var a=e.length;if(n<=a)return e;var c=new Uint8Array(Math.max(a<<1,n));return c.set(e,0),c},t.F._decodeTiny=function(e,n,a,c,b,x){for(var o=t.F._bitsE,l=t.F._get17,i=0;i<a;){var f=e[l(c,b)&n];b+=15&f;var g=f>>>4;if(g<=15)x[i]=g,i++;else{var j=0,E=0;g==16?(E=3+o(c,b,2),b+=2,j=x[i-1]):g==17?(E=3+o(c,b,3),b+=3):g==18&&(E=11+o(c,b,7),b+=7);for(var C=i+E;i<C;)x[i]=j,i++}}return b},t.F._copyOut=function(e,n,a,c){for(var b=0,x=0,o=c.length>>>1;x<a;){var l=e[x+n];c[x<<1]=0,c[1+(x<<1)]=l,l>b&&(b=l),x++}for(;x<o;)c[x<<1]=0,c[1+(x<<1)]=0,x++;return b},t.F.makeCodes=function(e,n){for(var a,c,b,x,o=t.F.U,l=e.length,i=o.bl_count,f=0;f<=n;f++)i[f]=0;for(f=1;f<l;f+=2)i[e[f]]++;var g=o.next_code;for(a=0,i[0]=0,c=1;c<=n;c++)a=a+i[c-1]<<1,g[c]=a;for(b=0;b<l;b+=2)(x=e[b+1])!=0&&(e[b]=g[x],g[x]++)},t.F.codes2map=function(e,n,a){for(var c=e.length,b=t.F.U.rev15,x=0;x<c;x+=2)if(e[x+1]!=0)for(var o=x>>1,l=e[x+1],i=o<<4|l,f=n-l,g=e[x]<<f,j=g+(1<<f);g!=j;)a[b[g]>>>15-n]=i,g++},t.F.revCodes=function(e,n){for(var a=t.F.U.rev15,c=15-n,b=0;b<e.length;b+=2){var x=e[b]<<n-e[b+1];e[b]=a[x]>>>c}},t.F._putsE=function(e,n,a){a<<=7&n;var c=n>>>3;e[c]|=a,e[c+1]|=a>>>8},t.F._putsF=function(e,n,a){a<<=7&n;var c=n>>>3;e[c]|=a,e[c+1]|=a>>>8,e[c+2]|=a>>>16},t.F._bitsE=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8)>>>(7&n)&(1<<a)-1},t.F._bitsF=function(e,n,a){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)&(1<<a)-1},t.F._get17=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16)>>>(7&n)},t.F._get25=function(e,n){return(e[n>>>3]|e[1+(n>>>3)]<<8|e[2+(n>>>3)]<<16|e[3+(n>>>3)]<<24)>>>(7&n)},t.F.U=(u=Uint16Array,r=Uint32Array,{next_code:new u(16),bl_count:new u(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new u(512),fltree:[],fdmap:new u(32),fdtree:[],lmap:new u(32768),ltree:[],ttree:[],dmap:new u(32768),dtree:[],imap:new u(512),itree:[],rev15:new u(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new u(65536),prev:new u(32768)}),(function(){for(var e=t.F.U,n=0;n<32768;n++){var a=n;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[n]=(a>>>16|a<<16)>>>17}function c(b,x,o){for(;x--!=0;)b.push(0,o)}for(n=0;n<32;n++)e.ldef[n]=e.of0[n]<<3|e.exb[n],e.ddef[n]=e.df0[n]<<4|e.dxb[n];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),t.F.makeCodes(e.fltree,9),t.F.codes2map(e.fltree,9,e.flmap),t.F.revCodes(e.fltree,9),c(e.fdtree,32,5),t.F.makeCodes(e.fdtree,5),t.F.codes2map(e.fdtree,5,e.fdmap),t.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)})()})();var _n=wn({__proto__:null,default:Pt},[Pt]);const rt=(function(){var d={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,i){o[l]=i>>8&255,o[l+1]=255&i},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,i){o[l]=i>>24&255,o[l+1]=i>>16&255,o[l+2]=i>>8&255,o[l+3]=255&i},readASCII(o,l,i){let f="";for(let g=0;g<i;g++)f+=String.fromCharCode(o[l+g]);return f},writeASCII(o,l,i){for(let f=0;f<i.length;f++)o[l+f]=i.charCodeAt(f)},readBytes(o,l,i){const f=[];for(let g=0;g<i;g++)f.push(o[l+g]);return f},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,i){let f,g="";for(let j=0;j<i;j++)g+=`%${d.pad(o[l+j].toString(16))}`;try{f=decodeURIComponent(g)}catch{return d.readASCII(o,l,i)}return f}};function u(o,l,i,f){const g=l*i,j=n(f),E=Math.ceil(l*j/8),C=new Uint8Array(4*g),P=new Uint32Array(C.buffer),{ctype:D}=f,{depth:L}=f,F=d.readUshort;if(D==6){const M=g<<2;if(L==8)for(var v=0;v<M;v+=4)C[v]=o[v],C[v+1]=o[v+1],C[v+2]=o[v+2],C[v+3]=o[v+3];if(L==16)for(v=0;v<M;v++)C[v]=o[v<<1]}else if(D==2){const M=f.tabs.tRNS;if(M==null){if(L==8)for(v=0;v<g;v++){var T=3*v;P[v]=255<<24|o[T+2]<<16|o[T+1]<<8|o[T]}if(L==16)for(v=0;v<g;v++)T=6*v,P[v]=255<<24|o[T+4]<<16|o[T+2]<<8|o[T]}else{var h=M[0];const O=M[1],X=M[2];if(L==8)for(v=0;v<g;v++){var m=v<<2;T=3*v,P[v]=255<<24|o[T+2]<<16|o[T+1]<<8|o[T],o[T]==h&&o[T+1]==O&&o[T+2]==X&&(C[m+3]=0)}if(L==16)for(v=0;v<g;v++)m=v<<2,T=6*v,P[v]=255<<24|o[T+4]<<16|o[T+2]<<8|o[T],F(o,T)==h&&F(o,T+2)==O&&F(o,T+4)==X&&(C[m+3]=0)}}else if(D==3){const M=f.tabs.PLTE,O=f.tabs.tRNS,X=O?O.length:0;if(L==1)for(var S=0;S<i;S++){var A=S*E,y=S*l;for(v=0;v<l;v++){m=y+v<<2;var k=3*(_=o[A+(v>>3)]>>7-((7&v)<<0)&1);C[m]=M[k],C[m+1]=M[k+1],C[m+2]=M[k+2],C[m+3]=_<X?O[_]:255}}if(L==2)for(S=0;S<i;S++)for(A=S*E,y=S*l,v=0;v<l;v++)m=y+v<<2,k=3*(_=o[A+(v>>2)]>>6-((3&v)<<1)&3),C[m]=M[k],C[m+1]=M[k+1],C[m+2]=M[k+2],C[m+3]=_<X?O[_]:255;if(L==4)for(S=0;S<i;S++)for(A=S*E,y=S*l,v=0;v<l;v++)m=y+v<<2,k=3*(_=o[A+(v>>1)]>>4-((1&v)<<2)&15),C[m]=M[k],C[m+1]=M[k+1],C[m+2]=M[k+2],C[m+3]=_<X?O[_]:255;if(L==8)for(v=0;v<g;v++){var _;m=v<<2,k=3*(_=o[v]),C[m]=M[k],C[m+1]=M[k+1],C[m+2]=M[k+2],C[m+3]=_<X?O[_]:255}}else if(D==4){if(L==8)for(v=0;v<g;v++){m=v<<2;var R=o[w=v<<1];C[m]=R,C[m+1]=R,C[m+2]=R,C[m+3]=o[w+1]}if(L==16)for(v=0;v<g;v++){var w;m=v<<2,R=o[w=v<<2],C[m]=R,C[m+1]=R,C[m+2]=R,C[m+3]=o[w+2]}}else if(D==0)for(h=f.tabs.tRNS?f.tabs.tRNS:-1,S=0;S<i;S++){const M=S*E,O=S*l;if(L==1)for(var p=0;p<l;p++){var W=(R=255*(o[M+(p>>>3)]>>>7-(7&p)&1))==255*h?0:255;P[O+p]=W<<24|R<<16|R<<8|R}else if(L==2)for(p=0;p<l;p++)W=(R=85*(o[M+(p>>>2)]>>>6-((3&p)<<1)&3))==85*h?0:255,P[O+p]=W<<24|R<<16|R<<8|R;else if(L==4)for(p=0;p<l;p++)W=(R=17*(o[M+(p>>>1)]>>>4-((1&p)<<2)&15))==17*h?0:255,P[O+p]=W<<24|R<<16|R<<8|R;else if(L==8)for(p=0;p<l;p++)W=(R=o[M+p])==h?0:255,P[O+p]=W<<24|R<<16|R<<8|R;else if(L==16)for(p=0;p<l;p++)R=o[M+(p<<1)],W=F(o,M+(p<<1))==h?0:255,P[O+p]=W<<24|R<<16|R<<8|R}return C}function r(o,l,i,f){const g=n(o),j=Math.ceil(i*g/8),E=new Uint8Array((j+1+o.interlace)*f);return l=o.tabs.CgBI?e(l,E):t(l,E),o.interlace==0?l=a(l,o,0,i,f):o.interlace==1&&(l=(function(P,D){const L=D.width,F=D.height,v=n(D),T=v>>3,h=Math.ceil(L*v/8),m=new Uint8Array(F*h);let S=0;const A=[0,0,4,0,2,0,1],y=[0,4,0,2,0,1,0],k=[8,8,8,4,4,2,2],_=[8,8,4,4,2,2,1];let R=0;for(;R<7;){const p=k[R],W=_[R];let M=0,O=0,X=A[R];for(;X<F;)X+=p,O++;let Z=y[R];for(;Z<L;)Z+=W,M++;const Q=Math.ceil(M*v/8);a(P,D,S,M,O);let B=0,z=A[R];for(;z<F;){let ne=y[R],pe=S+B*Q<<3;for(;ne<L;){var w;if(v==1&&(w=(w=P[pe>>3])>>7-(7&pe)&1,m[z*h+(ne>>3)]|=w<<7-((7&ne)<<0)),v==2&&(w=(w=P[pe>>3])>>6-(7&pe)&3,m[z*h+(ne>>2)]|=w<<6-((3&ne)<<1)),v==4&&(w=(w=P[pe>>3])>>4-(7&pe)&15,m[z*h+(ne>>1)]|=w<<4-((1&ne)<<2)),v>=8){const de=z*h+ne*T;for(let le=0;le<T;le++)m[de+le]=P[(pe>>3)+le]}pe+=v,ne+=W}B++,z+=p}M*O!=0&&(S+=O*(1+Q)),R+=1}return m})(l,o)),l}function t(o,l){return e(new Uint8Array(o.buffer,2,o.length-6),l)}var e=(function(){const o={H:{}};return o.H.N=function(l,i){const f=Uint8Array;let g,j,E=0,C=0,P=0,D=0,L=0,F=0,v=0,T=0,h=0;if(l[0]==3&&l[1]==0)return i||new f(0);const m=o.H,S=m.b,A=m.e,y=m.R,k=m.n,_=m.A,R=m.Z,w=m.m,p=i==null;for(p&&(i=new f(l.length>>>2<<5));E==0;)if(E=S(l,h,1),C=S(l,h+1,2),h+=3,C!=0){if(p&&(i=o.H.W(i,T+(1<<17))),C==1&&(g=w.J,j=w.h,F=511,v=31),C==2){P=A(l,h,5)+257,D=A(l,h+5,5)+1,L=A(l,h+10,4)+4,h+=14;let M=1;for(var W=0;W<38;W+=2)w.Q[W]=0,w.Q[W+1]=0;for(W=0;W<L;W++){const Z=A(l,h+3*W,3);w.Q[1+(w.X[W]<<1)]=Z,Z>M&&(M=Z)}h+=3*L,k(w.Q,M),_(w.Q,M,w.u),g=w.w,j=w.d,h=y(w.u,(1<<M)-1,P+D,l,h,w.v);const O=m.V(w.v,0,P,w.C);F=(1<<O)-1;const X=m.V(w.v,P,D,w.D);v=(1<<X)-1,k(w.C,O),_(w.C,O,g),k(w.D,X),_(w.D,X,j)}for(;;){const M=g[R(l,h)&F];h+=15&M;const O=M>>>4;if(!(O>>>8))i[T++]=O;else{if(O==256)break;{let X=T+O-254;if(O>264){const ne=w.q[O-257];X=T+(ne>>>3)+A(l,h,7&ne),h+=7&ne}const Z=j[R(l,h)&v];h+=15&Z;const Q=Z>>>4,B=w.c[Q],z=(B>>>4)+S(l,h,15&B);for(h+=15&B;T<X;)i[T]=i[T++-z],i[T]=i[T++-z],i[T]=i[T++-z],i[T]=i[T++-z];T=X}}}}else{(7&h)!=0&&(h+=8-(7&h));const M=4+(h>>>3),O=l[M-4]|l[M-3]<<8;p&&(i=o.H.W(i,T+O)),i.set(new f(l.buffer,l.byteOffset+M,O),T),h=M+O<<3,T+=O}return i.length==T?i:i.slice(0,T)},o.H.W=function(l,i){const f=l.length;if(i<=f)return l;const g=new Uint8Array(f<<1);return g.set(l,0),g},o.H.R=function(l,i,f,g,j,E){const C=o.H.e,P=o.H.Z;let D=0;for(;D<f;){const L=l[P(g,j)&i];j+=15&L;const F=L>>>4;if(F<=15)E[D]=F,D++;else{let v=0,T=0;F==16?(T=3+C(g,j,2),j+=2,v=E[D-1]):F==17?(T=3+C(g,j,3),j+=3):F==18&&(T=11+C(g,j,7),j+=7);const h=D+T;for(;D<h;)E[D]=v,D++}}return j},o.H.V=function(l,i,f,g){let j=0,E=0;const C=g.length>>>1;for(;E<f;){const P=l[E+i];g[E<<1]=0,g[1+(E<<1)]=P,P>j&&(j=P),E++}for(;E<C;)g[E<<1]=0,g[1+(E<<1)]=0,E++;return j},o.H.n=function(l,i){const f=o.H.m,g=l.length;let j,E,C,P;const D=f.j;for(var L=0;L<=i;L++)D[L]=0;for(L=1;L<g;L+=2)D[l[L]]++;const F=f.K;for(j=0,D[0]=0,E=1;E<=i;E++)j=j+D[E-1]<<1,F[E]=j;for(C=0;C<g;C+=2)P=l[C+1],P!=0&&(l[C]=F[P],F[P]++)},o.H.A=function(l,i,f){const g=l.length,j=o.H.m.r;for(let E=0;E<g;E+=2)if(l[E+1]!=0){const C=E>>1,P=l[E+1],D=C<<4|P,L=i-P;let F=l[E]<<L;const v=F+(1<<L);for(;F!=v;)f[j[F]>>>15-i]=D,F++}},o.H.l=function(l,i){const f=o.H.m.r,g=15-i;for(let j=0;j<l.length;j+=2){const E=l[j]<<i-l[j+1];l[j]=f[E]>>>g}},o.H.M=function(l,i,f){f<<=7&i;const g=i>>>3;l[g]|=f,l[g+1]|=f>>>8},o.H.I=function(l,i,f){f<<=7&i;const g=i>>>3;l[g]|=f,l[g+1]|=f>>>8,l[g+2]|=f>>>16},o.H.e=function(l,i,f){return(l[i>>>3]|l[1+(i>>>3)]<<8)>>>(7&i)&(1<<f)-1},o.H.b=function(l,i,f){return(l[i>>>3]|l[1+(i>>>3)]<<8|l[2+(i>>>3)]<<16)>>>(7&i)&(1<<f)-1},o.H.Z=function(l,i){return(l[i>>>3]|l[1+(i>>>3)]<<8|l[2+(i>>>3)]<<16)>>>(7&i)},o.H.i=function(l,i){return(l[i>>>3]|l[1+(i>>>3)]<<8|l[2+(i>>>3)]<<16|l[3+(i>>>3)]<<24)>>>(7&i)},o.H.m=(function(){const l=Uint16Array,i=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new i(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new i(286),Y:new i(30),a:new i(19),t:new i(15e3),k:new l(65536),g:new l(32768)}})(),(function(){const l=o.H.m;for(var i=0;i<32768;i++){let g=i;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,l.r[i]=(g>>>16|g<<16)>>>17}function f(g,j,E){for(;j--!=0;)g.push(0,E)}for(i=0;i<32;i++)l.q[i]=l.S[i]<<3|l.T[i],l.c[i]=l.p[i]<<4|l.z[i];f(l._,144,8),f(l._,112,9),f(l._,24,7),f(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),f(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),f(l.Q,19,0),f(l.C,286,0),f(l.D,30,0),f(l.v,320,0)})(),o.H.N})();function n(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function a(o,l,i,f,g){let j=n(l);const E=Math.ceil(f*j/8);let C,P;j=Math.ceil(j/8);let D=o[i],L=0;if(D>1&&(o[i]=[0,0,1][D-2]),D==3)for(L=j;L<E;L++)o[L+1]=o[L+1]+(o[L+1-j]>>>1)&255;for(let F=0;F<g;F++)if(C=i+F*E,P=C+F+1,D=o[P-1],L=0,D==0)for(;L<E;L++)o[C+L]=o[P+L];else if(D==1){for(;L<j;L++)o[C+L]=o[P+L];for(;L<E;L++)o[C+L]=o[P+L]+o[C+L-j]}else if(D==2)for(;L<E;L++)o[C+L]=o[P+L]+o[C+L-E];else if(D==3){for(;L<j;L++)o[C+L]=o[P+L]+(o[C+L-E]>>>1);for(;L<E;L++)o[C+L]=o[P+L]+(o[C+L-E]+o[C+L-j]>>>1)}else{for(;L<j;L++)o[C+L]=o[P+L]+c(0,o[C+L-E],0);for(;L<E;L++)o[C+L]=o[P+L]+c(o[C+L-j],o[C+L-E],o[C+L-j-E])}return o}function c(o,l,i){const f=o+l-i,g=f-o,j=f-l,E=f-i;return g*g<=j*j&&g*g<=E*E?o:j*j<=E*E?l:i}function b(o,l,i){i.width=d.readUint(o,l),l+=4,i.height=d.readUint(o,l),l+=4,i.depth=o[l],l++,i.ctype=o[l],l++,i.compress=o[l],l++,i.filter=o[l],l++,i.interlace=o[l],l++}function x(o,l,i,f,g,j,E,C,P){const D=Math.min(l,g),L=Math.min(i,j);let F=0,v=0;for(let R=0;R<L;R++)for(let w=0;w<D;w++)if(E>=0&&C>=0?(F=R*l+w<<2,v=(C+R)*g+E+w<<2):(F=(-C+R)*l-E+w<<2,v=R*g+w<<2),P==0)f[v]=o[F],f[v+1]=o[F+1],f[v+2]=o[F+2],f[v+3]=o[F+3];else if(P==1){var T=o[F+3]*.00392156862745098,h=o[F]*T,m=o[F+1]*T,S=o[F+2]*T,A=f[v+3]*(1/255),y=f[v]*A,k=f[v+1]*A,_=f[v+2]*A;const p=1-T,W=T+A*p,M=W==0?0:1/W;f[v+3]=255*W,f[v+0]=(h+y*p)*M,f[v+1]=(m+k*p)*M,f[v+2]=(S+_*p)*M}else if(P==2)T=o[F+3],h=o[F],m=o[F+1],S=o[F+2],A=f[v+3],y=f[v],k=f[v+1],_=f[v+2],T==A&&h==y&&m==k&&S==_?(f[v]=0,f[v+1]=0,f[v+2]=0,f[v+3]=0):(f[v]=h,f[v+1]=m,f[v+2]=S,f[v+3]=T);else if(P==3){if(T=o[F+3],h=o[F],m=o[F+1],S=o[F+2],A=f[v+3],y=f[v],k=f[v+1],_=f[v+2],T==A&&h==y&&m==k&&S==_)continue;if(T<220&&A>20)return!1}return!0}return{decode:function(l){const i=new Uint8Array(l);let f=8;const g=d,j=g.readUshort,E=g.readUint,C={tabs:{},frames:[]},P=new Uint8Array(i.length);let D,L=0,F=0;const v=[137,80,78,71,13,10,26,10];for(var T=0;T<8;T++)if(i[T]!=v[T])throw"The input is not a PNG file!";for(;f<i.length;){const R=g.readUint(i,f);f+=4;const w=g.readASCII(i,f,4);if(f+=4,w=="IHDR")b(i,f,C);else if(w=="iCCP"){for(var h=f;i[h]!=0;)h++;g.readASCII(i,f,h-f),i[h+1];const p=i.slice(h+2,f+R);let W=null;try{W=t(p)}catch{W=e(p)}C.tabs[w]=W}else if(w=="CgBI")C.tabs[w]=i.slice(f,f+4);else if(w=="IDAT"){for(T=0;T<R;T++)P[L+T]=i[f+T];L+=R}else if(w=="acTL")C.tabs[w]={num_frames:E(i,f),num_plays:E(i,f+4)},D=new Uint8Array(i.length);else if(w=="fcTL"){F!=0&&((_=C.frames[C.frames.length-1]).data=r(C,D.slice(0,F),_.rect.width,_.rect.height),F=0);const p={x:E(i,f+12),y:E(i,f+16),width:E(i,f+4),height:E(i,f+8)};let W=j(i,f+22);W=j(i,f+20)/(W==0?100:W);const M={rect:p,delay:Math.round(1e3*W),dispose:i[f+24],blend:i[f+25]};C.frames.push(M)}else if(w=="fdAT"){for(T=0;T<R-4;T++)D[F+T]=i[f+T+4];F+=R-4}else if(w=="pHYs")C.tabs[w]=[g.readUint(i,f),g.readUint(i,f+4),i[f+8]];else if(w=="cHRM")for(C.tabs[w]=[],T=0;T<8;T++)C.tabs[w].push(g.readUint(i,f+4*T));else if(w=="tEXt"||w=="zTXt"){C.tabs[w]==null&&(C.tabs[w]={});var m=g.nextZero(i,f),S=g.readASCII(i,f,m-f),A=f+R-m-1;if(w=="tEXt")k=g.readASCII(i,m+1,A);else{var y=t(i.slice(m+2,m+2+A));k=g.readUTF8(y,0,y.length)}C.tabs[w][S]=k}else if(w=="iTXt"){C.tabs[w]==null&&(C.tabs[w]={}),m=0,h=f,m=g.nextZero(i,h),S=g.readASCII(i,h,m-h);const p=i[h=m+1];var k;i[h+1],h+=2,m=g.nextZero(i,h),g.readASCII(i,h,m-h),h=m+1,m=g.nextZero(i,h),g.readUTF8(i,h,m-h),A=R-((h=m+1)-f),p==0?k=g.readUTF8(i,h,A):(y=t(i.slice(h,h+A)),k=g.readUTF8(y,0,y.length)),C.tabs[w][S]=k}else if(w=="PLTE")C.tabs[w]=g.readBytes(i,f,R);else if(w=="hIST"){const p=C.tabs.PLTE.length/3;for(C.tabs[w]=[],T=0;T<p;T++)C.tabs[w].push(j(i,f+2*T))}else if(w=="tRNS")C.ctype==3?C.tabs[w]=g.readBytes(i,f,R):C.ctype==0?C.tabs[w]=j(i,f):C.ctype==2&&(C.tabs[w]=[j(i,f),j(i,f+2),j(i,f+4)]);else if(w=="gAMA")C.tabs[w]=g.readUint(i,f)/1e5;else if(w=="sRGB")C.tabs[w]=i[f];else if(w=="bKGD")C.ctype==0||C.ctype==4?C.tabs[w]=[j(i,f)]:C.ctype==2||C.ctype==6?C.tabs[w]=[j(i,f),j(i,f+2),j(i,f+4)]:C.ctype==3&&(C.tabs[w]=i[f]);else if(w=="IEND")break;f+=R,g.readUint(i,f),f+=4}var _;return F!=0&&((_=C.frames[C.frames.length-1]).data=r(C,D.slice(0,F),_.rect.width,_.rect.height)),C.data=r(C,P,C.width,C.height),delete C.compress,delete C.interlace,delete C.filter,C},toRGBA8:function(l){const i=l.width,f=l.height;if(l.tabs.acTL==null)return[u(l.data,i,f,l).buffer];const g=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const j=i*f*4,E=new Uint8Array(j),C=new Uint8Array(j),P=new Uint8Array(j);for(let L=0;L<l.frames.length;L++){const F=l.frames[L],v=F.rect.x,T=F.rect.y,h=F.rect.width,m=F.rect.height,S=u(F.data,h,m,l);if(L!=0)for(var D=0;D<j;D++)P[D]=E[D];if(F.blend==0?x(S,h,m,E,i,f,v,T,0):F.blend==1&&x(S,h,m,E,i,f,v,T,1),g.push(E.buffer.slice(0)),F.dispose!=0){if(F.dispose==1)x(C,h,m,E,i,f,v,T,0);else if(F.dispose==2)for(D=0;D<j;D++)E[D]=P[D]}}return g},_paeth:c,_copyTile:x,_bin:d}})();(function(){const{_copyTile:d}=rt,{_bin:u}=rt,r=rt._paeth;var t={table:(function(){const h=new Uint32Array(256);for(let m=0;m<256;m++){let S=m;for(let A=0;A<8;A++)1&S?S=3988292384^S>>>1:S>>>=1;h[m]=S}return h})(),update(h,m,S,A){for(let y=0;y<A;y++)h=t.table[255&(h^m[S+y])]^h>>>8;return h},crc:(h,m,S)=>4294967295^t.update(4294967295,h,m,S)};function e(h,m,S,A){m[S]+=h[0]*A>>4,m[S+1]+=h[1]*A>>4,m[S+2]+=h[2]*A>>4,m[S+3]+=h[3]*A>>4}function n(h){return Math.max(0,Math.min(255,h))}function a(h,m){const S=h[0]-m[0],A=h[1]-m[1],y=h[2]-m[2],k=h[3]-m[3];return S*S+A*A+y*y+k*k}function c(h,m,S,A,y,k,_){_==null&&(_=1);const R=A.length,w=[];for(var p=0;p<R;p++){const z=A[p];w.push([z>>>0&255,z>>>8&255,z>>>16&255,z>>>24&255])}for(p=0;p<R;p++){let z=4294967295;for(var W=0,M=0;M<R;M++){var O=a(w[p],w[M]);M!=p&&O<z&&(z=O,W=M)}}const X=new Uint32Array(y.buffer),Z=new Int16Array(m*S*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(p=0;p<Q.length;p++)Q[p]=255*((Q[p]+.5)/16-.5);for(let z=0;z<S;z++)for(let ne=0;ne<m;ne++){var B;p=4*(z*m+ne),_!=2?B=[n(h[p]+Z[p]),n(h[p+1]+Z[p+1]),n(h[p+2]+Z[p+2]),n(h[p+3]+Z[p+3])]:(O=Q[4*(3&z)+(3&ne)],B=[n(h[p]+O),n(h[p+1]+O),n(h[p+2]+O),n(h[p+3]+O)]),W=0;let pe=16777215;for(M=0;M<R;M++){const he=a(B,w[M]);he<pe&&(pe=he,W=M)}const de=w[W],le=[B[0]-de[0],B[1]-de[1],B[2]-de[2],B[3]-de[3]];_==1&&(ne!=m-1&&e(le,Z,p+4,7),z!=S-1&&(ne!=0&&e(le,Z,p+4*m-4,3),e(le,Z,p+4*m,5),ne!=m-1&&e(le,Z,p+4*m+4,1))),k[p>>2]=W,X[p>>2]=A[W]}}function b(h,m,S,A,y){y==null&&(y={});const{crc:k}=t,_=u.writeUint,R=u.writeUshort,w=u.writeASCII;let p=8;const W=h.frames.length>1;let M,O=!1,X=33+(W?20:0);if(y.sRGB!=null&&(X+=13),y.pHYs!=null&&(X+=21),y.iCCP!=null&&(M=pako.deflate(y.iCCP),X+=21+M.length+4),h.ctype==3){for(var Z=h.plte.length,Q=0;Q<Z;Q++)h.plte[Q]>>>24!=255&&(O=!0);X+=8+3*Z+4+(O?8+1*Z+4:0)}for(var B=0;B<h.frames.length;B++)W&&(X+=38),X+=(de=h.frames[B]).cimg.length+12,B!=0&&(X+=4);X+=12;const z=new Uint8Array(X),ne=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)z[Q]=ne[Q];if(_(z,p,13),p+=4,w(z,p,"IHDR"),p+=4,_(z,p,m),p+=4,_(z,p,S),p+=4,z[p]=h.depth,p++,z[p]=h.ctype,p++,z[p]=0,p++,z[p]=0,p++,z[p]=0,p++,_(z,p,k(z,p-17,17)),p+=4,y.sRGB!=null&&(_(z,p,1),p+=4,w(z,p,"sRGB"),p+=4,z[p]=y.sRGB,p++,_(z,p,k(z,p-5,5)),p+=4),y.iCCP!=null){const le=13+M.length;_(z,p,le),p+=4,w(z,p,"iCCP"),p+=4,w(z,p,"ICC profile"),p+=11,p+=2,z.set(M,p),p+=M.length,_(z,p,k(z,p-(le+4),le+4)),p+=4}if(y.pHYs!=null&&(_(z,p,9),p+=4,w(z,p,"pHYs"),p+=4,_(z,p,y.pHYs[0]),p+=4,_(z,p,y.pHYs[1]),p+=4,z[p]=y.pHYs[2],p++,_(z,p,k(z,p-13,13)),p+=4),W&&(_(z,p,8),p+=4,w(z,p,"acTL"),p+=4,_(z,p,h.frames.length),p+=4,_(z,p,y.loop!=null?y.loop:0),p+=4,_(z,p,k(z,p-12,12)),p+=4),h.ctype==3){for(_(z,p,3*(Z=h.plte.length)),p+=4,w(z,p,"PLTE"),p+=4,Q=0;Q<Z;Q++){const le=3*Q,he=h.plte[Q],fe=255&he,Le=he>>>8&255,Ge=he>>>16&255;z[p+le+0]=fe,z[p+le+1]=Le,z[p+le+2]=Ge}if(p+=3*Z,_(z,p,k(z,p-3*Z-4,3*Z+4)),p+=4,O){for(_(z,p,Z),p+=4,w(z,p,"tRNS"),p+=4,Q=0;Q<Z;Q++)z[p+Q]=h.plte[Q]>>>24&255;p+=Z,_(z,p,k(z,p-Z-4,Z+4)),p+=4}}let pe=0;for(B=0;B<h.frames.length;B++){var de=h.frames[B];W&&(_(z,p,26),p+=4,w(z,p,"fcTL"),p+=4,_(z,p,pe++),p+=4,_(z,p,de.rect.width),p+=4,_(z,p,de.rect.height),p+=4,_(z,p,de.rect.x),p+=4,_(z,p,de.rect.y),p+=4,R(z,p,A[B]),p+=2,R(z,p,1e3),p+=2,z[p]=de.dispose,p++,z[p]=de.blend,p++,_(z,p,k(z,p-30,30)),p+=4);const le=de.cimg;_(z,p,(Z=le.length)+(B==0?0:4)),p+=4;const he=p;w(z,p,B==0?"IDAT":"fdAT"),p+=4,B!=0&&(_(z,p,pe++),p+=4),z.set(le,p),p+=Z,_(z,p,k(z,he,p-he)),p+=4}return _(z,p,0),p+=4,w(z,p,"IEND"),p+=4,_(z,p,k(z,p-4,4)),p+=4,z.buffer}function x(h,m,S){for(let A=0;A<h.frames.length;A++){const y=h.frames[A];y.rect.width;const k=y.rect.height,_=new Uint8Array(k*y.bpl+k);y.cimg=f(y.img,k,y.bpp,y.bpl,_,m,S)}}function o(h,m,S,A,y){const k=y[0],_=y[1],R=y[2],w=y[3],p=y[4],W=y[5];let M=6,O=8,X=255;for(var Z=0;Z<h.length;Z++){const Fe=new Uint8Array(h[Z]);for(var Q=Fe.length,B=0;B<Q;B+=4)X&=Fe[B+3]}const z=X!=255,ne=(function(ye,ge,Re,Te,ke,Ne){const Ce=[];for(var _e=0;_e<ye.length;_e++){const Ue=new Uint8Array(ye[_e]),Ie=new Uint32Array(Ue.buffer);var We;let qe=0,Ye=0,Je=ge,Xe=Re,mt=Te?1:0;if(_e!=0){const Nt=Ne||Te||_e==1||Ce[_e-2].dispose!=0?1:2;let gt=0,yt=1e9;for(let lt=0;lt<Nt;lt++){var nt=new Uint8Array(ye[_e-1-lt]);const kt=new Uint32Array(ye[_e-1-lt]);let Ve=ge,ot=Re,pt=-1,it=-1;for(let et=0;et<Re;et++)for(let ct=0;ct<ge;ct++)Ie[Me=et*ge+ct]!=kt[Me]&&(ct<Ve&&(Ve=ct),ct>pt&&(pt=ct),et<ot&&(ot=et),et>it&&(it=et));pt==-1&&(Ve=ot=pt=it=0),ke&&((1&Ve)==1&&Ve--,(1&ot)==1&&ot--);const bt=(pt-Ve+1)*(it-ot+1);bt<yt&&(yt=bt,gt=lt,qe=Ve,Ye=ot,Je=pt-Ve+1,Xe=it-ot+1)}nt=new Uint8Array(ye[_e-1-gt]),gt==1&&(Ce[_e-1].dispose=2),We=new Uint8Array(Je*Xe*4),d(nt,ge,Re,We,Je,Xe,-qe,-Ye,0),mt=d(Ue,ge,Re,We,Je,Xe,-qe,-Ye,3)?1:0,mt==1?i(Ue,ge,Re,We,{x:qe,y:Ye,width:Je,height:Xe}):d(Ue,ge,Re,We,Je,Xe,-qe,-Ye,0)}else We=Ue.slice(0);Ce.push({rect:{x:qe,y:Ye,width:Je,height:Xe},img:We,blend:mt,dispose:0})}if(Te)for(_e=0;_e<Ce.length;_e++){if((st=Ce[_e]).blend==1)continue;const Ue=st.rect,Ie=Ce[_e-1].rect,qe=Math.min(Ue.x,Ie.x),Ye=Math.min(Ue.y,Ie.y),Je={x:qe,y:Ye,width:Math.max(Ue.x+Ue.width,Ie.x+Ie.width)-qe,height:Math.max(Ue.y+Ue.height,Ie.y+Ie.height)-Ye};Ce[_e-1].dispose=1,_e-1!=0&&l(ye,ge,Re,Ce,_e-1,Je,ke),l(ye,ge,Re,Ce,_e,Je,ke)}let ht=0;if(ye.length!=1)for(var Me=0;Me<Ce.length;Me++){var st;ht+=(st=Ce[Me]).rect.width*st.rect.height}return Ce})(h,m,S,k,_,R),pe={},de=[],le=[];if(A!=0){const Fe=[];for(B=0;B<ne.length;B++)Fe.push(ne[B].img.buffer);const ye=(function(ke){let Ne=0;for(var Ce=0;Ce<ke.length;Ce++)Ne+=ke[Ce].byteLength;const _e=new Uint8Array(Ne);let We=0;for(Ce=0;Ce<ke.length;Ce++){const nt=new Uint8Array(ke[Ce]),ht=nt.length;for(let Me=0;Me<ht;Me+=4){let st=nt[Me],Ue=nt[Me+1],Ie=nt[Me+2];const qe=nt[Me+3];qe==0&&(st=Ue=Ie=0),_e[We+Me]=st,_e[We+Me+1]=Ue,_e[We+Me+2]=Ie,_e[We+Me+3]=qe}We+=ht}return _e.buffer})(Fe),ge=j(ye,A);for(B=0;B<ge.plte.length;B++)de.push(ge.plte[B].est.rgba);let Re=0;for(B=0;B<ne.length;B++){const Te=(fe=ne[B]).img.length;var he=new Uint8Array(ge.inds.buffer,Re>>2,Te>>2);le.push(he);const ke=new Uint8Array(ge.abuf,Re,Te);W&&c(fe.img,fe.rect.width,fe.rect.height,de,ke,he),fe.img.set(ke),Re+=Te}}else for(Z=0;Z<ne.length;Z++){var fe=ne[Z];const Fe=new Uint32Array(fe.img.buffer);var Le=fe.rect.width;for(Q=Fe.length,he=new Uint8Array(Q),le.push(he),B=0;B<Q;B++){const ye=Fe[B];if(B!=0&&ye==Fe[B-1])he[B]=he[B-1];else if(B>Le&&ye==Fe[B-Le])he[B]=he[B-Le];else{let ge=pe[ye];if(ge==null&&(pe[ye]=ge=de.length,de.push(ye),de.length>=300))break;he[B]=ge}}}const Ge=de.length;for(Ge<=256&&p==0&&(O=Ge<=2?1:Ge<=4?2:Ge<=16?4:8,O=Math.max(O,w)),Z=0;Z<ne.length;Z++){(fe=ne[Z]).rect.x,fe.rect.y,Le=fe.rect.width;const Fe=fe.rect.height;let ye=fe.img;new Uint32Array(ye.buffer);let ge=4*Le,Re=4;if(Ge<=256&&p==0){ge=Math.ceil(O*Le/8);var Pe=new Uint8Array(ge*Fe);const Te=le[Z];for(let ke=0;ke<Fe;ke++){B=ke*ge;const Ne=ke*Le;if(O==8)for(var be=0;be<Le;be++)Pe[B+be]=Te[Ne+be];else if(O==4)for(be=0;be<Le;be++)Pe[B+(be>>1)]|=Te[Ne+be]<<4-4*(1&be);else if(O==2)for(be=0;be<Le;be++)Pe[B+(be>>2)]|=Te[Ne+be]<<6-2*(3&be);else if(O==1)for(be=0;be<Le;be++)Pe[B+(be>>3)]|=Te[Ne+be]<<7-1*(7&be)}ye=Pe,M=3,Re=1}else if(z==0&&ne.length==1){Pe=new Uint8Array(Le*Fe*3);const Te=Le*Fe;for(B=0;B<Te;B++){const ke=3*B,Ne=4*B;Pe[ke]=ye[Ne],Pe[ke+1]=ye[Ne+1],Pe[ke+2]=ye[Ne+2]}ye=Pe,M=2,Re=3,ge=3*Le}fe.img=ye,fe.bpl=ge,fe.bpp=Re}return{ctype:M,depth:O,plte:de,frames:ne}}function l(h,m,S,A,y,k,_){const R=Uint8Array,w=Uint32Array,p=new R(h[y-1]),W=new w(h[y-1]),M=y+1<h.length?new R(h[y+1]):null,O=new R(h[y]),X=new w(O.buffer);let Z=m,Q=S,B=-1,z=-1;for(let pe=0;pe<k.height;pe++)for(let de=0;de<k.width;de++){const le=k.x+de,he=k.y+pe,fe=he*m+le,Le=X[fe];Le==0||A[y-1].dispose==0&&W[fe]==Le&&(M==null||M[4*fe+3]!=0)||(le<Z&&(Z=le),le>B&&(B=le),he<Q&&(Q=he),he>z&&(z=he))}B==-1&&(Z=Q=B=z=0),_&&((1&Z)==1&&Z--,(1&Q)==1&&Q--),k={x:Z,y:Q,width:B-Z+1,height:z-Q+1};const ne=A[y];ne.rect=k,ne.blend=1,ne.img=new Uint8Array(k.width*k.height*4),A[y-1].dispose==0?(d(p,m,S,ne.img,k.width,k.height,-k.x,-k.y,0),i(O,m,S,ne.img,k)):d(O,m,S,ne.img,k.width,k.height,-k.x,-k.y,0)}function i(h,m,S,A,y){d(h,m,S,A,y.width,y.height,-y.x,-y.y,2)}function f(h,m,S,A,y,k,_){const R=[];let w,p=[0,1,2,3,4];k!=-1?p=[k]:(m*A>5e5||S==1)&&(p=[0]),_&&(w={level:0});const W=_n;for(var M=0;M<p.length;M++){for(let Z=0;Z<m;Z++)g(y,h,Z,A,S,p[M]);R.push(W.deflate(y,w))}let O,X=1e9;for(M=0;M<R.length;M++)R[M].length<X&&(O=M,X=R[M].length);return R[O]}function g(h,m,S,A,y,k){const _=S*A;let R=_+S;if(h[R]=k,R++,k==0)if(A<500)for(var w=0;w<A;w++)h[R+w]=m[_+w];else h.set(new Uint8Array(m.buffer,_,A),R);else if(k==1){for(w=0;w<y;w++)h[R+w]=m[_+w];for(w=y;w<A;w++)h[R+w]=m[_+w]-m[_+w-y]+256&255}else if(S==0){for(w=0;w<y;w++)h[R+w]=m[_+w];if(k==2)for(w=y;w<A;w++)h[R+w]=m[_+w];if(k==3)for(w=y;w<A;w++)h[R+w]=m[_+w]-(m[_+w-y]>>1)+256&255;if(k==4)for(w=y;w<A;w++)h[R+w]=m[_+w]-r(m[_+w-y],0,0)+256&255}else{if(k==2)for(w=0;w<A;w++)h[R+w]=m[_+w]+256-m[_+w-A]&255;if(k==3){for(w=0;w<y;w++)h[R+w]=m[_+w]+256-(m[_+w-A]>>1)&255;for(w=y;w<A;w++)h[R+w]=m[_+w]+256-(m[_+w-A]+m[_+w-y]>>1)&255}if(k==4){for(w=0;w<y;w++)h[R+w]=m[_+w]+256-r(0,m[_+w-A],0)&255;for(w=y;w<A;w++)h[R+w]=m[_+w]+256-r(m[_+w-y],m[_+w-A],m[_+w-y-A])&255}}}function j(h,m){const S=new Uint8Array(h),A=S.slice(0),y=new Uint32Array(A.buffer),k=E(A,m),_=k[0],R=k[1],w=S.length,p=new Uint8Array(w>>2);let W;if(S.length<2e7)for(var M=0;M<w;M+=4)W=C(_,O=S[M]*(1/255),X=S[M+1]*(1/255),Z=S[M+2]*(1/255),Q=S[M+3]*(1/255)),p[M>>2]=W.ind,y[M>>2]=W.est.rgba;else for(M=0;M<w;M+=4){var O=S[M]*.00392156862745098,X=S[M+1]*(1/255),Z=S[M+2]*(1/255),Q=S[M+3]*(1/255);for(W=_;W.left;)W=P(W.est,O,X,Z,Q)<=0?W.left:W.right;p[M>>2]=W.ind,y[M>>2]=W.est.rgba}return{abuf:A.buffer,inds:p,plte:R}}function E(h,m,S){S==null&&(S=1e-4);const A=new Uint32Array(h.buffer),y={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};y.bst=F(h,y.i0,y.i1),y.est=v(y.bst);const k=[y];for(;k.length<m;){let R=0,w=0;for(var _=0;_<k.length;_++)k[_].est.L>R&&(R=k[_].est.L,w=_);if(R<S)break;const p=k[w],W=D(h,A,p.i0,p.i1,p.est.e,p.est.eMq255);if(p.i0>=W||p.i1<=W){p.est.L=0;continue}const M={i0:p.i0,i1:W,bst:null,est:null,tdst:0,left:null,right:null};M.bst=F(h,M.i0,M.i1),M.est=v(M.bst);const O={i0:W,i1:p.i1,bst:null,est:null,tdst:0,left:null,right:null};for(O.bst={R:[],m:[],N:p.bst.N-M.bst.N},_=0;_<16;_++)O.bst.R[_]=p.bst.R[_]-M.bst.R[_];for(_=0;_<4;_++)O.bst.m[_]=p.bst.m[_]-M.bst.m[_];O.est=v(O.bst),p.left=M,p.right=O,k[w]=M,k.push(O)}for(k.sort(((R,w)=>w.bst.N-R.bst.N)),_=0;_<k.length;_++)k[_].ind=_;return[y,k]}function C(h,m,S,A,y){if(h.left==null)return h.tdst=(function(M,O,X,Z,Q){const B=O-M[0],z=X-M[1],ne=Z-M[2],pe=Q-M[3];return B*B+z*z+ne*ne+pe*pe})(h.est.q,m,S,A,y),h;const k=P(h.est,m,S,A,y);let _=h.left,R=h.right;k>0&&(_=h.right,R=h.left);const w=C(_,m,S,A,y);if(w.tdst<=k*k)return w;const p=C(R,m,S,A,y);return p.tdst<w.tdst?p:w}function P(h,m,S,A,y){const{e:k}=h;return k[0]*m+k[1]*S+k[2]*A+k[3]*y-h.eMq}function D(h,m,S,A,y,k){for(A-=4;S<A;){for(;L(h,S,y)<=k;)S+=4;for(;L(h,A,y)>k;)A-=4;if(S>=A)break;const _=m[S>>2];m[S>>2]=m[A>>2],m[A>>2]=_,S+=4,A-=4}for(;L(h,S,y)>k;)S-=4;return S+4}function L(h,m,S){return h[m]*S[0]+h[m+1]*S[1]+h[m+2]*S[2]+h[m+3]*S[3]}function F(h,m,S){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=[0,0,0,0],k=S-m>>2;for(let _=m;_<S;_+=4){const R=h[_]*.00392156862745098,w=h[_+1]*(1/255),p=h[_+2]*(1/255),W=h[_+3]*(1/255);y[0]+=R,y[1]+=w,y[2]+=p,y[3]+=W,A[0]+=R*R,A[1]+=R*w,A[2]+=R*p,A[3]+=R*W,A[5]+=w*w,A[6]+=w*p,A[7]+=w*W,A[10]+=p*p,A[11]+=p*W,A[15]+=W*W}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:y,N:k}}function v(h){const{R:m}=h,{m:S}=h,{N:A}=h,y=S[0],k=S[1],_=S[2],R=S[3],w=A==0?0:1/A,p=[m[0]-y*y*w,m[1]-y*k*w,m[2]-y*_*w,m[3]-y*R*w,m[4]-k*y*w,m[5]-k*k*w,m[6]-k*_*w,m[7]-k*R*w,m[8]-_*y*w,m[9]-_*k*w,m[10]-_*_*w,m[11]-_*R*w,m[12]-R*y*w,m[13]-R*k*w,m[14]-R*_*w,m[15]-R*R*w],W=p,M=T;let O=[Math.random(),Math.random(),Math.random(),Math.random()],X=0,Z=0;if(A!=0)for(let B=0;B<16&&(O=M.multVec(W,O),Z=Math.sqrt(M.dot(O,O)),O=M.sml(1/Z,O),!(B!=0&&Math.abs(Z-X)<1e-9));B++)X=Z;const Q=[y*w,k*w,_*w,R*w];return{Cov:p,q:Q,e:O,L:X,eMq255:M.dot(M.sml(255,Q),O),eMq:M.dot(O,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var T={multVec:(h,m)=>[h[0]*m[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3],h[4]*m[0]+h[5]*m[1]+h[6]*m[2]+h[7]*m[3],h[8]*m[0]+h[9]*m[1]+h[10]*m[2]+h[11]*m[3],h[12]*m[0]+h[13]*m[1]+h[14]*m[2]+h[15]*m[3]],dot:(h,m)=>h[0]*m[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3],sml:(h,m)=>[h*m[0],h*m[1],h*m[2],h*m[3]]};rt.encode=function(m,S,A,y,k,_,R){y==null&&(y=0),R==null&&(R=!1);const w=o(m,S,A,y,[!1,!1,!1,0,R,!1]);return x(w,-1),b(w,S,A,k,_)},rt.encodeLL=function(m,S,A,y,k,_,R,w){const p={ctype:0+(y==1?0:2)+(k==0?0:4),depth:_,frames:[]},W=(y+k)*_,M=W*S;for(let O=0;O<m.length;O++)p.frames.push({rect:{x:0,y:0,width:S,height:A},img:new Uint8Array(m[O]),blend:0,dispose:1,bpp:Math.ceil(W/8),bpl:Math.ceil(M/8)});return x(p,0,!0),b(p,S,A,R,w)},rt.encode.compress=o,rt.encode.dither=c,rt.quantize=j,rt.quantize.getKDtree=E,rt.quantize.getNearest=C})();const Dr={toArrayBuffer(d,u){const r=d.width,t=d.height,e=r<<2,n=d.getContext("2d").getImageData(0,0,r,t),a=new Uint32Array(n.data.buffer),c=(32*r+31)/32<<2,b=c*t,x=122+b,o=new ArrayBuffer(x),l=new DataView(o),i=1<<20;let f,g,j,E,C=i,P=0,D=0,L=0;function F(h){l.setUint16(D,h,!0),D+=2}function v(h){l.setUint32(D,h,!0),D+=4}function T(h){D+=h}F(19778),v(x),T(4),v(122),v(108),v(r),v(-t>>>0),F(1),F(32),v(3),v(b),v(2835),v(2835),T(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),(function h(){for(;P<t&&C>0;){for(E=122+P*c,f=0;f<e;)C--,g=a[L++],j=g>>>24,l.setUint32(E+f,g<<8|j),f+=4;P++}L<a.length?(C=i,setTimeout(h,Dr._dly)):u(o)})()},toBlob(d,u){this.toArrayBuffer(d,(r=>{u(new Blob([r],{type:"image/bmp"}))}))},_dly:9};var Ze={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},jn={[Ze.CHROME]:16384,[Ze.FIREFOX]:11180,[Ze.DESKTOP_SAFARI]:16384,[Ze.IE]:8192,[Ze.IOS]:4096,[Ze.ETC]:8192};const rr=typeof window<"u",Pr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,It=rr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Cn=(rr||Pr)&&(It&&It.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Ir=(rr||Pr)&&(It&&It.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function nr(d,u,r=Date.now()){return new Promise((t=>{const e=d.split(","),n=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let c=a.length;const b=new Uint8Array(c);for(;c--;)b[c]=a.charCodeAt(c);const x=new Blob([b],{type:n});x.name=u,x.lastModified=r,t(x)}))}function Fr(d){return new Promise(((u,r)=>{const t=new Ir;t.onload=()=>u(t.result),t.onerror=e=>r(e),t.readAsDataURL(d)}))}function Ur(d){return new Promise(((u,r)=>{const t=new Image;t.onload=()=>u(t),t.onerror=e=>r(e),t.src=d}))}function xt(){if(xt.cachedResult!==void 0)return xt.cachedResult;let d=Ze.ETC;const{userAgent:u}=navigator;return/Chrom(e|ium)/i.test(u)?d=Ze.CHROME:/iP(ad|od|hone)/i.test(u)&&/WebKit/i.test(u)?d=Ze.IOS:/Safari/i.test(u)?d=Ze.DESKTOP_SAFARI:/Firefox/i.test(u)?d=Ze.FIREFOX:(/MSIE/i.test(u)||document.documentMode)&&(d=Ze.IE),xt.cachedResult=d,xt.cachedResult}function zr(d,u){const r=xt(),t=jn[r];let e=d,n=u,a=e*n;const c=e>n?n/e:e/n;for(;a>t*t;){const b=(t+e)/2,x=(t+n)/2;b<x?(n=x,e=x*c):(n=b*c,e=b),a=e*n}return{width:e,height:n}}function zt(d,u){let r,t;try{if(r=new OffscreenCanvas(d,u),t=r.getContext("2d"),t===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),t=r.getContext("2d")}return r.width=d,r.height=u,[r,t]}function Wr(d,u){const{width:r,height:t}=zr(d.width,d.height),[e,n]=zt(r,t);return u&&/jpe?g/.test(u)&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height)),n.drawImage(d,0,0,e.width,e.height),e}function Dt(){return Dt.cachedResult!==void 0||(Dt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Dt.cachedResult}function Ft(d,u={}){return new Promise((function(r,t){let e,n;var a=function(){try{return n=Wr(e,u.fileType||d.type),r([e,n])}catch(b){return t(b)}},c=function(b){try{var x=function(o){try{throw o}catch(l){return t(l)}};try{let o;return Fr(d).then((function(l){try{return o=l,Ur(o).then((function(i){try{return e=i,(function(){try{return a()}catch(f){return t(f)}})()}catch(f){return x(f)}}),x)}catch(i){return x(i)}}),x)}catch(o){x(o)}}catch(o){return t(o)}};try{if(Dt()||[Ze.DESKTOP_SAFARI,Ze.MOBILE_SAFARI].includes(xt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(d).then((function(b){try{return e=b,a()}catch{return c()}}),c)}catch{c()}}))}function Ut(d,u,r,t,e=1){return new Promise((function(n,a){let c;if(u==="image/png"){let x,o,l;return x=d.getContext("2d"),{data:o}=x.getImageData(0,0,d.width,d.height),l=rt.encode([o.buffer],d.width,d.height,4096*e),c=new Blob([l],{type:u}),c.name=r,c.lastModified=t,b.call(this)}{let x=function(){return b.call(this)};if(u==="image/bmp")return new Promise((o=>Dr.toBlob(d,o))).then((function(o){try{return c=o,c.name=r,c.lastModified=t,x.call(this)}catch(l){return a(l)}}).bind(this),a);{let o=function(){return x.call(this)};if(typeof OffscreenCanvas=="function"&&d instanceof OffscreenCanvas)return d.convertToBlob({type:u,quality:e}).then((function(l){try{return c=l,c.name=r,c.lastModified=t,o.call(this)}catch(i){return a(i)}}).bind(this),a);{let l;return l=d.toDataURL(u,e),nr(l,r,t).then((function(i){try{return c=i,o.call(this)}catch(f){return a(f)}}).bind(this),a)}}}function b(){return n(c)}}))}function at(d){d.width=0,d.height=0}function wt(){return new Promise((function(d,u){let r,t,e,n;return wt.cachedResult!==void 0?d(wt.cachedResult):nr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(a){try{return r=a,Ft(r).then((function(c){try{return t=c[1],Ut(t,r.type,r.name,r.lastModified).then((function(b){try{return e=b,at(t),Ft(e).then((function(x){try{return n=x[0],wt.cachedResult=n.width===1&&n.height===2,d(wt.cachedResult)}catch(o){return u(o)}}),u)}catch(x){return u(x)}}),u)}catch(b){return u(b)}}),u)}catch(c){return u(c)}}),u)}))}function Or(d){return new Promise(((u,r)=>{const t=new Ir;t.onload=e=>{const n=new DataView(e.target.result);if(n.getUint16(0,!1)!=65496)return u(-2);const a=n.byteLength;let c=2;for(;c<a;){if(n.getUint16(c+2,!1)<=8)return u(-1);const b=n.getUint16(c,!1);if(c+=2,b==65505){if(n.getUint32(c+=2,!1)!=1165519206)return u(-1);const x=n.getUint16(c+=6,!1)==18761;c+=n.getUint32(c+4,x);const o=n.getUint16(c,x);c+=2;for(let l=0;l<o;l++)if(n.getUint16(c+12*l,x)==274)return u(n.getUint16(c+12*l+8,x))}else{if((65280&b)!=65280)break;c+=n.getUint16(c,!1)}}return u(-1)},t.onerror=e=>r(e),t.readAsArrayBuffer(d)}))}function $r(d,u){const{width:r}=d,{height:t}=d,{maxWidthOrHeight:e}=u;let n,a=d;return isFinite(e)&&(r>e||t>e)&&([a,n]=zt(r,t),r>t?(a.width=e,a.height=t/r*e):(a.width=r/t*e,a.height=e),n.drawImage(d,0,0,a.width,a.height),at(d)),a}function Hr(d,u){const{width:r}=d,{height:t}=d,[e,n]=zt(r,t);switch(u>4&&u<9?(e.width=t,e.height=r):(e.width=r,e.height=t),u){case 2:n.transform(-1,0,0,1,r,0);break;case 3:n.transform(-1,0,0,-1,r,t);break;case 4:n.transform(1,0,0,-1,0,t);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,t,0);break;case 7:n.transform(0,-1,-1,0,t,r);break;case 8:n.transform(0,-1,1,0,0,r)}return n.drawImage(d,0,0,r,t),at(d),e}function xr(d,u,r=0){return new Promise((function(t,e){let n,a,c,b,x,o,l,i,f,g,j,E,C,P,D,L,F,v,T,h;function m(A=5){if(u.signal&&u.signal.aborted)throw u.signal.reason;n+=A,u.onProgress(Math.min(n,100))}function S(A){if(u.signal&&u.signal.aborted)throw u.signal.reason;n=Math.min(Math.max(A,n),100),u.onProgress(n)}return n=r,a=u.maxIteration||10,c=1024*u.maxSizeMB*1024,m(),Ft(d,u).then((function(A){try{return[,b]=A,m(),x=$r(b,u),m(),new Promise((function(y,k){var _;if(!(_=u.exifOrientation))return Or(d).then((function(w){try{return _=w,R.call(this)}catch(p){return k(p)}}).bind(this),k);function R(){return y(_)}return R.call(this)})).then((function(y){try{return o=y,m(),wt().then((function(k){try{return l=k?x:Hr(x,o),m(),i=u.initialQuality||1,f=u.fileType||d.type,Ut(l,f,d.name,d.lastModified,i).then((function(_){try{{let w=function(){if(a--&&(D>c||D>C)){let W,M;return W=h?.95*T.width:T.width,M=h?.95*T.height:T.height,[F,v]=zt(W,M),v.drawImage(T,0,0,W,M),i*=f==="image/png"?.85:.95,Ut(F,f,d.name,d.lastModified,i).then((function(O){try{return L=O,at(T),T=F,D=L.size,S(Math.min(99,Math.floor((P-D)/(P-c)*100))),w}catch(X){return e(X)}}),e)}return[1]},p=function(){return at(T),at(F),at(x),at(l),at(b),S(100),t(L)};if(g=_,m(),j=g.size>c,E=g.size>d.size,!j&&!E)return S(100),t(g);var R;return C=d.size,P=g.size,D=P,T=l,h=!u.alwaysKeepResolution&&j,(R=(function(W){for(;W;){if(W.then)return void W.then(R,e);try{if(W.pop){if(W.length)return W.pop()?p.call(this):W;W=w}else W=W.call(this)}catch(M){return e(M)}}}).bind(this))(w)}}catch(w){return e(w)}}).bind(this),e)}catch(_){return e(_)}}).bind(this),e)}catch(k){return e(k)}}).bind(this),e)}catch(y){return e(y)}}).bind(this),e)}))}const Sn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let qt;function Nn(d,u){return new Promise(((r,t)=>{qt||(qt=(function(a){const c=[];return c.push(a),URL.createObjectURL(new Blob(c))})(Sn));const e=new Worker(qt);e.addEventListener("message",(function(a){if(u.signal&&u.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return t(new Error(a.data.error)),void e.terminate();r(a.data.file),e.terminate()}else u.onProgress(a.data.progress)})),e.addEventListener("error",t),u.signal&&u.signal.addEventListener("abort",(()=>{t(u.signal.reason),e.terminate()})),e.postMessage({file:d,imageCompressionLibUrl:u.libURL,options:{...u,onProgress:void 0,signal:void 0}})}))}function Be(d,u){return new Promise((function(r,t){let e,n,a,c,b,x;if(e={...u},a=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=f=>{a=f,typeof c=="function"&&c(a)},!(d instanceof Blob||d instanceof Cn))return t(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(d.type))return t(new Error("The file given is not an image"));if(x=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||x)return xr(d,e).then((function(f){try{return n=f,i.call(this)}catch(g){return t(g)}}).bind(this),t);var o=(function(){try{return i.call(this)}catch(f){return t(f)}}).bind(this),l=function(f){try{return xr(d,e).then((function(g){try{return n=g,o()}catch(j){return t(j)}}),t)}catch(g){return t(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Nn(d,e).then((function(f){try{return n=f,o()}catch{return l()}}),l)}catch{l()}function i(){try{n.name=d.name,n.lastModified=d.lastModified}catch{}try{e.preserveExif&&d.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===d.type)&&(n=Mr(d,n))}catch{}return r(n)}}))}Be.getDataUrlFromFile=Fr,Be.getFilefromDataUrl=nr,Be.loadImage=Ur,Be.drawImageInCanvas=Wr,Be.drawFileInCanvas=Ft,Be.canvasToFile=Ut,Be.getExifOrientation=Or,Be.handleMaxWidthOrHeight=$r,Be.followExifOrientation=Hr,Be.cleanupCanvasMemory=at,Be.isAutoOrientationInBrowser=wt,Be.approximateBelowMaximumCanvasSizeOfBrowser=zr,Be.copyExifWithoutOrientation=Mr,Be.getBrowserName=xt,Be.version="2.0.2";var tr=function(d,u){return tr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])},tr(d,u)};function kn(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");tr(d,u);function r(){this.constructor=d}d.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}var ze=function(){return ze=Object.assign||function(u){for(var r,t=1,e=arguments.length;t<e;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(u[n]=r[n])}return u},ze.apply(this,arguments)};var Vt,br;function An(){if(br)return Vt;br=1;var d=!1,u,r,t,e,n,a,c,b,x,o,l,i,f,g,j;function E(){if(!d){d=!0;var P=navigator.userAgent,D=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(P),L=/(Mac OS X)|(Windows)|(Linux)/.exec(P);if(i=/\b(iPhone|iP[ao]d)/.exec(P),f=/\b(iP[ao]d)/.exec(P),o=/Android/i.exec(P),g=/FBAN\/\w+;/i.exec(P),j=/Mobile/i.exec(P),l=!!/Win64/.exec(P),D){u=D[1]?parseFloat(D[1]):D[5]?parseFloat(D[5]):NaN,u&&document&&document.documentMode&&(u=document.documentMode);var F=/(?:Trident\/(\d+.\d+))/.exec(P);a=F?parseFloat(F[1])+4:u,r=D[2]?parseFloat(D[2]):NaN,t=D[3]?parseFloat(D[3]):NaN,e=D[4]?parseFloat(D[4]):NaN,e?(D=/(?:Chrome\/(\d+\.\d+))/.exec(P),n=D&&D[1]?parseFloat(D[1]):NaN):n=NaN}else u=r=t=n=e=NaN;if(L){if(L[1]){var v=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(P);c=v?parseFloat(v[1].replace("_",".")):!0}else c=!1;b=!!L[2],x=!!L[3]}else c=b=x=!1}}var C={ie:function(){return E()||u},ieCompatibilityMode:function(){return E()||a>u},ie64:function(){return C.ie()&&l},firefox:function(){return E()||r},opera:function(){return E()||t},webkit:function(){return E()||e},safari:function(){return C.webkit()},chrome:function(){return E()||n},windows:function(){return E()||b},osx:function(){return E()||c},linux:function(){return E()||x},iphone:function(){return E()||i},mobile:function(){return E()||i||f||o||j},nativeApp:function(){return E()||g},android:function(){return E()||o},ipad:function(){return E()||f}};return Vt=C,Vt}var Zt,wr;function En(){if(wr)return Zt;wr=1;var d=!!(typeof window<"u"&&window.document&&window.document.createElement),u={canUseDOM:d,canUseWorkers:typeof Worker<"u",canUseEventListeners:d&&!!(window.addEventListener||window.attachEvent),canUseViewport:d&&!!window.screen,isInWorker:!d};return Zt=u,Zt}var Yt,vr;function Ln(){if(vr)return Yt;vr=1;var d=En(),u;d.canUseDOM&&(u=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function r(t,e){if(!d.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,a=n in document;if(!a){var c=document.createElement("div");c.setAttribute(n,"return;"),a=typeof c[n]=="function"}return!a&&u&&t==="wheel"&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}return Yt=r,Yt}var Kt,yr;function Rn(){if(yr)return Kt;yr=1;var d=An(),u=Ln(),r=10,t=40,e=800;function n(a){var c=0,b=0,x=0,o=0;return"detail"in a&&(b=a.detail),"wheelDelta"in a&&(b=-a.wheelDelta/120),"wheelDeltaY"in a&&(b=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(c=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(c=b,b=0),x=c*r,o=b*r,"deltaY"in a&&(o=a.deltaY),"deltaX"in a&&(x=a.deltaX),(x||o)&&a.deltaMode&&(a.deltaMode==1?(x*=t,o*=t):(x*=e,o*=e)),x&&!c&&(c=x<1?-1:1),o&&!b&&(b=o<1?-1:1),{spinX:c,spinY:b,pixelX:x,pixelY:o}}return n.getEventType=function(){return d.firefox()?"DOMMouseScroll":u("wheel")?"wheel":"mousewheel"},Kt=n,Kt}var Jt,_r;function Tn(){return _r||(_r=1,Jt=Rn()),Jt}var Mn=Tn();const Dn=un(Mn);function Pn(d,u,r,t,e,n){n===void 0&&(n=0);var a=vt(d,u,n),c=a.width,b=a.height,x=Math.min(c,r),o=Math.min(b,t);return x>o*e?{width:o*e,height:o}:{width:x,height:x/e}}function In(d){return d.width>d.height?d.width/d.naturalWidth:d.height/d.naturalHeight}function St(d,u,r,t,e){e===void 0&&(e=0);var n=vt(u.width,u.height,e),a=n.width,c=n.height;return{x:jr(d.x,a,r.width,t),y:jr(d.y,c,r.height,t)}}function jr(d,u,r,t){var e=u*t/2-r/2;return Wt(d,-e,e)}function Cr(d,u){return Math.sqrt(Math.pow(d.y-u.y,2)+Math.pow(d.x-u.x,2))}function Sr(d,u){return Math.atan2(u.y-d.y,u.x-d.x)*180/Math.PI}function Fn(d,u,r,t,e,n,a){n===void 0&&(n=0),a===void 0&&(a=!0);var c=a?Un:zn,b=vt(u.width,u.height,n),x=vt(u.naturalWidth,u.naturalHeight,n),o={x:c(100,((b.width-r.width/e)/2-d.x/e)/b.width*100),y:c(100,((b.height-r.height/e)/2-d.y/e)/b.height*100),width:c(100,r.width/b.width*100/e),height:c(100,r.height/b.height*100/e)},l=Math.round(c(x.width,o.width*x.width/100)),i=Math.round(c(x.height,o.height*x.height/100)),f=x.width>=x.height*t,g=f?{width:Math.round(i*t),height:i}:{width:l,height:Math.round(l/t)},j=ze(ze({},g),{x:Math.round(c(x.width-g.width,o.x*x.width/100)),y:Math.round(c(x.height-g.height,o.y*x.height/100))});return{croppedAreaPercentages:o,croppedAreaPixels:j}}function Un(d,u){return Math.min(d,Math.max(0,u))}function zn(d,u){return u}function Wn(d,u,r,t,e,n){var a=vt(u.width,u.height,r),c=Wt(t.width/a.width*(100/d.width),e,n),b={x:c*a.width/2-t.width/2-a.width*c*(d.x/100),y:c*a.height/2-t.height/2-a.height*c*(d.y/100)};return{crop:b,zoom:c}}function On(d,u,r){var t=In(u);return r.height>r.width?r.height/(d.height*t):r.width/(d.width*t)}function $n(d,u,r,t,e,n){r===void 0&&(r=0);var a=vt(u.naturalWidth,u.naturalHeight,r),c=Wt(On(d,u,t),e,n),b=t.height>t.width?t.height/d.height:t.width/d.width,x={x:((a.width-d.width)/2-d.x)*b,y:((a.height-d.height)/2-d.y)*b};return{crop:x,zoom:c}}function Nr(d,u){return{x:(u.x+d.x)/2,y:(u.y+d.y)/2}}function Hn(d){return d*Math.PI/180}function vt(d,u,r){var t=Hn(r);return{width:Math.abs(Math.cos(t)*d)+Math.abs(Math.sin(t)*u),height:Math.abs(Math.sin(t)*d)+Math.abs(Math.cos(t)*u)}}function Wt(d,u,r){return Math.min(Math.max(d,u),r)}function Rt(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return d.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var Bn=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Gn=1,qn=3,Vn=1,Zn=(function(d){kn(u,d);function u(){var r=d!==null&&d.apply(this,arguments)||this;return r.cropperRef=I.createRef(),r.imageRef=I.createRef(),r.videoRef=I.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var t=!0;r.resizeObserver=new window.ResizeObserver(function(e){if(t){t=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(t){return t.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var t=r.computeSizes();t&&(r.previousCropSize=t,r.emitCropData(),r.setInitialCrop(t),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(t){if(r.props.initialCroppedAreaPercentages){var e=Wn(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,t,r.props.minZoom,r.props.maxZoom),n=e.crop,a=e.zoom;r.props.onCropChange(n),r.props.onZoomChange&&r.props.onZoomChange(a)}else if(r.props.initialCroppedAreaPixels){var c=$n(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,t,r.props.minZoom,r.props.maxZoom),n=c.crop,a=c.zoom;r.props.onCropChange(n),r.props.onZoomChange&&r.props.onZoomChange(a)}},r.computeSizes=function(){var t,e,n,a,c,b,x=r.imageRef.current||r.videoRef.current;if(x&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var o=r.containerRect.width/r.containerRect.height,l=((t=r.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((e=r.videoRef.current)===null||e===void 0?void 0:e.videoWidth)||0,i=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalHeight)||((a=r.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,f=x.offsetWidth<l||x.offsetHeight<i,g=l/i,j=void 0;if(f)switch(r.state.mediaObjectFit){default:case"contain":j=o>g?{width:r.containerRect.height*g,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/g};break;case"horizontal-cover":j={width:r.containerRect.width,height:r.containerRect.width/g};break;case"vertical-cover":j={width:r.containerRect.height*g,height:r.containerRect.height};break}else j={width:x.offsetWidth,height:x.offsetHeight};r.mediaSize=ze(ze({},j),{naturalWidth:l,naturalHeight:i}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var E=r.props.cropSize?r.props.cropSize:Pn(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((c=r.state.cropSize)===null||c===void 0?void 0:c.height)!==E.height||((b=r.state.cropSize)===null||b===void 0?void 0:b.width)!==E.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(E),r.setState({cropSize:E},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(E),E}},r.saveContainerPosition=function(){if(r.containerRef){var t=r.containerRef.getBoundingClientRect();r.containerPosition={x:t.left,y:t.top}}},r.onMouseDown=function(t){r.currentDoc&&(t.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(u.getMousePoint(t)))},r.onMouseMove=function(t){return r.onDrag(u.getMousePoint(t))},r.onScroll=function(t){r.currentDoc&&(t.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(t){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(t))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),t.touches.length===2?r.onPinchStart(t):t.touches.length===1&&r.onDragStart(u.getTouchPoint(t.touches[0]))))},r.onTouchMove=function(t){t.preventDefault(),t.touches.length===2?r.onPinchMove(t):t.touches.length===1&&r.onDrag(u.getTouchPoint(t.touches[0]))},r.onGestureStart=function(t){r.currentDoc&&(t.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(t){if(t.preventDefault(),!r.isTouching){var e=u.getMousePoint(t),n=r.gestureZoomStart-1+t.scale;if(r.setNewZoom(n,e,{shouldUpdatePosition:!0}),r.props.onRotationChange){var a=r.gestureRotationStart+t.rotation;r.props.onRotationChange(a)}}},r.onGestureEnd=function(t){r.cleanEvents()},r.onDragStart=function(t){var e,n,a=t.x,c=t.y;r.dragStartPosition={x:a,y:c},r.dragStartCrop=ze({},r.props.crop),(n=(e=r.props).onInteractionStart)===null||n===void 0||n.call(e)},r.onDrag=function(t){var e=t.x,n=t.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(e===void 0||n===void 0)){var a=e-r.dragStartPosition.x,c=n-r.dragStartPosition.y,b={x:r.dragStartCrop.x+a,y:r.dragStartCrop.y+c},x=r.props.restrictPosition?St(b,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):b;r.props.onCropChange(x)}}))},r.onDragStopped=function(){var t,e;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(e=(t=r.props).onInteractionEnd)===null||e===void 0||e.call(t)},r.onWheel=function(t){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(t))){t.preventDefault();var e=u.getMousePoint(t),n=Dn(t).pixelY,a=r.props.zoom-n*r.props.zoomSpeed/200;r.setNewZoom(a,e,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var c,b;return(b=(c=r.props).onInteractionStart)===null||b===void 0?void 0:b.call(c)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var c,b;return(b=(c=r.props).onInteractionEnd)===null||b===void 0?void 0:b.call(c)})},250)}},r.getPointOnContainer=function(t,e){var n=t.x,a=t.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(n-e.x),y:r.containerRect.height/2-(a-e.y)}},r.getPointOnMedia=function(t){var e=t.x,n=t.y,a=r.props,c=a.crop,b=a.zoom;return{x:(e+c.x)/b,y:(n+c.y)/b}},r.setNewZoom=function(t,e,n){var a=n===void 0?{}:n,c=a.shouldUpdatePosition,b=c===void 0?!0:c;if(!(!r.state.cropSize||!r.props.onZoomChange)){var x=Wt(t,r.props.minZoom,r.props.maxZoom);if(b){var o=r.getPointOnContainer(e,r.containerPosition),l=r.getPointOnMedia(o),i={x:l.x*x-o.x,y:l.y*x-o.y},f=r.props.restrictPosition?St(i,r.mediaSize,r.state.cropSize,x,r.props.rotation):i;r.props.onCropChange(f)}r.props.onZoomChange(x)}},r.getCropData=function(){if(!r.state.cropSize)return null;var t=r.props.restrictPosition?St(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return Fn(t,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var t=r.getCropData();if(t){var e=t.croppedAreaPercentages,n=t.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(e,n),r.props.onCropAreaChange&&r.props.onCropAreaChange(e,n)}},r.emitCropAreaChange=function(){var t=r.getCropData();if(t){var e=t.croppedAreaPercentages,n=t.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(e,n)}},r.recomputeCropPosition=function(){var t,e;if(r.state.cropSize){var n=r.props.crop;if(r.isInitialized&&(!((t=r.previousCropSize)===null||t===void 0)&&t.width)&&(!((e=r.previousCropSize)===null||e===void 0)&&e.height)){var a=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(a){var c=r.state.cropSize.width/r.previousCropSize.width,b=r.state.cropSize.height/r.previousCropSize.height;n={x:r.props.crop.x*c,y:r.props.crop.y*b}}}var x=r.props.restrictPosition?St(n,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):n;r.previousCropSize=r.state.cropSize,r.props.onCropChange(x),r.emitCropData()}},r.onKeyDown=function(t){var e,n,a=r.props,c=a.crop,b=a.onCropChange,x=a.keyboardStep,o=a.zoom,l=a.rotation,i=x;if(r.state.cropSize){t.shiftKey&&(i*=.2);var f=ze({},c);switch(t.key){case"ArrowUp":f.y-=i,t.preventDefault();break;case"ArrowDown":f.y+=i,t.preventDefault();break;case"ArrowLeft":f.x-=i,t.preventDefault();break;case"ArrowRight":f.x+=i,t.preventDefault();break;default:return}r.props.restrictPosition&&(f=St(f,r.mediaSize,r.state.cropSize,o,l)),t.repeat||(n=(e=r.props).onInteractionStart)===null||n===void 0||n.call(e),b(f)}},r.onKeyUp=function(t){var e,n;switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":t.preventDefault();break;default:return}r.emitCropData(),(n=(e=r.props).onInteractionEnd)===null||n===void 0||n.call(e)},r}return u.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Bn,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},u.prototype.componentWillUnmount=function(){var r,t;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((t=this.styleRef.parentNode)===null||t===void 0||t.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},u.prototype.componentDidUpdate=function(r){var t,e,n,a,c,b,x,o,l;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((t=r.cropSize)===null||t===void 0?void 0:t.height)!==((e=this.props.cropSize)===null||e===void 0?void 0:e.height)||((n=r.cropSize)===null||n===void 0?void 0:n.width)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.width)?this.computeSizes():(((c=r.crop)===null||c===void 0?void 0:c.x)!==((b=this.props.crop)===null||b===void 0?void 0:b.x)||((x=r.crop)===null||x===void 0?void 0:x.y)!==((o=this.props.crop)===null||o===void 0?void 0:o.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((l=this.videoRef.current)===null||l===void 0||l.load());var i=this.getObjectFit();i!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:i},this.computeSizes)},u.prototype.getAspect=function(){var r=this.props,t=r.cropSize,e=r.aspect;return t?t.width/t.height:e},u.prototype.getObjectFit=function(){var r,t,e,n;if(this.props.objectFit==="cover"){var a=this.imageRef.current||this.videoRef.current;if(a&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var c=this.containerRect.width/this.containerRect.height,b=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((t=this.videoRef.current)===null||t===void 0?void 0:t.videoWidth)||0,x=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalHeight)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoHeight)||0,o=b/x;return o<c?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},u.prototype.onPinchStart=function(r){var t=u.getTouchPoint(r.touches[0]),e=u.getTouchPoint(r.touches[1]);this.lastPinchDistance=Cr(t,e),this.lastPinchRotation=Sr(t,e),this.onDragStart(Nr(t,e))},u.prototype.onPinchMove=function(r){var t=this;if(!(!this.currentDoc||!this.currentWindow)){var e=u.getTouchPoint(r.touches[0]),n=u.getTouchPoint(r.touches[1]),a=Nr(e,n);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var c=Cr(e,n),b=t.props.zoom*(c/t.lastPinchDistance);t.setNewZoom(b,a,{shouldUpdatePosition:!1}),t.lastPinchDistance=c;var x=Sr(e,n),o=t.props.rotation+(x-t.lastPinchRotation);t.props.onRotationChange&&t.props.onRotationChange(o),t.lastPinchRotation=x})}},u.prototype.render=function(){var r=this,t,e=this.props,n=e.image,a=e.video,c=e.mediaProps,b=e.cropperProps,x=e.transform,o=e.crop,l=o.x,i=o.y,f=e.rotation,g=e.zoom,j=e.cropShape,E=e.showGrid,C=e.roundCropAreaPixels,P=e.style,D=P.containerStyle,L=P.cropAreaStyle,F=P.mediaStyle,v=e.classes,T=v.containerClassName,h=v.cropAreaClassName,m=v.mediaClassName,S=(t=this.state.mediaObjectFit)!==null&&t!==void 0?t:this.getObjectFit();return I.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(y){return r.containerRef=y},"data-testid":"container",style:D,className:Rt("reactEasyCrop_Container",T)},n?I.createElement("img",ze({alt:"",className:Rt("reactEasyCrop_Image",S==="contain"&&"reactEasyCrop_Contain",S==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",S==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},c,{src:n,ref:this.imageRef,style:ze(ze({},F),{transform:x||"translate(".concat(l,"px, ").concat(i,"px) rotate(").concat(f,"deg) scale(").concat(g,")")}),onLoad:this.onMediaLoad})):a&&I.createElement("video",ze({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:Rt("reactEasyCrop_Video",S==="contain"&&"reactEasyCrop_Contain",S==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",S==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",m)},c,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:ze(ze({},F),{transform:x||"translate(".concat(l,"px, ").concat(i,"px) rotate(").concat(f,"deg) scale(").concat(g,")")}),controls:!1}),(Array.isArray(a)?a:[{src:a}]).map(function(A){return I.createElement("source",ze({key:A.src},A))})),this.state.cropSize&&I.createElement("div",ze({ref:this.cropperRef,style:ze(ze({},L),{width:C?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:C?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:Rt("reactEasyCrop_CropArea",j==="round"&&"reactEasyCrop_CropAreaRound",E&&"reactEasyCrop_CropAreaGrid",h)},b)))},u.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:qn,minZoom:Gn,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:Vn},u.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},u})(I.Component);const $e=[];for(let d=0;d<256;++d)$e.push((d+256).toString(16).slice(1));function Yn(d,u=0){return($e[d[u+0]]+$e[d[u+1]]+$e[d[u+2]]+$e[d[u+3]]+"-"+$e[d[u+4]]+$e[d[u+5]]+"-"+$e[d[u+6]]+$e[d[u+7]]+"-"+$e[d[u+8]]+$e[d[u+9]]+"-"+$e[d[u+10]]+$e[d[u+11]]+$e[d[u+12]]+$e[d[u+13]]+$e[d[u+14]]+$e[d[u+15]]).toLowerCase()}let Qt;const Kn=new Uint8Array(16);function Jn(){if(!Qt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Qt=crypto.getRandomValues.bind(crypto)}return Qt(Kn)}const Qn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),kr={randomUUID:Qn};function Xn(d,u,r){d=d||{};const t=d.random??d.rng?.()??Jn();if(t.length<16)throw new Error("Random bytes length must be >= 16");return t[6]=t[6]&15|64,t[8]=t[8]&63|128,Yn(t)}function es(d,u,r){return kr.randomUUID&&!d?kr.randomUUID():Xn(d)}const Ar=50,Xt=d=>({id:d.id,league_id:d.league_id,user_id:d.user_id,content:d.content,created_at:d.created_at??new Date().toISOString(),status:"sent"}),Tt=d=>{const u=new Map;for(const r of d)u.set(r.id,r);return Array.from(u.values()).sort((r,t)=>new Date(r.created_at).getTime()-new Date(t.created_at).getTime())};function ts(d,u={}){const{userId:r,enabled:t=!0,autoSubscribe:e=!0}=u,[n,a]=I.useState([]),[c,b]=I.useState(!1),[x,o]=I.useState(!1),[l,i]=I.useState(!0),[f,g]=I.useState(null),j=I.useRef(null),E=I.useCallback(v=>{a(T=>{const h=v(T);return j.current=h.length?h[0].created_at:null,h})},[]),C=I.useCallback(async({before:v,append:T})=>{if(!d||!t)return;const h=se.from("league_messages").select("id, league_id, user_id, content, created_at").eq("league_id",d).order("created_at",{ascending:!1}).limit(Ar);v&&h.lt("created_at",v);const{data:m,error:S}=await h;if(S)throw S;const A=(m??[]).map(Xt).reverse();E(y=>Tt(T?[...A,...y]:A)),(m??[]).length<Ar?i(!1):T||i(!0)},[d,t,E]),P=I.useCallback(async()=>{if(!d||!t){a([]),i(!0);return}b(!0),g(null),j.current=null;try{await C({append:!1})}catch(v){g(v?.message??"Failed to load chat")}finally{b(!1)}},[d,t,C]);I.useEffect(()=>{if(!d||!t){a([]),i(!0);return}let v=!0;if(P(),!e)return()=>{v=!1};const T=se.channel(`league-messages:${d}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${d}`},h=>{if(!v)return;const m=Xt(h.new);E(S=>S.some(A=>A.id===m.id)?S:Tt([...S,m]))}).subscribe();return()=>{v=!1,se.removeChannel(T)}},[d,t,e,P,E]);const D=I.useCallback(async()=>{if(!d||!t||!l||x)return;const v=j.current??n[0]?.created_at;if(v){o(!0);try{await C({before:v,append:!0})}catch(T){g(T?.message??"Failed to load more messages")}finally{o(!1)}}},[d,t,l,x,C,n]),L=I.useCallback(async v=>{if(!d||!r)throw new Error("Missing league or user");const T=v.trim();if(!T)return;const h=es(),m=`optimistic-${h}`,S={id:m,client_msg_id:h,league_id:d,user_id:r,content:T,created_at:new Date().toISOString(),status:"sending"};E(k=>Tt([...k,S]));const{data:A,error:y}=await se.from("league_messages").insert({league_id:d,user_id:r,content:T}).select("id, league_id, user_id, content, created_at").single();if(y)throw E(k=>k.map(_=>_.id===m?{..._,status:"error"}:_)),y;if(A){const k=Xt(A);k.client_msg_id=h,E(_=>_.map(R=>R.id===m?{...k,status:"sent",client_msg_id:h}:R))}},[d,r,E]),F=I.useMemo(()=>n.slice(-5),[n]);return{messages:n,previewMessages:F,loading:c,loadingMore:x,hasMore:l,error:f,refresh:P,loadMore:D,sendMessage:L}}const rs={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",middle:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[4px]",bottom:"rounded-tl-[4px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]"},ns={single:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[12px] rounded-bl-[12px]",top:"rounded-tl-[12px] rounded-tr-[12px] rounded-br-[4px] rounded-bl-[12px]",middle:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[4px] rounded-bl-[12px]",bottom:"rounded-tl-[12px] rounded-tr-[4px] rounded-br-[12px] rounded-bl-[12px]"};function Br({author:d,text:u,time:r,isOwnMessage:t,shape:e="single"}){const n=t?"text-right":"text-left",a=t?"bg-[#1C8376] text-white":"bg-white text-slate-900",c=t?ns:rs;return s.jsxs("div",{className:`inline-block w-fit px-3 py-2 text-sm leading-snug shadow-sm max-w-[70%] whitespace-normal break-words ${n} ${a} ${c[e]}`,children:[d&&!t&&s.jsx("div",{className:"text-[11px] font-semibold text-slate-600 mb-1",children:d}),s.jsx("div",{children:u}),s.jsx("div",{className:"text-[11px] text-[#DCDCDD] mt-1",children:r})]})}function ss({author:d,messages:u,isOwnMessage:r,avatarInitials:t}){const e=r?"justify-end":"justify-start";return s.jsxs("div",{className:`flex items-end gap-3 w-full ${e}`,children:[r?s.jsx("div",{className:"w-8 flex-shrink-0"}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-[13px] font-semibold text-slate-500 flex-shrink-0",children:(t||d.charAt(0)).toUpperCase()}),s.jsx("div",{className:"flex flex-col gap-1 flex-1",children:u.map((n,a)=>{const c=u.length===1?"single":a===0?"top":a===u.length-1?"bottom":"middle";return s.jsxs("div",{className:`flex w-full ${r?"justify-end":"justify-start"}`,children:[s.jsx(Br,{author:!r&&a===0?d:void 0,text:n.text,time:n.time,isOwnMessage:r,shape:c}),n.status&&s.jsx("div",{className:`text-[11px] ml-2 ${n.status==="error"?"text-red-500":"text-slate-400"}`,children:n.status==="error"?"Failed":"Sending"})]},n.id)})})]})}function os({groups:d}){return s.jsx("div",{className:"flex flex-col gap-5",children:d.map(u=>s.jsxs("div",{className:"flex flex-col gap-3",children:[u.dayLabel&&s.jsx("div",{className:"text-center text-xs uppercase tracking-wide text-slate-400",children:u.dayLabel}),s.jsx(ss,{author:u.author,avatarInitials:u.avatarInitials,isOwnMessage:u.isOwnMessage,messages:u.messages})]},u.id))})}const is=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),as=d=>new Date(d).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),ls=d=>{const u=d.trim().split(/\s+/);return u.length===1?u[0][0]?.toUpperCase()??"?":`${u[0][0]?.toUpperCase()??""}${u[u.length-1][0]?.toUpperCase()??""}`},cs=(d,u)=>u?u instanceof Map?u.get(d)??"":u[d]??"":"";function ds({miniLeagueId:d,memberNames:u}){const{user:r}=Tr(),{messages:t,loading:e,loadingMore:n,hasMore:a,error:c,loadMore:b,sendMessage:x}=ts(d,{userId:r?.id,enabled:!!d}),[o,l]=I.useState(""),[i,f]=I.useState(!1),g=I.useRef(null),j=I.useRef(null),E=I.useRef(null),[C,P]=I.useState(0),D=I.useCallback(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[]),L=I.useCallback((y=[0,100,300,500,700])=>{requestAnimationFrame(()=>{y.forEach(k=>{setTimeout(()=>D(),k)})})},[D]);I.useEffect(()=>{t.length>0&&L([0,150,300])},[t.length,L]),I.useEffect(()=>{!o&&j.current&&(j.current.style.height="auto",j.current.style.height="42px")},[o]);const F=I.useCallback((y,k=[0,100,300,500,700])=>{if(y>0){if(P(y),g.current){const _=Math.max(y+(j.current?.offsetHeight||0)+16,80);g.current.style.paddingBottom=`${_}px`}}else P(0),g.current&&(g.current.style.paddingBottom="");L(k)},[L]);I.useEffect(()=>{const y=window.visualViewport;if(!y)return;let k=null,_=0;const R=()=>{k&&(clearTimeout(k),k=null),k=setTimeout(()=>{const W=window.innerHeight,M=y.height,O=y.offsetTop+M,X=W-O;Math.abs(X-_)<10&&X>0||(_=X,F(X))},50)};y.addEventListener("resize",R),y.addEventListener("scroll",R);const w=()=>{setTimeout(R,100),setTimeout(R,300)},p=setTimeout(()=>{j.current&&j.current.addEventListener("focus",w)},100);return R(),()=>{k&&clearTimeout(k),clearTimeout(p),y.removeEventListener("resize",R),y.removeEventListener("scroll",R),j.current&&j.current.removeEventListener("focus",w)}},[F]),I.useEffect(()=>{if(typeof window>"u")return;const y=window.innerHeight,k=()=>{const _=y-window.innerHeight;F(_>0?_:0)};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[F]),I.useEffect(()=>{if(!g.current||!E.current)return;const y=E.current.offsetHeight??72;g.current.style.paddingBottom=`${y+24}px`},[]);const v=()=>{const y=window.visualViewport;y&&setTimeout(()=>{const k=window.innerHeight,_=y.height,R=y.offsetTop+_,w=k-R;F(w,[0,200,400,600,800])},100),L([200,400,600])},T=y=>{const k=y.target;!(k.tagName==="A"||k.tagName==="BUTTON"||k.closest("a, button"))&&j.current&&document.activeElement===j.current&&j.current.blur()},h=I.useMemo(()=>{if(!r)return"";const y=r.user_metadata??{};return y.display_name||y.full_name||r.email||""},[r]),m=I.useMemo(()=>{if(!t.length)return[];const y=[];let k=null;return t.forEach(_=>{const R=_.user_id===r?.id,W=cs(_.user_id,u)||(R?h:"")||(R?"You":"Unknown"),M=R?void 0:ls(W),X=new Date(_.created_at).toDateString(),Z=X!==k;Z&&(k=X);const Q={id:_.id,text:_.content,time:is(_.created_at),status:_.status&&_.status!=="sent"?_.status:void 0},B=y[y.length-1];B&&!Z&&B.isOwnMessage===R&&B.author===W?B.messages.push(Q):y.push({id:_.id,author:W,avatarInitials:M,isOwnMessage:R,dayLabel:Z?as(_.created_at):void 0,messages:[Q]})}),y},[h,u,t,r?.id]),S=I.useCallback(async y=>{if(!d||!r?.id||typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))return;const _=r.user_metadata?.display_name||r.user_metadata?.full_name||r.email||"User";try{await fetch("/.netlify/functions/notifyLeagueMessageV2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:d,senderId:r.id,senderName:_,content:y})})}catch(R){console.error("[MiniLeagueChatBeta] notifyLeagueMessageV2 failed:",R)}},[d,r?.id]),A=I.useCallback(async()=>{const y=o.trim();if(!(!d||!y||i))try{f(!0),await x(y),await S(y),l(""),L([0,150,300])}catch(k){console.error("[MiniLeagueChatBeta] Failed to send message",k)}finally{f(!1)}},[o,d,S,L,x,i]);return s.jsxs("div",{className:"flex flex-col h-full bg-[#f5f6fb] w-full",children:[s.jsxs("div",{ref:g,className:"flex-1 overflow-y-auto px-4 py-5",onClick:T,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",marginBottom:C>0?"0":"auto",cursor:"pointer"},children:[a&&d&&s.jsx("button",{className:"mx-auto mb-2 text-xs font-semibold text-[#1C8376] bg-white px-3 py-1 rounded-full shadow disabled:opacity-40",onClick:b,disabled:n,children:n?"Loading earlier":"Load earlier messages"}),m.length===0&&!e?s.jsx("div",{className:"text-center text-sm text-slate-500 mt-8",children:"Say hi to kick off this chat!"}):s.jsx(os,{groups:m})]}),s.jsxs("div",{ref:E,className:"flex-shrink-0 border-t border-slate-200 bg-white px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:C>0?"fixed":"relative",bottom:C>0?`${C}px`:"auto",left:C>0?0:"auto",right:C>0?0:"auto",width:C>0?"100%":"auto",maxWidth:C>0?"440px":"none",marginLeft:C>0?"auto":void 0,marginRight:C>0?"auto":void 0,zIndex:C>0?1e3:"auto"},children:[s.jsxs("div",{className:"flex items-end gap-3 bg-slate-100 rounded-2xl px-3 py-2",children:[s.jsx("textarea",{ref:j,className:"flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-800 placeholder:text-slate-400",rows:1,value:o,disabled:!d||i,placeholder:d?"Start typing a message":"Join this league to chat",onChange:y=>{l(y.target.value),j.current&&(j.current.style.height="auto",j.current.style.height=`${Math.min(j.current.scrollHeight,120)}px`)},onFocus:v,onKeyDown:y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),A())},style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"button",onClick:A,disabled:!d||i||!o.trim(),className:"w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-40",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14M12 5l7 7-7 7"})})})]}),c&&s.jsxs("div",{className:"text-xs text-red-500 mt-2 text-center",children:[c,"  try again or switch to the classic chat tab."]})]})]})}function us({winnerName:d,isDraw:u}){return s.jsx("div",{className:"mt-4 mb-4 py-6 px-6 rounded-xl bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 shadow-2xl shadow-slate-600/50 relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent before:animate-[shimmer_2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/30 after:to-transparent after:animate-[shimmer_2.5s_ease-in-out_infinite_0.6s]",children:s.jsx("div",{className:"text-center relative z-10",children:u?s.jsx("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:"It's a Draw!"}):s.jsxs("div",{className:"text-lg font-bold text-white break-words whitespace-normal px-2 leading-normal",children:[d," Wins!"]})})})}function fs({availableGws:d,selectedGw:u,onChange:r,className:t=""}){return d.length<=1?null:s.jsx("div",{className:`flex-1 ${t}`,children:s.jsx("select",{value:u||void 0,onChange:e=>{const n=parseInt(e.target.value,10);r(n)},className:"gw-selector w-full bg-white rounded-full border-2 border-slate-300 px-3 py-2 text-xs font-normal text-slate-600 text-center focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-[#1C8376] active:bg-slate-50 transition-colors",style:{fontSize:"12px",minHeight:"40px",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1em 1em",paddingRight:"2.5rem"},children:d.map(e=>s.jsxs("option",{value:e,style:{fontSize:"12px",padding:"0.5rem",fontWeight:"normal",color:"#64748b"},children:["Gameweek ",e]},e))})})}function hs({showForm:d,onToggle:u}){return s.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-0.5 shadow-sm border border-slate-200",children:[s.jsx("button",{onClick:()=>u(!1),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"text-slate-600 hover:text-slate-900 hover:bg-white/50":"bg-[#1C8376] text-white shadow-sm"}`,children:"Points"}),s.jsx("button",{onClick:()=>u(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-full transition-colors ${d?"bg-[#1C8376] text-white shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-white/50"}`,children:"Form"})]})}function ms({form:d}){const u=d.slice(-5),r=5-u.length;return s.jsxs("div",{className:"flex items-center justify-between w-full",children:[Array.from({length:r}).map((t,e)=>s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"},`dot-${e}`)),u.map((t,e)=>s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${t==="W"?"bg-green-100 text-green-700":t==="D"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:t},e))]})}function ps({rows:d,members:u,showForm:r,currentUserId:t,loading:e,isLateStartingLeague:n}){return s.jsxs("div",{className:"pt-4",children:[s.jsx("style",{children:`
        .mlt-table tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table tbody tr:last-child th {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table {
          border-bottom: none !important;
        }
        .mlt-table tbody {
          border-bottom: none !important;
        }
        .mlt-table-container {
          border-bottom: none !important;
        }
        .mlt-table-container table {
          border-bottom: none !important;
        }
        .mlt-table-container tbody {
          border-bottom: none !important;
        }
        .mlt-table-container tbody tr:last-child {
          border-bottom: none !important;
          border: none !important;
        }
        .mlt-table-container tbody tr:last-child td {
          border-bottom: none !important;
          border: none !important;
        }
      `}),s.jsx("div",{className:"mlt-table-container overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x bg-slate-50",style:{backgroundColor:"#f8fafc",borderBottom:"none",boxShadow:"none"},children:s.jsxs("table",{className:"mlt-table w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc",border:"none",borderBottom:"none"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-3 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:"Player"}),r?s.jsx("th",{className:"px-4 py-3 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8"},children:"Form"}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"W"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"D"}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:n?"CP":"OCP"}),u.length>=3&&s.jsx("th",{className:"py-3 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""}),s.jsx("th",{className:"py-3 text-center font-normal text-xs",style:{backgroundColor:"#f8fafc",width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"0.75rem"},children:"PTS"})]})]})}),s.jsxs("tbody",{children:[d.map((a,c)=>{const b=a.user_id===t,x=c===d.length-1;return s.jsxs("tr",{className:b?"flash-user-row":"",style:{position:"relative",backgroundColor:"#f8fafc",...x?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:c+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:a.name}),r?s.jsx("td",{className:"px-4 py-4",style:{backgroundColor:"#f8fafc"},children:s.jsx(ms,{form:a.form})}):s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.wins}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.draws}),s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.ocp}),u.length>=3&&s.jsx("td",{className:"py-4 text-center tabular-nums",style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:a.unicorns}),s.jsx("td",{className:"py-4 text-center tabular-nums font-bold",style:{width:"40px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:a.mltPts})]})]},a.user_id)}),e&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"Calculating"})}),!e&&!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsx("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:r?3:u.length>=3?7:6,style:{backgroundColor:"#f8fafc"},children:"No gameweeks completed yet  this will populate after the first results are saved."})})]})]})})]})}function gs({rows:d,members:u,currentUserId:r,positionChangeKeys:t,isApiTestLeague:e,hasLiveFixtures:n,hasStartingSoonFixtures:a,hasStartedFixtures:c,allFixturesFinished:b,resGw:x}){return s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes flash {
          0%, 100% {
            background-color: rgb(209, 250, 229);
          }
          25% {
            background-color: rgb(167, 243, 208);
          }
          50% {
            background-color: rgb(209, 250, 229);
          }
          75% {
            background-color: rgb(167, 243, 208);
          }
        }
        @keyframes pulse-score {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }
        @keyframes position-change {
          0% {
            background-color: rgb(254, 243, 199);
          }
          50% {
            background-color: rgb(253, 230, 138);
          }
          100% {
            background-color: transparent;
          }
        }
        .flash-user-row {
          animation: flash 1.5s ease-in-out 3;
        }
        .pulse-live-score {
          animation: pulse-score 2s ease-in-out infinite;
        }
        .position-changed {
          animation: position-change 1.5s ease-out;
        }
        .full-width-header-border::after {
          content: '';
          position: absolute;
          left: -1rem;
          right: -1rem;
          bottom: 0;
          height: 1px;
          background-color: #cbd5e1;
          z-index: 1;
        }
      `}),s.jsx("div",{className:"overflow-y-auto overflow-x-hidden -mx-4 sm:mx-0 rounded-none sm:rounded-2xl border-x-0 sm:border-x border-b border-slate-200 bg-slate-50 shadow-sm",style:{backgroundColor:"#f8fafc"},children:s.jsxs("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed",backgroundColor:"#f8fafc"},children:[s.jsx("thead",{className:"sticky top-0",style:{position:"sticky",top:0,zIndex:25,backgroundColor:"#f8fafc",display:"table-header-group"},children:s.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"none"},children:[s.jsx("th",{className:"py-4 text-left font-normal",style:{backgroundColor:"#f8fafc",width:"30px",paddingLeft:"0.75rem",paddingRight:"0.5rem",color:"#94a3b8"},children:"#"}),s.jsx("th",{className:"py-4 text-left font-normal text-xs",style:{backgroundColor:"#f8fafc",color:"#94a3b8",paddingLeft:"0.5rem",paddingRight:"1rem"},children:s.jsxs("div",{className:"flex items-center gap-2",children:["Player",e&&n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-600 text-white shadow-md shadow-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-[10px] font-medium",children:"LIVE"})]}),e&&!b&&a&&!n&&s.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500 text-white shadow-md shadow-amber-500/30",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"text-[10px] font-medium",children:c?"Next Game Starting Soon":"Starting soon"})]})]})}),s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8"},children:"Score"}),u.length>=3&&s.jsx("th",{className:"py-4 text-center font-normal",style:{backgroundColor:"#f8fafc",width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",color:"#94a3b8",fontSize:"1rem"},children:""})]})}),s.jsxs("tbody",{children:[d.map((o,l)=>{const i=o.user_id===r,f=l===d.length-1,g=t.has(o.user_id);return s.jsxs("tr",{className:`${i?"flash-user-row":""} ${g?"position-changed":""}`,style:{position:"relative",backgroundColor:"#f8fafc",...f?{}:{borderBottom:"1px solid #e2e8f0"}},children:[s.jsx("td",{className:"py-4 text-left tabular-nums whitespace-nowrap relative",style:{paddingLeft:"0.75rem",paddingRight:"0.5rem",backgroundColor:"#f8fafc",width:"30px"},children:l+1}),s.jsx("td",{className:"py-4 truncate whitespace-nowrap",style:{backgroundColor:"#f8fafc",paddingLeft:"0.5rem",paddingRight:"1rem",overflow:"hidden",textOverflow:"ellipsis"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[e&&n&&s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse flex-shrink-0",style:{minWidth:"8px",minHeight:"8px"}}),e&&!n&&a&&s.jsx("svg",{className:"w-3 h-3 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:o.name})]})}),s.jsx("td",{className:`py-4 text-center tabular-nums font-bold ${e&&n?"pulse-live-score":""}`,style:{width:"50px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc",color:"#1C8376"},children:o.score}),u.length>=3&&s.jsx("td",{className:`py-4 text-center tabular-nums ${e&&n?"pulse-live-score":""}`,style:{width:"35px",paddingLeft:"0.25rem",paddingRight:"0.25rem",backgroundColor:"#f8fafc"},children:o.unicorns})]},o.user_id)}),!d.length&&s.jsx("tr",{style:{backgroundColor:"#f8fafc"},children:s.jsxs("td",{className:"px-4 py-6 text-slate-500 text-center",colSpan:u.length>=3?4:3,style:{backgroundColor:"#f8fafc"},children:["No results recorded for GW ",x," yet."]})})]})]})})]})}function xs(d){const u=fn(),r=encodeURIComponent(d);if(u){const t=`whatsapp://send?text=${r}`;let e=!1,n=!1;try{const a=document.createElement("a");a.href=t,a.style.display="none",document.body.appendChild(a),a.click(),e=!0,setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},100)}catch{}if(!e)try{window.open(t),n=!0}catch{}if(!e&&!n)try{window.location.href=t}catch{window.open(`https://wa.me/?text=${r}`,"_blank")}}else{const t=`https://wa.me/?text=${r}`;try{window.open(t,"_blank")}catch{navigator.clipboard.writeText(d).then(()=>{alert("Message copied to clipboard! You can now paste it in WhatsApp or Messages.")}).catch(()=>{alert(`Unable to open WhatsApp. Please copy this message manually:

`+d)})}}}function bs(d,u){const r=new Date(u.find(l=>l.gw===d)?.kickoff_time||""),t=new Date(r.getTime()-4500*1e3),e=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],n=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],a=e[t.getUTCDay()],c=t.getUTCDate(),b=n[t.getUTCMonth()],x=t.getUTCHours().toString().padStart(2,"0"),o=t.getUTCMinutes().toString().padStart(2,"0");return`Gameweek ${d} Predictions Reminder!

DEADLINE: THIS ${a} ${c} ${b}, ${x}:${o} BST

Don't forget!
playtotl.com`}function ws(d,u){console.log("[SubmissionStatusTable] handleShareReminder called, picksGw:",d);try{const r=bs(d,u);console.log("[SubmissionStatusTable] Generated message:",r),xs(r)}catch(r){console.error("[SubmissionStatusTable] Error in handleShareReminder:",r),alert("Error sharing reminder. Please try again.")}}function Er({members:d,submittedMap:u,picksGw:r,allSubmitted:t,remaining:e,fixtures:n,onShareReminder:a,variant:c="full"}){const b=a||(()=>ws(r,n)),x=n.map(g=>g.kickoff_time).filter(g=>!!g).map(g=>new Date(g)).filter(g=>!isNaN(g.getTime())),o=x.length>0?new Date(Math.min(...x.map(g=>g.getTime()))):null,l=o?new Date(o.getTime()-4500*1e3):null,i=l?new Date>=l:!1;let f="";if(l){const g=c==="compact"?["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=g[l.getUTCDay()],C=l.getUTCDate(),P=j[l.getUTCMonth()],D=l.getUTCHours().toString().padStart(2,"0"),L=l.getUTCMinutes().toString().padStart(2,"0");f=`${E} ${C} ${P}, ${D}:${L} BST`}return c==="compact"?s.jsxs("div",{className:"mt-2 pt-2",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",d.length," to submit."]})}),!t&&s.jsxs("button",{type:"button",onClick:g=>{g.preventDefault(),g.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (compact variant)"),b()},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&s.jsxs("div",{className:`mb-3 text-xs font-medium ${i?"text-orange-600":"text-slate-600"} flex items-center gap-1.5`,children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),i?"Deadline Passed: ":"Deadline: ",f]}),s.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((g,j)=>g.name.localeCompare(j.name)).map(g=>{const j=`${g.id}:${r}`,E=!!u.get(j);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:g.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2.5 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submitted"]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2.5 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Not yet"]})})]},g.id)})})]})})]}):s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-700",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx("div",{children:t?s.jsxs(s.Fragment,{children:["All ",d.length," members have submitted."]}):s.jsxs(s.Fragment,{children:["Waiting for ",s.jsx("span",{className:"font-semibold",children:e})," of ",d.length," to submit."]})}),!t&&s.jsxs("button",{type:"button",onClick:g=>{g.preventDefault(),g.stopPropagation(),console.log("[SubmissionStatusTable] Button clicked (full variant)"),b()},className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),"Share Reminder"]})]}),f&&s.jsxs("div",{className:`mb-3 text-sm ${i?"text-orange-600 font-semibold":"text-slate-600"}`,children:[i?" Deadline Passed: ":" Deadline: ",f]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs("table",{className:"w-full text-sm",style:{tableLayout:"fixed"},children:[s.jsx("thead",{className:"bg-slate-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left px-4 py-3 w-2/3 font-semibold text-slate-600",children:"Player"}),s.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-600",children:"Status"})]})}),s.jsx("tbody",{children:d.slice().sort((g,j)=>g.name.localeCompare(j.name)).map(g=>{const j=`${g.id}:${r}`,E=!!u.get(j);return s.jsxs("tr",{className:"border-t border-slate-200",children:[s.jsx("td",{className:"px-4 py-3 font-bold text-slate-900 truncate whitespace-nowrap",style:{overflow:"hidden",textOverflow:"ellipsis"},children:g.name}),s.jsx("td",{className:"px-4 py-3",children:E?s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-xs px-2 py-1 border border-emerald-300 font-bold shadow-sm whitespace-nowrap w-24",children:" Submitted"}):s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-amber-50 text-amber-700 text-xs px-2 py-1 border border-amber-200 font-semibold whitespace-nowrap w-24",children:" Not yet"})})]},g.id)})})]})})]})}function Lr({letter:d,correct:u,unicorn:r,hasSubmitted:t,isLive:e,isOngoing:n,isFinished:a}){let c;return u===!0?e||n?c="bg-emerald-600 text-white border-emerald-600 animate-pulse shadow-lg shadow-emerald-500/50":a?c="bg-gradient-to-br from-yellow-400 via-orange-500 via-pink-500 to-purple-600 text-white shadow-xl shadow-yellow-400/40 relative overflow-hidden animate-pulse before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/70 before:to-transparent before:animate-[shimmer_1.2s_ease-in-out_infinite] after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-yellow-200/50 after:to-transparent after:animate-[shimmer_1.8s_ease-in-out_infinite_0.4s]":c="bg-emerald-600 text-white border-emerald-600":t?c="bg-emerald-600 text-white border-emerald-600":c="bg-slate-100 text-slate-600 border-slate-200",s.jsx("span",{className:["inline-flex items-center justify-center h-5 min-w-[18px] px-1.5","rounded-full border text-[11px] font-semibold mb-0.5","align-middle",c].join(" "),title:r?"Correct!":void 0,children:d})}function vs(d,u){return d==="FINISHED"?"FT":d==="PAUSED"?"HT":d==="IN_PLAY"?u==null?"LIVE":`${u}'`:"LIVE"}function ys(d){const u=(d||"?").trim().split(/\s+/);return u.length?u.length===1?u[0].slice(0,1).toUpperCase():(u[0][0]+u[u.length-1][0]).toUpperCase():"?"}function _s({fixture:d,picks:u,members:r,outcome:t,liveScore:e,submittedMap:n,picksGw:a,isApiTestLeague:c=!1}){const b=d.home_code||d.home_team||d.home_name||"",x=d.away_code||d.away_team||d.away_name||"",o=fr(b)||d.home_name||d.home_team||"Home",l=fr(x)||d.away_name||d.away_team||"Away",f=(L=>{if(!L)return"";const F=new Date(L);if(isNaN(F.getTime()))return"";const v=String(F.getUTCHours()).padStart(2,"0"),T=String(F.getUTCMinutes()).padStart(2,"0");return`${v}:${T}`})(d.kickoff_time),g=!!(e&&e.status==="IN_PLAY"),j=!!(e&&(e.status==="PAUSED"||e.status==="HALF_TIME"||e.status==="HT")),E=!!(e&&e.status==="FINISHED"),C=g||j;let P=null;c&&e?e.homeScore>e.awayScore?P="H":e.awayScore>e.homeScore?P="A":e.homeScore===e.awayScore&&(P="D"):P=t;const D=L=>{const F=u.filter(m=>m.pick===L),v=u.length===r.length&&F.length===r.length,T=4,h=[];for(let m=0;m<F.length;m+=T){const S=F.slice(m,m+T);h.push(S)}return s.jsx("div",{className:"flex flex-col gap-1",children:h.map((m,S)=>s.jsx("div",{className:"flex items-center justify-center",children:m.map((A,y)=>{const k=r.find(p=>p.id===A.user_id),_=ys(k?.name??"?"),R=n.has(`${A.user_id}:${a}`),w=P&&P===L?!0:null;return v?s.jsx("span",{className:"inline-block",style:{marginLeft:y>0?"-8px":"0",position:"relative",zIndex:y},children:s.jsx(Lr,{letter:_,correct:w,unicorn:w===!0,hasSubmitted:R,isLive:g,isOngoing:C,isFinished:E})},A.user_id):s.jsx(Lr,{letter:_,correct:w,unicorn:w===!0,hasSubmitted:R,isLive:g,isOngoing:C,isFinished:E},A.user_id)})},S))})};return s.jsx("li",{className:"border-t first:border-t-0",children:s.jsxs("div",{className:"p-4 bg-white relative",children:[(g||j)&&s.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-red-600",children:"LIVE"})]}),E&&!g&&!j&&s.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-10 pb-6",children:s.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"FT"})}),s.jsxs("div",{className:`grid grid-cols-3 items-center ${C?"pt-4":""}`,children:[s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:o})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(hr,{code:d.home_code||void 0,crest:d.home_crest||void 0,size:24,className:"h-6 w-6"}),s.jsx("div",{className:"text-[15px] sm:text-base font-semibold text-slate-600",children:e&&(g||j||E)?s.jsxs("span",{className:"font-bold text-base text-slate-900",children:[e.homeScore," - ",e.awayScore]}):s.jsx("span",{children:f})}),s.jsx(hr,{code:d.away_code||void 0,crest:d.away_crest||void 0,size:24,className:"h-6 w-6"})]}),s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:"text-sm sm:text-base font-medium text-slate-900 truncate",children:l})})]}),e&&(C||E)&&s.jsx("div",{className:"flex justify-center mt-1",children:s.jsx("span",{className:`text-[10px] font-semibold ${C?"text-red-600":"text-slate-500"}`,children:vs(e.status,e.minute)})}),s.jsxs("div",{className:"mt-2 grid grid-cols-3",children:[s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("H")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("D")})}),s.jsx("div",{className:"relative min-h-6",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:D("A")})})]})]})})}function Rr({label:d,fixtures:u,picksByFixture:r,members:t,outcomes:e,liveScores:n,submittedMap:a,picksGw:c,isApiTestLeague:b=!1,isFirstSection:x=!1,hasLiveGames:o=!1,allGamesFinished:l=!1,allSubmitted:i=!1,resultsPublished:f=!1,deadlinePassed:g=!1,whoDidntSubmit:j=[],liveFixturesCount:E,hasStarted:C=!1}){return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(hn,{date:d,className:"text-lg font-normal"}),x&&s.jsxs(s.Fragment,{children:[b&&o&&E!==void 0&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600 text-white text-sm font-bold border border-red-700 shadow-sm",style:{marginTop:"-2px"},children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"Live"}),s.jsxs("span",{className:"flex items-baseline gap-0.5",children:[s.jsx("span",{className:"text-base sm:text-lg font-extrabold",children:E}),s.jsx("span",{className:"text-xs sm:text-sm font-medium opacity-90",children:"/"}),s.jsx("span",{className:"text-sm sm:text-base font-semibold opacity-80",children:u.length})]})]}),b&&l&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),b&&!C&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&i&&f&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-[#1C8376]/10 text-[#1C8376]/90 text-sm font-bold border border-emerald-300 shadow-sm",style:{marginTop:"-2px"},children:"Round Complete!"}),!b&&i&&!f&&s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-bold border border-blue-300 shadow-sm",style:{marginTop:"-2px"},children:"All Submitted"}),!b&&g&&!i&&s.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-800 text-sm font-bold border border-orange-300 shadow-sm",style:{marginTop:"-2px"},children:["Deadline Passed ",j.length>0&&`(${j.join(", ")} didn't submit)`]})]})]}),s.jsx("div",{className:"rounded-2xl border bg-slate-50 overflow-hidden",children:s.jsxs("ul",{children:[u.map(P=>{try{const D=r.get(P.fixture_index)??[],L=e.get(P.fixture_index)||null,F=n[P.fixture_index]||null;return s.jsx(_s,{fixture:P,picks:D,members:t,outcome:L,liveScore:F,submittedMap:a,picksGw:c,isApiTestLeague:b},`${P.gw}-${P.fixture_index}`)}catch(D){return console.error("Error rendering fixture:",D,P),s.jsxs("li",{className:"p-4 text-red-500",children:["Error loading fixture: ",P.fixture_index]},`${P.gw}-${P.fixture_index}`)}}),!u.length&&s.jsx("li",{className:"p-4 text-slate-500",children:"No fixtures."})]})})]})}const Mt=8;function er(d){return d.result==="H"||d.result==="D"||d.result==="A"?d.result:typeof d.home_goals=="number"&&typeof d.away_goals=="number"?d.home_goals>d.away_goals?"H":d.home_goals<d.away_goals?"A":"D":null}function js({chat:d,userId:u,nameById:r,isMember:t,newMsg:e,setNewMsg:n,onSend:a,leagueCode:c,memberCount:b,maxMembers:x,notificationStatus:o}){const l=I.useRef(null),i=I.useRef(null),f=I.useRef(null),g=I.useRef(null),[j,E]=I.useState(0),C=()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},P=I.useCallback((v=[0,100,300,500,700])=>{requestAnimationFrame(()=>{v.forEach(T=>{setTimeout(()=>C(),T)})})},[]),D=I.useCallback((v,T=[0,100,300,500,700])=>{if(v>0){if(E(v),l.current){const h=Math.max(v+(f.current?.offsetHeight||0)+16,80);l.current.style.paddingBottom=`${h}px`}}else E(0),l.current&&(l.current.style.paddingBottom="");P(T)},[P]);I.useEffect(()=>{d.length>0&&setTimeout(()=>C(),100)},[d.length]),I.useEffect(()=>{!e&&f.current&&(f.current.style.height="auto",f.current.style.height="42px")},[e]),I.useEffect(()=>{const v=window.visualViewport;if(!v)return;let T=null,h=0;const m=()=>{T&&(clearTimeout(T),T=null),T=setTimeout(()=>{const y=window.innerHeight,k=v.height,_=v.offsetTop+k,R=y-_;Math.abs(R-h)<10&&R>0||(h=R,D(R))},50)};v.addEventListener("resize",m),v.addEventListener("scroll",m);const S=()=>{setTimeout(m,100),setTimeout(m,300)},A=setTimeout(()=>{f.current&&f.current.addEventListener("focus",S)},100);return m(),()=>{T&&clearTimeout(T),clearTimeout(A),v.removeEventListener("resize",m),v.removeEventListener("scroll",m),f.current&&f.current.removeEventListener("focus",S)}},[D]);const L=()=>{const v=window.visualViewport;v&&setTimeout(()=>{const T=window.innerHeight,h=v.height,m=v.offsetTop+h,S=T-m;D(S,[0,200,400,600,800])},100),P([200,400,600])};I.useEffect(()=>{if(typeof window>"u")return;const v=window.innerHeight,T=()=>{const h=v-window.innerHeight;D(h>0?h:0)};return window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[D]);const F=v=>{const T=v.target;!(T.tagName==="A"||T.tagName==="BUTTON"||T.closest("a, button"))&&f.current&&document.activeElement===f.current&&f.current.blur()};return s.jsxs("div",{className:"flex flex-col chat-container",style:{height:"100%"},children:[s.jsxs("div",{ref:l,className:"flex-1 overflow-y-auto px-3 pt-3 pb-4 min-h-0 messages-container",onClick:F,style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",marginBottom:j>0?"0":"auto",cursor:"pointer"},children:[d.map((v,T)=>{const h=v.user_id===u,m=r.get(v.user_id)??"Unknown",S=new Date(v.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),A=d[T-1],y=d[T+1],k=A?.user_id===v.user_id,_=y?.user_id===v.user_id,R=!k,w=!_,p=!k&&!_,W=R&&_,M=k&&w,O=!h&&(p||M),X=m.split(/\s+/).map(B=>B[0]).join("").toUpperCase(),Z=h?"flex justify-end":"flex items-end gap-2",Q=p?"single":W?"top":M?"bottom":"middle";return s.jsxs("div",{className:Z,style:{marginTop:R?24:4},children:[!h&&s.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex justify-center self-end",children:O?s.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs font-semibold text-slate-500",children:X}):s.jsx("div",{className:"w-8 h-8"})}),s.jsx("div",{className:`flex flex-col gap-1 ${h?"items-end":"items-start"}`,children:s.jsx(Br,{author:!h&&R?m:void 0,text:v.content,time:S,isOwnMessage:h,shape:Q})})]},v.id)}),s.jsx("div",{ref:i,style:{height:"1px",width:"100%"}})]}),s.jsxs("div",{ref:g,className:"flex-shrink-0 bg-white border-t border-slate-200 px-4 py-3",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))",position:j>0?"fixed":"relative",bottom:j>0?`${j}px`:"auto",left:j>0?"0":"auto",right:j>0?"0":"auto",width:j>0?"100%":"auto",zIndex:j>0?1e3:"auto"},children:[t?s.jsxs("form",{onSubmit:v=>{v.preventDefault(),a()},className:"flex items-center gap-2",children:[s.jsx("textarea",{ref:f,value:e,onChange:v=>{n(v.target.value),f.current&&(f.current.style.height="auto",f.current.style.height=`${Math.min(f.current.scrollHeight,120)}px`)},onFocus:L,onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),e.trim()&&a())},placeholder:"Start typing...",maxLength:2e3,rows:1,className:"flex-1 rounded-xl border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-[#1C8376] focus:border-transparent resize-none overflow-hidden",style:{minHeight:"42px",maxHeight:"120px",lineHeight:"1.5"}}),s.jsx("button",{type:"submit",className:"flex-shrink-0 w-10 h-10 rounded-full bg-[#1C8376] text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",disabled:!e.trim(),style:{backgroundColor:e.trim()?"#1C8376":"#94a3b8"},children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})})})]}):s.jsx("div",{className:"rounded-md border border-amber-200 bg-amber-50 text-amber-800 p-3 text-sm",children:"Join this league to chat with other members."}),o&&s.jsx("div",{className:`w-full rounded px-2 py-1 text-xs mt-2 ${o.type==="success"?"bg-green-50 text-green-700 border border-green-200":o.type==="warning"?"bg-amber-50 text-amber-700 border border-amber-200":"bg-red-50 text-red-700 border border-red-200"}`,children:o.message})]})]})}function Ss(){const{code:d=""}=mn(),{user:u}=Tr(),[r]=I.useState(()=>{const N=localStorage.getItem("oldSchoolMode");return N?JSON.parse(N):!1});I.useEffect(()=>{localStorage.setItem("oldSchoolMode",JSON.stringify(r))},[r]),I.useEffect(()=>{document.body.classList.add("league-page-active"),document.documentElement.classList.add("league-page-active");const N=()=>{const H=document.querySelector(".league-header-fixed");if(H){const K=H.style.top||window.getComputedStyle(H).top;K!=="0px"&&K!=="0"&&(H.style.top="0",H.style.transform="translate3d(0, 0, 0)")}},U=()=>{N(),(window.scrollY!==0||window.pageYOffset!==0)&&window.scrollTo(0,0)},$=H=>{const K=H.target;K.closest(".league-content-wrapper")||K.closest(".league-header-fixed")||K.closest(".chat-tab-wrapper")||H.preventDefault()};window.addEventListener("scroll",U,{passive:!0}),document.addEventListener("touchmove",$,{passive:!1});const V=setInterval(N,100);return N(),()=>{document.body.classList.remove("league-page-active"),document.documentElement.classList.remove("league-page-active"),window.removeEventListener("scroll",U),document.removeEventListener("touchmove",$),clearInterval(V)}},[]),I.useEffect(()=>{const N=$=>{const V=$.target;(V.tagName==="INPUT"||V.tagName==="TEXTAREA")&&setTimeout(()=>{window.scrollTo(0,0);const H=document.querySelector(".league-header-fixed");H&&(H.style.top="0")},100)},U=()=>{const $=document.querySelector(".league-header-fixed");$&&($.style.top="0")};return document.addEventListener("focusin",N),window.addEventListener("resize",U),window.addEventListener("orientationchange",U),()=>{document.removeEventListener("focusin",N),window.removeEventListener("resize",U),window.removeEventListener("orientationchange",U)}},[]),I.useEffect(()=>{if(typeof window>"u")return;const N=window.visualViewport;if(!N)return;let U=null;const $=()=>{const H=f.current;if(!H)return;const K=N.offsetTop??0;H.style.setProperty("transform",`translate3d(0, ${K}px, 0)`,"important")},V=()=>{U&&cancelAnimationFrame(U),U=window.requestAnimationFrame($)};return V(),N.addEventListener("resize",V),N.addEventListener("scroll",V),()=>{U&&cancelAnimationFrame(U),N.removeEventListener("resize",V),N.removeEventListener("scroll",V),f.current&&f.current.style.removeProperty("transform")}},[]);const[t,e]=I.useState(null),[n,a]=I.useState([]),[c,b]=I.useState(!0),[x,o]=I.useState("chat-beta"),l=I.useRef(!1),i=I.useRef(!1),f=I.useRef(null),[g,j]=I.useState(!1),[E,C]=I.useState(!1),[P,D]=I.useState(!1),[L,F]=I.useState(null),[v,T]=I.useState(null),[h,m]=I.useState(null),[S,A]=I.useState([]),y=I.useRef({}),k=I.useRef(new Map),[_,R]=I.useState(new Set),[w,p]=I.useState(!1),[W,M]=I.useState(!1),[O,X]=I.useState(0),[Z,Q]=I.useState(!1),[B,z]=I.useState(!1),[ne,pe]=I.useState(!1),[de,le]=I.useState(!1),[he,fe]=I.useState(null),[Le,Ge]=I.useState(!1),[Pe,be]=I.useState(null),[Fe,ye]=I.useState({x:0,y:0}),[ge,Re]=I.useState(1),[Te,ke]=I.useState(null),[Ne,Ce]=I.useState(null),[_e,We]=I.useState(!1),[nt,ht]=I.useState(!1),[Me,st]=I.useState(!1),[Ue,Ie]=I.useState(!1),[qe,Ye]=I.useState(!1),[Je,Xe]=I.useState(!1),[mt,Nt]=I.useState(null),[gt,yt]=I.useState(!1),[lt,kt]=I.useState(!1),[Ve,ot]=I.useState(null),[pt,it]=I.useState([]),[bt,et]=I.useState(""),[ct,tt]=I.useState(null),Gr=I.useMemo(()=>!!u?.id&&n.some(N=>N.id===u.id),[u?.id,n]),dt=I.useMemo(()=>!!u?.id&&!!Ve&&Ve.id===u.id,[u?.id,Ve]),qr=I.useMemo(()=>Ve?.name??"League admin",[Ve]),sr=I.useMemo(()=>{const N=new Map;return n.forEach(U=>N.set(U.id,U.name)),N},[n]),or=I.useCallback(()=>{if(!t?.code||typeof window>"u"||typeof navigator>"u")return;const N=`Join my mini league "${t.name}" on TotL!`,U=`${window.location.origin}/league/${t.code}`,$=navigator;if(typeof $.share=="function"){$.share({title:`Join ${t.name}`,text:N,url:U}).catch(H=>{console.warn("[League] Share cancelled",H)});return}const V=`${N}
${U}`;navigator.clipboard?.writeText?navigator.clipboard.writeText(V).then(()=>window.alert?.("League link copied to clipboard!")).catch(()=>{window.prompt?.("Share this league code:",t.code)}):window.prompt?.("Share this league code:",t.code)},[t]),Vr=I.useCallback(async()=>{if(!(!t?.id||!u?.id)){D(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",t.id).eq("user_id",u.id);if(N)throw N;typeof window<"u"&&(window.location.href="/leagues")}catch(N){console.error("[League] Error leaving league:",N),typeof window<"u"&&window.alert?.(N?.message??"Failed to leave league. Please try again.")}finally{D(!1),C(!1)}}},[t?.id,u?.id]),Zr=I.useCallback(async()=>{if(!(!t?.id||!u?.id)){st(!0);try{if(n.length>=Mt){typeof window<"u"&&window.alert?.("League is full (max 8 members)."),ht(!1);return}const{error:N}=await se.from("league_members").insert({league_id:t.id,user_id:u.id});if(N)throw N;const U=u.user_metadata?.display_name||u.email||"Someone";try{const $=await fetch("/.netlify/functions/notifyLeagueMemberJoin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:t.id,userId:u.id,userName:U})}),V=await $.text();let H;try{H=V?JSON.parse(V):{error:"Empty response body"}}catch(K){console.error("[League] Failed to parse notification response. Status:",$.status,"Text:",V,"Error:",K),H={error:"Invalid JSON response",status:$.status,raw:V.substring(0,200)}}$.ok?console.log("[League] Join notification sent:",JSON.stringify({sent:H.sent,recipients:H.recipients,ok:H.ok,breakdown:H.breakdown},null,2)):console.error("[League] Notification function returned error:",$.status,H)}catch($){console.error("[League] Error sending join notification:",$)}typeof window<"u"&&window.location.reload()}catch(N){console.error("[League] Error joining league:",N),typeof window<"u"&&window.alert?.(N?.message??"Failed to join league.")}finally{st(!1)}}},[t?.id,u?.id,n.length]),Yr=I.useCallback(async()=>{if(!(!mt||!t?.id||!u?.id)){yt(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",t.id).eq("user_id",mt.id);if(N)throw N;typeof window<"u"&&window.location.reload()}catch(N){console.error("[League] Error removing member:",N),typeof window<"u"&&window.alert?.(N?.message??"Failed to remove member.")}finally{yt(!1),Ye(!1),Nt(null)}}},[t?.id,mt,u?.id]),Kr=I.useCallback(async()=>{if(!(!t?.id||!u?.id)){kt(!0);try{const{error:N}=await se.from("league_members").delete().eq("league_id",t.id);if(N)throw N;const{error:U}=await se.from("leagues").delete().eq("id",t.id);if(U)throw U;typeof window<"u"&&(window.location.href="/leagues")}catch(N){console.error("[League] Error ending league:",N),typeof window<"u"&&window.alert?.(N?.message??"Failed to end league.")}finally{kt(!1),Xe(!1)}}},[t?.id,u?.id]),Jr=N=>new Promise((U,$)=>{const V=new Image;V.addEventListener("load",()=>U(V)),V.addEventListener("error",H=>$(H)),V.src=N}),ir=async(N,U)=>{const $=await Jr(N),V=document.createElement("canvas"),H=V.getContext("2d");if(!H)throw new Error("No 2d context");return V.width=U.width,V.height=U.height,H.drawImage($,U.x,U.y,U.width,U.height,0,0,U.width,U.height),new Promise((K,ee)=>{V.toBlob(ae=>{if(!ae){ee(new Error("Canvas is empty"));return}K(ae)},"image/jpeg",.9)})},Qr=I.useCallback(N=>{if(!t?.id||!dt){fe("Only league admins can upload badges.");return}if(!new Set(["image/png","image/jpeg","image/jpg","image/webp"]).has(N.type)){fe("Please upload a PNG, JPG, or WebP image.");return}if(N.size>2*1024*1024){fe("Please choose an image smaller than 2MB.");return}fe(null),Ge(!1);const $=new FileReader;$.onload=()=>{be($.result)},$.readAsDataURL(N)},[dt,t?.id]),Xr=I.useCallback(async(N,U)=>{if(ke(U),Pe)try{const $=await ir(Pe,U),V=URL.createObjectURL($);Ce(V)}catch($){console.error("[League] Error creating preview:",$)}},[Pe]),en=I.useCallback(async()=>{if(!(!Pe||!Te||!t?.id||!dt)){fe(null),Ge(!1),le(!0);try{const N=await ir(Pe,Te),U=new File([N],"badge.jpg",{type:"image/jpeg"}),$=await Be(U,{maxSizeMB:.02,maxWidthOrHeight:256,useWebWorker:!0,initialQuality:.8});if($.size>20*1024)throw new Error("Compressed image is still larger than 20KB. Try a smaller image.");const V=`${t.id}-${Date.now()}.jpg`,{error:H}=await se.storage.from("league-avatars").upload(V,$,{cacheControl:"3600",upsert:!0,contentType:$.type});if(H)throw H;const{data:K}=se.storage.from("league-avatars").getPublicUrl(V),ee=K?.publicUrl;if(!ee)throw new Error("Unable to get public URL for badge.");const{error:ae}=await se.from("leagues").update({avatar:ee}).eq("id",t.id);if(ae)throw ae;e(Se=>Se&&{...Se,avatar:ee}),Ge(!0),Ne&&URL.revokeObjectURL(Ne),be(null),Ce(null),pe(!1)}catch(N){console.error("[League] Error uploading badge:",N),fe(N?.message??"Failed to upload badge. Please try again.")}finally{le(!1)}}},[Pe,Te,dt,t?.id]),tn=I.useCallback(async()=>{if(!(!t?.id||!dt)){fe(null),Ge(!1),le(!0);try{const{error:N}=await se.from("leagues").update({avatar:null}).eq("id",t.id);if(N)throw N;e(U=>U&&{...U,avatar:null}),Ge(!0)}catch(N){console.error("[League] Error removing badge:",N),fe(N?.message??"Failed to remove badge. Please try again.")}finally{le(!1)}}},[dt,t?.id]),[Ot,rn]=I.useState(new Map);I.useEffect(()=>{(async()=>{const N=new Map,{data:U}=await se.from("app_fixtures").select("gw, kickoff_time").order("gw",{ascending:!0}),{data:$}=await se.from("app_fixtures").select("gw, kickoff_time").eq("gw",1).order("fixture_index",{ascending:!0}),V=new Map;if(U&&U.forEach(H=>{(!V.has(H.gw)||H.kickoff_time&&new Date(H.kickoff_time)<new Date(V.get(H.gw)))&&H.kickoff_time&&V.set(H.gw,H.kickoff_time)}),$&&$.length>0){const H=$.find(K=>K.kickoff_time)?.kickoff_time;if(H){const K=V.get(1);(!K||new Date(H)<new Date(K))&&V.set(1,H)}}V.forEach((H,K)=>{const ee=new Date(H),ae=new Date(ee.getTime()-4500*1e3);N.set(K,ae)}),rn(N)})()},[]),I.useEffect(()=>{const N=U=>{const $=U.target;w&&!$.closest(".gw-dropdown-container")&&p(!1)};return w&&document.addEventListener("click",N),()=>document.removeEventListener("click",N)},[w]),I.useEffect(()=>{let N=!0;return(async()=>{const{data:U}=await se.from("app_meta").select("current_gw").eq("id",1).maybeSingle();if(!N)return;F(U?.current_gw??null);const{data:$}=await se.from("app_gw_results").select("gw").order("gw",{ascending:!1}).limit(1);if(!N)return;T($&&$.length?$[0].gw:null);const{data:V}=await se.from("app_gw_results").select("gw").order("gw",{ascending:!1});if(!N)return;const H=V?[...new Set(V.map(ee=>ee.gw))].sort((ee,ae)=>ae-ee):[],K=U?.current_gw;K&&!H.includes(K)&&H.unshift(K),A(H),H.length>0&&!h&&m(H[0])})(),()=>{N=!1}},[O]);const ut=I.useMemo(()=>n.map(N=>N.id),[n]),[Ae,ar]=I.useState([]),[_t,$t]=I.useState([]),[Ht,Bt]=I.useState([]),[At,Gt]=I.useState([]),lr=I.useMemo(()=>!Ae||Ae.length===0?[]:Ae.map(N=>N.api_match_id).filter(N=>N!=null),[Ae]),Et=I.useMemo(()=>t?.name==="API Test",[t?.name]),[Qe,cr]=I.useState(null);I.useEffect(()=>{if(!Et){cr(null);return}let N=!0;return(async()=>{const{data:U}=await se.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();let $=U?.current_test_gw??1;if($&&$!==1){const{data:V}=await se.from("app_fixtures").select("gw").eq("gw",$).limit(1).maybeSingle();if(!V){const{data:H}=await se.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();H&&($=1)}}N&&cr($)})(),()=>{N=!1}},[Et]);const nn=I.useMemo(()=>Et&&Qe!==null?Qe:L||h||void 0,[Et,Qe,L,h]),{liveScores:dr}=pn(nn,lr.length>0?lr:void 0),He=I.useMemo(()=>{const N={};return!Ae||Ae.length===0||Ae.forEach(U=>{const $=U.api_match_id;if($){const V=dr.get($);V&&(N[U.fixture_index]={homeScore:V.home_score??0,awayScore:V.away_score??0,status:V.status||"SCHEDULED",minute:V.minute??null})}}),N},[dr,Ae]),[ur,jt]=I.useState([]),[sn,Ct]=I.useState(!1);I.useEffect(()=>{let N=!0;return(async()=>{b(!0);const{data:U}=await se.from("leagues").select("id,name,code,created_at").eq("code",d).maybeSingle();if(!N)return;if(!U){e(null),a([]),b(!1);return}e(U);const{data:$}=await se.from("league_members").select("users(id,name),created_at").eq("league_id",U.id).order("created_at",{ascending:!0}),V=$?.map(ee=>({id:ee.users.id,name:ee.users.name??"(no name)"}))??[],H=[...V].sort((ee,ae)=>ee.name.localeCompare(ae.name));a(H);const K=V[0];ot(K),u?.id&&!V.some(ee=>ee.id===u.id)&&ht(!0),b(!1)})(),()=>{N=!1}},[d]),I.useEffect(()=>{},[t,x]),I.useEffect(()=>{if(x!=="chat"&&x!=="chat-beta"||!t?.id||!u?.id)return;(async()=>{await se.from("league_message_reads").upsert({league_id:t.id,user_id:u.id,last_read_at:new Date().toISOString()},{onConflict:"league_id,user_id"})})()},[x,t?.id,u?.id]);const on=I.useCallback(async(N,U=!1)=>{const{data:$,error:V}=await se.from("league_messages").select("id, league_id, user_id, content, created_at").eq("league_id",N).order("created_at",{ascending:!1}).limit(500);if(!V&&$){const K=($??[]).reverse();U&&console.log("[Chat] Loaded messages:",K.length,"from database (most recent)"),it(ee=>{const ae=new Set(ee.map(J=>J.id)),Se=K.filter(J=>!ae.has(J.id));if(ee.length===0)return U&&console.log("[Chat] Initial load, setting",K.length,"messages"),K;const me=[...ee,...Se].sort((J,xe)=>new Date(J.created_at).getTime()-new Date(xe.created_at).getTime()),q=me.length>500?me.slice(-500):me;return U&&console.log("[Chat] Merged messages. Previous:",ee.length,"New from DB:",Se.length,"Total:",me.length,"After limit:",q.length),q})}else V&&console.error("[Chat] Error loading messages:",V)},[]);I.useEffect(()=>{if(!t?.id)return;let N=!0;const U=async()=>{N&&await on(t.id,!0)};U();const $=se.channel(`league-messages:${t.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"league_messages",filter:`league_id=eq.${t.id}`},K=>{const ee=K.new;console.log("[Chat] Realtime message received:",ee.id,ee.content.substring(0,50)),it(ae=>{if(ae.some(we=>we.id===ee.id))return console.log("[Chat] Message already exists, skipping"),ae;const Se=[...ae,ee];return console.log("[Chat] Added realtime message. Total messages:",Se.length),Se})}).subscribe(),V=()=>{!document.hidden&&t?.id&&N&&(console.log("[Chat] App became visible, refetching messages..."),U())},H=()=>{t?.id&&N&&(console.log("[Chat] Window gained focus, refetching messages..."),U())};return document.addEventListener("visibilitychange",V),window.addEventListener("focus",H),()=>{N=!1,se.removeChannel($),document.removeEventListener("visibilitychange",V),window.removeEventListener("focus",H)}},[t?.id]);const an=I.useCallback(async()=>{if(!t||!u?.id)return;const N=bt.trim();if(!N)return;et("");const{data:U,error:$}=await se.from("league_messages").insert({league_id:t.id,user_id:u.id,content:N}).select("id, league_id, user_id, content, created_at").single();$?(console.error($),alert("Failed to send message.")):U&&it(H=>[...H,U]),window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||setTimeout(async()=>{try{const H=u.user_metadata?.display_name||u.email||"User",K=await fetch("/.netlify/functions/notifyLeagueMessageV2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:t.id,senderId:u.id,senderName:H,content:N})}),ee=await K.json().catch(()=>({}));ee.ok===!0?ee.sent&&ee.sent>0?tt({message:` Message sent to ${ee.sent} device${ee.sent===1?"":"s"}`,type:"success"}):ee.message==="No subscribed devices"?tt({message:` No subscribed devices (${ee.eligibleRecipients||0} eligible recipient${ee.eligibleRecipients===1?"":"s"})`,type:"warning"}):ee.message==="No devices"?tt({message:` No devices registered (${ee.eligibleRecipients||0} eligible recipient${ee.eligibleRecipients===1?"":"s"})`,type:"warning"}):ee.message==="No eligible recipients"?tt({message:" All members are currently active",type:"success"}):tt({message:` ${ee.message||"Notification sent"}`,type:"success"}):ee.ok===!1||ee.error?tt({message:` Failed to send notification: ${ee.error||"Unknown error"}`,type:"error"}):K.ok||tt({message:` Notification error (HTTP ${K.status})`,type:"error"}),setTimeout(()=>tt(null),5e3)}catch(H){console.error("[Chat] Notification exception:",H),tt({message:" Failed to send notification",type:"error"}),setTimeout(()=>tt(null),5e3)}},100)},[t,u,bt,et,it,tt]);I.useEffect(()=>{let N=!0;return(async()=>{const U=t?.name==="API Test";let $=Qe??1;if(U){const{data:we}=await se.from("test_api_meta").select("current_test_gw").eq("id",1).maybeSingle();if($=we?.current_test_gw??1,$&&$!==1){const{data:me}=await se.from("app_fixtures").select("gw").eq("gw",$).limit(1).maybeSingle();if(me)console.log("[League] Using current_test_gw from meta:",$);else{const{data:q}=await se.from("app_fixtures").select("gw").eq("gw",1).limit(1).maybeSingle();q&&($=1,console.log("[League] No fixtures for current_test_gw, falling back to GW T1"))}}else console.log("[League] Using GW T1 or current_test_gw:",$)}const V=U&&(x==="gw"||x==="gwr");console.log("[League] Data fetch:",{isApiTestLeague:U,tab:x,useTestFixtures:V,leagueName:t?.name,testGwForData:$,willUseTestTables:V,willUseMainTables:!V});let H=x==="gwr"?i.current?h:L||h:L;if(U&&(x==="gw"||x==="gwr")&&(H=$),console.log("[League] gwForData calculation:",{tab:x,manualGwSelected:i.current,selectedGw:h,currentGw:L,gwForData:H,isApiTestLeague:U}),x==="gw"&&!U&&ut.length>0){const{data:we}=await se.from("app_gw_submissions").select("gw").in("user_id",ut).not("submitted_at","is",null).order("gw",{ascending:!1}).limit(10);if(we&&we.length>0){const me=[...new Set(we.map(q=>q.gw))].sort((q,J)=>(J||0)-(q||0));for(const q of me)if(q){const{data:J}=await se.from("app_fixtures").select("gw").eq("gw",q).limit(1);if(J&&J.length>0){console.log("[League] Found fixtures for GW",q,"from submissions - using this GW (currentGw was",H,")"),H=q;break}}}!H&&L&&(H=L,console.log("[League] Using currentGw as fallback:",L))}if(console.log("[League] gwForData:",H,"memberIds:",ut),!H&&!V){ar([]),$t([]),Bt([]),Gt([]);return}let K;if(V){const{data:we}=await se.from("app_fixtures").select("id,test_gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,home_crest,away_crest,kickoff_time,api_match_id").eq("test_gw",$).order("fixture_index",{ascending:!0});K=we?.map(me=>({...me,gw:me.test_gw}))||null}else{console.log("[League] Fetching from MAIN database table (app_fixtures) for regular league, GW:",H);const{data:we}=await se.from("app_fixtures").select("id,gw,fixture_index,home_team,away_team,home_code,away_code,home_name,away_name,kickoff_time,api_match_id").eq("gw",H).order("fixture_index",{ascending:!0});K=we||null,console.log("[League] Fetched fixtures from main database:",we?.length||0,"fixtures")}if(!N)return;if(ar(K??[]),!ut.length){$t([]),Bt([]),Gt([]);return}let ee=null,ae;if(V){const{data:we}=await se.from("app_picks").select("user_id,matchday,fixture_index,pick").eq("matchday",$).in("user_id",ut);ee=we?.map(Y=>({...Y,gw:Y.matchday}))||null;const{data:me,error:q}=await se.from("app_gw_submissions").select("user_id,matchday,submitted_at").eq("matchday",$).not("submitted_at","is",null).in("user_id",ut);q&&console.error("Error fetching test_api_submissions:",q);const{data:J}=await se.from("app_fixtures").select("fixture_index,home_team,away_team,home_code,away_code,kickoff_time").eq("test_gw",$).order("fixture_index",{ascending:!0}),xe=new Set((J||[]).map(Y=>Y.fixture_index));console.log("[League] Current fixture indices from test_api_fixtures:",Array.from(xe)),console.log("[League] Current fixtures:",J?.map(Y=>({index:Y.fixture_index,home:Y.home_team,away:Y.away_team})));const G=[];if(me&&ee&&J){const Y=xe.size;console.log("[League] Required fixture count for valid submission:",Y);const ce=(J||[]).map(te=>te.kickoff_time?new Date(te.kickoff_time):null).filter(te=>te!==null&&!isNaN(te.getTime())),re=ce.length>0?new Date(Math.min(...ce.map(te=>te.getTime()))):null,je=new Date("2025-11-18T00:00:00Z");console.log("[League] Submission cutoff date (submissions before this are old):",je.toISOString()),console.log("[League] Earliest kickoff:",re?.toISOString()),me.forEach(te=>{const ve=(ee||[]).filter(Ee=>Ee.user_id===te.user_id&&Ee.matchday===$),oe=ve.filter(Ee=>xe.has(Ee.fixture_index)),ie=oe.length===Y&&Y>0,ue=new Set(oe.map(Ee=>Ee.fixture_index)),Ke=ue.size===Y,ft=te.submitted_at?new Date(te.submitted_at):null,De=ft&&ft>=je;if(ie&&Ke&&De)G.push(te),console.log("[League]  VALID submission (has picks for ALL current fixtures AND recent submission):",{user_id:te.user_id,submitted_at:te.submitted_at,submissionDate:ft?.toISOString(),cutoffDate:je.toISOString(),picksCount:ve.length,picksForCurrentFixtures:oe.length,uniqueIndices:ue.size,requiredCount:Y});else{const Ee=[];ie||Ee.push("missing picks"),Ke||Ee.push("duplicate/extra picks"),De||Ee.push(`old submission (${ft?.toISOString()} < ${je.toISOString()})`),console.log("[League]  INVALID submission:",{user_id:te.user_id,submitted_at:te.submitted_at,submissionDate:ft?.toISOString(),cutoffDate:je.toISOString(),picksCount:ve.length,picksForCurrentFixtures:oe.length,uniqueIndices:ue.size,requiredCount:Y,hasAllRequired:ie,hasExactMatch:Ke,isRecent:De,reason:Ee.join(", ")})}})}ae=G.map(Y=>({...Y,gw:Y.matchday}))||null,console.log("[League] Test API submissions fetched (filtered to only current fixtures):",ae),console.log("[League] Valid submissions count:",G.length,"out of",me?.length||0,"total")}else{console.log("[League] Fetching from MAIN database tables (picks, gw_submissions) for regular league");const{data:we}=await se.from("app_picks").select("user_id,gw,fixture_index,pick").eq("gw",H).in("user_id",ut);ee=we,console.log("[League] Fetched picks from main database:",we?.length||0,"picks");const{data:me}=await se.from("app_gw_submissions").select("user_id,gw,submitted_at").eq("gw",H).in("user_id",ut);ae=me,console.log("[League] Fetched submissions from main database:",me?.length||0,"submissions")}if(!N)return;$t(ee??[]),Bt(ae??[]);const{data:Se}=await se.from("app_gw_results").select("gw,fixture_index,result").eq("gw",V?1:H||0);N&&Gt(Se??[])})(),()=>{N=!1}},[x,L,v,h,ut]),I.useEffect(()=>{y.current=He},[He]);const Oe=I.useMemo(()=>{const N=new Map;return console.log("[League] Building submittedMap from subs:",Ht),Ht.forEach(U=>{if(U.submitted_at){const $=`${U.user_id}:${U.gw}`;console.log(`[League] Adding submission key: ${$}`,U),N.set($,!0)}else console.log("[League] Skipping submission with null submitted_at:",U)}),console.log("[League] Final submittedMap:",Array.from(N.entries())),N},[Ht]),Lt=I.useCallback(N=>N.map(U=>({user_id:U.id,name:U.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]})),[]);I.useEffect(()=>{const N=se.channel("app-gw-results-changes").on("postgres_changes",{event:"*",schema:"public",table:"app_gw_results"},()=>{X(U=>U+1)}).subscribe();return()=>{se.removeChannel(N)}},[]),I.useEffect(()=>{let N=!0;return(async()=>{if(!n.length){jt([]);return}if(t?.name==="API Test"){jt(Lt(n)),Ct(!1);return}if(L===null)return;Ct(!0);const{data:U}=await se.from("app_gw_results").select("gw,fixture_index,result"),$=U??[],V=new Map;if($.forEach(te=>{const ve=er(te);ve&&V.set(`${te.gw}:${te.fixture_index}`,ve)}),V.size===0){jt(Lt(n)),Ct(!1);return}const H=[...new Set(Array.from(V.keys()).map(te=>parseInt(te.split(":")[0],10)))].sort((te,ve)=>te-ve),K=["Prem Predictions","FC Football","Easy League"],ee=["The Bird league"],ae=await gn(t,L),Se=H.filter(te=>te>=ae);if(!K.includes(t?.name||"")&&!ee.includes(t?.name||"")&&Se.length===0){jt(Lt(n)),Ct(!1);return}const{data:we}=await se.from("app_picks").select("user_id,gw,fixture_index,pick").in("user_id",n.map(te=>te.id)).in("gw",Se),me=we??[],q=new Map;Se.forEach(te=>{const ve=new Map;n.forEach(oe=>ve.set(oe.id,{user_id:oe.id,score:0,unicorns:0})),q.set(te,ve)}),Se.forEach(te=>{Array.from(V.entries()).filter(([oe])=>parseInt(oe.split(":")[0],10)===te).map(([oe,ie])=>({idx:parseInt(oe.split(":")[1],10),out:ie})).forEach(({idx:oe,out:ie})=>{const ue=me.filter(De=>De.gw===te&&De.fixture_index===oe),Ke=ue.filter(De=>De.pick===ie).map(De=>De.user_id),ft=q.get(te);if(ue.forEach(De=>{if(De.pick===ie){const Ee=ft.get(De.user_id);Ee.score+=1}}),Ke.length===1&&n.length>=3){const De=Ke[0],Ee=ft.get(De);Ee.unicorns+=1}})});const J=new Map,xe=new Map,G=new Map,Y=new Map,ce=new Map,re=new Map;n.forEach(te=>{J.set(te.id,0),xe.set(te.id,0),G.set(te.id,0),Y.set(te.id,0),ce.set(te.id,0),re.set(te.id,[])}),Se.forEach(te=>{const ve=Array.from(q.get(te).values());if(ve.forEach(ue=>{xe.set(ue.user_id,(xe.get(ue.user_id)??0)+ue.score),G.set(ue.user_id,(G.get(ue.user_id)??0)+ue.unicorns)}),ve.sort((ue,Ke)=>Ke.score-ue.score||Ke.unicorns-ue.unicorns),!ve.length)return;const oe=ve[0],ie=ve.filter(ue=>ue.score===oe.score&&ue.unicorns===oe.unicorns);ie.length===1?(J.set(oe.user_id,(J.get(oe.user_id)??0)+3),Y.set(oe.user_id,(Y.get(oe.user_id)??0)+1),re.get(oe.user_id).push("W"),ve.slice(1).forEach(ue=>re.get(ue.user_id).push("L"))):(ie.forEach(ue=>{J.set(ue.user_id,(J.get(ue.user_id)??0)+1),ce.set(ue.user_id,(ce.get(ue.user_id)??0)+1),re.get(ue.user_id).push("D")}),ve.filter(ue=>!ie.find(Ke=>Ke.user_id===ue.user_id)).forEach(ue=>re.get(ue.user_id).push("L")))});const je=n.map(te=>({user_id:te.id,name:te.name,mltPts:J.get(te.id)??0,ocp:xe.get(te.id)??0,unicorns:G.get(te.id)??0,wins:Y.get(te.id)??0,draws:ce.get(te.id)??0,form:re.get(te.id)??[]}));je.sort((te,ve)=>ve.mltPts-te.mltPts||ve.unicorns-te.unicorns||ve.ocp-te.ocp||te.name.localeCompare(ve.name)),N&&(jt(je),Ct(!1))})(),()=>{N=!1}},[n,t,L,Lt,O]);function ln(){const N=["Prem Predictions","FC Football","Easy League"],U=["The Bird league"],$=["gregVjofVcarl","Let Down"],V=!!(t&&!N.includes(t.name)&&!U.includes(t.name)&&!$.includes(t.name)),H=ur.length?ur:n.map(K=>({user_id:K.id,name:K.name,mltPts:0,ocp:0,unicorns:0,wins:0,draws:0,form:[]}));return n.length===1?s.jsxs("div",{className:"text-center p-8 bg-white rounded-xl border border-slate-200 shadow-sm",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Invite at least one more user to make the ML start"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Share your league code with friends to get the competition going!"}),s.jsx("button",{onClick:()=>We(!0),className:"px-4 py-2 bg-[#1C8376] text-white font-semibold rounded-lg hover:bg-emerald-700 transition-colors",children:"Share League Code"})]}):s.jsxs("div",{className:"pt-4",children:[s.jsx(ps,{rows:H,members:n,showForm:g,currentUserId:u?.id,loading:sn,isLateStartingLeague:V}),s.jsx("div",{className:"mt-6 flex justify-between items-center",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(hs,{showForm:g,onToggle:j}),s.jsxs("button",{onClick:()=>Q(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),t?.name==="API Test"&&s.jsx("div",{className:"mt-4",style:{marginLeft:"-1rem",marginRight:"-1rem",width:"calc(100% + 2rem)",paddingLeft:0,paddingRight:0},children:s.jsx("video",{src:"/assets/Animation/Unicorn_Small.mov",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"auto",display:"block",padding:0,margin:0}})})]})}function cn(){const N=t?.name==="API Test"?Qe??1:L;if(!N)return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No current gameweek available."});if(!gr(t,N,Ot))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Predictions Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",N," predictions are not included in this league."]})]})});const U=new Map;At.forEach(G=>{if(G.gw!==N)return;const Y=er(G);Y&&U.set(G.fixture_index,Y)}),Ae.forEach(G=>{if(G.gw!==N)return;const Y=He[G.fixture_index];Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED"||Y.status==="FINISHED")&&(Y.homeScore>Y.awayScore?U.set(G.fixture_index,"H"):Y.awayScore>Y.homeScore?U.set(G.fixture_index,"A"):U.set(G.fixture_index,"D"))});const $=I.useMemo(()=>{const G=re=>{if(!re)return"Fixtures";const je=new Date(re);return isNaN(je.getTime())?"Fixtures":je.toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})},Y=new Map;Ae.filter(re=>re.gw===N).forEach(re=>{const je=G(re.kickoff_time),te=re.kickoff_time?new Date(re.kickoff_time).getTime():Number.MAX_SAFE_INTEGER;Y.has(je)||Y.set(je,{label:je,key:te,items:[]}),Y.get(je).items.push(re)});const ce=Array.from(Y.values());return ce.forEach(re=>re.items.sort((je,te)=>je.fixture_index-te.fixture_index)),ce.sort((re,je)=>re.key-je.key),ce},[Ae,N]),V=new Set(Ae.filter(G=>G.gw===N).map(G=>G.fixture_index)),H=t?.name==="API Test",K=n.length>0&&n.every(G=>Oe.get(`${G.id}:${N}`));if(H&&N===(Qe??1)){console.log("[League] API Test filtering:",{currentFixtureIndices:Array.from(V),totalPicks:_t.length,picksForGw:_t.filter(Y=>Y.gw===N).length,submittedMapSize:Oe.size,allSubmitted:K,members:n.map(Y=>({id:Y.id,name:Y.name,submitted:Oe.get(`${Y.id}:${N}`)})),fixturesCount:Ae.filter(Y=>Y.gw===N).length});const G=_t.filter(Y=>Y.gw===N);console.log(`[League] All picks for GW${N}:`,G.map(Y=>({user_id:Y.user_id,userName:n.find(ce=>ce.id===Y.user_id)?.name,fixture_index:Y.fixture_index,pick:Y.pick,hasSubmitted:!!Oe.get(`${Y.user_id}:${N}`),inCurrentFixtures:V.has(Y.fixture_index)})))}const ee=new Map;!H||K?_t.forEach(G=>{if(G.gw!==N)return;if(!Oe.get(`${G.user_id}:${N}`)){H&&N===1&&console.log("[League] API Test: Filtering out unsubmitted pick:",{user_id:G.user_id,fixture_index:G.fixture_index,userName:n.find(re=>re.id===G.user_id)?.name});return}if(!V.has(G.fixture_index)){H&&N===1&&console.log("[League] Filtering out old pick (not in current fixtures):",{fixture_index:G.fixture_index,currentIndices:Array.from(V),userName:n.find(re=>re.id===G.user_id)?.name});return}const ce=ee.get(G.fixture_index)??[];ce.push(G),ee.set(G.fixture_index,ce)}):console.log("[League] API Test: Not all submitted - skipping ALL picks processing. allSubmitted=",K);const ae=v!==null&&v>=N,Se=n.filter(G=>!Oe.get(`${G.id}:${N}`)).length,we=n.filter(G=>!Oe.get(`${G.id}:${N}`)).map(G=>G.name),me=Ot.get(N),q=me?new Date>=me:!1;if(H&&N===1){const G=n.map(re=>{const je=`${re.id}:${N}`,te=Oe.get(je);return{id:re.id,name:re.name,submitted:!!te,key:je}});console.log(`[League] ===== API Test GW${N} SUBMISSION CHECK =====`),console.log("[League] All submitted:",K),console.log("[League] Remaining:",Se),console.log("[League] Who didn't submit:",we),console.log("[League] Member submission status:",G),console.log("[League] Submitted map entries:",Array.from(Oe.entries())),console.log("[League] ================================================");const Y=n.find(re=>re.name.toLowerCase().includes("steve")||re.name.toLowerCase().includes("s")),ce=n.find(re=>re.name.toLowerCase().includes("jof")||re.name.toLowerCase().includes("j"));if(Y){const re=`${Y.id}:${N}`;console.log(`[League] STEVE (${Y.name}):`,{id:Y.id,submitted:!!Oe.get(re),key:re})}if(ce){const re=`${ce.id}:${N}`;console.log(`[League] JOF (${ce.name}):`,{id:ce.id,submitted:!!Oe.get(re),key:re})}}console.log(`GW${N} deadline check:`,{gwDeadline:me,now:new Date,deadlinePassed:q,allSubmitted:K,willShowPredictions:K||q});const J=H?!K:!K&&!q;return(H?!K:!K&&!q)?(console.log(`[League] Not all submitted, showing ONLY "Who's submitted" view. Blocking all predictions/fixtures.`,{isApiTestLeague:H,allSubmitted:K,deadlinePassed:q,remaining:Se}),s.jsx(Er,{members:n,submittedMap:Oe,picksGw:N,allSubmitted:K,remaining:Se,fixtures:Ae.filter(G=>G.gw===N),variant:"compact"})):s.jsxs("div",{className:"mt-2 pt-2",children:[J?s.jsx(Er,{members:n,submittedMap:Oe,picksGw:N,allSubmitted:K,remaining:Se,fixtures:Ae.filter(G=>G.gw===N),variant:"full"}):null,t?.name==="API Test"&&K&&$.length>0&&!J&&(()=>{const G=$.flatMap(oe=>oe.items),Y=new Set(G.map(oe=>oe.fixture_index)),ce={};Object.keys(He).forEach(oe=>{const ie=parseInt(oe,10);Y.has(ie)&&(ce[ie]=He[ie])});const re=G.some(oe=>{const ie=ce[oe.fixture_index];return ie&&(ie.status==="IN_PLAY"||ie.status==="PAUSED")}),je=G.length>0&&G.every(oe=>{const ie=ce[oe.fixture_index];return ie&&ie.status==="FINISHED"}),te=re||je||G.some(oe=>ce[oe.fixture_index]);let ve=0;return u?.id&&G.forEach(oe=>{const ie=ce[oe.fixture_index],ue=ie&&(ie.status==="IN_PLAY"||ie.status==="PAUSED"),Ke=ie&&ie.status==="FINISHED";if(ie&&(ue||Ke)){const De=(ee.get(oe.fixture_index)??[]).find(Ee=>Ee.user_id===u.id);if(De){let Ee=!1;(De.pick==="H"&&ie.homeScore>ie.awayScore||De.pick==="A"&&ie.awayScore>ie.homeScore||De.pick==="D"&&ie.homeScore===ie.awayScore)&&(Ee=!0),Ee&&ve++}}}),s.jsx("div",{className:"mt-3 space-y-6",children:$.map((oe,ie)=>s.jsx(Rr,{label:oe.label,fixtures:oe.items,picksByFixture:ee,members:n,outcomes:U,liveScores:ce,submittedMap:Oe,picksGw:N,isApiTestLeague:!0,isFirstSection:ie===0,hasLiveGames:re,allGamesFinished:je,hasStarted:te,liveFixturesCount:ve},ie))})})(),$.length>0&&t?.name!=="API Test"&&s.jsx("div",{className:"mt-3 space-y-6",children:$.map((G,Y)=>s.jsx(Rr,{label:G.label,fixtures:G.items,picksByFixture:ee,members:n,outcomes:U,liveScores:He,submittedMap:Oe,picksGw:N,isApiTestLeague:!1,isFirstSection:Y===0,allSubmitted:K,resultsPublished:ae,deadlinePassed:q,whoDidntSubmit:we},Y))}),!$.length&&!J&&s.jsxs("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-500",children:["No fixtures for GW ",N,"."]})]})}function dn(){const N=t?.name==="API Test"?Qe??1:x==="gwr"?i.current?h:L||h:h;if(!N||S.length===0&&t?.name!=="API Test")return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:"No gameweek selected."});if(!gr(t,N,Ot))return s.jsx("div",{className:"mt-3 rounded-2xl border bg-white shadow-sm p-4 text-slate-600",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold mb-2",children:"No Results Available"}),s.jsx("div",{className:"text-sm",children:"This league started from a later gameweek."}),s.jsxs("div",{className:"text-sm",children:["GW",N," results are not included in this league."]})]})});const U=new Map,$=t?.name==="API Test",V=Ae.filter(q=>q.gw===N),H=V.some(q=>{const J=He[q.fixture_index];return J&&(J.status==="IN_PLAY"||J.status==="PAUSED"||J.status==="FINISHED")});console.log("[League] Live Table calculation:",{resGw:N,currentGw:L,selectedGw:h,hasLiveScores:H,liveScoresCount:Object.keys(He).length,isApiTestLeague:$,fixturesCount:Ae.length,fixturesForGwCount:V.length,manualGwSelected:i.current}),$&&N===(Qe??1)?V.forEach(q=>{const J=He[q.fixture_index];J&&(J.status==="IN_PLAY"||J.status==="PAUSED"||J.status==="FINISHED")&&(J.homeScore>J.awayScore?U.set(q.fixture_index,"H"):J.awayScore>J.homeScore?U.set(q.fixture_index,"A"):U.set(q.fixture_index,"D"))}):H&&N===L?(console.log("[League] Using live scores for regular league GW",N),V.forEach(q=>{const J=He[q.fixture_index];J&&(J.status==="IN_PLAY"||J.status==="PAUSED"||J.status==="FINISHED")&&(J.homeScore>J.awayScore?U.set(q.fixture_index,"H"):J.awayScore>J.homeScore?U.set(q.fixture_index,"A"):U.set(q.fixture_index,"D"))}),console.log("[League] Outcomes from live scores:",Array.from(U.entries()))):(console.log("[League] Using results table for GW",N,{hasLiveScores:H,resGwEqualsCurrentGw:N===L,resultsCount:At.length,resultsForThisGw:At.filter(q=>q.gw===N).length,manualGwSelected:i.current,selectedGw:h}),At.forEach(q=>{if(q.gw!==N)return;const J=er(q);J&&U.set(q.fixture_index,J)}),console.log("[League] Outcomes from results:",Array.from(U.entries())));const K=n.filter(q=>Oe.get(`${q.id}:${N}`)).map(q=>({user_id:q.id,name:q.name,score:0,unicorns:0})),ee=new Map;_t.forEach(q=>{if(q.gw!==N||!Oe.get(`${q.user_id}:${N}`))return;const J=ee.get(q.fixture_index)??[];J.push(q),ee.set(q.fixture_index,J)}),Array.from(U.entries()).forEach(([q,J])=>{const G=(ee.get(q)??[]).filter(Y=>Y.pick===J).map(Y=>Y.user_id);if(G.forEach(Y=>{const ce=K.find(re=>re.user_id===Y);ce.score+=1}),G.length===1&&n.length>=3){const Y=K.find(ce=>ce.user_id===G[0]);Y.unicorns+=1}}),K.sort((q,J)=>J.score-q.score||J.unicorns-q.unicorns||q.name.localeCompare(J.name)),I.useEffect(()=>{if(K.length===0)return;const q=new Map;K.forEach((xe,G)=>{q.set(xe.user_id,G)});const J=new Set;if(q.forEach((xe,G)=>{const Y=k.current.get(G);Y!==void 0&&Y!==xe&&J.add(G)}),k.current=q,J.size>0){R(J);const xe=setTimeout(()=>{R(new Set)},2e3);return()=>clearTimeout(xe)}},[K.map(q=>`${q.user_id}-${q.score}-${q.unicorns}`).join(",")]);let ae=!1,Se=!1,we=!1,me=!1;if($&&N===(Qe??1)){const q=Ae;if(q.length>0&&(ae=q.every(xe=>{const G=He[xe.fixture_index];return G&&G.status==="FINISHED"}),Se=!!q.find(xe=>{const G=He[xe.fixture_index];return G&&(G.status==="IN_PLAY"||G.status==="PAUSED")}),me=q.some(xe=>{const G=He[xe.fixture_index];return G&&(G.status==="IN_PLAY"||G.status==="PAUSED"||G.status==="FINISHED")}),!ae)){const xe=new Date;we=q.some(G=>{if(!G.kickoff_time)return!1;const ce=new Date(G.kickoff_time).getTime()-xe.getTime(),re=He[G.fixture_index];return(!re||re.status!=="IN_PLAY"&&re.status!=="PAUSED"&&re.status!=="FINISHED")&&ce>0&&ce<=1440*60*1e3})}}else{const q=Ae.filter(J=>J.gw===N);if(q.length>0){const J=q.every(G=>U.has(G.fixture_index)),xe=q.some(G=>{const Y=He[G.fixture_index];return Y&&(Y.status==="IN_PLAY"||Y.status==="PAUSED")});ae=J&&!xe,console.log(`[League] GW ${N} finished check:`,{allHaveResults:J,hasActiveGames:xe,fixturesCount:q.length,outcomesCount:q.filter(G=>U.has(G.fixture_index)).length,allFixturesFinished:ae})}}return s.jsxs("div",{children:[s.jsx("style",{children:`
          @keyframes flash {
            0%, 100% {
              background-color: rgb(209, 250, 229);
            }
            25% {
              background-color: rgb(167, 243, 208);
            }
            50% {
              background-color: rgb(209, 250, 229);
            }
            75% {
              background-color: rgb(167, 243, 208);
            }
          }
          @keyframes pulse-score {
            0%, 100% {
              opacity: 1;
            }
            50% {
              opacity: 0.7;
            }
          }
          @keyframes position-change {
            0% {
              background-color: rgb(254, 243, 199);
            }
            50% {
              background-color: rgb(253, 230, 138);
            }
            100% {
              background-color: transparent;
            }
          }
          .flash-user-row {
            animation: flash 1.5s ease-in-out 3;
          }
          .pulse-live-score {
            animation: pulse-score 2s ease-in-out infinite;
          }
          .position-changed {
            animation: position-change 1.5s ease-out;
          }
          .full-width-header-border::after {
            content: '';
            position: absolute;
            left: -1rem;
            right: -1rem;
            bottom: 0;
            height: 1px;
            background-color: #cbd5e1;
            z-index: 1;
          }
        `}),K.length>0&&ae&&s.jsx(us,{winnerName:K[0].name,isDraw:K[0].score===K[1]?.score&&K[0].unicorns===K[1]?.unicorns}),s.jsx(gs,{rows:K,members:n,currentUserId:u?.id,positionChangeKeys:_,isApiTestLeague:$,hasLiveFixtures:Se,hasStartingSoonFixtures:we,hasStartedFixtures:me,allFixturesFinished:ae,resGw:N}),S.length>1&&s.jsx("div",{className:"mt-6 mb-4 flex flex-col items-center gap-3 px-4",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 w-full max-w-sm",children:[s.jsx(fs,{availableGws:S,selectedGw:N,onChange:q=>{i.current=!0,m(q)}}),s.jsxs("button",{onClick:()=>z(!0),className:"flex items-center justify-center gap-1.5 bg-white border-2 border-slate-300 hover:bg-slate-50 rounded-full text-slate-600 hover:text-slate-800 cursor-help transition-colors flex-shrink-0 px-3 py-2",children:[s.jsx("img",{src:"/assets/Icons/School--Streamline-Outlined-Material-Pr0_White.png",alt:"Rules",className:"w-4 h-4",style:{filter:"invert(40%) sepia(8%) saturate(750%) hue-rotate(180deg) brightness(95%) contrast(88%)"}}),s.jsx("span",{className:"text-sm font-medium",children:"Rules"})]})]})}),s.jsx(pr,{isOpen:B,onClose:()=>z(!1),title:"Weekly Winner",description:` How to Win the Week

The player with the most correct predictions wins.

 Unicorns

In Mini-Leagues with 3 or more players, if you're the only person to correctly predict a fixture, that's a Unicorn. In ties, the player with most Unicorns wins!`})]})}return I.useEffect(()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"auto"})},[x]),c?s.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:s.jsx("div",{className:"text-slate-500",children:"Loading"})}):!t&&!c?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-10",children:s.jsxs("div",{className:"rounded border bg-white p-6",children:[s.jsx("div",{className:"font-semibold mb-2",children:"League not found"}),s.jsx(mr,{to:"/leagues",className:"text-slate-600 underline",children:"Back to Mini Leagues"})]})}):t?s.jsxs("div",{className:`${r?"oldschool-theme":"bg-slate-50"}`,style:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100vh",maxHeight:"100vh",overflow:"hidden",touchAction:"none"},children:[s.jsx("style",{children:`
        /* Prevent body/html scrolling that could affect fixed header */
        body.league-page-active {
          overflow: hidden !important;
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
        html.league-page-active {
          overflow: hidden !important;
        }
        .league-header-fixed {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 50 !important;
          transform: translate3d(0, 0, 0) !important;
          -webkit-transform: translate3d(0, 0, 0) !important;
          will-change: transform !important;
          contain: layout style paint !important;
          touch-action: none !important;
          user-select: none !important;
          -webkit-user-select: none !important;
          pointer-events: auto !important;
          -webkit-overflow-scrolling: auto !important;
          overflow: visible !important;
        }
        .league-header-fixed a,
        .league-header-fixed button {
          touch-action: manipulation !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        .league-header-fixed .relative {
          position: relative !important;
          z-index: 100 !important;
        }
        @supports (height: 100dvh) {
          .league-header-fixed {
            top: env(safe-area-inset-top, 0px) !important;
          }
        }
        .league-content-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: none;
          overscroll-behavior-y: none;
          overscroll-behavior-x: none;
          touch-action: pan-y;
          padding-bottom: 2rem;
          padding-left: 1rem;
          padding-right: 1rem;
        }
        .league-content-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
        }
        @media (max-width: 768px) {
          .league-content-wrapper {
            top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px) + 0.5rem);
            padding-bottom: 2rem;
            padding-left: 1rem;
            padding-right: 1rem;
          }
          .league-content-wrapper.has-banner {
            top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px) + 0.5rem);
          }
        }
        /* Chat tab - full height layout */
        .chat-tab-wrapper {
          position: fixed;
          top: calc(3.5rem + 3rem + env(safe-area-inset-top, 0px));
          left: 0;
          right: 0;
          bottom: 0;
          height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          z-index: 10;
          overflow: visible;
          pointer-events: none;
        }
        .chat-tab-wrapper.has-banner {
          top: calc(3.5rem + 3rem + 3.5rem + env(safe-area-inset-top, 0px));
          height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          max-height: calc(100vh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
        }
        .chat-tab-wrapper > * {
          pointer-events: auto;
        }
        @supports (height: 100dvh) {
          .chat-tab-wrapper {
            height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - env(safe-area-inset-top, 0px));
          }
          .chat-tab-wrapper.has-banner {
            height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
            max-height: calc(100dvh - 3.5rem - 3rem - 3.5rem - env(safe-area-inset-top, 0px));
          }
        }
      `}),s.jsx("div",{ref:f,className:"league-header-fixed bg-white border-b border-slate-200 shadow-sm",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between h-14",children:[s.jsx(mr,{to:"/leagues",className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors -ml-2 px-2 py-1",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h1",{className:"text-lg font-normal text-slate-900 truncate flex-1 text-left px-2",children:t.name}),s.jsx("div",{className:"relative",style:{zIndex:100},children:s.jsx("button",{onClick:()=>Ie(!Ue),className:"flex items-center justify-center w-8 h-8 rounded-full hover:bg-slate-100 transition-colors -mr-2","aria-label":"Menu",children:s.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]}),s.jsxs("div",{className:"flex border-b border-slate-200 bg-white gap-2",children:[s.jsxs("button",{onClick:()=>{l.current=!0,o("chat-beta")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-[12px] font-semibold transition-colors relative leading-tight whitespace-normal "+(x==="chat-beta"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:"Chat (beta)"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:`Chat
(beta)`}),x==="chat-beta"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(S.length>0||t?.name==="API Test")&&s.jsxs("button",{onClick:()=>{l.current=!0,o("gwr")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight flex items-center justify-center gap-1.5 "+(x==="gwr"?"text-[#1C8376]":"text-slate-400"),children:[(()=>{const N=t?.name==="API Test"?Qe??1:L||h,U=t?.name==="API Test"?`T${N}`:N,$=new Date,V=Ae[0],H=V?.kickoff_time?new Date(V.kickoff_time):null,K=H&&H<=$,ae=Ae[Ae.length-1]?.fixture_index,we=(ae!==void 0?He[ae]:null)?.status==="FINISHED",me=K&&!we,q=me?"Live Table":"Results";return s.jsxs(s.Fragment,{children:[me&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"}),s.jsx("span",{className:"hidden sm:inline",children:U?`GW ${U} ${q}`:`GW ${q}`}),s.jsx("span",{className:"sm:hidden whitespace-pre-line text-center",children:U?`GW${U}
${q.replace(" ","")}`:`GW
${q.replace(" ","")}`})]})})(),x==="gwr"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),(L||t?.name==="API Test")&&s.jsxs("button",{onClick:()=>{l.current=!0,o("gw")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-xs font-semibold transition-colors relative leading-tight "+(x==="gw"?"text-[#1C8376]":"text-slate-400"),children:[s.jsx("span",{className:"hidden sm:inline",children:t?.name==="API Test"?`GW T${Qe??1} Predictions`:L?`GW ${L} Predictions`:"GW Predictions"}),s.jsx("span",{className:"sm:hidden whitespace-pre-line",children:t?.name==="API Test"?`GWT${Qe??1}
Predictions`:L?`GW${L}
Predictions`:`GW
Predictions`}),x==="gw"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]}),s.jsxs("button",{onClick:()=>{l.current=!0,o("mlt")},className:"flex-1 min-w-0 px-2 sm:px-4 py-3 text-sm font-semibold transition-colors relative "+(x==="mlt"?"text-[#1C8376]":"text-slate-400"),children:["Table",x==="mlt"&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#1C8376]"})]})]})]})}),Ue&&typeof document<"u"&&document.body&&xn.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0",onClick:()=>Ie(!1),style:{backgroundColor:"transparent",zIndex:99998}}),s.jsxs("div",{className:"fixed w-56 bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden",style:{zIndex:99999,top:"calc(3.5rem + 0.5rem + env(safe-area-inset-top, 0px))",right:"1rem"},children:[dt&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"px-4 py-3 border-b border-slate-100",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Admin:"}),s.jsx("div",{className:"text-sm font-semibold text-slate-800",children:qr})]}),s.jsx("button",{onClick:()=>{M(!0),Ie(!1)},className:"w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 transition-colors border-b border-slate-100",children:" Manage"}),s.jsx("button",{onClick:()=>{pe(!0),Ie(!1)},className:"w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 transition-colors border-b border-slate-100",children:" Upload League Badge"})]}),s.jsx("button",{onClick:()=>{We(!0),Ie(!1)},className:"w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 transition-colors border-b border-slate-100",children:" Invite players"}),s.jsx("button",{onClick:()=>{or(),Ie(!1)},className:"w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 transition-colors border-b border-slate-100",children:"Share league code"}),s.jsx("button",{onClick:()=>{C(!0),Ie(!1)},className:"w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors",children:"Leave"})]})]}),document.body),x==="chat"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(js,{chat:pt,userId:u?.id,nameById:sr,isMember:Gr,newMsg:bt,setNewMsg:et,onSend:an,leagueCode:t?.code,memberCount:n.length,maxMembers:Mt,notificationStatus:ct})}):x==="chat-beta"?s.jsx("div",{className:"chat-tab-wrapper",children:s.jsx(ds,{miniLeagueId:t?.id??null,memberNames:sr})}):s.jsx("div",{className:"league-content-wrapper",children:s.jsxs("div",{className:"px-1 sm:px-2",children:[x==="mlt"&&s.jsx(ln,{}),x==="gw"&&s.jsx(cn,{}),x==="gwr"&&s.jsx(dn,{})]})}),dt&&W&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>M(!1),children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 relative",onClick:N=>N.stopPropagation(),children:[s.jsx("button",{onClick:()=>M(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"League Management"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-slate-600 mb-3 font-semibold",children:"Remove Members:"}),s.jsxs("div",{className:"space-y-2",children:[n.filter(N=>N.id!==u?.id).map(N=>s.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium text-slate-800",children:N.name}),s.jsx("button",{onClick:()=>{Nt(N),Ye(!0),M(!1)},className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 hover:bg-red-200 rounded-md transition-colors font-medium",children:"Remove"})]},N.id)),n.filter(N=>N.id!==u?.id).length===0&&s.jsx("div",{className:"text-sm text-slate-500 italic py-4 text-center",children:"No other members to remove"})]})]}),s.jsx("div",{className:"pt-4 border-t border-slate-200",children:s.jsx("button",{onClick:()=>{Xe(!0),M(!1)},className:"w-full px-4 py-3 text-sm bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:" End League"})})]})]})]})}),dt&&ne&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>{pe(!1),Ne&&URL.revokeObjectURL(Ne),be(null),fe(null),Ge(!1),Ce(null)},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto relative",onClick:N=>N.stopPropagation(),children:[s.jsx("button",{onClick:()=>{pe(!1),Ne&&URL.revokeObjectURL(Ne),be(null),fe(null),Ge(!1),Ce(null)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors z-10",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"p-6 pt-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"League Badge"}),s.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Upload and customize your mini-league badge"}),Pe?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-sm text-slate-600 mb-4",children:[s.jsx("p",{className:"font-medium mb-1",children:"Position your image"}),s.jsx("p",{className:"text-xs",children:"Drag the image to position it, and use the slider to zoom in or out"})]}),s.jsx("div",{className:"relative w-full",style:{height:"400px"},children:s.jsx(Zn,{image:Pe,crop:Fe,zoom:ge,aspect:1,cropShape:"round",showGrid:!1,onCropChange:ye,onZoomChange:Re,onCropComplete:Xr,style:{containerStyle:{width:"100%",height:"100%",position:"relative"}}})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"block text-xs font-medium text-slate-700",children:["Zoom: ",Math.round(ge*100),"%"]}),s.jsx("input",{type:"range",min:1,max:3,step:.1,value:ge,onChange:N=>Re(Number(N.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-[#1C8376]"})]}),s.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-slate-200",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Preview:"}),s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 border-2 border-slate-300 flex items-center justify-center",children:Ne?s.jsx("img",{src:Ne,alt:"Preview",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-slate-200"})})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsx("button",{onClick:()=>{Ne&&URL.revokeObjectURL(Ne),be(null),ye({x:0,y:0}),Re(1),ke(null),Ce(null)},disabled:de,className:"flex-1 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),s.jsx("button",{onClick:en,disabled:de||!Te,className:"flex-1 px-4 py-2.5 bg-[#1C8376] text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:de?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):"Upload Badge"})]}),he&&s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:he})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"text-sm text-slate-600 mb-3 font-medium",children:"Current Badge:"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center border-2 border-slate-200",children:s.jsx("img",{src:t?bn(t):"/assets/league-avatars/ML-avatar-1.png",alt:"League badge",className:"w-full h-full object-cover",onError:N=>{const U=N.target;U.src="/assets/league-avatars/ML-avatar-1.png"}})}),t?.avatar&&s.jsx("button",{onClick:tn,disabled:de,className:"px-4 py-2 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Remove Badge"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Choose Image"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-8 text-center hover:border-[#1C8376] transition-colors",children:[s.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:N=>{const U=N.target.files?.[0];U&&Qr(U)},disabled:de,className:"hidden",id:"badge-upload-input"}),s.jsxs("label",{htmlFor:"badge-upload-input",className:"cursor-pointer flex flex-col items-center gap-3",children:[s.jsx("svg",{className:"w-12 h-12 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsxs("div",{children:[s.jsx("span",{className:"text-[#1C8376] font-semibold",children:"Click to upload"}),s.jsx("span",{className:"text-slate-600",children:" or drag and drop"})]}),s.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, or WebP (max 2MB)"})]})]})]}),de&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#1C8376]"}),s.jsx("span",{children:"Processing and uploading..."})]}),Le&&s.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800",children:" Badge uploaded successfully!"}),he&&s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:he})]})]})]})]})}),s.jsx(pr,{isOpen:Z,onClose:()=>Q(!1),title:"League Points",description:`Win the week  3 points
Draw  1 point
Lose  0 points

 Ties

If two or more players are tied on Points in the table, the player with the most overall Unicorns in the mini league is ranked higher.${t&&(["The Bird league"].includes(t.name)||["gregVjofVcarl","Let Down"].includes(t.name))?`

Note: This mini league started after GW1, so the "CP" column shows correct predictions since this mini league began.`:""}`}),_e&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Invite players"}),s.jsxs("p",{className:"text-slate-600 text-sm",children:["Share this code (up to ",Mt," members):"]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("code",{className:"font-mono text-lg font-bold",children:t.code}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.code)},className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Copy"}),s.jsx("button",{onClick:or,className:"px-3 py-1.5 border rounded-md text-sm hover:bg-slate-50",children:"Share"})]}),s.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:[n.length,"/",Mt," members"]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:()=>We(!1),className:"px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50",children:"Close"})})]})}),E&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Leave League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Are you sure you want to leave "',t?.name,`"? You'll need the league code to rejoin later.`]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>C(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:P,children:"Cancel"}),s.jsx("button",{onClick:Vr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:P,children:P?"Leaving...":"Leave League"})]})]})}),nt&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Join Mini League"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["You are about to join ",s.jsxs("strong",{children:['"',t?.name,'"']}),". Are you sure?"]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>ht(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:Me,children:"Cancel"}),s.jsx("button",{onClick:Zr,className:"flex-1 px-4 py-2 bg-[#1C8376] text-white rounded-md hover:bg-emerald-700 transition-colors disabled:opacity-50",disabled:Me,children:Me?"Joining...":"Join League"})]})]})}),qe&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Remove Member"}),s.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to remove ",s.jsxs("strong",{children:['"',mt?.name,'"']})," from the league? They will need the league code to rejoin."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>Ye(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:gt,children:"Cancel"}),s.jsx("button",{onClick:Yr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:gt,children:gt?"Removing...":"Remove Member"})]})]})}),Je&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:" End League"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["Are you absolutely sure you want to ",s.jsx("strong",{children:"permanently end"})," the league ",s.jsxs("strong",{children:['"',t?.name,'"']}),"?"]}),s.jsx("p",{className:"text-sm text-red-600 mb-6",children:"This will remove all members and delete the league forever. This action cannot be undone!"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors",disabled:lt,children:"Cancel"}),s.jsx("button",{onClick:Kr,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",disabled:lt,children:lt?"Ending...":"Yes, End League"})]})]})}),t?.name==="API Test"&&s.jsx("div",{className:"mt-6 mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:" Test League:"})," This league uses test API data and starts from Test GW 1 with zero points. It does not affect your main game scores."]})})]}):null}export{Ss as default};
