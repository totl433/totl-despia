import React from 'react';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { useTokens } from '@totl/ui';
import { SvgXml } from 'react-native-svg';

import HomeScreen from '../screens/HomeScreen';
import PredictionsScreen from '../screens/PredictionsScreen';
import GlobalScreen from '../screens/GlobalScreen';
import LeaguesNavigator from './LeaguesNavigator';
import Chat2Navigator from './Chat2Navigator';
import { useLeagueUnreadCounts } from '../hooks/useLeagueUnreadCounts';

export type RootTabsParamList = {
  Home: undefined;
  Predictions: undefined;
  Leagues: undefined;
  Chat: undefined;
  Global: undefined;
};

const Tab = createBottomTabNavigator<RootTabsParamList>();

const HOME_SVG = `<svg width="24" height="24" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.00586 18.7812C6.38086 18.7812 6 18.3516 6 17.8438C6 17.5703 6.12695 17.2871 6.38086 17.0723L16.5566 8.52734C16.9863 8.17578 17.4551 8 17.9238 8C18.3926 8 18.8613 8.17578 19.291 8.52734L24.1152 12.5898V10.8516C24.1152 10.4219 24.4082 10.1387 24.8477 10.1387H26.166C26.5957 10.1387 26.8789 10.4219 26.8789 10.8516V14.9043L29.4668 17.0723C29.7207 17.2871 29.8477 17.5703 29.8477 17.8438C29.8477 18.3516 29.4668 18.7812 28.8516 18.7812C28.5488 18.7812 28.2754 18.625 28.041 18.4199L26.8789 17.4531V26.623C26.8789 28.0684 26.0098 28.918 24.5352 28.918H11.3223C9.83789 28.918 8.96875 28.0684 8.96875 26.623V17.4531L7.80664 18.4199C7.57227 18.625 7.30859 18.7812 7.00586 18.7812ZM20.7461 21.3301V27.0039H24.0273C24.6328 27.0039 24.9648 26.6621 24.9648 26.0469V15.8418L18.3438 10.2852C18.207 10.168 18.0605 10.1191 17.9238 10.1191C17.7871 10.1191 17.6406 10.168 17.5137 10.2852L10.8828 15.8418V26.0469C10.8828 26.6621 11.2148 27.0039 11.8203 27.0039H15.1016V21.3301C15.1016 20.8711 15.4043 20.5781 15.8633 20.5781H19.9941C20.4531 20.5781 20.7461 20.8711 20.7461 21.3301Z" fill="currentColor"/>
</svg>`;
const PREDICTIONS_SVG = `<svg width="24" height="24" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.5 7C29.3447 7 34.0928 11.748 34.0928 17.5928C34.0925 23.4373 29.3446 28.1846 23.5 28.1846C17.6554 28.1846 12.9085 23.4373 12.9082 17.5928C12.9082 11.748 17.6553 7 23.5 7ZM12.1025 25.001C12.6067 25.0523 13 25.4784 13 25.9961C13 26.5138 12.6067 26.9399 12.1025 26.9912L12 26.9961H7C6.44772 26.9961 6 26.5484 6 25.9961C6 25.4438 6.44772 24.9961 7 24.9961H12L12.1025 25.001ZM20.3008 23.1504L21.0088 26.1855C21.7982 26.4213 22.6389 26.5439 23.5 26.5439C24.3613 26.5439 25.2026 26.4214 25.9922 26.1855L26.6895 23.1914L25.3359 21.4688H21.6133L20.3008 23.1504ZM27.2432 17.3057L26.207 20.5254L27.6631 22.4014L31.0166 22.4531C31.9189 21.0483 32.4521 19.3867 32.4521 17.6025L29.96 16.208L27.2432 17.3057ZM14.5488 17.6025C14.5591 19.3765 15.0718 21.0278 15.9639 22.4121L19.3271 22.3604L20.7832 20.4844L19.7578 17.3057L17.04 16.208L14.5488 17.6025ZM8.10254 16.001C8.60667 16.0523 9 16.4784 9 16.9961C9 17.5138 8.60667 17.9399 8.10254 17.9912L8 17.9961H3C2.44772 17.9961 2 17.5484 2 16.9961C2 16.4438 2.44772 15.9961 3 15.9961H8L8.10254 16.001ZM20.3525 9.21484C18.8556 9.76852 17.5532 10.7223 16.5586 11.9424L17.502 15.0391L20.1064 16.0957L22.875 13.9629V11.2451L20.3525 9.21484ZM24.126 11.2246V13.9629L26.8945 16.0957L29.499 15.0391L30.4424 11.9424C29.4479 10.7223 28.135 9.76907 26.6279 9.20508L24.126 11.2246ZM12.1025 8.00098C12.6067 8.05231 13 8.47842 13 8.99609C13 9.51377 12.6067 9.93988 12.1025 9.99121L12 9.99609H7C6.44772 9.99609 6 9.54838 6 8.99609C6 8.44381 6.44772 7.99609 7 7.99609H12L12.1025 8.00098Z" fill="currentColor"/>
</svg>`;
const MINI_LEAGUES_SVG = `<svg width="24" height="24" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.668 18.0762C21.0791 18.0762 18.9736 15.7988 18.9736 12.9951C18.9736 10.2344 21.0898 8 23.668 8C26.2676 8 28.373 10.2021 28.373 12.9736C28.373 15.7881 26.2676 18.0762 23.668 18.0762ZM11.2178 18.1943C8.97266 18.1943 7.13574 16.1963 7.13574 13.7256C7.13574 11.3301 8.9834 9.34277 11.2178 9.34277C13.4844 9.34277 15.3105 11.2979 15.3105 13.7041C15.3105 16.1855 13.4844 18.1943 11.2178 18.1943ZM23.668 16.2178C25.1719 16.2178 26.4287 14.7891 26.4287 12.9736C26.4287 11.2012 25.1826 9.8584 23.668 9.8584C22.1641 9.8584 20.918 11.2227 20.918 12.9951C20.918 14.8105 22.1855 16.2178 23.668 16.2178ZM11.2178 16.3574C12.4531 16.3574 13.4951 15.1865 13.4951 13.7041C13.4951 12.2969 12.4746 11.1689 11.2178 11.1689C9.99316 11.1689 8.96191 12.3184 8.96191 13.7256C8.96191 15.1865 10.0039 16.3574 11.2178 16.3574ZM5.30957 28.0664C3.77344 28.0664 3 27.4111 3 26.1328C3 22.5664 6.67383 19.3223 11.2178 19.3223C12.8936 19.3223 14.5908 19.7734 15.9551 20.6221C15.375 20.998 14.9238 21.4492 14.5693 21.9541C13.6348 21.4385 12.4209 21.1377 11.2178 21.1377C7.80176 21.1377 4.90137 23.501 4.90137 25.9717C4.90137 26.1543 4.9873 26.251 5.19141 26.251H12.7539C12.6787 26.96 13.0762 27.7227 13.6562 28.0664H5.30957ZM16.9648 28.0664C15.1172 28.0664 14.2256 27.4756 14.2256 26.2188C14.2256 23.2861 17.8994 19.333 23.668 19.333C29.4365 19.333 33.1104 23.2861 33.1104 26.2188C33.1104 27.4756 32.2188 28.0664 30.3604 28.0664H16.9648ZM16.6104 26.208H30.7256C30.9727 26.208 31.0693 26.1328 31.0693 25.9287C31.0693 24.2852 28.416 21.1914 23.668 21.1914C18.9199 21.1914 16.2559 24.2852 16.2559 25.9287C16.2559 26.1328 16.3525 26.208 16.6104 26.208Z" fill="currentColor"/>
</svg>`;
const CHAT_SVG = `<svg width="24" height="24" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.0586 25.9746C17.0664 25.9746 15.709 25.2031 15.0938 23.7871L11.7832 26.707C11.1191 27.3027 10.709 27.5664 10.1621 27.5664C9.38086 27.5664 8.92188 27.0195 8.92188 26.1602V23.748H8.52148C5.68945 23.748 4 22.0684 4 19.1582V11.5898C4 8.67969 5.65039 7 8.58984 7H21.041C23.9805 7 25.6309 8.68945 25.6309 11.5898V11.873H28.2676C31.0801 11.873 32.6133 13.4355 32.6133 16.1895V21.7168C32.6133 24.4414 31.0996 25.9746 28.3262 25.9746H28.1504V28.2109C28.1504 29.0605 27.6914 29.6074 26.9199 29.6074C26.3926 29.6074 25.9434 29.3145 25.3086 28.7578L22.0566 25.9746H19.0586ZM10.6406 22.6348V25.418L13.7363 22.3516C14.0684 22.0098 14.3223 21.8828 14.7129 21.8438C14.7129 21.8047 14.7031 21.7656 14.7031 21.7266V16.1895C14.7031 13.4355 16.2461 11.873 19.0586 11.873H23.7168V11.6484C23.7168 9.85156 22.8281 8.91406 20.9824 8.91406H8.63867C6.79297 8.91406 5.91406 9.85156 5.91406 11.6484V19.0996C5.91406 20.8965 6.79297 21.834 8.63867 21.834H9.83984C10.3965 21.834 10.6406 22.0488 10.6406 22.6348ZM19.2051 24.0996H22.0176C22.4668 24.0996 22.8477 24.2559 23.2188 24.6074L26.4316 27.5176V24.9785C26.4316 24.3926 26.793 24.0996 27.2715 24.0996H28.1211C29.9082 24.0996 30.7188 23.2207 30.7188 21.5117V16.3359C30.7188 14.627 29.9082 13.748 28.1211 13.748H19.2051C17.418 13.748 16.6074 14.627 16.6074 16.3359V21.5117C16.6074 23.2207 17.418 24.0996 19.2051 24.0996ZM20.3184 17.9961C19.8691 17.9961 19.5469 17.6445 19.5469 17.2148C19.5469 16.7656 19.8691 16.4336 20.3184 16.4336H27.0566C27.5059 16.4336 27.8379 16.7656 27.8379 17.2148C27.8379 17.6445 27.5059 17.9961 27.0566 17.9961H20.3184ZM20.3184 21.5605C19.8691 21.5605 19.5469 21.2285 19.5469 20.7891C19.5469 20.3496 19.8691 19.998 20.3184 19.998H25.2109C25.6504 19.998 25.9922 20.3496 25.9922 20.7891C25.9922 21.2285 25.6504 21.5605 25.2109 21.5605H20.3184Z" fill="currentColor"/>
</svg>`;
const LEADERBOARDS_SVG = `<svg width="24" height="24" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 10.3691C8 9.28516 8.69336 8.61133 9.82617 8.61133H11.6816C11.8867 7.5957 12.6387 7 13.8496 7H21.7012C22.9219 7 23.6738 7.60547 23.8691 8.61133H25.7246C26.8574 8.61133 27.5508 9.28516 27.5508 10.3691C27.5508 14.3438 25.5879 16.9023 21.7109 18.1133C21.2031 18.7676 20.6172 19.2949 20.0605 19.6855V23.6309H21.2031C22.5996 23.6309 23.3613 24.4609 23.3613 25.7891V27.8496C23.3613 28.3672 22.9609 28.7188 22.4727 28.7188H13.0781C12.5898 28.7188 12.1895 28.3672 12.1895 27.8496V25.7891C12.1895 24.4609 12.9512 23.6309 14.3477 23.6309H15.4902V19.6758C14.9336 19.2949 14.3574 18.7676 13.8496 18.1133C9.96289 16.9023 8 14.3438 8 10.3691ZM13.3516 12.4004C13.3516 15.8477 16.4961 18.8555 17.7754 18.8555C19.0547 18.8555 22.1992 15.8477 22.1992 12.4004V9.32422C22.1992 8.98242 21.9648 8.75781 21.623 8.75781H13.9277C13.5859 8.75781 13.3516 8.98242 13.3516 9.32422V12.4004ZM9.63086 10.5938C9.63086 13.0938 10.6074 14.8516 12.4727 15.8477C11.9355 14.7539 11.6035 13.4844 11.6035 12.127V10.3301H9.9043C9.73828 10.3301 9.63086 10.4375 9.63086 10.5938ZM23.0781 15.8477C24.9434 14.8516 25.9199 13.0938 25.9199 10.5938C25.9199 10.4375 25.8125 10.3301 25.6465 10.3301H23.9473V12.127C23.9473 13.4844 23.6152 14.7539 23.0781 15.8477ZM17.1602 23.6309H18.3906V20.5059C18.1758 20.5645 17.9707 20.5938 17.7754 20.5938C17.5801 20.5938 17.375 20.5645 17.1602 20.5059V23.6309ZM13.9375 26.9707H21.6133V25.9355C21.6133 25.6035 21.3887 25.3887 21.0566 25.3887H14.4941C14.1621 25.3887 13.9375 25.6035 13.9375 25.9355V26.9707Z" fill="currentColor"/>
</svg>`;

function TabSvgIcon({ xml, color, size }: { xml: string; color: string; size: number }) {
  return <SvgXml xml={xml} width={size} height={size} color={color} />;
}

export default function TabsNavigator() {
  const t = useTokens();
  const { unreadByLeagueId } = useLeagueUnreadCounts();
  const hasAnyUnread = React.useMemo(
    () => Object.values(unreadByLeagueId ?? {}).some((n) => Number(n ?? 0) > 0),
    [unreadByLeagueId]
  );

  return (
    <Tab.Navigator
      screenOptions={{
        headerShown: false,
        tabBarActiveTintColor: t.color.brand,
        tabBarInactiveTintColor: '#353536',
        tabBarStyle: { backgroundColor: t.color.surface, borderTopColor: t.color.border },
        tabBarHideOnKeyboard: true,
      }}
    >
      <Tab.Screen
        name="Home"
        component={HomeScreen}
        options={{
          title: 'Home',
          tabBarIcon: ({ color, size }) => <TabSvgIcon xml={HOME_SVG} size={size} color={color} />,
        }}
      />
      <Tab.Screen
        name="Predictions"
        component={PredictionsScreen}
        options={{
          title: 'Predictions',
          tabBarIcon: ({ color, size }) => <TabSvgIcon xml={PREDICTIONS_SVG} size={size} color={color} />,
        }}
      />
      <Tab.Screen
        name="Leagues"
        component={LeaguesNavigator as any}
        options={{
          title: 'Mini leagues',
          tabBarIcon: ({ color, size }) => <TabSvgIcon xml={MINI_LEAGUES_SVG} size={size} color={color} />,
        }}
      />
      <Tab.Screen
        name="Chat"
        component={Chat2Navigator as any}
        options={{
          title: 'Chat',
          tabBarIcon: ({ color, size }) => <TabSvgIcon xml={CHAT_SVG} size={size} color={color} />,
          // Dot-only badge: native bottom tabs require a space string.
          tabBarBadge: hasAnyUnread ? ' ' : undefined,
          tabBarBadgeStyle: { backgroundColor: '#DC2626' },
        }}
      />
      <Tab.Screen
        name="Global"
        component={GlobalScreen}
        options={{
          title: '2025/26',
          tabBarIcon: ({ color, size }) => <TabSvgIcon xml={LEADERBOARDS_SVG} size={size} color={color} />,
        }}
      />
    </Tab.Navigator>
  );
}

